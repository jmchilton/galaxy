webpackJsonp([6],{11:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=a(o),l=i(4),d=a(l),c=e.View.extend({visible:!1,initialize:function(t){var i=this;this.model=t&&t.model||new e.Model({id:r.default.uid(),cls:"ui-portlet",title:"",icon:"",buttons:null,body:null,scrollable:!0,nopadding:!1,operations:null,collapsible:!1,collapsible_button:!1,collapsed:!1,onchange_title:null}).set(t),this.setElement(this._template()),this.$body=this.$(".portlet-body"),this.$title_text=this.$(".portlet-title-text"),this.$title_icon=this.$(".portlet-title-icon"),this.$header=this.$(".portlet-header"),this.$content=this.$(".portlet-content"),this.$backdrop=this.$(".portlet-backdrop"),this.$buttons=this.$(".portlet-buttons"),this.$operations=this.$(".portlet-operations"),this.model.get("body")&&this.append(this.model.get("body")),this.collapsible_button=new d.default.ButtonIcon({icon:"fa-eye",tooltip:"Collapse/Expand",cls:"ui-button-icon-plain",onclick:function(){i[i.collapsed?"expand":"collapse"]()}}),this.render()},render:function(){var e=this,t=this.model.attributes;return this.$el.removeClass().addClass(t.cls).attr("id",t.id),this.$header[t.title?"show":"hide"](),this.$title_text.html(t.title),s.each([this.$content,this.$body],function(e){e[t.nopadding?"addClass":"removeClass"]("no-padding")}),t.icon?this.$title_icon.removeClass().addClass("portlet-title-icon fa").addClass(t.icon).show():this.$title_icon.hide(),this.$title_text[t.collapsible?"addClass":"removeClass"]("no-highlight collapsible").off(),t.collapsible&&(this.$title_text.on("click",function(){e[e.collapsed?"expand":"collapse"]()}),t.collapsed?this.collapse():this.expand()),this.$title_text.prop("disabled",!t.onchange_title),t.onchange_title&&this.$title_text.make_text_editable({on_finish:function(e){t.onchange_title(e)}}),t.buttons?(this.$buttons.empty().show(),n.each(this.model.get("buttons"),function(t,i){i.$el.prop("id",t),e.$buttons.append(i.$el)})):this.$buttons.hide(),this.$operations.empty,t.collapsible_button&&this.$operations.append(this.collapsible_button.$el),t.operations&&n.each(t.operations,function(t,i){i.$el.prop("id",t),e.$operations.append(i.$el)}),this},append:function(e){this.$body.append(e)},empty:function(){this.$body.empty()},header:function(){return this.$header},body:function(){return this.$body},show:function(){this.visible=!0,this.$el.fadeIn("fast")},hide:function(){this.visible=!1,this.$el.hide()},enableButton:function(e){this.$buttons.find("#"+e).prop("disabled",!1)},disableButton:function(e){this.$buttons.find("#"+e).prop("disabled",!0)},hideOperation:function(e){this.$operations.find("#"+e).hide()},showOperation:function(e){this.$operations.find("#"+e).show()},setOperation:function(e,t){this.$operations.find("#"+e).off("click").on("click",t)},title:function(e){return e&&this.$title_text.html(e),this.$title_text.html()},collapse:function(){this.collapsed=!0,this.$content.height("0%"),this.$body.hide(),this.collapsible_button.setIcon("fa-eye-slash")},expand:function(){this.collapsed=!1,this.$content.height("100%"),this.$body.fadeIn("fast"),this.collapsible_button.setIcon("fa-eye")},disable:function(){this.$backdrop.show()},enable:function(){this.$backdrop.hide()},_template:function(){return n("<div/>").append(n("<div/>").addClass("portlet-header").append(n("<div/>").addClass("portlet-operations")).append(n("<div/>").addClass("portlet-title").append(n("<i/>").addClass("portlet-title-icon")).append(n("<span/>").addClass("portlet-title-text")))).append(n("<div/>").addClass("portlet-content").append(n("<div/>").addClass("portlet-body")).append(n("<div/>").addClass("portlet-buttons"))).append(n("<div/>").addClass("portlet-backdrop"))}});t.default={View:c}}).call(t,i(1),i(2),i(0))},12:function(e,t,i){"use strict";(function(e,s){Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model({id:a.default.uid(),title:"",icon:"",cls:"btn btn-default",wait:!1,wait_text:"Sending...",wait_cls:"btn btn-info",disabled:!1,percentage:-1}).set(t),this.setElement(s("<button/>").attr("type","button").append(this.$icon=s("<i/>")).append(this.$title=s("<span/>")).append(this.$progress=s("<div/>").append(this.$progress_bar=s("<div/>")))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var e=this,t=this.model.attributes;this.$el.removeClass().addClass("ui-button-default").addClass(t.disabled&&"disabled").attr("id",t.id).attr("disabled",t.disabled).off("click").on("click",function(){s(".tooltip").hide(),t.onclick&&!e.disabled&&t.onclick()}).tooltip({title:t.tooltip,placement:"bottom"}),this.$progress.addClass("progress").css("display",-1!==t.percentage?"block":"none"),this.$progress_bar.addClass("progress-bar").css({width:t.percentage+"%"}),this.$icon.removeClass().addClass("icon fa"),this.$title.removeClass().addClass("title"),t.wait?(this.$el.addClass(t.wait_cls).prop("disabled",!0),this.$icon.addClass("fa-spinner fa-spin ui-margin-right"),this.$title.html(t.wait_text)):(this.$el.addClass(t.cls),this.$icon.addClass(t.icon),this.$title.html(t.title),t.icon&&t.title&&this.$icon.addClass("ui-margin-right"))},show:function(){this.$el.show()},hide:function(){this.$el.hide()},disable:function(){this.model.set("disabled",!0)},enable:function(){this.model.set("disabled",!1)},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},setIcon:function(e){this.model.set("icon",e)}}),r=o.extend({initialize:function(t){this.model=t&&t.model||new e.Model({id:a.default.uid(),title:"",icon:"",cls:""}).set(t),this.setElement(s("<a/>").append(this.$icon=s("<span/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var e=this.model.attributes;this.$el.removeClass().addClass(e.cls).attr({id:e.id,href:e.href||"javascript:void(0)",title:e.title,target:e.target||"_top",disabled:e.disabled}).tooltip({placement:"bottom"}).off("click").on("click",function(){e.onclick&&!e.disabled&&e.onclick()}),this.$icon.removeClass().addClass(e.icon)}}),l=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model({id:a.default.uid(),title:"Select/Unselect all",icons:["fa-square-o","fa-minus-square-o","fa-check-square-o"],value:0,onchange:function(){}}).set(t),this.setElement(s("<div/>").append(this.$icon=s("<span/>")).append(this.$title=s("<span/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(e){var t=this,e=this.model.attributes;this.$el.addClass("ui-button-check").off("click").on("click",function(){t.model.set("value",0===t.model.get("value")&&2||0),e.onclick&&e.onclick()}),this.$title.html(e.title),this.$icon.removeClass().addClass("icon fa ui-margin-right").addClass(e.icons[e.value])},value:function(e,t){return void 0!==e&&(t&&0!==e&&(e=e!==t&&1||2),this.model.set("value",e),this.model.get("onchange")(this.model.get("value"))),this.model.get("value")}}),d=o.extend({initialize:function(t){this.model=t&&t.model||new e.Model({id:a.default.uid(),title:"",icon:"",cls:"ui-button-icon",disabled:!1}).set(t),this.setElement(s("<div/>").append(this.$button=s("<div/>").append(this.$icon=s("<i/>")).append(this.$title=s("<span/>")))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(e){var e=this.model.attributes;this.$el.removeClass().addClass(e.cls).addClass(e.disabled&&"disabled").attr("disabled",e.disabled).attr("id",e.id).off("click").on("click",function(){s(".tooltip").hide(),!e.disabled&&e.onclick&&e.onclick()}),this.$button.addClass("button").tooltip({title:e.tooltip,placement:"bottom"}),this.$icon.removeClass().addClass("icon fa").addClass(e.icon),this.$title.addClass("title").html(e.title),e.icon&&e.title&&this.$icon.addClass("ui-margin-right")}}),c=o.extend({$menu:null,initialize:function(t){this.model=t&&t.model||new e.Model({id:"",title:"",pull:"right",icon:null,onclick:null,cls:"ui-button-icon ui-button-menu",tooltip:"",target:"",href:"",onunload:null,visible:!0,tag:""}).set(t),this.collection=new e.Collection,this.setElement(s("<div/>").append(this.$root=s("<div/>").append(this.$icon=s("<i/>")).append(this.$title=s("<span/>")))),this.listenTo(this.model,"change",this.render,this),this.listenTo(this.collection,"change add remove reset",this.render,this),this.render()},render:function(){var e=this,t=this.model.attributes;this.$el.removeClass().addClass("dropdown").addClass(t.cls).attr("id",t.id).css({display:t.visible&&this.collection.where({visible:!0}).length>0?"block":"none"}),this.$root.addClass("root button dropdown-toggle").attr("data-toggle","dropdown").tooltip({title:t.tooltip,placement:"bottom"}).off("click").on("click",function(e){s(".tooltip").hide(),e.preventDefault(),t.onclick&&t.onclick()}),this.$icon.removeClass().addClass("icon fa").addClass(t.icon),this.$title.removeClass().addClass("title").html(t.title),t.icon&&t.title&&this.$icon.addClass("ui-margin-right"),this.$menu&&this.$menu.remove(),this.collection.length>0&&(this.$menu=s("<ul/>").addClass("menu dropdown-menu").addClass("pull-"+e.model.get("pull")).attr("role","menu"),this.$el.append(this.$menu)),this.collection.each(function(t){var i=t.attributes;if(i.visible){var n=s("<a/>").addClass("dropdown-item").attr({href:i.href,target:i.target}).append(s("<i/>").addClass("fa").addClass(i.icon).css("display",i.icon?"inline-block":"none")).append(i.title).on("click",function(e){i.onclick&&(e.preventDefault(),i.onclick())});e.$menu.append(s("<li/>").append(n)),i.divider&&e.$menu.append(s("<li/>").addClass("divider"))}})},addMenu:function(e){this.collection.add(a.default.merge(e,{title:"",target:"",href:"",onclick:null,divider:!1,visible:!0,icon:null,cls:"button-menu btn-group"}))}});t.default={ButtonDefault:o,ButtonLink:r,ButtonIcon:d,ButtonCheck:l,ButtonMenu:c}}).call(t,i(1),i(0))},167:function(e,t,i){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0});var s=e.Model.extend({defaults:{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"},urlRoot:Galaxy.root+"api/tool_shed"}),n=e.Collection.extend({url:Galaxy.root+"api/tool_shed",model:s}),a=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/contents"}),o=e.Collection.extend({url:Galaxy.root+"api/tool_shed/contents",model:a}),r=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/category"}),l=e.Collection.extend({url:Galaxy.root+"api/tool_shed/category",model:r}),d=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/repository"}),c=e.Collection.extend({url:Galaxy.root+"api/tool_shed/repository",model:d}),h=e.Model.extend({url:"#"}),u=e.Collection.extend({url:"#",model:h,fetch:function(){var t=this,s=Array(),n=JSON.parse(localStorage.repositories),a=Object.keys(n);return i.each(a,function(e){var t=n[e];t.queue_key=e,s.push(t)}),t.reset(s),e.Collection.prototype.fetch.call(this)}}),p=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/tool_shed/status"}),_=e.Collection.extend({url:Galaxy.root+"api/tool_shed/status",model:p}),f=e.Model.extend({defaults:[{}],urlRoot:Galaxy.root+"api/workflows?missing_tools=True"}),g=e.Collection.extend({url:Galaxy.root+"api/workflows?missing_tools=True",model:f});t.default={ShedModel:s,ShedsCollection:n,Category:a,Categories:o,CategoryModel:r,CategoryCollection:l,RepositoryModel:d,RepositoryCollection:c,RepoQueue:u,RepoStatus:_,WorkflowTools:g}}).call(t,i(1),i(2))},168:function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=function(t,i){var s=this,n=this.shed_url,a=Galaxy.root+"api/tool_shed/search";e.get(a,{term:t.term,tool_shed_url:n},function(e){var t=s.shedParser(e);i(t)})},s=function(t){var i=[],s=t.hits;return e.each(s,function(e){var t=s[e],n=t.repository.name+" by "+t.repository.repo_owner_username+": "+t.repository.description,a={value:t.repository.id,label:n};i.push(a)}),i},n=function(e){"/"==e.tool_shed_url.substr(-1)&&(e.tool_shed_url=e.tool_shed_url.substr(0,e.tool_shed_url.length-1));var t=e.tool_shed_url+"|"+e.repository_id+"|"+e.changeset_revision,i=new Object;localStorage.repositories&&(i=JSON.parse(localStorage.repositories)),i[t]=e,localStorage.repositories=JSON.stringify(i)},a=function(){if(localStorage.hasOwnProperty("repositories")){var e=JSON.parse(localStorage.repositories);return Object.keys(e).length}return 0};t.default={searchShed:i,shedParser:s,addToQueue:n,queueLength:a}}).call(t,i(0))},198:function(e,t,i){var s,n,a;!function(o){"use strict";n=[i(0)],s=o,void 0!==(a="function"==typeof s?s.apply(t,n):s)&&(e.exports=a)}(function(e,t){"use strict";/*!
 * jsTree 3.0.3
 * http://jstree.com/
 *
 * Copyright (c) 2014 Ivan Bozhanov (http://vakata.com)
 *
 * Licensed same as jquery - under the terms of the MIT License
 *   http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * if using jslint please allow for the jQuery global and use following options: 
 * jslint: browser: true, ass: true, bitwise: true, continue: true, nomen: true, plusplus: true, regexp: true, unparam: true, todo: true, white: true
 */
if(!e.jstree){var i,s,n=0,a=!1,o=!1,r=!1,l=[],d=e("script:last").attr("src"),c=document,h=c.createElement("LI");h.setAttribute("role","treeitem"),i=c.createElement("I"),i.className="jstree-icon jstree-ocl",h.appendChild(i),i=c.createElement("A"),i.className="jstree-anchor",i.setAttribute("href","#"),s=c.createElement("I"),s.className="jstree-icon jstree-themeicon",i.appendChild(s),h.appendChild(i),i=s=null,e.jstree={version:"3.0.3",defaults:{plugins:[]},plugins:{},path:d&&-1!==d.indexOf("/")?d.replace(/\/[^\/]+$/,""):"",idregex:/[\\:&!^|()\[\]<>@*'+~#";.,=\- \/${}%]/g},e.jstree.create=function(t,i){var s=new e.jstree.core(++n),a=i;return i=e.extend(!0,{},e.jstree.defaults,i),a&&a.plugins&&(i.plugins=a.plugins),e.each(i.plugins,function(e,t){"core"!==e&&(s=s.plugin(t,i[t]))}),s.init(t,i),s},e.jstree.core=function(e){this._id=e,this._cnt=0,this._wrk=null,this._data={core:{themes:{name:!1,dots:!1,icons:!1},selected:[],last_error:{},working:!1,worker_queue:[]}}},e.jstree.reference=function(t){var i=null,s=null;if(t&&t.id&&(t=t.id),!s||!s.length)try{s=e(t)}catch(e){}if(!s||!s.length)try{s=e("#"+t.replace(e.jstree.idregex,"\\$&"))}catch(e){}return s&&s.length&&(s=s.closest(".jstree")).length&&(s=s.data("jstree"))?i=s:e(".jstree").each(function(){var s=e(this).data("jstree");if(s&&s._model.data[t])return i=s,!1}),i},e.fn.jstree=function(i){var s="string"==typeof i,n=Array.prototype.slice.call(arguments,1),a=null;return this.each(function(){var o=e.jstree.reference(this),r=s&&o?o[i]:null;if(a=s&&r?r.apply(o,n):null,o||s||i!==t&&!e.isPlainObject(i)||e(this).data("jstree",new e.jstree.create(this,i)),(o&&!s||!0===i)&&(a=o||!1),null!==a&&a!==t)return!1}),null!==a&&a!==t?a:this},e.expr[":"].jstree=e.expr.createPseudo(function(i){return function(i){return e(i).hasClass("jstree")&&e(i).data("jstree")!==t}}),e.jstree.defaults.core={data:!1,strings:!1,check_callback:!1,error:e.noop,animation:200,multiple:!0,themes:{name:!1,url:!1,dir:!1,dots:!0,icons:!0,stripes:!1,variant:!1,responsive:!1},expand_selected_onload:!0,worker:!0,force_text:!1},e.jstree.core.prototype={plugin:function(t,i){var s=e.jstree.plugins[t];return s?(this._data[t]={},s.prototype=this,new s(i,this)):this},init:function(t,i){this._model={data:{"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}},changed:[],force_full_redraw:!1,redraw_timeout:!1,default_state:{loaded:!0,opened:!1,selected:!1,disabled:!1}},this.element=e(t).addClass("jstree jstree-"+this._id),this.settings=i,this.element.bind("destroyed",e.proxy(this.teardown,this)),this._data.core.ready=!1,this._data.core.loaded=!1,this._data.core.rtl="rtl"===this.element.css("direction"),this.element[this._data.core.rtl?"addClass":"removeClass"]("jstree-rtl"),this.element.attr("role","tree"),this.bind(),this.trigger("init"),this._data.core.original_container_html=this.element.find(" > ul > li").clone(!0),this._data.core.original_container_html.find("li").addBack().contents().filter(function(){return 3===this.nodeType&&(!this.nodeValue||/^\s+$/.test(this.nodeValue))}).remove(),this.element.html("<ul class='jstree-container-ul jstree-children'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this._data.core.li_height=this.get_container_ul().children("li:eq(0)").height()||24,this.trigger("loading"),this.load_node("#")},destroy:function(e){e||this.element.empty(),this.element.unbind("destroyed",this.teardown),this.teardown()},teardown:function(){this.unbind(),this.element.removeClass("jstree").removeData("jstree").find("[class^='jstree']").addBack().attr("class",function(){return this.className.replace(/jstree[^ ]*|$/gi,"")}),this.element=null},bind:function(){this.element.on("dblclick.jstree",function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var e=window.getSelection();try{e.removeAllRanges(),e.collapse()}catch(e){}}}).on("click.jstree",".jstree-ocl",e.proxy(function(e){this.toggle_node(e.target)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(t){t.preventDefault(),e(t.currentTarget).focus(),this.activate_node(t.currentTarget,t)},this)).on("keydown.jstree",".jstree-anchor",e.proxy(function(t){if("INPUT"===t.target.tagName)return!0;var i=null;switch(t.which){case 13:case 32:t.type="click",e(t.currentTarget).trigger(t);break;case 37:t.preventDefault(),this.is_open(t.currentTarget)?this.close_node(t.currentTarget):(i=this.get_prev_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 38:t.preventDefault(),i=this.get_prev_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 39:t.preventDefault(),this.is_closed(t.currentTarget)?this.open_node(t.currentTarget,function(e){this.get_node(e,!0).children(".jstree-anchor").focus()}):(i=this.get_next_dom(t.currentTarget))&&i.length&&i.children(".jstree-anchor").focus();break;case 40:t.preventDefault(),i=this.get_next_dom(t.currentTarget),i&&i.length&&i.children(".jstree-anchor").focus();break;case 46:t.preventDefault(),i=this.get_node(t.currentTarget),i&&i.id&&"#"!==i.id&&(i=this.is_selected(i)?this.get_selected():i);break;case 113:t.preventDefault(),i=this.get_node(t.currentTarget)}},this)).on("load_node.jstree",e.proxy(function(t,i){if(i.status&&("#"!==i.node.id||this._data.core.loaded||(this._data.core.loaded=!0,this.trigger("loaded")),!this._data.core.ready&&!this.get_container_ul().find(".jstree-loading:eq(0)").length)){if(this._data.core.ready=!0,this._data.core.selected.length){if(this.settings.core.expand_selected_onload){var s,n,a=[];for(s=0,n=this._data.core.selected.length;s<n;s++)a=a.concat(this._model.data[this._data.core.selected[s]].parents);for(a=e.vakata.array_unique(a),s=0,n=a.length;s<n;s++)this.open_node(a[s],!1,0)}this.trigger("changed",{action:"ready",selected:this._data.core.selected})}setTimeout(e.proxy(function(){this.trigger("ready")},this),0)}},this)).on("init.jstree",e.proxy(function(){var e=this.settings.core.themes;this._data.core.themes.dots=e.dots,this._data.core.themes.stripes=e.stripes,this._data.core.themes.icons=e.icons,this.set_theme(e.name||"default",e.url),this.set_theme_variant(e.variant)},this)).on("loading.jstree",e.proxy(function(){this[this._data.core.themes.dots?"show_dots":"hide_dots"](),this[this._data.core.themes.icons?"show_icons":"hide_icons"](),this[this._data.core.themes.stripes?"show_stripes":"hide_stripes"]()},this)).on("blur.jstree",".jstree-anchor",e.proxy(function(t){e(t.currentTarget).filter(".jstree-hovered").mouseleave()},this)).on("focus.jstree",".jstree-anchor",e.proxy(function(t){this.element.find(".jstree-hovered").not(t.currentTarget).mouseleave(),e(t.currentTarget).mouseenter()},this)).on("mouseenter.jstree",".jstree-anchor",e.proxy(function(e){this.hover_node(e.currentTarget)},this)).on("mouseleave.jstree",".jstree-anchor",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},unbind:function(){this.element.off(".jstree"),e(document).off(".jstree-"+this._id)},trigger:function(e,t){t||(t={}),t.instance=this,this.element.triggerHandler(e.replace(".jstree","")+".jstree",t)},get_container:function(){return this.element},get_container_ul:function(){return this.element.children(".jstree-children:eq(0)")},get_string:function(t){var i=this.settings.core.strings;return e.isFunction(i)?i.call(this,t):i&&i[t]?i[t]:t},_firstChild:function(e){for(e=e?e.firstChild:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_nextSibling:function(e){for(e=e?e.nextSibling:null;null!==e&&1!==e.nodeType;)e=e.nextSibling;return e},_previousSibling:function(e){for(e=e?e.previousSibling:null;null!==e&&1!==e.nodeType;)e=e.previousSibling;return e},get_node:function(t,i){t&&t.id&&(t=t.id);var s;try{if(this._model.data[t])t=this._model.data[t];else if(((s=e(t,this.element)).length||(s=e("#"+t.replace(e.jstree.idregex,"\\$&"),this.element)).length)&&this._model.data[s.closest(".jstree-node").attr("id")])t=this._model.data[s.closest(".jstree-node").attr("id")];else{if(!(s=e(t,this.element)).length||!s.hasClass("jstree"))return!1;t=this._model.data["#"]}return i&&(t="#"===t.id?this.element:e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)),t}catch(e){return!1}},get_path:function(e,t,i){if(!(e=e.parents?e:this.get_node(e))||"#"===e.id||!e.parents)return!1;var s,n,a=[];for(a.push(i?e.id:e.text),s=0,n=e.parents.length;s<n;s++)a.push(i?e.parents[s]:this.get_text(e.parents[s]));return a=a.reverse().slice(1),t?a.join(t):a},get_next_dom:function(t,i){var s;return t=this.get_node(t,!0),t[0]===this.element[0]?!!(s=this._firstChild(this.get_container_ul()[0]))&&e(s):!(!t||!t.length)&&(i?!!(s=this._nextSibling(t[0]))&&e(s):t.hasClass("jstree-open")?!!(s=this._firstChild(t.children(".jstree-children")[0]))&&e(s):null!==(s=this._nextSibling(t[0]))?e(s):t.parentsUntil(".jstree",".jstree-node").next(".jstree-node").eq(0))},get_prev_dom:function(t,i){var s;if(t=this.get_node(t,!0),t[0]===this.element[0])return!!(s=this.get_container_ul()[0].lastChild)&&e(s);if(!t||!t.length)return!1;if(i)return!!(s=this._previousSibling(t[0]))&&e(s);if(null!==(s=this._previousSibling(t[0]))){for(t=e(s);t.hasClass("jstree-open");)t=t.children(".jstree-children:eq(0)").children(".jstree-node:last");return t}return!(!(s=t[0].parentNode.parentNode)||!s.className||-1===s.className.indexOf("jstree-node"))&&e(s)},get_parent:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.parent},get_children_dom:function(e){return e=this.get_node(e,!0),e[0]===this.element[0]?this.get_container_ul().children(".jstree-node"):!(!e||!e.length)&&e.children(".jstree-children").children(".jstree-node")},is_parent:function(e){return(e=this.get_node(e))&&(!1===e.state.loaded||e.children.length>0)},is_loaded:function(e){return(e=this.get_node(e))&&e.state.loaded},is_loading:function(e){return(e=this.get_node(e))&&e.state&&e.state.loading},is_open:function(e){return(e=this.get_node(e))&&e.state.opened},is_closed:function(e){return(e=this.get_node(e))&&this.is_parent(e)&&!e.state.opened},is_leaf:function(e){return!this.is_parent(e)},load_node:function(t,i){var s,n,a,o,r;if(e.isArray(t))return this._load_nodes(t.slice(),i),!0;if(!(t=this.get_node(t)))return i&&i.call(this,t,!1),!1;if(t.state.loaded){for(t.state.loaded=!1,s=0,n=t.children_d.length;s<n;s++){for(a=0,o=t.parents.length;a<o;a++)this._model.data[t.parents[a]].children_d=e.vakata.array_remove_item(this._model.data[t.parents[a]].children_d,t.children_d[s]);this._model.data[t.children_d[s]].state.selected&&(r=!0,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.children_d[s])),delete this._model.data[t.children_d[s]]}t.children=[],t.children_d=[],r&&this.trigger("changed",{action:"load_node",node:t,selected:this._data.core.selected})}return t.state.loading=!0,this.get_node(t,!0).addClass("jstree-loading"),this._load_node(t,e.proxy(function(e){t=this._model.data[t.id],t.state.loading=!1,t.state.loaded=e;var s=this.get_node(t,!0);t.state.loaded&&!t.children.length&&s&&s.length&&!s.hasClass("jstree-leaf")&&s.removeClass("jstree-closed jstree-open").addClass("jstree-leaf"),s.removeClass("jstree-loading"),this.trigger("load_node",{node:t,status:e}),i&&i.call(this,t,e)},this)),!0},_load_nodes:function(e,t,i){var s,n,a=!0,o=function(){this._load_nodes(e,t,!0)},r=this._model.data;for(s=0,n=e.length;s<n;s++)!r[e[s]]||r[e[s]].state.loaded&&i||(this.is_loading(e[s])||this.load_node(e[s],o),a=!1);a&&t&&!t.done&&(t.call(this,e),t.done=!0)},_load_node:function(t,i){var s,n=this.settings.core.data;return n?e.isFunction(n)?n.call(this,t,e.proxy(function(s){!1===s&&i.call(this,!1),this["string"==typeof s?"_append_html_data":"_append_json_data"](t,"string"==typeof s?e(s):s,function(e){i.call(this,e)})},this)):"object"==typeof n?n.url?(n=e.extend(!0,{},n),e.isFunction(n.url)&&(n.url=n.url.call(this,t)),e.isFunction(n.data)&&(n.data=n.data.call(this,t)),e.ajax(n).done(e.proxy(function(s,n,a){var o=a.getResponseHeader("Content-Type");return-1!==o.indexOf("json")||"object"==typeof s?this._append_json_data(t,s,function(e){i.call(this,e)}):-1!==o.indexOf("html")||"string"==typeof s?this._append_html_data(t,e(s),function(e){i.call(this,e)}):(this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:a})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))},this)).fail(e.proxy(function(e){i.call(this,!1),this._data.core.last_error={error:"ajax",plugin:"core",id:"core_04",reason:"Could not load node",data:JSON.stringify({id:t.id,xhr:e})},this.settings.core.error.call(this,this._data.core.last_error)},this))):(s=e.isArray(n)||e.isPlainObject(n)?JSON.parse(JSON.stringify(n)):n,"#"===t.id?this._append_json_data(t,s,function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_05",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1))):"string"==typeof n?"#"===t.id?this._append_html_data(t,e(n),function(e){i.call(this,e)}):(this._data.core.last_error={error:"nodata",plugin:"core",id:"core_06",reason:"Could not load node",data:JSON.stringify({id:t.id})},this.settings.core.error.call(this,this._data.core.last_error),i.call(this,!1)):i.call(this,!1):"#"===t.id?this._append_html_data(t,this._data.core.original_container_html.clone(!0),function(e){i.call(this,e)}):i.call(this,!1)},_node_changed:function(e){(e=this.get_node(e))&&this._model.changed.push(e.id)},_append_html_data:function(t,i,s){t=this.get_node(t),t.children=[],t.children_d=[];var n,a,o,r=i.is("ul")?i.children():i,l=t.id,d=[],c=[],h=this._model.data,u=h[l],p=this._data.core.selected.length;for(r.each(e.proxy(function(t,i){(n=this._parse_model_from_html(e(i),l,u.parents.concat()))&&(d.push(n),c.push(n),h[n].children_d.length&&(c=c.concat(h[n].children_d)))},this)),u.children=d,u.children_d=c,a=0,o=u.parents.length;a<o;a++)h[u.parents[a]].children_d=h[u.parents[a]].children_d.concat(c);this.trigger("model",{nodes:c,parent:l}),"#"!==l?(this._node_changed(l),this.redraw()):(this.get_container_ul().children(".jstree-initial-node").remove(),this.redraw(!0)),this._data.core.selected.length!==p&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),s.call(this,!0)},_append_json_data:function(t,i,s){t=this.get_node(t),t.children=[],t.children_d=[],i.d&&"string"==typeof(i=i.d)&&(i=JSON.parse(i)),e.isArray(i)||(i=[i]);var n=null,a={df:this._model.default_state,dat:i,par:t.id,m:this._model.data,t_id:this._id,t_cnt:this._cnt,sel:this._data.core.selected},o=function(e,t){e.data&&(e=e.data);var i,s,n,a,o=e.dat,r=e.par,l=[],d=[],c=[],h=e.df,u=e.t_id,p=e.t_cnt,_=e.m,f=_[r],g=e.sel,m=function(e,i,s){s=s?s.concat():[],i&&s.unshift(i);var n,a,o,r,l=e.id.toString(),d={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:s,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in h)h.hasOwnProperty(n)&&(d.state[n]=h[n]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(d.icon=e.data.jstree.icon),e&&e.data&&(d.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(d.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(d.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(d.li_attr[n]=e.li_attr[n]);if(d.li_attr.id||(d.li_attr.id=l),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(d.a_attr[n]=e.a_attr[n]);for(e&&e.children&&!0===e.children&&(d.state.loaded=!1,d.children=[],d.children_d=[]),_[d.id]=d,n=0,a=d.children.length;n<a;n++)o=m(_[d.children[n]],d.id,s),r=_[o],d.children_d.push(o),r.children_d.length&&(d.children_d=d.children_d.concat(r.children_d));return delete e.data,delete e.children,_[d.id].original=e,d.state.selected&&c.push(d.id),d.id},v=function(e,i,s){s=s?s.concat():[],i&&s.unshift(i);var n,a,o,r,l,d=!1;do{d="j"+u+"_"+ ++p}while(_[d]);l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in h)h.hasOwnProperty(n)&&(l.state[n]=h[n]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),e&&e.data&&(l.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(l.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(l.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(l.li_attr[n]=e.li_attr[n]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=d),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(l.a_attr[n]=e.a_attr[n]);if(e&&e.children&&e.children.length){for(n=0,a=e.children.length;n<a;n++)o=v(e.children[n],l.id,s),r=_[o],l.children.push(o),r.children_d.length&&(l.children_d=l.children_d.concat(r.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,_[l.id]=l,l.state.selected&&c.push(l.id),l.id};if(o.length&&o[0].id!==t&&o[0].parent!==t){for(s=0,n=o.length;s<n;s++)o[s].children||(o[s].children=[]),_[o[s].id.toString()]=o[s];for(s=0,n=o.length;s<n;s++)_[o[s].parent.toString()].children.push(o[s].id.toString()),f.children_d.push(o[s].id.toString());for(s=0,n=f.children.length;s<n;s++)i=m(_[f.children[s]],r,f.parents.concat()),d.push(i),_[i].children_d.length&&(d=d.concat(_[i].children_d));for(s=0,n=f.parents.length;s<n;s++)_[f.parents[s]].children_d=_[f.parents[s]].children_d.concat(d);a={cnt:p,mod:_,sel:g,par:r,dpc:d,add:c}}else{for(s=0,n=o.length;s<n;s++)(i=v(o[s],r,f.parents.concat()))&&(l.push(i),d.push(i),_[i].children_d.length&&(d=d.concat(_[i].children_d)));for(f.children=l,f.children_d=d,s=0,n=f.parents.length;s<n;s++)_[f.parents[s]].children_d=_[f.parents[s]].children_d.concat(d);a={cnt:p,mod:_,sel:g,par:r,dpc:d,add:c}}return a},r=function(t,i){if(this._cnt=t.cnt,this._model.data=t.mod,i){var n,a,o=t.add,r=t.sel,l=this._data.core.selected.slice(),d=this._model.data;if(r.length!==l.length||e.vakata.array_unique(r.concat(l)).length!==r.length){for(n=0,a=r.length;n<a;n++)-1===e.inArray(r[n],o)&&-1===e.inArray(r[n],l)&&(d[r[n]].state.selected=!1);for(n=0,a=l.length;n<a;n++)-1===e.inArray(l[n],r)&&(d[l[n]].state.selected=!0)}}t.add.length&&(this._data.core.selected=this._data.core.selected.concat(t.add)),this.trigger("model",{nodes:t.dpc,parent:t.par}),"#"!==t.par?(this._node_changed(t.par),this.redraw()):this.redraw(!0),t.add.length&&this.trigger("changed",{action:"model",selected:this._data.core.selected}),s.call(this,!0)};if(this.settings.core.worker&&window.Blob&&window.URL&&window.Worker)try{null===this._wrk&&(this._wrk=window.URL.createObjectURL(new window.Blob(["self.onmessage = "+o.toString().replace(/return ([^;}]+)[\s;}]+$/,"postMessage($1);}")],{type:"text/javascript"}))),n=new window.Worker(this._wrk),n.onmessage=e.proxy(function(e){r.call(this,e.data,!0),this._data.core.working=!1,this._data.core.worker_queue.length&&this._append_json_data.apply(this,this._data.core.worker_queue.shift())},this),this._data.core.working?this._data.core.worker_queue.push([t,i,s]):(this._data.core.working=!0,n.postMessage(a))}catch(e){r.call(this,o(a),!1)}else r.call(this,o(a),!1)},_parse_model_from_html:function(t,i,s){s=s?[].concat(s):[],i&&s.unshift(i);var n,a,o,r,l,d=this._model.data,c={id:!1,text:!1,icon:!0,parent:i,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(o in this._model.default_state)this._model.default_state.hasOwnProperty(o)&&(c.state[o]=this._model.default_state[o]);if(r=e.vakata.attributes(t,!0),e.each(r,function(t,i){if(i=e.trim(i),!i.length)return!0;c.li_attr[t]=i,"id"===t&&(c.id=i.toString())}),r=t.children("a").eq(0),r.length&&(r=e.vakata.attributes(r,!0),e.each(r,function(t,i){i=e.trim(i),i.length&&(c.a_attr[t]=i)})),r=t.children("a:eq(0)").length?t.children("a:eq(0)").clone():t.clone(),r.children("ins, i, ul").remove(),r=r.html(),r=e("<div />").html(r),c.text=this.settings.core.force_text?r.text():r.html(),r=t.data(),c.data=r?e.extend(!0,{},r):null,c.state.opened=t.hasClass("jstree-open"),c.state.selected=t.children("a").hasClass("jstree-clicked"),c.state.disabled=t.children("a").hasClass("jstree-disabled"),c.data&&c.data.jstree)for(o in c.data.jstree)c.data.jstree.hasOwnProperty(o)&&(c.state[o]=c.data.jstree[o]);r=t.children("a").children(".jstree-themeicon"),r.length&&(c.icon=!r.hasClass("jstree-themeicon-hidden")&&r.attr("rel")),c.state.icon&&(c.icon=c.state.icon),r=t.children("ul").children("li");do{l="j"+this._id+"_"+ ++this._cnt}while(d[l]);return c.id=c.li_attr.id?c.li_attr.id.toString():l,r.length?(r.each(e.proxy(function(t,i){n=this._parse_model_from_html(e(i),c.id,s),a=this._model.data[n],c.children.push(n),a.children_d.length&&(c.children_d=c.children_d.concat(a.children_d))},this)),c.children_d=c.children_d.concat(c.children)):t.hasClass("jstree-closed")&&(c.state.loaded=!1),c.li_attr.class&&(c.li_attr.class=c.li_attr.class.replace("jstree-closed","").replace("jstree-open","")),c.a_attr.class&&(c.a_attr.class=c.a_attr.class.replace("jstree-clicked","").replace("jstree-disabled","")),d[c.id]=c,c.state.selected&&this._data.core.selected.push(c.id),c.id},_parse_model_from_flat_json:function(e,i,s){s=s?s.concat():[],i&&s.unshift(i);var n,a,o,r,l=e.id.toString(),d=this._model.data,c=this._model.default_state,h={id:l,text:e.text||"",icon:e.icon===t||e.icon,parent:i,parents:s,children:e.children||[],children_d:e.children_d||[],data:e.data,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in c)c.hasOwnProperty(n)&&(h.state[n]=c[n]);if(e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(h.icon=e.data.jstree.icon),e&&e.data&&(h.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(h.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(h.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(h.li_attr[n]=e.li_attr[n]);if(h.li_attr.id||(h.li_attr.id=l),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(h.a_attr[n]=e.a_attr[n]);for(e&&e.children&&!0===e.children&&(h.state.loaded=!1,h.children=[],h.children_d=[]),d[h.id]=h,n=0,a=h.children.length;n<a;n++)o=this._parse_model_from_flat_json(d[h.children[n]],h.id,s),r=d[o],h.children_d.push(o),r.children_d.length&&(h.children_d=h.children_d.concat(r.children_d));return delete e.data,delete e.children,d[h.id].original=e,h.state.selected&&this._data.core.selected.push(h.id),h.id},_parse_model_from_json:function(e,i,s){s=s?s.concat():[],i&&s.unshift(i);var n,a,o,r,l,d=!1,c=this._model.data,h=this._model.default_state;do{d="j"+this._id+"_"+ ++this._cnt}while(c[d]);l={id:!1,text:"string"==typeof e?e:"",icon:"object"!=typeof e||e.icon===t||e.icon,parent:i,parents:s,children:[],children_d:[],data:null,state:{},li_attr:{id:!1},a_attr:{href:"#"},original:!1};for(n in h)h.hasOwnProperty(n)&&(l.state[n]=h[n]);if(e&&e.id&&(l.id=e.id.toString()),e&&e.text&&(l.text=e.text),e&&e.data&&e.data.jstree&&e.data.jstree.icon&&(l.icon=e.data.jstree.icon),e&&e.data&&(l.data=e.data,e.data.jstree))for(n in e.data.jstree)e.data.jstree.hasOwnProperty(n)&&(l.state[n]=e.data.jstree[n]);if(e&&"object"==typeof e.state)for(n in e.state)e.state.hasOwnProperty(n)&&(l.state[n]=e.state[n]);if(e&&"object"==typeof e.li_attr)for(n in e.li_attr)e.li_attr.hasOwnProperty(n)&&(l.li_attr[n]=e.li_attr[n]);if(l.li_attr.id&&!l.id&&(l.id=l.li_attr.id.toString()),l.id||(l.id=d),l.li_attr.id||(l.li_attr.id=l.id),e&&"object"==typeof e.a_attr)for(n in e.a_attr)e.a_attr.hasOwnProperty(n)&&(l.a_attr[n]=e.a_attr[n]);if(e&&e.children&&e.children.length){for(n=0,a=e.children.length;n<a;n++)o=this._parse_model_from_json(e.children[n],l.id,s),r=c[o],l.children.push(o),r.children_d.length&&(l.children_d=l.children_d.concat(r.children_d));l.children_d=l.children_d.concat(l.children)}return e&&e.children&&!0===e.children&&(l.state.loaded=!1,l.children=[],l.children_d=[]),delete e.data,delete e.children,l.original=e,c[l.id]=l,l.state.selected&&this._data.core.selected.push(l.id),l.id},_redraw:function(){var e,t,i,s=this._model.force_full_redraw?this._model.data["#"].children.concat([]):this._model.changed.concat([]),n=document.createElement("UL");for(t=0,i=s.length;t<i;t++)(e=this.redraw_node(s[t],!0,this._model.force_full_redraw))&&this._model.force_full_redraw&&n.appendChild(e);this._model.force_full_redraw&&(n.className=this.get_container_ul()[0].className,this.element.empty().append(n)),this._model.force_full_redraw=!1,this._model.changed=[],this.trigger("redraw",{nodes:s})},redraw:function(e){e&&(this._model.force_full_redraw=!0),this._redraw()},redraw_node:function(t,i,s){var n=this.get_node(t),a=!1,o=!1,r=!1,l=!1,d=!1,c=!1,u="",p=document,_=this._model.data,f=!1,g=!1,m=null;if(!n)return!1;if("#"===n.id)return this.redraw(!0);if(i=i||0===n.children.length,t=document.querySelector?this.element[0].querySelector("#"+(-1!=="0123456789".indexOf(n.id[0])?"\\3"+n.id[0]+" "+n.id.substr(1).replace(e.jstree.idregex,"\\$&"):n.id.replace(e.jstree.idregex,"\\$&"))):document.getElementById(n.id))t=e(t),s||(a=t.parent().parent()[0],a===this.element[0]&&(a=null),o=t.index()),i||!n.children.length||t.children(".jstree-children").length||(i=!0),i||(r=t.children(".jstree-children")[0]),g=t.attr("aria-selected"),f=t.children(".jstree-anchor")[0]===document.activeElement,t.remove();else if(i=!0,!s){if(!(null===(a="#"!==n.parent?e("#"+n.parent.replace(e.jstree.idregex,"\\$&"),this.element)[0]:null)||a&&_[n.parent].state.opened))return!1;o=e.inArray(n.id,null===a?_["#"].children:_[n.parent].children)}t=h.cloneNode(!0),u="jstree-node ";for(l in n.li_attr)if(n.li_attr.hasOwnProperty(l)){if("id"===l)continue;"class"!==l?t.setAttribute(l,n.li_attr[l]):u+=n.li_attr[l]}g&&"false"!==g&&t.setAttribute("aria-selected",!0),n.state.loaded&&!n.children.length?u+=" jstree-leaf":(u+=n.state.opened&&n.state.loaded?" jstree-open":" jstree-closed",t.setAttribute("aria-expanded",n.state.opened&&n.state.loaded)),null!==n.parent&&_[n.parent].children[_[n.parent].children.length-1]===n.id&&(u+=" jstree-last"),t.id=n.id,t.className=u,u=(n.state.selected?" jstree-clicked":"")+(n.state.disabled?" jstree-disabled":"");for(d in n.a_attr)if(n.a_attr.hasOwnProperty(d)){if("href"===d&&"#"===n.a_attr[d])continue;"class"!==d?t.childNodes[1].setAttribute(d,n.a_attr[d]):u+=" "+n.a_attr[d]}if(u.length&&(t.childNodes[1].className="jstree-anchor "+u),(n.icon&&!0!==n.icon||!1===n.icon)&&(!1===n.icon?t.childNodes[1].childNodes[0].className+=" jstree-themeicon-hidden":-1===n.icon.indexOf("/")&&-1===n.icon.indexOf(".")?t.childNodes[1].childNodes[0].className+=" "+n.icon+" jstree-themeicon-custom":(t.childNodes[1].childNodes[0].style.backgroundImage="url("+n.icon+")",t.childNodes[1].childNodes[0].style.backgroundPosition="center center",t.childNodes[1].childNodes[0].style.backgroundSize="auto",t.childNodes[1].childNodes[0].className+=" jstree-themeicon-custom")),this.settings.core.force_text?t.childNodes[1].appendChild(p.createTextNode(n.text)):t.childNodes[1].innerHTML+=n.text,i&&n.children.length&&n.state.opened&&n.state.loaded){for(c=p.createElement("UL"),c.setAttribute("role","group"),c.className="jstree-children",l=0,d=n.children.length;l<d;l++)c.appendChild(this.redraw_node(n.children[l],i,!0));t.appendChild(c)}if(r&&t.appendChild(r),!s){for(a||(a=this.element[0]),l=0,d=a.childNodes.length;l<d;l++)if(a.childNodes[l]&&a.childNodes[l].className&&-1!==a.childNodes[l].className.indexOf("jstree-children")){m=a.childNodes[l];break}m||(m=p.createElement("UL"),m.setAttribute("role","group"),m.className="jstree-children",a.appendChild(m)),a=m,o<a.childNodes.length?a.insertBefore(t,a.childNodes[o]):a.appendChild(t),f&&t.childNodes[1].focus()}return n.state.opened&&!n.state.loaded&&(n.state.opened=!1,setTimeout(e.proxy(function(){this.open_node(n.id,!1,0)},this),0)),t},open_node:function(i,s,n){var a,o,r,l;if(e.isArray(i)){for(i=i.slice(),a=0,o=i.length;a<o;a++)this.open_node(i[a],s,n);return!0}if(!(i=this.get_node(i))||"#"===i.id)return!1;if(n=n===t?this.settings.core.animation:n,!this.is_closed(i))return s&&s.call(this,i,!1),!1;if(this.is_loaded(i))r=this.get_node(i,!0),l=this,r.length&&(i.children.length&&!this._firstChild(r.children(".jstree-children")[0])&&(i.state.opened=!0,this.redraw_node(i,!0),r=this.get_node(i,!0)),n?(this.trigger("before_open",{node:i}),r.children(".jstree-children").css("display","none").end().removeClass("jstree-closed").addClass("jstree-open").attr("aria-expanded",!0).children(".jstree-children").stop(!0,!0).slideDown(n,function(){this.style.display="",l.trigger("after_open",{node:i})})):(this.trigger("before_open",{node:i}),r[0].className=r[0].className.replace("jstree-closed","jstree-open"),r[0].setAttribute("aria-expanded",!0))),i.state.opened=!0,s&&s.call(this,i,!0),r.length||this.trigger("before_open",{node:i}),this.trigger("open_node",{node:i}),n&&r.length||this.trigger("after_open",{node:i});else{if(this.is_loading(i))return setTimeout(e.proxy(function(){this.open_node(i,s,n)},this),500);this.load_node(i,function(e,t){return t?this.open_node(e,s,n):!!s&&s.call(this,e,!1)})}},_open_to:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var i,s,n=t.parents;for(i=0,s=n.length;i<s;i+=1)"#"!==i&&this.open_node(n[i],!1,0);return e("#"+t.id.replace(e.jstree.idregex,"\\$&"),this.element)},close_node:function(i,s){var n,a,o,r;if(e.isArray(i)){for(i=i.slice(),n=0,a=i.length;n<a;n++)this.close_node(i[n],s);return!0}return!(!(i=this.get_node(i))||"#"===i.id)&&(!this.is_closed(i)&&(s=s===t?this.settings.core.animation:s,o=this,r=this.get_node(i,!0),r.length&&(s?r.children(".jstree-children").attr("style","display:block !important").end().removeClass("jstree-open").addClass("jstree-closed").attr("aria-expanded",!1).children(".jstree-children").stop(!0,!0).slideUp(s,function(){this.style.display="",r.children(".jstree-children").remove(),o.trigger("after_close",{node:i})}):(r[0].className=r[0].className.replace("jstree-open","jstree-closed"),r.attr("aria-expanded",!1).children(".jstree-children").remove())),i.state.opened=!1,this.trigger("close_node",{node:i}),void(s&&r.length||this.trigger("after_close",{node:i}))))},toggle_node:function(t){var i,s;if(e.isArray(t)){for(t=t.slice(),i=0,s=t.length;i<s;i++)this.toggle_node(t[i]);return!0}return this.is_closed(t)?this.open_node(t):this.is_open(t)?this.close_node(t):void 0},open_all:function(e,t,i){if(e||(e="#"),!(e=this.get_node(e)))return!1;var s,n,a,o="#"===e.id?this.get_container_ul():this.get_node(e,!0);if(!o.length){for(s=0,n=e.children_d.length;s<n;s++)this.is_closed(this._model.data[e.children_d[s]])&&(this._model.data[e.children_d[s]].state.opened=!0);return this.trigger("open_all",{node:e})}i=i||o,a=this,o=this.is_closed(e)?o.find(".jstree-closed").addBack():o.find(".jstree-closed"),o.each(function(){a.open_node(this,function(e,s){s&&this.is_parent(e)&&this.open_all(e,t,i)},t||0)}),0===i.find(".jstree-closed").length&&this.trigger("open_all",{node:this.get_node(i)})},close_all:function(t,i){if(t||(t="#"),!(t=this.get_node(t)))return!1;var s,n,a="#"===t.id?this.get_container_ul():this.get_node(t,!0),o=this;if(!a.length){for(s=0,n=t.children_d.length;s<n;s++)this._model.data[t.children_d[s]].state.opened=!1;return this.trigger("close_all",{node:t})}a=this.is_open(t)?a.find(".jstree-open").addBack():a.find(".jstree-open"),e(a.get().reverse()).each(function(){o.close_node(this,i||0)}),this.trigger("close_all",{node:t})},is_disabled:function(e){return(e=this.get_node(e))&&e.state&&e.state.disabled},enable_node:function(t){var i,s;if(e.isArray(t)){for(t=t.slice(),i=0,s=t.length;i<s;i++)this.enable_node(t[i]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;t.state.disabled=!1,this.get_node(t,!0).children(".jstree-anchor").removeClass("jstree-disabled"),this.trigger("enable_node",{node:t})},disable_node:function(t){var i,s;if(e.isArray(t)){for(t=t.slice(),i=0,s=t.length;i<s;i++)this.disable_node(t[i]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;t.state.disabled=!0,this.get_node(t,!0).children(".jstree-anchor").addClass("jstree-disabled"),this.trigger("disable_node",{node:t})},activate_node:function(e,i){if(this.is_disabled(e))return!1;if(this._data.core.last_clicked=this._data.core.last_clicked&&this._data.core.last_clicked.id!==t?this.get_node(this._data.core.last_clicked.id):null,this._data.core.last_clicked&&!this._data.core.last_clicked.state.selected&&(this._data.core.last_clicked=null),!this._data.core.last_clicked&&this._data.core.selected.length&&(this._data.core.last_clicked=this.get_node(this._data.core.selected[this._data.core.selected.length-1])),this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&(!i.shiftKey||this._data.core.last_clicked&&this.get_parent(e)&&this.get_parent(e)===this._data.core.last_clicked.parent))if(i.shiftKey){var s,n,a=this.get_node(e).id,o=this._data.core.last_clicked.id,r=this.get_node(this._data.core.last_clicked.parent).children,l=!1;for(s=0,n=r.length;s<n;s+=1)r[s]===a&&(l=!l),r[s]===o&&(l=!l),l||r[s]===a||r[s]===o?this.select_node(r[s],!1,!1,i):this.deselect_node(r[s],!1,i)}else this.is_selected(e)?this.deselect_node(e,!1,i):this.select_node(e,!1,!1,i);else!this.settings.core.multiple&&(i.metaKey||i.ctrlKey||i.shiftKey)&&this.is_selected(e)?this.deselect_node(e,!1,i):(this.deselect_all(!0),this.select_node(e,!1,!1,i),this._data.core.last_clicked=this.get_node(e));this.trigger("activate_node",{node:this.get_node(e)})},hover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||e.children(".jstree-hovered").length)return!1;var t=this.element.find(".jstree-hovered"),i=this.element;t&&t.length&&this.dehover_node(t),e.children(".jstree-anchor").addClass("jstree-hovered"),this.trigger("hover_node",{node:this.get_node(e)}),setTimeout(function(){i.attr("aria-activedescendant",e[0].id),e.attr("aria-selected",!0)},0)},dehover_node:function(e){if(!(e=this.get_node(e,!0))||!e.length||!e.children(".jstree-hovered").length)return!1;e.attr("aria-selected",!1).children(".jstree-anchor").removeClass("jstree-hovered"),this.trigger("dehover_node",{node:this.get_node(e)})},select_node:function(t,i,s,n){var a,o,r;if(e.isArray(t)){for(t=t.slice(),o=0,r=t.length;o<r;o++)this.select_node(t[o],i,s,n);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;a=this.get_node(t,!0),t.state.selected||(t.state.selected=!0,this._data.core.selected.push(t.id),s||(a=this._open_to(t)),a&&a.length&&a.children(".jstree-anchor").addClass("jstree-clicked"),this.trigger("select_node",{node:t,selected:this._data.core.selected,event:n}),i||this.trigger("changed",{action:"select_node",node:t,selected:this._data.core.selected,event:n}))},deselect_node:function(t,i,s){var n,a,o;if(e.isArray(t)){for(t=t.slice(),n=0,a=t.length;n<a;n++)this.deselect_node(t[n],i,s);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;o=this.get_node(t,!0),t.state.selected&&(t.state.selected=!1,this._data.core.selected=e.vakata.array_remove_item(this._data.core.selected,t.id),o.length&&o.children(".jstree-anchor").removeClass("jstree-clicked"),this.trigger("deselect_node",{node:t,selected:this._data.core.selected,event:s}),i||this.trigger("changed",{action:"deselect_node",node:t,selected:this._data.core.selected,event:s}))},select_all:function(e){var t,i,s=this._data.core.selected.concat([]);for(this._data.core.selected=this._model.data["#"].children_d.concat(),t=0,i=this._data.core.selected.length;t<i;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!0);this.redraw(!0),this.trigger("select_all",{selected:this._data.core.selected}),e||this.trigger("changed",{action:"select_all",selected:this._data.core.selected,old_selection:s})},deselect_all:function(e){var t,i,s=this._data.core.selected.concat([]);for(t=0,i=this._data.core.selected.length;t<i;t++)this._model.data[this._data.core.selected[t]]&&(this._model.data[this._data.core.selected[t]].state.selected=!1);this._data.core.selected=[],this.element.find(".jstree-clicked").removeClass("jstree-clicked"),this.trigger("deselect_all",{selected:this._data.core.selected,node:s}),e||this.trigger("changed",{action:"deselect_all",selected:this._data.core.selected,old_selection:s})},is_selected:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.state.selected},get_selected:function(t){return t?e.map(this._data.core.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.core.selected.slice()},get_top_selected:function(t){var i,s,n,a,o=this.get_selected(!0),r={};for(i=0,s=o.length;i<s;i++)r[o[i].id]=o[i];for(i=0,s=o.length;i<s;i++)for(n=0,a=o[i].children_d.length;n<a;n++)r[o[i].children_d[n]]&&delete r[o[i].children_d[n]];o=[];for(i in r)r.hasOwnProperty(i)&&o.push(i);return t?e.map(o,e.proxy(function(e){return this.get_node(e)},this)):o},get_bottom_selected:function(t){var i,s,n=this.get_selected(!0),a=[];for(i=0,s=n.length;i<s;i++)n[i].children.length||a.push(n[i].id);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a},get_state:function(){var e,t={core:{open:[],scroll:{left:this.element.scrollLeft(),top:this.element.scrollTop()},/*!
					'themes' : {
						'name' : this.get_theme(),
						'icons' : this._data.core.themes.icons,
						'dots' : this._data.core.themes.dots
					},
					*/
selected:[]}};for(e in this._model.data)this._model.data.hasOwnProperty(e)&&"#"!==e&&(this._model.data[e].state.opened&&t.core.open.push(e),this._model.data[e].state.selected&&t.core.selected.push(e));return t},set_state:function(i,s){if(i){if(i.core){var n,a,o,r;if(i.core.open)return e.isArray(i.core.open)?(n=!0,a=!1,o=this,e.each(i.core.open.concat([]),function(t,r){(a=o.get_node(r))&&(o.is_loaded(r)?(o.is_closed(r)&&o.open_node(r,!1,0),i&&i.core&&i.core.open&&e.vakata.array_remove_item(i.core.open,r)):(o.is_loading(r)||o.open_node(r,e.proxy(function(t,n){!n&&i&&i.core&&i.core.open&&e.vakata.array_remove_item(i.core.open,t.id),this.set_state(i,s)},o),0),n=!1))}),n&&(delete i.core.open,this.set_state(i,s)),!1):(delete i.core.open,this.set_state(i,s),!1);if(i.core.scroll)return i.core.scroll&&i.core.scroll.left!==t&&this.element.scrollLeft(i.core.scroll.left),i.core.scroll&&i.core.scroll.top!==t&&this.element.scrollTop(i.core.scroll.top),delete i.core.scroll,this.set_state(i,s),!1;/*!
					if(state.core.themes) {
						if(state.core.themes.name) {
							this.set_theme(state.core.themes.name);
						}
						if(typeof state.core.themes.dots !== 'undefined') {
							this[ state.core.themes.dots ? "show_dots" : "hide_dots" ]();
						}
						if(typeof state.core.themes.icons !== 'undefined') {
							this[ state.core.themes.icons ? "show_icons" : "hide_icons" ]();
						}
						delete state.core.themes;
						delete state.core.open;
						this.set_state(state, callback);
						return false;
					}
					*/
if(i.core.selected)return r=this,this.deselect_all(),e.each(i.core.selected,function(e,t){r.select_node(t)}),delete i.core.selected,this.set_state(i,s),!1;if(e.isEmptyObject(i.core))return delete i.core,this.set_state(i,s),!1}return!e.isEmptyObject(i)||(i=null,s&&s.call(this),this.trigger("set_state"),!1)}return!1},refresh:function(t,i){this._data.core.state=!0===i?{}:this.get_state(),i&&e.isFunction(i)&&(this._data.core.state=i.call(this,this._data.core.state)),this._cnt=0,this._model.data={"#":{id:"#",parent:null,parents:[],children:[],children_d:[],state:{loaded:!1}}};var s=this.get_container_ul()[0].className;t||this.element.html("<ul class='"+s+"'><li class='jstree-initial-node jstree-loading jstree-leaf jstree-last'><i class='jstree-icon jstree-ocl'></i><a class='jstree-anchor' href='#'><i class='jstree-icon jstree-themeicon-hidden'></i>"+this.get_string("Loading ...")+"</a></li></ul>"),this.load_node("#",function(t,i){i&&(this.get_container_ul()[0].className=s,this.set_state(e.extend(!0,{},this._data.core.state),function(){this.trigger("refresh")})),this._data.core.state=null})},refresh_node:function(t){if(!(t=this.get_node(t))||"#"===t.id)return!1;var i=[],s=[];this._data.core.selected.concat([]);s.push(t.id),!0===t.state.opened&&i.push(t.id),this.get_node(t,!0).find(".jstree-open").each(function(){i.push(this.id)}),this._load_nodes(s,e.proxy(function(e){this.open_node(i,!1,0),this.select_node(this._data.core.selected),this.trigger("refresh_node",{node:t,nodes:e})},this))},set_id:function(t,i){if(!(t=this.get_node(t))||"#"===t.id)return!1;var s,n,a=this._model.data;for(i=i.toString(),a[t.parent].children[e.inArray(t.id,a[t.parent].children)]=i,s=0,n=t.parents.length;s<n;s++)a[t.parents[s]].children_d[e.inArray(t.id,a[t.parents[s]].children_d)]=i;for(s=0,n=t.children.length;s<n;s++)a[t.children[s]].parent=i;for(s=0,n=t.children_d.length;s<n;s++)a[t.children_d[s]].parents[e.inArray(t.id,a[t.children_d[s]].parents)]=i;return s=e.inArray(t.id,this._data.core.selected),-1!==s&&(this._data.core.selected[s]=i),s=this.get_node(t.id,!0),s&&s.attr("id",i),delete a[t.id],t.id=i,a[i]=t,!0},get_text:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.text},set_text:function(t,i){var s,n;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;s<n;s++)this.set_text(t[s],i);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(t.text=i,this.get_node(t,!0).length&&this.redraw_node(t.id),this.trigger("set_text",{obj:t,text:i}),!0)},get_json:function(e,t,i){if(!(e=this.get_node(e||"#")))return!1;t&&t.flat&&!i&&(i=[]);var s,n,a={id:e.id,text:e.text,icon:this.get_icon(e),li_attr:e.li_attr,a_attr:e.a_attr,state:{},data:(!t||!t.no_data)&&e.data};if(t&&t.flat?a.parent=e.parent:a.children=[],!t||!t.no_state)for(s in e.state)e.state.hasOwnProperty(s)&&(a.state[s]=e.state[s]);if(t&&t.no_id&&(delete a.id,a.li_attr&&a.li_attr.id&&delete a.li_attr.id),t&&t.flat&&"#"!==e.id&&i.push(a),!t||!t.no_children)for(s=0,n=e.children.length;s<n;s++)t&&t.flat?this.get_json(e.children[s],t,i):a.children.push(this.get_json(e.children[s],t));return t&&t.flat?i:"#"===e.id?a.children:a},create_node:function(i,s,n,a,o){if(null===i&&(i="#"),!(i=this.get_node(i)))return!1;if(n=n===t?"last":n,!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(i))return this.load_node(i,function(){this.create_node(i,s,n,a,!0)});s||(s={text:this.get_string("New node")}),s.text===t&&(s.text=this.get_string("New node"));var r,l,d,c;switch("#"===i.id&&("before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":r=this.get_node(i.parent),n=e.inArray(i.id,r.children),i=r;break;case"after":r=this.get_node(i.parent),n=e.inArray(i.id,r.children)+1,i=r;break;case"inside":case"first":n=0;break;case"last":n=i.children.length;break;default:n||(n=0)}if(n>i.children.length&&(n=i.children.length),s.id||(s.id=!0),!this.check("create_node",s,i,n))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!0===s.id&&delete s.id,!(s=this._parse_model_from_json(s,i.id,i.parents.concat())))return!1;for(r=this.get_node(s),l=[],l.push(s),l=l.concat(r.children_d),this.trigger("model",{nodes:l,parent:i.id}),i.children_d=i.children_d.concat(l),d=0,c=i.parents.length;d<c;d++)this._model.data[i.parents[d]].children_d=this._model.data[i.parents[d]].children_d.concat(l);for(s=r,r=[],d=0,c=i.children.length;d<c;d++)r[d>=n?d+1:d]=i.children[d];return r[n]=s.id,i.children=r,this.redraw_node(i,!0),a&&a.call(this,this.get_node(s)),this.trigger("create_node",{node:this.get_node(s),parent:i.id,position:n}),s.id},rename_node:function(t,i){var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;s<n;s++)this.rename_node(t[s],i);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(a=t.text,this.check("rename_node",t,this.get_parent(t),i)?(this.set_text(t,i),this.trigger("rename_node",{node:t,text:i,old:a}),!0):(this.settings.core.error.call(this,this._data.core.last_error),!1))},delete_node:function(t){var i,s,n,a,o,r,l,d,c,h;if(e.isArray(t)){for(t=t.slice(),i=0,s=t.length;i<s;i++)this.delete_node(t[i]);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;if(n=this.get_node(t.parent),a=e.inArray(t.id,n.children),h=!1,!this.check("delete_node",t,n,a))return this.settings.core.error.call(this,this._data.core.last_error),!1;for(-1!==a&&(n.children=e.vakata.array_remove(n.children,a)),o=t.children_d.concat([]),o.push(t.id),d=0,c=o.length;d<c;d++){for(r=0,l=t.parents.length;r<l;r++)-1!==(a=e.inArray(o[d],this._model.data[t.parents[r]].children_d))&&(this._model.data[t.parents[r]].children_d=e.vakata.array_remove(this._model.data[t.parents[r]].children_d,a));this._model.data[o[d]].state.selected&&(h=!0,-1!==(a=e.inArray(o[d],this._data.core.selected))&&(this._data.core.selected=e.vakata.array_remove(this._data.core.selected,a)))}for(this.trigger("delete_node",{node:t,parent:n.id}),h&&this.trigger("changed",{action:"delete_node",node:t,selected:this._data.core.selected,parent:n.id}),d=0,c=o.length;d<c;d++)delete this._model.data[o[d]];return this.redraw_node(n,!0),!0},check:function(t,i,s,n,a){i=i&&i.id?i:this.get_node(i),s=s&&s.id?s:this.get_node(s);var o=t.match(/^move_node|copy_node|create_node$/i)?s:i,r=this.settings.core.check_callback;return"move_node"!==t&&"copy_node"!==t||a&&a.is_multi||i.id!==s.id&&e.inArray(i.id,s.children)!==n&&-1===e.inArray(s.id,i.children_d)?(o&&o.data&&(o=o.data),o&&o.functions&&(!1===o.functions[t]||!0===o.functions[t])?(!1===o.functions[t]&&(this._data.core.last_error={error:"check",plugin:"core",id:"core_02",reason:"Node data prevents function: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})}),o.functions[t]):!(!1===r||e.isFunction(r)&&!1===r.call(this,t,i,s,n,a)||r&&!1===r[t])||(this._data.core.last_error={error:"check",plugin:"core",id:"core_03",reason:"User config for core.check_callback prevents function: "+t,data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})},!1)):(this._data.core.last_error={error:"check",plugin:"core",id:"core_01",reason:"Moving parent inside child",data:JSON.stringify({chk:t,pos:n,obj:!(!i||!i.id)&&i.id,par:!(!s||!s.id)&&s.id})},!1)},last_error:function(){return this._data.core.last_error},move_node:function(i,s,n,a,o){var r,l,d,c,h,u,p,_,f,g,m,v,b,y;if(s=this.get_node(s),n=n===t?0:n,!s)return!1;if(!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(s))return this.load_node(s,function(){this.move_node(i,s,n,a,!0)});if(e.isArray(i)){for(i=i.reverse().slice(),r=0,l=i.length;r<l;r++)this.move_node(i[r],s,n,a,o);return!0}if(!(i=i&&i.id?i:this.get_node(i))||"#"===i.id)return!1;if(d=(i.parent||"#").toString(),h=n.toString().match(/^(before|after)$/)&&"#"!==s.id?this.get_node(s.parent):s,u=i.instance?i.instance:this._model.data[i.id]?this:e.jstree.reference(i.id),p=!u||!u._id||this._id!==u._id,c=u&&u._id&&d&&u._model.data[d]&&u._model.data[d].children?e.inArray(i.id,u._model.data[d].children):-1,p)return!!this.copy_node(i,s,n,a,o)&&(u&&u.delete_node(i),!0);switch("#"===h.id&&("before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":n=e.inArray(s.id,h.children);break;case"after":n=e.inArray(s.id,h.children)+1;break;case"inside":case"first":n=0;break;case"last":n=h.children.length;break;default:n||(n=0)}if(n>h.children.length&&(n=h.children.length),!this.check("move_node",i,h,n,{core:!0,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(i.parent===h.id){for(_=h.children.concat(),f=e.inArray(i.id,_),-1!==f&&(_=e.vakata.array_remove(_,f),n>f&&n--),f=[],g=0,m=_.length;g<m;g++)f[g>=n?g+1:g]=_[g];f[n]=i.id,h.children=f,this._node_changed(h.id),this.redraw("#"===h.id)}else{for(f=i.children_d.concat(),f.push(i.id),g=0,m=i.parents.length;g<m;g++){for(_=[],y=u._model.data[i.parents[g]].children_d,v=0,b=y.length;v<b;v++)-1===e.inArray(y[v],f)&&_.push(y[v]);u._model.data[i.parents[g]].children_d=_}for(u._model.data[d].children=e.vakata.array_remove_item(u._model.data[d].children,i.id),g=0,m=h.parents.length;g<m;g++)this._model.data[h.parents[g]].children_d=this._model.data[h.parents[g]].children_d.concat(f);for(_=[],g=0,m=h.children.length;g<m;g++)_[g>=n?g+1:g]=h.children[g];for(_[n]=i.id,h.children=_,h.children_d.push(i.id),h.children_d=h.children_d.concat(i.children_d),i.parent=h.id,f=h.parents.concat(),f.unshift(h.id),y=i.parents.length,i.parents=f,f=f.concat(),g=0,m=i.children_d.length;g<m;g++)this._model.data[i.children_d[g]].parents=this._model.data[i.children_d[g]].parents.slice(0,-1*y),Array.prototype.push.apply(this._model.data[i.children_d[g]].parents,f);this._node_changed(d),this._node_changed(h.id),this.redraw("#"===d||"#"===h.id)}return a&&a.call(this,i,h,n),this.trigger("move_node",{node:i,parent:h.id,position:n,old_parent:d,old_position:c,is_multi:u&&u._id&&u._id!==this._id,is_foreign:!u||!u._id,old_instance:u,new_instance:this}),!0},copy_node:function(i,s,n,a,o){var r,l,d,c,h,u,p,_,f,g;if(s=this.get_node(s),n=n===t?0:n,!s)return!1;if(!n.toString().match(/^(before|after)$/)&&!o&&!this.is_loaded(s))return this.load_node(s,function(){this.copy_node(i,s,n,a,!0)});if(e.isArray(i)){for(i=i.reverse().slice(),r=0,l=i.length;r<l;r++)this.copy_node(i[r],s,n,a,o);return!0}if(!(i=i&&i.id?i:this.get_node(i))||"#"===i.id)return!1;switch(_=(i.parent||"#").toString(),f=n.toString().match(/^(before|after)$/)&&"#"!==s.id?this.get_node(s.parent):s,g=i.instance?i.instance:this._model.data[i.id]?this:e.jstree.reference(i.id),!g||!g._id||this._id!==g._id,"#"===f.id&&("before"===n&&(n="first"),"after"===n&&(n="last")),n){case"before":n=e.inArray(s.id,f.children);break;case"after":n=e.inArray(s.id,f.children)+1;break;case"inside":case"first":n=0;break;case"last":n=f.children.length;break;default:n||(n=0)}if(n>f.children.length&&(n=f.children.length),!this.check("copy_node",i,f,n,{core:!0,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id}))return this.settings.core.error.call(this,this._data.core.last_error),!1;if(!(p=g?g.get_json(i,{no_id:!0,no_data:!0,no_state:!0}):i))return!1;if(!0===p.id&&delete p.id,!(p=this._parse_model_from_json(p,f.id,f.parents.concat())))return!1;for(c=this.get_node(p),i&&i.state&&!1===i.state.loaded&&(c.state.loaded=!1),d=[],d.push(p),d=d.concat(c.children_d),this.trigger("model",{nodes:d,parent:f.id}),h=0,u=f.parents.length;h<u;h++)this._model.data[f.parents[h]].children_d=this._model.data[f.parents[h]].children_d.concat(d);for(d=[],h=0,u=f.children.length;h<u;h++)d[h>=n?h+1:h]=f.children[h];return d[n]=c.id,f.children=d,f.children_d.push(c.id),f.children_d=f.children_d.concat(c.children_d),this._node_changed(f.id),this.redraw("#"===f.id),a&&a.call(this,c,f,n),this.trigger("copy_node",{node:c,original:i,parent:f.id,position:n,old_parent:_,old_position:g&&g._id&&_&&g._model.data[_]&&g._model.data[_].children?e.inArray(i.id,g._model.data[_].children):-1,is_multi:g&&g._id&&g._id!==this._id,is_foreign:!g||!g._id,old_instance:g,new_instance:this}),c.id},cut:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,s,n,l=[];for(s=0,n=t.length;s<n;s++)(i=this.get_node(t[s]))&&i.id&&"#"!==i.id&&l.push(i);if(!l.length)return!1;a=l,r=this,o="move_node",this.trigger("cut",{node:t})},copy:function(t){if(t||(t=this._data.core.selected.concat()),e.isArray(t)||(t=[t]),!t.length)return!1;var i,s,n,l=[];for(s=0,n=t.length;s<n;s++)(i=this.get_node(t[s]))&&i.id&&"#"!==i.id&&l.push(i);if(!l.length)return!1;a=l,r=this,o="copy_node",this.trigger("copy",{node:t})},get_buffer:function(){return{mode:o,node:a,inst:r}},can_paste:function(){return!1!==o&&!1!==a},paste:function(e,t){if(!((e=this.get_node(e))&&o&&o.match(/^(copy_node|move_node)$/)&&a))return!1;this[o](a,e,t)&&this.trigger("paste",{parent:e.id,node:a,mode:o}),a=!1,o=!1,r=!1},edit:function(t,i){if(!(t=this.get_node(t)))return!1;if(!1===this.settings.core.check_callback)return this._data.core.last_error={error:"check",plugin:"core",id:"core_07",reason:"Could not edit node because of check_callback"},this.settings.core.error.call(this,this._data.core.last_error),!1;i="string"==typeof i?i:t.text,this.set_text(t,""),t=this._open_to(t);var s=this._data.core.rtl,n=this.element.width(),a=t.children(".jstree-anchor"),o=e("<span>"),/*!
				oi = obj.children("i:visible"),
				ai = a.children("i:visible"),
				w1 = oi.width() * oi.length,
				w2 = ai.width() * ai.length,
				*/
r=i,l=e("<div />",{css:{position:"absolute",top:"-200px",left:s?"0px":"-1000px",visibility:"hidden"}}).appendTo("body"),d=e("<input />",{value:r,class:"jstree-rename-input",css:{padding:"0",border:"1px solid silver","box-sizing":"border-box",display:"inline-block",height:this._data.core.li_height+"px",lineHeight:this._data.core.li_height+"px",width:"150px"},blur:e.proxy(function(){var i=o.children(".jstree-rename-input"),s=i.val();""===s&&(s=r),l.remove(),o.replaceWith(a),o.remove(),this.set_text(t,r),!1===this.rename_node(t,e("<div></div>").text(s)[this.settings.core.force_text?"text":"html"]())&&this.set_text(t,r)},this),keydown:function(e){var t=e.which;27===t&&(this.value=r),27!==t&&13!==t&&37!==t&&38!==t&&39!==t&&40!==t&&32!==t||e.stopImmediatePropagation(),27!==t&&13!==t||(e.preventDefault(),this.blur())},click:function(e){e.stopImmediatePropagation()},mousedown:function(e){e.stopImmediatePropagation()},keyup:function(e){d.width(Math.min(l.text("pW"+this.value).width(),n))},keypress:function(e){if(13===e.which)return!1}}),c={fontFamily:a.css("fontFamily")||"",fontSize:a.css("fontSize")||"",fontWeight:a.css("fontWeight")||"",fontStyle:a.css("fontStyle")||"",fontStretch:a.css("fontStretch")||"",fontVariant:a.css("fontVariant")||"",letterSpacing:a.css("letterSpacing")||"",wordSpacing:a.css("wordSpacing")||""};o.attr("class",a.attr("class")).append(a.contents().clone()).append(d),a.replaceWith(o),l.css(c),d.css(c).width(Math.min(l.text("pW"+d[0].value).width(),n))[0].select()},set_theme:function(t,i){if(!t)return!1;if(!0===i){var s=this.settings.core.themes.dir;s||(s=e.jstree.path+"/themes"),i=s+"/"+t+"/style.css"}i&&-1===e.inArray(i,l)&&(e("head").append('<link rel="stylesheet" href="'+i+'" type="text/css" />'),l.push(i)),this._data.core.themes.name&&this.element.removeClass("jstree-"+this._data.core.themes.name),this._data.core.themes.name=t,this.element.addClass("jstree-"+t),this.element[this.settings.core.themes.responsive?"addClass":"removeClass"]("jstree-"+t+"-responsive"),this.trigger("set_theme",{theme:t})},get_theme:function(){return this._data.core.themes.name},set_theme_variant:function(e){this._data.core.themes.variant&&this.element.removeClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant),this._data.core.themes.variant=e,e&&this.element.addClass("jstree-"+this._data.core.themes.name+"-"+this._data.core.themes.variant)},get_theme_variant:function(){return this._data.core.themes.variant},show_stripes:function(){this._data.core.themes.stripes=!0,this.get_container_ul().addClass("jstree-striped")},hide_stripes:function(){this._data.core.themes.stripes=!1,this.get_container_ul().removeClass("jstree-striped")},toggle_stripes:function(){this._data.core.themes.stripes?this.hide_stripes():this.show_stripes()},show_dots:function(){this._data.core.themes.dots=!0,this.get_container_ul().removeClass("jstree-no-dots")},hide_dots:function(){this._data.core.themes.dots=!1,this.get_container_ul().addClass("jstree-no-dots")},toggle_dots:function(){this._data.core.themes.dots?this.hide_dots():this.show_dots()},show_icons:function(){this._data.core.themes.icons=!0,this.get_container_ul().removeClass("jstree-no-icons")},hide_icons:function(){this._data.core.themes.icons=!1,this.get_container_ul().addClass("jstree-no-icons")},toggle_icons:function(){this._data.core.themes.icons?this.hide_icons():this.show_icons()},set_icon:function(t,i){var s,n,a,o;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;s<n;s++)this.set_icon(t[s],i);return!0}return!(!(t=this.get_node(t))||"#"===t.id)&&(o=t.icon,t.icon=i,a=this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon"),!1===i?this.hide_icon(t):!0===i?a.removeClass("jstree-themeicon-custom "+o).css("background","").removeAttr("rel"):-1===i.indexOf("/")&&-1===i.indexOf(".")?(a.removeClass(o).css("background",""),a.addClass(i+" jstree-themeicon-custom").attr("rel",i)):(a.removeClass(o).css("background",""),a.addClass("jstree-themeicon-custom").css("background","url('"+i+"') center center no-repeat").attr("rel",i)),!0)},get_icon:function(e){return!(!(e=this.get_node(e))||"#"===e.id)&&e.icon},hide_icon:function(t){var i,s;if(e.isArray(t)){for(t=t.slice(),i=0,s=t.length;i<s;i++)this.hide_icon(t[i]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(t.icon=!1,this.get_node(t,!0).children(".jstree-anchor").children(".jstree-themeicon").addClass("jstree-themeicon-hidden"),!0)},show_icon:function(t){var i,s,n;if(e.isArray(t)){for(t=t.slice(),i=0,s=t.length;i<s;i++)this.show_icon(t[i]);return!0}return!(!(t=this.get_node(t))||"#"===t)&&(n=this.get_node(t,!0),t.icon=!n.length||n.children(".jstree-anchor").children(".jstree-themeicon").attr("rel"),t.icon||(t.icon=!0),n.children(".jstree-anchor").children(".jstree-themeicon").removeClass("jstree-themeicon-hidden"),!0)}},e.vakata={},e.vakata.attributes=function(t,i){t=e(t)[0];var s=i?{}:[];return t&&t.attributes&&e.each(t.attributes,function(t,n){-1===e.inArray(n.nodeName.toLowerCase(),["style","contenteditable","hasfocus","tabindex"])&&null!==n.nodeValue&&""!==e.trim(n.nodeValue)&&(i?s[n.nodeName]=n.nodeValue:s.push(n.nodeName))}),s},e.vakata.array_unique=function(e){var t,i,s,n=[];for(t=0,s=e.length;t<s;t++){for(i=0;i<=t&&e[t]!==e[i];i++);i===t&&n.push(e[t])}return n},e.vakata.array_remove=function(e,t,i){var s=e.slice((i||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,s),e},e.vakata.array_remove_item=function(t,i){var s=e.inArray(i,t);return-1!==s?e.vakata.array_remove(t,s):t};var u=document.createElement("I");u.className="jstree-icon jstree-checkbox",e.jstree.defaults.checkbox={visible:!0,three_state:!0,whole_node:!0,keep_selected_style:!0,cascade:"",tie_selection:!0},e.jstree.plugins.checkbox=function(t,i){this.bind=function(){i.bind.call(this),this._data.checkbox.uto=!1,this._data.checkbox.selected=[],this.settings.checkbox.three_state&&(this.settings.checkbox.cascade="up+down+undetermined"),this.element.on("init.jstree",e.proxy(function(){this._data.checkbox.visible=this.settings.checkbox.visible,this.settings.checkbox.keep_selected_style||this.element.addClass("jstree-checkbox-no-clicked"),this.settings.checkbox.tie_selection&&this.element.addClass("jstree-checkbox-selection")},this)).on("loading.jstree",e.proxy(function(){this[this._data.checkbox.visible?"show_checkboxes":"hide_checkboxes"]()},this)),-1!==this.settings.checkbox.cascade.indexOf("undetermined")&&this.element.on("changed.jstree uncheck_node.jstree check_node.jstree uncheck_all.jstree check_all.jstree move_node.jstree copy_node.jstree redraw.jstree open_node.jstree",e.proxy(function(){this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)},this)),this.settings.checkbox.tie_selection||this.element.on("model.jstree",e.proxy(function(e,t){var i,s,n=this._model.data,a=(n[t.parent],t.nodes);for(i=0,s=a.length;i<s;i++)n[a[i]].state.checked=n[a[i]].original&&n[a[i]].original.state&&n[a[i]].original.state.checked,n[a[i]].state.checked&&this._data.checkbox.selected.push(a[i])},this)),-1===this.settings.checkbox.cascade.indexOf("up")&&-1===this.settings.checkbox.cascade.indexOf("down")||this.element.on("model.jstree",e.proxy(function(t,i){var s,n,a,o,r,l,d=this._model.data,c=d[i.parent],h=i.nodes,u=[],p=this.settings.checkbox.cascade,_=this.settings.checkbox.tie_selection;if(-1!==p.indexOf("down"))if(c.state[_?"selected":"checked"]){for(n=0,a=h.length;n<a;n++)d[h[n]].state[_?"selected":"checked"]=!0;this._data[_?"core":"checkbox"].selected=this._data[_?"core":"checkbox"].selected.concat(h)}else for(n=0,a=h.length;n<a;n++)if(d[h[n]].state[_?"selected":"checked"]){for(o=0,r=d[h[n]].children_d.length;o<r;o++)d[d[h[n]].children_d[o]].state[_?"selected":"checked"]=!0;this._data[_?"core":"checkbox"].selected=this._data[_?"core":"checkbox"].selected.concat(d[h[n]].children_d)}if(-1!==p.indexOf("up")){for(n=0,a=c.children_d.length;n<a;n++)d[c.children_d[n]].children.length||u.push(d[c.children_d[n]].parent);for(u=e.vakata.array_unique(u),o=0,r=u.length;o<r;o++)for(c=d[u[o]];c&&"#"!==c.id;){for(s=0,n=0,a=c.children.length;n<a;n++)s+=d[c.children[n]].state[_?"selected":"checked"];if(s!==a)break;c.state[_?"selected":"checked"]=!0,this._data[_?"core":"checkbox"].selected.push(c.id),(l=this.get_node(c,!0))&&l.length&&l.children(".jstree-anchor").addClass(_?"jstree-clicked":"jstree-checked"),c=this.get_node(c.parent)}}this._data[_?"core":"checkbox"].selected=e.vakata.array_unique(this._data[_?"core":"checkbox"].selected)},this)).on(this.settings.checkbox.tie_selection?"select_node.jstree":"check_node.jstree",e.proxy(function(t,i){var s,n,a,o,r=i.node,l=this._model.data,d=this.get_node(r.parent),c=this.get_node(r,!0),h=this.settings.checkbox.cascade,u=this.settings.checkbox.tie_selection;if(-1!==h.indexOf("down"))for(this._data[u?"core":"checkbox"].selected=e.vakata.array_unique(this._data[u?"core":"checkbox"].selected.concat(r.children_d)),s=0,n=r.children_d.length;s<n;s++)o=l[r.children_d[s]],o.state[u?"selected":"checked"]=!0,o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1);if(-1!==h.indexOf("up"))for(;d&&"#"!==d.id;){for(a=0,s=0,n=d.children.length;s<n;s++)a+=l[d.children[s]].state[u?"selected":"checked"];if(a!==n)break;d.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(d.id),(o=this.get_node(d,!0))&&o.length&&o.children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),d=this.get_node(d.parent)}-1!==h.indexOf("down")&&c.length&&c.find(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked")},this)).on(this.settings.checkbox.tie_selection?"deselect_all.jstree":"uncheck_all.jstree",e.proxy(function(e,t){var i,s,n,a=this.get_node("#"),o=this._model.data;for(i=0,s=a.children_d.length;i<s;i++)(n=o[a.children_d[i]])&&n.original&&n.original.state&&n.original.state.undetermined&&(n.original.state.undetermined=!1)},this)).on(this.settings.checkbox.tie_selection?"deselect_node.jstree":"uncheck_node.jstree",e.proxy(function(t,i){var s,n,a,o=i.node,r=this.get_node(o,!0),l=this.settings.checkbox.cascade,d=this.settings.checkbox.tie_selection;if(o&&o.original&&o.original.state&&o.original.state.undetermined&&(o.original.state.undetermined=!1),-1!==l.indexOf("down"))for(s=0,n=o.children_d.length;s<n;s++)a=this._model.data[o.children_d[s]],a.state[d?"selected":"checked"]=!1,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1);if(-1!==l.indexOf("up"))for(s=0,n=o.parents.length;s<n;s++)a=this._model.data[o.parents[s]],a.state[d?"selected":"checked"]=!1,a&&a.original&&a.original.state&&a.original.state.undetermined&&(a.original.state.undetermined=!1),(a=this.get_node(o.parents[s],!0))&&a.length&&a.children(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked");for(a=[],s=0,n=this._data[d?"core":"checkbox"].selected.length;s<n;s++)-1!==l.indexOf("down")&&-1!==e.inArray(this._data[d?"core":"checkbox"].selected[s],o.children_d)||-1!==l.indexOf("up")&&-1!==e.inArray(this._data[d?"core":"checkbox"].selected[s],o.parents)||a.push(this._data[d?"core":"checkbox"].selected[s]);this._data[d?"core":"checkbox"].selected=e.vakata.array_unique(a),-1!==l.indexOf("down")&&r.length&&r.find(".jstree-anchor").removeClass(d?"jstree-clicked":"jstree-checked")},this)),-1!==this.settings.checkbox.cascade.indexOf("up")&&this.element.on("delete_node.jstree",e.proxy(function(e,t){for(var i,s,n,a,o=this.get_node(t.parent),r=this._model.data,l=this.settings.checkbox.tie_selection;o&&"#"!==o.id;){for(n=0,i=0,s=o.children.length;i<s;i++)n+=r[o.children[i]].state[l?"selected":"checked"];if(n!==s)break;o.state[l?"selected":"checked"]=!0,this._data[l?"core":"checkbox"].selected.push(o.id),(a=this.get_node(o,!0))&&a.length&&a.children(".jstree-anchor").addClass(l?"jstree-clicked":"jstree-checked"),o=this.get_node(o.parent)}},this)).on("move_node.jstree",e.proxy(function(t,i){var s,n,a,o,r,l=i.is_multi,d=i.old_parent,c=this.get_node(i.parent),h=this._model.data,u=this.settings.checkbox.tie_selection;if(!l)for(s=this.get_node(d);s&&"#"!==s.id;){for(n=0,a=0,o=s.children.length;a<o;a++)n+=h[s.children[a]].state[u?"selected":"checked"];if(n!==o)break;s.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(s.id),(r=this.get_node(s,!0))&&r.length&&r.children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"),s=this.get_node(s.parent)}for(s=c;s&&"#"!==s.id;){for(n=0,a=0,o=s.children.length;a<o;a++)n+=h[s.children[a]].state[u?"selected":"checked"];if(n===o)s.state[u?"selected":"checked"]||(s.state[u?"selected":"checked"]=!0,this._data[u?"core":"checkbox"].selected.push(s.id),(r=this.get_node(s,!0))&&r.length&&r.children(".jstree-anchor").addClass(u?"jstree-clicked":"jstree-checked"));else{if(!s.state[u?"selected":"checked"])break;s.state[u?"selected":"checked"]=!1,this._data[u?"core":"checkbox"].selected=e.vakata.array_remove_item(this._data[u?"core":"checkbox"].selected,s.id),(r=this.get_node(s,!0))&&r.length&&r.children(".jstree-anchor").removeClass(u?"jstree-clicked":"jstree-checked")}s=this.get_node(s.parent)}},this))},this._undetermined=function(){var t,i,s=this._model.data,n=this.settings.checkbox.tie_selection,a=this._data[n?"core":"checkbox"].selected,o=[],r=this;for(t=0,i=a.length;t<i;t++)s[a[t]]&&s[a[t]].parents&&(o=o.concat(s[a[t]].parents));for(this.element.find(".jstree-closed").not(":has(.jstree-children)").each(function(){var e,n=r.get_node(this);if(n.state.loaded)for(t=0,i=n.children_d.length;t<i;t++)e=s[n.children_d[t]],!e.state.loaded&&e.original&&e.original.state&&e.original.state.undetermined&&!0===e.original.state.undetermined&&(o.push(e.id),o=o.concat(e.parents));else n.original&&n.original.state&&n.original.state.undetermined&&!0===n.original.state.undetermined&&(o.push(n.id),o=o.concat(n.parents))}),o=e.vakata.array_unique(o),o=e.vakata.array_remove_item(o,"#"),this.element.find(".jstree-undetermined").removeClass("jstree-undetermined"),t=0,i=o.length;t<i;t++)s[o[t]].state[n?"selected":"checked"]||(a=this.get_node(o[t],!0))&&a.length&&a.children(".jstree-anchor").children(".jstree-checkbox").addClass("jstree-undetermined")},this.redraw_node=function(t,s,n){if(t=i.redraw_node.call(this,t,s,n)){var a,o,r=null;for(a=0,o=t.childNodes.length;a<o;a++)if(t.childNodes[a]&&t.childNodes[a].className&&-1!==t.childNodes[a].className.indexOf("jstree-anchor")){r=t.childNodes[a];break}r&&(!this.settings.checkbox.tie_selection&&this._model.data[t.id].state.checked&&(r.className+=" jstree-checked"),r.insertBefore(u.cloneNode(!1),r.childNodes[0]))}return n||-1===this.settings.checkbox.cascade.indexOf("undetermined")||(this._data.checkbox.uto&&clearTimeout(this._data.checkbox.uto),this._data.checkbox.uto=setTimeout(e.proxy(this._undetermined,this),50)),t},this.show_checkboxes=function(){this._data.core.themes.checkboxes=!0,this.get_container_ul().removeClass("jstree-no-checkboxes")},this.hide_checkboxes=function(){this._data.core.themes.checkboxes=!1,this.get_container_ul().addClass("jstree-no-checkboxes")},this.toggle_checkboxes=function(){this._data.core.themes.checkboxes?this.hide_checkboxes():this.show_checkboxes()},this.is_undetermined=function(t){t=this.get_node(t);var i,s,n=this.settings.checkbox.cascade,a=this.settings.checkbox.tie_selection,o=this._data[a?"core":"checkbox"].selected,r=this._model.data;if(!t||!0===t.state[a?"selected":"checked"]||-1===n.indexOf("undetermined")||-1===n.indexOf("down")&&-1===n.indexOf("up"))return!1;if(!t.state.loaded&&!0===t.original.state.undetermined)return!0;for(i=0,s=t.children_d.length;i<s;i++)if(-1!==e.inArray(t.children_d[i],o)||!r[t.children_d[i]].state.loaded&&r[t.children_d[i]].original.state.undetermined)return!0;return!1},this.activate_node=function(t,s){if(this.settings.checkbox.tie_selection&&(this.settings.checkbox.whole_node||e(s.target).hasClass("jstree-checkbox"))&&(s.ctrlKey=!0),this.settings.checkbox.tie_selection||!this.settings.checkbox.whole_node&&!e(s.target).hasClass("jstree-checkbox"))return i.activate_node.call(this,t,s);this.is_checked(t)?this.uncheck_node(t,s):this.check_node(t,s),this.trigger("activate_node",{node:this.get_node(t)})},this.check_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.select_node(t,!1,!0,i);var s,n,a;if(e.isArray(t)){for(t=t.slice(),n=0,a=t.length;n<a;n++)this.check_node(t[n],i);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;s=this.get_node(t,!0),t.state.checked||(t.state.checked=!0,this._data.checkbox.selected.push(t.id),s&&s.length&&s.children(".jstree-anchor").addClass("jstree-checked"),this.trigger("check_node",{node:t,selected:this._data.checkbox.selected,event:i}))},this.uncheck_node=function(t,i){if(this.settings.checkbox.tie_selection)return this.deselect_node(t,!1,i);var s,n,a;if(e.isArray(t)){for(t=t.slice(),s=0,n=t.length;s<n;s++)this.uncheck_node(t[s],i);return!0}if(!(t=this.get_node(t))||"#"===t.id)return!1;a=this.get_node(t,!0),t.state.checked&&(t.state.checked=!1,this._data.checkbox.selected=e.vakata.array_remove_item(this._data.checkbox.selected,t.id),a.length&&a.children(".jstree-anchor").removeClass("jstree-checked"),this.trigger("uncheck_node",{node:t,selected:this._data.checkbox.selected,event:i}))},this.check_all=function(){if(this.settings.checkbox.tie_selection)return this.select_all();var e,t;this._data.checkbox.selected.concat([]);for(this._data.checkbox.selected=this._model.data["#"].children_d.concat(),e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!0);this.redraw(!0),this.trigger("check_all",{selected:this._data.checkbox.selected})},this.uncheck_all=function(){if(this.settings.checkbox.tie_selection)return this.deselect_all();var e,t,i=this._data.checkbox.selected.concat([]);for(e=0,t=this._data.checkbox.selected.length;e<t;e++)this._model.data[this._data.checkbox.selected[e]]&&(this._model.data[this._data.checkbox.selected[e]].state.checked=!1);this._data.checkbox.selected=[],this.element.find(".jstree-checked").removeClass("jstree-checked"),this.trigger("uncheck_all",{selected:this._data.checkbox.selected,node:i})},this.is_checked=function(e){return this.settings.checkbox.tie_selection?this.is_selected(e):!(!(e=this.get_node(e))||"#"===e.id)&&e.state.checked},this.get_checked=function(t){return this.settings.checkbox.tie_selection?this.get_selected(t):t?e.map(this._data.checkbox.selected,e.proxy(function(e){return this.get_node(e)},this)):this._data.checkbox.selected},this.get_top_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_top_selected(t);var i,s,n,a,o=this.get_checked(!0),r={};for(i=0,s=o.length;i<s;i++)r[o[i].id]=o[i];for(i=0,s=o.length;i<s;i++)for(n=0,a=o[i].children_d.length;n<a;n++)r[o[i].children_d[n]]&&delete r[o[i].children_d[n]];o=[];for(i in r)r.hasOwnProperty(i)&&o.push(i);return t?e.map(o,e.proxy(function(e){return this.get_node(e)},this)):o},this.get_bottom_checked=function(t){if(this.settings.checkbox.tie_selection)return this.get_bottom_selected(t);var i,s,n=this.get_checked(!0),a=[];for(i=0,s=n.length;i<s;i++)n[i].children.length||a.push(n[i].id);return t?e.map(a,e.proxy(function(e){return this.get_node(e)},this)):a}},e.jstree.defaults.contextmenu={select_node:!0,show_at_node:!0,items:function(t,i){return{create:{separator_before:!1,separator_after:!0,_disabled:!1,label:"Create",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.create_node(s,{},"last",function(e){setTimeout(function(){i.edit(e)},0)})}},rename:{separator_before:!1,separator_after:!1,_disabled:!1,label:"Rename",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.edit(s)}},remove:{separator_before:!1,icon:!1,separator_after:!1,_disabled:!1,label:"Delete",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.is_selected(s)?i.delete_node(i.get_selected()):i.delete_node(s)}},ccp:{separator_before:!0,icon:!1,separator_after:!1,label:"Edit",action:!1,submenu:{cut:{separator_before:!1,separator_after:!1,label:"Cut",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.is_selected(s)?i.cut(i.get_selected()):i.cut(s)}},copy:{separator_before:!1,icon:!1,separator_after:!1,label:"Copy",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.is_selected(s)?i.copy(i.get_selected()):i.copy(s)}},paste:{separator_before:!1,icon:!1,_disabled:function(t){return!e.jstree.reference(t.reference).can_paste()},separator_after:!1,label:"Paste",action:function(t){var i=e.jstree.reference(t.reference),s=i.get_node(t.reference);i.paste(s)}}}}}}},e.jstree.plugins.contextmenu=function(i,s){this.bind=function(){s.bind.call(this);var t=0;this.element.on("contextmenu.jstree",".jstree-anchor",e.proxy(function(e){e.preventDefault(),t=e.ctrlKey?e.timeStamp:0,this.is_loading(e.currentTarget)||this.show_contextmenu(e.currentTarget,e.pageX,e.pageY,e)},this)).on("click.jstree",".jstree-anchor",e.proxy(function(i){this._data.contextmenu.visible&&(!t||i.timeStamp-t>250)&&e.vakata.context.hide()},this)),e(document).on("context_hide.vakata",e.proxy(function(){this._data.contextmenu.visible=!1},this))},this.teardown=function(){this._data.contextmenu.visible&&e.vakata.context.hide(),s.teardown.call(this)},this.show_contextmenu=function(i,s,n,a){if(!(i=this.get_node(i))||"#"===i.id)return!1;var o=this.settings.contextmenu,r=this.get_node(i,!0),l=r.children(".jstree-anchor"),d=!1,c=!1;(o.show_at_node||s===t||n===t)&&(d=l.offset(),s=d.left,n=d.top+this._data.core.li_height),this.settings.contextmenu.select_node&&!this.is_selected(i)&&this.activate_node(i,a),c=o.items,e.isFunction(c)&&(c=c.call(this,i,e.proxy(function(e){this._show_contextmenu(i,s,n,e)},this))),e.isPlainObject(c)&&this._show_contextmenu(i,s,n,c)},this._show_contextmenu=function(t,i,s,n){var a=this.get_node(t,!0),o=a.children(".jstree-anchor");e(document).one("context_show.vakata",e.proxy(function(t,i){var s="jstree-contextmenu jstree-"+this.get_theme()+"-contextmenu";e(i.element).addClass(s)},this)),this._data.contextmenu.visible=!0,e.vakata.context.show(o,{x:i,y:s},n),this.trigger("show_contextmenu",{node:t,x:i,y:s})}},function(e){var t=!1,i={element:!1,reference:!1,position_x:0,position_y:0,items:[],html:"",is_visible:!1};e.vakata.context={settings:{hide_onmouseleave:0,icons:!0},_trigger:function(t){e(document).triggerHandler("context_"+t+".vakata",{reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_execute:function(t){return!(!(t=i.items[t])||t._disabled&&(!e.isFunction(t._disabled)||t._disabled({item:t,reference:i.reference,element:i.element}))||!t.action)&&t.action.call(null,{item:t,reference:i.reference,element:i.element,position:{x:i.position_x,y:i.position_y}})},_parse:function(t,s){if(!t)return!1;s||(i.html="",i.items=[]);var n,a="",o=!1;return s&&(a+="<ul>"),e.each(t,function(t,s){if(!s)return!0;i.items.push(s),!o&&s.separator_before&&(a+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>"),o=!1,a+="<li class='"+(s._class||"")+(!0===s._disabled||e.isFunction(s._disabled)&&s._disabled({item:s,reference:i.reference,element:i.element})?" vakata-contextmenu-disabled ":"")+"' "+(s.shortcut?" data-shortcut='"+s.shortcut+"' ":"")+">",a+="<a href='#' rel='"+(i.items.length-1)+"'>",e.vakata.context.settings.icons&&(a+="<i ",s.icon&&(-1!==s.icon.indexOf("/")||-1!==s.icon.indexOf(".")?a+=" style='background:url(\""+s.icon+"\") center center no-repeat' ":a+=" class='"+s.icon+"' "),a+="></i><span class='vakata-contextmenu-sep'>&#160;</span>"),a+=(e.isFunction(s.label)?s.label({item:t,reference:i.reference,element:i.element}):s.label)+(s.shortcut?' <span class="vakata-contextmenu-shortcut vakata-contextmenu-shortcut-'+s.shortcut+'">'+(s.shortcut_label||"")+"</span>":"")+"</a>",s.submenu&&(n=e.vakata.context._parse(s.submenu,!0))&&(a+=n),a+="</li>",s.separator_after&&(a+="<li class='vakata-context-separator'><a href='#' "+(e.vakata.context.settings.icons?"":'style="margin-left:0px;"')+">&#160;</a></li>",o=!0)}),a=a.replace(/<li class\='vakata-context-separator'\><\/li\>$/,""),s&&(a+="</ul>"),s||(i.html=a,e.vakata.context._trigger("parse")),a.length>10&&a},_show_submenu:function(i){if(i=e(i),i.length&&i.children("ul").length){var s=i.children("ul"),n=i.offset().left+i.outerWidth(),a=i.offset().top,o=s.width(),r=s.height(),l=e(window).width()+e(window).scrollLeft(),d=e(window).height()+e(window).scrollTop();t?i[n-(o+10+i.outerWidth())<0?"addClass":"removeClass"]("vakata-context-left"):i[n+o+10>l?"addClass":"removeClass"]("vakata-context-right"),a+r+10>d&&s.css("bottom","-1px"),s.show()}},show:function(s,n,a){var o,r,l,d,c,h,u,p;switch(i.element&&i.element.length&&i.element.width(""),!0){case!n&&!s:return!1;case!!n&&!!s:i.reference=s,i.position_x=n.x,i.position_y=n.y;break;case!n&&!!s:i.reference=s,o=s.offset(),i.position_x=o.left+s.outerHeight(),i.position_y=o.top;break;case!!n&&!s:i.position_x=n.x,i.position_y=n.y}s&&!a&&e(s).data("vakata_contextmenu")&&(a=e(s).data("vakata_contextmenu")),e.vakata.context._parse(a)&&i.element.html(i.html),i.items.length&&(r=i.element,l=i.position_x,d=i.position_y,c=r.width(),h=r.height(),u=e(window).width()+e(window).scrollLeft(),p=e(window).height()+e(window).scrollTop(),t&&(l-=r.outerWidth())<e(window).scrollLeft()+20&&(l=e(window).scrollLeft()+20),l+c+20>u&&(l=u-(c+20)),d+h+20>p&&(d=p-(h+20)),i.element.css({left:l,top:d}).show().find("a:eq(0)").focus().parent().addClass("vakata-context-hover"),i.is_visible=!0,e.vakata.context._trigger("show"))},hide:function(){i.is_visible&&(i.element.hide().find("ul").hide().end().find(":focus").blur(),i.is_visible=!1,e.vakata.context._trigger("hide"))}},e(function(){t="rtl"===e("body").css("direction");var s=!1;i.element=e("<ul class='vakata-context'></ul>"),i.element.on("mouseenter","li",function(t){t.stopImmediatePropagation(),e.contains(this,t.relatedTarget)||(s&&clearTimeout(s),i.element.find(".vakata-context-hover").removeClass("vakata-context-hover").end(),e(this).siblings().find("ul").hide().end().end().parentsUntil(".vakata-context","li").addBack().addClass("vakata-context-hover"),e.vakata.context._show_submenu(this))}).on("mouseleave","li",function(t){e.contains(this,t.relatedTarget)||e(this).find(".vakata-context-hover").addBack().removeClass("vakata-context-hover")}).on("mouseleave",function(t){e(this).find(".vakata-context-hover").removeClass("vakata-context-hover"),e.vakata.context.settings.hide_onmouseleave&&(s=setTimeout(function(t){return function(){e.vakata.context.hide()}}(),e.vakata.context.settings.hide_onmouseleave))}).on("click","a",function(t){t.preventDefault(),e(this).blur().parent().hasClass("vakata-context-disabled")||!1===e.vakata.context._execute(e(this).attr("rel"))||e.vakata.context.hide()}).on("keydown","a",function(t){var s=null;switch(t.which){case 13:case 32:t.type="mouseup",t.preventDefault(),e(t.currentTarget).trigger(t);break;case 37:i.is_visible&&(i.element.find(".vakata-context-hover").last().parents("li:eq(0)").find("ul").hide().find(".vakata-context-hover").removeClass("vakata-context-hover").end().end().children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 38:i.is_visible&&(s=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").prevAll("li:not(.vakata-context-separator)").first(),s.length||(s=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").last()),s.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 39:i.is_visible&&(i.element.find(".vakata-context-hover").last().children("ul").show().children("li:not(.vakata-context-separator)").removeClass("vakata-context-hover").first().addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 40:i.is_visible&&(s=i.element.find("ul:visible").addBack().last().children(".vakata-context-hover").removeClass("vakata-context-hover").nextAll("li:not(.vakata-context-separator)").first(),s.length||(s=i.element.find("ul:visible").addBack().last().children("li:not(.vakata-context-separator)").first()),s.addClass("vakata-context-hover").children("a").focus(),t.stopImmediatePropagation(),t.preventDefault());break;case 27:e.vakata.context.hide(),t.preventDefault()}}).on("keydown",function(e){e.preventDefault();var t=i.element.find(".vakata-contextmenu-shortcut-"+e.which).parent();t.parent().not(".vakata-context-disabled")&&t.mouseup()}).appendTo("body"),e(document).on("mousedown",function(t){i.is_visible&&!e.contains(i.element[0],t.target)&&e.vakata.context.hide()}).on("context_show.vakata",function(e,s){i.element.find("li:has(ul)").children("a").addClass("vakata-context-parent"),t&&i.element.addClass("vakata-context-rtl").css("direction","rtl"),i.element.find("ul").hide().end()})})}(e),e.jstree.defaults.dnd={copy:!0,open_timeout:500,is_draggable:!0,check_while_dragging:!0,always_copy:!1,inside_pos:0},e.jstree.plugins.dnd=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("mousedown.jstree touchstart.jstree",".jstree-anchor",e.proxy(function(t){var i=this.get_node(t.target),s=this.is_selected(i)?this.get_selected().length:1;if(i&&i.id&&"#"!==i.id&&(1===t.which||"touchstart"===t.type)&&(!0===this.settings.dnd.is_draggable||e.isFunction(this.settings.dnd.is_draggable)&&this.settings.dnd.is_draggable.call(this,s>1?this.get_selected(!0):[i])))return this.element.trigger("mousedown.jstree"),e.vakata.dnd.start(t,{jstree:!0,origin:this,obj:this.get_node(i,!0),nodes:s>1?this.get_selected():[i.id]},'<div id="jstree-dnd" class="jstree-'+this.get_theme()+(this.settings.core.themes.responsive?" jstree-dnd-responsive":"")+'"><i class="jstree-icon jstree-er"></i>'+(s>1?s+" "+this.get_string("nodes"):this.get_text(t.currentTarget,!0))+'<ins class="jstree-copy" style="display:none;">+</ins></div>')},this))}},e(function(){var t=!1,i=!1,s=!1,n=e('<div id="jstree-marker">&#160;</div>').hide().appendTo("body");e(document).bind("dnd_start.vakata",function(e,i){t=!1}).bind("dnd_move.vakata",function(a,o){if(s&&clearTimeout(s),o&&o.data&&o.data.jstree&&(!o.event.target.id||"jstree-marker"!==o.event.target.id)){var r,l,d,c,h,u,p,_,f,g,m,v,b,y,w=e.jstree.reference(o.event.target),x=!1,k=!1,j=!1;if(w&&w._data&&w._data.dnd)if(n.attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")),o.helper.children().attr("class","jstree-"+w.get_theme()+(w.settings.core.themes.responsive?" jstree-dnd-responsive":"")).find(".jstree-copy:eq(0)")[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"show":"hide"](),o.event.target!==w.element[0]&&o.event.target!==w.get_container_ul()[0]||0!==w.get_container_ul().children().length){if((x=e(o.event.target).closest(".jstree-anchor"))&&x.length&&x.parent().is(".jstree-closed, .jstree-open, .jstree-leaf")&&(k=x.offset(),j=o.event.pageY-k.top,d=x.height(),u=j<d/3?["b","i","a"]:j>d-d/3?["a","i","b"]:j>d/2?["i","a","b"]:["i","b","a"],e.each(u,function(a,j){switch(j){case"b":r=k.left-6,l=k.top,c=w.get_parent(x),h=x.parent().index();break;case"i":b=w.settings.dnd.inside_pos,y=w.get_node(x.parent()),r=k.left-2,l=k.top+d/2+1,c=y.id,h="first"===b?0:"last"===b?y.children.length:Math.min(b,y.children.length);break;case"a":r=k.left-6,l=k.top+d,c=w.get_parent(x),h=x.parent().index()+1}for(/*!
								// TODO: moving inside, but the node is not yet loaded?
								// the check will work anyway, as when moving the node will be loaded first and checked again
								if(v === 'i' && !ins.is_loaded(p)) { }
								*/
p=!0,_=0,f=o.data.nodes.length;_<f;_++)if(g=o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",m=h,"move_node"===g&&"a"===j&&o.data.origin&&o.data.origin===w&&c===w.get_parent(o.data.nodes[_])&&(v=w.get_node(c),m>e.inArray(o.data.nodes[_],v.children)&&(m-=1)),!(p=p&&(w&&w.settings&&w.settings.dnd&&!1===w.settings.dnd.check_while_dragging||w.check(g,o.data.origin&&o.data.origin!==w?o.data.origin.get_node(o.data.nodes[_]):o.data.nodes[_],c,m,{dnd:!0,ref:w.get_node(x.parent()),pos:j,is_multi:o.data.origin&&o.data.origin!==w,is_foreign:!o.data.origin})))){w&&w.last_error&&(i=w.last_error());break}if(p)return"i"===j&&x.parent().is(".jstree-closed")&&w.settings.dnd.open_timeout&&(s=setTimeout(function(e,t){return function(){e.open_node(t)}}(w,x),w.settings.dnd.open_timeout)),t={ins:w,par:c,pos:"i"!==j||"last"!==b||0!==h||w.is_loaded(y)?h:"last"},n.css({left:r+"px",top:l+"px"}).show(),o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok"),i={},u=!0,!1}),!0===u))return}else{for(p=!0,_=0,f=o.data.nodes.length;_<f&&(p=p&&w.check(o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node",o.data.origin&&o.data.origin!==w?o.data.origin.get_node(o.data.nodes[_]):o.data.nodes[_],"#","last",{dnd:!0,ref:w.get_node("#"),pos:"i",is_multi:o.data.origin&&o.data.origin!==w,is_foreign:!o.data.origin}));_++);if(p)return t={ins:w,par:"#",pos:"last"},n.hide(),void o.helper.find(".jstree-icon:eq(0)").removeClass("jstree-er").addClass("jstree-ok")}t=!1,o.helper.find(".jstree-icon").removeClass("jstree-ok").addClass("jstree-er"),n.hide()}}).bind("dnd_scroll.vakata",function(e,i){i&&i.data&&i.data.jstree&&(n.hide(),t=!1,i.helper.find(".jstree-icon:eq(0)").removeClass("jstree-ok").addClass("jstree-er"))}).bind("dnd_stop.vakata",function(a,o){if(s&&clearTimeout(s),o&&o.data&&o.data.jstree){n.hide();var r,l,d=[];if(t){for(r=0,l=o.data.nodes.length;r<l;r++)d[r]=o.data.origin?o.data.origin.get_node(o.data.nodes[r]):o.data.nodes[r],o.data.origin&&(d[r].instance=o.data.origin);t.ins[o.data.origin&&(o.data.origin.settings.dnd.always_copy||o.data.origin.settings.dnd.copy&&(o.event.metaKey||o.event.ctrlKey))?"copy_node":"move_node"](d,t.par,t.pos)}else r=e(o.event.target).closest(".jstree"),r.length&&i&&i.error&&"check"===i.error&&(r=r.jstree(!0))&&r.settings.core.error.call(this,i)}}).bind("keyup keydown",function(t,i){(i=e.vakata.dnd._get())&&i.data&&i.data.jstree&&i.helper.find(".jstree-copy:eq(0)")[i.data.origin&&(i.data.origin.settings.dnd.always_copy||i.data.origin.settings.dnd.copy&&(t.metaKey||t.ctrlKey))?"show":"hide"]()})}),function(e){var t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1};e.vakata.dnd={settings:{scroll_speed:10,scroll_proximity:20,helper_left:5,helper_top:10,threshold:5,threshold_touch:50},_trigger:function(t,i){var s=e.vakata.dnd._get();s.event=i,e(document).triggerHandler("dnd_"+t+".vakata",s)},_get:function(){return{data:t.data,element:t.element,helper:t.helper}},_clean:function(){t.helper&&t.helper.remove(),t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),t={element:!1,target:!1,is_down:!1,is_drag:!1,helper:!1,helper_w:0,data:!1,init_x:0,init_y:0,scroll_l:0,scroll_t:0,scroll_e:!1,scroll_i:!1,is_touch:!1},e(document).off("mousemove touchmove",e.vakata.dnd.drag),e(document).off("mouseup touchend",e.vakata.dnd.stop)},_scroll:function(i){if(!t.scroll_e||!t.scroll_l&&!t.scroll_t)return t.scroll_i&&(clearInterval(t.scroll_i),t.scroll_i=!1),!1;if(!t.scroll_i)return t.scroll_i=setInterval(e.vakata.dnd._scroll,100),!1;if(!0===i)return!1;var s=t.scroll_e.scrollTop(),n=t.scroll_e.scrollLeft();t.scroll_e.scrollTop(s+t.scroll_t*e.vakata.dnd.settings.scroll_speed),t.scroll_e.scrollLeft(n+t.scroll_l*e.vakata.dnd.settings.scroll_speed),s===t.scroll_e.scrollTop()&&n===t.scroll_e.scrollLeft()||e.vakata.dnd._trigger("scroll",t.scroll_e)},start:function(i,s,n){"touchstart"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag&&e.vakata.dnd.stop({});try{i.currentTarget.unselectable="on",i.currentTarget.onselectstart=function(){return!1},i.currentTarget.style&&(i.currentTarget.style.MozUserSelect="none")}catch(e){}return t.init_x=i.pageX,t.init_y=i.pageY,t.data=s,t.is_down=!0,t.element=i.currentTarget,t.target=i.target,t.is_touch="touchstart"===i.type,!1!==n&&(t.helper=e("<div id='vakata-dnd'></div>").html(n).css({display:"block",margin:"0",padding:"0",position:"absolute",top:"-2000px",lineHeight:"16px",zIndex:"10000"})),e(document).bind("mousemove touchmove",e.vakata.dnd.drag),e(document).bind("mouseup touchend",e.vakata.dnd.stop),!1},drag:function(i){if("touchmove"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_down){if(!t.is_drag){if(!(Math.abs(i.pageX-t.init_x)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)||Math.abs(i.pageY-t.init_y)>(t.is_touch?e.vakata.dnd.settings.threshold_touch:e.vakata.dnd.settings.threshold)))return;t.helper&&(t.helper.appendTo("body"),t.helper_w=t.helper.outerWidth()),t.is_drag=!0,e.vakata.dnd._trigger("start",i)}var s=!1,n=!1,a=!1,o=!1,r=!1,l=!1,d=!1,c=!1,h=!1,u=!1;return t.scroll_t=0,t.scroll_l=0,t.scroll_e=!1,e(e(i.target).parentsUntil("body").addBack().get().reverse()).filter(function(){return/^auto|scroll$/.test(e(this).css("overflow"))&&(this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth)}).each(function(){var s=e(this),n=s.offset();if(this.scrollHeight>this.offsetHeight&&(n.top+s.height()-i.pageY<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),i.pageY-n.top<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1)),this.scrollWidth>this.offsetWidth&&(n.left+s.width()-i.pageX<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),i.pageX-n.left<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1)),t.scroll_t||t.scroll_l)return t.scroll_e=e(this),!1}),t.scroll_e||(s=e(document),n=e(window),a=s.height(),o=n.height(),r=s.width(),l=n.width(),d=s.scrollTop(),c=s.scrollLeft(),a>o&&i.pageY-d<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=-1),a>o&&o-(i.pageY-d)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_t=1),r>l&&i.pageX-c<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=-1),r>l&&l-(i.pageX-c)<e.vakata.dnd.settings.scroll_proximity&&(t.scroll_l=1),(t.scroll_t||t.scroll_l)&&(t.scroll_e=s)),t.scroll_e&&e.vakata.dnd._scroll(!0),t.helper&&(h=parseInt(i.pageY+e.vakata.dnd.settings.helper_top,10),u=parseInt(i.pageX+e.vakata.dnd.settings.helper_left,10),a&&h+25>a&&(h=a-50),r&&u+t.helper_w>r&&(u=r-(t.helper_w+2)),t.helper.css({left:u+"px",top:h+"px"})),e.vakata.dnd._trigger("move",i),!1}},stop:function(i){if("touchend"===i.type&&i.originalEvent&&i.originalEvent.changedTouches&&i.originalEvent.changedTouches[0]&&(i.pageX=i.originalEvent.changedTouches[0].pageX,i.pageY=i.originalEvent.changedTouches[0].pageY,i.target=document.elementFromPoint(i.originalEvent.changedTouches[0].pageX-window.pageXOffset,i.originalEvent.changedTouches[0].pageY-window.pageYOffset)),t.is_drag)e.vakata.dnd._trigger("stop",i);else if("touchend"===i.type&&i.target===t.target){var s=setTimeout(function(){e(i.target).click()},100);e(i.target).one("click",function(){s&&clearTimeout(s)})}return e.vakata.dnd._clean(),!1}}}(e),e.jstree.defaults.search={ajax:!1,fuzzy:!1,case_sensitive:!1,show_only_matches:!1,close_opened_onclear:!0,search_leaves_only:!1,search_callback:!1},e.jstree.plugins.search=function(t,i){this.bind=function(){i.bind.call(this),this._data.search.str="",this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],this.element.on("before_open.jstree",e.proxy(function(t,i){var s,n,a=this._data.search.res,o=[],r=e();if(a&&a.length&&(this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(a,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.dom.children(".jstree-anchor").addClass("jstree-search"),this.settings.search.show_only_matches&&this._data.search.res.length)){for(s=0,n=a.length;s<n;s++)o=o.concat(this.get_node(a[s]).parents);o=e.vakata.array_remove_item(e.vakata.array_unique(o),"#"),r=o.length?e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))):e(),this.element.find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),r=r.add(this._data.search.dom),r.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")})}},this)),this.settings.search.show_only_matches&&this.element.on("search.jstree",function(t,i){i.nodes.length&&(e(this).find(".jstree-node").hide().filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last"),i.nodes.parentsUntil(".jstree").addBack().show().filter(".jstree-children").each(function(){e(this).children(".jstree-node:visible").eq(-1).addClass("jstree-last")}))}).on("clear_search.jstree",function(t,i){i.nodes.length&&e(this).find(".jstree-node").css("display","").filter(".jstree-last").filter(function(){return this.nextSibling}).removeClass("jstree-last")})},this.search=function(t,i){if(!1===t||""===e.trim(t.toString()))return this.clear_search();t=t.toString();var s=this.settings.search,n=!!s.ajax&&s.ajax,a=null,o=[],r=[];if(this._data.search.res.length&&this.clear_search(),!i&&!1!==n)return e.isFunction(n)?n.call(this,t,e.proxy(function(i){i&&i.d&&(i=i.d),this._load_nodes(e.isArray(i)?e.vakata.array_unique(i):[],function(){this.search(t,!0)},!0)},this)):(n=e.extend({},n),n.data||(n.data={}),n.data.str=t,e.ajax(n).fail(e.proxy(function(){this._data.core.last_error={error:"ajax",plugin:"search",id:"search_01",reason:"Could not load search parents",data:JSON.stringify(n)},this.settings.core.error.call(this,this._data.core.last_error)},this)).done(e.proxy(function(i){i&&i.d&&(i=i.d),this._load_nodes(e.isArray(i)?e.vakata.array_unique(i):[],function(){this.search(t,!0)},!0)},this)));this._data.search.str=t,this._data.search.dom=e(),this._data.search.res=[],this._data.search.opn=[],a=new e.vakata.search(t,!0,{caseSensitive:s.case_sensitive,fuzzy:s.fuzzy}),e.each(this._model.data,function(e,i){i.text&&(s.search_callback&&s.search_callback.call(this,t,i)||!s.search_callback&&a.search(i.text).isMatch)&&(!s.search_leaves_only||i.state.loaded&&0===i.children.length)&&(o.push(e),r=r.concat(i.parents))}),o.length&&(r=e.vakata.array_unique(r),this._search_open(r),this._data.search.dom=e(this.element[0].querySelectorAll("#"+e.map(o,function(t){return-1!=="0123456789".indexOf(t[0])?"\\3"+t[0]+" "+t.substr(1).replace(e.jstree.idregex,"\\$&"):t.replace(e.jstree.idregex,"\\$&")}).join(", #"))),this._data.search.res=o,this._data.search.dom.children(".jstree-anchor").addClass("jstree-search")),this.trigger("search",{nodes:this._data.search.dom,str:t,res:this._data.search.res})},this.clear_search=function(){this._data.search.dom.children(".jstree-anchor").removeClass("jstree-search"),this.settings.search.close_opened_onclear&&this.close_node(this._data.search.opn,0),this.trigger("clear_search",{nodes:this._data.search.dom,str:this._data.search.str,res:this._data.search.res}),this._data.search.str="",this._data.search.res=[],this._data.search.opn=[],this._data.search.dom=e()},this._search_open=function(t){var i=this;e.each(t.concat([]),function(s,n){if("#"===n)return!0;try{n=e("#"+n.replace(e.jstree.idregex,"\\$&"),i.element)}catch(e){}n&&n.length&&i.is_closed(n)&&(i._data.search.opn.push(n[0].id),i.open_node(n,function(){i._search_open(t)},0))})}},function(e){e.vakata.search=function(e,t,i){i=i||{},!1!==i.fuzzy&&(i.fuzzy=!0),e=i.caseSensitive?e:e.toLowerCase();var s,n,a,o,r=i.location||0,l=i.distance||100,d=i.threshold||.6,c=e.length;return c>32&&(i.fuzzy=!1),i.fuzzy&&(s=1<<c-1,n=function(){var t={},i=0;for(i=0;i<c;i++)t[e.charAt(i)]=0;for(i=0;i<c;i++)t[e.charAt(i)]|=1<<c-i-1;return t}(),a=function(e,t){var i=e/c,s=Math.abs(r-t);return l?i+s/l:s?1:i}),o=function(t){if(t=i.caseSensitive?t:t.toLowerCase(),e===t||-1!==t.indexOf(e))return{isMatch:!0,score:0};if(!i.fuzzy)return{isMatch:!1,score:1};var o,l,h,u,p,_,f,g,m,v=t.length,b=d,y=t.indexOf(e,r),w=c+v,x=1,k=[];for(-1!==y&&(b=Math.min(a(0,y),b),-1!==(y=t.lastIndexOf(e,r+c))&&(b=Math.min(a(0,y),b))),y=-1,o=0;o<c;o++){for(h=0,u=w;h<u;)a(o,r+u)<=b?h=u:w=u,u=Math.floor((w-h)/2+h);for(w=u,_=Math.max(1,r-u+1),f=Math.min(r+u,v)+c,g=new Array(f+2),g[f+1]=(1<<o)-1,l=f;l>=_;l--)if(m=n[t.charAt(l-1)],g[l]=0===o?(g[l+1]<<1|1)&m:(g[l+1]<<1|1)&m|(p[l+1]|p[l])<<1|1|p[l+1],g[l]&s&&(x=a(o,l-1))<=b){if(b=x,y=l-1,k.push(y),!(y>r))break;_=Math.max(1,2*r-y)}if(a(o+1,r)>b)break;p=g}return{isMatch:y>=0,score:x}},!0===t?{search:o}:o(t)}}(e),e.jstree.defaults.sort=function(e,t){return this.get_text(e)>this.get_text(t)?1:-1},e.jstree.plugins.sort=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("model.jstree",e.proxy(function(e,t){this.sort(t.parent,!0)},this)).on("rename_node.jstree create_node.jstree",e.proxy(function(e,t){this.sort(t.parent||t.node.parent,!1),this.redraw_node(t.parent||t.node.parent,!0)},this)).on("move_node.jstree copy_node.jstree",e.proxy(function(e,t){this.sort(t.parent,!1),this.redraw_node(t.parent,!0)},this))},this.sort=function(t,i){var s,n;if((t=this.get_node(t))&&t.children&&t.children.length&&(t.children.sort(e.proxy(this.settings.sort,this)),i))for(s=0,n=t.children_d.length;s<n;s++)this.sort(t.children_d[s],!1)}};var p=!1;e.jstree.defaults.state={key:"jstree",events:"changed.jstree open_node.jstree close_node.jstree",ttl:!1,filter:!1},e.jstree.plugins.state=function(t,i){this.bind=function(){i.bind.call(this);var t=e.proxy(function(){this.element.on(this.settings.state.events,e.proxy(function(){p&&clearTimeout(p),p=setTimeout(e.proxy(function(){this.save_state()},this),100)},this))},this);this.element.on("ready.jstree",e.proxy(function(e,i){this.element.one("restore_state.jstree",t),this.restore_state()||t()},this))},this.save_state=function(){var t={state:this.get_state(),ttl:this.settings.state.ttl,sec:+new Date};e.vakata.storage.set(this.settings.state.key,JSON.stringify(t))},this.restore_state=function(){var t=e.vakata.storage.get(this.settings.state.key);if(t)try{t=JSON.parse(t)}catch(e){return!1}return!(t&&t.ttl&&t.sec&&+new Date-t.sec>t.ttl)&&(t&&t.state&&(t=t.state),t&&e.isFunction(this.settings.state.filter)&&(t=this.settings.state.filter.call(this,t)),!!t&&(this.element.one("set_state.jstree",function(i,s){s.instance.trigger("restore_state",{state:e.extend(!0,{},t)})}),this.set_state(t),!0))},this.clear_state=function(){return e.vakata.storage.del(this.settings.state.key)}},function(e,t){e.vakata.storage={set:function(e,t){return window.localStorage.setItem(e,t)},get:function(e){return window.localStorage.getItem(e)},del:function(e){return window.localStorage.removeItem(e)}}}(e),e.jstree.defaults.types={"#":{},default:{}},e.jstree.plugins.types=function(i,s){this.init=function(e,i){var n,a;if(i&&i.types&&i.types.default)for(n in i.types)if("default"!==n&&"#"!==n&&i.types.hasOwnProperty(n))for(a in i.types.default)i.types.default.hasOwnProperty(a)&&i.types[n][a]===t&&(i.types[n][a]=i.types.default[a]);s.init.call(this,e,i),this._model.data["#"].type="#"},this.refresh=function(e,t){s.refresh.call(this,e,t),this._model.data["#"].type="#"},this.bind=function(){this.element.on("model.jstree",e.proxy(function(e,i){var s,n,a=this._model.data,o=i.nodes,r=this.settings.types,l="default";for(s=0,n=o.length;s<n;s++)l="default",a[o[s]].original&&a[o[s]].original.type&&r[a[o[s]].original.type]&&(l=a[o[s]].original.type),a[o[s]].data&&a[o[s]].data.jstree&&a[o[s]].data.jstree.type&&r[a[o[s]].data.jstree.type]&&(l=a[o[s]].data.jstree.type),a[o[s]].type=l,!0===a[o[s]].icon&&r[l].icon!==t&&(a[o[s]].icon=r[l].icon);a["#"].type="#"},this)),s.bind.call(this)},this.get_json=function(t,i,n){var a,o,r=this._model.data,l=i?e.extend(!0,{},i,{no_id:!1}):{},d=s.get_json.call(this,t,l,n);if(!1===d)return!1;if(e.isArray(d))for(a=0,o=d.length;a<o;a++)d[a].type=d[a].id&&r[d[a].id]&&r[d[a].id].type?r[d[a].id].type:"default",i&&i.no_id&&(delete d[a].id,d[a].li_attr&&d[a].li_attr.id&&delete d[a].li_attr.id);else d.type=d.id&&r[d.id]&&r[d.id].type?r[d.id].type:"default",i&&i.no_id&&(d=this._delete_ids(d));return d},this._delete_ids=function(t){if(e.isArray(t)){for(var i=0,s=t.length;i<s;i++)t[i]=this._delete_ids(t[i]);return t}return delete t.id,t.li_attr&&t.li_attr.id&&delete t.li_attr.id,t.children&&e.isArray(t.children)&&(t.children=this._delete_ids(t.children)),t},this.check=function(i,n,a,o,r){if(!1===s.check.call(this,i,n,a,o,r))return!1;n=n&&n.id?n:this.get_node(n),a=a&&a.id?a:this.get_node(a);var l,d,c,h,u=n&&n.id?e.jstree.reference(n.id):null;switch(u=u&&u._model&&u._model.data?u._model.data:null,i){case"create_node":case"move_node":case"copy_node":if("move_node"!==i||-1===e.inArray(n.id,a.children)){if(l=this.get_rules(a),l.max_children!==t&&-1!==l.max_children&&l.max_children===a.children.length)return this._data.core.last_error={error:"check",plugin:"types",id:"types_01",reason:"max_children prevents function: "+i,data:JSON.stringify({chk:i,pos:o,obj:!(!n||!n.id)&&n.id,par:!(!a||!a.id)&&a.id})},!1;if(l.valid_children!==t&&-1!==l.valid_children&&-1===e.inArray(n.type,l.valid_children))return this._data.core.last_error={error:"check",plugin:"types",id:"types_02",reason:"valid_children prevents function: "+i,data:JSON.stringify({chk:i,pos:o,obj:!(!n||!n.id)&&n.id,par:!(!a||!a.id)&&a.id})},!1;if(u&&n.children_d&&n.parents){for(d=0,c=0,h=n.children_d.length;c<h;c++)d=Math.max(d,u[n.children_d[c]].parents.length);d=d-n.parents.length+1}(d<=0||d===t)&&(d=1);do{if(l.max_depth!==t&&-1!==l.max_depth&&l.max_depth<d)return this._data.core.last_error={error:"check",plugin:"types",id:"types_03",reason:"max_depth prevents function: "+i,data:JSON.stringify({chk:i,pos:o,obj:!(!n||!n.id)&&n.id,par:!(!a||!a.id)&&a.id})},!1;a=this.get_node(a.parent),l=this.get_rules(a),d++}while(a)}}return!0},this.get_rules=function(e){if(!(e=this.get_node(e)))return!1;var i=this.get_type(e,!0);return i.max_depth===t&&(i.max_depth=-1),i.max_children===t&&(i.max_children=-1),i.valid_children===t&&(i.valid_children=-1),i},this.get_type=function(t,i){return!!(t=this.get_node(t))&&(i?e.extend({type:t.type},this.settings.types[t.type]):t.type)},this.set_type=function(i,s){var n,a,o,r,l;if(e.isArray(i)){for(i=i.slice(),a=0,o=i.length;a<o;a++)this.set_type(i[a],s);return!0}return n=this.settings.types,i=this.get_node(i),!(!n[s]||!i)&&(r=i.type,l=this.get_icon(i),i.type=s,(!0===l||n[r]&&n[r].icon&&l===n[r].icon)&&this.set_icon(i,n[s].icon===t||n[s].icon),!0)}},e.jstree.defaults.unique={case_sensitive:!1,duplicate:function(e,t){return e+" ("+t+")"}},e.jstree.plugins.unique=function(i,s){this.check=function(t,i,n,a,o){if(!1===s.check.call(this,t,i,n,a,o))return!1;if(i=i&&i.id?i:this.get_node(i),!(n=n&&n.id?n:this.get_node(n))||!n.children)return!0;var r,l,d="rename_node"===t?a:i.text,c=[],h=this.settings.unique.case_sensitive,u=this._model.data;for(r=0,l=n.children.length;r<l;r++)c.push(h?u[n.children[r]].text:u[n.children[r]].text.toLowerCase());switch(h||(d=d.toLowerCase()),t){case"delete_node":return!0;case"rename_node":return r=-1===e.inArray(d,c)||i.text&&i.text[h?"toString":"toLowerCase"]()===d,r||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_01",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!i||!i.id)&&i.id,par:!(!n||!n.id)&&n.id})}),r;case"create_node":return r=-1===e.inArray(d,c),r||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_04",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!i||!i.id)&&i.id,par:!(!n||!n.id)&&n.id})}),r;case"copy_node":return r=-1===e.inArray(d,c),r||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_02",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!i||!i.id)&&i.id,par:!(!n||!n.id)&&n.id})}),r;case"move_node":return r=i.parent===n.id||-1===e.inArray(d,c),r||(this._data.core.last_error={error:"check",plugin:"unique",id:"unique_03",reason:"Child with name "+d+" already exists. Preventing: "+t,data:JSON.stringify({chk:t,pos:a,obj:!(!i||!i.id)&&i.id,par:!(!n||!n.id)&&n.id})}),r}return!0},this.create_node=function(i,n,a,o,r){if(!n||n.text===t){if(null===i&&(i="#"),!(i=this.get_node(i)))return s.create_node.call(this,i,n,a,o,r);if(a=a===t?"last":a,!a.toString().match(/^(before|after)$/)&&!r&&!this.is_loaded(i))return s.create_node.call(this,i,n,a,o,r);n||(n={});var l,d,c,h,u,p=this._model.data,_=this.settings.unique.case_sensitive,f=this.settings.unique.duplicate;for(d=l=this.get_string("New node"),c=[],h=0,u=i.children.length;h<u;h++)c.push(_?p[i.children[h]].text:p[i.children[h]].text.toLowerCase());for(h=1;-1!==e.inArray(_?d:d.toLowerCase(),c);)d=f.call(this,l,++h).toString();n.text=d}return s.create_node.call(this,i,n,a,o,r)}};var _=document.createElement("DIV");_.setAttribute("unselectable","on"),_.className="jstree-wholerow",_.innerHTML="&#160;",e.jstree.plugins.wholerow=function(t,i){this.bind=function(){i.bind.call(this),this.element.on("ready.jstree set_state.jstree",e.proxy(function(){this.hide_dots()},this)).on("init.jstree loading.jstree ready.jstree",e.proxy(function(){this.get_container_ul().addClass("jstree-wholerow-ul")},this)).on("deselect_all.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked")},this)).on("changed.jstree",e.proxy(function(e,t){this.element.find(".jstree-wholerow-clicked").removeClass("jstree-wholerow-clicked");var i,s,n=!1;for(i=0,s=t.selected.length;i<s;i++)(n=this.get_node(t.selected[i],!0))&&n.length&&n.children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("open_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).find(".jstree-clicked").parent().children(".jstree-wholerow").addClass("jstree-wholerow-clicked")},this)).on("hover_node.jstree dehover_node.jstree",e.proxy(function(e,t){this.get_node(t.node,!0).children(".jstree-wholerow")["hover_node"===e.type?"addClass":"removeClass"]("jstree-wholerow-hovered")},this)).on("contextmenu.jstree",".jstree-wholerow",e.proxy(function(t){t.preventDefault();var i=e.Event("contextmenu",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,pageX:t.pageX,pageY:t.pageY});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(i)},this)).on("click.jstree",".jstree-wholerow",function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(i).focus()}).on("click.jstree",".jstree-leaf > .jstree-ocl",e.proxy(function(t){t.stopImmediatePropagation();var i=e.Event("click",{metaKey:t.metaKey,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey});e(t.currentTarget).closest(".jstree-node").children(".jstree-anchor:eq(0)").trigger(i).focus()},this)).on("mouseover.jstree",".jstree-wholerow, .jstree-icon",e.proxy(function(e){return e.stopImmediatePropagation(),this.hover_node(e.currentTarget),!1},this)).on("mouseleave.jstree",".jstree-node",e.proxy(function(e){this.dehover_node(e.currentTarget)},this))},this.teardown=function(){this.settings.wholerow&&this.element.find(".jstree-wholerow").remove(),i.teardown.call(this)},this.redraw_node=function(t,s,n){if(t=i.redraw_node.call(this,t,s,n)){var a=_.cloneNode(!0);-1!==e.inArray(t.id,this._data.core.selected)&&(a.className+=" jstree-wholerow-clicked"),t.insertBefore(a,t.childNodes[0])}return t}}}})},20:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=(a(o),i(11)),l=a(r),d=i(4),c=a(d),h=i(48),u=a(h),p=i(44),_=a(p);t.default=e.View.extend({initialize:function(t){this.model=new e.Model({initial_errors:!1,cls:"ui-portlet-limited",icon:null,always_refresh:!0,status:"warning",hide_operations:!1,onchange:function(){}}).set(t),this.setElement("<div/>"),this.render()},update:function(e){var t=this;this.data.matchModel(e,function(e,i){var n=t.input_list[i];if(n&&n.options&&!s.isEqual(n.options,e.options)){n.options=e.options;var a=t.field_list[i];if(a.update){var o=[];if(-1!=["data","data_collection","drill_down"].indexOf(n.type))o=n.options;else for(var r in e.options){var l=e.options[r];l.length>2&&o.push({label:l[0],value:l[1]})}a.update(o),a.trigger("change"),Galaxy.emit.debug("form-view::update()","Updating options for "+i)}}})},wait:function(e){for(var t in this.input_list){var i=this.field_list[t];this.input_list[t].is_dynamic&&i.wait&&i.unwait&&i[e?"wait":"unwait"]()}},highlight:function(e,t,i){var s=this.element_list[e];if(s&&(s.error(t||"Please verify this parameter."),this.portlet.expand(),this.trigger("expand",e),!i)){var a=this.$el.parents().filter(function(){return-1!=["auto","scroll"].indexOf(n(this).css("overflow"))}).first();a.animate({scrollTop:a.scrollTop()+s.$el.offset().top-120},500)}},errors:function(e){if(this.trigger("reset"),e&&e.errors){var t=this.data.matchResponse(e.errors);for(var i in this.element_list){this.element_list[i];t[i]&&this.highlight(i,t[i],!0)}}},render:function(){var e=this;this.off("change"),this.off("reset"),this.field_list={},this.input_list={},this.element_list={},this.data=new _.default.Manager(this),this._renderForm(),this.data.create(),this.model.get("initial_errors")&&this.errors(this.model.attributes);var t=this.data.checksum();return this.on("change",function(i){var s=e.input_list[i];if(!s||s.refresh_on_change||e.model.get("always_refresh")){var n=e.data.checksum();n!=t&&(t=n,e.model.get("onchange")())}}),this.on("reset",function(){s.each(e.element_list,function(e){e.reset()})}),this},_renderForm:function(){n(".tooltip").remove();var e=this.model.attributes;this.message=new c.default.UnescapedMessage,this.section=new u.default.View(this,{inputs:e.inputs}),this.portlet=new l.default.View({icon:e.icon,title:e.title,cls:e.cls,operations:!e.hide_operations&&e.operations,buttons:e.buttons,collapsible:e.collapsible,collapsed:e.collapsed,onchange_title:e.onchange_title}),this.portlet.append(this.message.$el),this.portlet.append(this.section.$el),this.$el.empty(),e.inputs&&this.$el.append(this.portlet.$el),e.message&&this.message.update({persistent:!0,status:e.status,message:e.message}),Galaxy.emit.debug("form-view::initialize()","Completed")}})}).call(t,i(1),i(2),i(0))},22:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=a(o),l=i(12),d=a(l),c=e.View.extend({initialize:function(t){var i=this;this.data=[],this.data2=[],this.model=t&&t.model||new e.Model({id:r.default.uid(),cls:"ui-select",error_text:"No options available",empty_text:"Nothing selected",visible:!0,wait:!1,multiple:!1,searchable:!0,optional:!1,disabled:!1,readonly:!1,onchange:function(){},value:null,individual:!1,pagesize:20}).set(t),this.on("change",function(){i.model.get("onchange")&&i.model.get("onchange")(i.value())}),this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:disabled",this._changeDisabled,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:visible",this._changeVisible,this),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:multiple change:searchable change:cls change:id",this.render,this),this.render()},render:function(){var e=this;this.model.get("searchable")?this._renderSearchable():this._renderClassic(),this.$el.addClass(this.model.get("cls")).attr("id",this.model.get("id")),this.$select.empty().addClass("select").attr("id",this.model.get("id")+"_select").prop("multiple",this.model.get("multiple")).on("change",function(){e.value(e._getValue()),e.trigger("change")}),this._changeData(),this._changeWait(),this._changeVisible(),this._changeDisabled()},_renderClassic:function(){var e=this;this.$el.addClass(this.model.get("multiple")?"ui-select-multiple":"ui-select").append(this.$select=s("<select/>")).append(this.$dropdown=s("<div/>")).append(this.$resize=s("<div/>").append(this.$resize_icon=s("<i/>"))),this.model.get("multiple")?(this.$dropdown.hide(),this.$resize_icon.addClass("fa fa-angle-double-right fa-rotate-45").show(),this.$resize.removeClass().addClass("icon-resize").show().off("mousedown").on("mousedown",function(t){var i=t.pageY,n=e.$select.height();e.minHeight=e.minHeight||n,s("#dd-helper").show().on("mousemove",function(t){e.$select.height(Math.max(n+(t.pageY-i),e.minHeight))}).on("mouseup mouseleave",function(){s("#dd-helper").hide().off()})})):(this.$dropdown.show(),this.$resize.hide(),this.$resize_icon.hide())},_renderSearchable:function(){var e=this;this.$el.append(this.$select=s("<div/>")).append(this.$dropdown=s("<div/>")),this.$dropdown.hide(),this.model.get("multiple")||this.$dropdown.show().on("click",function(){e.$select.select2&&e.$select.select2("open")}),this.all_button=null,!this.model.get("multiple")||this.model.get("individual")||this.model.get("readonly")||(this.all_button=new d.default.ButtonCheck({onclick:function(){var t=[];0!==e.all_button.value()&&n.each(e.model.get("data"),function(e){t.push(e.value)}),e.value(t),e.trigger("change")}}),this.$el.prepend(this.all_button.$el))},_match:function(e,t){return!e||""==e||String(t).toUpperCase().indexOf(e.toUpperCase())>=0},_changeData:function(){var e=this;this.data=[],!this.model.get("multiple")&&this.model.get("optional")&&this.data.push({value:"__null__",label:e.model.get("empty_text")}),n.each(this.model.get("data"),function(t){e.data.push(t)}),0==this.length()&&this.data.push({value:"__null__",label:this.model.get("error_text")}),this.model.get("searchable")?(this.data2=[],n.each(this.data,function(t,i){e.data2.push({order:i,id:t.value,text:t.label,tags:t.tags})}),this.$select.data("select2")&&this.$select.select2("destroy"),this.matched_tags={},this.$select.select2({data:e.data2,closeOnSelect:!this.model.get("multiple"),multiple:this.model.get("multiple"),query:function(t){e.matched_tags={};var i=e.model.get("pagesize"),s=n.filter(e.data2,function(i){var s=!1;return n.each(i.tags,function(i){e._match(t.term,i)&&(s=e.matched_tags[i]=!0)}),s||e._match(t.term,i.text)});t.callback({results:s.slice((t.page-1)*i,t.page*i),more:s.length>=t.page*i})},formatResult:function(t){return n.escape(t.text)+'<div class="ui-tags">'+n.reduce(t.tags,function(t,i){return e.matched_tags[i]?t+'&nbsp;<div class="label label-info">'+n.escape(i)+"</div>":t},"")+"</div>"}}),this.$(".select2-container .select2-search input").off("blur")):(this.$select.find("option").remove(),n.each(this.data,function(t){e.$select.append(s("<option/>").attr("value",t.value).html(n.escape(t.label)))})),this.model.set("disabled",this.model.get("readonly")||0==this.length()),this._changeValue()},_changeDisabled:function(){this.model.get("searchable")?this.$select.select2(this.model.get("disabled")?"disable":"enable"):this.$select.prop("disabled",this.model.get("disabled"))},_changeWait:function(){this.$dropdown.removeClass().addClass("icon-dropdown fa").addClass(this.model.get("wait")?"fa-spinner fa-spin":"fa-caret-down")},_changeVisible:function(){this.$el[this.model.get("visible")?"show":"hide"](),this.$select[this.model.get("visible")?"show":"hide"]()},_changeValue:function(){if(this._setValue(this.model.get("value")),this.model.get("multiple")){if(this.all_button){var e=this._getValue();this.all_button.value(s.isArray(e)?e.length:0,this.length())}}else null!==this._getValue()||this.model.get("optional")||this._setValue(this.first())},value:function(e){return void 0!==e&&this.model.set("value",e),this._getValue()},first:function(){return this.data.length>0?this.data[0].value:null},exists:function(e){return n.findWhere(this.data,{value:e})},text:function(){var e=this._getValue(),t=this.exists(s.isArray(e)?e[0]:e);return t?t.label:""},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},disabled:function(){return this.model.get("disabled")},enable:function(){this.model.set("disabled",!1)},disable:function(){this.model.set("disabled",!0)},add:function(e,t){n.each(this.model.get("data"),function(t){t.keep&&!n.findWhere(e,{value:t.value})&&e.push(t)}),t&&e&&e.sort(t),this.model.set("data",e)},update:function(e){this.model.set("data",e)},setOnChange:function(e){this.model.set("onchange",e)},length:function(){return s.isArray(this.model.get("data"))?this.model.get("data").length:0},_setValue:function(e){var t=this;if(null!==e&&void 0!==e||(e="__null__"),this.model.get("multiple")?e=s.isArray(e)?e:[e]:s.isArray(e)&&(e=e.length>0?e[0]:"__null__"),this.model.get("searchable")){if(s.isArray(e)){var i=[];n.each(e,function(e){var s=n.findWhere(t.data2,{id:e});s&&i.push(s)}),e=i}else{e=n.findWhere(this.data2,{id:e})}this.$select.select2("data",e)}else this.$select.val(e)},_getValue:function(){var e=null;if(this.model.get("searchable")){var t=this.$select.select2("data");t&&(s.isArray(t)?(e=[],t.sort(function(e,t){return e.order-t.order}),n.each(t,function(t){e.push(t.id)})):e=t.id)}else e=this.$select.val();return r.default.isEmpty(e)?null:e}});t.default={View:c}}).call(t,i(1),i(0),i(2))},23:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=a(o),l=i(12),d=a(l),c=e.View.extend({initialize:function(t){var i=this;this.model=t&&t.model||new e.Model({visible:!0,data:[],id:r.default.uid(),error_text:"No options available.",wait_text:"Please wait...",multiple:!1,optional:!1,onchange:function(){}}).set(t),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:visible",this._changeVisible,this),this.on("change",function(){i.model.get("onchange")(i.value())}),this.render()},render:function(){var e=this;this.$el.empty().removeClass().addClass("ui-options").append(this.$message=s("<div/>")).append(this.$menu=s("<div/>").addClass("ui-options-menu")).append(this.$options=s(this._template())),this.all_button=null,this.model.get("multiple")&&(this.all_button=new d.default.ButtonCheck({onclick:function(){e.$("input").prop("checked",0!==e.all_button.value()),e.value(e._getValue()),e.trigger("change")}}),this.$menu.append(this.all_button.$el)),this._changeData(),this._changeWait(),this._changeVisible()},update:function(e){this.model.set("data",e)},_changeData:function(){var e=this;this.$options.empty(),this._templateOptions?this.$options.append(this._templateOptions(this.model.get("data"))):n.each(this.model.get("data"),function(t){e.$options.append(s(e._templateOption(t)).addClass("ui-option").tooltip({title:t.tooltip,placement:"bottom"}))});var e=this;this.$("input").on("change",function(){e.value(e._getValue()),e.trigger("change")}),this._changeValue(),this._changeWait()},_changeVisible:function(){this.$el[this.model.get("visible")?"show":"hide"]()},_changeWait:function(){this.model.get("wait")?0===this.length()&&(this._messageShow(this.model.get("wait_text"),"info"),this.$options.hide(),this.$menu.hide()):0===this.length()?(this._messageShow(this.model.get("error_text"),"danger"),this.$options.hide(),this.$menu.hide()):(this.$message.hide(),this.$options.css("display","inline-block"),this.$menu.show())},_changeValue:function(){this._setValue(this.model.get("value")),null!==this._getValue()||this.model.get("multiple")||this.model.get("optional")||this._setValue(this.first()),this.all_button&&this.all_button.value(s.isArray(this._getValue())?this._getValue().length:0,this.length())},value:function(e){return void 0!==e&&this.model.set("value",e),this._getValue()},first:function(){var e=this.$("input").first();return e.length>0?e.val():null},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},length:function(){return this.$(".ui-option").length},_setValue:function(e){var t=this;if(void 0!==e&&(this.$("input").prop("checked",!1),null!==e)){var i=s.isArray(e)?e:[e];n.each(i,function(e){t.$('input[value="'+e+'"]').first().prop("checked",!0)})}},_getValue:function(){var e=[];return this.$(":checked").each(function(){e.push(s(this).val())}),r.default.isEmpty(e)?null:this.model.get("multiple")?e:e[0]},_messageShow:function(e,t){this.$message.show().removeClass().addClass("ui-message alert alert-"+t).html(e)},_template:function(){return s("<div/>").addClass("ui-options-list")}}),h=c.extend({_templateOption:function(e){var t=r.default.uid();return s("<div/>").addClass("ui-option").append(s("<input/>").attr({id:t,type:this.model.get("type"),name:this.model.id,value:e.value})).append(s("<label/>").addClass("ui-options-label").attr("for",t).html(e.label))}}),u={};u.View=h.extend({initialize:function(e){e.type="radio",h.prototype.initialize.call(this,e)}});var p={};p.View=h.extend({initialize:function(e){e.type="checkbox",e.multiple=!0,h.prototype.initialize.call(this,e)}});var _={};_.View=c.extend({initialize:function(e){c.prototype.initialize.call(this,e)},_setValue:function(e){void 0!==e&&(this.$("input").prop("checked",!1),this.$("label").removeClass("active"),this.$('[value="'+e+'"]').prop("checked",!0).closest("label").addClass("active"))},_templateOption:function(e){var t=s("<label/>").addClass("btn btn-default");return e.icon&&t.append(s("<i/>").addClass("fa").addClass(e.icon).addClass(!e.label&&"no-padding")),t.append(s("<input/>").attr({type:"radio",name:this.model.id,value:e.value})),e.label&&t.append(e.label),t},_template:function(){return s("<div/>").addClass("btn-group ui-radiobutton").attr("data-toggle","buttons")}}),t.default={Base:c,BaseIcons:h,Radio:u,RadioButton:_,Checkbox:p}}).call(t,i(1),i(0),i(2))},24:function(e,t,i){"use strict";(function(e,s){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),o=n(a),r=i(11),l=n(r),d=i(4),c=n(d),h=e.View.extend({initialize:function(e){var t=this;this.options=e,this.name=e.name||"element",this.multiple=e.multiple||!1,this.message=new c.default.Message,this.portlet=new l.default.View({cls:"ui-portlet-section"}),this.select=new c.default.Select.View({optional:e.optional}),this.button=new c.default.ButtonIcon({icon:"fa fa-sign-in",tooltip:"Insert new "+this.name,onclick:function(){t.add({id:t.select.value(),name:t.select.text()})}}),this.setElement(this._template(e)),this.$(".ui-list-message").append(this.message.$el),this.$(".ui-list-portlet").append(this.portlet.$el),this.$(".ui-list-button").append(this.button.$el),this.$(".ui-list-select").append(this.select.$el)},value:function(e){if(void 0!==e){if(this.portlet.empty(),s.isArray(e))for(var t in e){var i=e[t],n=null,a=null;"string"!=s.type(i)?(n=i.id,a=i.name):n=a=i,null!=n&&this.add({id:n,name:a})}this._refresh()}var o=[];return this.$(".ui-list-id").each(function(){o.push({id:s(this).prop("id"),name:s(this).find(".ui-list-name").html()})}),0==o.length?null:o},add:function(e){var t=this;if(0===this.$('[id="'+e.id+'"]').length)if(o.default.isEmpty(e.id))this.message.update({message:"Please select a valid "+this.name+".",status:"danger"});else{var i=s(this._templateRow({id:e.id,name:e.name}));i.on("click",function(){i.remove(),t._refresh()}),i.on("mouseover",function(){i.addClass("portlet-highlight")}),i.on("mouseout",function(){i.removeClass("portlet-highlight")}),this.portlet.append(i),this._refresh()}else this.message.update({message:"This "+this.name+" is already in the list."})},update:function(e){this.select.update(e)},_refresh:function(){this.$(".ui-list-id").length>0?(!this.multiple&&this.button.disable(),this.$(".ui-list-portlet").show()):(this.button.enable(),this.$(".ui-list-portlet").hide()),this.options.onchange&&this.options.onchange()},_template:function(e){return'<div class="ui-list"><div class="ui-margin-top"><span class="ui-list-button"/><span class="ui-list-select"/></div><div class="ui-list-message"/><div class="ui-list-portlet"/></div>'},_templateRow:function(e){return'<div id="'+e.id+'" class="ui-list-id"><span class="ui-list-delete fa fa-trash"/><span class="ui-list-name">'+e.name+"</span></div>"}});t.default={View:h}}).call(t,i(1),i(0))},304:function(e,t,i){"use strict";function s(e){new a.default.GalaxyApp(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.App=s;var n=i(305),a=function(e){return e&&e.__esModule?e:{default:e}}(n);window.adminToolshedApp=s},305:function(e,t,i){"use strict";(function(e){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(306),a=s(n),o=i(307),r=s(o),l=i(308),d=s(l),c=i(309),h=s(c),u=i(310),p=s(u),_=i(311),f=s(_),g=i(312),m=s(g),v=e.Router.extend({initialize:function(){this.routesHit=0,e.history.on("route",function(){this.routesHit++},this),this.bind("route",this.trackPageview)},routes:{"":"toolsheds",sheds:"toolsheds",queue:"queue",workflows:"workflows","status/r/:repositories":"status",status:"status","categories/s/:tool_shed":"categories","category/s/:tool_shed/c/:cateory_id":"repositories","repository/s/:tool_shed/r/:repository_id":"repository"},back:function(){this.routesHit>1?window.history.back():this.navigate("#",{trigger:!0,replace:!0})}}),b=e.View.extend({app_config:{known_views:["toolsheds","queue","status","categories","repositories","repoository"]},initialize:function(){Galaxy.admintoolshedapp=this,this.admin_toolshed_router=new v,this.admin_toolshed_router.on("route:queue",function(){Galaxy.admintoolshedapp.adminRepoQueueView?Galaxy.admintoolshedapp.adminRepoQueueView.reDraw():Galaxy.admintoolshedapp.adminRepoQueueView=new p.default.RepoQueueView}),this.admin_toolshed_router.on("route:toolsheds",function(){Galaxy.admintoolshedapp.adminShedListView?Galaxy.admintoolshedapp.adminShedListView.reDraw():Galaxy.admintoolshedapp.adminShedListView=new a.default.ShedListView}),this.admin_toolshed_router.on("route:categories",function(e){Galaxy.admintoolshedapp.adminShedCategoriesView?Galaxy.admintoolshedapp.adminShedCategoriesView.reDraw({tool_shed:e.replace(/\//g,"%2f")}):Galaxy.admintoolshedapp.adminShedCategoriesView=new r.default.CategoryView({tool_shed:e.replace(/\//g,"%2f")})}),this.admin_toolshed_router.on("route:repositories",function(e,t){Galaxy.admintoolshedapp.adminShedCategoryView?Galaxy.admintoolshedapp.adminShedCategoryView.reDraw({tool_shed:e.replace(/\//g,"%2f"),category_id:t}):Galaxy.admintoolshedapp.adminShedCategoryView=new d.default.Category({tool_shed:e.replace(/\//g,"%2f"),category_id:t})}),this.admin_toolshed_router.on("route:repository",function(e,t){Galaxy.admintoolshedapp.adminRepositoryView?Galaxy.admintoolshedapp.adminRepositoryView.reDraw({tool_shed:e.replace(/\//g,"%2f"),repository_id:t}):Galaxy.admintoolshedapp.adminRepositoryView=new h.default.RepoDetails({tool_shed:e.replace(/\//g,"%2f"),repository_id:t})}),this.admin_toolshed_router.on("route:status",function(e){Galaxy.admintoolshedapp.adminRepoStatusView?Galaxy.admintoolshedapp.adminRepoStatusView.reDraw({repositories:e.split("|")}):Galaxy.admintoolshedapp.adminRepoStatusView=new f.default.RepoStatus({repositories:e.split("|")})}),this.admin_toolshed_router.on("route:workflows",function(){Galaxy.admintoolshedapp.adminWorkflowsView?Galaxy.admintoolshedapp.adminWorkflowsView.reDraw():Galaxy.admintoolshedapp.adminWorkflowsView=new m.default.Workflows}),e.history.start({pushState:!1})}});t.default={GalaxyApp:b}}).call(t,i(1))},306:function(e,t,i){"use strict";(function(e,s){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(167),o=n(a),r=i(168),l=n(r),d=e.View.extend({defaults:{tool_sheds:[{url:"https://toolshed.g2.bx.psu.edu/",name:"Galaxy Main Tool Shed"}]},initialize:function(e){this.options=s.defaults(this.options||{},this.defaults),this.model=new o.default.ShedsCollection,this.listenTo(this.model,"sync",this.render),this.model.fetch()},el:"#center",render:function(e){this.options=s.defaults(this.options||{},e,this.defaults);var t=this.templateToolshedList;this.$el.html(t({title:"Configured Galaxy Tool Sheds",tool_sheds:this.model.models,queue:l.default.queueLength()}))},reDraw:function(e){this.$el.empty(),this.render(e)},templateToolshedList:s.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_toolsheds">','<div class="form-row">','<table class="grid">',"<% _.each(tool_sheds, function(shed) { %>",'<tr class="libraryTitle">',"<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a class="view-info shed-selector" href="#/categories/s/<%= shed.get("url") %>"><%= shed.get("name") %></a>',"</div>","</td>","</tr>","<% }); %>","</table>","</div>",'<div style="clear: both"></div>',"</div>"].join(""))});t.default={ShedListView:d}}).call(t,i(1),i(2))},307:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(167),r=a(o),l=i(168),d=a(l);i(157);var c=e.View.extend({el:"#center",defaults:{tool_shed:"https://toolshed.g2.bx.psu.edu/"},initialize:function(e){var t=e.tool_shed.replace(/\//g,"%2f");this.options=s.defaults(this.options||e,this.defaults),this.model=new r.default.Categories,this.listenTo(this.model,"sync",this.render),this.model.url=this.model.url+"?tool_shed_url="+this.options.tool_shed,this.model.tool_shed=t,this.model.fetch()},render:function(e){this.options=s.extend(this.options,e),this.options.categories=this.model.models,this.options.queue=d.default.queueLength();var t=this.templateCategoryList;this.$el.html(t(this.options)),n("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t=this;n("#search_box").autocomplete({source:function(e,i){var s=t.model.tool_shed.replace(/%2f/g,"/"),a=Galaxy.root+"api/tool_shed/search",o={term:e.term,tool_shed_url:s};n.post(a,o,function(e){console.log(e);var t=d.default.shedParser(e);i(t)})},minLength:3,select:function(i,s){var n=s.item.value,a=(Galaxy.root,t.model.tool_shed,"repository/s/"+t.model.tool_shed+"/r/"+n);e.history.navigate(a,{trigger:!0,replace:!0})}})},reDraw:function(e){this.$el.empty(),this.model.url=this.model.url+"?tool_shed_url="+this.options.tool_shed,this.initialize(e)},templateCategoryList:s.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner" style="layout: inline;">Categories in <%= tool_shed.replace(/%2f/g, "/") %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_categories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" name="search" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>",'<div style="clear: both; margin-top: 1em;">','<table class="grid">','<thead id="grid-table-header">',"<tr>","<th>Name</th>","<th>Description</th>","<th>Repositories</th>","</tr>","</thead>","<% _.each(categories, function(category) { %>","<tr>","<td>",'<a href="#/category/s/<%= tool_shed %>/c/<%= category.get("id") %>"><%= category.get("name") %></a>',"</td>",'<td><%= category.get("description") %></td>','<td><%= category.get("repositories") %></td>',"</tr>","<% }); %>","</table>","</div>","</div>"].join(""))});t.default={CategoryView:c}}).call(t,i(1),i(2),i(0))},308:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(167),r=a(o),l=i(168),d=a(l);i(157);var c=e.View.extend({el:"#center",initialize:function(e){this.model=new r.default.CategoryCollection,this.listenTo(this.model,"sync",this.render);var t=e.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url="+t+"&category_id="+e.category_id,this.model.tool_shed=t,this.model.category=e.category_id,this.model.fetch()},render:function(e){this.options=s.extend(this.options,e);var t=this.templateCategoryContents;this.$el.html(t({category:this.model.models[0],tool_shed:this.model.tool_shed,queue:d.default.queueLength()})),n("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){var t=this;n("#search_box").autocomplete({source:function(e,i){var s=t.model.tool_shed.replace(/%2f/g,"/"),a=Galaxy.root+"api/tool_shed/search",o={term:e.term,tool_shed_url:s};n.post(a,o,function(e){var t=d.default.shedParser(e);i(t)})},minLength:3,select:function(i,s){var n=s.item.value,a="repository/s/"+t.model.tool_shed+"/r/"+n;e.history.navigate(a,{trigger:!0,replace:!0})}})},reDraw:function(e){this.$el.empty(),this.initialize(e)},templateCategoryContents:s.template(['<style type="text/css">',".ui-autocomplete { background-color: #fff; }","li.ui-menu-item { list-style-type: none; }","</style>",'<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repositories in <%= category.get("name") %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="list_repositories">','<div id="standard-search" style="height: 2em; margin: 1em;">','<span class="ui-widget" >','<input class="search-box-input" id="search_box" name="search" data-shedurl="<%= tool_shed.replace(/%2f/g, "/") %>" placeholder="Search repositories by name or id" size="60" type="text" />',"</span>","</div>",'<div style="clear: both; margin-top: 1em;">','<table class="grid">','<thead id="grid-table-header">',"<tr>",'<th style="width: 10%;">Owner</th>','<th style="width: 15%;">Name</th>',"<th>Synopsis</th>",'<th style="width: 10%;">Type</th>',"</tr>","</thead>",'<% _.each(category.get("repositories"), function(repository) { %>',"<tr>","<td><%= repository.owner %></td>","<td>",'<div style="float: left; margin-left: 1px;" class="menubutton split">','<a href="#/repository/s/<%= tool_shed %>/r/<%= repository.id %>"><%= repository.name %></a>',"</div>","</td>","<td><%= repository.description %></td>","<td><%= repository.type %></td>","</tr>","<% }); %>","</table>","</div>","</div>"].join(""))});t.default={Category:c}}).call(t,i(1),i(2),i(0))},309:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(167),r=a(o),l=i(198),d=(a(l),i(3)),c=a(d),h=i(9),u=a(h),p=i(20),_=a(p),f=i(168),g=a(f),m=e.View.extend({el:"#center",initialize:function(e){this.options=s.defaults(this.options||{},this.defaults),this.model=new r.default.RepositoryCollection,this.listenTo(this.model,"sync",this.render);var t=e.tool_shed.replace(/\//g,"%2f");this.model.url+="?tool_shed_url="+t+"&repository_id="+e.repository_id,this.model.tool_shed_url=e.tool_shed.replace(/%2f/g,"/"),this.model.tool_shed=t,this.model.category=e.repository_id,this.model.fetch()},render:function(e){var t=this.templateRepoDetails,i=this.model.models[0];this.options={repository:i.get("repository"),tool_shed:this.model.tool_shed,queue:g.default.queueLength()};var a=Object.keys(this.options.repository.metadata);this.options.current_changeset=this.options.current_changeset||a[a.length-1],this.options.current_metadata=this.options.repository.metadata[this.options.current_changeset],this.options.current_metadata.tool_shed_url=this.model.tool_shed_url,this.options.tools=this.options.current_metadata.tools,this.options.repository_dependencies_template=this.templateRepoDependencies,this.options.repository_dependency_template=this.templateRepoDependency,this.options.tps_template_global_select=this.templateGlobalSectionSelect,this.options.tps_template_tool_select=this.templateToolSectionSelect,this.options.tps_select_options=this.templatePanelSelectOptions,this.options.tool_dependencies=i.get("tool_dependencies"),this.options.shed_tool_conf=this.templateShedToolConf({stc_html:i.get("shed_conf")}),this.options.panel_section_dict=i.get("panel_section_dict"),this.options.api_url=Galaxy.root+"api/tool_shed_repositories/install?async=True",this.options=s.extend(this.options,e),this.$el.html(t(this.options)),this.checkInstalled(this.options.current_metadata),this.bindEvents(),n("#center").css("overflow","auto")},bindEvents:function(){var e=this;n("#changeset").on("change",function(){e.options.current_changeset=n("#changeset").find("option:selected").text(),e.options.current_metadata=e.options.repository.metadata[e.options.current_changeset],e.checkInstalled(e.options.current_metadata),e.reDraw()}),n("#tool_panel_section_select").on("change",function(){e.tpsSelection()}),n("#install_repository").on("click",function(t){n("#repository_installation");t.preventDefault();var i={};i.repositories=JSON.stringify([[n("#install_repository").attr("data-tsrid"),n("#changeset").find("option:selected").val()]]),i.tool_shed_repository_ids=JSON.stringify([n("#install_repository").attr("data-tsrid")]),i.tool_shed_url=e.model.tool_shed_url,i.install_tool_dependencies=n("#install_tool_dependencies").val(),i.install_repository_dependencies=n("#install_repository_dependencies").val(),i.install_resolver_dependencies=n("#install_resolver_dependencies").val();e.panelSelect(i);i.tool_panel_section=JSON.stringify(e.panelSelect(i)),i.shed_tool_conf=n("select[name='shed_tool_conf']").find("option:selected").val(),i.changeset=n("#changeset").find("option:selected").val();var s=n("#repository_installation").attr("action");e.prepareInstall(i,s)}),n("#queue_install").on("click",function(t){e.options.current_changeset=n("#changeset").find("option:selected").text(),e.options.current_metadata=e.options.repository.metadata[e.options.current_changeset];var i=(e.options.current_changeset,{});s.each(Object.keys(e.options.current_metadata),function(t){i[t]||(i[t]=e.options.current_metadata[t])}),i.install_tool_dependencies=n("#install_tool_dependencies").val(),i.install_repository_dependencies=n("#install_repository_dependencies").val(),i.install_resolver_dependencies=n("#install_resolver_dependencies").val(),i.tool_panel_section=JSON.stringify(e.panelSelect({})),i.shed_tool_conf=n("select[name='shed_tool_conf']").find("option:selected").val(),i.tool_shed_url=e.model.tool_shed_url,"/"==i.tool_shed_url.substr(-1)&&(i.tool_shed_url=i.tool_shed_url.substr(0,i.tool_shed_url.length-1)),g.default.addToQueue(i),e.checkInstalled(i)}),n(".tool_panel_section_picker").on("change",function(){n(this).find("option:selected").val()==n("#tool_panel_section_select").find("option:selected").val()?n(this).attr("default","active"):n(this).removeAttr("default")}),n(function(){n("#repository_dependencies").jstree()}),n(".tool_form").on("click",function(){var t=n(this).attr("data-guid"),i=(n(this).attr("data-clean"),n(this).attr("data-name")),s=n(this).attr("data-desc"),a=e.model.tool_shed_url,o=n("#repository_details").attr("data-tsrid"),r=n("#changeset").find("option:selected").val(),l=Galaxy.root+"api/tool_shed/tool_json",d={guid:t,tool_shed_url:a,tsr_id:o,changeset:r};n.get(l,d,function(e){e.cls="ui-portlet-plain";var t=new _.default(e);c.default.deepeach(e.inputs,function(e){e.type&&-1!=["data","data_collection"].indexOf(e.type)&&(e.type="hidden",e.info="Data input '"+e.name+"' ("+c.default.textify(e.extensions)+")")});var n=new u.default.View,a="<u>"+i+"</u> "+s;n.show({closing_events:!0,title:a,body:t.$el,buttons:{Close:function(){n.hide()}}})})})},checkInstalled:function(e){var t=this,i={name:e.name,owner:e.owner},s=!1;t.repoQueued(e);n.get(Galaxy.root+"api/tool_shed_repositories",i,function(i){for(var a=0;a<i.length;a++){var o=i[a],r=!o.deleted&&!o.uninstalled,l=o.changeset_revision==e.changeset_revision||o.installed_changeset_revision==e.changeset_revision;o.name==e.repository.name&&o.owner==e.repository.owner&&r&&l&&(s=!0),s?(n("#install_repository").prop("disabled",!0),n("#install_repository").val("This revision is already installed")):(n("#install_repository").prop("disabled",!1),n("#install_repository").val("Install this revision"))}t.repoQueued(e)||s?(n("#queue_install").hide(),n("#queue_install").val("This revision is already in the queue")):(n("#queue_install").show(),n("#queue_install").val("Install this revision later"))})},panelSelect:function(e){var t={};return n("#tool_panel_section_select").length?e.tool_panel_section_id=n("#tool_panel_section_select").find("option:selected").val():e.new_tool_panel_section=n("#new_tool_panel_section").val(),n(".tool_panel_section_picker").each(function(){var e=n(this).attr("name"),i=n(this).attr("data-toolguid");t[i]="tool_panel_section_id"===e?{tool_panel_section:n(this).find("option:selected").val(),action:"append"}:{tool_panel_section:n(this).val(),action:"create"}}),t},reDraw:function(e){this.$el.empty(),this.initialize(e)},repoQueued:function(e){var t=this;if(localStorage.repositories){var i=(JSON.parse(localStorage.repositories),e.changeset_revision,t.queueKey(e));return localStorage.repositories&&(queued_repos=JSON.parse(localStorage.repositories)),!!queued_repos.hasOwnProperty(i)}},queueKey:function(e){var t=this.model.tool_shed_url;return"/"==t.substr(-1)&&(t=t.substr(0,t.length-1)),t+"|"+e.repository_id+"|"+e.changeset_revision},tpsSelection:function(){new_tps=n("#tool_panel_section_select").find("option:selected").val(),n('.tool_panel_section_picker[default="active"]').each(function(){n(this).val(new_tps)})},prepareInstall:function(e,t){var i=this;n.post(t,e,function(e){var t=JSON.parse(e);i.doInstall(t)})},doInstall:function(t){var i=Galaxy.root+"admin_toolshed/install_repositories",s=t.repositories,a="status/r/"+s.join("|");n.post(i,t,function(e){console.log("Initializing repository installation succeeded")}),e.history.navigate(a,{trigger:!0,replace:!0})},templateRepoDetails:s.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner">Repository information for <strong><%= repository.name %></strong> from <strong><%= repository.owner %></strong></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="unified-panel-body" id="repository_details" data-tsrid="<%= repository.id %>">','<form id="repository_installation" name="install_repository" method="post" action="<%= api_url %>">','<input type="hidden" id="repositories" name="<%= repository.id %>" value="ID" />','<input type="hidden" id="tool_shed_url" name="tool_shed_url" value="<%= tool_shed %>" />','<div class="toolForm">','<div class="toolFormTitle">Changeset</div>','<div class="toolFormBody changeset">','<select id="changeset" name="changeset" style="margin: 5px;">',"<% _.each(Object.keys(repository.metadata), function(changeset) { %>",'<% if (changeset == current_changeset) { var selected = "selected "; } else { var selected = ""; } %>','<option <%= selected %>value="<%= changeset.split(":")[1] %>"><%= changeset %></option>',"<% }); %>","</select>",'<input class="btn btn-primary preview-button" data-tsrid="<%= current_metadata.repository.id %>" type="submit" id="install_repository" name="install_repository" value="Install this revision now" />','<input class="btn btn-primary preview-button" type="button" id="queue_install" name="queue_install" value="Install this revision later" />','<div class="toolParamHelp" style="clear: both;">Please select a revision and review the settings below before installing.</div>',"</div>","</div>","<%= shed_tool_conf %>","<% if (current_metadata.has_repository_dependencies) { %>",'<div class="toolFormTitle">Repository dependencies for <strong id="current_changeset"><%= current_changeset %></strong></div>','<div class="toolFormBody">','<p id="install_repository_dependencies_checkbox">','<input type="checkbox" checked id="install_repository_dependencies" />','<label for="install_repository_dependencies">Install repository dependencies</label>',"</p>","<% current_metadata.repository_dependency_template = repository_dependency_template; %>",'<div class="tables container-table" id="repository_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="repository_dependencies_table">',"Repository dependencies &ndash; <em>installation of these additional repositories is required</em>","</a>","</div>","<%= repository_dependencies_template(current_metadata) %>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tool_dependencies) { %>",'<div class="toolFormTitle">Tool dependencies</div>','<div class="toolFormBody">','<p id="install_resolver_dependencies_checkbox">','<input type="checkbox" checked id="install_resolver_dependencies" />','<label for="install_resolver_dependencies">Install resolver dependencies</label>',"</p>",'<p id="install_tool_dependencies_checkbox">','<input type="checkbox" checked id="install_tool_dependencies" />','<label for="install_tool_dependencies">Install tool dependencies</label>',"</p>",'<div class="tables container-table" id="tool_dependencies">','<div class="expandLink">','<a class="toggle_folder" data_target="tool_dependencies_table">',"Tool dependencies &ndash; <em>repository tools require handling of these dependencies</em>","</a>","</div>",'<table class="tables container-table" id="tool_dependencies_table" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Version</th>","<th>Type</th>","</tr>","</thead>",'<tbody id="tool_deps">',"<% _.each(tool_dependencies[current_changeset], function(dependency) { %>",'<tr class="datasetRow tool_dependency_row" style="display: table-row;">','<td style="padding-left: 40px;">',"<%= dependency.name %></td>","<td><%= dependency.version %></td>","<td><%= dependency.type %></td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","<% if (current_metadata.includes_tools_for_display_in_tool_panel) { %>",'<div class="toolFormTitle">Tools &ndash; <em>click the name to preview the tool and use the pop-up menu to inspect all metadata</em></div>','<div class="toolFormBody">','<div class="tables container-table" id="tools_toggle">','<table class="tables container-table" id="valid_tools" border="0" cellpadding="2" cellspacing="2" width="100%">',"<thead>",'<tr style="display: table-row;" class="datasetRow" parent="0" id="libraryItem-rt-f9cad7b01a472135">','<th style="padding-left: 40px;">Name</th>',"<th>Description</th>","<th>Version</th>","<th><%= tps_template_global_select({tps: panel_section_dict, tps_select_options: tps_select_options}) %></tr>","</thead>",'<tbody id="tools_in_repo">',"<% _.each(current_metadata.tools, function(tool) { %>",'<tr id="libraryItem-<%= tool.clean %>" class="tool_row" style="display: table-row;" style="width: 15%">','<td style="padding-left: 40px;">','<div id="tool-<%= tool.clean %>" class="menubutton split popup" style="float: left;">','<a class="tool_form view-info" data-toggle="modal" data-target="toolform_<%= tool.clean %>" data-clean="<%= tool.clean %>" data-guid="<%= tool.guid %>" data-name="<%= tool.name %>" data-desc="<%= tool.description %>"><%= tool.name %></a>',"</div>","</td>","<td><%= tool.description %></td>",'<td style="width: 15%"><%= tool.version %></td>','<td style="width: 35%" id="tool_tps_<%= tool.clean %>">',"<%= tps_template_tool_select({tool: tool, tps: panel_section_dict, tps_select_options: tps_select_options}) %>","</td>","</tr>","<% }); %>","</tbody>","</table>","</div>","</div>","<% } %>","</form>","</div>"].join("")),templateRepoDependencies:s.template(['<div class="toolFormTitle">Repository Dependencies</div>','<div class="toolFormBody tables container-table" id="repository_dependencies">',"<ul>","<li>Repository installation requires the following","<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","<% } %>","</li>","</ul>","</div>"].join("")),templateRepoDependency:s.template(['<li id="metadata_<%= id %>" class="datasetRow repository_dependency_row">',"Repository <b><%= repository.name %></b> revision <b><%= changeset_revision %></b> owned by <b><%= repository.owner %></b>","<% if (has_repository_dependencies) { %>",'<ul class="child_dependencies">',"<% _.each(repository_dependencies, function(dependency) { %>","<% dependency.repository_dependency_template = repository_dependency_template; %>","<%= repository_dependency_template(dependency) %>","<% }); %>","</ul>","<% } %>","</li>"].join("")),templateShedToolConf:s.template(['<div class="toolFormTitle">Shed tool configuration file:</div>','<div class="toolFormBody">','<div class="form-row">',"<%= stc_html %>",'<div class="toolParamHelp" style="clear: both;">Select the file whose <b>tool_path</b> setting you want used for installing repositories.</div>',"</div>","</div>"].join("")),templateToolDependency:s.template(["<% if (has_repository_dependencies) { %>","<% _.each(repository_dependencies, function(dependency) { %>","<% if (dependency.includes_tool_dependencies) { %>","<% dependency.tool_dependency_template = tool_dependency_template %>","<%= tool_dependency_template(dependency) %>","<% } %>","<% }); %>","<% } %>"].join("")),templateGlobalSectionCreate:s.template(['<div id="tool_panel_section">','<div class="form-row" id="new_tps">','<input id="new_tool_panel_section" name="new_tool_panel_section" type="textfield" value="" size="40"/>','<input class="btn btn-primary" type="button" id="select_existing" value="Select existing" />','<div class="toolParamHelp" style="clear: both;">',"Add a new tool panel section to contain the installed tools (optional).","</div>","</div>","</div>"].join("")),templateGlobalSectionSelect:s.template(['<div id="tool_panel_section">','<div class="toolFormTitle">Tool Panel Section</div>','<div class="toolFormBody">','<div class="tab-pane" id="select_tps">','<select name="<%= name %>" id="<%= tps.id %>">',"<%= tps_select_options({sections: tps.sections}) %>","</select>",'<input class="btn btn-primary" type="button" id="create_new" value="Create new" />','<div class="toolParamHelp" style="clear: both;">',"Select an existing tool panel section to contain the installed tools (optional).","</div>","</div>","</div>","</div>"].join("")),templateToolSectionCreate:s.template(['<div id="new_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="form-row">','<input data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" size="40" name="new_tool_panel_section" id="new_tool_panel_section_<%= tool.clean %>" type="text">','<input id="per_tool_select_<%= tool.clean %>" class="btn btn-primary" data-toolguid="<%= tool.guid %>" value="Select existing" id="select_existing_<%= tool.clean %>" type="button">',"</div>"].join("")),templateToolSectionSelect:s.template(['<div id="select_tps_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="tps_creator">','<select default="active" style="width: 30em;" data-toolguid="<%= tool.guid %>" class="tool_panel_section_picker" name="tool_panel_section_id" id="tool_panel_section_select_<%= tool.clean %>">',"<%= tps_select_options({sections: tps.sections}) %>","</select>",'<input id="per_tool_create_<%= tool.clean %>" data-clean="<%= tool.clean %>" class="btn btn-primary create-tps-button" data-toolguid="<%= tool.guid %>" value="Create new" id="create_new_<%= tool.clean %>" type="button">','<div style="clear: both;" class="toolParamHelp"></div>',"</div>"].join("")),templatePanelSelectOptions:s.template(["<% _.each(sections, function(section) { %>",'<option value="<%= section.id %>"><%= section.name %></option>',"<% }); %>"].join(""))});t.default={RepoDetails:m}}).call(t,i(1),i(2),i(0))},310:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(167),r=a(o),l=i(168),d=a(l),c=e.View.extend({el:"#center",defaults:[{}],initialize:function(e){var t=this;this.model=new r.default.RepoQueue,this.listenTo(this.model,"sync",this.render),this.model.fetch(),t.render()},render:function(e){var t=this,i=t.templateRepoQueue,n=t.model.models;t.$el.html(i({title:"Repository Installation Queue",repositories:n,queue:d.default.queueLength()})),s("#center").css("overflow","auto"),t.bindEvents()},bindEvents:function(){var t=this;s(".install_one").on("click",function(){var e=t.loadFromQueue(s(this).attr("data-repokey"));t.installFromQueue(e,s(this).attr("data-repokey"))}),s(".remove_one").on("click",function(){var e=s(this).attr("data-repokey"),t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e)){var i=t[e].repository.id;delete t[e],s("#queued_repository_"+i).remove()}localStorage.repositories=JSON.stringify(t)}),s("#clear_queue").on("click",function(){localStorage.repositories="{}"}),s("#from_workflow").on("click",function(){e.history.navigate("workflows",{trigger:!0,replace:!0})})},installFromQueue:function(t,i){var n=Object();n.install_tool_dependencies=t.install_tool_dependencies,n.install_repository_dependencies=t.install_repository_dependencies,n.install_resolver_dependencies=t.install_resolver_dependencies,n.tool_panel_section=t.tool_panel_section,n.shed_tool_conf=t.shed_tool_conf,n.repositories=JSON.stringify([[t.repository.id,t.changeset_revision]]),n.tool_shed_repository_ids=JSON.stringify([t.repository.id]),n.tool_shed_url=i.split("|")[0],n.changeset=t.changeset_revision;var a=Galaxy.root+"api/tool_shed_repositories/install?async=True";if(s("#queued_repository_"+t.repository.id).remove(),localStorage.repositories){void 0===i&&(i=d.default.queueKey(t));var o=JSON.parse(localStorage.repositories);o.hasOwnProperty(i)&&(delete o[i],localStorage.repositories=JSON.stringify(o))}s.post(a,n,function(t){var i=JSON.parse(t),n=i.repositories,a="status/r/"+n.join("|");s.post(Galaxy.root+"admin_toolshed/install_repositories",i,function(e){console.log("Initializing repository installation succeeded")}),e.history.navigate(a,{trigger:!0,replace:!0})})},loadFromQueue:function(e){var t=JSON.parse(localStorage.repositories);if(t.hasOwnProperty(e))return t[e]},reDraw:function(e){this.$el.empty(),this.initialize(e),this.model.fetch(),this.render(e)},templateRepoQueue:n.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<div class="tab-pane" id="panel_header" id="repository_queue">','<table id="queued_repositories" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Revision</th>','<th class="datasetRow">ToolShed</th>','<th class="datasetRow">Install</th>','<th class="datasetRow"><input class="btn btn-primary" type="submit" id="clear_queue" name="clear_queue" value="Clear queue" /></th>',"</tr>","</thead>","<tbody>","<% _.each(repositories, function(repository) { %>",'<tr id="queued_repository_<%= repository.get("id") %>">','<td class="datasetRow"><%= repository.get("repository").name %></td>','<td class="datasetRow"><%= repository.get("repository").owner %></td>','<td class="datasetRow"><%= repository.get("changeset_revision") %></td>','<td class="datasetRow"><%= repository.get("tool_shed_url") %></td>','<td class="datasetRow">','<input class="btn btn-primary install_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="install_repository_<%= repository.get("id") %>" name="install_repository" value="Install now" />',"</td>",'<td class="datasetRow">','<input class="btn btn-primary remove_one" data-repokey="<%= repository.get("queue_key") %>" type="submit" id="unqueue_repository_<%= repository.get("id") %>" name="unqueue_repository" value="Remove from queue" />',"</td>","</tr>","<% }); %>","</tbody>","</table>",'<input type="button" class="btn btn-primary" id="from_workflow" value="Add from workflow" />',"</div>"].join(""))});t.default={RepoQueueView:c}}).call(t,i(1),i(0),i(2))},311:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(167),r=a(o),l=i(168),d=a(l),c=e.View.extend({el:"#center",initialize:function(e){this.options=s.defaults(this.options||[{}],e,this.defaults),this.model=new r.default.RepoStatus,this.listenTo(this.model,"sync",this.render),this.model.url+="?repositories="+this.options.repositories.join("|"),this.model.fetch(),this.timer=setInterval(function(e){var t=["installed","error"],i=!0;s.some(e.model.models,function(e){repo_id=e.get("id");var s=e.get("status").toLowerCase();if(-1===t.indexOf(s))return i=!1,!0}),i?clearInterval(e.timer):e.model.fetch()},2e3,this)},close:function(){clearInterval(this.timer)},render:function(e){this.options=s.extend(this.options,e);var t=this.templateRepoStatus;this.$el.html(t({title:"Repository Status",repositories:this.model.models,queue:d.default.queueLength()})),n("#center").css("overflow","auto"),this.bindEvents()},bindEvents:function(){},reDraw:function(e){this.$el.empty(),this.initialize(e)},templateRepoStatus:s.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".state-color-new,",".state-color-deactivated,",".state-color-uninstalled { border-color:#bfbfbf; background:#eee }",".state-color-cloning,",".state-color-setting-tool-versions,",".state-color-installing-repository-dependencies,",".state-color-installing-tool-dependencies,",".state-color-loading-proprietary-datatypes { border-color:#AAAA66; background:#FFFFCC }",".state-color-installed { border-color:#20b520; background:#b0f1b0 }",".state-color-error { border-color:#dd1b15; background:#f9c7c5 }","</style>",'<table id="grid-table" class="grid">','<thead id="grid-table-header">',"<tr>",'<th id="null-header">Name<span class="sort-arrow"></span></th>','<th id="null-header">Description<span class="sort-arrow"></span></th>','<th id="null-header">Owner<span class="sort-arrow"></span></th>','<th id="null-header">Revision<span class="sort-arrow"></span></th>','<th id="null-header">Installation Status<span class="sort-arrow"></span></th>',"</tr>","</thead>",'<tbody id="grid-table-body">',"<% _.each(repositories, function(repository) { %>","<tr>","<td>",'<div id="" class="">','<label id="repo-name-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("name") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-desc-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("description") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-user-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("owner") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="repo-changeset-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<%= repository.get("changeset_revision") %>',"</label>","</div>","</td>","<td>",'<div id="" class="">','<label id="RepositoryStatus-<%= repository.get("id") %>" for="<%= repository.get("id") %>">','<div class="repo-status count-box state-color-<%= repository.get("status").toLowerCase().replace(/ /g, "-") %>" id="RepositoryStatus-<%= repository.get("id") %>">','<%= repository.get("status") %>',"</div>","</label>","</div>","</td>","</tr>","<% }); %>","</tbody>",'<tfoot id="grid-table-footer"></tfoot>',"</table>"].join(""))});t.default={RepoStatus:c}}).call(t,i(1),i(2),i(0))},312:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(167),r=a(o),l=i(168),d=a(l),c=e.View.extend({el:"#center",defaults:[{}],initialize:function(e){var t=this;this.model=new r.default.WorkflowTools,this.listenTo(this.model,"sync",this.render),this.model.fetch(),t.render()},render:function(e){var t=this,i=t.templateWorkflows,n=t.model.models;t.$el.html(i({title:"Workflows Missing Tools",workflows:n,queue:d.default.queueLength()})),s("#center").css("overflow","auto"),t.bindEvents()},bindEvents:function(){var t,i=this;s(".show_wf_repo").on("click",function(){var i=s(this).attr("data-toolids"),n=s(this).attr("data-shed"),a=Galaxy.root+"api/tool_shed/repository",o={tool_ids:i};s.get(a,o,function(i){t=i.repository.id;var s="repository/s/"+n.replace(/:/g,"%3a").replace(/\//g,"%2f")+"/r/"+i.repository.id;e.history.navigate(s,{trigger:!0,replace:!0})})}),s(".queue_wf_repo").on("click",function(){var e=s(this),i=e.attr("data-toolids"),n=e.attr("data-shed"),a=Galaxy.root+"api/tool_shed/repository",o={tool_ids:i};s.get(a,o,function(i){t=i.repository.id,o={tool_shed_url:n,repository_id:t},s.get(a,o,function(t){var i=Object.keys(t.repository.metadata),s=i[0],a=t.repository.metadata[s];a.tool_shed_url=n,d.default.addToQueue(a),e.remove()})})}),s("#from_workflow").on("click",i.loadWorkflows)},reDraw:function(e){this.$el.empty(),this.initialize(e)},templateWorkflows:n.template(['<div class="unified-panel-header" id="panel_header" unselectable="on">','<div class="unified-panel-header-inner"><%= title %></div>','<div class="unified-panel-header-inner" style="position: absolute; right: 5px; top: 0px;"><a href="#/queue">Repository Queue (<%= queue %>)</a></div>',"</div>",'<style type="text/css">',".workflow_names, .workflow_tools { list-style-type: none; } ul.workflow_tools, ul.workflow_names {  padding-left: 0px; }","</style>",'<table id="workflows_missing_tools" class="grid" border="0" cellpadding="2" cellspacing="2" width="100%">','<thead id="grid-table-header">',"<tr>",'<th class="datasetRow">Workflows</th>','<th class="datasetRow">Tool IDs</th>','<th class="datasetRow">Shed</th>','<th class="datasetRow">Name</th>','<th class="datasetRow">Owner</th>','<th class="datasetRow">Actions</th>',"</tr>","</thead>","<tbody>","<% _.each(workflows, function(workflow) { %>","<tr>",'<td class="datasetRow">','<ul class="workflow_names">','<% _.each(workflow.get("workflows"), function(name) { %>','<li class="workflow_names"><%= name %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow">','<ul class="workflow_tools">','<% _.each(workflow.get("tools"), function(tool) { %>','<li class="workflow_tools"><%= tool %></li>',"<% }); %>","</ul>","</td>",'<td class="datasetRow"><%= workflow.get("shed") %></td>','<td class="datasetRow"><%= workflow.get("repository") %></td>','<td class="datasetRow"><%= workflow.get("owner") %></td>','<td class="datasetRow">','<ul class="workflow_tools">','<li class="workflow_tools">','<input type="button" class="show_wf_repo btn btn-primary" data-shed="<%= workflow.get("shed") %>" data-owner="<%= workflow.get("owner") %>" data-repo="<%= workflow.get("repository") %>" data-toolids="<%= workflow.get("tools").join(",") %>" value="Show Repository" /></li>',"</ul>","</td>","</tr>","<% }); %>","</ul>","</div>"].join(""))});t.default={Workflows:c}}).call(t,i(1),i(0),i(2))},4:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=(a(o),i(22)),l=a(r),d=i(46),c=a(d),h=i(23),u=a(h),p=i(47),_=a(p),f=i(12),g=a(f),m=i(9),v=a(m),b=e.View.extend({tagName:"label",initialize:function(t){this.model=t&&t.model||new e.Model(t),this.tagName=t.tagName||this.tagName,this.setElement(s("<"+this.tagName+"/>")),this.listenTo(this.model,"change",this.render,this),this.render()},title:function(e){this.model.set("title",e)},value:function(){return this.model.get("title")},render:function(){return this.$el.removeClass().addClass("ui-label").addClass(this.model.get("cls")).html(this.model.get("title")),this}}),y=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model({message:null,status:"info",cls:"",persistent:!1,fade:!0}).set(t),this.listenTo(this.model,"change",this.render,this),this.render()},update:function(e){this.model.set(e)},render:function(){this.$el.removeClass().addClass("ui-message").addClass(this.model.get("cls"));var e=this.model.get("status");if(this.model.get("large")?this.$el.addClass(("success"==e&&"done"||"danger"==e&&"error"||e)+"messagelarge"):this.$el.addClass("alert").addClass("alert-"+e),this.model.get("message")){if(this.$el.html(this.messageForDisplay()),this.$el[this.model.get("fade")?"fadeIn":"show"](),this.timeout&&window.clearTimeout(this.timeout),!this.model.get("persistent")){var t=this;this.timeout=window.setTimeout(function(){t.model.set("message","")},3e3)}}else this.$el.fadeOut();return this},messageForDisplay:function(){return n.escape(this.model.get("message"))}}),w=y.extend({messageForDisplay:function(){return this.model.get("message")}}),x=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model({type:"text",placeholder:"",disabled:!1,readonly:!1,visible:!0,cls:"",area:!1,color:null,style:null}).set(t),this.tagName=this.model.get("area")?"textarea":"input",this.setElement(s("<"+this.tagName+"/>")),this.listenTo(this.model,"change",this.render,this),this.render()},events:{input:"_onchange"},value:function(e){return void 0!==e&&this.model.set("value","string"==typeof e?e:""),this.model.get("value")},render:function(){var e=this;this.$el.removeClass().addClass("ui-"+this.tagName).addClass(this.model.get("cls")).addClass(this.model.get("style")).attr("id",this.model.id).attr("type",this.model.get("type")).attr("placeholder",this.model.get("placeholder")).css("color",this.model.get("color")||"").css("border-color",this.model.get("color")||"");var t=this.model.get("datalist");return s.isArray(t)&&t.length>0&&this.$el.autocomplete({source:function(t,i){i(e.model.get("datalist"))},change:function(){e._onchange()}}),this.model.get("value")!==this.$el.val()&&this.$el.val(this.model.get("value")),n.each(["readonly","disabled"],function(t){e.model.get(t)?e.$el.attr(t,!0):e.$el.removeAttr(t)}),this.$el[this.model.get("visible")?"show":"hide"](),this},_onchange:function(){this.value(this.$el.val()),this.model.get("onchange")&&this.model.get("onchange")(this.model.get("value"))}}),k=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model(t),this.setElement(s("<div/>").append(this.$info=s("<div/>")).append(this.$hidden=s("<div/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},value:function(e){return void 0!==e&&this.model.set("value",e),this.model.get("value")},render:function(){return this.$el.attr("id",this.model.id),this.$hidden.val(this.model.get("value")),this.model.get("info")?this.$info.show().text(this.model.get("info")):this.$info.hide(),this}}),j=e.View.extend({initialize:function(t){var i=this;this.model=t&&t.model||new e.Model(t),this.setElement(s("<div/>").append(this.$info=s("<div/>")).append(this.$file=s("<input/>").attr("type","file").addClass("ui-margin-bottom")).append(this.$text=s("<textarea/>").addClass("ui-textarea").attr("disabled",!0)).append(this.$wait=s("<i/>").addClass("fa fa-spinner fa-spin"))),this.listenTo(this.model,"change",this.render,this),this.$file.on("change",function(e){i._readFile(e)}),this.render()},value:function(e){return void 0!==e&&this.model.set("value",e),this.model.get("value")},render:function(){return this.$el.attr("id",this.model.id),this.model.get("info")?this.$info.show().text(this.model.get("info")):this.$info.hide(),this.model.get("value")?this.$text.text(this.model.get("value")).show():this.$text.hide(),this.model.get("wait")?this.$wait.show():this.$wait.hide(),this},_readFile:function(e){var t=this,i=e.target.files&&e.target.files[0];if(i){var s=new FileReader;s.onload=function(){t.model.set({wait:!1,value:this.result})},this.model.set({wait:!0,value:null}),s.readAsText(i)}}});t.default={Button:g.default.ButtonDefault,ButtonIcon:g.default.ButtonIcon,ButtonCheck:g.default.ButtonCheck,ButtonMenu:g.default.ButtonMenu,ButtonLink:g.default.ButtonLink,Input:x,Label:b,Message:y,UnescapedMessage:w,Upload:j,Modal:v.default,RadioButton:u.default.RadioButton,Checkbox:u.default.Checkbox,Radio:u.default.Radio,Select:l.default,Hidden:k,Slider:c.default,Drilldown:_.default}}).call(t,i(1),i(0),i(2))},43:function(e,t,i){"use strict";(function(e,s){Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=e.View.extend({initialize:function(e){this.options=a.default.merge(e,{content:"No content available.",onchange:null,ondblclick:null,onconfirm:null,cls:"ui-table",selectable:!0,cls_tr:""}),this.setElement(this._template()),this.$thead=this.$("thead"),this.$tbody=this.$("tbody"),this.$tmessage=this.$("tmessage"),this.row=this._row(),this.row_count=0},events:{click:"_onclick",dblclick:"_ondblclick"},addHeader:function(e){this.row.append(s("<th/>").append(e))},appendHeader:function(){this.$thead.append(this.row),this.row=s("<tr/>")},add:function(e,t,i){var n=s("<td/>");t&&n.css("width",t),i&&n.css("text-align",i),this.row.append(n.append(e))},append:function(e,t){this._commit(e,t,!1)},prepend:function(e,t){this._commit(e,t,!0)},get:function(e){return this.$("#"+e)},del:function(e){var t=this.$tbody.find("#"+e);t.length>0&&(t.remove(),this.row_count--,this._refresh())},delAll:function(){this.$tbody.empty(),this.row_count=0,this._refresh()},value:function(e){if(this.options.selectable){this.before=this.$tbody.find(".current").attr("id"),void 0!==e&&(this.$tbody.find("tr").removeClass("current"),e&&this.$tbody.find("#"+e).addClass("current"));var t=this.$tbody.find(".current").attr("id");return void 0===t?null:(t!=this.before&&this.options.onchange&&this.options.onchange(e),t)}},size:function(){return this.$tbody.find("tr").length},_commit:function(e,t,i){this.del(e),this.row.attr("id",e),i?this.$tbody.prepend(this.row):this.$tbody.append(this.row),t&&(this.row.hide(),this.row.fadeIn()),this.row=this._row(),this.row_count++,this._refresh()},_row:function(){return s('<tr class="'+this.options.cls_tr+'"></tr>')},_onclick:function(e){var t=this.value(),i=s(e.target).closest("tr").attr("id");""!=i&&i&&t!=i&&(this.options.onconfirm?this.options.onconfirm(i):this.value(i))},_ondblclick:function(e){var t=this.value();t&&this.options.ondblclick&&this.options.ondblclick(t)},_refresh:function(){0==this.row_count?this.$tmessage.show():this.$tmessage.hide()},_template:function(){return'<div><table class="'+this.options.cls+'"><thead/><tbody/></table><tmessage>'+this.options.content+"</tmessage><div>"}});t.default={View:o}}).call(t,i(1),i(0))},44:function(e,t,i){"use strict";(function(e,s,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),o=(function(e){e&&e.__esModule}(a),e.Model.extend({initialize:function(e){this.app=e},checksum:function(){var e="",t=this;return this.app.section.$el.find(".section-row").each(function(){var i=s(this).attr("id"),n=t.app.field_list[i];n&&(e+=i+":"+JSON.stringify(n.value&&n.value())+":"+n.collapsed+";")}),e},create:function(){function e(e,t,s){i.flat_dict[e]=t,n[e]=s,i.app.element_list[t]&&i.app.element_list[t].$el.attr("tour_id",e)}function t(s,n){for(var a in n){var o=n[a];if(o.input){var l=o.input,d=s;switch(""!=s&&(d+="|"),d+=l.name,l.type){case"repeat":var c=[],h=null;for(var u in o){var p=u.indexOf("section-");-1!=p&&(p+="section-".length,c.push(parseInt(u.substr(p))),h||(h=u.substr(0,p)))}c.sort(function(e,t){return e-t});var a=0;for(var _ in c)t(d+"_"+a++,o[h+c[_]]);break;case"conditional":var f=i.app.field_list[l.id].value();e(d+"|"+l.test_param.name,l.id,f);var g=r(l,f);-1!=g&&t(d,n[l.id+"-section-"+g]);break;case"section":t(!l.flat&&d||"",o);break;default:var m=i.app.field_list[l.id];if(m&&m.value){var f=m.value();if((void 0===l.ignore||l.ignore!=f)&&(m.collapsed&&l.collapsible_value&&(f=l.collapsible_value),e(d,l.id,f),l.payload))for(var v in l.payload)e(v,l.id,l.payload[v])}}}}}var i=this,s={};this._iterate(this.app.section.$el,s);var n={};return this.flat_dict={},t("",s),n},match:function(e){return this.flat_dict&&this.flat_dict[e]},matchCase:function(e,t){return r(e,t)},matchModel:function(e,t){var i=this;l(e.inputs,function(e,s){i.flat_dict[s]&&t(e,i.flat_dict[s])})},matchResponse:function(e){function t(e,n){if("string"==typeof n){var a=s.flat_dict[e];a&&(i[a]=n)}else for(var o in n){var r=o;if(""!==e){var l="|";n instanceof Array&&(l="_"),r=e+l+r}t(r,n[o])}}var i={},s=this;return t("",e),i},_iterate:function(e,t){var i=this;s(e).children().each(function(){var e=this,n=s(e).attr("id");if(s(e).hasClass("section-row")){var a=i.app.input_list[n];t[n]=a&&{input:a}||{},i._iterate(e,t[n])}else i._iterate(e,t)})}})),r=function(e,t){"boolean"==e.test_param.type&&(t="true"==t?e.test_param.truevalue||"true":e.test_param.falsevalue||"false");for(var i in e.cases)if(e.cases[i].value==t)return i;return-1},l=function e(t,i,a,o){o=s.extend(!0,{},o),n.each(t,function(e){e&&e.type&&e.name&&(o[e.name]=e)});for(var l in t){var d=t[l];d.name=d.name||l;var c=a?a+"|"+d.name:d.name;switch(d.type){case"repeat":n.each(d.cache,function(t,s){e(t,i,c+"_"+s,o)});break;case"conditional":if(d.test_param){i(d.test_param,c+"|"+d.test_param.name,o);var h=r(d,d.test_param.value);-1!=h?e(d.cases[h].inputs,i,c,o):Galaxy.emit.debug("form-data::visitInputs() - Invalid case for "+c+".")}else Galaxy.emit.debug("form-data::visitInputs() - Conditional test parameter missing for "+c+".");break;case"section":e(d.inputs,i,c,o);break;default:i(d,c,o)}}};t.default={Manager:o,visitInputs:l}}).call(t,i(1),i(0),i(2))},46:function(e,t,i){"use strict";(function(e,s){Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=e.View.extend({initialize:function(t){var i=this;this.model=t&&t.model||new e.Model({id:a.default.uid(),min:null,max:null,step:null,precise:!1,split:1e4,value:null,onchange:function(){}}).set(t),this.setElement(this._template()),this.$el.attr("id",this.model.id),this.$text=this.$(".ui-form-slider-text"),this.$slider=this.$(".ui-form-slider-element");var n=[];this.$text.on("change",function(){i.value(s(this).val())}).on("keyup",function(e){n[e.which]=!1}).on("keydown",function(e){var t=e.which;n[t]=!0,i.model.get("is_workflow")&&n[16]&&52==t?(i.value("$"),event.preventDefault()):8==t||9==t||13==t||37==t||39==t||t>=48&&t<=57&&!n[16]||t>=96&&t<=105||(190==t||110==t)&&-1==s(this).val().indexOf(".")&&i.model.get("precise")||(189==t||109==t)&&-1==s(this).val().indexOf("-")||i._isParameter(s(this).val())||n[91]||n[17]||event.preventDefault()});var o=this.model.attributes;this.has_slider=null!==o.max&&null!==o.min&&o.max>o.min;var r=o.step;r||(r=o.precise&&this.has_slider?(o.max-o.min)/o.split:1),this.has_slider?(this.$text.addClass("ui-form-slider-left"),this.$slider.slider({min:o.min,max:o.max,step:r}).on("slide",function(e,t){i.value(t.value)})):this.$slider.hide(),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var e=this.model.get("value");this.has_slider&&this.$slider.slider("value",e),e!==this.$text.val()&&this.$text.val(e)},value:function(e){var t=this.model.attributes;return void 0!==e&&(null===e||""===e||this._isParameter(e)||(isNaN(e)&&(e=0),!t.precise&&(e=Math.round(e)),null!==t.max&&(e=Math.min(e,t.max)),null!==t.min&&(e=Math.max(e,t.min))),this.model.set("value",e),this.model.trigger("change"),t.onchange(e)),this.model.get("value")},_isParameter:function(e){return this.model.get("is_workflow")&&"$"===String(e).substring(0,1)},_template:function(){return'<div class="ui-form-slider"><input class="ui-form-slider-text" type="text"/><div class="ui-form-slider-element"/></div>'}});t.default={View:o}}).call(t,i(1),i(0))},47:function(e,t,i){"use strict";(function(e,s){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),o=n(a),r=i(23),l=n(r),d=l.default.BaseIcons.extend({initialize:function(e){e.type=e.display||"checkbox",e.multiple="checkbox"==e.type,l.default.BaseIcons.prototype.initialize.call(this,e)},_setValue:function(t){if(l.default.BaseIcons.prototype._setValue.call(this,t),void 0!==t&&null!==t&&this.header_index){var i=this,n=e.isArray(t)?t:[t];s.each(n,function(e){var t=i.header_index[e];s.each(t,function(e){i._setState(e,!0)})})}},_setState:function(e,t){var i=this.$(".button-"+e),s=this.$(".subgroup-"+e);i.data("is_expanded",t),t?(s.show(),i.removeClass("fa-plus-square").addClass("fa-minus-square")):(s.hide(),i.removeClass("fa-minus-square").addClass("fa-plus-square"))},_templateOptions:function(){function t(e,t){var i=e.find(".button-"+t);i.on("click",function(){s._setState(t,!i.data("is_expanded"))})}function i(n,a,r){r=r||[];for(var l in a){var d=a[l],c=d.options&&d.options.length>0,h=r.slice(0);s.header_index[d.value]=h.slice(0);var u=e("<div/>");if(c){var p=o.default.uid(),_=e("<span/>").addClass("button-"+p).addClass("ui-drilldown-button fa fa-plus-square"),f=e("<div/>").addClass("subgroup-"+p).addClass("ui-drilldown-subgroup");u.append(e("<div/>").append(_).append(s._templateOption({label:d.name,value:d.value}))),h.push(p),i(f,d.options,h),u.append(f),t(u,p)}else u.append(s._templateOption({label:d.name,value:d.value}));n.append(u)}}var s=this;this.header_index={};var n=e("<div/>");return i(n,this.model.get("data")),n},_template:function(){return e("<div/>").addClass("ui-options-list drilldown-container").attr("id",this.model.id)}});t.default={View:d}}).call(t,i(0),i(2))},48:function(e,t,i){"use strict";(function(e,s,n,a){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(3),l=o(r),d=i(4),c=(o(d),i(11)),h=o(c),u=i(49),p=o(u),_=i(50),f=o(_),g=i(51),m=o(g),v=e.View.extend({initialize:function(e,t){this.app=e,this.inputs=t.inputs,this.parameters=new m.default,this.setElement(s("<div/>")),this.render()},render:function(){var e=this;this.$el.empty(),n.each(this.inputs,function(t){e.add(t)})},add:function(e){var t=a.extend(!0,{},e);switch(t.id=e.id=l.default.uid(),this.app.input_list[t.id]=t,t.type){case"conditional":this._addConditional(t);break;case"repeat":this._addRepeat(t);break;case"section":this._addSection(t);break;default:this._addRow(t)}},_addConditional:function(e){var t=this;e.test_param.id=e.id,this.app.model.get("sustain_conditionals")&&(e.test_param.disabled=!0);var i=this._addRow(e.test_param);i.model&&i.model.set("onchange",function(i){var s=t.app.data.matchCase(e,i);for(var n in e.cases){var a=e.cases[n],o=t.$("#"+e.id+"-section-"+n),r=!1;for(var l in a.inputs)if(!a.inputs[l].hidden){r=!0;break}n==s&&r?o.fadeIn("fast"):o.hide()}t.app.trigger("change")});for(var s in e.cases){var n=new v(this.app,{inputs:e.cases[s].inputs});this._append(n.$el.addClass("ui-form-section"),e.id+"-section-"+s)}i.trigger("change")},_addRepeat:function(e){function t(t){var n=e.id+"-section-"+s++,o=new v(i.app,{inputs:t});a.add({id:n,$el:o.$el,ondel:function(){a.del(n),i.app.trigger("change")}})}for(var i=this,s=0,a=new p.default.View({title:e.title||"Repeat",min:e.min,max:e.max,onnew:function(){t(e.inputs),i.app.trigger("change")}}),o=n.size(e.cache),r=0;r<Math.max(Math.max(o,e.min||0),e.default||0);r++)t(r<o?e.cache[r]:e.inputs);this.app.model.get("sustain_repeats")&&a.hideOptions();var l=new f.default(this.app,{label:e.title||e.name,help:e.help,field:a});this._append(l.$el,e.id)},_addSection:function(e){var t=new h.default.View({title:e.title||e.name,cls:"ui-portlet-section",collapsible:!0,collapsible_button:!0,collapsed:!e.expanded});t.append(new v(this.app,{inputs:e.inputs}).$el),t.append(s("<div/>").addClass("ui-form-info").html(e.help)),this.app.on("expand",function(e){t.$("#"+e).length>0&&t.expand()}),this._append(t.$el,e.id)},_addRow:function(e){var t=this,i=e.id;e.onchange=e.onchange||function(){t.app.trigger("change",i)};var s=this.parameters.create(e);this.app.field_list[i]=s;var n=new f.default(this.app,{name:e.name,label:e.hide_label?"":e.label||e.name,value:e.value,text_value:e.text_value,collapsible_value:e.collapsible_value,collapsible_preview:e.collapsible_preview,help:e.help,argument:e.argument,disabled:e.disabled,color:e.color,style:e.style,backdrop:e.backdrop,hidden:e.hidden,fixed:e.fixed,field:s});return this.app.element_list[i]=n,this._append(n.$el,e.id),s},_append:function(e,t){this.$el.append(e.addClass("section-row").attr("id",t))}});t.default={View:v}}).call(t,i(1),i(0),i(2),i(0))},49:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=a(o),l=i(11),d=a(l),c=i(4),h=a(c),u=e.View.extend({initialize:function(e){this.list={},this.options=r.default.merge(e,{title:"Repeat",empty_text:"Not available.",max:null,min:null}),this.button_new=new h.default.ButtonIcon({icon:"fa-plus",title:"Insert "+this.options.title,tooltip:"Add new "+this.options.title+" block",cls:"ui-button-icon ui-clear-float form-repeat-add",onclick:function(){e.onnew&&e.onnew()}}),this.setElement(s("<div/>").append(this.$list=s("<div/>")).append(s("<div/>").append(this.button_new.$el)))},size:function(){return n.size(this.list)},add:function(e){if(!e.id||this.list[e.id])return void Galaxy.emit.debug("form-repeat::add()","Duplicate or invalid repeat block id.");var t=new h.default.ButtonIcon({icon:"fa-trash-o",tooltip:"Delete this repeat block",cls:"ui-button-icon-plain form-repeat-delete",onclick:function(){e.ondel&&e.ondel()}}),i=new d.default.View({id:e.id,title:"placeholder",cls:e.cls||"ui-portlet-repeat",operations:{button_delete:t}});i.append(e.$el),i.$el.addClass("section-row").hide(),this.list[e.id]=i,this.$list.append(i.$el.fadeIn("fast")),this.options.max>0&&this.size()>=this.options.max&&this.button_new.disable(),this._refresh()},del:function(e){if(!this.list[e])return void Galaxy.emit.debug("form-repeat::del()","Invalid repeat block id.");this.$list.find("#"+e).remove(),delete this.list[e],this.button_new.enable(),this._refresh()},delAll:function(){for(var e in this.list)this.del(e)},hideOptions:function(){this.button_new.$el.hide(),n.each(this.list,function(e){e.hideOperation("button_delete")}),n.isEmpty(this.list)&&this.$el.append(s("<div/>").addClass("ui-form-info").html(this.options.empty_text))},_refresh:function(){var e=0;for(var t in this.list){var i=this.list[t];i.title(++e+": "+this.options.title),i[this.size()>this.options.min?"showOperation":"hideOperation"]("button_delete")}}});t.default={View:u}}).call(t,i(1),i(0),i(2))},50:function(e,t,i){"use strict";(function(e,i,s){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e.View.extend({initialize:function(t,i){this.app=t,this.app_options=t.model?t.model.attributes:{},this.field=i&&i.field||new e.View,this.model=i&&i.model||new e.Model({text_enable:this.app_options.text_enable||"Enable",text_disable:this.app_options.text_disable||"Disable",cls_enable:this.app_options.cls_enable||"fa fa-caret-square-o-down",cls_disable:this.app_options.cls_disable||"fa fa-caret-square-o-up",always_refresh:this.app_options.always_refresh}).set(i),this.setElement(this._template()),this.$field=this.$(".ui-form-field"),this.$info=this.$(".ui-form-info"),this.$preview=this.$(".ui-form-preview"),this.$collapsible=this.$(".ui-form-collapsible"),this.$collapsible_text=this.$(".ui-form-collapsible-text"),this.$collapsible_icon=this.$(".ui-form-collapsible-icon"),this.$title=this.$(".ui-form-title"),this.$title_text=this.$(".ui-form-title-text"),this.$error_text=this.$(".ui-form-error-text"),this.$error=this.$(".ui-form-error"),this.$backdrop=this.$(".ui-form-backdrop"),this.$field.prepend(this.field.$el);var s=this.model.get("collapsible_value");this.field.collapsed=void 0!==s&&JSON.stringify(this.model.get("value"))==JSON.stringify(s),this.listenTo(this.model,"change",this.render,this),this.render();var n=this;this.$collapsible.on("click",function(){n.field.collapsed=!n.field.collapsed,t.trigger&&t.trigger("change"),n.render()}),this.field.model&&!this.model.get("always_refresh")&&this.listenTo(this.field.model,"change:value",function(){n.reset()})},backdrop:function(){this.model.set("backdrop",!0)},error:function(e){this.model.set("error_text",e)},reset:function(){!this.model.get("fixed")&&this.model.set("error_text",null)},render:function(){i(".tooltip").hide();var e=this.model.get("help",""),t=this.model.get("argument");t&&-1==e.indexOf("("+t+")")&&(e+=" ("+t+")"),this.$info.html(e),this.$el[this.model.get("hidden")?"hide":"show"](),this.$preview[this.field.collapsed&&this.model.get("collapsible_preview")||this.model.get("disabled")?"show":"hide"]().html(s.escape(this.model.get("text_value")));var n=this.model.get("error_text");if(this.$error[n?"show":"hide"](),this.$el[n?"addClass":"removeClass"]("ui-error"),this.$error_text.html(n),this.$backdrop[this.model.get("backdrop")?"show":"hide"](),this.field.collapsed||this.model.get("disabled")?this.$field.hide():this.$field.show(),this.field.model&&this.field.model.set({color:this.model.get("color"),style:this.model.get("style")}),this.model.get("disabled")||void 0===this.model.get("collapsible_value"))this.$title_text.show().text(this.model.get("label")),this.$collapsible.hide();else{var a=this.field.collapsed?"enable":"disable";this.$title_text.hide(),this.$collapsible.show(),this.$collapsible_text.text(this.model.get("label")),this.$collapsible_icon.removeClass().addClass("icon").addClass(this.model.get("cls_"+a)).attr("data-original-title",this.model.get("text_"+a)).tooltip({placement:"bottom"})}},_template:function(){return i("<div/>").addClass("ui-form-element").append(i("<div/>").addClass("ui-form-error ui-error").append(i("<span/>").addClass("fa fa-arrow-down")).append(i("<span/>").addClass("ui-form-error-text"))).append(i("<div/>").addClass("ui-form-title").append(i("<div/>").addClass("ui-form-collapsible").append(i("<i/>").addClass("ui-form-collapsible-icon")).append(i("<span/>").addClass("ui-form-collapsible-text"))).append(i("<span/>").addClass("ui-form-title-text"))).append(i("<div/>").addClass("ui-form-field").append(i("<span/>").addClass("ui-form-info")).append(i("<div/>").addClass("ui-form-backdrop"))).append(i("<div/>").addClass("ui-form-preview"))}})}).call(t,i(1),i(0),i(2))},51:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=a(o),l=i(4),d=a(l),c=i(52),h=a(c),u=i(53),p=a(u),_=i(54),f=a(_),g=i(55),m=a(g),v=i(57),b=a(v);t.default=e.Model.extend({types:{text:"_fieldText",password:"_fieldText",select:"_fieldSelect",data_column:"_fieldSelect",genomebuild:"_fieldSelect",data:"_fieldData",data_collection:"_fieldData",integer:"_fieldSlider",float:"_fieldSlider",boolean:"_fieldBoolean",drill_down:"_fieldDrilldown",color:"_fieldColor",hidden:"_fieldHidden",hidden_data:"_fieldHidden",baseurl:"_fieldHidden",library_data:"_fieldLibrary",ftpfile:"_fieldFtp",upload:"_fieldUpload",genomespacefile:"_fieldGenomeSpace"},create:function(e){var t=this.types[e.type],i="function"==typeof this[t]?this[t].call(this,e):null;return i||(i=e.options?this._fieldSelect(e):this._fieldText(e),Galaxy.emit.debug("form-parameters::_addRow()","Auto matched field type ("+e.type+").")),void 0===e.value&&(e.value=null),i.value(e.value),i},_fieldData:function(e){return new h.default.View({id:"field-"+e.id,extensions:e.extensions,optional:e.optional,multiple:e.multiple,type:e.type,flavor:e.flavor,data:e.options,onchange:e.onchange})},_fieldSelect:function(e){if(e.is_workflow)return this._fieldText(e);"data_column"==e.type&&(e.error_text="Missing columns in referenced dataset.");var t=e.data;t||(t=[],s.each(e.options,function(e){t.push({label:e[0],value:e[1]})}));var i=d.default.Select;switch(e.display){case"checkboxes":i=d.default.Checkbox;break;case"radio":i=d.default.Radio;break;case"radiobutton":i=d.default.RadioButton}return new i.View({id:"field-"+e.id,data:t,error_text:e.error_text||"No options available",readonly:e.readonly,multiple:e.multiple,optional:e.optional,onchange:e.onchange,individual:e.individual,searchable:"workflow"!==e.flavor})},_fieldDrilldown:function(e){return e.is_workflow?this._fieldText(e):new d.default.Drilldown.View({id:"field-"+e.id,data:e.options,display:e.display,optional:e.optional,onchange:e.onchange})},_fieldText:function(e){if(e.options&&e.data)if(e.area=e.multiple,r.default.isEmpty(e.value))e.value=null;else if(n.isArray(e.value)){var t="";for(var i in e.value){if(t+=String(e.value[i]),!e.multiple)break;t+="\n"}e.value=t}return new d.default.Input({id:"field-"+e.id,type:e.type,area:e.area,readonly:e.readonly,placeholder:e.placeholder,datalist:e.datalist,onchange:e.onchange})},_fieldSlider:function(e){return new d.default.Slider.View({id:"field-"+e.id,precise:"float"==e.type,is_workflow:e.is_workflow,min:e.min,max:e.max,onchange:e.onchange})},_fieldHidden:function(e){return new d.default.Hidden({id:"field-"+e.id,info:e.info})},_fieldBoolean:function(e){return new d.default.RadioButton.View({id:"field-"+e.id,data:[{label:"Yes",value:"true"},{label:"No",value:"false"}],onchange:e.onchange})},_fieldColor:function(e){return new b.default({id:"field-"+e.id,onchange:e.onchange})},_fieldLibrary:function(e){return new p.default.View({id:"field-"+e.id,optional:e.optional,multiple:e.multiple,onchange:e.onchange})},_fieldFtp:function(e){return new f.default.View({id:"field-"+e.id,optional:e.optional,multiple:e.multiple,onchange:e.onchange})},_fieldGenomeSpace:function(e){var t=this;return new m.default.View({id:"field-"+e.id,onchange:function(){t.app.trigger("change")}})},_fieldUpload:function(e){return new d.default.Upload({id:"field-"+e.id,onchange:e.onchange})}})}).call(t,i(1),i(2),i(0))},52:function(e,t,i){"use strict";(function(e,s,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=a(o),l=i(4),d=a(l),c=i(22),h=a(c),u={DISABLED:"disabled",ENABLED:"enabled",LINKED:"linked"},p={data:[{src:"hda",icon:"fa-file-o",tooltip:"Single dataset",multiple:!1,batch:u.DISABLED},{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:u.LINKED},{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:u.LINKED}],data_multiple:[{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:u.DISABLED},{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collections",multiple:!0,batch:u.DISABLED}],data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:u.DISABLED}],workflow_data:[{src:"hda",icon:"fa-file-o",tooltip:"Single dataset",multiple:!1,batch:u.DISABLED}],workflow_data_multiple:[{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:u.DISABLED}],workflow_data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:u.DISABLED}],module_data:[{src:"hda",icon:"fa-file-o",tooltip:"Single dataset",multiple:!1,batch:u.DISABLED},{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:u.ENABLED}],module_data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:u.DISABLED},{src:"hdca",icon:"fa-folder",tooltip:"Multiple collections",multiple:!0,batch:u.ENABLED}]},_=e.View.extend({initialize:function(t){var i=this;this.model=t&&t.model||new e.Model({src_labels:{hda:"dataset",hdca:"dataset collection"},pagelimit:100,statustimer:1e3}).set(t),this.setElement(s("<div/>").addClass("ui-select-content")),this.button_product=new d.default.RadioButton.View({value:"false",data:[{icon:"fa fa-chain",value:"false",tooltip:"Linked inputs will be run in matched order with other datasets e.g. use this for matching forward and reverse reads."},{icon:"fa fa-chain-broken",value:"true",tooltip:"Unlinked dataset inputs will be run against *all* other inputs."}]});var n=s("<div/>").addClass("ui-form-info").append(s("<i/>").addClass("fa fa-sitemap")).append(s("<span/>").html("This is a batch mode input field. Separate jobs will be triggered for each dataset selection."));this.$batch={linked:n.clone(),enabled:n.clone().append(s("<div/>").append(s("<div/>").addClass("ui-form-title").html("Batch options:")).append(this.button_product.$el)).append(s("<div/>").css("clear","both"))},this.$el.on("dragenter",function(e){this.lastenter=e.target,i.$el.addClass("ui-dragover")}).on("dragover",function(e){e.preventDefault()}).on("dragleave",function(e){this.lastenter===e.target&&i.$el.removeClass("ui-dragover")}).on("drop",function(e){i._handleDrop(e)}),this.history={},this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:current",this._changeCurrent,this),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:type change:optional change:multiple change:extensions",this._changeType,this),this.render(),this.on("change",function(){t.onchange&&t.onchange(i.value())})},render:function(){this._changeType(),this._changeValue(),this._changeWait()},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},update:function(e){this.model.set("data",e)},value:function(e){void 0!==e&&this.model.set("value",e);var t=this.model.get("current");if(this.config[t]){var i=this.fields[t].value();if(null!==i&&(i=s.isArray(i)?i:[i],i.length>0)){var n=this._batch({values:[]});for(var a in i){var o=this.history[i[a]+"_"+this.config[t].src];if(!o)return Galaxy.emit.debug("ui-select-content::value()","Requested details not found for '"+i[a]+"'."),null;n.values.push(o)}return n.values.sort(function(e,t){return e.hid-t.hid}),n}}else Galaxy.emit.debug("ui-select-content::value()","Invalid value/source '"+e+"'.");return null},_changeCurrent:function(){var e=this;n.each(this.fields,function(t,i){e.model.get("current")==i?(t.$el.show(),n.each(e.$batch,function(t,s){t[e.config[i].batch==s?"show":"hide"]()}),e.button_type.value(i)):t.$el.hide()})},_changeType:function(){var e=this,t=(this.model.get("flavor")?this.model.get("flavor")+"_":"")+String(this.model.get("type"))+(this.model.get("multiple")?"_multiple":"");p[t]?this.config=p[t]:(this.config=p.data,Galaxy.emit.debug("ui-select-content::_changeType()","Invalid configuration/type id '"+t+"'."));var i=e.model.get("data"),s=r.default.textify(this.model.get("extensions")),a=this.model.get("src_labels");this.fields=[],this.button_data=[],n.each(this.config,function(t,n){e.button_data.push({value:n,icon:t.icon,tooltip:t.tooltip}),e.fields.push(new h.default.View({optional:e.model.get("optional"),multiple:t.multiple,searchable:!t.multiple||i&&i[t.src]&&i[t.src].length>e.model.get("pagelimit"),individual:!0,error_text:"No "+(s?s+" ":"")+(a[t.src]||"content")+" available.",onchange:function(){e.trigger("change")}}))}),this.button_type=new d.default.RadioButton.View({value:this.model.get("current"),data:this.button_data,onchange:function(t){e.model.set("current",t),e.trigger("change")}}),this.$el.empty();var o=0;this.fields.length>1&&(this.$el.append(this.button_type.$el),o=Math.max(0,36*this.fields.length)+"px"),n.each(this.fields,function(t){e.$el.append(t.$el.css({"margin-left":o}))}),n.each(this.$batch,function(t,i){e.$el.append(t.css({"margin-left":o}))}),this.model.set("current",0),this._changeCurrent(),this._changeData()},_changeWait:function(){var e=this;n.each(this.fields,function(t){t[e.model.get("wait")?"wait":"unwait"]()})},_changeData:function(){var e=this.model.get("data"),t=this,i={};n.each(e,function(e,s){i[s]=[],n.each(e,function(e){i[s].push({hid:e.hid,keep:e.keep,label:e.hid+": "+e.name,value:e.id,tags:e.tags}),t.history[e.id+"_"+s]=e})}),n.each(this.config,function(e,s){i[e.src]&&t.fields[s].add(i[e.src],function(e,t){return t.hid-e.hid})})},_changeValue:function(){var e=this.model.get("value");if(e&&e.values&&e.values.length>0){var t=[];n.each(e.values,function(e){t.push(e.id)});for(var i=e.values[0].src,s=e.values.length>1,a=0;a<this.config.length;a++){var o=this.fields[a],r=this.config[a];if(r.src==i&&-1!==[s,!0].indexOf(r.multiple)){this.model.set("current",a),o.value(t);break}}}else n.each(this.fields,function(e){e.value(null)})},_handleDrop:function(e){try{var t=this.model.get("data"),i=this.model.get("current"),s=this.config[i],a=this.fields[i],o=JSON.parse(e.originalEvent.dataTransfer.getData("text"))[0],r=o.id,l="dataset"==o.history_content_type?"hda":"hdca",d={id:r,src:l};if(t&&n.findWhere(t[l],d)){if(s.src==l){var c=a.value();c&&s.multiple?-1==c.indexOf(r)&&c.push(r):c=r,a.value(c)}else this.model.set("value",{values:[d]}),this.model.trigger("change:value");this.trigger("change"),this._handleDropStatus("success")}else this._handleDropStatus("danger")}catch(e){this._handleDropStatus("danger")}e.preventDefault()},_handleDropStatus:function(e){var t=this;this.$el.removeClass("ui-dragover").addClass("ui-dragover-"+e),setTimeout(function(){t.$el.removeClass("ui-dragover-"+e)},this.model.get("statustimer"))},_batch:function(e){e.batch=!1;var t=this.model.get("current"),i=this.config[t];if("hdca"==i.src&&!i.multiple){var s=this.history[this.fields[t].value()+"_hdca"];s&&s.map_over_type&&(e.batch=!0)}return i.batch!=u.LINKED&&i.batch!=u.ENABLED||(e.batch=!0,i.batch==u.ENABLED&&"true"===this.button_product.value()&&(e.product=!0)),e}});t.default={View:_}}).call(t,i(1),i(0),i(2))},53:function(e,t,i){"use strict";(function(e){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),a=(s(n),i(4)),o=s(a),r=i(43),l=(s(r),i(24)),d=s(l),c=e.Collection.extend({url:Galaxy.root+"api/libraries?deleted=false"}),h=e.Collection.extend({initialize:function(){var t=this;this.config=new e.Model({library_id:null}),this.config.on("change",function(){t.fetch({reset:!0})})},url:function(){return Galaxy.root+"api/libraries/"+this.config.get("library_id")+"/contents"}}),u=e.View.extend({initialize:function(e){var t=this;this.libraries=new c,this.datasets=new h,this.options=e,this.library_select=new o.default.Select.View({onchange:function(e){t.datasets.config.set("library_id",e)}}),this.dataset_list=new d.default.View({name:"dataset",optional:e.optional,multiple:e.multiple,onchange:function(){t.trigger("change")}}),this.libraries.on("reset",function(){var e=[];t.libraries.each(function(t){e.push({value:t.id,label:t.get("name")})}),t.library_select.update(e)}),this.datasets.on("reset",function(){var e=[];null!==t.library_select.text()&&t.datasets.each(function(t){"file"===t.get("type")&&e.push({value:t.id,label:t.get("name")})}),t.dataset_list.update(e)}),this.on("change",function(){e.onchange&&e.onchange(t.value())}),this.setElement(this._template()),this.$(".library-select").append(this.library_select.$el),this.$el.append(this.dataset_list.$el),this.libraries.fetch({reset:!0,success:function(){t.library_select.trigger("change"),void 0!==t.options.value&&t.value(t.options.value)}})},value:function(e){return this.dataset_list.value(e)},_template:function(){return'<div class="ui-select-library"><div class="library ui-margin-bottom"><span class="library-title">Select Library</span><span class="library-select"/></div></div>'}});t.default={View:u}}).call(t,i(1))},54:function(e,t,i){"use strict";(function(e){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),a=s(n),o=i(24),r=s(o),l=e.View.extend({initialize:function(e){var t=this;this.ftpfile_list=new r.default.View({name:"file",optional:e.optional,multiple:e.multiple,onchange:function(){e.onchange&&e.onchange(t.value())}}),this.setElement(this.ftpfile_list.$el),a.default.get({url:Galaxy.root+"api/remote_files",success:function(e){var i=[];for(var s in e)i.push({value:e[s].path,label:e[s].path});t.ftpfile_list.update(i)}})},value:function(e){return this.ftpfile_list.value(e)}});t.default={View:l}}).call(t,i(1))},55:function(e,t,i){"use strict";(function(e){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),a=(s(n),i(4)),o=s(a),r=i(56),l=s(r),d=e.View.extend({initialize:function(e){var t=this;this.browse_button=new o.default.ButtonIcon({title:"Browse",icon:"fa fa-sign-in",tooltip:"Browse GenomeSpace",onclick:function(){t.browseGenomeSpace()}}),this.filename_textbox=new o.default.Input,this.token_textbox=new o.default.Input({type:"password"}),this.setElement(this._template(e)),this.$(".ui-gs-browse-button").append(this.browse_button.$el),this.$(".ui-gs-filename-textbox").append(this.filename_textbox.$el),this.$(".ui-gs-token-textbox").append(this.token_textbox.$el)},browseGenomeSpace:function(e){var t=this;l.default.openFileBrowser({successCallback:function(e){t.value(e.destination+"^"+e.token)}})},_template:function(e){return'<div class="ui-gs-select-file"><div class="ui-gs-browse-field"><span class="ui-gs-browse-button" /><span class="ui-gs-filename-textbox" /></div><div class="ui-gs-token-field"><span class=ui-gs-label"><div class="ui-gs-token-label">Token</div></span><span class="ui-gs-token-textbox" /></div></div>'},value:function(e){if(void 0===e)return this._getValue();this._setValue(e)},_getValue:function(){return this.filename_textbox.value()+"^"+this.token_textbox.value()},_setValue:function(e){e&&(values=e.split("^"),this.filename_textbox.value(values[0]),this.token_textbox.value(values[1]))}});t.default={View:d}}).call(t,i(1))},56:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={openFileBrowser:function(e){var t=window.Galaxy.config.genomespace_ui_url,i=t+"upload/loadUrlToGenomespace.html?getLocation=true",s=window.open(i,"GenomeSpace File Browser","height=360px,width=600px");successCalBack=e.successCallback,window.addEventListener("message",function(e){successCalBack(e.data)},!1),s.focus(),null!=e.errorCallback&&(s.setCallbackOnGSUploadError=config.errorCallback)}}},57:function(e,t,i){"use strict";(function(e,s){Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),a=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=e.View.extend({colors:{standard:["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"],base:["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],theme:[["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada"],["d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5"],["bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f"],["a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09"],["7f7f7e","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"]]},initialize:function(e){this.options=a.default.merge(e,{}),this.setElement(this._template()),this.$panel=this.$(".ui-color-picker-panel"),this.$view=this.$(".ui-color-picker-view"),this.$value=this.$(".ui-color-picker-value"),this.$header=this.$(".ui-color-picker-header"),this._build(),this.visible=!1,this.value(this.options.value),this.$boxes=this.$(".ui-color-picker-box");var t=this;this.$boxes.on("click",function(){t.value(s(this).css("background-color")),t.$header.trigger("click")}),this.$header.on("click",function(){t.visible=!t.visible,t.visible?t.$view.fadeIn("fast"):t.$view.fadeOut("fast")})},value:function(e){return void 0!==e&&null!==e&&(this.$value.css("background-color",e),this.$(".ui-color-picker-box").empty(),this.$(this._getValue()).html(this._templateCheck()),this.options.onchange&&this.options.onchange(e)),this._getValue()},_getValue:function(){var e=this.$value.css("background-color");if(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/)){var t=function(e){return("0"+parseInt(e).toString(16)).slice(-2)};return"#"+t(e[1])+t(e[2])+t(e[3])}return null},_build:function(){this._content({colors:this.colors.base});for(var e in this.colors.theme){var t={};0==e?t.bottom=!0:e!=this.colors.theme.length-1?(t.top=!0,t.bottom=!0):t.top=!0,t.colors=this.colors.theme[e],this._content(t)}this._content({colors:this.colors.standard})},_content:function(e){var t=e.colors,i=s(this._templateContent()),n=i.find(".line");this.$panel.append(i);for(var a in t){var o=s(this._templateBox(t[a]));e.top&&(o.css("border-top","none"),o.css("border-top-left-radius","0px"),o.css("border-top-right-radius","0px")),e.bottom&&(o.css("border-bottom","none"),o.css("border-bottom-left-radius","0px"),o.css("border-bottom-right-radius","0px")),n.append(o)}return i},_templateCheck:function(){return'<div class="ui-color-picker-check fa fa-check"/>'},_templateContent:function(){return'<div class="ui-color-picker-content"><div class="line"/></div>'},_templateBox:function(e){return'<div id="'+e+'" class="ui-color-picker-box" style="background-color: #'+e+';"/>'},_template:function(){return'<div class="ui-color-picker"><div class="ui-color-picker-header"><div class="ui-color-picker-value"/><div class="ui-color-picker-label">Select a color</div></div><div class="ui-color-picker-view ui-input"><div class="ui-color-picker-panel"/></div>'}})}).call(t,i(1),i(0))},9:function(e,t,i){"use strict";(function(e,i,s){Object.defineProperty(t,"__esModule",{value:!0});var n=e.View.extend({className:"ui-modal",optionsDefault:{container:"body",title:"ui-modal",cls:"ui-modal",body:"",backdrop:!0,height:null,width:null,closing_events:!1,closing_callback:null,title_separator:!0},buttonList:{},initialize:function(e){this.options=i.defaults(e||{},this.optionsDefault),s(this.options.container).prepend(this.el),e&&this.render()},show:function(e){if(e&&(this.options=i.defaults(e,this.optionsDefault),this.render()),!this.visible&&(this.visible=!0,this.$el.fadeIn("fast"),this.options.closing_events)){var t=this;s(document).on("keyup.ui-modal",function(e){27==e.keyCode&&t.hide(!0)}),this.$backdrop.on("click",function(){t.hide(!0)})}},hide:function(e){this.visible=!1,this.$el.fadeOut("fast"),this.options.closing_callback&&this.options.closing_callback(e),s(document).off("keyup.ui-modal"),this.$backdrop.off("click")},render:function(){var e=this;if(this.$el.html(this._template()),this.$header=this.$(".modal-header"),this.$dialog=this.$(".modal-dialog"),this.$body=this.$(".modal-body"),this.$footer=this.$(".modal-footer"),this.$backdrop=this.$(".modal-backdrop"),this.$buttons=this.$(".buttons"),"progress"==this.options.body&&(this.options.body=s('<div class="progress progress-striped active"><div class="progress-bar progress-bar-info" style="width:100%"/></div>')),this.$el.removeClass().addClass("modal").addClass(this.options.cls),this.$header.find(".title").html(this.options.title),this.$body.html(this.options.body),this.$buttons.empty(),this.buttonList={},this.options.buttons){var t=0;s.each(this.options.buttons,function(i,n){var a=s("<button/>").attr("id","button-"+t++).text(i).click(n);e.$buttons.append(a).append("&nbsp;"),e.buttonList[i]=a})}else this.$footer.hide();this.$backdrop[this.options.backdrop&&"addClass"||"removeClass"]("in"),this.$header[!this.options.title_separator&&"addClass"||"removeClass"]("no-separator"),this.$body.removeAttr("style"),this.options.height?(this.$body.css("height",this.options.height),this.$body.css("overflow","hidden")):this.$body.css("max-height",s(window).height()/2),this.options.width&&this.$dialog.css("width",this.options.width)},getButton:function(e){return this.buttonList[e]},enableButton:function(e){this.getButton(e).prop("disabled",!1)},disableButton:function(e){this.getButton(e).prop("disabled",!0)},showButton:function(e){this.getButton(e).show()},hideButton:function(e){this.getButton(e).hide()},scrollTop:function(){return this.$body.scrollTop()},_template:function(){return'<div class="modal-backdrop fade"/><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="title"/></div><div class="modal-body"/><div class="modal-footer"><div class="buttons"/></div></div></div>'}});t.default={View:n}}).call(t,i(1),i(2),i(0))}},[304]);