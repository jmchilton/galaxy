webpackJsonp([4],[,,,,function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=(a(o),n(22)),l=a(s),u=n(46),c=a(u),h=n(23),d=a(h),f=n(47),p=a(f),_=n(12),g=a(_),v=n(9),m=a(v),y=t.View.extend({tagName:"label",initialize:function(e){this.model=e&&e.model||new t.Model(e),this.tagName=e.tagName||this.tagName,this.setElement(i("<"+this.tagName+"/>")),this.listenTo(this.model,"change",this.render,this),this.render()},title:function(t){this.model.set("title",t)},value:function(){return this.model.get("title")},render:function(){return this.$el.removeClass().addClass("ui-label").addClass(this.model.get("cls")).html(this.model.get("title")),this}}),b=t.View.extend({initialize:function(e){this.model=e&&e.model||new t.Model({message:null,status:"info",cls:"",persistent:!1,fade:!0}).set(e),this.listenTo(this.model,"change",this.render,this),this.render()},update:function(t){this.model.set(t)},render:function(){this.$el.removeClass().addClass("ui-message").addClass(this.model.get("cls"));var t=this.model.get("status");if(this.model.get("large")?this.$el.addClass(("success"==t&&"done"||"danger"==t&&"error"||t)+"messagelarge"):this.$el.addClass("alert").addClass("alert-"+t),this.model.get("message")){if(this.$el.html(this.messageForDisplay()),this.$el[this.model.get("fade")?"fadeIn":"show"](),this.timeout&&window.clearTimeout(this.timeout),!this.model.get("persistent")){var e=this;this.timeout=window.setTimeout(function(){e.model.set("message","")},3e3)}}else this.$el.fadeOut();return this},messageForDisplay:function(){return r.escape(this.model.get("message"))}}),w=b.extend({messageForDisplay:function(){return this.model.get("message")}}),x=t.View.extend({initialize:function(e){this.model=e&&e.model||new t.Model({type:"text",placeholder:"",disabled:!1,readonly:!1,visible:!0,cls:"",area:!1,color:null,style:null}).set(e),this.tagName=this.model.get("area")?"textarea":"input",this.setElement(i("<"+this.tagName+"/>")),this.listenTo(this.model,"change",this.render,this),this.render()},events:{input:"_onchange"},value:function(t){return void 0!==t&&this.model.set("value","string"==typeof t?t:""),this.model.get("value")},render:function(){var t=this;this.$el.removeClass().addClass("ui-"+this.tagName).addClass(this.model.get("cls")).addClass(this.model.get("style")).attr("id",this.model.id).attr("type",this.model.get("type")).attr("placeholder",this.model.get("placeholder")).css("color",this.model.get("color")||"").css("border-color",this.model.get("color")||"");var e=this.model.get("datalist");return i.isArray(e)&&e.length>0&&this.$el.autocomplete({source:function(e,n){n(t.model.get("datalist"))},change:function(){t._onchange()}}),this.model.get("value")!==this.$el.val()&&this.$el.val(this.model.get("value")),r.each(["readonly","disabled"],function(e){t.model.get(e)?t.$el.attr(e,!0):t.$el.removeAttr(e)}),this.$el[this.model.get("visible")?"show":"hide"](),this},_onchange:function(){this.value(this.$el.val()),this.model.get("onchange")&&this.model.get("onchange")(this.model.get("value"))}}),k=t.View.extend({initialize:function(e){this.model=e&&e.model||new t.Model(e),this.setElement(i("<div/>").append(this.$info=i("<div/>")).append(this.$hidden=i("<div/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},value:function(t){return void 0!==t&&this.model.set("value",t),this.model.get("value")},render:function(){return this.$el.attr("id",this.model.id),this.$hidden.val(this.model.get("value")),this.model.get("info")?this.$info.show().text(this.model.get("info")):this.$info.hide(),this}}),C=t.View.extend({initialize:function(e){var n=this;this.model=e&&e.model||new t.Model(e),this.setElement(i("<div/>").append(this.$info=i("<div/>")).append(this.$file=i("<input/>").attr("type","file").addClass("ui-margin-bottom")).append(this.$text=i("<textarea/>").addClass("ui-textarea").attr("disabled",!0)).append(this.$wait=i("<i/>").addClass("fa fa-spinner fa-spin"))),this.listenTo(this.model,"change",this.render,this),this.$file.on("change",function(t){n._readFile(t)}),this.render()},value:function(t){return void 0!==t&&this.model.set("value",t),this.model.get("value")},render:function(){return this.$el.attr("id",this.model.id),this.model.get("info")?this.$info.show().text(this.model.get("info")):this.$info.hide(),this.model.get("value")?this.$text.text(this.model.get("value")).show():this.$text.hide(),this.model.get("wait")?this.$wait.show():this.$wait.hide(),this},_readFile:function(t){var e=this,n=t.target.files&&t.target.files[0];if(n){var i=new FileReader;i.onload=function(){e.model.set({wait:!1,value:this.result})},this.model.set({wait:!0,value:null}),i.readAsText(n)}}});e.default={Button:g.default.ButtonDefault,ButtonIcon:g.default.ButtonIcon,ButtonCheck:g.default.ButtonCheck,ButtonMenu:g.default.ButtonMenu,ButtonLink:g.default.ButtonLink,Input:x,Label:y,Message:b,UnescapedMessage:w,Upload:C,Modal:m.default,RadioButton:d.default.RadioButton,Checkbox:d.default.Checkbox,Radio:d.default.Radio,Select:l.default,Hidden:k,Slider:c.default,Drilldown:p.default}}).call(e,n(1),n(0),n(2))},function(t,e,n){"use strict";function i(t){return"[object Array]"===C.call(t)}function r(t){return"[object ArrayBuffer]"===C.call(t)}function a(t){return"undefined"!=typeof FormData&&t instanceof FormData}function o(t){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer&&t.buffer instanceof ArrayBuffer}function s(t){return"string"==typeof t}function l(t){return"number"==typeof t}function u(t){return void 0===t}function c(t){return null!==t&&"object"==typeof t}function h(t){return"[object Date]"===C.call(t)}function d(t){return"[object File]"===C.call(t)}function f(t){return"[object Blob]"===C.call(t)}function p(t){return"[object Function]"===C.call(t)}function _(t){return c(t)&&p(t.pipe)}function g(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}function v(t){return t.replace(/^\s*/,"").replace(/\s*$/,"")}function m(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function y(t,e){if(null!==t&&void 0!==t)if("object"==typeof t||i(t)||(t=[t]),i(t))for(var n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&e.call(null,t[a],a,t)}function b(){function t(t,n){"object"==typeof e[n]&&"object"==typeof t?e[n]=b(e[n],t):e[n]=t}for(var e={},n=0,i=arguments.length;n<i;n++)y(arguments[n],t);return e}function w(t,e,n){return y(e,function(e,i){t[i]=n&&"function"==typeof e?x(e,n):e}),t}var x=n(27),k=n(74),C=Object.prototype.toString;t.exports={isArray:i,isArrayBuffer:r,isBuffer:k,isFormData:a,isArrayBufferView:o,isString:s,isNumber:l,isObject:c,isUndefined:u,isDate:h,isFile:d,isBlob:f,isFunction:p,isStream:_,isURLSearchParams:g,isStandardBrowserEnv:m,forEach:y,merge:b,extend:w,trim:v}},function(t,e,n){"use strict";function i(t,e){return function(n){if(t.hasOwnProperty(n))return t[n];if(!e)throw new Error("I do not know how to modify the following string: "+n+". Change your TeX file or submit a feature request at https://github.com/digitalheir/tex-to-unicode/issues.");return n+e}}Object.defineProperty(e,"__esModule",{value:!0}),e.lookupOrAppend=i},,,function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0});var r=t.View.extend({className:"ui-modal",optionsDefault:{container:"body",title:"ui-modal",cls:"ui-modal",body:"",backdrop:!0,height:null,width:null,closing_events:!1,closing_callback:null,title_separator:!0},buttonList:{},initialize:function(t){this.options=n.defaults(t||{},this.optionsDefault),i(this.options.container).prepend(this.el),t&&this.render()},show:function(t){if(t&&(this.options=n.defaults(t,this.optionsDefault),this.render()),!this.visible&&(this.visible=!0,this.$el.fadeIn("fast"),this.options.closing_events)){var e=this;i(document).on("keyup.ui-modal",function(t){27==t.keyCode&&e.hide(!0)}),this.$backdrop.on("click",function(){e.hide(!0)})}},hide:function(t){this.visible=!1,this.$el.fadeOut("fast"),this.options.closing_callback&&this.options.closing_callback(t),i(document).off("keyup.ui-modal"),this.$backdrop.off("click")},render:function(){var t=this;if(this.$el.html(this._template()),this.$header=this.$(".modal-header"),this.$dialog=this.$(".modal-dialog"),this.$body=this.$(".modal-body"),this.$footer=this.$(".modal-footer"),this.$backdrop=this.$(".modal-backdrop"),this.$buttons=this.$(".buttons"),"progress"==this.options.body&&(this.options.body=i('<div class="progress progress-striped active"><div class="progress-bar progress-bar-info" style="width:100%"/></div>')),this.$el.removeClass().addClass("modal").addClass(this.options.cls),this.$header.find(".title").html(this.options.title),this.$body.html(this.options.body),this.$buttons.empty(),this.buttonList={},this.options.buttons){var e=0;i.each(this.options.buttons,function(n,r){var a=i("<button/>").attr("id","button-"+e++).text(n).click(r);t.$buttons.append(a).append("&nbsp;"),t.buttonList[n]=a})}else this.$footer.hide();this.$backdrop[this.options.backdrop&&"addClass"||"removeClass"]("in"),this.$header[!this.options.title_separator&&"addClass"||"removeClass"]("no-separator"),this.$body.removeAttr("style"),this.options.height?(this.$body.css("height",this.options.height),this.$body.css("overflow","hidden")):this.$body.css("max-height",i(window).height()/2),this.options.width&&this.$dialog.css("width",this.options.width)},getButton:function(t){return this.buttonList[t]},enableButton:function(t){this.getButton(t).prop("disabled",!1)},disableButton:function(t){this.getButton(t).prop("disabled",!0)},showButton:function(t){this.getButton(t).show()},hideButton:function(t){this.getButton(t).hide()},scrollTop:function(){return this.$body.scrollTop()},_template:function(){return'<div class="modal-backdrop fade"/><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="title"/></div><div class="modal-body"/><div class="modal-footer"><div class="buttons"/></div></div></div>'}});e.default={View:r}}).call(e,n(1),n(2),n(0))},function(t,e,n){"use strict";function i(t){return"("+t+")"}Object.defineProperty(e,"__esModule",{value:!0}),e.simpleSuffix=function(t){return function(e){return e+t}},e.isSingleTerm=/^.$|^[0-9]+$/,e.addParenthesis=i},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(4),u=a(l),c=t.View.extend({visible:!1,initialize:function(e){var n=this;this.model=e&&e.model||new t.Model({id:s.default.uid(),cls:"ui-portlet",title:"",icon:"",buttons:null,body:null,scrollable:!0,nopadding:!1,operations:null,collapsible:!1,collapsible_button:!1,collapsed:!1,onchange_title:null}).set(e),this.setElement(this._template()),this.$body=this.$(".portlet-body"),this.$title_text=this.$(".portlet-title-text"),this.$title_icon=this.$(".portlet-title-icon"),this.$header=this.$(".portlet-header"),this.$content=this.$(".portlet-content"),this.$backdrop=this.$(".portlet-backdrop"),this.$buttons=this.$(".portlet-buttons"),this.$operations=this.$(".portlet-operations"),this.model.get("body")&&this.append(this.model.get("body")),this.collapsible_button=new u.default.ButtonIcon({icon:"fa-eye",tooltip:"Collapse/Expand",cls:"ui-button-icon-plain",onclick:function(){n[n.collapsed?"expand":"collapse"]()}}),this.render()},render:function(){var t=this,e=this.model.attributes;return this.$el.removeClass().addClass(e.cls).attr("id",e.id),this.$header[e.title?"show":"hide"](),this.$title_text.html(e.title),i.each([this.$content,this.$body],function(t){t[e.nopadding?"addClass":"removeClass"]("no-padding")}),e.icon?this.$title_icon.removeClass().addClass("portlet-title-icon fa").addClass(e.icon).show():this.$title_icon.hide(),this.$title_text[e.collapsible?"addClass":"removeClass"]("no-highlight collapsible").off(),e.collapsible&&(this.$title_text.on("click",function(){t[t.collapsed?"expand":"collapse"]()}),e.collapsed?this.collapse():this.expand()),this.$title_text.prop("disabled",!e.onchange_title),e.onchange_title&&this.$title_text.make_text_editable({on_finish:function(t){e.onchange_title(t)}}),e.buttons?(this.$buttons.empty().show(),r.each(this.model.get("buttons"),function(e,n){n.$el.prop("id",e),t.$buttons.append(n.$el)})):this.$buttons.hide(),this.$operations.empty,e.collapsible_button&&this.$operations.append(this.collapsible_button.$el),e.operations&&r.each(e.operations,function(e,n){n.$el.prop("id",e),t.$operations.append(n.$el)}),this},append:function(t){this.$body.append(t)},empty:function(){this.$body.empty()},header:function(){return this.$header},body:function(){return this.$body},show:function(){this.visible=!0,this.$el.fadeIn("fast")},hide:function(){this.visible=!1,this.$el.hide()},enableButton:function(t){this.$buttons.find("#"+t).prop("disabled",!1)},disableButton:function(t){this.$buttons.find("#"+t).prop("disabled",!0)},hideOperation:function(t){this.$operations.find("#"+t).hide()},showOperation:function(t){this.$operations.find("#"+t).show()},setOperation:function(t,e){this.$operations.find("#"+t).off("click").on("click",e)},title:function(t){return t&&this.$title_text.html(t),this.$title_text.html()},collapse:function(){this.collapsed=!0,this.$content.height("0%"),this.$body.hide(),this.collapsible_button.setIcon("fa-eye-slash")},expand:function(){this.collapsed=!1,this.$content.height("100%"),this.$body.fadeIn("fast"),this.collapsible_button.setIcon("fa-eye")},disable:function(){this.$backdrop.show()},enable:function(){this.$backdrop.hide()},_template:function(){return r("<div/>").append(r("<div/>").addClass("portlet-header").append(r("<div/>").addClass("portlet-operations")).append(r("<div/>").addClass("portlet-title").append(r("<i/>").addClass("portlet-title-icon")).append(r("<span/>").addClass("portlet-title-text")))).append(r("<div/>").addClass("portlet-content").append(r("<div/>").addClass("portlet-body")).append(r("<div/>").addClass("portlet-buttons"))).append(r("<div/>").addClass("portlet-backdrop"))}});e.default={View:c}}).call(e,n(1),n(2),n(0))},function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=function(t){return t&&t.__esModule?t:{default:t}}(r),o=t.View.extend({initialize:function(e){this.model=e&&e.model||new t.Model({id:a.default.uid(),title:"",icon:"",cls:"btn btn-default",wait:!1,wait_text:"Sending...",wait_cls:"btn btn-info",disabled:!1,percentage:-1}).set(e),this.setElement(i("<button/>").attr("type","button").append(this.$icon=i("<i/>")).append(this.$title=i("<span/>")).append(this.$progress=i("<div/>").append(this.$progress_bar=i("<div/>")))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var t=this,e=this.model.attributes;this.$el.removeClass().addClass("ui-button-default").addClass(e.disabled&&"disabled").attr("id",e.id).attr("disabled",e.disabled).off("click").on("click",function(){i(".tooltip").hide(),e.onclick&&!t.disabled&&e.onclick()}).tooltip({title:e.tooltip,placement:"bottom"}),this.$progress.addClass("progress").css("display",-1!==e.percentage?"block":"none"),this.$progress_bar.addClass("progress-bar").css({width:e.percentage+"%"}),this.$icon.removeClass().addClass("icon fa"),this.$title.removeClass().addClass("title"),e.wait?(this.$el.addClass(e.wait_cls).prop("disabled",!0),this.$icon.addClass("fa-spinner fa-spin ui-margin-right"),this.$title.html(e.wait_text)):(this.$el.addClass(e.cls),this.$icon.addClass(e.icon),this.$title.html(e.title),e.icon&&e.title&&this.$icon.addClass("ui-margin-right"))},show:function(){this.$el.show()},hide:function(){this.$el.hide()},disable:function(){this.model.set("disabled",!0)},enable:function(){this.model.set("disabled",!1)},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},setIcon:function(t){this.model.set("icon",t)}}),s=o.extend({initialize:function(e){this.model=e&&e.model||new t.Model({id:a.default.uid(),title:"",icon:"",cls:""}).set(e),this.setElement(i("<a/>").append(this.$icon=i("<span/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var t=this.model.attributes;this.$el.removeClass().addClass(t.cls).attr({id:t.id,href:t.href||"javascript:void(0)",title:t.title,target:t.target||"_top",disabled:t.disabled}).tooltip({placement:"bottom"}).off("click").on("click",function(){t.onclick&&!t.disabled&&t.onclick()}),this.$icon.removeClass().addClass(t.icon)}}),l=t.View.extend({initialize:function(e){this.model=e&&e.model||new t.Model({id:a.default.uid(),title:"Select/Unselect all",icons:["fa-square-o","fa-minus-square-o","fa-check-square-o"],value:0,onchange:function(){}}).set(e),this.setElement(i("<div/>").append(this.$icon=i("<span/>")).append(this.$title=i("<span/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(t){var e=this,t=this.model.attributes;this.$el.addClass("ui-button-check").off("click").on("click",function(){e.model.set("value",0===e.model.get("value")&&2||0),t.onclick&&t.onclick()}),this.$title.html(t.title),this.$icon.removeClass().addClass("icon fa ui-margin-right").addClass(t.icons[t.value])},value:function(t,e){return void 0!==t&&(e&&0!==t&&(t=t!==e&&1||2),this.model.set("value",t),this.model.get("onchange")(this.model.get("value"))),this.model.get("value")}}),u=o.extend({initialize:function(e){this.model=e&&e.model||new t.Model({id:a.default.uid(),title:"",icon:"",cls:"ui-button-icon",disabled:!1}).set(e),this.setElement(i("<div/>").append(this.$button=i("<div/>").append(this.$icon=i("<i/>")).append(this.$title=i("<span/>")))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(t){var t=this.model.attributes;this.$el.removeClass().addClass(t.cls).addClass(t.disabled&&"disabled").attr("disabled",t.disabled).attr("id",t.id).off("click").on("click",function(){i(".tooltip").hide(),!t.disabled&&t.onclick&&t.onclick()}),this.$button.addClass("button").tooltip({title:t.tooltip,placement:"bottom"}),this.$icon.removeClass().addClass("icon fa").addClass(t.icon),this.$title.addClass("title").html(t.title),t.icon&&t.title&&this.$icon.addClass("ui-margin-right")}}),c=o.extend({$menu:null,initialize:function(e){this.model=e&&e.model||new t.Model({id:"",title:"",pull:"right",icon:null,onclick:null,cls:"ui-button-icon ui-button-menu",tooltip:"",target:"",href:"",onunload:null,visible:!0,tag:""}).set(e),this.collection=new t.Collection,this.setElement(i("<div/>").append(this.$root=i("<div/>").append(this.$icon=i("<i/>")).append(this.$title=i("<span/>")))),this.listenTo(this.model,"change",this.render,this),this.listenTo(this.collection,"change add remove reset",this.render,this),this.render()},render:function(){var t=this,e=this.model.attributes;this.$el.removeClass().addClass("dropdown").addClass(e.cls).attr("id",e.id).css({display:e.visible&&this.collection.where({visible:!0}).length>0?"block":"none"}),this.$root.addClass("root button dropdown-toggle").attr("data-toggle","dropdown").tooltip({title:e.tooltip,placement:"bottom"}).off("click").on("click",function(t){i(".tooltip").hide(),t.preventDefault(),e.onclick&&e.onclick()}),this.$icon.removeClass().addClass("icon fa").addClass(e.icon),this.$title.removeClass().addClass("title").html(e.title),e.icon&&e.title&&this.$icon.addClass("ui-margin-right"),this.$menu&&this.$menu.remove(),this.collection.length>0&&(this.$menu=i("<ul/>").addClass("menu dropdown-menu").addClass("pull-"+t.model.get("pull")).attr("role","menu"),this.$el.append(this.$menu)),this.collection.each(function(e){var n=e.attributes;if(n.visible){var r=i("<a/>").addClass("dropdown-item").attr({href:n.href,target:n.target}).append(i("<i/>").addClass("fa").addClass(n.icon).css("display",n.icon?"inline-block":"none")).append(n.title).on("click",function(t){n.onclick&&(t.preventDefault(),n.onclick())});t.$menu.append(i("<li/>").append(r)),n.divider&&t.$menu.append(i("<li/>").addClass("divider"))}})},addMenu:function(t){this.collection.add(a.default.merge(t,{title:"",target:"",href:"",onclick:null,divider:!1,visible:!0,icon:null,cls:"button-menu btn-group"}))}});e.default={ButtonDefault:o,ButtonLink:s,ButtonIcon:u,ButtonCheck:l,ButtonMenu:c}}).call(e,n(1),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(2),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(15),l=r(s),u=n(14),c=r(u),h=n(21),d=r(h),f=n(26),p=r(f),_=n(68),g=r(_),v=n(4),m=(r(v),{toJSON:function(){var t=this,e={};return o.each(t.constructor.to_json_keys,function(n){var i=t.get(n);n in t.constructor.to_json_mappers&&(i=t.constructor.to_json_mappers[n](i,t)),e[n]=i}),e}}),y=function(e,n){var i=new p.default({url_base:Galaxy.root+"visualization/list_history_datasets",filters:e,dict_format:!0,embedded:!0}),r=new p.default({url_base:Galaxy.root+"visualization/list_library_datasets",dict_format:!0,embedded:!0}),a=new g.default.View;a.add({id:"histories",title:"Histories",$el:t("<div/>").append(i.$el)}),a.add({id:"libraries",title:"Libraries",$el:t("<div/>").append(r.$el)}),Galaxy.modal.show({title:"Select datasets for new tracks",body:a.$el,closing_events:!0,buttons:{Cancel:function(){Galaxy.modal.hide()},Add:function(){var e=[];a.$("input.grid-row-select-checkbox[name=id]:checked").each(function(){window.console.log(t(this).val()),e[e.length]=t.ajax({url:Galaxy.root+"api/datasets/"+t(this).val(),dataType:"json",data:{data_type:"track_config",hda_ldda:"histories"==a.current()?"hda":"ldda"}})}),t.when.apply(t,e).then(function(){var e=arguments[0]instanceof Array?t.map(arguments,function(t){return t[0]}):[arguments[0]];n(e)}),Galaxy.modal.hide()}}})},b=function(t){this.default_font=void 0!==t?t:"9px Monaco, Lucida Console, monospace",this.dummy_canvas=this.new_canvas(),this.dummy_context=this.dummy_canvas.getContext("2d"),this.dummy_context.font=this.default_font,this.char_width_px=this.dummy_context.measureText("A").width,this.patterns={},this.load_pattern("right_strand","/visualization/strand_right.png"),this.load_pattern("left_strand","/visualization/strand_left.png"),this.load_pattern("right_strand_inv","/visualization/strand_right_inv.png"),this.load_pattern("left_strand_inv","/visualization/strand_left_inv.png")};o.extend(b.prototype,{load_pattern:function(t,e){var n=this.patterns,i=this.dummy_context,r=new Image;r.src=Galaxy.root+"static/images"+e,r.onload=function(){n[t]=i.createPattern(r,"repeat")}},get_pattern:function(t){return this.patterns[t]},new_canvas:function(){var e=t("<canvas/>")[0];return e.manager=this,e}});var w=i.Model.extend({defaults:{num_elements:20,obj_cache:null,key_ary:null},initialize:function(t){this.clear()},get_elt:function(t){var e=this.attributes.obj_cache,n=this.attributes.key_ary,i=t.toString(),r=o.indexOf(n,function(t){return t.toString()===i});return-1!==r&&(e[i].stale?(n.splice(r,1),delete e[i]):this.move_key_to_end(t,r)),e[i]},set_elt:function(t,e){var n=this.attributes.obj_cache,i=this.attributes.key_ary,r=t.toString(),a=this.attributes.num_elements;if(!n[r]){if(i.length>=a){delete n[i.shift().toString()]}i.push(t)}return n[r]=e,e},move_key_to_end:function(t,e){this.attributes.key_ary.splice(e,1),this.attributes.key_ary.push(t)},clear:function(){this.attributes.obj_cache={},this.attributes.key_ary=[]},size:function(){return this.attributes.key_ary.length},most_recently_added:function(){return 0===this.size()?null:this.attributes.key_ary[this.attributes.key_ary.length-1]}}),x=w.extend({defaults:o.extend({},w.prototype.defaults,{dataset:null,genome:null,init_data:null,min_region_size:200,filters_manager:null,data_type:"data",data_mode_compatible:function(t,e){return!0},can_subset:function(t){return!1}}),initialize:function(t){w.prototype.initialize.call(this);var e=this.get("init_data");e&&this.add_data(e)},add_data:function(t){this.get("num_elements")<t.length&&this.set("num_elements",t.length);var e=this;o.each(t,function(t){e.set_data(t.region,t)})},data_is_ready:function(){var e=this.get("dataset"),n=t.Deferred(),i="raw_data"===this.get("data_type")?"state":"data"===this.get("data_type")?"converted_datasets_state":"error",r=new c.default.ServerStateDeferred({ajax_settings:{url:this.get("dataset").url(),data:{hda_ldda:e.get("hda_ldda"),data_type:i},dataType:"json"},interval:5e3,success_fn:function(t){return"pending"!==t}});return t.when(r.go()).then(function(t){n.resolve("ok"===t||"data"===t)}),n},search_features:function(e){var n=this.get("dataset"),i={query:e,hda_ldda:n.get("hda_ldda"),data_type:"features"};return t.getJSON(n.url(),i)},load_data:function(e,n,i,r){var a=this.get("dataset"),o={data_type:this.get("data_type"),chrom:e.get("chrom"),low:e.get("start"),high:e.get("end"),mode:n,resolution:i,hda_ldda:a.get("hda_ldda")};t.extend(o,r);var s=this.get("filters_manager");if(s){for(var l=[],u=s.filters,c=0;c<u.length;c++)l.push(u[c].name);o.filter_cols=JSON.stringify(l)}var h=this,d=t.getJSON(a.url(),o,function(t){t.region=e,h.set_data(e,t)});return this.set_data(e,d),d},get_data:function(t,e,n,i){var r=this.get_elt(t);if(r&&(c.default.is_deferred(r)||this.get("data_mode_compatible")(r,e)))return r;for(var a,o,s=this.get("key_ary"),l=this.get("obj_cache"),u=0;u<s.length;u++)if(a=s[u],a.contains(t)&&(o=!0,r=l[a.toString()],c.default.is_deferred(r)||this.get("data_mode_compatible")(r,e)&&this.get("can_subset")(r))){if(this.move_key_to_end(a,u),!c.default.is_deferred(r)){var h=this.subset_entry(r,t);this.set_data(t,h),r=h}return r}if(!o&&t.length()<this.attributes.min_region_size){t=t.copy();var d=this.most_recently_added();!d||t.get("start")>d.get("start")?t.set("end",t.get("start")+this.attributes.min_region_size):t.set("start",t.get("end")-this.attributes.min_region_size),t.set("genome",this.attributes.genome),t.trim()}return this.load_data(t,e,n,i)},set_data:function(t,e){this.set_elt(t,e)},DEEP_DATA_REQ:"deep",BROAD_DATA_REQ:"breadth",get_more_data:function(e,n,i,r,a){var o=this._mark_stale(e);if(!o||!this.get("data_mode_compatible")(o,n))return void console.log("ERROR: problem with getting more data: current data is not compatible");var s=e.get("start");a===this.DEEP_DATA_REQ?t.extend(r,{start_val:o.data.length+1}):a===this.BROAD_DATA_REQ&&(s=(o.max_high?o.max_high:o.data[o.data.length-1][2])+1);var l=e.copy().set("start",s),u=this,c=this.load_data(l,n,i,r),h=t.Deferred();return this.set_data(e,h),t.when(c).then(function(t){t.data&&(t.data=o.data.concat(t.data),t.max_low&&(t.max_low=o.max_low),t.message&&(t.message=t.message.replace(/[0-9]+/,t.data.length))),u.set_data(e,t),h.resolve(t)}),h},can_get_more_detailed_data:function(t){var e=this.get_elt(t);return"bigwig"===e.dataset_type&&e.data.length<8e3},get_more_detailed_data:function(t,e,n,i,r){var a=this._mark_stale(t);return a?(r||(r={}),"bigwig"===a.dataset_type&&(r.num_samples=1e3*i),this.load_data(t,e,n,r)):void console.log("ERROR getting more detailed data: no current data")},_mark_stale:function(t){var e=this.get_elt(t);return e||console.log("ERROR: no data to mark as stale: ",this.get("dataset"),t.toString()),e.stale=!0,e},get_genome_wide_data:function(e){var n=this,i=!0,r=o.map(e.get("chroms_info").chrom_info,function(t){var e=n.get_elt(new M({chrom:t.chrom,start:0,end:t.len}));return e||(i=!1),e});if(i)return r;var a=t.Deferred();return t.getJSON(this.get("dataset").url(),{data_type:"genome_data"},function(t){n.add_data(t.data),a.resolve(t.data)}),a},subset_entry:function(t,e){var n={bigwig:function(t,e){return o.filter(t,function(t){return t[0]>=e.get("start")&&t[0]<=e.get("end")})},refseq:function(e,n){var i=n.get("start")-t.region.get("start");return t.data.slice(i,i+n.length())}},i=t.data;return!t.region.same(e)&&t.dataset_type in n&&(i=n[t.dataset_type](t.data,e)),{region:e,data:i,dataset_type:t.dataset_type}}}),k=x.extend({initialize:function(t){var e=new i.Model;e.urlRoot=t.data_url,this.set("dataset",e)},load_data:function(t,e,n,i){return t.length()<=1e5?x.prototype.load_data.call(this,t,e,n,i):{data:null,region:t}}}),C=i.Model.extend({defaults:{name:null,key:null,chroms_info:null},initialize:function(t){this.id=t.dbkey},get_chroms_info:function(){return this.attributes.chroms_info.chrom_info},get_chrom_region:function(t){var e=o.find(this.get_chroms_info(),function(e){return e.chrom===t});return new M({chrom:e.chrom,end:e.len})},get_chrom_len:function(t){return o.find(this.get_chroms_info(),function(e){return e.chrom===t}).len}}),M=i.Model.extend({defaults:{chrom:null,start:0,end:0,str_val:null,genome:null},same:function(t){return this.attributes.chrom===t.get("chrom")&&this.attributes.start===t.get("start")&&this.attributes.end===t.get("end")},initialize:function(t){if(t.from_str){var e=t.from_str.split(":"),n=e[0],i=e[1].split("-");this.set({chrom:n,start:parseInt(i[0],10),end:parseInt(i[1],10)})}this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end"),this.on("change",function(){this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end")},this)},copy:function(){return new M({chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")})},length:function(){return this.get("end")-this.get("start")},toString:function(){return this.attributes.str_val},toJSON:function(){return{chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")}},compute_overlap:function(t){var e=this.get("chrom"),n=t.get("chrom"),i=this.get("start"),r=t.get("start"),a=this.get("end"),o=t.get("end");return e&&n&&e!==n?M.overlap_results.DIF_CHROMS:i<r?a<r?M.overlap_results.BEFORE:a<o?M.overlap_results.OVERLAP_START:M.overlap_results.CONTAINS:i>r?i>o?M.overlap_results.AFTER:a<=o?M.overlap_results.CONTAINED_BY:M.overlap_results.OVERLAP_END:a>=o?M.overlap_results.CONTAINS:M.overlap_results.CONTAINED_BY},trim:function(t){if(this.attributes.start<0&&(this.attributes.start=0),this.attributes.genome){var e=this.attributes.genome.get_chrom_len(this.attributes.chrom);this.attributes.end>e&&(this.attributes.end=e-1)}return this},contains:function(t){return this.compute_overlap(t)===M.overlap_results.CONTAINS},overlaps:function(t){return 0===o.intersection([this.compute_overlap(t)],[M.overlap_results.DIF_CHROMS,M.overlap_results.BEFORE,M.overlap_results.AFTER]).length}},{overlap_results:{DIF_CHROMS:1e3,BEFORE:1001,CONTAINS:1002,OVERLAP_START:1003,OVERLAP_END:1004,CONTAINED_BY:1005,AFTER:1006}}),S=i.Collection.extend({model:M}),T=i.Model.extend({defaults:{region:null,note:""},initialize:function(t){this.set("region",new M(t.region))}}),$=i.Collection.extend({model:T}),A=i.Model.extend(m).extend({defaults:{mode:"Auto"},initialize:function(t){this.set("dataset",new l.default.Dataset(t.dataset));var e=[{key:"name",default_value:this.get("dataset").get("name")},{key:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:0},{key:"max_value",label:"Max Value",type:"float",default_value:1}];this.set("config",d.default.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs));var n=this.get("preloaded_data");n=n?n.data:[],this.set("data_manager",new x({dataset:this.get("dataset"),init_data:n}))}},{to_json_keys:["track_type","dataset","prefs","mode","filters","tool_state"],to_json_mappers:{prefs:function(t,e){return 0===o.size(t)&&(t={name:e.get("config").get("name").get("value"),color:e.get("config").get("color").get("value")}),t},dataset:function(t){return{id:t.id,hda_ldda:t.get("hda_ldda")}}}}),E=i.Collection.extend({model:A}),O=i.Model.extend({defaults:{title:"",type:""},urlRoot:Galaxy.root+"api/visualizations",save:function(){return t.ajax({url:this.url(),type:"POST",dataType:"json",data:{vis_json:JSON.stringify(this)}})}}),z=O.extend(m).extend({defaults:o.extend({},O.prototype.defaults,{dbkey:"",drawables:null,bookmarks:null,viewport:null}),initialize:function(t){this.set("drawables",new E(t.tracks));var e=[];this.set("config",d.default.ConfigSettingCollection.from_models_and_saved_values(e,t.prefs)),this.unset("tracks"),this.get("drawables").each(function(t){t.unset("preloaded_data")})},add_tracks:function(t){this.get("drawables").add(t)}},{to_json_keys:["view","viewport","bookmarks"],to_json_mappers:{view:function(t,e){return{obj_type:"View",prefs:{name:e.get("title"),content_visible:!0},drawables:e.get("drawables")}}}}),R=i.Router.extend({initialize:function(t){this.view=t.view,this.route(/([\w]+)$/,"change_location"),this.route(/([\w\+]+\:[\d,]+-[\d,]+)$/,"change_location");var e=this;e.view.on("navigate",function(t){e.navigate(t)})},change_location:function(t){this.view.go_to(t)}});e.default={BackboneTrack:A,BrowserBookmark:T,BrowserBookmarkCollection:$,Cache:w,CanvasManager:b,Genome:C,GenomeDataManager:x,GenomeRegion:M,GenomeRegionCollection:S,GenomeVisualization:z,GenomeReferenceDataManager:k,TrackBrowserRouter:R,Visualization:O,select_datasets:y}}).call(e,n(0),n(1))},function(t,e,n){"use strict";(function(t,n){function i(t){t+="";for(var e=/(\d+)(\d{3})/;e.test(t);)t=t.replace(e,"$1,$2");return t}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return"promise"in t},a=t.Model.extend({defaults:{ajax_settings:{},interval:1e3,success_fn:function(t){return!0}},go:function(){var t=n.Deferred(),e=this,i=e.get("ajax_settings"),r=e.get("success_fn"),a=e.get("interval");return function e(){n.ajax(i).success(function(n){r(n)?t.resolve(n):setTimeout(e,a)})}(),t}}),o=function(t){t||(t="#ffffff"),"string"==typeof t&&(t=[t]);for(var e=0;e<t.length;e++)t[e]=parseInt(t[e].slice(1),16);var n,i,r,a,o,s,l,u,c,h,d,f=function(t,e,n){return(299*t+587*e+114*n)/1e3},p=!1,_=0;do{for(n=Math.round(16777215*Math.random()),i=(16711680&n)>>16,r=(65280&n)>>8,a=255&n,c=f(i,r,a),p=!0,e=0;e<t.length;e++)if(o=t[e],s=(16711680&o)>>16,l=(65280&o)>>8,u=255&o,h=f(s,l,u),d=function(t,e,n,i,r,a){return Math.max(t,i)-Math.min(t,i)+(Math.max(e,r)-Math.min(e,r))+(Math.max(n,a)-Math.min(n,a))}(i,r,a,s,l,u),Math.abs(c-h)<40||d<200){p=!1;break}_++}while(!p&&_<=10);return"#"+(16777216+n).toString(16).substr(1,6)};e.default={commatize:i,is_deferred:r,ServerStateDeferred:a,get_random_color:o}}).call(e,n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(9),s=(a(o),n(45)),l=(a(s),n(41)),u=a(l),c=t.Model.extend({}),h=t.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var t=new c;i.each(i.keys(this.attributes),function(e){if(0===e.indexOf("metadata_")){var n=e.split("metadata_")[1];t.set(n,this.attributes[e]),delete this.attributes[e]}},this),this.set("metadata",t,{silent:!0})},get_metadata:function(t){return this.attributes.metadata.get(t)},urlRoot:Galaxy.root+"api/datasets"}),d=h.extend({defaults:i.extend({},h.prototype.defaults,{chunk_url:null,first_data_chunk:null,offset:0,at_eof:!1}),initialize:function(t){h.prototype.initialize.call(this),this.attributes.first_data_chunk&&(this.attributes.offset=this.attributes.first_data_chunk.offset),this.attributes.chunk_url=Galaxy.root+"dataset/display?dataset_id="+this.id,this.attributes.url_viz=Galaxy.root+"visualization"},get_next_chunk:function(){if(this.attributes.at_eof)return null;var t=this,e=r.Deferred();return r.getJSON(this.attributes.chunk_url,{offset:t.attributes.offset}).success(function(n){var i;""!==n.ck_data?(i=n,t.attributes.offset=n.offset):(t.attributes.at_eof=!0,i=null),e.resolve(i)}),e}}),f=t.Collection.extend({model:h}),p=t.View.extend({initialize:function(t){this.row_count=0,this.loading_chunk=!1,new v({model:t.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(t){var e=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),r.when(e.model.get_next_chunk()).then(function(t){t&&(e._renderChunk(t),e.loading_chunk=!1),e.loading_indicator.hide(),e.expand_to_container()}))},render:function(){this.loading_indicator=r("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var t=r("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(t);var e=this.model.get_metadata("column_names"),n=r("<thead/>").appendTo(t),i=r("<tr/>").appendTo(n);if(e)i.append("<th>"+e.join("</th><th>")+"</th>");else for(var a=1;a<=this.model.get_metadata("columns");a++)i.append("<th>"+a+"</th>");var o=this,s=this.model.get("first_data_chunk");s?this._renderChunk(s):r.when(o.model.get_next_chunk()).then(function(t){o._renderChunk(t)}),this.scroll_elt.scroll(function(){o.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(t,e,n){var i=r("<td>").text(t),a=this.model.get_metadata("column_types");return void 0!==n?i.attr("colspan",n).addClass("stringalign"):a&&e<a.length&&("str"!==a[e]&&"list"!==a[e]||i.addClass("stringalign")),i},_renderRow:function(t){var e=t.split("\t"),n=r("<tr>"),a=this.model.get_metadata("columns");return this.row_count%2!=0&&n.addClass("dark_row"),e.length===a?i.each(e,function(t,e){n.append(this._renderCell(t,e))},this):e.length>a?(i.each(e.slice(0,a-1),function(t,e){n.append(this._renderCell(t,e))},this),n.append(this._renderCell(e.slice(a-1).join("\t"),a-1))):1===e.length?n.append(this._renderCell(t,0,a)):(i.each(e,function(t,e){n.append(this._renderCell(t,e))},this),i.each(i.range(a-e.length),function(){n.append(r("<td>"))})),this.row_count++,n},_renderChunk:function(t){var e=this.$el.find("table");i.each(t.ck_data.split("\n"),function(t,n){""!==t&&e.append(this._renderRow(t))},this)}}),_=p.extend({initialize:function(t){p.prototype.initialize.call(this,t);var e=i.find(this.$el.parents(),function(t){return"auto"===r(t).css("overflow")});e||(e=window),this.scroll_elt=r(e)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),g=p.extend({initialize:function(t){p.prototype.initialize.call(this,t),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:t.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}}),v=t.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(t){var e=parent.Galaxy;if(e&&e.modal&&(this.modal=e.modal),e&&e.frame&&(this.frame=e.frame),this.modal&&this.frame){var n=t.model,i=n.get("metadata");if(n.get("file_ext")){if(this.file_ext=n.get("file_ext"),"bed"==this.file_ext){if(!(i.get("chromCol")&&i.get("startCol")&&i.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=i.get("chromCol")-1,this.col.start=i.get("startCol")-1,this.col.end=i.get("endCol")-1}if("vcf"==this.file_ext){var r=function(t,e){for(var n=0;n<e.length;n++)if(e[n].match(t))return n;return-1};if(this.col.chrom=r("Chrom",i.get("column_names")),this.col.start=r("Pos",i.get("column_names")),this.col.end=null,-1==this.col.chrom||-1==this.col.start)return void console.log("TabularButtonTrackster : VCF-file metadata incomplete.")}if(void 0!==this.col.chrom){if(!n.id)return void console.log("TabularButtonTrackster : Dataset identification is missing.");if(this.dataset_id=n.id,!n.get("url_viz"))return void console.log("TabularButtonTrackster : Url for visualization controller is missing.");this.url_viz=n.get("url_viz"),n.get("genome_build")&&(this.genome_build=n.get("genome_build"));var a=new u.default.IconButtonView({model:new u.default.IconButton({title:"Visualize",icon_class:"chart_curve",id:"btn_viz"})});this.setElement(t.$el),this.$el.append(a.render().$el),this.hide()}}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(t){var e=this;if(null!==this.col.chrom){var n=r(t.target).parent(),i=n.children().eq(this.col.chrom).html(),a=n.children().eq(this.col.start).html(),o=this.col.end?n.children().eq(this.col.end).html():a;if(!i.match("^#")&&""!==i&&function(t){return!isNaN(parseFloat(t))&&isFinite(t)}(a)){var s={dataset_id:this.dataset_id,gene_region:i+":"+a+"-"+o},l=n.offset(),u=l.left-10,c=l.top-r(window).scrollTop()+3;r("#btn_viz").css({position:"fixed",top:c+"px",left:u+"px"}),r("#btn_viz").off("click"),r("#btn_viz").click(function(){e.frame.add({title:"Trackster",url:e.url_viz+"/trackster?"+r.param(s)})}),r("#btn_viz").show()}else r("#btn_viz").hide()}},hide:function(){this.$("#btn_viz").hide()}}),m=function(t){t.model||(t.model=new d(t.dataset_config));var e=t.parent_elt,n=t.embedded;delete t.embedded,delete t.parent_elt,delete t.dataset_config;var i=n?new g(t):new _(t);return i.render(),e&&(e.append(i.$el),i.expand_to_container()),i};e.default={Dataset:h,TabularDataset:d,DatasetCollection:f,TabularDatasetChunkedView:p,createTabularDatasetChunkedView:m}}).call(e,n(1),n(2),n(0))},function(t,e,n){"use strict";(function(e){function i(t,e){!r.isUndefined(t)&&r.isUndefined(t["Content-Type"])&&(t["Content-Type"]=e)}var r=n(5),a=n(77),o={"Content-Type":"application/x-www-form-urlencoded"},s={adapter:function(){var t;return"undefined"!=typeof XMLHttpRequest?t=n(28):void 0!==e&&(t=n(28)),t}(),transformRequest:[function(t,e){return a(e,"Content-Type"),r.isFormData(t)||r.isArrayBuffer(t)||r.isBuffer(t)||r.isStream(t)||r.isFile(t)||r.isBlob(t)?t:r.isArrayBufferView(t)?t.buffer:r.isURLSearchParams(t)?(i(e,"application/x-www-form-urlencoded;charset=utf-8"),t.toString()):r.isObject(t)?(i(e,"application/json;charset=utf-8"),JSON.stringify(t)):t}],transformResponse:[function(t){if("string"==typeof t)try{t=JSON.parse(t)}catch(t){}return t}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(t){return t>=200&&t<300}};s.headers={common:{Accept:"application/json, text/plain, */*"}},r.forEach(["delete","get","head"],function(t){s.headers[t]={}}),r.forEach(["post","put","patch"],function(t){s.headers[t]=r.merge(o)}),t.exports=s}).call(e,n(76))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(18)),i(n(19)),i(n(96))},function(t,e,n){"use strict";function i(t,e,n,i){if(void 0===i&&(i={writable:!0,enumerable:!0,configurable:!0}),!(t instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0!==e){if(!(e instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===i)i={writable:!0,enumerable:!0,configurable:!0};else if(!(i instanceof Object))throw new TypeError('"attributes" isn\'t an Object instance');if(void 0===n)for(var r in e)void 0!==e[r]&&Object.defineProperty(t,r,Object.create(i,{value:{value:e[r]}}));else if(n instanceof Array)n.forEach(function(n){void 0!==e[n]&&Object.defineProperty(t,n,Object.create(i,{value:{value:e[n]}}))});else{if(!(n instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var a in n){var r=n[a];void 0!==e[r]&&Object.defineProperty(t,a,Object.create(i,{value:{value:e[r]}}))}}}}function r(t,e,n,i){if(void 0===i&&(i=!0),!(t instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0===e)return!0;if(!(e instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===i&&(i=!0),void 0===n){for(var r in e)if(t[r]!==e[r]&&(void 0!==e[r]||!i))return!1}else{if(n instanceof Array)return n.every(function(n){return t[n]===e[n]||void 0===e[n]&&i});if(!(n instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var a in n){var r=n[a];if(t[a]!==e[r]&&(void 0!==e[r]||!i))return!1}}return!0}function a(t){return"number"==typeof t}function o(t){return"string"==typeof t}function s(t,e){if(!t)throw new Error(e);return t}function l(t,e){if(!(t instanceof Object))throw new TypeError(e||"Expected Object");return t}function u(t,e){if("string"!=typeof t)throw new TypeError(e||"Expected string");return t}function c(t,e){if(!h(t))throw new TypeError(e||"Expected Array");return t}function h(t){return!!t&&t.constructor===Array}function d(t,e){return[].concat.apply([],t.map(e))}Object.defineProperty(e,"__esModule",{value:!0}),e.updateProperties=i,e.testProperties=r,e.mustBeNumber=function(t,e){if(!a(t))throw new TypeError(e||"Expected number");return t},e.isNumber=a,e.isString=o,e.mustNotBeUndefined=s,e.mustBeObject=l,e.mustBeString=u,e.mustBeArray=c,e.isArray=h,e.mconcat=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return e.reduceRight(t)},e.snd=function(t){return t[1]},e.concatMap=d},function(t,e,n){"use strict";function i(t){return a(t)||o(t)}function r(t){return e.measureTypes.hasOwnProperty(t)}function a(t){return r(t.type)&&X.isNumber(t.value)}function o(t){return _(t.expression)}function s(t){if(void 0===t)return!1;switch(t){case"Parentheses":case"Square":case"Dollar":return!0;default:return!1}}function l(t,e){return void 0!==t&&(void 0===e?"string"==typeof t.name:e===t.name)}function u(t){return void 0!==t&&"string"==typeof t.text}function c(t){return void 0!==t&&X.isArray(t.latex)}function h(t){return t.arguments instanceof Array}function d(t){return t===J.SUP||t===J.SUB}function f(t){switch(t){case"#":return"\\#";case"$":return"\\$";case"%":return"\\%";case"^":return"\\^{}";case"&":return"\\&";case"{":return"\\{";case"}":return"\\}";case"~":return"\\~{}";case"\\":return"\\textbackslash{}";case"_":return"\\_{}";default:return t}}function p(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return 0===e.length?"string"==typeof t.type:e.some(function(e){return t.type===e})}function _(t){return v(t)||g(t)}function g(t){return E(t)||y(t)||b(t)||x(t)||k(t)||C(t)||S(t)||A(t)}function v(t){return E(t)||m(t)||b(t)||x(t)||k(t)||C(t)||S(t)||A(t)}function m(t){return void 0!==t&&void 0!==t.type&&u(t)&&p(t,e.typeTeXRaw)}function y(t){return void 0!==t&&"string"==typeof t.string&&"number"==typeof t.category}function b(t){return l(t)&&h(t)&&p(t,e.typeTeXComm,e.typeTeXCommS)}function w(t){return b(t)&&0===t.arguments.length}function x(t,n){return p(t,e.typeTeXEnv)}function k(t){return c(t)&&p(t)&&s(t.type)}function C(t){return void 0!==t&&"boolean"==typeof t.noNewPage&&(void 0===t.measure||i(t.measure))}function M(t){return d(t.type)}function S(t){return c(t)&&p(t,e.typeTeXBraces)}function T(t){return p(t,"FixArg")}function $(t){return p(t,"OptArg")}function A(t){return u(t)&&p(t,e.typeTeXComment)}function E(t){return void 0!==t&&0===Object.keys(t).length}function O(t){return{type:"FixArg",latex:t}}function z(t){return 1===t.length?{type:"OptArg",latex:t}:{type:"MOptArg",latex:t}}function R(t){return{type:"SymArg",latex:[t]}}function N(t){return{type:"ParArg",latex:[t]}}function P(t){return{type:"MOptArg",latex:t}}function q(t){return{type:"MSymArg",latex:t}}function j(t){return{type:"MParArg",latex:t}}function D(t){return{name:t,arguments:[],type:e.typeTeXCommS}}function L(t){return{text:t,type:e.typeTeXRaw,characterCategories:W.convertToTeXCharsDefault(t)}}function I(t,e,n,i){return{latex:i,type:t,startSymbol:e,endSymbol:n}}function B(t){return{latex:[t],type:e.typeTeXBraces}}function V(t){return{text:t,type:e.typeTeXComment}}function U(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return{name:t,arguments:n,type:e.typeTeXComm}}function F(t,e,n){return{type:t,symbol:e,arguments:n}}function G(t,n){for(var i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];return{name:t,latex:n,arguments:i,type:e.typeTeXEnv}}function H(t){var e=[];return Y(t,e),e.join("")}function Y(t,e){if(b(t))e.push("\\",t.name),t.arguments.forEach(function(t){return Y(t,e)});else{if(x(t))throw new Error("not supported yet");if(k(t))e.push(t.startSymbol),t.latex.forEach(function(t){return Y(t,e)}),e.push(t.endSymbol);else if(C(t))e.push("\n");else if(M(t))e.push(t.symbol),t.arguments&&t.arguments.forEach(function(t){return Y(t,e)});else if(S(t))e.push("{"),t.latex.forEach(function(t){return Y(t,e)}),e.push("}");else if(A(t))e.push("%"+t.text+"\n");else if(m(t))e.push(t.text);else{if(y(t))throw new Error("not supported yet");if(T(t))e.push("{"),t.latex.forEach(function(t){return Y(t,e)}),e.push("}");else{if(!$(t))throw new Error("Did not recognize "+JSON.stringify(t));e.push("["),t.latex.forEach(function(t){return Y(t,e)}),e.push("]")}}}}Object.defineProperty(e,"__esModule",{value:!0});var X=n(18),W=n(33);e.isMeasure=i,e.measureTypes={pt:!0,mm:!0,cm:!0,in:!0,ex:!0,em:!0},e.isMeasureType=r,e.isBuiltInMeasure=a,e.isCustomMeasure=o,e.mathTypes={Parentheses:"Parentheses",Square:"Square",Dollar:"Dollar"},e.isMathType=s,e.isNameHaving=l,e.isTextHaving=u,e.isLaTeXHaving=c,e.isArgumentHaving=h,e.typeTeXSeq="TeXSeq",e.typeTeXEnv="TeXEnv",e.typeTeXBraces="TeXBraces",e.typeTeXComment="TeXComment",e.typeTeXRaw="TeXRaw",e.typeTeXComm="TeXComm",e.typeTeXCommS="TeXCommS";var J;!function(t){t[t.SUP=0]="SUP",t[t.SUB=1]="SUB"}(J=e.SubOrSuperSymbol||(e.SubOrSuperSymbol={})),e.isSubOrSuperSymbol=d,e.fromStringLaTeX=function(t){return L(e.protectString(t))},e.protectString=function(t){for(var e=[],n=0;n<t.length;n++)e.push(f(t.charAt(n)));return e.join()},e.protectChar=f,e.isTypeHaving=p,e.isLaTeXBlock=_,e.isLaTeXNoRaw=g,e.isLaTeXRaw=v,e.isTeXRaw=m,e.isTeXChar=y,e.isTeXComm=b,e.isTeXCommS=w,e.isTeXEnv=x,e.isTeXMath=k,e.isTeXLineBreak=C,e.isSubOrSuperScript=M,e.isTeXBraces=S,e.isFixArg=T,e.isOptArg=$,e.isTeXComment=A,e.isTeXEmpty=E,e.newFixArg=O,e.newOptArg=z,e.newSymArg=R,e.newParArg=N,e.newMOptArg=P,e.newMSymArg=q,e.newMParArg=j,e.newCommandS=D,e.newTeXRaw=L,e.newTeXMath=I,e.newTeXBraces=B,e.newTeXMathDol=function(t){return I("Dollar","$","$",t)},e.newTeXComment=V,e.newTeXComm=U,e.newSubOrSuperScript=F,e.newTeXEnv=G,e.stringifyLaTeX=H},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=(a(o),n(11)),l=a(s),u=n(4),c=a(u),h=n(48),d=a(h),f=n(44),p=a(f);e.default=t.View.extend({initialize:function(e){this.model=new t.Model({initial_errors:!1,cls:"ui-portlet-limited",icon:null,always_refresh:!0,status:"warning",hide_operations:!1,onchange:function(){}}).set(e),this.setElement("<div/>"),this.render()},update:function(t){var e=this;this.data.matchModel(t,function(t,n){var r=e.input_list[n];if(r&&r.options&&!i.isEqual(r.options,t.options)){r.options=t.options;var a=e.field_list[n];if(a.update){var o=[];if(-1!=["data","data_collection","drill_down"].indexOf(r.type))o=r.options;else for(var s in t.options){var l=t.options[s];l.length>2&&o.push({label:l[0],value:l[1]})}a.update(o),a.trigger("change"),Galaxy.emit.debug("form-view::update()","Updating options for "+n)}}})},wait:function(t){for(var e in this.input_list){var n=this.field_list[e];this.input_list[e].is_dynamic&&n.wait&&n.unwait&&n[t?"wait":"unwait"]()}},highlight:function(t,e,n){var i=this.element_list[t];if(i&&(i.error(e||"Please verify this parameter."),this.portlet.expand(),this.trigger("expand",t),!n)){var a=this.$el.parents().filter(function(){return-1!=["auto","scroll"].indexOf(r(this).css("overflow"))}).first();a.animate({scrollTop:a.scrollTop()+i.$el.offset().top-120},500)}},errors:function(t){if(this.trigger("reset"),t&&t.errors){var e=this.data.matchResponse(t.errors);for(var n in this.element_list){this.element_list[n];e[n]&&this.highlight(n,e[n],!0)}}},render:function(){var t=this;this.off("change"),this.off("reset"),this.field_list={},this.input_list={},this.element_list={},this.data=new p.default.Manager(this),this._renderForm(),this.data.create(),this.model.get("initial_errors")&&this.errors(this.model.attributes);var e=this.data.checksum();return this.on("change",function(n){var i=t.input_list[n];if(!i||i.refresh_on_change||t.model.get("always_refresh")){var r=t.data.checksum();r!=e&&(e=r,t.model.get("onchange")())}}),this.on("reset",function(){i.each(t.element_list,function(t){t.reset()})}),this},_renderForm:function(){r(".tooltip").remove();var t=this.model.attributes;this.message=new c.default.UnescapedMessage,this.section=new d.default.View(this,{inputs:t.inputs}),this.portlet=new l.default.View({icon:t.icon,title:t.title,cls:t.cls,operations:!t.hide_operations&&t.operations,buttons:t.buttons,collapsible:t.collapsible,collapsed:t.collapsed,onchange_title:t.onchange_title}),this.portlet.append(this.message.$el),this.portlet.append(this.section.$el),this.$el.empty(),t.inputs&&this.$el.append(this.portlet.$el),t.message&&this.message.update({persistent:!0,status:t.status,message:t.message}),Galaxy.emit.debug("form-view::initialize()","Completed")}})}).call(e,n(1),n(2),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(2),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(14),l=r(s),u=n(21),c=(r(u),t.Model.extend({initialize:function(t){var e=this.get("key");this.set("id",e);var n=o.find([{key:"name",label:"Name",type:"text",default_value:""},{key:"color",label:"Color",type:"color",default_value:null},{key:"min_value",label:"Min Value",type:"float",default_value:null},{key:"max_value",label:"Max Value",type:"float",default_value:null},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:32,hidden:!0},{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"block_color",label:"Block color",type:"color",default_value:null},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"reverse_strand_color",label:"Antisense strand color",type:"color",default_value:null},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0}],function(t){return t.key===e});n&&this.set(o.extend({},n,t)),void 0===this.get("value")&&void 0!==this.get("default_value")&&(this.set_value(this.get("default_value")),this.get("value")||"color"!==this.get("type")||this.set("value",l.default.get_random_color()))},set_value:function(t,e){var n=this.get("type");"float"===n?t=parseFloat(t):"int"===n&&(t=parseInt(t,10)),this.set({value:t},e)}})),h=t.Collection.extend({model:c,to_key_value_dict:function(){var t={};return this.each(function(e){t[e.get("key")]=e.get("value")}),t},get_value:function(t){var e=this.get(t);if(e)return e.get("value")},set_value:function(t,e,n){var i=this.get(t);if(i)return i.set_value(e,n)},set_default_value:function(t,e){var n=this.get(t);if(n)return n.set("default_value",e)}},{from_models_and_saved_values:function(t,e){return e&&(t=o.map(t,function(t){return o.extend({},t,{value:e[t.key]})})),new h(t)}}),d=t.View.extend({className:"config-settings-view",render:function(){var t=this.$el;return this.collection.each(function(e,n){if(!e.get("hidden")){var r="param_"+n,a=e.get("type"),s=e.get("value"),u=i("<div class='form-row' />").appendTo(t);if(u.append(i("<label />").attr("for",r).text(e.get("label")+":")),"bool"===a)u.append(i('<input type="checkbox" />').attr("id",r).attr("name",r).attr("checked",s));else if("text"===a)u.append(i('<input type="text"/>').attr("id",r).val(s).click(function(){i(this).select()}));else if("select"===a){var c=i("<select />").attr("id",r);o.each(e.get("options"),function(t){i("<option/>").text(t.label).attr("value",t.value).appendTo(c)}),c.val(s),u.append(c)}else if("color"===a){var h=i("<div/>").appendTo(u),d=i("<input />").attr("id",r).attr("name",r).val(s).css("float","left").appendTo(h).click(function(t){i(".tooltip").removeClass("in");var e=i(this).siblings(".tooltip").addClass("in");e.css({left:i(this).position().left+i(this).width()+5,top:i(this).position().top-i(e).height()/2+i(this).height()/2}).show(),e.click(function(t){t.stopPropagation()}),i(document).bind("click.color-picker",function(){e.hide(),i(document).unbind("click.color-picker")}),t.stopPropagation()}),f=i("<a href='javascript:void(0)'/>").addClass("icon-button arrow-circle").appendTo(h).attr("title","Set new random color").tooltip(),p=i("<div class='tooltip right' style='position: absolute;' />").appendTo(h).hide(),_=i("<div class='tooltip-inner' style='text-align: inherit'></div>").appendTo(p),g=(i("<div class='tooltip-arrow'></div>").appendTo(p),i.farbtastic(_,{width:100,height:100,callback:d,color:s}));h.append(i("<div/>").css("clear","both")),function(t){f.click(function(){t.setColor(l.default.get_random_color())})}(g)}else u.append(i("<input />").attr("id",r).attr("name",r).val(s));e.help&&u.append(i("<div class='help'/>").text(e.help))}}),this},render_in_modal:function(t){var e=this,n=function(){Galaxy.modal.hide(),i(window).unbind("keypress.check_enter_esc")},r=function(){Galaxy.modal.hide(),i(window).unbind("keypress.check_enter_esc"),e.update_from_form()},a=function(t){27===(t.keyCode||t.which)?n():13===(t.keyCode||t.which)&&r()};i(window).bind("keypress.check_enter_esc",a),0===this.$el.children().length&&this.render(),Galaxy.modal.show({title:t||"Configure",body:this.$el,buttons:{Cancel:n,OK:r}})},update_from_form:function(){var t=this;this.collection.each(function(e,n){if(!e.get("hidden")){var i="param_"+n,r=t.$el.find("#"+i).val();"bool"===e.get("type")&&(r=t.$el.find("#"+i).is(":checked")),e.set_value(r)}})}});e.default={ConfigSetting:c,ConfigSettingCollection:h,ConfigSettingCollectionView:d}}).call(e,n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(12),u=a(l),c=t.View.extend({initialize:function(e){var n=this;this.data=[],this.data2=[],this.model=e&&e.model||new t.Model({id:s.default.uid(),cls:"ui-select",error_text:"No options available",empty_text:"Nothing selected",visible:!0,wait:!1,multiple:!1,searchable:!0,optional:!1,disabled:!1,readonly:!1,onchange:function(){},value:null,individual:!1,pagesize:20}).set(e),this.on("change",function(){n.model.get("onchange")&&n.model.get("onchange")(n.value())}),this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:disabled",this._changeDisabled,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:visible",this._changeVisible,this),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:multiple change:searchable change:cls change:id",this.render,this),this.render()},render:function(){var t=this;this.model.get("searchable")?this._renderSearchable():this._renderClassic(),this.$el.addClass(this.model.get("cls")).attr("id",this.model.get("id")),this.$select.empty().addClass("select").attr("id",this.model.get("id")+"_select").prop("multiple",this.model.get("multiple")).on("change",function(){t.value(t._getValue()),t.trigger("change")}),this._changeData(),this._changeWait(),this._changeVisible(),this._changeDisabled()},_renderClassic:function(){var t=this;this.$el.addClass(this.model.get("multiple")?"ui-select-multiple":"ui-select").append(this.$select=i("<select/>")).append(this.$dropdown=i("<div/>")).append(this.$resize=i("<div/>").append(this.$resize_icon=i("<i/>"))),this.model.get("multiple")?(this.$dropdown.hide(),this.$resize_icon.addClass("fa fa-angle-double-right fa-rotate-45").show(),this.$resize.removeClass().addClass("icon-resize").show().off("mousedown").on("mousedown",function(e){var n=e.pageY,r=t.$select.height();t.minHeight=t.minHeight||r,i("#dd-helper").show().on("mousemove",function(e){t.$select.height(Math.max(r+(e.pageY-n),t.minHeight))}).on("mouseup mouseleave",function(){i("#dd-helper").hide().off()})})):(this.$dropdown.show(),this.$resize.hide(),this.$resize_icon.hide())},_renderSearchable:function(){var t=this;this.$el.append(this.$select=i("<div/>")).append(this.$dropdown=i("<div/>")),this.$dropdown.hide(),this.model.get("multiple")||this.$dropdown.show().on("click",function(){t.$select.select2&&t.$select.select2("open")}),this.all_button=null,!this.model.get("multiple")||this.model.get("individual")||this.model.get("readonly")||(this.all_button=new u.default.ButtonCheck({onclick:function(){var e=[];0!==t.all_button.value()&&r.each(t.model.get("data"),function(t){e.push(t.value)}),t.value(e),t.trigger("change")}}),this.$el.prepend(this.all_button.$el))},_match:function(t,e){return!t||""==t||String(e).toUpperCase().indexOf(t.toUpperCase())>=0},_changeData:function(){var t=this;this.data=[],!this.model.get("multiple")&&this.model.get("optional")&&this.data.push({value:"__null__",label:t.model.get("empty_text")}),r.each(this.model.get("data"),function(e){t.data.push(e)}),0==this.length()&&this.data.push({value:"__null__",label:this.model.get("error_text")}),this.model.get("searchable")?(this.data2=[],r.each(this.data,function(e,n){t.data2.push({order:n,id:e.value,text:e.label,tags:e.tags})}),this.$select.data("select2")&&this.$select.select2("destroy"),this.matched_tags={},this.$select.select2({data:t.data2,closeOnSelect:!this.model.get("multiple"),multiple:this.model.get("multiple"),query:function(e){t.matched_tags={};var n=t.model.get("pagesize"),i=r.filter(t.data2,function(n){var i=!1;return r.each(n.tags,function(n){t._match(e.term,n)&&(i=t.matched_tags[n]=!0)}),i||t._match(e.term,n.text)});e.callback({results:i.slice((e.page-1)*n,e.page*n),more:i.length>=e.page*n})},formatResult:function(e){return r.escape(e.text)+'<div class="ui-tags">'+r.reduce(e.tags,function(e,n){return t.matched_tags[n]?e+'&nbsp;<div class="label label-info">'+r.escape(n)+"</div>":e},"")+"</div>"}}),this.$(".select2-container .select2-search input").off("blur")):(this.$select.find("option").remove(),r.each(this.data,function(e){t.$select.append(i("<option/>").attr("value",e.value).html(r.escape(e.label)))})),this.model.set("disabled",this.model.get("readonly")||0==this.length()),this._changeValue()},_changeDisabled:function(){this.model.get("searchable")?this.$select.select2(this.model.get("disabled")?"disable":"enable"):this.$select.prop("disabled",this.model.get("disabled"))},_changeWait:function(){this.$dropdown.removeClass().addClass("icon-dropdown fa").addClass(this.model.get("wait")?"fa-spinner fa-spin":"fa-caret-down")},_changeVisible:function(){this.$el[this.model.get("visible")?"show":"hide"](),this.$select[this.model.get("visible")?"show":"hide"]()},_changeValue:function(){if(this._setValue(this.model.get("value")),this.model.get("multiple")){if(this.all_button){var t=this._getValue();this.all_button.value(i.isArray(t)?t.length:0,this.length())}}else null!==this._getValue()||this.model.get("optional")||this._setValue(this.first())},value:function(t){return void 0!==t&&this.model.set("value",t),this._getValue()},first:function(){return this.data.length>0?this.data[0].value:null},exists:function(t){return r.findWhere(this.data,{value:t})},text:function(){var t=this._getValue(),e=this.exists(i.isArray(t)?t[0]:t);return e?e.label:""},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},disabled:function(){return this.model.get("disabled")},enable:function(){this.model.set("disabled",!1)},disable:function(){this.model.set("disabled",!0)},add:function(t,e){r.each(this.model.get("data"),function(e){e.keep&&!r.findWhere(t,{value:e.value})&&t.push(e)}),e&&t&&t.sort(e),this.model.set("data",t)},update:function(t){this.model.set("data",t)},setOnChange:function(t){this.model.set("onchange",t)},length:function(){return i.isArray(this.model.get("data"))?this.model.get("data").length:0},_setValue:function(t){var e=this;if(null!==t&&void 0!==t||(t="__null__"),this.model.get("multiple")?t=i.isArray(t)?t:[t]:i.isArray(t)&&(t=t.length>0?t[0]:"__null__"),this.model.get("searchable")){if(i.isArray(t)){var n=[];r.each(t,function(t){var i=r.findWhere(e.data2,{id:t});i&&n.push(i)}),t=n}else{t=r.findWhere(this.data2,{id:t})}this.$select.select2("data",t)}else this.$select.val(t)},_getValue:function(){var t=null;if(this.model.get("searchable")){var e=this.$select.select2("data");e&&(i.isArray(e)?(t=[],e.sort(function(t,e){return t.order-e.order}),r.each(e,function(e){t.push(e.id)})):t=e.id)}else t=this.$select.val();return s.default.isEmpty(t)?null:t}});e.default={View:c}}).call(e,n(1),n(0),n(2))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(12),u=a(l),c=t.View.extend({initialize:function(e){var n=this;this.model=e&&e.model||new t.Model({visible:!0,data:[],id:s.default.uid(),error_text:"No options available.",wait_text:"Please wait...",multiple:!1,optional:!1,onchange:function(){}}).set(e),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:visible",this._changeVisible,this),this.on("change",function(){n.model.get("onchange")(n.value())}),this.render()},render:function(){var t=this;this.$el.empty().removeClass().addClass("ui-options").append(this.$message=i("<div/>")).append(this.$menu=i("<div/>").addClass("ui-options-menu")).append(this.$options=i(this._template())),this.all_button=null,this.model.get("multiple")&&(this.all_button=new u.default.ButtonCheck({onclick:function(){t.$("input").prop("checked",0!==t.all_button.value()),t.value(t._getValue()),t.trigger("change")}}),this.$menu.append(this.all_button.$el)),this._changeData(),this._changeWait(),this._changeVisible()},update:function(t){this.model.set("data",t)},_changeData:function(){var t=this;this.$options.empty(),this._templateOptions?this.$options.append(this._templateOptions(this.model.get("data"))):r.each(this.model.get("data"),function(e){t.$options.append(i(t._templateOption(e)).addClass("ui-option").tooltip({title:e.tooltip,placement:"bottom"}))});var t=this;this.$("input").on("change",function(){t.value(t._getValue()),t.trigger("change")}),this._changeValue(),this._changeWait()},_changeVisible:function(){this.$el[this.model.get("visible")?"show":"hide"]()},_changeWait:function(){this.model.get("wait")?0===this.length()&&(this._messageShow(this.model.get("wait_text"),"info"),this.$options.hide(),this.$menu.hide()):0===this.length()?(this._messageShow(this.model.get("error_text"),"danger"),this.$options.hide(),this.$menu.hide()):(this.$message.hide(),this.$options.css("display","inline-block"),this.$menu.show())},_changeValue:function(){this._setValue(this.model.get("value")),null!==this._getValue()||this.model.get("multiple")||this.model.get("optional")||this._setValue(this.first()),this.all_button&&this.all_button.value(i.isArray(this._getValue())?this._getValue().length:0,this.length())},value:function(t){return void 0!==t&&this.model.set("value",t),this._getValue()},first:function(){var t=this.$("input").first();return t.length>0?t.val():null},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},length:function(){return this.$(".ui-option").length},_setValue:function(t){var e=this;if(void 0!==t&&(this.$("input").prop("checked",!1),null!==t)){var n=i.isArray(t)?t:[t];r.each(n,function(t){e.$('input[value="'+t+'"]').first().prop("checked",!0)})}},_getValue:function(){var t=[];return this.$(":checked").each(function(){t.push(i(this).val())}),s.default.isEmpty(t)?null:this.model.get("multiple")?t:t[0]},_messageShow:function(t,e){this.$message.show().removeClass().addClass("ui-message alert alert-"+e).html(t)},_template:function(){return i("<div/>").addClass("ui-options-list")}}),h=c.extend({_templateOption:function(t){var e=s.default.uid();return i("<div/>").addClass("ui-option").append(i("<input/>").attr({id:e,type:this.model.get("type"),name:this.model.id,value:t.value})).append(i("<label/>").addClass("ui-options-label").attr("for",e).html(t.label))}}),d={};d.View=h.extend({initialize:function(t){t.type="radio",h.prototype.initialize.call(this,t)}});var f={};f.View=h.extend({initialize:function(t){t.type="checkbox",t.multiple=!0,h.prototype.initialize.call(this,t)}});var p={};p.View=c.extend({initialize:function(t){c.prototype.initialize.call(this,t)},_setValue:function(t){void 0!==t&&(this.$("input").prop("checked",!1),this.$("label").removeClass("active"),this.$('[value="'+t+'"]').prop("checked",!0).closest("label").addClass("active"))},_templateOption:function(t){var e=i("<label/>").addClass("btn btn-default");return t.icon&&e.append(i("<i/>").addClass("fa").addClass(t.icon).addClass(!t.label&&"no-padding")),e.append(i("<input/>").attr({type:"radio",name:this.model.id,value:t.value})),t.label&&e.append(t.label),e},_template:function(){return i("<div/>").addClass("btn-group ui-radiobutton").attr("data-toggle","buttons")}}),e.default={Base:c,BaseIcons:h,Radio:d,RadioButton:p,Checkbox:f}}).call(e,n(1),n(0),n(2))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),o=r(a),s=n(11),l=r(s),u=n(4),c=r(u),h=t.View.extend({initialize:function(t){var e=this;this.options=t,this.name=t.name||"element",this.multiple=t.multiple||!1,this.message=new c.default.Message,this.portlet=new l.default.View({cls:"ui-portlet-section"}),this.select=new c.default.Select.View({optional:t.optional}),this.button=new c.default.ButtonIcon({icon:"fa fa-sign-in",tooltip:"Insert new "+this.name,onclick:function(){e.add({id:e.select.value(),name:e.select.text()})}}),this.setElement(this._template(t)),this.$(".ui-list-message").append(this.message.$el),this.$(".ui-list-portlet").append(this.portlet.$el),this.$(".ui-list-button").append(this.button.$el),this.$(".ui-list-select").append(this.select.$el)},value:function(t){if(void 0!==t){if(this.portlet.empty(),i.isArray(t))for(var e in t){var n=t[e],r=null,a=null;"string"!=i.type(n)?(r=n.id,a=n.name):r=a=n,null!=r&&this.add({id:r,name:a})}this._refresh()}var o=[];return this.$(".ui-list-id").each(function(){o.push({id:i(this).prop("id"),name:i(this).find(".ui-list-name").html()})}),0==o.length?null:o},add:function(t){var e=this;if(0===this.$('[id="'+t.id+'"]').length)if(o.default.isEmpty(t.id))this.message.update({message:"Please select a valid "+this.name+".",status:"danger"});else{var n=i(this._templateRow({id:t.id,name:t.name}));n.on("click",function(){n.remove(),e._refresh()}),n.on("mouseover",function(){n.addClass("portlet-highlight")}),n.on("mouseout",function(){n.removeClass("portlet-highlight")}),this.portlet.append(n),this._refresh()}else this.message.update({message:"This "+this.name+" is already in the list."})},update:function(t){this.select.update(t)},_refresh:function(){this.$(".ui-list-id").length>0?(!this.multiple&&this.button.disable(),this.$(".ui-list-portlet").show()):(this.button.enable(),this.$(".ui-list-portlet").hide()),this.options.onchange&&this.options.onchange()},_template:function(t){return'<div class="ui-list"><div class="ui-margin-top"><span class="ui-list-button"/><span class="ui-list-select"/></div><div class="ui-list-message"/><div class="ui-list-portlet"/></div>'},_templateRow:function(t){return'<div id="'+t.id+'" class="ui-list-id"><span class="ui-list-delete fa fa-trash"/><span class="ui-list-name">'+t.name+"</span></div>"}});e.default={View:h}}).call(e,n(1),n(0))},function(t,e,n){"use strict";var i=n(0),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=r.default;a.fn.make_text_editable=function(t){var e="num_cols"in t?t.num_cols:30,n="num_rows"in t?t.num_rows:4,i="use_textarea"in t&&t.use_textarea,r="on_finish"in t?t.on_finish:null,o="help_text"in t?t.help_text:null,s=a(this);return s.addClass("editable-text").click(function(o){if(!(a(this).children(":input").length>0)){s.removeClass("editable-text");var l,u,c=function(t){s.find(":input").remove(),""!==t?s.text(t):s.html("<br>"),s.addClass("editable-text"),r&&r(t)},h="cur_text"in t?t.cur_text:s.text();i?(l=a("<textarea/>").attr({rows:n,cols:e}).text(a.trim(h)).keyup(function(t){27===t.keyCode&&c(h)}),u=a("<button/>").text("Done").click(function(){return c(l.val()),!1})):l=a("<input type='text'/>").attr({value:a.trim(h),size:e}).blur(function(){c(h)}).keyup(function(t){27===t.keyCode?a(this).trigger("blur"):13===t.keyCode&&c(a(this).val()),t.stopPropagation()}),s.text(""),s.append(l),u&&s.append(u),l.focus(),l.select(),o.stopPropagation()}}),o&&s.attr("title",o).tooltip(),s}},function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),l=o(s),u=n(143),c=o(u),h=n(144),d=o(h),f=n(67),p=o(f);t.ajaxSettings.traditional=!0,e.default=i.View.extend({grid:null,initialize:function(t){this.grid=new c.default,this.dict_format=t.dict_format,this.title=t.title;var e=this;if(window.add_tag_to_grid_filter=function(t,n){var i=t+(void 0!==n&&""!==n?":"+n:"");r("#advanced-search").is(":visible")||(r("#standard-search").slideToggle("fast"),r("#advanced-search").slideToggle("fast")),e.add_filter_condition("tags",i)},this.dict_format)if(this.setElement("<div/>"),t.url_base&&!t.items){var n=t.url_data||{};a.each(t.filters,function(t,e){n["f-"+e]=t}),r.ajax({url:t.url_base+"?"+r.param(n),success:function(n){n.embedded=t.embedded,n.filters=t.filters||{},e.init_grid(n)}})}else this.init_grid(t);else this.setElement("#grid-container"),this.init_grid(t);t.use_panels&&r("#center").css({padding:"10px",overflow:"auto"})},handle_refresh:function(t){t&&r.inArray("history",t)>-1&&window.top.Galaxy&&window.top.Galaxy.currHistoryPanel&&window.top.Galaxy.currHistoryPanel.loadCurrentHistory()},init_grid:function(t){this.grid.set(t);var e=this.grid.attributes;this.allow_title_display&&e.title&&l.default.setWindowTitle(e.title),this.handle_refresh(e.refresh_frames);var n=this.grid.get("url_base");if(n=n.replace(/^.*\/\/[^\/]+/,""),this.grid.set("url_base",n),this.$el.html(d.default.grid(e)),this.$el.find("#grid-table-header").html(d.default.header(e)),this.$el.find("#grid-table-body").html(d.default.body(e)),this.$el.find("#grid-table-footer").html(d.default.footer(e)),e.message){this.$el.find("#grid-message").html(d.default.message(e));var i=this;e.use_hide_message&&setTimeout(function(){i.$el.find("#grid-message").html("")},5e3)}this.init_grid_elements(),this.init_grid_controls(),init_refresh_on_change()},init_grid_controls:function(){var t=this;this.$el.find(".operation-button").each(function(){r(this).off(),r(this).click(function(){return t.submit_operation(this),!1})}),this.$el.find("input[type=text]").each(function(){r(this).off(),r(this).click(function(){r(this).select()}).keyup(function(){r(this).css("font-style","normal")})}),this.$el.find(".sort-link").each(function(){r(this).off(),r(this).click(function(){return t.set_sort_condition(r(this).attr("sort_key")),!1})}),this.$el.find(".text-filter-form").each(function(){r(this).off(),r(this).submit(function(){var e=r(this).attr("column_key"),n=r("#input-"+e+"-filter"),i=n.val();return n.val(""),t.add_filter_condition(e,i),!1})}),this.$el.find(".text-filter-val > a").each(function(){r(this).off(),r(this).click(function(){return r(this).parent().remove(),t.remove_filter_condition(r(this).attr("filter_key"),r(this).attr("filter_val")),!1})}),this.$el.find(".categorical-filter > a").each(function(){r(this).off(),r(this).click(function(){return t.set_categorical_filter(r(this).attr("filter_key"),r(this).attr("filter_val")),!1})}),this.$el.find(".advanced-search-toggle").each(function(){r(this).off(),r(this).click(function(){return t.$el.find("#standard-search").slideToggle("fast"),t.$el.find("#advanced-search").slideToggle("fast"),!1})}),this.$el.find("#check_all").off(),this.$el.find("#check_all").on("click",function(){t.check_all_items()})},init_grid_elements:function(){this.$el.find(".grid").each(function(){var t=r(this).find("input.grid-row-select-checkbox"),e=r(this).find("span.grid-selected-count"),n=function(){e.text(r(t).filter(":checked").length)};r(t).each(function(){r(this).change(n)}),n()}),0!==this.$el.find(".community_rating_star").length&&this.$el.find(".community_rating_star").rating({});var t=this.grid.attributes,e=this;this.$el.find(".page-link > a").each(function(){r(this).click(function(){return e.set_page(r(this).attr("page_num")),!1})}),this.$el.find(".use-target").each(function(){r(this).click(function(t){return e.execute({href:r(this).attr("href"),target:r(this).attr("target")}),!1})}),0!=t.items.length&&a.each(t.items,function(n,i){var r=e.$("#grid-"+i+"-popup").off(),o=new p.default(r);a.each(t.operations,function(t){e._add_operation(o,t,n)})})},_add_operation:function(t,e,n){var i=this,a=n.operation_config[e.label];a.allowed&&e.allow_popup&&t.addItem({html:e.label,href:a.url_args,target:a.target,confirmation_text:e.confirm,func:function(t){t.preventDefault();var a=r(t.target).html();e.onclick?e.onclick(n.encode_id):i.execute(this.findItemByHtml(a))}})},add_filter_condition:function(t,e){if(""===e)return!1;this.grid.add_filter(t,e,!0);var n=r(d.default.filter_element(t,e)),i=this;n.click(function(){r(this).remove(),i.remove_filter_condition(t,e)}),this.$el.find("#"+t+"-filtering-criteria").append(n),this.go_page_one(),this.execute()},remove_filter_condition:function(t,e){this.grid.remove_filter(t,e),this.go_page_one(),this.execute()},set_sort_condition:function(t){var e=this.grid.get("sort_key"),n=t;-1!==e.indexOf(t)&&"-"!==e.substring(0,1)&&(n="-"+t),this.$el.find(".sort-arrow").remove();var i="-"==n.substring(0,1)?"&uarr;":"&darr;",a=r("<span>"+i+"</span>").addClass("sort-arrow");this.$el.find("#"+t+"-header").append(a),this.grid.set("sort_key",n),this.go_page_one(),this.execute()},set_categorical_filter:function(t,e){var n=this.grid.get("categorical_filters")[t],i=this.grid.get("filters")[t],a=this;this.$el.find("."+t+"-filter").each(function(){var o=r.trim(r(this).text()),s=n[o],l=s[t];if(l==e)r(this).empty(),r(this).addClass("current-filter"),r(this).append(o);else if(l==i){r(this).empty();var u=r('<a href="#">'+o+"</a>");u.click(function(){a.set_categorical_filter(t,l)}),r(this).removeClass("current-filter"),r(this).append(u)}}),this.grid.add_filter(t,e),this.go_page_one(),this.execute()},set_page:function(t){var e=this;this.$el.find(".page-link").each(function(){var n,i=r(this).attr("id"),a=parseInt(i.split("-")[2],10),o=e.grid.get("cur_page");if(a===t)n=r(this).children().text(),r(this).empty(),r(this).addClass("inactive-link"),r(this).text(n);else if(a===o){n=r(this).text(),r(this).empty(),r(this).removeClass("inactive-link");var s=r('<a href="#">'+n+"</a>");s.click(function(){e.set_page(a)}),r(this).append(s)}}),"all"===t?this.grid.set("cur_page",t):this.grid.set("cur_page",parseInt(t,10)),this.execute()},submit_operation:function(t,e){var n=r(t).val();if(!this.$el.find('input[name="id"]:checked').length>0)return!1;var i=a.findWhere(this.grid.attributes.operations,{label:n});i&&!e&&(e=i.confirm||"");var o=[];this.$el.find("input[name=id]:checked").each(function(){o.push(r(this).val())});var s={operation:n,id:o,confirmation_text:e};return"top"!=i.target&&"center"!=i.target||(s=a.extend(s,{href:i.href,target:i.target})),this.execute(s),!0},check_all_items:function(){var t=this.$(".grid-row-select-checkbox"),e=this.$("#check_all").prop("checked");a.each(t,function(t){r(t).prop("checked",e)}),this.init_grid_elements()},go_page_one:function(){var t=this.grid.get("cur_page");null!==t&&void 0!==t&&"all"!==t&&this.grid.set("cur_page",1)},execute:function(t){var e=null,n=null,i=null,a=null,o=null;if(t&&(n=t.href,i=t.operation,e=t.id,a=t.confirmation_text,o=t.target,void 0!==n&&-1!=n.indexOf("operation="))){var s=n.split("?");if(s.length>1)for(var l=s[1],u=l.split("&"),c=0;c<u.length;c++)-1!=u[c].indexOf("operation")?(i=u[c].split("=")[1],i=i.replace(/\+/g," ")):-1!=u[c].indexOf("id")&&(e=u[c].split("=")[1])}return i&&e?!(a&&""!=a&&"None"!=a&&"null"!=a&&!confirm(a))&&(i=i.toLowerCase(),this.grid.set({operation:i,item_ids:e}),"top"==o?window.top.location=n+"?"+r.param(this.grid.get_url_data()):"center"==o?r("#galaxy_main").attr("src",n+"?"+r.param(this.grid.get_url_data())):this.grid.can_async_op(i)||this.dict_format?this.update_grid():this.go_to(o,n),!1):n?(this.go_to(o,n),!1):(this.grid.get("async")||this.dict_format?this.update_grid():this.go_to(o,n),!1)},go_to:function(t,e){var n=this.grid.get("async");this.grid.set("async",!1);var i=this.$el.find("#advanced-search").is(":visible");switch(this.grid.set("advanced_search",i),e||(e=this.grid.get("url_base")+"?"+r.param(this.grid.get_url_data())),this.grid.set({operation:void 0,item_ids:void 0,async:n}),t){case"center":r("#galaxy_main").attr("src",e);break;case"top":window.top.location=e;break;default:window.location=e}},update_grid:function(){var t=this.grid.get("operation")?"POST":"GET";this.$el.find(".loading-elt-overlay").show();var e=this;r.ajax({type:t,url:e.grid.get("url_base"),data:e.grid.get_url_data(),error:function(t){alert("Grid refresh failed")},success:function(t){var n=e.grid.get("embedded"),i=e.grid.get("insert"),a=e.$el.find("#advanced-search").is(":visible"),o=e.dict_format?t:r.parseJSON(t);o.embedded=n,o.insert=i,o.advanced_search=a,e.init_grid(o),e.$el.find(".loading-elt-overlay").hide()},complete:function(){e.grid.set({operation:void 0,item_ids:void 0})}})}})}).call(e,n(0),n(1),n(0),n(2))},function(t,e,n){"use strict";t.exports=function(t,e){return function(){for(var n=new Array(arguments.length),i=0;i<n.length;i++)n[i]=arguments[i];return t.apply(e,n)}}},function(t,e,n){"use strict";var i=n(5),r=n(78),a=n(80),o=n(81),s=n(82),l=n(29),u="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||n(83);t.exports=function(t){return new Promise(function(e,c){var h=t.data,d=t.headers;i.isFormData(h)&&delete d["Content-Type"];var f=new XMLHttpRequest,p="onreadystatechange",_=!1;if(window.XMLHttpRequest||"undefined"==typeof window||!window.XDomainRequest||"withCredentials"in f||s(t.url)||(f=new window.XDomainRequest,p="onload",_=!0,f.onprogress=function(){},f.ontimeout=function(){}),t.auth){var g=t.auth.username||"",v=t.auth.password||"";d.Authorization="Basic "+u(g+":"+v)}if(f.open(t.method.toUpperCase(),a(t.url,t.params,t.paramsSerializer),!0),f.timeout=t.timeout,f[p]=function(){if(f&&(4===f.readyState||_)&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in f?o(f.getAllResponseHeaders()):null,i=t.responseType&&"text"!==t.responseType?f.response:f.responseText,a={data:i,status:1223===f.status?204:f.status,statusText:1223===f.status?"No Content":f.statusText,headers:n,config:t,request:f};r(e,c,a),f=null}},f.onerror=function(){c(l("Network Error",t,null,f)),f=null},f.ontimeout=function(){c(l("timeout of "+t.timeout+"ms exceeded",t,"ECONNABORTED",f)),f=null},i.isStandardBrowserEnv()){var m=n(84),y=(t.withCredentials||s(t.url))&&t.xsrfCookieName?m.read(t.xsrfCookieName):void 0;y&&(d[t.xsrfHeaderName]=y)}if("setRequestHeader"in f&&i.forEach(d,function(t,e){void 0===h&&"content-type"===e.toLowerCase()?delete d[e]:f.setRequestHeader(e,t)}),t.withCredentials&&(f.withCredentials=!0),t.responseType)try{f.responseType=t.responseType}catch(e){if("json"!==t.responseType)throw e}"function"==typeof t.onDownloadProgress&&f.addEventListener("progress",t.onDownloadProgress),"function"==typeof t.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",t.onUploadProgress),t.cancelToken&&t.cancelToken.promise.then(function(t){f&&(f.abort(),c(t),f=null)}),void 0===h&&(h=null),f.send(h)})}},function(t,e,n){"use strict";var i=n(79);t.exports=function(t,e,n,r,a){var o=new Error(t);return i(o,e,n,r,a)}},function(t,e,n){"use strict";t.exports=function(t){return!(!t||!t.__CANCEL__)}},function(t,e,n){"use strict";function i(t){this.message=t}i.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},i.prototype.__CANCEL__=!0,t.exports=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.supportedMarkups={ascii:!0,unicode:!0,html:!0}},function(t,e,n){"use strict";function i(t){return r(e.defaultCategories,t)}function r(t,e){for(var n=[],i=0;i<e.length;i++){var r=e.charAt(i);n.push({string:r,category:t(r)})}return n}Object.defineProperty(e,"__esModule",{value:!0}),e.defaultCategories=function(t){switch(t){case"\\":return 0;case"{":return 1;case"}":return 2;case"$":return 3;case"&":return 4;case"\r":return 5;case"#":return 6;case"^":return 7;case"_":return 8;case"\0":return 9;case" ":return 10;case"~":return 13;case"%":return 14;case"d":return 15;default:return 11}},e.convertToTeXCharsDefault=i,e.convertToTeXChars=r},function(t,e,n){!function(e,n){t.exports=n()}(0,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,i){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){"use strict";function i(t){if(!(this instanceof i))return new i(t);this._=t}function r(t){return t instanceof i}function a(t){return"[object Array]"==={}.toString.call(t)}function o(t,e){return{status:!0,index:t,value:e,furthest:-1,expected:[]}}function s(t,e){return{status:!1,index:-1,value:null,furthest:t,expected:[e]}}function l(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var n=t.furthest===e.furthest?c(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:n}}function u(t,e){var n=t.slice(0,e).split("\n");return{offset:e,line:n.length,column:n[n.length-1].length+1}}function c(t,e){var n=t.length,i=e.length;if(0===n)return e;if(0===i)return t;for(var r={},a=0;a<n;a++)r[t[a]]=!0;for(var o=0;o<i;o++)r[e[o]]=!0;var s=[];for(var l in r)r.hasOwnProperty(l)&&s.push(l);return s.sort(),s}function h(t){if(!r(t))throw new Error("not a parser: "+t)}function d(t){if(!a(t))throw new Error("not an array: "+t)}function f(t){if("number"!=typeof t)throw new Error("not a number: "+t)}function p(t){if(!(t instanceof RegExp))throw new Error("not a regexp: "+t);for(var e=b(t),n=0;n<e.length;n++){var i=e.charAt(n);if("i"!==i&&"m"!==i&&"u"!==i)throw new Error('unsupported regexp flag "'+i+'": '+t)}}function _(t){if("function"!=typeof t)throw new Error("not a function: "+t)}function g(t){if("string"!=typeof t)throw new Error("not a string: "+t)}function v(t){return 1===t.length?t[0]:"one of "+t.join(", ")}function m(t,e){var n=e.index,i=n.offset;if(i===t.length)return", got the end of the input";var r=i>0?"'...":"'",a=t.length-i>12?"...'":"'";return" at line "+n.line+" column "+n.column+", got "+r+t.slice(i,i+12)+a}function y(t,e){return"expected "+v(e.expected)+m(t,e)}function b(t){var e=""+t;return e.slice(e.lastIndexOf("/")+1)}function w(t){return RegExp("^(?:"+t.source+")",b(t))}function x(){for(var t=[].slice.call(arguments),e=t.length,n=0;n<e;n+=1)h(t[n]);return i(function(n,i){for(var r,a=new Array(e),s=0;s<e;s+=1){if(r=l(t[s]._(n,i),r),!r.status)return r;a[s]=r.value,i=r.index}return l(o(i,a),r)})}function k(){for(var t={},e=0,n=[].slice.call(arguments),s=n.length,u=0;u<s;u+=1){var c=n[u];if(!r(c)){if(a(c)&&2===c.length&&"string"==typeof c[0]&&r(c[1])){var h=c[0];if(t[h])throw new Error("seqObj: duplicate key "+h);t[h]=!0,e++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===e)throw new Error("seqObj expects at least one named parser, found zero");return i(function(t,e){for(var i,r={},u=0;u<s;u+=1){var c,h;if(a(n[u])?(c=n[u][0],h=n[u][1]):(c=null,h=n[u]),i=l(h._(t,e),i),!i.status)return i;c&&(r[c]=i.value),e=i.index}return l(o(e,r),i)})}function C(){var t=[].slice.call(arguments);if(0===t.length)throw new Error("seqMap needs at least one argument");var e=t.pop();return _(e),x.apply(null,t).map(function(t){return e.apply(null,t)})}function M(t){var e={};for(var n in t)({}).hasOwnProperty.call(t,n)&&function(n){var i=function(){return t[n](e)};e[n]=B(i)}(n);return e}function S(){var t=[].slice.call(arguments),e=t.length;if(0===e)return z("zero alternates");for(var n=0;n<e;n+=1)h(t[n]);return i(function(e,n){for(var i,r=0;r<t.length;r+=1)if(i=l(t[r]._(e,n),i),i.status)return i;return i})}function T(t,e){return $(t,e).or(O([]))}function $(t,e){h(t),h(e);var n=e.then(t).many();return t.chain(function(t){return n.map(function(e){return[t].concat(e)})})}function A(t){g(t);var e="'"+t+"'";return i(function(n,i){var r=i+t.length,a=n.slice(i,r);return a===t?o(r,a):s(i,e)})}function E(t,e){p(t),arguments.length>=2?f(e):e=0;var n=w(t),r=""+t;return i(function(t,i){var a=n.exec(t.slice(i));if(a){if(0<=e&&e<=a.length){var l=a[0],u=a[e];return o(i+l.length,u)}return s(i,"valid match group (0 to "+a.length+") in "+r)}return s(i,r)})}function O(t){return i(function(e,n){return o(n,t)})}function z(t){return i(function(e,n){return s(n,t)})}function R(t){if(r(t))return i(function(e,n){var i=t._(e,n);return i.index=n,i.value="",i});if("string"==typeof t)return R(A(t));if(t instanceof RegExp)return R(E(t));throw new Error("not a string, regexp, or parser: "+t)}function N(t){return h(t),i(function(e,n){var i=t._(e,n),r=e.slice(n,i.index);return i.status?s(n,'not "'+r+'"'):o(n,null)})}function P(t){return _(t),i(function(e,n){var i=e.charAt(n);return n<e.length&&t(i)?o(n+1,i):s(n,"a character matching "+t)})}function q(t){return P(function(e){return t.indexOf(e)>=0})}function j(t){return P(function(e){return t.indexOf(e)<0})}function D(t){return i(t(o,s))}function L(t,e){return P(function(n){return t<=n&&n<=e}).desc(t+"-"+e)}function I(t){return _(t),i(function(e,n){for(var i=n;i<e.length&&t(e.charAt(i));)i++;return o(i,e.slice(n,i))})}function B(t,e){arguments.length<2&&(e=t,t=void 0);var n=i(function(t,i){return n._=e()._,n._(t,i)});return t?n.desc(t):n}function V(){return z("fantasy-land/empty")}var U=i.prototype;U.parse=function(t){if("string"!=typeof t)throw new Error(".parse must be called with a string as its argument");var e=this.skip(Y)._(t,0);return e.status?{status:!0,value:e.value}:{status:!1,index:u(t,e.furthest),expected:e.expected}},U.tryParse=function(t){var e=this.parse(t);if(e.status)return e.value;var n=y(t,e),i=new Error(n);throw i.type="ParsimmonError",i.result=e,i},U.or=function(t){return S(this,t)},U.trim=function(t){return this.wrap(t,t)},U.wrap=function(t,e){return C(t,this,e,function(t,e){return e})},U.thru=function(t){return t(this)},U.then=function(t){return h(t),x(this,t).map(function(t){return t[1]})},U.many=function(){var t=this;return i(function(e,n){for(var i=[],r=void 0;;){if(r=l(t._(e,n),r),!r.status)return l(o(n,i),r);n=r.index,i.push(r.value)}})},U.tie=function(){return this.map(function(t){d(t);for(var e="",n=0;n<t.length;n++)g(t[n]),e+=t[n];return e})},U.times=function(t,e){var n=this;return arguments.length<2&&(e=t),f(t),f(e),i(function(i,r){for(var a=[],s=void 0,u=void 0,c=0;c<t;c+=1){if(s=n._(i,r),u=l(s,u),!s.status)return u;r=s.index,a.push(s.value)}for(;c<e&&(s=n._(i,r),u=l(s,u),s.status);c+=1)r=s.index,a.push(s.value);return l(o(r,a),u)})},U.result=function(t){return this.map(function(){return t})},U.atMost=function(t){return this.times(0,t)},U.atLeast=function(t){return C(this.times(t),this.many(),function(t,e){return t.concat(e)})},U.map=function(t){_(t);var e=this;return i(function(n,i){var r=e._(n,i);return r.status?l(o(r.index,t(r.value)),r):r})},U.skip=function(t){return x(this,t).map(function(t){return t[0]})},U.mark=function(){return C(F,this,F,function(t,e,n){return{start:t,value:e,end:n}})},U.node=function(t){return C(F,this,F,function(e,n,i){return{name:t,value:n,start:e,end:i}})},U.sepBy=function(t){return T(this,t)},U.sepBy1=function(t){return $(this,t)},U.lookahead=function(t){return this.skip(R(t))},U.notFollowedBy=function(t){return this.skip(N(t))},U.desc=function(t){var e=this;return i(function(n,i){var r=e._(n,i);return r.status||(r.expected=[t]),r})},U.fallback=function(t){return this.or(O(t))},U.ap=function(t){return C(t,this,function(t,e){return t(e)})},U.chain=function(t){var e=this;return i(function(n,i){var r=e._(n,i);return r.status?l(t(r.value)._(n,r.index),r):r})},U.concat=U.or,U.empty=V,U.of=O,U["fantasy-land/ap"]=U.ap,U["fantasy-land/chain"]=U.chain,U["fantasy-land/concat"]=U.concat,U["fantasy-land/empty"]=U.empty,U["fantasy-land/of"]=U.of,U["fantasy-land/map"]=U.map;var F=i(function(t,e){return o(e,u(t,e))}),G=i(function(t,e){return e>=t.length?s(e,"any character"):o(e+1,t.charAt(e))}),H=i(function(t,e){return o(t.length,t.slice(e))}),Y=i(function(t,e){return e<t.length?s(e,"EOF"):o(e,null)}),X=E(/[0-9]/).desc("a digit"),W=E(/[0-9]*/).desc("optional digits"),J=E(/[a-z]/i).desc("a letter"),K=E(/[a-z]*/i).desc("optional letters"),Z=E(/\s*/).desc("optional whitespace"),Q=E(/\s+/).desc("whitespace");i.all=H,i.alt=S,i.any=G,i.createLanguage=M,i.custom=D,i.digit=X,i.digits=W,i.empty=V,i.eof=Y,i.fail=z,i.formatError=y,i.index=F,i.isParser=r,i.lazy=B,i.letter=J,i.letters=K,i.lookahead=R,i.makeFailure=s,i.makeSuccess=o,i.noneOf=j,i.notFollowedBy=N,i.of=O,i.oneOf=q,i.optWhitespace=Z,i.Parser=i,i.range=L,i.regex=E,i.regexp=E,i.sepBy=T,i.sepBy1=$,i.seq=x,i.seqMap=C,i.seqObj=k,i.string=A,i.succeed=O,i.takeWhile=I,i.test=P,i.whitespace=Q,i["fantasy-land/empty"]=V,i["fantasy-land/of"]=O,t.exports=i}])})},function(t,e,n){"use strict";function i(t){return new Error("I do not know command "+t)}Object.defineProperty(e,"__esModule",{value:!0}),e.unknownCommandError=i},function(t,e,n){"use strict";function i(t,e,n,i){return{name:t,optionalArguments:e,argumentCount:n,apply:i}}function r(t,e,n){return{name:t,optionalArguments:e,argumentCount:n}}function a(t,e){return{name:t,optionalArguments:0,argumentCount:e}}Object.defineProperty(e,"__esModule",{value:!0}),e.createCommandHandler=i,e.createKnownCommandWithOptArgs=r,e.createKnownCommandWithArgs=a},function(t,e,n){"use strict";function i(t){return"bb"===t||"mathbb"===t||"textbb"===t}function r(t){return"bf"===t||"mathbf"===t||"textbf"===t}function a(t){return"mono"===t}function o(t){return"frak"===t||"mathfrak"===t||"textfrak"===t}function s(t){return"it"===t||"mathit"===t||"textit"===t}function l(t){return"tt"===t||"mathtt"===t||"texttt"===t}function u(t){return"cal"===t||"mathcal"===t||"textcal"===t}function c(t){return"sup"===t||"mathsup"===t||"textsup"===t||"superscript"===t||"mathsuperscript"===t||"textsuperscript"===t}function h(t){return"sub"===t||"mathsub"===t||"textsub"===t||"subscript"===t||"mathsubscript"===t||"textsubscript"===t}function d(t){return e.formattingText.hasOwnProperty(t)||e.formattingMath.hasOwnProperty(t)||e.formattingNoMode.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.formattingText={textbb:!0,textbf:!0,textfrak:!0,textit:!0,texttt:!0,textcal:!0,textsup:!0,textsub:!0,textsuperscript:!0,textsubscript:!0},e.formattingNoMode={bb:!0,bf:!0,frak:!0,it:!0,tt:!0,cal:!0,mono:!0,sup:!0,sub:!0,superscript:!0,subscript:!0},e.formattingMath={mathbb:!0,mathbf:!0,mathfrak:!0,mathit:!0,mathtt:!0,mathcal:!0,mathsup:!0,mathsub:!0,mathsuperscript:!0,mathsubscript:!0},e.isBbCmd=i,e.isBfCmd=r,e.isMonoCmd=a,e.isFrakCmd=o,e.isItCmd=s,e.isTtCmd=l,e.isCalCmd=u,e.isSupCmd=c,e.isSubCmd=h,e.isFormattingCmd=d},function(t,e,n){"use strict";function i(t){return e.superscriptCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.superscriptCharacters={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",a:"ᵃ",b:"ᵇ",c:"ᶜ",d:"ᵈ",e:"ᵉ",f:"ᶠ",g:"ᵍ",h:"ʰ",i:"ⁱ",j:"ʲ",k:"ᵏ",l:"ˡ",m:"ᵐ",n:"ⁿ",o:"ᵒ",p:"ᵖ",r:"ʳ",s:"ˢ",t:"ᵗ",u:"ᵘ",v:"ᵛ",w:"ʷ",x:"ˣ",y:"ʸ",z:"ᶻ",A:"ᴬ",B:"ᴮ",D:"ᴰ",E:"ᴱ",G:"ᴳ",H:"ᴴ",I:"ᴵ",J:"ᴶ",K:"ᴷ",L:"ᴸ",M:"ᴹ",N:"ᴺ",O:"ᴼ",P:"ᴾ",R:"ᴿ",T:"ᵀ",U:"ᵁ",V:"ⱽ",W:"ᵂ","α":"ᵅ","β":"ᵝ","γ":"ᵞ","δ":"ᵟ","∊":"ᵋ","θ":"ᶿ","ι":"ᶥ","Φ":"ᶲ","φ":"ᵠ","χ":"ᵡ"},e.isSuperscriptCharacter=i,e.translateCharToSuperscript=function(t){return i(t)?e.superscriptCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.oneArgsCommands.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(128),a=n(129),o=n(37);e.oneArgsCommands=Object.assign({},r.spaceCmds1arg,o.formattingText,o.formattingMath,o.formattingNoMode,a.diacriticsTextMode,a.diacriticsMathMode,{cyrchar:!0,vec:!0,mono:!0}),e.is1argsCommand=i},function(t,e,n){"use strict";(function(t,n){Object.defineProperty(e,"__esModule",{value:!0});var i=t.Model.extend({defaults:{activate:!1}}),r=t.Collection.extend({model:i}),a=t.View.extend({el:"#webhook-view",initialize:function(t){var e=this,n=t.toolId||"",r=t.toolVersion||"";this.$el.attr("tool_id",n),this.$el.attr("tool_version",r),this.model=new i,this.model.urlRoot=t.urlRoot,this.model.fetch({success:function(){e.render()}})},render:function(){var t=this.model.toJSON();return this.$el.html('<div id="'+t.name+'"></div>'),t.styles&&n("<style/>",{type:"text/css"}).text(t.styles).appendTo("head"),t.script&&n("<script/>",{type:"text/javascript"}).text(t.script).appendTo("head"),this}}),o=function(t){var e=new r;e.url=Galaxy.root+t.url,e.fetch({async:!t.async||t.async,success:t.callback})};e.default={Webhooks:r,WebhookView:a,add:o}}).call(e,n(1),n(0))},function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0});var r=t.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),a=t.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var t=this.template(this.model.toJSON());return t.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(t),this.setElement(t),this},events:{click:"click"},click:function(t){return!n.isFunction(this.model.get("on_click"))||(this.model.get("on_click")(t),!1)},template:function(t){var e='title="'+t.title+'" class="icon-button';return t.is_menu_button&&(e+=" menu-button"),e+=" "+t.icon_class,t.enabled||(e+="_disabled"),e+='"',t.id&&(e+=' id="'+t.id+'"'),e+=' href="'+t.href+'"',t.target&&(e+=' target="'+t.target+'"'),t.visible||(e+=' style="display: none;"'),e=t.enabled?"<a "+e+"/>":"<span "+e+"/>",i(e)}}),o=t.Collection.extend({model:r}),s=t.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var t=this;return this.collection.each(function(e){var n=i("<a/>").attr("href","javascript:void(0)").attr("title",e.attributes.title).addClass("icon-button menu-button").addClass(e.attributes.icon_class).appendTo(t.$el).click(e.attributes.on_click);e.attributes.tooltip_config&&n.tooltip(e.attributes.tooltip_config);var r=e.get("options");r&&make_popupmenu(n,r)}),this}}),l=function(t,e){e||(e={});var i=new o(n.map(t,function(t){return new r(n.extend(t,e))}));return new s({collection:i})};e.default={IconButton:r,IconButtonView:a,IconButtonCollection:o,IconButtonMenuView:s,create_icon_buttons_menu:l}}).call(e,n(1),n(2),n(0))},,function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=function(t){return t&&t.__esModule?t:{default:t}}(r),o=t.View.extend({initialize:function(t){this.options=a.default.merge(t,{content:"No content available.",onchange:null,ondblclick:null,onconfirm:null,cls:"ui-table",selectable:!0,cls_tr:""}),this.setElement(this._template()),this.$thead=this.$("thead"),this.$tbody=this.$("tbody"),this.$tmessage=this.$("tmessage"),this.row=this._row(),this.row_count=0},events:{click:"_onclick",dblclick:"_ondblclick"},addHeader:function(t){this.row.append(i("<th/>").append(t))},appendHeader:function(){this.$thead.append(this.row),this.row=i("<tr/>")},add:function(t,e,n){var r=i("<td/>");e&&r.css("width",e),n&&r.css("text-align",n),this.row.append(r.append(t))},append:function(t,e){this._commit(t,e,!1)},prepend:function(t,e){this._commit(t,e,!0)},get:function(t){return this.$("#"+t)},del:function(t){var e=this.$tbody.find("#"+t);e.length>0&&(e.remove(),this.row_count--,this._refresh())},delAll:function(){this.$tbody.empty(),this.row_count=0,this._refresh()},value:function(t){if(this.options.selectable){this.before=this.$tbody.find(".current").attr("id"),void 0!==t&&(this.$tbody.find("tr").removeClass("current"),t&&this.$tbody.find("#"+t).addClass("current"));var e=this.$tbody.find(".current").attr("id");return void 0===e?null:(e!=this.before&&this.options.onchange&&this.options.onchange(t),e)}},size:function(){return this.$tbody.find("tr").length},_commit:function(t,e,n){this.del(t),this.row.attr("id",t),n?this.$tbody.prepend(this.row):this.$tbody.append(this.row),e&&(this.row.hide(),this.row.fadeIn()),this.row=this._row(),this.row_count++,this._refresh()},_row:function(){return i('<tr class="'+this.options.cls_tr+'"></tr>')},_onclick:function(t){var e=this.value(),n=i(t.target).closest("tr").attr("id");""!=n&&n&&e!=n&&(this.options.onconfirm?this.options.onconfirm(n):this.value(n))},_ondblclick:function(t){var e=this.value();e&&this.options.ondblclick&&this.options.ondblclick(e)},_refresh:function(){0==this.row_count?this.$tmessage.show():this.$tmessage.hide()},_template:function(){return'<div><table class="'+this.options.cls+'"><thead/><tbody/></table><tmessage>'+this.options.content+"</tmessage><div>"}});e.default={View:o}}).call(e,n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),o=(function(t){t&&t.__esModule}(a),t.Model.extend({initialize:function(t){this.app=t},checksum:function(){var t="",e=this;return this.app.section.$el.find(".section-row").each(function(){var n=i(this).attr("id"),r=e.app.field_list[n];r&&(t+=n+":"+JSON.stringify(r.value&&r.value())+":"+r.collapsed+";")}),t},create:function(){function t(t,e,i){n.flat_dict[t]=e,r[t]=i,n.app.element_list[e]&&n.app.element_list[e].$el.attr("tour_id",t)}function e(i,r){for(var a in r){var o=r[a];if(o.input){var l=o.input,u=i;switch(""!=i&&(u+="|"),u+=l.name,l.type){case"repeat":var c=[],h=null;for(var d in o){var f=d.indexOf("section-");-1!=f&&(f+="section-".length,c.push(parseInt(d.substr(f))),h||(h=d.substr(0,f)))}c.sort(function(t,e){return t-e});var a=0;for(var p in c)e(u+"_"+a++,o[h+c[p]]);break;case"conditional":var _=n.app.field_list[l.id].value();t(u+"|"+l.test_param.name,l.id,_);var g=s(l,_);-1!=g&&e(u,r[l.id+"-section-"+g]);break;case"section":e(!l.flat&&u||"",o);break;default:var v=n.app.field_list[l.id];if(v&&v.value){var _=v.value();if((void 0===l.ignore||l.ignore!=_)&&(v.collapsed&&l.collapsible_value&&(_=l.collapsible_value),t(u,l.id,_),l.payload))for(var m in l.payload)t(m,l.id,l.payload[m])}}}}}var n=this,i={};this._iterate(this.app.section.$el,i);var r={};return this.flat_dict={},e("",i),r},match:function(t){return this.flat_dict&&this.flat_dict[t]},matchCase:function(t,e){return s(t,e)},matchModel:function(t,e){var n=this;l(t.inputs,function(t,i){n.flat_dict[i]&&e(t,n.flat_dict[i])})},matchResponse:function(t){function e(t,r){if("string"==typeof r){var a=i.flat_dict[t];a&&(n[a]=r)}else for(var o in r){var s=o;if(""!==t){var l="|";r instanceof Array&&(l="_"),s=t+l+s}e(s,r[o])}}var n={},i=this;return e("",t),n},_iterate:function(t,e){var n=this;i(t).children().each(function(){var t=this,r=i(t).attr("id");if(i(t).hasClass("section-row")){var a=n.app.input_list[r];e[r]=a&&{input:a}||{},n._iterate(t,e[r])}else n._iterate(t,e)})}})),s=function(t,e){"boolean"==t.test_param.type&&(e="true"==e?t.test_param.truevalue||"true":t.test_param.falsevalue||"false");for(var n in t.cases)if(t.cases[n].value==e)return n;return-1},l=function t(e,n,a,o){o=i.extend(!0,{},o),r.each(e,function(t){t&&t.type&&t.name&&(o[t.name]=t)});for(var l in e){var u=e[l];u.name=u.name||l;var c=a?a+"|"+u.name:u.name;switch(u.type){case"repeat":r.each(u.cache,function(e,i){t(e,n,c+"_"+i,o)});break;case"conditional":if(u.test_param){n(u.test_param,c+"|"+u.test_param.name,o);var h=s(u,u.test_param.value);-1!=h?t(u.cases[h].inputs,n,c,o):Galaxy.emit.debug("form-data::visitInputs() - Invalid case for "+c+".")}else Galaxy.emit.debug("form-data::visitInputs() - Conditional test parameter missing for "+c+".");break;case"section":t(u.inputs,n,c,o);break;default:n(u,c,o)}}};e.default={Manager:o,visitInputs:l}}).call(e,n(1),n(0),n(2))},function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0});var r=t.View.extend({initialize:function(e){this.model=e&&e.model||new t.Model(e),this.setElement(n("<div/>").addClass("corner frame")),this.$el.append(n("<div/>").addClass("f-header corner").append(n("<div/>").addClass("f-title")).append(n("<div/>").addClass("f-icon f-close fa fa-close").tooltip({title:"Close",placement:"bottom"}))).append(n("<div/>").addClass("f-content")).append(n("<div/>").addClass("f-resize f-icon corner fa fa-expand").tooltip({title:"Resize"})).append(n("<div/>").addClass("f-cover")),this.$header=this.$(".f-header"),this.$title=this.$(".f-title"),this.$content=this.$(".f-content"),this.render(),this.listenTo(this.model,"change",this.render,this)},render:function(){var t=this,e=this.model.attributes;this.$title.html(e.title||""),this.$header.find(".f-icon-left").remove(),i.each(e.menu,function(e){var r=n("<div/>").addClass("f-icon-left").addClass(e.icon);i.isFunction(e.disabled)&&e.disabled()?r.attr("disabled",!0):r.on("click",function(){e.onclick(t)}).tooltip({title:e.tooltip,placement:"bottom"}),t.$header.append(r)}),e.url?this.$content.html(n("<iframe/>").addClass("f-iframe").attr("scrolling","auto").attr("src",e.url+(-1===e.url.indexOf("?")?"?":"&")+"widget=True")):e.content&&(i.isFunction(e.content)?e.content(t.$content):t.$content.html(e.content))}}),a=t.View.extend({defaultOptions:{frame:{cols:6,rows:3},rows:1e3,cell:130,margin:5,scroll:5,top_min:40,frame_max:9,visible:!0},cols:0,top:0,top_max:0,frame_z:0,frame_counter:0,frame_uid:0,frame_list:{},frame_shadow:null,visible:!1,event:{},initialize:function(e){var r=this;this.options=i.defaults(e||{},this.defaultOptions),this.visible=this.options.visible,this.top=this.top_max=this.options.top_min,this.setElement(n("<div/>").addClass("galaxy-frame").append(n("<div/>").addClass("frame-background")).append(n("<div/>").addClass("frame-menu frame-scroll-up fa fa-chevron-up fa-2x")).append(n("<div/>").addClass("frame-menu frame-scroll-down fa fa-chevron-down fa-2x"))),this.frame_shadow=new t.View({el:n("<div/>").addClass("corner frame-shadow")}),this.$el.append(this.frame_shadow.$el),this._frameInit(this.frame_shadow,"#frame-shadow"),this._frameResize(this.frame_shadow,{width:0,height:0}),this.frame_list["#frame-shadow"]=this.frame_shadow,this.visible?this.show():this.hide(),this._panelRefresh(),n(window).resize(function(){r.visible&&r._panelRefresh()})},render:function(){this.$(".frame-scroll-up")[this.top!=this.options.top_min&&"show"||"hide"](),this.$(".frame-scroll-down")[this.top!=this.top_max&&"show"||"hide"]()},add:function(t){if(this.frame_counter>=this.options.frame_max)Galaxy.modal.show({title:"Warning",body:"You have reached the maximum number of allowed frames ("+this.options.frame_max+").",buttons:{Close:function(){Galaxy.modal.hide()}}});else{var e="#frame-"+this.frame_uid++;if(0!==n(e).length)Galaxy.modal.show({title:"Error",body:"This frame already exists. This page might contain multiple frame managers.",buttons:{Close:function(){Galaxy.modal.hide()}}});else{this.top=this.options.top_min;var i=new r(t);this.$el.append(i.$el),t.width=this._toPixelCoord("width",this.options.frame.cols),t.height=this._toPixelCoord("height",this.options.frame.rows),this.frame_z=parseInt(i.$el.css("z-index")),this.frame_list[e]=i,this.frame_counter++,this._frameInit(i,e),this._frameResize(i,{width:t.width,height:t.height}),this._frameInsert(i,{top:0,left:0},!0),!this.visible&&this.show(),this.trigger("add")}}},del:function(t){var e=this,n=t.$el;n.fadeOut("fast",function(){n.remove(),delete e.frame_list[t.id],e.frame_counter--,e._panelRefresh(!0),e._panelAnimationComplete(),e.trigger("remove")})},show:function(){this.visible=!0,this.$el.fadeIn("fast"),this.trigger("show")},hide:function(){this.event.type||(this.visible=!1,this.$el.fadeOut("fast",function(){n(this).hide()}),this.trigger("hide"))},length:function(){return this.frame_counter},events:{mousemove:"_eventFrameMouseMove",mouseup:"_eventFrameMouseUp",mouseleave:"_eventFrameMouseUp",mousewheel:"_eventPanelScroll",DOMMouseScroll:"_eventPanelScroll","mousedown .frame":"_eventFrameMouseDown","mousedown .frame-background":"_eventHide","mousedown .frame-scroll-up":"_eventPanelScroll_up","mousedown .frame-scroll-down":"_eventPanelScroll_down","mousedown .f-close":"_eventFrameClose"},_eventFrameMouseDown:function(t){n(".tooltip").hide(),this.event.type||((n(t.target).hasClass("f-header")||n(t.target).hasClass("f-title"))&&(this.event.type="drag"),n(t.target).hasClass("f-resize")&&(this.event.type="resize"),this.event.type&&(t.preventDefault(),this.event.target=this._frameIdentify(t.target),this.event.xy={x:t.originalEvent.pageX,y:t.originalEvent.pageY},this._frameDragStart(this.event.target)))},_eventFrameMouseMove:function(t){if(this.event.type){var e={x:t.originalEvent.pageX,y:t.originalEvent.pageY},n={x:e.x-this.event.xy.x,y:e.y-this.event.xy.y};this.event.xy=e;var i=this._frameScreen(this.event.target);if("resize"==this.event.type){i.width+=n.x,i.height+=n.y;var r=this.options.cell-this.options.margin-1;i.width=Math.max(i.width,r),i.height=Math.max(i.height,r),this._frameResize(this.event.target,i),i.width=this._toGridCoord("width",i.width)+1,i.height=this._toGridCoord("height",i.height)+1,i.width=this._toPixelCoord("width",i.width),i.height=this._toPixelCoord("height",i.height),this._frameResize(this.frame_shadow,i),this._frameInsert(this.frame_shadow,{top:this._toGridCoord("top",i.top),left:this._toGridCoord("left",i.left)})}else if("drag"==this.event.type){i.left+=n.x,i.top+=n.y,this._frameOffset(this.event.target,i);var a={top:this._toGridCoord("top",i.top),left:this._toGridCoord("left",i.left)};0!==a.left&&a.left++,this._frameInsert(this.frame_shadow,a)}}},_eventFrameMouseUp:function(t){this.event.type&&(this._frameDragStop(this.event.target),this.event.type=null)},_eventFrameClose:function(t){this.event.type||(t.preventDefault(),this.del(this._frameIdentify(t.target)))},_eventHide:function(t){!this.event.type&&this.hide()},_eventPanelScroll:function(t){if(!this.event.type&&this.visible){0!==n(t.srcElement).parents(".frame").length?t.stopPropagation():(t.preventDefault(),this._panelScroll(t.originalEvent.detail?t.originalEvent.detail:t.originalEvent.wheelDelta/-3))}},_eventPanelScroll_up:function(t){this.event.type||(t.preventDefault(),this._panelScroll(-this.options.scroll))},_eventPanelScroll_down:function(t){this.event.type||(t.preventDefault(),this._panelScroll(this.options.scroll))},_frameIdentify:function(t){return this.frame_list["#"+n(t).closest(".frame").attr("id")]},_frameDragStart:function(t){this._frameFocus(t,!0);var e=this._frameScreen(t);this._frameResize(this.frame_shadow,e),this._frameGrid(this.frame_shadow,t.grid_location),t.grid_location=null,this.frame_shadow.$el.show(),n(".f-cover").show()},_frameDragStop:function(t){this._frameFocus(t,!1);var e=this._frameScreen(this.frame_shadow);this._frameResize(t,e),this._frameGrid(t,this.frame_shadow.grid_location,!0),this.frame_shadow.grid_location=null,this.frame_shadow.$el.hide(),n(".f-cover").hide(),this._panelAnimationComplete()},_toGridCoord:function(t,e){var n="width"==t||"height"==t?1:-1;return"top"==t&&(e-=this.top),parseInt((e+n*this.options.margin)/this.options.cell,10)},_toPixelCoord:function(t,e){var n="width"==t||"height"==t?1:-1,i=e*this.options.cell-n*this.options.margin;return"top"==t&&(i+=this.top),i},_toGrid:function(t){return{top:this._toGridCoord("top",t.top),left:this._toGridCoord("left",t.left),width:this._toGridCoord("width",t.width),height:this._toGridCoord("height",t.height)}},_toPixel:function(t){return{top:this._toPixelCoord("top",t.top),left:this._toPixelCoord("left",t.left),width:this._toPixelCoord("width",t.width),height:this._toPixelCoord("height",t.height)}},_isCollision:function(t){for(var e in this.frame_list){var n=this.frame_list[e];if(null!==n.grid_location&&function(t,e){return!(t.left>e.left+e.width-1||t.left+t.width-1<e.left||t.top>e.top+e.height-1||t.top+t.height-1<e.top)}(t,n.grid_location))return!0}return!1},_locationRank:function(t){return t.top*this.cols+t.left},_panelRefresh:function(t){this.cols=parseInt(n(window).width()/this.options.cell,10)+1,this._frameInsert(null,null,t)},_panelAnimationComplete:function(){var t=this;n(".frame").promise().done(function(){t._panelScroll(0,!0)})},_panelScroll:function(t,e){var n=this.top-this.options.scroll*t;if(n=Math.max(n,this.top_max),n=Math.min(n,this.options.top_min),this.top!=n){for(var i in this.frame_list){var r=this.frame_list[i];if(null!==r.grid_location){var a={top:r.screen_location.top-(this.top-n),left:r.screen_location.left};this._frameOffset(r,a,e)}}this.top=n}this.render()},_frameInit:function(t,e){t.id=e,t.screen_location={},t.grid_location={},t.grid_rank=null,t.$el.attr("id",e.substring(1))},_frameInsert:function(t,e,r){var a=this,o=[];t&&(t.grid_location=null,o.push([t,this._locationRank(e)])),i.each(this.frame_list,function(t){null!==t.grid_location&&(t.grid_location=null,o.push([t,t.grid_rank]))}),o.sort(function(t,e){return t[1]<e[1]?-1:t[1]>e[1]?1:0}),i.each(o,function(t){a._framePlace(t[0],r)}),this.top_max=0,i.each(this.frame_list,function(t){null!==t.grid_location&&(a.top_max=Math.max(a.top_max,t.grid_location.top+t.grid_location.height))}),this.top_max=n(window).height()-this.top_max*this.options.cell-2*this.options.margin,this.top_max=Math.min(this.top_max,this.options.top_min),this.render()},_framePlace:function(t,e){t.grid_location=null;for(var n=this._toGrid(this._frameScreen(t)),i=!1,r=0;r<this.options.rows;r++){for(var a=0;a<Math.max(1,this.cols-n.width);a++)if(n.top=r,n.left=a,!this._isCollision(n)){i=!0;break}if(i)break}i?this._frameGrid(t,n,e):console.log("Grid dimensions exceeded.")},_frameFocus:function(t,e){t.$el.css("z-index",this.frame_z+(e?1:0))},_frameOffset:function(t,e,n){if(t.screen_location.left=e.left,t.screen_location.top=e.top,n){this._frameFocus(t,!0);var i=this;t.$el.animate({top:e.top,left:e.left},"fast",function(){i._frameFocus(t,!1)})}else t.$el.css({top:e.top,left:e.left})},_frameResize:function(t,e){t.$el.css({width:e.width,height:e.height}),t.screen_location.width=e.width,t.screen_location.height=e.height},_frameGrid:function(t,e,n){t.grid_location=e,this._frameOffset(t,this._toPixel(e),n),t.grid_rank=this._locationRank(e)},_frameScreen:function(t){var e=t.screen_location;return{top:e.top,left:e.left,width:e.width,height:e.height}}});e.default={View:a}}).call(e,n(1),n(0),n(2))},function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=function(t){return t&&t.__esModule?t:{default:t}}(r),o=t.View.extend({initialize:function(e){var n=this;this.model=e&&e.model||new t.Model({id:a.default.uid(),min:null,max:null,step:null,precise:!1,split:1e4,value:null,onchange:function(){}}).set(e),this.setElement(this._template()),this.$el.attr("id",this.model.id),this.$text=this.$(".ui-form-slider-text"),this.$slider=this.$(".ui-form-slider-element");var r=[];this.$text.on("change",function(){n.value(i(this).val())}).on("keyup",function(t){r[t.which]=!1}).on("keydown",function(t){var e=t.which;r[e]=!0,n.model.get("is_workflow")&&r[16]&&52==e?(n.value("$"),event.preventDefault()):8==e||9==e||13==e||37==e||39==e||e>=48&&e<=57&&!r[16]||e>=96&&e<=105||(190==e||110==e)&&-1==i(this).val().indexOf(".")&&n.model.get("precise")||(189==e||109==e)&&-1==i(this).val().indexOf("-")||n._isParameter(i(this).val())||r[91]||r[17]||event.preventDefault()});var o=this.model.attributes;this.has_slider=null!==o.max&&null!==o.min&&o.max>o.min;var s=o.step;s||(s=o.precise&&this.has_slider?(o.max-o.min)/o.split:1),this.has_slider?(this.$text.addClass("ui-form-slider-left"),this.$slider.slider({min:o.min,max:o.max,step:s}).on("slide",function(t,e){n.value(e.value)})):this.$slider.hide(),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var t=this.model.get("value");this.has_slider&&this.$slider.slider("value",t),t!==this.$text.val()&&this.$text.val(t)},value:function(t){var e=this.model.attributes;return void 0!==t&&(null===t||""===t||this._isParameter(t)||(isNaN(t)&&(t=0),!e.precise&&(t=Math.round(t)),null!==e.max&&(t=Math.min(t,e.max)),null!==e.min&&(t=Math.max(t,e.min))),this.model.set("value",t),this.model.trigger("change"),e.onchange(t)),this.model.get("value")},_isParameter:function(t){return this.model.get("is_workflow")&&"$"===String(t).substring(0,1)},_template:function(){return'<div class="ui-form-slider"><input class="ui-form-slider-text" type="text"/><div class="ui-form-slider-element"/></div>'}});e.default={View:o}}).call(e,n(1),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),o=r(a),s=n(23),l=r(s),u=l.default.BaseIcons.extend({initialize:function(t){t.type=t.display||"checkbox",t.multiple="checkbox"==t.type,l.default.BaseIcons.prototype.initialize.call(this,t)},_setValue:function(e){if(l.default.BaseIcons.prototype._setValue.call(this,e),void 0!==e&&null!==e&&this.header_index){var n=this,r=t.isArray(e)?e:[e];i.each(r,function(t){var e=n.header_index[t];i.each(e,function(t){n._setState(t,!0)})})}},_setState:function(t,e){var n=this.$(".button-"+t),i=this.$(".subgroup-"+t);n.data("is_expanded",e),e?(i.show(),n.removeClass("fa-plus-square").addClass("fa-minus-square")):(i.hide(),n.removeClass("fa-minus-square").addClass("fa-plus-square"))},_templateOptions:function(){function e(t,e){var n=t.find(".button-"+e);n.on("click",function(){i._setState(e,!n.data("is_expanded"))})}function n(r,a,s){s=s||[];for(var l in a){var u=a[l],c=u.options&&u.options.length>0,h=s.slice(0);i.header_index[u.value]=h.slice(0);var d=t("<div/>");if(c){var f=o.default.uid(),p=t("<span/>").addClass("button-"+f).addClass("ui-drilldown-button fa fa-plus-square"),_=t("<div/>").addClass("subgroup-"+f).addClass("ui-drilldown-subgroup");d.append(t("<div/>").append(p).append(i._templateOption({label:u.name,value:u.value}))),h.push(f),n(_,u.options,h),d.append(_),e(d,f)}else d.append(i._templateOption({label:u.name,value:u.value}));r.append(d)}}var i=this;this.header_index={};var r=t("<div/>");return n(r,this.model.get("data")),r},_template:function(){return t("<div/>").addClass("ui-options-list drilldown-container").attr("id",this.model.id)}});e.default={View:u}}).call(e,n(0),n(2))},function(t,e,n){"use strict";(function(t,i,r,a){function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var s=n(3),l=o(s),u=n(4),c=(o(u),n(11)),h=o(c),d=n(49),f=o(d),p=n(50),_=o(p),g=n(51),v=o(g),m=t.View.extend({initialize:function(t,e){this.app=t,this.inputs=e.inputs,this.parameters=new v.default,this.setElement(i("<div/>")),this.render()},render:function(){var t=this;this.$el.empty(),r.each(this.inputs,function(e){t.add(e)})},add:function(t){var e=a.extend(!0,{},t);switch(e.id=t.id=l.default.uid(),this.app.input_list[e.id]=e,e.type){case"conditional":this._addConditional(e);break;case"repeat":this._addRepeat(e);break;case"section":this._addSection(e);break;default:this._addRow(e)}},_addConditional:function(t){var e=this;t.test_param.id=t.id,this.app.model.get("sustain_conditionals")&&(t.test_param.disabled=!0);var n=this._addRow(t.test_param);n.model&&n.model.set("onchange",function(n){var i=e.app.data.matchCase(t,n);for(var r in t.cases){var a=t.cases[r],o=e.$("#"+t.id+"-section-"+r),s=!1;for(var l in a.inputs)if(!a.inputs[l].hidden){s=!0;break}r==i&&s?o.fadeIn("fast"):o.hide()}e.app.trigger("change")});for(var i in t.cases){var r=new m(this.app,{inputs:t.cases[i].inputs});this._append(r.$el.addClass("ui-form-section"),t.id+"-section-"+i)}n.trigger("change")},_addRepeat:function(t){function e(e){var r=t.id+"-section-"+i++,o=new m(n.app,{inputs:e});a.add({id:r,$el:o.$el,ondel:function(){a.del(r),n.app.trigger("change")}})}for(var n=this,i=0,a=new f.default.View({title:t.title||"Repeat",min:t.min,max:t.max,onnew:function(){e(t.inputs),n.app.trigger("change")}}),o=r.size(t.cache),s=0;s<Math.max(Math.max(o,t.min||0),t.default||0);s++)e(s<o?t.cache[s]:t.inputs);this.app.model.get("sustain_repeats")&&a.hideOptions();var l=new _.default(this.app,{label:t.title||t.name,help:t.help,field:a});this._append(l.$el,t.id)},_addSection:function(t){var e=new h.default.View({title:t.title||t.name,cls:"ui-portlet-section",collapsible:!0,collapsible_button:!0,collapsed:!t.expanded});e.append(new m(this.app,{inputs:t.inputs}).$el),e.append(i("<div/>").addClass("ui-form-info").html(t.help)),this.app.on("expand",function(t){e.$("#"+t).length>0&&e.expand()}),this._append(e.$el,t.id)},_addRow:function(t){var e=this,n=t.id;t.onchange=t.onchange||function(){e.app.trigger("change",n)};var i=this.parameters.create(t);this.app.field_list[n]=i;var r=new _.default(this.app,{name:t.name,label:t.hide_label?"":t.label||t.name,value:t.value,text_value:t.text_value,collapsible_value:t.collapsible_value,collapsible_preview:t.collapsible_preview,help:t.help,argument:t.argument,disabled:t.disabled,color:t.color,style:t.style,backdrop:t.backdrop,hidden:t.hidden,fixed:t.fixed,field:i});return this.app.element_list[n]=r,this._append(r.$el,t.id),i},_append:function(t,e){this.$el.append(t.addClass("section-row").attr("id",e))}});e.default={View:m}}).call(e,n(1),n(0),n(2),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(11),u=a(l),c=n(4),h=a(c),d=t.View.extend({initialize:function(t){this.list={},this.options=s.default.merge(t,{title:"Repeat",empty_text:"Not available.",max:null,min:null}),this.button_new=new h.default.ButtonIcon({icon:"fa-plus",title:"Insert "+this.options.title,tooltip:"Add new "+this.options.title+" block",cls:"ui-button-icon ui-clear-float form-repeat-add",onclick:function(){t.onnew&&t.onnew()}}),this.setElement(i("<div/>").append(this.$list=i("<div/>")).append(i("<div/>").append(this.button_new.$el)))},size:function(){return r.size(this.list)},add:function(t){if(!t.id||this.list[t.id])return void Galaxy.emit.debug("form-repeat::add()","Duplicate or invalid repeat block id.");var e=new h.default.ButtonIcon({icon:"fa-trash-o",tooltip:"Delete this repeat block",cls:"ui-button-icon-plain form-repeat-delete",onclick:function(){t.ondel&&t.ondel()}}),n=new u.default.View({id:t.id,title:"placeholder",cls:t.cls||"ui-portlet-repeat",operations:{button_delete:e}});n.append(t.$el),n.$el.addClass("section-row").hide(),this.list[t.id]=n,this.$list.append(n.$el.fadeIn("fast")),this.options.max>0&&this.size()>=this.options.max&&this.button_new.disable(),this._refresh()},del:function(t){if(!this.list[t])return void Galaxy.emit.debug("form-repeat::del()","Invalid repeat block id.");this.$list.find("#"+t).remove(),delete this.list[t],this.button_new.enable(),this._refresh()},delAll:function(){for(var t in this.list)this.del(t)},hideOptions:function(){this.button_new.$el.hide(),r.each(this.list,function(t){t.hideOperation("button_delete")}),r.isEmpty(this.list)&&this.$el.append(i("<div/>").addClass("ui-form-info").html(this.options.empty_text))},_refresh:function(){var t=0;for(var e in this.list){var n=this.list[e];n.title(++t+": "+this.options.title),n[this.size()>this.options.min?"showOperation":"hideOperation"]("button_delete")}}});e.default={View:d}}).call(e,n(1),n(0),n(2))},function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.View.extend({initialize:function(e,n){this.app=e,this.app_options=e.model?e.model.attributes:{},this.field=n&&n.field||new t.View,this.model=n&&n.model||new t.Model({text_enable:this.app_options.text_enable||"Enable",text_disable:this.app_options.text_disable||"Disable",cls_enable:this.app_options.cls_enable||"fa fa-caret-square-o-down",cls_disable:this.app_options.cls_disable||"fa fa-caret-square-o-up",always_refresh:this.app_options.always_refresh}).set(n),this.setElement(this._template()),this.$field=this.$(".ui-form-field"),this.$info=this.$(".ui-form-info"),this.$preview=this.$(".ui-form-preview"),this.$collapsible=this.$(".ui-form-collapsible"),this.$collapsible_text=this.$(".ui-form-collapsible-text"),this.$collapsible_icon=this.$(".ui-form-collapsible-icon"),this.$title=this.$(".ui-form-title"),this.$title_text=this.$(".ui-form-title-text"),this.$error_text=this.$(".ui-form-error-text"),this.$error=this.$(".ui-form-error"),this.$backdrop=this.$(".ui-form-backdrop"),this.$field.prepend(this.field.$el);var i=this.model.get("collapsible_value");this.field.collapsed=void 0!==i&&JSON.stringify(this.model.get("value"))==JSON.stringify(i),this.listenTo(this.model,"change",this.render,this),this.render();var r=this;this.$collapsible.on("click",function(){r.field.collapsed=!r.field.collapsed,e.trigger&&e.trigger("change"),r.render()}),this.field.model&&!this.model.get("always_refresh")&&this.listenTo(this.field.model,"change:value",function(){r.reset()})},backdrop:function(){this.model.set("backdrop",!0)},error:function(t){this.model.set("error_text",t)},reset:function(){!this.model.get("fixed")&&this.model.set("error_text",null)},render:function(){n(".tooltip").hide();var t=this.model.get("help",""),e=this.model.get("argument");e&&-1==t.indexOf("("+e+")")&&(t+=" ("+e+")"),this.$info.html(t),this.$el[this.model.get("hidden")?"hide":"show"](),this.$preview[this.field.collapsed&&this.model.get("collapsible_preview")||this.model.get("disabled")?"show":"hide"]().html(i.escape(this.model.get("text_value")));var r=this.model.get("error_text");if(this.$error[r?"show":"hide"](),this.$el[r?"addClass":"removeClass"]("ui-error"),this.$error_text.html(r),this.$backdrop[this.model.get("backdrop")?"show":"hide"](),this.field.collapsed||this.model.get("disabled")?this.$field.hide():this.$field.show(),this.field.model&&this.field.model.set({color:this.model.get("color"),style:this.model.get("style")}),this.model.get("disabled")||void 0===this.model.get("collapsible_value"))this.$title_text.show().text(this.model.get("label")),this.$collapsible.hide();else{var a=this.field.collapsed?"enable":"disable";this.$title_text.hide(),this.$collapsible.show(),this.$collapsible_text.text(this.model.get("label")),this.$collapsible_icon.removeClass().addClass("icon").addClass(this.model.get("cls_"+a)).attr("data-original-title",this.model.get("text_"+a)).tooltip({placement:"bottom"})}},_template:function(){return n("<div/>").addClass("ui-form-element").append(n("<div/>").addClass("ui-form-error ui-error").append(n("<span/>").addClass("fa fa-arrow-down")).append(n("<span/>").addClass("ui-form-error-text"))).append(n("<div/>").addClass("ui-form-title").append(n("<div/>").addClass("ui-form-collapsible").append(n("<i/>").addClass("ui-form-collapsible-icon")).append(n("<span/>").addClass("ui-form-collapsible-text"))).append(n("<span/>").addClass("ui-form-title-text"))).append(n("<div/>").addClass("ui-form-field").append(n("<span/>").addClass("ui-form-info")).append(n("<div/>").addClass("ui-form-backdrop"))).append(n("<div/>").addClass("ui-form-preview"))}})}).call(e,n(1),n(0),n(2))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(4),u=a(l),c=n(52),h=a(c),d=n(53),f=a(d),p=n(54),_=a(p),g=n(55),v=a(g),m=n(57),y=a(m);e.default=t.Model.extend({types:{text:"_fieldText",password:"_fieldText",select:"_fieldSelect",data_column:"_fieldSelect",genomebuild:"_fieldSelect",data:"_fieldData",data_collection:"_fieldData",integer:"_fieldSlider",float:"_fieldSlider",boolean:"_fieldBoolean",drill_down:"_fieldDrilldown",color:"_fieldColor",hidden:"_fieldHidden",hidden_data:"_fieldHidden",baseurl:"_fieldHidden",library_data:"_fieldLibrary",ftpfile:"_fieldFtp",upload:"_fieldUpload",genomespacefile:"_fieldGenomeSpace"},create:function(t){var e=this.types[t.type],n="function"==typeof this[e]?this[e].call(this,t):null;return n||(n=t.options?this._fieldSelect(t):this._fieldText(t),Galaxy.emit.debug("form-parameters::_addRow()","Auto matched field type ("+t.type+").")),void 0===t.value&&(t.value=null),n.value(t.value),n},_fieldData:function(t){return new h.default.View({id:"field-"+t.id,extensions:t.extensions,optional:t.optional,multiple:t.multiple,type:t.type,flavor:t.flavor,data:t.options,onchange:t.onchange})},_fieldSelect:function(t){if(t.is_workflow)return this._fieldText(t);"data_column"==t.type&&(t.error_text="Missing columns in referenced dataset.");var e=t.data;e||(e=[],i.each(t.options,function(t){e.push({label:t[0],value:t[1]})}));var n=u.default.Select;switch(t.display){case"checkboxes":n=u.default.Checkbox;break;case"radio":n=u.default.Radio;break;case"radiobutton":n=u.default.RadioButton}return new n.View({id:"field-"+t.id,data:e,error_text:t.error_text||"No options available",readonly:t.readonly,multiple:t.multiple,optional:t.optional,onchange:t.onchange,individual:t.individual,searchable:"workflow"!==t.flavor})},_fieldDrilldown:function(t){return t.is_workflow?this._fieldText(t):new u.default.Drilldown.View({id:"field-"+t.id,data:t.options,display:t.display,optional:t.optional,onchange:t.onchange})},_fieldText:function(t){if(t.options&&t.data)if(t.area=t.multiple,s.default.isEmpty(t.value))t.value=null;else if(r.isArray(t.value)){var e="";for(var n in t.value){if(e+=String(t.value[n]),!t.multiple)break;e+="\n"}t.value=e}return new u.default.Input({id:"field-"+t.id,type:t.type,area:t.area,readonly:t.readonly,placeholder:t.placeholder,datalist:t.datalist,onchange:t.onchange})},_fieldSlider:function(t){return new u.default.Slider.View({id:"field-"+t.id,precise:"float"==t.type,is_workflow:t.is_workflow,min:t.min,max:t.max,onchange:t.onchange})},_fieldHidden:function(t){return new u.default.Hidden({id:"field-"+t.id,info:t.info})},_fieldBoolean:function(t){return new u.default.RadioButton.View({id:"field-"+t.id,data:[{label:"Yes",value:"true"},{label:"No",value:"false"}],onchange:t.onchange})},_fieldColor:function(t){return new y.default({id:"field-"+t.id,onchange:t.onchange})},_fieldLibrary:function(t){return new f.default.View({id:"field-"+t.id,optional:t.optional,multiple:t.multiple,onchange:t.onchange})},_fieldFtp:function(t){return new _.default.View({id:"field-"+t.id,optional:t.optional,multiple:t.multiple,onchange:t.onchange})},_fieldGenomeSpace:function(t){var e=this;return new v.default.View({id:"field-"+t.id,onchange:function(){e.app.trigger("change")}})},_fieldUpload:function(t){return new u.default.Upload({id:"field-"+t.id,onchange:t.onchange})}})}).call(e,n(1),n(2),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(4),u=a(l),c=n(22),h=a(c),d={DISABLED:"disabled",ENABLED:"enabled",LINKED:"linked"},f={data:[{src:"hda",icon:"fa-file-o",tooltip:"Single dataset",multiple:!1,batch:d.DISABLED},{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:d.LINKED},{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:d.LINKED}],data_multiple:[{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:d.DISABLED},{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collections",multiple:!0,batch:d.DISABLED}],data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:d.DISABLED}],workflow_data:[{src:"hda",icon:"fa-file-o",tooltip:"Single dataset",multiple:!1,batch:d.DISABLED}],workflow_data_multiple:[{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:d.DISABLED}],workflow_data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:d.DISABLED}],module_data:[{src:"hda",icon:"fa-file-o",tooltip:"Single dataset",multiple:!1,batch:d.DISABLED},{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:d.ENABLED}],module_data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:d.DISABLED},{src:"hdca",icon:"fa-folder",tooltip:"Multiple collections",multiple:!0,batch:d.ENABLED}]},p=t.View.extend({initialize:function(e){var n=this;this.model=e&&e.model||new t.Model({src_labels:{hda:"dataset",hdca:"dataset collection"},pagelimit:100,statustimer:1e3}).set(e),this.setElement(i("<div/>").addClass("ui-select-content")),this.button_product=new u.default.RadioButton.View({value:"false",data:[{icon:"fa fa-chain",value:"false",tooltip:"Linked inputs will be run in matched order with other datasets e.g. use this for matching forward and reverse reads."},{icon:"fa fa-chain-broken",value:"true",tooltip:"Unlinked dataset inputs will be run against *all* other inputs."}]});var r=i("<div/>").addClass("ui-form-info").append(i("<i/>").addClass("fa fa-sitemap")).append(i("<span/>").html("This is a batch mode input field. Separate jobs will be triggered for each dataset selection."));this.$batch={linked:r.clone(),enabled:r.clone().append(i("<div/>").append(i("<div/>").addClass("ui-form-title").html("Batch options:")).append(this.button_product.$el)).append(i("<div/>").css("clear","both"))},this.$el.on("dragenter",function(t){this.lastenter=t.target,n.$el.addClass("ui-dragover")}).on("dragover",function(t){t.preventDefault()}).on("dragleave",function(t){this.lastenter===t.target&&n.$el.removeClass("ui-dragover")}).on("drop",function(t){n._handleDrop(t)}),this.history={},this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:current",this._changeCurrent,this),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:type change:optional change:multiple change:extensions",this._changeType,this),this.render(),this.on("change",function(){e.onchange&&e.onchange(n.value())})},render:function(){this._changeType(),this._changeValue(),this._changeWait()},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},update:function(t){this.model.set("data",t)},value:function(t){void 0!==t&&this.model.set("value",t);var e=this.model.get("current");if(this.config[e]){var n=this.fields[e].value();if(null!==n&&(n=i.isArray(n)?n:[n],n.length>0)){var r=this._batch({values:[]});for(var a in n){var o=this.history[n[a]+"_"+this.config[e].src];if(!o)return Galaxy.emit.debug("ui-select-content::value()","Requested details not found for '"+n[a]+"'."),null;r.values.push(o)}return r.values.sort(function(t,e){return t.hid-e.hid}),r}}else Galaxy.emit.debug("ui-select-content::value()","Invalid value/source '"+t+"'.");return null},_changeCurrent:function(){var t=this;r.each(this.fields,function(e,n){t.model.get("current")==n?(e.$el.show(),r.each(t.$batch,function(e,i){e[t.config[n].batch==i?"show":"hide"]()}),t.button_type.value(n)):e.$el.hide()})},_changeType:function(){var t=this,e=(this.model.get("flavor")?this.model.get("flavor")+"_":"")+String(this.model.get("type"))+(this.model.get("multiple")?"_multiple":"");f[e]?this.config=f[e]:(this.config=f.data,Galaxy.emit.debug("ui-select-content::_changeType()","Invalid configuration/type id '"+e+"'."));var n=t.model.get("data"),i=s.default.textify(this.model.get("extensions")),a=this.model.get("src_labels");this.fields=[],this.button_data=[],r.each(this.config,function(e,r){t.button_data.push({value:r,icon:e.icon,tooltip:e.tooltip}),t.fields.push(new h.default.View({optional:t.model.get("optional"),multiple:e.multiple,searchable:!e.multiple||n&&n[e.src]&&n[e.src].length>t.model.get("pagelimit"),individual:!0,error_text:"No "+(i?i+" ":"")+(a[e.src]||"content")+" available.",onchange:function(){t.trigger("change")}}))}),this.button_type=new u.default.RadioButton.View({value:this.model.get("current"),data:this.button_data,onchange:function(e){t.model.set("current",e),t.trigger("change")}}),this.$el.empty();var o=0;this.fields.length>1&&(this.$el.append(this.button_type.$el),o=Math.max(0,36*this.fields.length)+"px"),r.each(this.fields,function(e){t.$el.append(e.$el.css({"margin-left":o}))}),r.each(this.$batch,function(e,n){t.$el.append(e.css({"margin-left":o}))}),this.model.set("current",0),this._changeCurrent(),this._changeData()},_changeWait:function(){var t=this;r.each(this.fields,function(e){e[t.model.get("wait")?"wait":"unwait"]()})},_changeData:function(){var t=this.model.get("data"),e=this,n={};r.each(t,function(t,i){n[i]=[],r.each(t,function(t){n[i].push({hid:t.hid,keep:t.keep,label:t.hid+": "+t.name,value:t.id,tags:t.tags}),e.history[t.id+"_"+i]=t})}),r.each(this.config,function(t,i){n[t.src]&&e.fields[i].add(n[t.src],function(t,e){return e.hid-t.hid})})},_changeValue:function(){var t=this.model.get("value");if(t&&t.values&&t.values.length>0){var e=[];r.each(t.values,function(t){e.push(t.id)});for(var n=t.values[0].src,i=t.values.length>1,a=0;a<this.config.length;a++){var o=this.fields[a],s=this.config[a];if(s.src==n&&-1!==[i,!0].indexOf(s.multiple)){this.model.set("current",a),o.value(e);break}}}else r.each(this.fields,function(t){t.value(null)})},_handleDrop:function(t){try{var e=this.model.get("data"),n=this.model.get("current"),i=this.config[n],a=this.fields[n],o=JSON.parse(t.originalEvent.dataTransfer.getData("text"))[0],s=o.id,l="dataset"==o.history_content_type?"hda":"hdca",u={id:s,src:l};if(e&&r.findWhere(e[l],u)){if(i.src==l){var c=a.value();c&&i.multiple?-1==c.indexOf(s)&&c.push(s):c=s,a.value(c)}else this.model.set("value",{values:[u]}),this.model.trigger("change:value");this.trigger("change"),this._handleDropStatus("success")}else this._handleDropStatus("danger")}catch(t){this._handleDropStatus("danger")}t.preventDefault()},_handleDropStatus:function(t){var e=this;this.$el.removeClass("ui-dragover").addClass("ui-dragover-"+t),setTimeout(function(){e.$el.removeClass("ui-dragover-"+t)},this.model.get("statustimer"))},_batch:function(t){t.batch=!1;var e=this.model.get("current"),n=this.config[e];if("hdca"==n.src&&!n.multiple){var i=this.history[this.fields[e].value()+"_hdca"];i&&i.map_over_type&&(t.batch=!0)}return n.batch!=d.LINKED&&n.batch!=d.ENABLED||(t.batch=!0,n.batch==d.ENABLED&&"true"===this.button_product.value()&&(t.product=!0)),t}});e.default={View:p}}).call(e,n(1),n(0),n(2))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=(i(r),n(4)),o=i(a),s=n(43),l=(i(s),n(24)),u=i(l),c=t.Collection.extend({url:Galaxy.root+"api/libraries?deleted=false"}),h=t.Collection.extend({initialize:function(){var e=this;this.config=new t.Model({library_id:null}),this.config.on("change",function(){e.fetch({reset:!0})})},url:function(){return Galaxy.root+"api/libraries/"+this.config.get("library_id")+"/contents"}}),d=t.View.extend({initialize:function(t){var e=this;this.libraries=new c,this.datasets=new h,this.options=t,this.library_select=new o.default.Select.View({onchange:function(t){e.datasets.config.set("library_id",t)}}),this.dataset_list=new u.default.View({name:"dataset",optional:t.optional,multiple:t.multiple,onchange:function(){e.trigger("change")}}),this.libraries.on("reset",function(){var t=[];e.libraries.each(function(e){t.push({value:e.id,label:e.get("name")})}),e.library_select.update(t)}),this.datasets.on("reset",function(){var t=[];null!==e.library_select.text()&&e.datasets.each(function(e){"file"===e.get("type")&&t.push({value:e.id,label:e.get("name")})}),e.dataset_list.update(t)}),this.on("change",function(){t.onchange&&t.onchange(e.value())}),this.setElement(this._template()),this.$(".library-select").append(this.library_select.$el),this.$el.append(this.dataset_list.$el),this.libraries.fetch({reset:!0,success:function(){e.library_select.trigger("change"),void 0!==e.options.value&&e.value(e.options.value)}})},value:function(t){return this.dataset_list.value(t)},_template:function(){return'<div class="ui-select-library"><div class="library ui-margin-bottom"><span class="library-title">Select Library</span><span class="library-select"/></div></div>'}});e.default={View:d}}).call(e,n(1))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=i(r),o=n(24),s=i(o),l=t.View.extend({initialize:function(t){var e=this;this.ftpfile_list=new s.default.View({name:"file",optional:t.optional,multiple:t.multiple,onchange:function(){t.onchange&&t.onchange(e.value())}}),this.setElement(this.ftpfile_list.$el),a.default.get({url:Galaxy.root+"api/remote_files",success:function(t){var n=[];for(var i in t)n.push({value:t[i].path,label:t[i].path});e.ftpfile_list.update(n)}})},value:function(t){return this.ftpfile_list.value(t)}});e.default={View:l}}).call(e,n(1))},function(t,e,n){"use strict";(function(t){function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=(i(r),n(4)),o=i(a),s=n(56),l=i(s),u=t.View.extend({initialize:function(t){var e=this;this.browse_button=new o.default.ButtonIcon({title:"Browse",icon:"fa fa-sign-in",tooltip:"Browse GenomeSpace",onclick:function(){e.browseGenomeSpace()}}),this.filename_textbox=new o.default.Input,this.token_textbox=new o.default.Input({type:"password"}),this.setElement(this._template(t)),this.$(".ui-gs-browse-button").append(this.browse_button.$el),this.$(".ui-gs-filename-textbox").append(this.filename_textbox.$el),this.$(".ui-gs-token-textbox").append(this.token_textbox.$el)},browseGenomeSpace:function(t){var e=this;l.default.openFileBrowser({successCallback:function(t){e.value(t.destination+"^"+t.token)}})},_template:function(t){return'<div class="ui-gs-select-file"><div class="ui-gs-browse-field"><span class="ui-gs-browse-button" /><span class="ui-gs-filename-textbox" /></div><div class="ui-gs-token-field"><span class=ui-gs-label"><div class="ui-gs-token-label">Token</div></span><span class="ui-gs-token-textbox" /></div></div>'},value:function(t){if(void 0===t)return this._getValue();this._setValue(t)},_getValue:function(){return this.filename_textbox.value()+"^"+this.token_textbox.value()},_setValue:function(t){t&&(values=t.split("^"),this.filename_textbox.value(values[0]),this.token_textbox.value(values[1]))}});e.default={View:u}}).call(e,n(1))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={openFileBrowser:function(t){var e=window.Galaxy.config.genomespace_ui_url,n=e+"upload/loadUrlToGenomespace.html?getLocation=true",i=window.open(n,"GenomeSpace File Browser","height=360px,width=600px");successCalBack=t.successCallback,window.addEventListener("message",function(t){successCalBack(t.data)},!1),i.focus(),null!=t.errorCallback&&(i.setCallbackOnGSUploadError=config.errorCallback)}}},function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=t.View.extend({colors:{standard:["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"],base:["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],theme:[["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada"],["d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5"],["bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f"],["a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09"],["7f7f7e","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"]]},initialize:function(t){this.options=a.default.merge(t,{}),this.setElement(this._template()),this.$panel=this.$(".ui-color-picker-panel"),this.$view=this.$(".ui-color-picker-view"),this.$value=this.$(".ui-color-picker-value"),this.$header=this.$(".ui-color-picker-header"),this._build(),this.visible=!1,this.value(this.options.value),this.$boxes=this.$(".ui-color-picker-box");var e=this;this.$boxes.on("click",function(){e.value(i(this).css("background-color")),e.$header.trigger("click")}),this.$header.on("click",function(){e.visible=!e.visible,e.visible?e.$view.fadeIn("fast"):e.$view.fadeOut("fast")})},value:function(t){return void 0!==t&&null!==t&&(this.$value.css("background-color",t),this.$(".ui-color-picker-box").empty(),this.$(this._getValue()).html(this._templateCheck()),this.options.onchange&&this.options.onchange(t)),this._getValue()},_getValue:function(){var t=this.$value.css("background-color");if(t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/)){var e=function(t){return("0"+parseInt(t).toString(16)).slice(-2)};return"#"+e(t[1])+e(t[2])+e(t[3])}return null},_build:function(){this._content({colors:this.colors.base});for(var t in this.colors.theme){var e={};0==t?e.bottom=!0:t!=this.colors.theme.length-1?(e.top=!0,e.bottom=!0):e.top=!0,e.colors=this.colors.theme[t],this._content(e)}this._content({colors:this.colors.standard})},_content:function(t){var e=t.colors,n=i(this._templateContent()),r=n.find(".line");this.$panel.append(n);for(var a in e){var o=i(this._templateBox(e[a]));t.top&&(o.css("border-top","none"),o.css("border-top-left-radius","0px"),o.css("border-top-right-radius","0px")),t.bottom&&(o.css("border-bottom","none"),o.css("border-bottom-left-radius","0px"),o.css("border-bottom-right-radius","0px")),r.append(o)}return n},_templateCheck:function(){return'<div class="ui-color-picker-check fa fa-check"/>'},_templateContent:function(){return'<div class="ui-color-picker-content"><div class="line"/></div>'},_templateBox:function(t){return'<div id="'+t+'" class="ui-color-picker-box" style="background-color: #'+t+';"/>'},_template:function(){return'<div class="ui-color-picker"><div class="ui-color-picker-header"><div class="ui-color-picker-value"/><div class="ui-color-picker-label">Select a color</div></div><div class="ui-color-picker-view ui-input"><div class="ui-color-picker-panel"/></div>'}})}).call(e,n(1),n(0))},,,function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(3),o=(r(a),n(61)),s=r(o),l=n(4),u=r(l),c=n(20),h=r(c),d=n(62),f=r(d),p=n(142),_=r(p);e.default=h.default.extend({initialize:function(t){var e=this;this.deferred=new s.default,h.default.prototype.initialize.call(this,t),this._update(this.model.get("initialmodel")),this.model.get("listen_to_history")&&parent.Galaxy&&parent.Galaxy.currHistoryPanel&&this.listenTo(parent.Galaxy.currHistoryPanel.collection,"change",function(){e.model.get("onchange")()}),this.$el.on("remove",function(){e._destroy()})},_update:function(t){var e=this;t=t||this.model.get("buildmodel"),t?(this.deferred.reset(),this.deferred.execute(function(n){t(n,e),n.then(function(){e._render()})})):this._render()},_destroy:function(){var t=this;this.$el.off().hide(),this.deferred.execute(function(){h.default.prototype.remove.call(t),Galaxy.emit.debug("tool-form-base::_destroy()","Destroy view.")})},_render:function(){var e=this,n=this.model.attributes;this.model.set({title:n.fixed_title||"<b>"+n.name+"</b> "+n.description+" (Galaxy Version "+n.version+")",operations:!n.hide_operations&&this._operations(),onchange:function(){e.deferred.reset(),e.deferred.execute(function(t){e.model.get("postchange")(t,e)})}}),this.render(),this.model.get("collapsible")||this.$el.append(t("<div/>").addClass("ui-margin-top-large").append(this._footer())),this.show_message&&this.message.update({status:"success",message:"Now you are using '"+n.name+"' version "+n.version+", id '"+n.id+"'.",persistent:!1}),this.show_message=!0},_operations:function(){var e=this,n=this.model.attributes,r=new u.default.ButtonMenu({icon:"fa-cubes",title:!n.narrow&&"Versions"||null,tooltip:"Select another tool version"});if(!n.sustain_version&&n.versions&&n.versions.length>1)for(var a in n.versions){var o=n.versions[a];o!=n.version&&r.addMenu({title:"Switch to "+o,version:o,icon:"fa-cube",onclick:function(){e.model.set("id",n.id.replace(n.version,this.version)),e.model.set("version",this.version),e._update()}})}else r.$el.hide();var s=new u.default.ButtonMenu({id:"options",icon:"fa-caret-down",title:!n.narrow&&"Options"||null,tooltip:"View available options"});return n.biostar_url&&(s.addMenu({icon:"fa-question-circle",title:"Question?",onclick:function(){window.open(n.biostar_url+"/p/new/post/")}}),s.addMenu({icon:"fa-search",title:"Search",onclick:function(){window.open(n.biostar_url+"/local/search/page/?q="+n.name)}})),s.addMenu({icon:"fa-share",title:"Share",onclick:function(){prompt("Copy to clipboard: Ctrl+C, Enter",window.location.origin+Galaxy.root+"root?tool_id="+n.id)}}),Galaxy.user&&Galaxy.user.get("is_admin")&&s.addMenu({icon:"fa-download",title:"Download",onclick:function(){window.location.href=Galaxy.root+"api/tools/"+n.id+"/download"}}),n.requirements&&n.requirements.length>0&&s.addMenu({icon:"fa-info-circle",title:"Requirements",onclick:function(){!this.requirements_visible||e.portlet.collapsed?(this.requirements_visible=!0,e.portlet.expand(),e.message.update({persistent:!0,message:e._templateRequirements(n),status:"info"})):(this.requirements_visible=!1,e.message.update({message:""}))}}),n.sharable_url&&s.addMenu({icon:"fa-external-link",title:"See in Tool Shed",onclick:function(){window.open(n.sharable_url)}}),t.getJSON("/api/webhooks/tool-menu/all",function(t){i.each(t,function(t){t.activate&&t.config.function&&s.addMenu({icon:t.config.icon,title:t.config.title,onclick:function(){new Function("options",t.config.function)(n)}})})}),{menu:s,versions:r}},_footer:function(){var e=this.model.attributes,n=t("<div/>").append(this._templateHelp(e));if(e.citations){var i=_.default.extend(f.default),r=document.createElement("div");n.append(r),new i({propsData:{id:e.id,source:"tools"}}).$mount(r)}return n},_templateHelp:function(e){var n=t("<div/>").addClass("ui-form-help").append(e.help);return n.find("a").attr("target","_blank"),n},_templateRequirements:function(e){var n=e.requirements.length;if(n>0){var r="This tool requires ";i.each(e.requirements,function(t,e){r+=t.name+(t.version?" (Version "+t.version+")":"")+(e<n-2?", ":e==n-2?" and ":"")});var a=t("<a/>").attr("target","_blank").attr("href","https://galaxyproject.org/tools/requirements/").text("here");return t("<span/>").append(r+". Click ").append(a).append(" for more information.")}return"No requirements found."}})}).call(e,n(0),n(2))},function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default=t.Model.extend({initialize:function(){this.active={},this.last=null},execute:function(t){var e=this,n=a.default.uid(),r=t.length>0;this.active[n]=!0;var o=i.Deferred();o.promise().always(function(){delete e.active[n],r&&Galaxy.emit.debug("deferred::execute()",this.state().charAt(0).toUpperCase()+this.state().slice(1)+" "+n)}),i.when(this.last).always(function(){e.active[n]?(r&&Galaxy.emit.debug("deferred::execute()","Running "+n),t(o),!r&&o.resolve()):o.reject()}),this.last=o.promise()},reset:function(){Galaxy.emit.debug("deferred::execute()","Reset");for(var t in this.active)this.active[t]=!1},ready:function(){return i.isEmptyObject(this.active)}})}).call(e,n(1),n(0))},function(t,e,n){"use strict";function i(t){n(69)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(72),a=n.n(r),o=n(138),s=n(65),l=i,u=s(a.a,o.a,!1,l,null,null);e.default=u.exports},function(t,e){function n(t,e){var n=t[1]||"",r=t[3];if(!r)return n;if(e&&"function"==typeof btoa){var a=i(r);return[n].concat(r.sources.map(function(t){return"/*# sourceURL="+r.sourceRoot+t+" */"})).concat([a]).join("\n")}return[n].join("\n")}function i(t){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t))))+" */"}t.exports=function(t){var e=[];return e.toString=function(){return this.map(function(e){var i=n(e,t);return e[2]?"@media "+e[2]+"{"+i+"}":i}).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var a=this[r][0];"number"==typeof a&&(i[a]=!0)}for(r=0;r<t.length;r++){var o=t[r];"number"==typeof o[0]&&i[o[0]]||(n&&!o[2]?o[2]=n:n&&(o[2]="("+o[2]+") and ("+n+")"),e.push(o))}},e}},function(t,e,n){function i(t){for(var e=0;e<t.length;e++){var n=t[e],i=c[n.id];if(i){i.refs++;for(var r=0;r<i.parts.length;r++)i.parts[r](n.parts[r]);for(;r<n.parts.length;r++)i.parts.push(a(n.parts[r]));i.parts.length>n.parts.length&&(i.parts.length=n.parts.length)}else{for(var o=[],r=0;r<n.parts.length;r++)o.push(a(n.parts[r]));c[n.id]={id:n.id,refs:1,parts:o}}}}function r(){var t=document.createElement("style");return t.type="text/css",h.appendChild(t),t}function a(t){var e,n,i=document.querySelector('style[data-vue-ssr-id~="'+t.id+'"]');if(i){if(p)return _;i.parentNode.removeChild(i)}if(g){var a=f++;i=d||(d=r()),e=o.bind(null,i,a,!1),n=o.bind(null,i,a,!0)}else i=r(),e=s.bind(null,i),n=function(){i.parentNode.removeChild(i)};return e(t),function(i){if(i){if(i.css===t.css&&i.media===t.media&&i.sourceMap===t.sourceMap)return;e(t=i)}else n()}}function o(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=v(e,r);else{var a=document.createTextNode(r),o=t.childNodes;o[e]&&t.removeChild(o[e]),o.length?t.insertBefore(a,o[e]):t.appendChild(a)}}function s(t,e){var n=e.css,i=e.media,r=e.sourceMap;if(i&&t.setAttribute("media",i),r&&(n+="\n/*# sourceURL="+r.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */"),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}var l="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!l)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var u=n(71),c={},h=l&&(document.head||document.getElementsByTagName("head")[0]),d=null,f=0,p=!1,_=function(){},g="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());t.exports=function(t,e,n){p=n;var r=u(t,e);return i(r),function(e){for(var n=[],a=0;a<r.length;a++){var o=r[a],s=c[o.id];s.refs--,n.push(s)}e?(r=u(t,e),i(r)):r=[];for(var a=0;a<n.length;a++){var s=n[a];if(0===s.refs){for(var l=0;l<s.parts.length;l++)s.parts[l]();delete c[s.id]}}}};var v=function(){var t=[];return function(e,n){return t[e]=n,t.filter(Boolean).join("\n")}}()},function(t,e){t.exports=function(t,e,n,i,r,a){var o,s=t=t||{},l=typeof t.default;"object"!==l&&"function"!==l||(o=t,s=t.default);var u="function"==typeof s?s.options:s;e&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0),n&&(u.functional=!0),r&&(u._scopeId=r);var c;if(a?(c=function(t){t=t||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,t||"undefined"==typeof __VUE_SSR_CONTEXT__||(t=__VUE_SSR_CONTEXT__),i&&i.call(this,t),t&&t._registeredComponents&&t._registeredComponents.add(a)},u._ssrRegister=c):i&&(c=i),c){var h=u.functional,d=h?u.render:u.beforeCreate;h?(u._injectStyles=c,u.render=function(t,e){return c.call(e),d(t,e)}):u.beforeCreate=d?[].concat(d,c):[c]}return{esModule:o,exports:s,options:u}}},function(t,e,n){t.exports=n(73)},function(t,e,n){"use strict";(function(t,n,i,r){Object.defineProperty(e,"__esModule",{value:!0});var a=t.View.extend({initialize:function(t,e){this.$button=t,this.$button.length||(this.$button=n("<div/>")),this.options=e||[],this.$button.data("popupmenu",this);var i=this;this.$button.click(function(t){return n(".popmenu-wrapper").remove(),i._renderAndShow(t),!1})},_renderAndShow:function(t){this.render(),this.$el.appendTo("body").css(this._getShownPosition(t)).show(),this._setUpCloseBehavior()},render:function(){if(this.$el.addClass("popmenu-wrapper").hide().css({position:"absolute"}).html(this.template(this.$button.attr("id"),this.options)),this.options.length){var t=this;this.$el.find("li").each(function(e,i){var r=t.options[e];r.func&&n(this).children("a.popupmenu-option").click(function(e){r.func.call(t,e,r),e.preventDefault()})})}return this},template:function(t,e){return['<ul id="',t,'-menu" class="dropdown-menu">',this._templateOptions(e),"</ul>"].join("")},_templateOptions:function(t){return t.length?i.map(t,function(t){return t.divider?'<li class="divider"></li>':t.header?['<li class="head"><a href="javascript:void(0);">',t.html,"</a></li>"].join(""):['<li><a class="popupmenu-option" href="',t.href||"javascript:void(0);",'"',t.target?' target="'+t.target+'"':"",">",t.checked?'<span class="fa fa-check"></span>':"",t.html,"</a></li>"].join("")}).join(""):"<li>(no options)</li>"},_getShownPosition:function(t){var e=this.$el.width(),i=t.pageX-e/2;return i=Math.min(i,n(document).scrollLeft()+n(window).width()-e-5),i=Math.max(i,n(document).scrollLeft()+5),{top:t.pageY,left:i}},_setUpCloseBehavior:function(){function t(t){if(n(document).off("click.close_popup"),window&&window.parent!==window)try{n(window.parent.document).off("click.close_popup")}catch(t){}else try{n("iframe#galaxy_main").contents().off("click.close_popup")}catch(t){}e.remove()}var e=this;if(n("html").one("click.close_popup",t),window&&window.parent!==window)try{n(window.parent.document).find("html").one("click.close_popup",t)}catch(t){}else try{n("iframe#galaxy_main").contents().one("click.close_popup",t)}catch(t){}},addItem:function(t,e){return e=e>=0?e:this.options.length,this.options.splice(e,0,t),this},removeItem:function(t){return t>=0&&this.options.splice(t,1),this},findIndexByHtml:function(t){for(var e=0;e<this.options.length;e++)if(i.has(this.options[e],"html")&&this.options[e].html===t)return e;return null},findItemByHtml:function(t){return this.options[this.findIndexByHtml(t)]},toString:function(){return"PopupMenu"}});a.create=function(t,e){return new a(t,e)},a.make_popupmenu=function(t,e){var o=[];return i.each(e,function(t,e){var n={html:e};null===t?n.header=!0:"function"===r.type(t)&&(n.func=t),o.push(n)}),new a(n(t),o)},a.convertLinksToOptions=function(t,e){t=n(t),e=e||"a";var i=[];return t.find(e).each(function(t,e){var r={},a=n(t);if(r.html=a.text(),a.attr("href")){var o=a.attr("href"),s=a.attr("target"),l=a.attr("confirm");r.func=function(){if(!l||confirm(l))switch(s){case"_parent":window.parent.location=o;break;case"_top":window.top.location=o;break;default:window.location=o}}}i.push(r)}),i},a.fromExistingDom=function(t,e,i){t=n(t),e=n(e);var r=a.convertLinksToOptions(e,i);return e.remove(),new a(t,r)},a.make_popup_menus=function(t,e,i){t=t||document,e=e||"div[popupmenu]",i=i||function(t,e){return"#"+t.attr("popupmenu")};var r=[];return n(t).find(e).each(function(){var e=n(this),o=n(t).find(i(e,t));r.push(a.fromDom(o,e)),o.addClass("popup")}),r},e.default=a}).call(e,n(1),n(0),n(2),n(0))},function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=(function(t){t&&t.__esModule}(r),t.View.extend({initialize:function(e){this.collection=new t.Collection,this.model=e&&e.model||new t.Model({onchange:null,visible:!0}).set(e),this.setElement(i(this._template())),this.$nav=this.$(".tab-navigation"),this.$content=this.$(".tab-content"),this.$el.on("click",function(){i(".tooltip").hide()}),this.render(),this.listenTo(this.model,"change",this.render,this),this.listenTo(this.collection,"add",this._add,this),this.listenTo(this.collection,"remove",this._remove,this),this.listenTo(this.collection,"change",this._change,this),this.listenTo(this.collection,"reset",this._reset,this),this.listenTo(this.collection,"add remove reset",this.render,this)},render:function(){var t=this.model.get("current");t=this.$("#"+t).length>0?t:this.first(),t&&(this.$nav.children().removeClass("active"),this.$content.children().removeClass("active"),this.$("#tab-"+t).addClass("active"),this.$("#"+t).addClass("active")),this.$el[this.model.get("visible")?"fadeIn":"fadeOut"]("fast"),this.$nav[this.size()>1?"show":"hide"]()},current:function(){return this.model.get("current")},show:function(t){t&&(this.model.set({current:t,visible:!0}),this.model.get("onchange")&&this.model.get("onchange")(t))},hide:function(){this.model.set("visible",!1)},first:function(){var t=this.collection.first();return t&&t.id},size:function(){return this.collection.length},add:function(t){this.collection.add(t)},del:function(t){this.collection.remove(t)},delAll:function(){this.collection.reset()},showTab:function(t){this.collection.get(t).set("hidden",!1)},hideTab:function(t){this.collection.get(t).set("hidden",!0)},_add:function(t){var e=this,n=t.attributes;this.$content.append(i("<div/>").attr("id",n.id).addClass("tab-pane").append(n.$el)),this.$nav.append(i(this._template_tab(n)).show().tooltip({title:n.tooltip,placement:"bottom",container:e.$el}).on("click",function(t){t.preventDefault(),e.show(n.id)})),1==this.size()&&this.show(n.id)},_remove:function(t){this.$("#tab-"+t.id).remove(),this.$("#"+t.id).remove()},_reset:function(){this.$nav.empty(),this.$content.empty()},_change:function(t){this.$("#tab-"+t.id)[t.get("hidden")?"hide":"show"]()},_template:function(){return i("<div/>").addClass("ui-tabs tabbable tabs-left").append(i("<ul/>").addClass("tab-navigation nav nav-tabs")).append(i("<div/>").addClass("tab-content"))},_template_tab:function(t){var e=i("<li/>").addClass("tab-element").attr("id","tab-"+t.id).append(i("<a/>").attr("id","tab-title-link-"+t.id)),n=e.find("a");return t.icon&&n.append(i("<i/>").addClass("tab-icon fa").addClass(t.icon)),n.append(i("<span/>").attr("id","tab-title-text-"+t.id).addClass("tab-title-text").append(t.title)),e}}));e.default={View:a}}).call(e,n(1),n(0))},function(t,e,n){var i=n(70);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);n(64)("52175cf9",i,!0)},function(t,e,n){e=t.exports=n(63)(void 0),e.push([t.i,".citations-formatted{word-wrap:break-word}.citations-bibtex-text{width:100%;height:500px}.citation-padding{padding:5px 10px}",""])},function(t,e){t.exports=function(t,e){for(var n=[],i={},r=0;r<e.length;r++){var a=e[r],o=a[0],s=a[1],l=a[2],u=a[3],c={id:t+":"+r,css:s,media:l,sourceMap:u};i[o]?i[o].parts.push(c):n.push(i[o]={id:o,parts:[c]})}return n}},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(66),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=n(92),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(93),l=n(17);e.default={props:{source:{type:String,required:!0},id:{type:String,required:!0},viewRender:{type:Boolean,requried:!1,default:!0}},data:function(){return{citations:[],content:"",errors:[]}},computed:{formattedReferences:function(){var t=this;return this.citations.reduce(function(e,n){return e.concat('<p class="formatted-reference">'+t.formattedReference(n)+"</p>")},"")}},created:function(){var e=this;r.default.get(Galaxy.root+"api/"+this.source+"/"+this.id+"/citations").then(function(n){e.content="";var i=!0,r=!1,a=void 0;try{for(var s,l=n.data[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var u=s.value;try{var c={fields:{},entryType:void 0},h=o.toJSON(u.content);if(h){h=t.first(h),c.entryType=h.entryType||void 0;for(var d in h.entryTags)c.fields[d.toLowerCase()]=h.entryTags[d]}e.citations.push(c),e.content+=u.content}catch(t){console.warn("Error parsing bibtex: "+t)}}}catch(t){r=!0,a=t}finally{try{!i&&l.return&&l.return()}finally{if(r)throw a}}}).catch(function(t){console.error(t)})},methods:{formattedReference:function(t){var e=t.entryType,n=t.fields,i="",r=this._asSentence((n.author?n.author:"")+(n.year?" ("+n.year+")":""))+" ",a=n.title||"",o=n.pages?"pp. "+n.pages:"",u=n.address;if("article"==e){var c=(n.volume?n.volume:"")+(n.number?" ("+n.number+")":"")+(o?", "+o:"");i=r+this._asSentence(a)+(n.journal?"In <em>"+n.journal+", ":"")+this._asSentence(c)+this._asSentence(n.address)+"</em>"}else i="inproceedings"==e||"proceedings"==e?r+this._asSentence(a)+(n.booktitle?"In <em>"+n.booktitle+", ":"")+(o||"")+(u?", "+u:"")+".</em>":"mastersthesis"==e||"phdthesis"==e?r+this._asSentence(a)+(n.howpublished?n.howpublished+". ":"")+(n.note?n.note+".":""):"techreport"==e?r+this._asSentence(a)+this._asSentence(n.institution)+this._asSentence(n.number)+this._asSentence(n.type):"book"==e||"inbook"==e||"incollection"==e?r+" "+this._formatBookInfo(n):r+" "+this._asSentence(a)+this._asSentence(n.howpublished)+this._asSentence(n.note);var h="";n.doi&&(h="http://dx.doi.org/"+n.doi,i+='[<a href="'+h+'" target="_blank">doi:'+n.doi+"</a>]");var d=n.url||h;return d&&(i+='[<a href="'+d+'" target="_blank">Link</a>]'),(0,s.convertLaTeX)({onError:function(t,e){return"{"+(0,l.stringifyLaTeX)(e)+"}"}},i)},_formatBookInfo:function(t){var e="";return t.chapter&&(e+=t.chapter+" in "),t.title&&(e+="<em>"+t.title+"</em>"),t.editor&&(e+=", Edited by "+t.editor+", "),t.publisher&&(e+=", "+t.publisher),t.pages&&(e+=", pp. "+t.pages),t.series&&(e+=", <em>"+t.series+"</em>"),t.volume&&(e+=", Vol."+t.volume),t.issn&&(e+=", ISBN: "+t.issn),e+"."},_asSentence:function(t){return t&&t.trim()?t+". ":""},toggleViewRender:function(){this.viewRender=!this.viewRender}}}}).call(e,n(2))},function(t,e,n){"use strict";function i(t){var e=new o(t),n=a(o.prototype.request,e);return r.extend(n,o.prototype,e),r.extend(n,e),n}var r=n(5),a=n(27),o=n(75),s=n(16),l=i(s);l.Axios=o,l.create=function(t){return i(r.merge(s,t))},l.Cancel=n(31),l.CancelToken=n(90),l.isCancel=n(30),l.all=function(t){return Promise.all(t)},l.spread=n(91),t.exports=l,t.exports.default=l},function(t,e){function n(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}function i(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&n(t.slice(0,0))}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
t.exports=function(t){return null!=t&&(n(t)||i(t)||!!t._isBuffer)}},function(t,e,n){"use strict";function i(t){this.defaults=t,this.interceptors={request:new o,response:new o}}var r=n(16),a=n(5),o=n(85),s=n(86);i.prototype.request=function(t){"string"==typeof t&&(t=a.merge({url:arguments[0]},arguments[1])),t=a.merge(r,this.defaults,{method:"get"},t),t.method=t.method.toLowerCase();var e=[s,void 0],n=Promise.resolve(t);for(this.interceptors.request.forEach(function(t){e.unshift(t.fulfilled,t.rejected)}),this.interceptors.response.forEach(function(t){e.push(t.fulfilled,t.rejected)});e.length;)n=n.then(e.shift(),e.shift());return n},a.forEach(["delete","get","head","options"],function(t){i.prototype[t]=function(e,n){return this.request(a.merge(n||{},{method:t,url:e}))}}),a.forEach(["post","put","patch"],function(t){i.prototype[t]=function(e,n,i){return this.request(a.merge(i||{},{method:t,url:e,data:n}))}}),t.exports=i},function(t,e){function n(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function r(t){if(c===setTimeout)return setTimeout(t,0);if((c===n||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function a(t){if(h===clearTimeout)return clearTimeout(t);if((h===i||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function o(){_&&f&&(_=!1,f.length?p=f.concat(p):g=-1,p.length&&s())}function s(){if(!_){var t=r(o);_=!0;for(var e=p.length;e;){for(f=p,p=[];++g<e;)f&&f[g].run();g=-1,e=p.length}f=null,_=!1,a(t)}}function l(t,e){this.fun=t,this.array=e}function u(){}var c,h,d=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:n}catch(t){c=n}try{h="function"==typeof clearTimeout?clearTimeout:i}catch(t){h=i}}();var f,p=[],_=!1,g=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];p.push(new l(t,e)),1!==p.length||_||r(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=u,d.addListener=u,d.once=u,d.off=u,d.removeListener=u,d.removeAllListeners=u,d.emit=u,d.prependListener=u,d.prependOnceListener=u,d.listeners=function(t){return[]},d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e,n){"use strict";var i=n(5);t.exports=function(t,e){i.forEach(t,function(n,i){i!==e&&i.toUpperCase()===e.toUpperCase()&&(t[e]=n,delete t[i])})}},function(t,e,n){"use strict";var i=n(29);t.exports=function(t,e,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?e(i("Request failed with status code "+n.status,n.config,null,n.request,n)):t(n)}},function(t,e,n){"use strict";t.exports=function(t,e,n,i,r){return t.config=e,n&&(t.code=n),t.request=i,t.response=r,t}},function(t,e,n){"use strict";function i(t){return encodeURIComponent(t).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var r=n(5);t.exports=function(t,e,n){if(!e)return t;var a;if(n)a=n(e);else if(r.isURLSearchParams(e))a=e.toString();else{var o=[];r.forEach(e,function(t,e){null!==t&&void 0!==t&&(r.isArray(t)&&(e+="[]"),r.isArray(t)||(t=[t]),r.forEach(t,function(t){r.isDate(t)?t=t.toISOString():r.isObject(t)&&(t=JSON.stringify(t)),o.push(i(e)+"="+i(t))}))}),a=o.join("&")}return a&&(t+=(-1===t.indexOf("?")?"?":"&")+a),t}},function(t,e,n){"use strict";var i=n(5),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];t.exports=function(t){var e,n,a,o={};return t?(i.forEach(t.split("\n"),function(t){if(a=t.indexOf(":"),e=i.trim(t.substr(0,a)).toLowerCase(),n=i.trim(t.substr(a+1)),e){if(o[e]&&r.indexOf(e)>=0)return;o[e]="set-cookie"===e?(o[e]?o[e]:[]).concat([n]):o[e]?o[e]+", "+n:n}}),o):o}},function(t,e,n){"use strict";var i=n(5);t.exports=i.isStandardBrowserEnv()?function(){function t(t){var e=t;return n&&(r.setAttribute("href",e),e=r.href),r.setAttribute("href",e),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}var e,n=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");return e=t(window.location.href),function(n){var r=i.isString(n)?t(n):n;return r.protocol===e.protocol&&r.host===e.host}}():function(){return function(){return!0}}()},function(t,e,n){"use strict";function i(){this.message="String contains an invalid character"}function r(t){for(var e,n,r=String(t),o="",s=0,l=a;r.charAt(0|s)||(l="=",s%1);o+=l.charAt(63&e>>8-s%1*8)){if((n=r.charCodeAt(s+=.75))>255)throw new i;e=e<<8|n}return o}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";i.prototype=new Error,i.prototype.code=5,i.prototype.name="InvalidCharacterError",t.exports=r},function(t,e,n){"use strict";var i=n(5);t.exports=i.isStandardBrowserEnv()?function(){return{write:function(t,e,n,r,a,o){var s=[];s.push(t+"="+encodeURIComponent(e)),i.isNumber(n)&&s.push("expires="+new Date(n).toGMTString()),i.isString(r)&&s.push("path="+r),i.isString(a)&&s.push("domain="+a),!0===o&&s.push("secure"),document.cookie=s.join("; ")},read:function(t){var e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove:function(t){this.write(t,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},function(t,e,n){"use strict";function i(){this.handlers=[]}var r=n(5);i.prototype.use=function(t,e){return this.handlers.push({fulfilled:t,rejected:e}),this.handlers.length-1},i.prototype.eject=function(t){this.handlers[t]&&(this.handlers[t]=null)},i.prototype.forEach=function(t){r.forEach(this.handlers,function(e){null!==e&&t(e)})},t.exports=i},function(t,e,n){"use strict";function i(t){t.cancelToken&&t.cancelToken.throwIfRequested()}var r=n(5),a=n(87),o=n(30),s=n(16),l=n(88),u=n(89);t.exports=function(t){return i(t),t.baseURL&&!l(t.url)&&(t.url=u(t.baseURL,t.url)),t.headers=t.headers||{},t.data=a(t.data,t.headers,t.transformRequest),t.headers=r.merge(t.headers.common||{},t.headers[t.method]||{},t.headers||{}),r.forEach(["delete","get","head","post","put","patch","common"],function(e){delete t.headers[e]}),(t.adapter||s.adapter)(t).then(function(e){return i(t),e.data=a(e.data,e.headers,t.transformResponse),e},function(e){return o(e)||(i(t),e&&e.response&&(e.response.data=a(e.response.data,e.response.headers,t.transformResponse))),Promise.reject(e)})}},function(t,e,n){"use strict";var i=n(5);t.exports=function(t,e,n){return i.forEach(n,function(n){t=n(t,e)}),t}},function(t,e,n){"use strict";t.exports=function(t){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(t)}},function(t,e,n){"use strict";t.exports=function(t,e){return e?t.replace(/\/+$/,"")+"/"+e.replace(/^\/+/,""):t}},function(t,e,n){"use strict";function i(t){if("function"!=typeof t)throw new TypeError("executor must be a function.");var e;this.promise=new Promise(function(t){e=t});var n=this;t(function(t){n.reason||(n.reason=new r(t),e(n.reason))})}var r=n(31);i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var t;return{token:new i(function(e){t=e}),cancel:t}},t.exports=i},function(t,e,n){"use strict";t.exports=function(t){return function(e){return t.apply(null,e)}}},function(t,e,n){!function(t){function e(){this.months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],this.notKey=[",","{","}"," ","="],this.pos=0,this.input="",this.entries=new Array,this.currentEntry="",this.setInput=function(t){this.input=t},this.getEntries=function(){return this.entries},this.isWhitespace=function(t){return" "==t||"\r"==t||"\t"==t||"\n"==t},this.match=function(t,e){if(void 0!=e&&null!=e||(e=!0),this.skipWhitespace(e),this.input.substring(this.pos,this.pos+t.length)!=t)throw"Token mismatch, expected "+t+", found "+this.input.substring(this.pos);this.pos+=t.length,this.skipWhitespace(e)},this.tryMatch=function(t,e){return void 0!=e&&null!=e||(e=!0),this.skipWhitespace(e),this.input.substring(this.pos,this.pos+t.length)==t},this.matchAt=function(){for(;this.input.length>this.pos&&"@"!=this.input[this.pos];)this.pos++;return"@"==this.input[this.pos]},this.skipWhitespace=function(t){for(;this.isWhitespace(this.input[this.pos]);)this.pos++;if("%"==this.input[this.pos]&&1==t){for(;"\n"!=this.input[this.pos];)this.pos++;this.skipWhitespace(t)}},this.value_braces=function(){var t=0;this.match("{",!1);for(var e=this.pos,n=!1;;){if(!n)if("}"==this.input[this.pos]){if(!(t>0)){var i=this.pos;return this.match("}",!1),this.input.substring(e,i)}t--}else if("{"==this.input[this.pos])t++;else if(this.pos>=this.input.length-1)throw"Unterminated value";n="\\"==this.input[this.pos]&&0==n,this.pos++}},this.value_comment=function(){for(var t="",e=0;!this.tryMatch("}",!1)||0!=e;){if(t+=this.input[this.pos],"{"==this.input[this.pos]&&e++,"}"==this.input[this.pos]&&e--,this.pos>=this.input.length-1)throw"Unterminated value:"+this.input.substring(start);this.pos++}return t},this.value_quotes=function(){this.match('"',!1);for(var t=this.pos,e=!1;;){if(!e){if('"'==this.input[this.pos]){var n=this.pos;return this.match('"',!1),this.input.substring(t,n)}if(this.pos>=this.input.length-1)throw"Unterminated value:"+this.input.substring(t)}e="\\"==this.input[this.pos]&&0==e,this.pos++}},this.single_value=function(){var t=this.pos;if(this.tryMatch("{"))return this.value_braces();if(this.tryMatch('"'))return this.value_quotes();var e=this.key();if(e.match("^[0-9]+$"))return e;if(this.months.indexOf(e.toLowerCase())>=0)return e.toLowerCase();throw"Value expected:"+this.input.substring(t)+" for key: "+e},this.value=function(){var t=[];for(t.push(this.single_value());this.tryMatch("#");)this.match("#"),t.push(this.single_value());return t.join("")},this.key=function(t){for(var e=this.pos;;){if(this.pos>=this.input.length)throw"Runaway key";if(this.notKey.indexOf(this.input[this.pos])>=0)return t&&","!=this.input[this.pos]?(this.pos=e,null):this.input.substring(e,this.pos);this.pos++}},this.key_equals_value=function(){var t=this.key();if(this.tryMatch("=")){this.match("=");var e=this.value();return t=t.trim(),[t,e]}throw"... = value expected, equals sign missing:"+this.input.substring(this.pos)},this.key_value_list=function(){var t=this.key_equals_value();for(this.currentEntry.entryTags={},this.currentEntry.entryTags[t[0]]=t[1];this.tryMatch(",")&&(this.match(","),!this.tryMatch("}"));)t=this.key_equals_value(),this.currentEntry.entryTags[t[0]]=t[1]},this.entry_body=function(t){this.currentEntry={},this.currentEntry.citationKey=this.key(!0),this.currentEntry.entryType=t.substring(1),null!=this.currentEntry.citationKey&&this.match(","),this.key_value_list(),this.entries.push(this.currentEntry)},this.directive=function(){return this.match("@"),"@"+this.key()},this.preamble=function(){this.currentEntry={},this.currentEntry.entryType="PREAMBLE",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.comment=function(){this.currentEntry={},this.currentEntry.entryType="COMMENT",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.entry=function(t){this.entry_body(t)},this.alernativeCitationKey=function(){this.entries.forEach(function(t){!t.citationKey&&t.entryTags&&(t.citationKey="",t.entryTags.author&&(t.citationKey+=t.entryTags.author.split(",")[0]+=", "),t.citationKey+=t.entryTags.year)})},this.bibtex=function(){for(;this.matchAt();){var t=this.directive();this.match("{"),"@STRING"==t.toUpperCase()?this.string():"@PREAMBLE"==t.toUpperCase()?this.preamble():"@COMMENT"==t.toUpperCase()?this.comment():this.entry(t),this.match("}")}this.alernativeCitationKey()}}t.toJSON=function(t){var n=new e;return n.setInput(t),n.bibtex(),n.entries},t.toBibtex=function(t){var e="";for(var n in t){if(e+="@"+t[n].entryType,e+="{",t[n].citationKey&&(e+=t[n].citationKey+", "),t[n].entry&&(e+=t[n].entry),t[n].entryTags){var i="";for(var r in t[n].entryTags)0!=i.length&&(i+=", "),i+=r+"= {"+t[n].entryTags[r]+"}";e+=i}e+="}\n\n"}return e}}(e)},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(94)),i(n(95)),i(n(32)),i(n(35)),i(n(10)),i(n(36)),i(n(136)),i(n(137)),i(n(39))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.aliases={mathfrak:"frak",mathcal:"cal",mathbb:"bb",mathbf:"bf",dfrac:"frac",ldots:"dots"}},function(t,e,n){"use strict";function i(t,e){return a(t,s.mustNotBeUndefined(s.mustBeOk(s.latexParser.parse(e)).value))}function r(t){return a({translateTo:"unicode",mode:"Any"},s.mustNotBeUndefined(s.mustBeOk(s.latexParser.parse(t)).value))}function a(t,e){var n=t.translateTo;switch(n){case"html":throw new Error("Unsupported format: '"+n+"'. Use one of: "+Object.keys(o.supportedMarkups));case"unicode":default:return l.convertLaTeXBlocksToUnicode(t,e).result}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(32),s=n(17),l=n(97);e.convertLaTeX=i,e.convertLaTeXToUnicode=r,e.convertLaTeXBlocks=a},function(t,e,n){"use strict";function i(t,e){var n=t.length,i=e.length;if(0===n)return e;if(0===i)return t;for(var r={},a=0;a<n;a++)r[t[a]]=!0;for(var o=0;o<i;o++)r[e[o]]=!0;var s=[];for(var l in r)r.hasOwnProperty(l)&&s.push(l);return s.sort(),s}function r(t,e){if(!e)return t;if(t.furthest>e.furthest)return t;var n=t.furthest===e.furthest?i(t.expected,e.expected):e.expected;return{status:t.status,index:t.index,value:t.value,furthest:e.furthest,expected:n}}function a(t,e,n,i){return k.Parser(function(a,o){for(var s=i,l=0,u=void 0;o<a.length;){var c=e._(a,o);if(c.status){o=S.mustBeNumber(c.index);break}var h=t._(a,o);if(w(h))return h;if(u=S.mustNotBeUndefined(r(h,u)),w(u))return u;l++;var d=S.mustNotBeUndefined(u.value);s=n(s,d),o=S.mustBeNumber(u.index)}return x(r(k.makeSuccess(o,s),u))})}function o(t,e){return a(t,e,function(t,e){return t.concat([e])},[])}function s(t){return k.Parser(function(e,n){var i=e.charAt(n);if(n>=e.length||t(i))return T.makeFailure(n,"text character");var r=[i];n++;for(var a=e.charAt(n);!t(a)&&n<e.length;)r.push(a),n++,a=e.charAt(n);return k.makeSuccess(n,r.join(""))})}function l(t){return s(c(t)).map(function(t){return M.newTeXRaw(t)})}function u(t,n){return(void 0===n?e.specialCharsDefault:n).hasOwnProperty(t)}function c(t){return function(e){return t.hasOwnProperty(e)}}function h(t,n,i){switch(void 0===n&&(n="_"),void 0===i&&(i="^"),t){case"Math":return e.latexBlockParserMathMode(n,i);default:return e.latexBlockParserTextMode}}function d(t){return t>="A"&&t<="Z"}function f(t){return t>="a"&&t<="z"}function p(t){return P.then(o(h(t,"_"),q)).map(C.newFixArg)}function _(t){return O.then(o(h(t),z)).map(C.newOptArg)}function g(t){return k.alt(p(t),_(t))}function v(t){return k.alt(k.string("{}").map(function(){return[]}),g(t).map(function(t){return t}).atLeast(0)).map(function(t){return t})}function m(t){return k.seqMap(e.commandSymbol,k.alt(e.specialChar,e.takeTill(e.endCmd)),v(t),function(t,e,n){return void 0!==n?C.newTeXComm.apply(void 0,[e].concat(n)):C.newTeXComm(e)}).map(function(t){return t})}function y(t,n,i){return k.seqMap(e.subOrSuperscriptSymbolParser(n,i),v(t),function(t,e){return C.newSubOrSuperScript(t,t===C.SubOrSuperSymbol.SUB?n:i,e)}).map(function(t){return t})}function b(t){return void 0!==t&&!0===t.status}function w(t){return void 0!==t&&!1===t.status}function x(t){if(!b(t))throw new Error("Expected parse to be success: "+JSON.stringify(t));return t}Object.defineProperty(e,"__esModule",{value:!0});var k=n(34),C=n(19),M=n(19),S=n(18),T=n(34);e.defaultParserConf={verbatimEnvironments:["verbatim"]},e.takeTill=function(t){return k.takeWhile(function(e){return!t(e)})};var $=k.regexp(/[^\n]*/),A=k.regexp(/\n?/),E=(k.regexp(/\s*/m),k.string("%")),O=k.string("["),z=k.string("]");e.notTextDefault={$:!0,"%":!0,"\\":!0,"{":!0,"]":!0,"}":!0},e.notTextMathMode={"^":!0,_:!0,$:!0,"%":!0,"\\":!0,"{":!0,"]":!0,"}":!0},e.notTextMathModeAndNotClosingBracket={"^":!0,_:!0,$:!0,"%":!0,"\\":!0,"{":!0,"}":!0},e.notTextDefaultAndNotClosingBracket={$:!0,"%":!0,"\\":!0,"{":!0,"}":!0},e.textParser=l;var R=(l(e.notTextDefault),l(e.notTextDefaultAndNotClosingBracket),k.regexp(/ */).map(M.newTeXRaw));e.comment=E.then($).skip(A).map(C.newTeXComment),e.specialCharsDefault={"'":!0,"(":!0,")":!0,",":!0,".":!0,"-":!0,'"':!0,"!":!0,"^":!0,$:!0,"&":!0,"#":!0,"{":!0,"}":!0,"%":!0,"~":!0,"|":!0,"/":!0,":":!0,";":!0,"=":!0,"[":!0,"]":!0,"\\":!0,"`":!0," ":!0},e.isSpecialCharacter=u,e.isNotText=c,e.mathSymbol=k.string("$"),e.commandSymbol=k.string("\\"),e.latexBlockParser=h,e.latexBlockParserTextMode=k.lazy(function(){return k.alt(k.alt(l(e.notTextDefault),e.dolMath,e.comment,l(e.notTextDefaultAndNotClosingBracket),e.environment,m("Paragraph")))}),e.latexBlockParserMathMode=function(t,n){return k.lazy(function(){return k.alt(k.alt(y("Math",t,n),l(e.notTextMathMode),e.dolMath,e.comment,l(e.notTextMathModeAndNotClosingBracket),e.environment,m("Math")))})},e.latexParser=e.latexBlockParserTextMode.many();var N=k.string("{").then(e.latexBlockParserTextMode.many()).skip(k.string("}"));e.env=k.Parser(function(t,n){var i=k.string("\\begin").then(k.string("{")).then(R).then(k.regexp(/[a-zA-Z]+/)).skip(R).skip(k.string("}"))._(t,n);if(w(i))return i;n=S.mustBeNumber(i.index);var r=i.value;return o(e.latexBlockParserTextMode,k.string("\\end").then(k.string("{")).then(R).then(k.string(r)).then(R).then(k.string("}"))).map(function(t){return C.newTeXEnv(r,t)})._(t,n)}),e.environment=k.alt(N,e.env),e.specialChar=k.test(u),e.endCmd=function(t){return!f(t)&&!d(t)};var P=k.string("{"),q=k.string("}");e.fixArg=p,e.optArg=_,e.cmdArg=g,e.cmdArgs=v,e.command=m,e.subOrSuperscriptSymbolParser=function(t,e){return k.alt(k.string(t),k.string(e)).map(function(e){return e===t?C.SubOrSuperSymbol.SUB:C.SubOrSuperSymbol.SUP})},e.shiftedScript=y,e.dolMath=function(t,e,n){return void 0===t&&(t="Dollar"),void 0===e&&(e="$"),void 0===n&&(n="$"),k.string(e).then(h("Math","_").many().map(function(i){return C.newTeXMath(t,e,n,i)})).skip(k.string(n))}(),e.isOk=b,e.isNotOk=w,e.mustBeOk=x},function(t,e,n){"use strict";function i(t){return"string"==typeof t}function r(t,e){var n=t;do{t++}while(d.isTeXChar(e[t]));return{result:e.slice(n,t).map(function(t){return t.string}).join(""),blockIndex:t}}function a(t,e,n,r){var a=h(t,r);if(i(a))return{result:a,blockIndex:e+1};for(var o=[],l=[];o.length<a.argumentCount&&e<n.length-1;){e++;var u=e;if(n.length<u-1)throw new Error("Could not gobble "+a.argumentCount+" arguments for "+r.name);var c=n[u];if(d.isTeXRaw(c)){for(var f=/\s+/g,p=c.text.replace(x,""),_=-1,g=0;o.length<a.argumentCount;){var v=f.exec(p);if(!v){o.push.apply(o,w.convertToTeXCharsDefault(p));break}var m=p.substring(g,v.index);_=v.index,g=v.index+m.length,o.push.apply(o,w.convertToTeXCharsDefault(m))}_>=0&&l.push(p.substring(_))}else o.push(c)}e++;var y=o.map(function(e){return s(t,[e]).result}).map(d.newTeXRaw).map(function(t){return d.newFixArg([t])});if(y.length<a.argumentCount)throw new Error("Could not find enough arguments for command \\"+a.name+". Expected "+a.argumentCount+", but found "+y.length);var b=[a.apply(function(){},y)];return l.length>0&&b.push(l.join("")),{result:b.join(""),blockIndex:e}}function o(t){return void 0!==t&&"string"==typeof t.string&&"number"==typeof t.category}function s(t,e){var n=0;if(e.length<=0)return{result:"",blockIndex:n};for(var i=[];n<e.length;){var l=e[n];try{if(o(l)){var u=r(n,e);n=u.blockIndex,i.push(u.result)}else if(d.isTeXComm(l)){var c=a(t,n,e,l);n=c.blockIndex,i.push(c.result)}else if(d.isFixArg(l)||d.isOptArg(l)){var c=s(t,l.latex);i.push(c.result),n++}else if(d.isTextHaving(l))i.push(l.text),n++;else{if(d.isTeXMath(l))return s(t,l.latex);if(d.isTeXRaw(l))i.push(l.text),n++;else if(d.isSubOrSuperScript(l)){var h=l.arguments?l.arguments:[],c=a(t,n,e,d.newTeXComm.apply(void 0,[l.type===d.SubOrSuperSymbol.SUB?"mathsubscript":"mathsuperscript"].concat(h)));n=c.blockIndex,i.push(c.result)}else{if(!d.isArray(l))throw new Error("Can't handle LaTeX block yet: "+JSON.stringify(l)+". Leave an issue at https://github.com/digitalheir/tex-to-unicode/issues");var c=s(t,l);i.push(c.result),n++}}}catch(e){if(void 0===t.onError)throw e;var f=t.onError(e,l);if(void 0===f)throw e;i.push(f),n++}}return{result:i.join(""),blockIndex:n}}function l(t,e){if(e.arguments.length>0){var n=g.expand1argsCommand(e.name,s(t,[e.arguments[0]]).result||"");return e.arguments.length>1?n+s(t,e.arguments.slice(1)).result:n}return _.createCommandHandler(e.name,0,1,function(n,i){var r=i[0],a=i.slice(1);return g.expand1argsCommand(e.name,s(t,[r]).result)+s(t,a).result})}function u(t,e){if(e.arguments.length>1){var n=y.expand2argsCommand(e.name,s(t,[e.arguments[0]]).result||"",s(t,[e.arguments[1]]).result||"");return e.arguments.length>2?n+s(t,e.arguments.slice(1)).result:n}return _.createCommandHandler(e.name,0,2,function(n,i){var r=i[0],a=i[1],o=i.slice(2);return y.expand2argsCommand(e.name,s(t,[r]).result,s(t,[a]).result)+s(t,o).result})}function c(t,e){for(var n=void 0,i=void 0,r=0;void 0===i&&r<e.arguments.length;){var a=e.arguments[r],o=s(t,[a]).result;d.isOptArg(a)&&!n?n=o:i=o,r++}return i?m.convertSqrtToUnicode(i,n):_.createCommandHandler(e.name,1,1,function(e,n){var i=n[0],r=m.convertSqrtToUnicode(s(t,[i]).result);if(n.length>1){var a=n.slice(1);return r+s(t,a).result}return r})}function h(t,e){var n=e.name,i=p.expand0argsCommand(n);if(i)return e.arguments&&e.arguments.length>0?i+s(t,e.arguments).result:i;if(v.is1argsCommand(n))return l(t,e);if(b.is2argsCommand(n))return u(t,e);if("sqrt"===n)return c(t,e);throw f.unknownCommandError(n)}Object.defineProperty(e,"__esModule",{value:!0});var d=n(17),f=n(35),p=n(98),_=n(36),g=n(105),v=n(39),m=n(130),y=n(131),b=n(134),w=n(33),x=/^\s*/;e.isTeXChar2=o,e.convertLaTeXBlocksToUnicode=s,e.convertCommand=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(99),r=n(100),a=n(101),o=n(102),s=n(103),l=n(104);e.expand0argsCommand=function(t){for(var e=0,n=[a.barredLUnicode,i.spaceUnicode,o.slashedOUnicode,r.characterUnicode,l.specialCharacter,s.cyrillicUnicode];e<n.length;e++){var u=n[e],c=u(t);if(c)return c}}},function(t,e,n){"use strict";function i(t){return e.spaceCharactersUnicode.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.mathSpace="芇",e.spaceCharactersUnicode={",":" ",quad:" ",qquad:"  "," ":" ",space:" ",";":"　",":":"　",hfill:"\t"},e.isSpaceCharactersUnicode=i,e.spaceUnicode=function(t){return i(t)?e.spaceCharactersUnicode[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.characterUnicodeChart.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.characterUnicodeChart={leftrightsquigarrow:"↭",Longleftrightarrow:"⟺",blacktriangleright:"▶",longleftrightarrow:"⟷",blacktriangledown:"▼",blacktriangleleft:"◀",leftrightharpoons:"⇋",rightleftharpoons:"⇌",twoheadrightarrow:"↠",circlearrowright:"↻",downharpoonright:"⇂",rightharpoondown:"⇁",rightrightarrows:"⇉",twoheadleftarrow:"↞",vartriangleright:"⊳",bigtriangledown:"▽",circlearrowleft:"↺",curvearrowright:"↷",downharpoonleft:"⇃",leftharpoondown:"↽",leftrightarrows:"⇆",rightleftarrows:"⇄",rightsquigarrow:"⇝",rightthreetimes:"⋌",trianglerighteq:"⊵",vartriangleleft:"⊲",Leftrightarrow:"⇔",Longrightarrow:"⟹",curvearrowleft:"↶",dashrightarrow:"⇢",doublebarwedge:"⩞",downdownarrows:"⇊",hookrightarrow:"↪",leftleftarrows:"⇇",leftrightarrow:"↔",leftthreetimes:"⋋",longrightarrow:"⟶",looparrowright:"↬",rightarrowtail:"↣",rightharpoonup:"⇀",sphericalangle:"∢",textregistered:"®",trianglelefteq:"⊴",upharpoonright:"↾",Longleftarrow:"⟸",bigtriangleup:"△",blacktriangle:"▲",dashleftarrow:"⇠",divideontimes:"⋇",fallingdotseq:"≒",hookleftarrow:"↩",leftarrowtail:"↢",leftharpoonup:"↼",longleftarrow:"⟵",looparrowleft:"↫",measuredangle:"∡",shortparallel:"∥",smallsetminus:"∖",texttrademark:"™",triangleright:"▷",upharpoonleft:"↿",blacklozenge:"◆",risingdotseq:"≓",triangledown:"▽",triangleleft:"◁",Rrightarrow:"⇛",Updownarrow:"⇕",backepsilon:"∍",blacksquare:"■",circledcirc:"⊚",circleddash:"⊝",curlyeqprec:"⋞",curlyeqsucc:"⋟",diamondsuit:"♢",preccurlyeq:"≼",succcurlyeq:"≽",textgreater:">",thickapprox:"≈",updownarrow:"↕",vartriangle:"△",Lleftarrow:"⇚",Rightarrow:"⇒",circledast:"⊛",complement:"∁",curlywedge:"⋏",longmapsto:"⟼",registered:"®",rightarrow:"→",smallfrown:"⌢",smallsmile:"⌣",sqsubseteq:"⊑",sqsupseteq:"⊒",textlangle:"〈",textrangle:"〉",upuparrows:"⇈",varepsilon:"ε",varnothing:"∅",Downarrow:"⇓",Leftarrow:"⇐",backprime:"‵",bigotimes:"⨂",centerdot:"⋅",copyright:"©",downarrow:"↓",gtreqless:"⋛",heartsuit:"♡",leftarrow:"←",lesseqgtr:"⋚",pitchfork:"⋔",spadesuit:"♠",therefore:"∴",trademark:"™",triangleq:"≜",varpropto:"∝",approxeq:"≊",barwedge:"⊼",bigoplus:"⨁",bigsqcup:"⨆",biguplus:"⨄",bigwedge:"⋀",boxminus:"⊟",boxtimes:"⊠",circledS:"Ⓢ",clubsuit:"♣",curlyvee:"⋎",doteqdot:"≑",emptyset:"∅",intercal:"⊺",leqslant:"⩽",multimap:"⊸",parallel:"∥",setminus:"∖",sqsubset:"⊏",sqsupset:"⊐",subseteq:"⊆",supseteq:"⊇",textless:"<",thicksim:"∼",triangle:"△",varkappa:"ϰ",varsigma:"ς",vartheta:"ϑ",Diamond:"◇",Uparrow:"⇑",Upsilon:"Υ",backsim:"∽",because:"∵",between:"≬",bigodot:"⨀",bigstar:"★",boxplus:"⊞",ddagger:"‡",diamond:"⋄",digamma:"Ϝ",dotplus:"∔",epsilon:"∊",gtrless:"≷",implies:"⇒",leadsto:"↝",lessdot:"⋖",lessgtr:"≶",lesssim:"≲",lozenge:"◊",natural:"♮",nearrow:"↗",nexists:"∄",nwarrow:"↖",partial:"∂",pilcrow:"¶",precsim:"≾",searrow:"↘",section:"§",succsim:"≿",swarrow:"↙",textbar:"|",uparrow:"↑",upsilon:"υ",Bumpeq:"≎",Lambda:"Λ",Subset:"⋐",Supset:"⋑",Vvdash:"⊪",approx:"≈",bigcap:"⋂",bigcup:"⋃",bigvee:"⋁",bowtie:"⋈",boxdot:"⊡",bullet:"∙",bumpeq:"≏",circeq:"≗",coprod:"∐",dagger:"†",daleth:"ד",degree:"°",eqcirc:"≖",exists:"∃",forall:"∀",gtrdot:"⋗",gtrsim:"≳",hslash:"ℏ",lambda:"λ",lfloor:"⌊",ltimes:"⋉",mapsto:"↦",models:"⊨",ominus:"⊖",oslash:"⊘",otimes:"⊗",preceq:"⪯",propto:"∝",rfloor:"⌋",rtimes:"⋊",square:"□",subset:"⊂",succeq:"⪰",supset:"⊃",varphi:"φ",varrho:"ϱ",veebar:"⊻",Delta:"Δ",Gamma:"Γ",Omega:"Ω",Theta:"Θ",Vdash:"⊩",aleph:"ℵ",Alpha:"Α",alpha:"α",angle:"∠",asymp:"≍",cdots:"⋯",cents:"¢",dashv:"⊣",ddots:"⋱",delta:"δ",doteq:"≐",equiv:"≡",frown:"⌢",gamma:"γ",gimel:"ℷ",infty:"∞",kappa:"κ",Kappa:"Κ",lceil:"⌈",nabla:"∇",notin:"∉",omega:"ω",oplus:"⊕",pound:"£",prime:"′",qquad:"  ",rceil:"⌉",sharp:"♯",sigma:"σ",simeq:"≃",smile:"⌣",space:"␣",sqcap:"⊓",sqcup:"⊔",theta:"θ",times:"×",unlhd:"⊴",unrhd:"⊵",uplus:"⊎",vDash:"⊨",varpi:"ϖ",vdash:"⊢",vdots:"⋮",wedge:"∧",Finv:"Ⅎ",Join:"⋈",atop:"¦",beta:"β",Beta:"Β",beth:"ב",cdot:"⋅",circ:"∘",cong:"≅",dots:"…",euro:"€",flat:"♭",geqq:"≧",hbar:"ℏ",iota:"ι",leqq:"≦",odot:"⊙",oint:"∮",perp:"⊥",prec:"≺",prod:"∏",quad:" ",star:"⋆",succ:"≻",surd:"√",zeta:"ζ",Box:"□",Cap:"⋒",Cup:"⋓",Lsh:"↰",Phi:"Φ",Psi:"Ψ",Rsh:"↱",ast:"∗",bot:"⊥",cap:"∩",chi:"χ",Chi:"Χ",cup:"∪",div:"÷",ell:"ℓ",eta:"η",eth:"ð",geq:"≥",ggg:"⋙",int:"∫",leq:"≤",lhd:"⊲",lll:"⋘",mho:"℧",mid:"∣",neg:"¬",neq:"≠",phi:"ϕ",psi:"ψ",rhd:"⊳",rho:"ρ",Rho:"Ρ",sim:"∼",sum:"∑",tau:"τ",Tau:"Τ",top:"⊤",vee:"∨",Im:"ℑ",Pi:"Π",Re:"ℜ",Xi:"Ξ",ge:"≥",gg:"≫",in:"∈",le:"≤",ll:"≪",mp:"∓",mu:"μ",Mu:"Μ",ni:"∋",nu:"ν",Nu:"Ν",pi:"π",pm:"±",wp:"℘",wr:"≀",xi:"ξ",Omicron:"Ο",omicron:"ο",textdollar:"$",textquotesingle:"'",textbackslash:"\\",textasciigrave:"`",lbrace:"{",vert:"|",rbrace:"}",textasciitilde:"~",textexclamdown:"¡",textcent:"¢",textsterling:"£",textcurrency:"¤",textyen:"¥",textbrokenbar:"¦",textsection:"§",textasciidieresis:"¨",textcopyright:"©",textordfeminine:"ª",guillemotleft:"«",lnot:"¬",textasciimacron:"¯",textdegree:"°",textasciiacute:"´",textparagraph:"¶",textordmasculine:"º",guillemotright:"»",textonequarter:"¼",textonehalf:"½",textthreequarters:"¾",textquestiondown:"¿",AA:"Å",AE:"Æ",DH:"Ð",texttimes:"×",TH:"Þ",ss:"ß",aa:"å",ae:"æ",dh:"ð",th:"þ",DJ:"Đ",dj:"đ",Elzxh:"ħ",i:"ı",NG:"Ŋ",ng:"ŋ",OE:"Œ",oe:"œ",texthvlig:"ƕ",textnrleg:"ƞ",textdoublepipe:"ǂ",Elztrna:"ɐ",Elztrnsa:"ɒ",Elzopeno:"ɔ",Elzrtld:"ɖ",Elzschwa:"ə",Elzpgamma:"ɣ",Elzpbgam:"ɤ",Elztrnh:"ɥ",Elzbtdl:"ɬ",Elzrtll:"ɭ",Elztrnm:"ɯ",Elztrnmlr:"ɰ",Elzltlmr:"ɱ",Elzltln:"ɲ",Elzrtln:"ɳ",Elzclomeg:"ɷ",textphi:"ɸ",Elztrnr:"ɹ",Elztrnrl:"ɺ",Elzrttrnr:"ɻ",Elzrl:"ɼ",Elzrtlr:"ɽ",Elzfhr:"ɾ",Elzrtls:"ʂ",Elzesh:"ʃ",Elztrnt:"ʇ",Elzrtlt:"ʈ",Elzpupsil:"ʊ",Elzpscrv:"ʋ",Elzinvv:"ʌ",Elzinvw:"ʍ",Elztrny:"ʎ",Elzrtlz:"ʐ",Elzyogh:"ʒ",Elzglst:"ʔ",Elzreglst:"ʕ",Elzinglst:"ʖ",textturnk:"ʞ",Elzdyogh:"ʤ",Elztesh:"ʧ",textasciicaron:"ˇ",Elzverts:"ˈ",Elzverti:"ˌ",Elzlmrk:"ː",Elzhlmrk:"ˑ",Elzsbrhr:"˒",Elzsblhr:"˓",Elzrais:"˔",Elzlow:"˕",textasciibreve:"˘",textperiodcentered:"˙",texttildelow:"˜",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Iota:"Ι",Sigma:"Σ",texttheta:"θ",textvartheta:"ϑ",Stigma:"Ϛ",Digamma:"Ϝ",Koppa:"Ϟ",Sampi:"Ϡ",textTheta:"ϴ",textendash:"–",textemdash:"—",Vert:"‖",Elzreapos:"‛",textquotedblleft:"“",textquotedblright:"”",textdagger:"†",textdaggerdbl:"‡",textbullet:"•",ldots:"…",textperthousand:"‰",textpertenthousand:"‱",guilsinglleft:"‹",guilsinglright:"›",nolinebreak:"⁠",Elzxrat:"℞",nleftarrow:"↚",nrightarrow:"↛",arrowwaveleft:"↜",arrowwaveright:"↝",nleftrightarrow:"↮",dblarrowupdown:"⇅",nLeftarrow:"⇍",nLeftrightarrow:"⇎",nRightarrow:"⇏",DownArrowUpArrow:"⇵",rightangle:"∟",nmid:"∤",nparallel:"∦",surfintegral:"∯",volintegral:"∰",clwintegral:"∱",Colon:"∷",homothetic:"∻",lazysinv:"∾",NotEqualTilde:"≂",approxnotequal:"≆",tildetrpl:"≋",allequal:"≌",NotHumpDownHump:"≎",NotHumpEqual:"≏",estimates:"≙",starequal:"≛",lneqq:"≨",lvertneqq:"≨",gneqq:"≩",gvertneqq:"≩",NotLessLess:"≪",NotGreaterGreater:"≫",lessequivlnt:"≲",greaterequivlnt:"≳",notlessgreater:"≸",notgreaterless:"≹",precapprox:"≾",NotPrecedesTilde:"≾",succapprox:"≿",NotSucceedsTilde:"≿",subsetneq:"⊊",varsubsetneqq:"⊊",supsetneq:"⊋",varsupsetneq:"⊋",NotSquareSubset:"⊏",NotSquareSuperset:"⊐",truestate:"⊧",forcesextra:"⊨",VDash:"⊫",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",original:"⊶",image:"⊷",hermitconjmatrix:"⊹",rightanglearc:"⊾",backsimeq:"⋍",verymuchless:"⋘",verymuchgreater:"⋙",Elzsqspne:"⋥",lnsim:"⋦",gnsim:"⋧",precedesnotsimilar:"⋨",succnsim:"⋩",ntriangleleft:"⋪",ntriangleright:"⋫",ntrianglelefteq:"⋬",ntrianglerighteq:"⋭",upslopeellipsis:"⋰",downslopeellipsis:"⋱",perspcorrespond:"⌆",recorder:"⌕",ulcorner:"⌜",urcorner:"⌝",llcorner:"⌞",lrcorner:"⌟",langle:"〈",rangle:"〉",Elzdlcorn:"⎣",lmoustache:"⎰",rmoustache:"⎱",textvisiblespace:"␣",Elzdshfnc:"┆",Elzsqfnw:"┙",diagup:"╱",Elzvrecto:"▯",Elzcirfl:"◐",Elzcirfr:"◑",Elzcirfb:"◒",Elzrvbull:"◘",Elzsqfl:"◧",Elzsqfr:"◨",Elzsqfse:"◪",bigcirc:"◯",rightmoon:"☾",mercury:"☿",venus:"♀",male:"♂",jupiter:"♃",saturn:"♄",uranus:"♅",neptune:"♆",pluto:"♇",aries:"♈",taurus:"♉",gemini:"♊",cancer:"♋",leo:"♌",virgo:"♍",libra:"♎",scorpio:"♏",sagittarius:"♐",capricornus:"♑",aquarius:"♒",pisces:"♓",quarternote:"♩",eighthnote:"♪",UpArrowBar:"⤒",DownArrowBar:"⤓",Elolarr:"⥀",Elorarr:"⥁",ElzRlarr:"⥂",ElzrLarr:"⥄",Elzrarrx:"⥇",LeftRightVector:"⥎",RightUpDownVector:"⥏",DownLeftRightVector:"⥐",LeftUpDownVector:"⥑",LeftVectorBar:"⥒",RightVectorBar:"⥓",RightUpVectorBar:"⥔",RightDownVectorBar:"⥕",DownLeftVectorBar:"⥖",DownRightVectorBar:"⥗",LeftUpVectorBar:"⥘",LeftDownVectorBar:"⥙",LeftTeeVector:"⥚",RightTeeVector:"⥛",RightUpTeeVector:"⥜",RightDownTeeVector:"⥝",DownLeftTeeVector:"⥞",DownRightTeeVector:"⥟",LeftUpTeeVector:"⥠",LeftDownTeeVector:"⥡",UpEquilibrium:"⥮",ReverseUpEquilibrium:"⥯",RoundImplies:"⥰",Elztfnc:"⦀",Elroang:"⦆",Elzddfnc:"⦙",Angle:"⦜",Elzlpargt:"⦠",ElzLap:"⧊",Elzdefas:"⧋",LeftTriangleBar:"⧏",NotLeftTriangleBar:"⧏",RightTriangleBar:"⧐",NotRightTriangleBar:"⧐",RuleDelayed:"⧴",Elxuplus:"⨄",ElzThr:"⨅",Elxsqcup:"⨆",ElzInf:"⨇",ElzSup:"⨈",ElzCint:"⨍",clockoint:"⨏",sqrint:"⨖",ElzTimes:"⨯",amalg:"⨿",ElzAnd:"⩓",ElzOr:"⩔",ElOr:"⩖",Elzminhat:"⩟",Equal:"⩵",nleqslant:"⩽",geqslant:"⩾",ngeqslant:"⩾",lessapprox:"⪅",gtrapprox:"⪆",lneq:"⪇",gneq:"⪈",lnapprox:"⪉",gnapprox:"⪊",lesseqqgtr:"⪋",gtreqqless:"⪌",eqslantless:"⪕",eqslantgtr:"⪖",NestedLessLess:"⪡",NotNestedLessLess:"⪡",NestedGreaterGreater:"⪢",NotNestedGreaterGreater:"⪢",precneqq:"⪵",succneqq:"⪶",precnapprox:"⪹",succnapprox:"⪺",subseteqq:"⫅",nsubseteqq:"⫅",supseteqq:"⫆",subsetneqq:"⫋",supsetneqq:"⫌",Elztdcol:"⫶",openbracketleft:"〚",openbracketright:"〛"},e.isCharacterUnicode=i,e.characterUnicode=function(t){return i(t)?e.characterUnicodeChart[t]:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.barredLUnicodeChart={l:"ł",L:"Ł"},e.barredLUnicode=function(t){return e.barredLUnicodeChart[t]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.slashed_o="ø",e.slashed_O="Ø",e.slashedOUnicodeChart={o:e.slashed_o,O:e.slashed_O},e.slashedOUnicode=function(t){return e.slashedOUnicodeChart[t]}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cyrillicUnicodeChart={CYRF:"Ф",CYRII:"І",CYROMEGA:"Ѡ",CYRG:"Г",cyrkvcrs:"ҝ",cyryo:"ё",CYRH:"Х",CYRZHDSC:"Җ",cyrphk:"ҧ",CYRTDSC:"Ҭ",CYRI:"И",cyryi:"ї",CYRDZHE:"Џ",cyriote:"ѥ",CYRK:"К",CYRSHHA:"Һ",CYRL:"Л",CYRM:"М",CYRCHLDSC:"Ӌ",CYRNJE:"Њ",CYRYAT:"Ѣ",CYRA:"А",CYRB:"Б",cyrchrdsc:"ҷ",cyrschwa:"ә",CYRDZE:"Ѕ",CYRIE:"Є",CYRC:"Ц",CYRZH:"Ж",CYRD:"Д",CYRABHCHDSC:"Ҿ",CYRFITA:"Ѳ",CYRE:"Е",CYRABHHA:"Ҩ",cyrya:"я",cyrdzhe:"џ",CYRIOTLYUS:"Ѩ",cyrsemisftsn:"ҍ",CYRV:"В",cyrishrt:"й",cyrdje:"ђ",cyrchldsc:"ӌ",CYRY:"Ү",cyrndsc:"ң",CYRZ:"З",CYRKHCRS:"Ҟ",CYRNG:"Ҥ",CYRCHRDSC:"Ҷ",CYRYHCRS:"Ұ",CYRSHCH:"Щ",CYRUSHRT:"Ў",cyryu:"ю",cyrksi:"ѯ",CYRN:"Н",CYRO:"О",CYRBYUS:"Ѫ",CYRP:"П",CYRZDSC:"Ҙ",CYRAE:"Ӕ",CYRR:"Р",CYRS:"С",CYRT:"Т",CYRABHCH:"Ҽ",cyruk:"ѹ",CYRU:"У",cyrii:"і",CYRSEMISFTSN:"Ҍ",cyrghcrs:"ғ",CYRISHRT:"Й",cyromegatitlo:"ѽ",cyrkbeak:"ҡ",cyrie:"є",cyrzdsc:"ҙ",CYRNDSC:"Ң",CYRGUP:"Ґ",cyrshch:"щ",CYRKHK:"Ӄ",cyrzh:"ж",CYRJE:"Ј",cyrthousands:"҂",cyrabhch:"ҽ",textnumero:"№",cyrng:"ҥ",CYRPSI:"Ѱ",CYRTETSE:"Ҵ",CYRIOTBYUS:"Ѭ",cyrnje:"њ",CYRIOTE:"Ѥ",cyrdze:"ѕ",cyrae:"ӕ",CYRHRDSN:"Ъ",CYRKOPPA:"Ҁ",CYRRTICK:"Ҏ",CYRSCHWA:"Ә",cyrtdsc:"ҭ",CYRGHK:"Ҕ",cyrabhha:"ҩ",cyrshha:"һ",CYRSH:"Ш",cyru:"у",cyrkhcrs:"ҟ",cyrt:"т",CYRERY:"Ы",cyrs:"с",cyrr:"р",CYROT:"Ѿ",cyrlyus:"ѧ",CYRNHK:"Ӈ",CYRSFTSN:"Ь",cyrghk:"ҕ",cyrp:"п",cyrabhdze:"ӡ",cyro:"о",CYRTSHE:"Ћ",cyrn:"н",CYRSDSC:"Ҫ",cyryhcrs:"ұ",cyrpsi:"ѱ",cyrz:"з",cyry:"ү",cyrje:"ј",cyrv:"в",cyrchvcrs:"ҹ",cyrkhk:"ӄ",cyre:"е",cyromega:"ѡ",cyrd:"д",cyrc:"ц",cyrb:"б",CYROTLD:"Ө",cyrgup:"ґ",CYRLJE:"Љ",cyra:"а",CYROMEGATITLO:"Ѽ",CYRGHCRS:"Ғ",CYRCHVCRS:"Ҹ",cyrm:"м",cyrl:"л",cyrsh:"ш",cyrk:"к",cyri:"и",cyrh:"х",CYRHDSC:"Ҳ",CYRIZH:"Ѵ",CYRABHDZE:"Ӡ",cyrkdsc:"қ",cyrg:"г",CYRCH:"Ч",cyrf:"ф",CYRYI:"Ї",cyrmillions:"҉",CYRKSI:"Ѯ",CYROMEGARND:"Ѻ",cyrot:"ѿ",cyrtetse:"ҵ",cyrhdsc:"ҳ",cyrushrt:"ў",cyriotlyus:"ѩ",CYRYA:"Я",cyrlje:"љ",cyrotld:"ө",CYRKDSC:"Қ",cyrhrdsn:"ъ",cyrrtick:"ҏ",cyrkoppa:"ҁ",CYRDJE:"Ђ",cyriotbyus:"ѭ",cyrhundredthousands:"҈",CYRpalochka:"Ӏ",CYRKVCRS:"Ҝ",cyromegarnd:"ѻ",cyrsftsn:"ь",cyrabhchdsc:"ҿ",cyrzhdsc:"җ",cyrerev:"э",CYRLYUS:"Ѧ",CYRKBEAK:"Ҡ",cyrery:"ы",CYREREV:"Э",cyrnhk:"ӈ",cyrsdsc:"ҫ",cyrch:"ч",cyrtshe:"ћ",CYRPHK:"Ҧ",CYRYO:"Ё",CYRYU:"Ю",CYRUK:"Ѹ"},e.cyrillicUnicode=function(t){return e.cyrillicUnicodeChart[t]}},function(t,e,n){"use strict";function i(t){return e.specialCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.specialCharacters={i:"ı",j:"ȷ",oe:"œ",OE:"Œ",ae:"æ",AE:"Æ",aa:"å",AA:"Å",o:"ø",O:"Ø",ss:"ß",l:"ł",L:"Ł"},e.isSpecialCharacter=i,e.specialCharacter=function(t){return i(t)?e.specialCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t,e){switch(t){case"cyrchar":var n=o.translateCharToCyrillic(e);if(n)return n;break;default:for(var i=0,s=[r.diacriticUnicode,a.formattingUnicode];i<s.length;i++){var l=s[i],u=l(t,e);if(u)return u}}throw new Error("No implementation found to expand \\"+t+" with argument {"+e+"}")}Object.defineProperty(e,"__esModule",{value:!0});var r=n(106),a=n(118),o=n(127);e.expand1argsCommand=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(107),r=n(108),a=n(109),o=n(110),s=n(111),l=n(112),u=n(113),c=n(114),h=n(10),d=n(115),f=n(116),p=n(117);e.barUnderLetter=h.simpleSuffix("̱"),e.dotUnderLetter=h.simpleSuffix("̣"),e.breve=h.simpleSuffix("̆"),e.macrron=h.simpleSuffix("̄"),e.dotOverLetter=h.simpleSuffix("̇"),e.longHungarianUmlaut=h.simpleSuffix("̋"),e.modifiersTextModeUnicodeChart={"`":a.graveAccent,"'":r.acuteAccent,"^":o.circumflex,"~":s.tilde,"=":e.macrron,".":e.dotOverLetter,'"':l.dieresis,H:e.longHungarianUmlaut,c:u.cedilla,k:d.ogonek,b:e.barUnderLetter,d:e.dotUnderLetter,r:i.ringOverLetter,u:e.breve,v:c.caron,t:f.tieLetters},e.modifiersMathModeUnicodeChart={check:c.caron,acute:r.acuteAccent,grave:r.acuteAccent,breve:e.breve,vec:p.vectorArrow,mathring:i.ringOverLetter},e.diacriticUnicode=function(t,n){var i=e.modifiersTextModeUnicodeChart[t];return i||(i=e.modifiersMathModeUnicodeChart[t]),i&&i(n)}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.ringOverLetter=i.lookupOrAppend({a:"å",A:"Å",y:"ẙ"},"̊")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.acuteAccent=i.lookupOrAppend({e:"é",y:"ý",u:"ú",i:"í",o:"ó",a:"á",E:"É",Y:"Ý",U:"Ú",I:"Í",O:"Ó",A:"Á",cyrk:"ќ",cyrg:"ѓ",CYRK:"Ќ",CYRG:"Ѓ"},"́")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.graveAccent=i.lookupOrAppend({e:"è",u:"ù",i:"ì",o:"ò",a:"à",E:"È",U:"Ù",I:"Ì",O:"Ò",A:"À"},"̀")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.circumflex=i.lookupOrAppend({e:"ê",u:"û",i:"î",o:"ô",a:"â",E:"Ê",U:"Û",I:"Î",O:"Ô",A:"Â"},"̂")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.tilde=i.lookupOrAppend({o:"õ",a:"ã",n:"ñ",O:"Õ",A:"Ã",N:"Ñ"},"̃")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.dieresis=i.lookupOrAppend({e:"ë",y:"ÿ",u:"ü",i:"ï",o:"ö",a:"ä",E:"Ë",Y:"Ÿ",U:"Ü",I:"Ï",O:"Ö",A:"Ä"},"̈")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.cedilla=i.lookupOrAppend({c:"ç"},"̧")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.caron=i.lookupOrAppend({s:"š"},"̌")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(10);e.ogonek=i.simpleSuffix("̨")},function(t,e,n){"use strict";function i(t){return r(t.charAt(0),t.substring(1))}function r(t,e){return t+"͡"+e}function a(t){return"t"===t}Object.defineProperty(e,"__esModule",{value:!0}),e.tieLetters=i,e.tie2Letters=r,e.isTieLetters=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(6);e.vectorArrow=i.lookupOrAppend({},"⃗")},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(119),r=n(120),a=n(121),o=n(122),s=n(123),l=n(124),u=n(37),c=n(125),h=n(38),d=n(126);e.formattingUnicode=function(t,e){var n=void 0;if(u.isBbCmd(t)?n=i.translateCharToBlackboard:u.isBfCmd(t)?n=r.translateCharToBold:u.isFrakCmd(t)?n=a.translateCharToFraktur:u.isItCmd(t)?n=o.translateCharToItalic:u.isTtCmd(t)?n=s.translateCharToMonospace:u.isCalCmd(t)?n=l.translateCharToCalligraphic:u.isSubCmd(t)?n=c.translateCharToSubscript:u.isSupCmd(t)?n=h.translateCharToSuperscript:u.isMonoCmd(t)&&(n=d.translateCharToMono),n){var f=n;return e.split("").map(function(t){return f(t)||t}).join("")}}},function(t,e,n){"use strict";function i(t){return e.blackboardCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.blackboardCharacters={A:"𝔸",B:"𝔹",C:"ℂ",D:"𝔻",E:"𝔼",F:"𝔽",G:"𝔾",H:"ℍ",I:"𝕀",J:"𝕁",K:"𝕂",L:"𝕃",M:"𝕄",N:"ℕ",O:"𝕆",P:"ℙ",Q:"ℚ",R:"ℝ",S:"𝕊",T:"𝕋",U:"𝕌",V:"𝕍",W:"𝕎",X:"𝕏",Y:"𝕐",Z:"ℤ",a:"𝕒",b:"𝕓",c:"𝕔",d:"𝕕",e:"𝕖",f:"𝕗",g:"𝕘",h:"𝕙",i:"𝕚",j:"𝕛",k:"𝕜",l:"𝕝",m:"𝕞",n:"𝕟",o:"𝕠",p:"𝕡",q:"𝕢",r:"𝕣",s:"𝕤",t:"𝕥",u:"𝕦",v:"𝕧",w:"𝕨",x:"𝕩",y:"𝕪",z:"𝕫",0:"𝟘",1:"𝟙",2:"𝟚",3:"𝟛",4:"𝟜",5:"𝟝",6:"𝟞",7:"𝟟",8:"𝟠",9:"𝟡"},e.isBlackboardCharacter=i,e.translateCharToBlackboard=function(t){return i(t)?e.blackboardCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.boldCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.boldCharacters={A:"𝐀",B:"𝐁",C:"𝐂",D:"𝐃",E:"𝐄",F:"𝐅",G:"𝐆",H:"𝐇",I:"𝐈",J:"𝐉",K:"𝐊",L:"𝐋",M:"𝐌",N:"𝐍",O:"𝐎",P:"𝐏",Q:"𝐐",R:"𝐑",S:"𝐒",T:"𝐓",U:"𝐔",V:"𝐕",W:"𝐖",X:"𝐗",Y:"𝐘",Z:"𝐙",a:"𝐚",b:"𝐛",c:"𝐜",d:"𝐝",e:"𝐞",f:"𝐟",g:"𝐠",h:"𝐡",i:"𝐢",j:"𝐣",k:"𝐤",l:"𝐥",m:"𝐦",n:"𝐧",o:"𝐨",p:"𝐩",q:"𝐪",r:"𝐫",s:"𝐬",t:"𝐭",u:"𝐮",v:"𝐯",w:"𝐰",x:"𝐱",y:"𝐲",z:"𝐳","Α":"𝚨","Β":"𝚩","Γ":"𝚪","Δ":"𝚫","Ε":"𝚬","Ζ":"𝚭","Η":"𝚮","Θ":"𝚯","Ι":"𝚰","Κ":"𝚱","Λ":"𝚲","Μ":"𝚳","Ν":"𝚴","Ξ":"𝚵","Ο":"𝚶","Π":"𝚷","Ρ":"𝚸","ϴ":"𝚹","Σ":"𝚺","Τ":"𝚻","Υ":"𝚼","Φ":"𝚽","Χ":"𝚾","Ψ":"𝚿","Ω":"𝛀","∇":"𝛁","α":"𝛂","β":"𝛃","γ":"𝛄","δ":"𝛅","ε":"𝛆","ζ":"𝛇","η":"𝛈","θ":"𝛉","ι":"𝛊","κ":"𝛋","λ":"𝛌","μ":"𝛍","ν":"𝛎","ξ":"𝛏","ο":"𝛐","π":"𝛑","ρ":"𝛒","ς":"𝛓","σ":"𝛔","τ":"𝛕","υ":"𝛖","φ":"𝛗","χ":"𝛘","ψ":"𝛙","ω":"𝛚","∂":"𝛛","ϵ":"𝛜","ϑ":"𝛝","ϰ":"𝛞","ϕ":"𝛟","ϱ":"𝛠","ϖ":"𝛡",0:"𝟎",1:"𝟏",2:"𝟐",3:"𝟑",4:"𝟒",5:"𝟓",6:"𝟔",7:"𝟕",8:"𝟖",9:"𝟗"},e.isBlackboardCharacter=i,e.translateCharToBold=function(t){return i(t)?e.boldCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.frakturCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.frakturCharacters={A:"𝔄",B:"𝔅",C:"ℭ",D:"𝔇",E:"𝔈",F:"𝔉",G:"𝔊",H:"ℌ",I:"ℑ",J:"𝔍",K:"𝔎",L:"𝔏",M:"𝔐",N:"𝔑",O:"𝔒",P:"𝔓",Q:"𝔔",R:"ℜ",S:"𝔖",T:"𝔗",U:"𝔘",V:"𝔙",W:"𝔚",X:"𝔛",Y:"𝔜",Z:"ℨ",a:"𝔞",b:"𝔟",c:"𝔠",d:"𝔡",e:"𝔢",f:"𝔣",g:"𝔤",h:"𝔥",i:"𝔦",j:"𝔧",k:"𝔨",l:"𝔩",m:"𝔪",n:"𝔫",o:"𝔬",p:"𝔭",q:"𝔮",r:"𝔯",s:"𝔰",t:"𝔱",u:"𝔲",v:"𝔳",w:"𝔴",x:"𝔵",y:"𝔶",z:"𝔷"},e.isFrakturCharacter=i,e.translateCharToFraktur=function(t){return i(t)?e.frakturCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.italicCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.italicCharacters={A:"𝐴",B:"𝐵",C:"𝐶",D:"𝐷",E:"𝐸",F:"𝐹",G:"𝐺",H:"𝐻",I:"𝐼",J:"𝐽",K:"𝐾",L:"𝐿",M:"𝑀",N:"𝑁",O:"𝑂",P:"𝑃",Q:"𝑄",R:"𝑅",S:"𝑆",T:"𝑇",U:"𝑈",V:"𝑉",W:"𝑊",X:"𝑋",Y:"𝑌",Z:"𝑍",a:"𝑎",b:"𝑏",c:"𝑐",d:"𝑑",e:"𝑒",f:"𝑓",g:"𝑔",h:"ℎ",i:"𝑖",j:"𝑗",k:"𝑘",l:"𝑙",m:"𝑚",n:"𝑛",o:"𝑜",p:"𝑝",q:"𝑞",r:"𝑟",s:"𝑠",t:"𝑡",u:"𝑢",v:"𝑣",w:"𝑤",x:"𝑥",y:"𝑦",z:"𝑧","Α":"𝛢","Β":"𝛣","Γ":"𝛤","Δ":"𝛥","Ε":"𝛦","Ζ":"𝛧","Η":"𝛨","Θ":"𝛩","Ι":"𝛪","Κ":"𝛫","Λ":"𝛬","Μ":"𝛭","Ν":"𝛮","Ξ":"𝛯","Ο":"𝛰","Π":"𝛱","Ρ":"𝛲","ϴ":"𝛳","Σ":"𝛴","Τ":"𝛵","Υ":"𝛶","Φ":"𝛷","Χ":"𝛸","Ψ":"𝛹","Ω":"𝛺","∇":"𝛻","α":"𝛼","β":"𝛽","γ":"𝛾","δ":"𝛿","ε":"𝜀","ζ":"𝜁","η":"𝜂","θ":"𝜃","ι":"𝜄","κ":"𝜅","λ":"𝜆","μ":"𝜇","ν":"𝜈","ξ":"𝜉","ο":"𝜊","π":"𝜋","ρ":"𝜌","ς":"𝜍","σ":"𝜎","τ":"𝜏","υ":"𝜐","φ":"𝜑","χ":"𝜒","ψ":"𝜓","ω":"𝜔","∂":"𝜕","ϵ":"𝜖","ϑ":"𝜗","ϰ":"𝜘","ϕ":"𝜙","ϱ":"𝜚","ϖ":"𝜛"},e.isItalicCharacter=i,e.translateCharToItalic=function(t){return i(t)?e.italicCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.monospaceCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.monospaceCharacters={A:"𝙰",B:"𝙱",C:"𝙲",D:"𝙳",E:"𝙴",F:"𝙵",G:"𝙶",H:"𝙷",I:"𝙸",J:"𝙹",K:"𝙺",L:"𝙻",M:"𝙼",N:"𝙽",O:"𝙾",P:"𝙿",Q:"𝚀",R:"𝚁",S:"𝚂",T:"𝚃",U:"𝚄",V:"𝚅",W:"𝚆",X:"𝚇",Y:"𝚈",Z:"𝚉",a:"𝚊",b:"𝚋",c:"𝚌",d:"𝚍",e:"𝚎",f:"𝚏",g:"𝚐",h:"𝚑",i:"𝚒",j:"𝚓",k:"𝚔",l:"𝚕",m:"𝚖",n:"𝚗",o:"𝚘",p:"𝚙",q:"𝚚",r:"𝚛",s:"𝚜",t:"𝚝",u:"𝚞",v:"𝚟",w:"𝚠",x:"𝚡",y:"𝚢",z:"𝚣",0:"𝟶",1:"𝟷",2:"𝟸",3:"𝟹",4:"𝟺",5:"𝟻",6:"𝟼",7:"𝟽",8:"𝟾",9:"𝟿"},e.isMonospaceCharacter=i,e.translateCharToMonospace=function(t){return i(t)?e.monospaceCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.calligraphicLetters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.calligraphicLetters={A:"𝓐",B:"𝓑",C:"𝓒",D:"𝓓",E:"𝓔",F:"𝓕",G:"𝓖",H:"𝓗",I:"𝓘",J:"𝓙",K:"𝓚",L:"𝓛",M:"𝓜",N:"𝓝",O:"𝓞",P:"𝓟",Q:"𝓠",R:"𝓡",S:"𝓢",T:"𝓣",U:"𝓤",V:"𝓥",W:"𝓦",X:"𝓧",Y:"𝓨",Z:"𝓩",a:"𝓪",b:"𝓫",c:"𝓬",d:"𝓭",e:"𝓮",f:"𝓯",g:"𝓰",h:"𝓱",i:"𝓲",j:"𝓳",k:"𝓴",l:"𝓵",m:"𝓶",n:"𝓷",o:"𝓸",p:"𝓹",q:"𝓺",r:"𝓻",s:"𝓼",t:"𝓽",u:"𝓾",v:"𝓿",w:"𝔀",x:"𝔁",y:"𝔂",z:"𝔃"},e.isCalligraphicLetter=i,e.translateCharToCalligraphic=function(t){return i(t)?e.calligraphicLetters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.subscriptCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.subscriptCharacters={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ","β":"ᵦ","γ":"ᵧ","ρ":"ᵨ","φ":"ᵩ","χ":"ᵪ"},e.isSubscriptCharacter=i,e.translateCharToSubscript=function(t){return i(t)?e.subscriptCharacters[t]:void 0}},function(t,e,n){"use strict";function i(t){return e.monoCharacters.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.monoCharacters={A:"𝙰",B:"𝙱",C:"𝙲",D:"𝙳",E:"𝙴",F:"𝙵",G:"𝙶",H:"𝙷",I:"𝙸",J:"𝙹",K:"𝙺",L:"𝙻",M:"𝙼",N:"𝙽",O:"𝙾",P:"𝙿",Q:"𝚀",R:"𝚁",S:"𝚂",T:"𝚃",U:"𝚄",V:"𝚅",W:"𝚆",X:"𝚇",Y:"𝚈",Z:"𝚉",a:"𝚊",b:"𝚋",c:"𝚌",d:"𝚍",e:"𝚎",f:"𝚏",g:"𝚐",h:"𝚑",i:"𝚒",j:"𝚓",k:"𝚔",l:"𝚕",m:"𝚖",n:"𝚗",o:"𝚘",p:"𝚙",q:"𝚚",r:"𝚛",s:"𝚜",t:"𝚝",u:"𝚞",v:"𝚟",w:"𝚠",x:"𝚡",y:"𝚢",z:"𝚣",0:"𝟶",1:"𝟷",2:"𝟸",3:"𝟹",4:"𝟺",5:"𝟻",6:"𝟼",7:"𝟽",8:"𝟾",9:"𝟿"},e.isMonoCharacter=i,e.translateCharToMono=function(t){return i(t)?e.monoCharacters[t]:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cyrillicCharacters={"Ф":"Ф","І":"І","Ѡ":"Ѡ","Г":"Г","ҝ":"ҝ","ё":"ё","Х":"Х","Җ":"Җ","ҧ":"ҧ","Ҭ":"Ҭ","И":"И","ї":"ї","Џ":"Џ","ѥ":"ѥ","К":"К","Һ":"Һ","Л":"Л","М":"М","Ӌ":"Ӌ","Њ":"Њ","Ѣ":"Ѣ","А":"А","Б":"Б","ҷ":"ҷ","ә":"ә","Ѕ":"Ѕ","Є":"Є","Ц":"Ц","Ж":"Ж","Д":"Д","Ҿ":"Ҿ","Ѳ":"Ѳ","Е":"Е","Ҩ":"Ҩ","я":"я","џ":"џ","Ѩ":"Ѩ","ҍ":"ҍ","В":"В","й":"й","ђ":"ђ","ӌ":"ӌ","Ү":"Ү","ң":"ң","З":"З","Ҟ":"Ҟ","Ҥ":"Ҥ","Ҷ":"Ҷ","Ұ":"Ұ","Щ":"Щ","Ў":"Ў","ю":"ю","ѯ":"ѯ","Н":"Н","О":"О","Ѫ":"Ѫ","П":"П","Ҙ":"Ҙ","Ӕ":"Ӕ","Р":"Р","С":"С","Т":"Т","Ҽ":"Ҽ","ѹ":"ѹ","У":"У","і":"і","Ҍ":"Ҍ","ғ":"ғ","Й":"Й","ѽ":"ѽ","ҡ":"ҡ","є":"є","ҙ":"ҙ","Ң":"Ң","Ґ":"Ґ","щ":"щ","Ӄ":"Ӄ","ж":"ж","Ј":"Ј","҂":"҂","ҽ":"ҽ","№":"№","ҥ":"ҥ","Ѱ":"Ѱ","Ҵ":"Ҵ","Ѭ":"Ѭ","њ":"њ","Ѥ":"Ѥ","ѕ":"ѕ","ӕ":"ӕ","Ъ":"Ъ","Ҁ":"Ҁ","Ҏ":"Ҏ","Ә":"Ә","ҭ":"ҭ","Ҕ":"Ҕ","ҩ":"ҩ","һ":"һ","Ш":"Ш","у":"у","ҟ":"ҟ","т":"т","Ы":"Ы","с":"с","р":"р","Ѿ":"Ѿ","ѧ":"ѧ","Ӈ":"Ӈ","Ь":"Ь","ҕ":"ҕ","п":"п","ӡ":"ӡ","о":"о","Ћ":"Ћ","н":"н","Ҫ":"Ҫ","ұ":"ұ","ѱ":"ѱ","з":"з","ү":"ү","̏":"̏","ј":"ј","в":"в","ҹ":"ҹ","ӄ":"ӄ","е":"е","ѡ":"ѡ","д":"д","ц":"ц","б":"б","Ө":"Ө","ґ":"ґ","Љ":"Љ","а":"а","Ѽ":"Ѽ","Ғ":"Ғ","Ҹ":"Ҹ","м":"м","л":"л","ш":"ш","к":"к","и":"и","х":"х","Ҳ":"Ҳ","Ѵ":"Ѵ","Ӡ":"Ӡ","қ":"қ","г":"г","Ч":"Ч","ф":"ф","Ї":"Ї","҉":"҉","Ѯ":"Ѯ","Ѻ":"Ѻ","ѿ":"ѿ","ҵ":"ҵ","ҳ":"ҳ","ў":"ў","ѩ":"ѩ","Я":"Я","љ":"љ","ө":"ө","Қ":"Қ","ъ":"ъ","ҏ":"ҏ","ҁ":"ҁ","Ђ":"Ђ","ѭ":"ѭ","҈":"҈","Ӏ":"Ӏ","Ҝ":"Ҝ","ѻ":"ѻ","ь":"ь","ҿ":"ҿ","җ":"җ","э":"э","Ѧ":"Ѧ","Ҡ":"Ҡ","ы":"ы","Э":"Э","ӈ":"ӈ","ҫ":"ҫ","ч":"ч","ћ":"ћ","Ҧ":"Ҧ","Ё":"Ё","Ю":"Ю","Ѹ":"Ѹ","ќ":"ќ","ѓ":"ѓ","Ќ":"Ќ","Ѓ":"Ѓ"},e.isCyrillicCharacter=function(t){return e.cyrillicCharacters.hasOwnProperty(t)},e.translateCharToCyrillic=function(t){return e.isCyrillicCharacter(t)?e.cyrillicCharacters[t]:void 0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.spaceCmds1arg={kern:!0,hskip:!0,hspace:!0,hphantom:!0}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.diacriticsTextMode={"`":!0,"'":!0,"^":!0,"~":!0,"=":!0,".":!0,'"':!0,H:!0,c:!0,k:!0,b:!0,d:!0,r:!0,u:!0,v:!0},e.diacriticsMathMode={hat:!0,widehat:!0,check:!0,tilde:!0,widetilde:!0,acute:!0,grave:!0,dot:!0,ddot:!0,breve:!0,bar:!0,vec:!0,mathring:!0}},function(t,e,n){"use strict";function i(t){var e=t?t.trim():void 0;if(!e)return"√";switch(e){case"2":return"√";case"3":return"∛";case"4":return"∜";default:for(var n=[],i=0;i<e.length;i++){var r=a.translateCharToSuperscript(e.charAt(i));if(!r)throw new Error('Could not translate "'+r+'" to superscript');n.push(r)}return n.join("")+"√"}}function r(t,e){var n=i(e),r=t.trim();return""===r?n:n+"("+r+")"}Object.defineProperty(e,"__esModule",{value:!0});var a=n(38);e.convertSqrtToUnicode=r},function(t,e,n){"use strict";function i(t,e,n){switch(t){case"frac":case"nfrac":case"cfrac":case"xfrac":case"sfrac":return r.convertFracToUnicode(e,n);case"binom":return a.convertBinom(e,n)}throw new Error("No implementation found to expand \\"+t+" with arguments {"+e+", "+n)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(132),a=n(133);e.expand2argsCommand=i},function(t,e,n){"use strict";function i(t,e){return"1"===t&&"2"===e?"½":"1"===t&&"3"===e?"⅓":"1"===t&&"4"===e?"¼":"1"===t&&"5"===e?"⅕":"1"===t&&"6"===e?"⅙":"1"===t&&"8"===e?"⅛":"2"===t&&"3"===e?"⅔":"2"===t&&"5"===e?"⅖":"3"===t&&"4"===e?"¾":"3"===t&&"5"===e?"⅗":"3"===t&&"8"===e?"⅜":"4"===t&&"5"===e?"⅘":"5"===t&&"6"===e?"⅚":"5"===t&&"8"===e?"⅝":"7"===t&&"8"===e?"⅞":o.test(t)&&o.test(e)?a+t+"⁄"+e+a:(t=r.isSingleTerm.test(t)?t:r.addParenthesis(t),e=r.isSingleTerm.test(e)?e:r.addParenthesis(e),"("+t+" / "+e+")")}Object.defineProperty(e,"__esModule",{value:!0});var r=n(10),a="‌",o=/^[0-9]*$/;e.convertFracToUnicode=i},function(t,e,n){"use strict";function i(t,e){return t=a.test(t)?t:r.addParenthesis(t),e=a.test(e)?e:r.addParenthesis(e),"("+t+" ¦ "+e+")"}Object.defineProperty(e,"__esModule",{value:!0});var r=n(10),a=/^.$|^[0-9]+$/;e.convertBinom=i},function(t,e,n){"use strict";function i(t){return e.twoArgsCommands.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=n(135);e.twoArgsCommands=Object.assign({},r.fracCmds,{binom:!0}),e.is2argsCommand=i},function(t,e,n){"use strict";function i(t){return e.fracCmds.hasOwnProperty(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.fracCmds={frac:!0,nfrac:!0,cfrac:!0,xfrac:!0,sfrac:!0},e.isFracCmd=i},function(t,e,n){"use strict";function i(t){return{name:t,optionalArguments:0,argumentCount:0}}Object.defineProperty(e,"__esModule",{value:!0}),e.createKnownCommand=i},function(t,e,n){"use strict";function i(t){return{name:t,optionalArguments:0,argumentCount:1}}Object.defineProperty(e,"__esModule",{value:!0}),e.createKnownCommandWith1Arg=i},function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"toolForm"},[n("div",{staticClass:"toolFormTitle"},[t._v("\n        Citations\n        "),t.viewRender?n("button",{staticClass:"btn btn-xs",attrs:{type:"button",title:"Show all in BibTeX format."},on:{click:t.toggleViewRender}},[n("i",{staticClass:"fa fa-pencil-square-o"}),t._v("\n            Show BibTeX\n        ")]):n("button",{staticClass:"btn btn-xs",attrs:{type:"button",title:"Return to formatted citation list."},on:{click:t.toggleViewRender}},[n("i",{staticClass:"fa fa-times"}),t._v("\n            Hide BibTeX\n        ")])]),t._v(" "),n("div",{staticClass:"citations-bibtex toolFormBody citation-padding"},["histories"===t.source?n("div",{staticClass:"infomessage"},[t._v("\n            When writing up your analysis, remember to include all references that should be cited in order\n            to completely describe your work. Also, please remember to "),n("a",{attrs:{href:"https://galaxyproject.org/citing-galaxy"}},[t._v("cite Galaxy")]),t._v(".\n        ")]):t._e(),t._v(" "),t.viewRender?n("span",{staticClass:"citations-formatted"},[n("p",{domProps:{innerHTML:t._s(t.formattedReferences)}})]):n("textarea",{staticClass:"citations-bibtex-text"},[t._v("            "+t._s(t.content)+"\n        ")])])])},r=[],a={render:i,staticRenderFns:r};e.a=a},,function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(2),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(14),l=r(s),u=n(15),c=r(u),h=n(141),d=(r(h),{hidden:!1,show:function(){this.set("hidden",!1)},hide:function(){this.set("hidden",!0)},toggle:function(){this.set("hidden",!this.get("hidden"))},is_visible:function(){return!this.attributes.hidden}}),f=t.Model.extend({defaults:{name:null,label:null,type:null,value:null,html:null,num_samples:5},initialize:function(t){this.attributes.html=unescape(this.attributes.html)},copy:function(){return new f(this.toJSON())},set_value:function(t){this.set("value",t||"")}}),p=t.Collection.extend({model:f}),_=f.extend({}),g=f.extend({set_value:function(t){this.set("value",parseInt(t,10))},get_samples:function(){return d3.scale.linear().domain([this.get("min"),this.get("max")]).ticks(this.get("num_samples"))}}),v=g.extend({set_value:function(t){this.set("value",parseFloat(t))}}),m=f.extend({get_samples:function(){return o.map(this.get("options"),function(t){return t[0]})}});f.subModelTypes={integer:g,float:v,data:_,select:m};var y=t.Model.extend({defaults:{id:null,name:null,description:null,target:null,inputs:[],outputs:[]},urlRoot:Galaxy.root+"api/tools",initialize:function(t){this.set("inputs",new p(o.map(t.inputs,function(t){return new(f.subModelTypes[t.type]||f)(t)})))},toJSON:function(){var e=t.Model.prototype.toJSON.call(this);return e.inputs=this.get("inputs").map(function(t){return t.toJSON()}),e},remove_inputs:function(t){var e=this,n=e.get("inputs").filter(function(e){return-1!==t.indexOf(e.get("type"))});e.get("inputs").remove(n)},copy:function(e){var n=new y(this.toJSON());if(e){var i=new t.Collection;n.get("inputs").each(function(t){t.get_samples()&&i.push(t)}),n.set("inputs",i)}return n},apply_search_results:function(t){return-1!==o.indexOf(t,this.attributes.id)?this.show():this.hide(),this.is_visible()},set_input_value:function(t,e){this.get("inputs").find(function(e){return e.get("name")===t}).set("value",e)},set_input_values:function(t){var e=this;o.each(o.keys(t),function(n){e.set_input_value(n,t[n])})},run:function(){return this._run()},rerun:function(t,e){return this._run({action:"rerun",target_dataset_id:t.id,regions:e})},get_inputs_dict:function(){var t={};return this.get("inputs").each(function(e){t[e.get("name")]=e.get("value")}),t},_run:function(t){var e=o.extend({tool_id:this.id,inputs:this.get_inputs_dict()},t),n=i.Deferred(),r=new l.default.ServerStateDeferred({ajax_settings:{url:this.urlRoot,data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});return i.when(r.go()).then(function(t){n.resolve(new c.default.DatasetCollection(t))}),n}});o.extend(y.prototype,d);var b=(t.View.extend({}),t.Collection.extend({model:y})),w=t.Model.extend(d),x=t.Model.extend({defaults:{elems:[],open:!1},clear_search_results:function(){o.each(this.attributes.elems,function(t){t.show()}),this.show(),this.set("open",!1)},apply_search_results:function(t){var e,n=!0;o.each(this.attributes.elems,function(i){i instanceof w?(e=i,e.hide()):i instanceof y&&i.apply_search_results(t)&&(n=!1,e&&e.show())}),n?this.hide():(this.show(),this.set("open",!0))}});o.extend(x.prototype,d);var k=t.Model.extend({defaults:{search_hint_string:"search tools",min_chars_for_search:3,clear_btn_url:"",visible:!0,query:"",results:null,clear_key:27},urlRoot:Galaxy.root+"api/tools",initialize:function(){this.on("change:query",this.do_search)},do_search:function(){var t=this.attributes.query;if(t.length<this.attributes.min_chars_for_search)return void this.set("results",null);var e=t;this.timer&&clearTimeout(this.timer),i("#search-clear-btn").hide(),i("#search-spinner").show();var n=this;this.timer=setTimeout(function(){"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"?q="+e),i.get(n.urlRoot,{q:e},function(t){n.set("results",t),i("#search-spinner").hide(),i("#search-clear-btn").show()},"json")},400)},clear_search:function(){this.set("query",""),this.set("results",null)}});o.extend(k.prototype,d);var C=t.Model.extend({initialize:function(e){this.attributes.tool_search=e.tool_search,this.attributes.tool_search.on("change:results",this.apply_search_results,this),this.attributes.tools=e.tools,this.attributes.layout=new t.Collection(this.parse(e.layout))},parse:function(t){var e=this,n=function t(n){var i=n.model_class;if(i.indexOf("Tool")===i.length-4)return e.attributes.tools.get(n.id);if("ToolSection"===i){var r=o.map(n.elems,t);return n.elems=r,new x(n)}return"ToolSectionLabel"===i?new w(n):void 0};return o.map(t,n)},clear_search_results:function(){this.get("layout").each(function(t){t instanceof x?t.clear_search_results():t.show()})},apply_search_results:function(){var t=this.get("tool_search").get("results");if(null===t)return void this.clear_search_results();var e=null;this.get("layout").each(function(n){n instanceof w?(e=n,e.hide()):n instanceof y?n.apply_search_results(t)&&e&&e.show():(e=null,n.apply_search_results(t))})}}),M=t.View.extend({initialize:function(){this.model.on("change:hidden",this.update_visible,this),this.update_visible()},update_visible:function(){this.model.attributes.hidden?this.$el.hide():this.$el.show()}}),S=M.extend({tagName:"div",render:function(){var t=i("<div/>");t.append(z.tool_link(this.model.toJSON()));var e=this.model.get("form_style",null);if("upload1"===this.model.id)t.find("a").on("click",function(t){t.preventDefault(),Galaxy.upload.show()});else if("regular"===e){var n=this;t.find("a").on("click",function(t){t.preventDefault(),Galaxy.router.push("/",{tool_id:n.model.id,version:n.model.get("version")})})}return this.$el.append(t),this}}),T=M.extend({tagName:"div",className:"toolPanelLabel",render:function(){return this.$el.append(i("<span/>").text(this.model.attributes.text)),this}}),$=M.extend({tagName:"div",className:"toolSectionWrapper",initialize:function(){M.prototype.initialize.call(this),this.model.on("change:open",this.update_open,this)},render:function(){this.$el.append(z.panel_section(this.model.toJSON()));var t=this.$el.find(".toolSectionBody");return o.each(this.model.attributes.elems,function(e){if(e instanceof y){var n=new S({model:e,className:"toolTitle"});n.render(),t.append(n.$el)}else if(e instanceof w){var i=new T({model:e});i.render(),t.append(i.$el)}}),this},events:{"click .toolSectionTitle > a":"toggle"},toggle:function(){this.model.set("open",!this.model.attributes.open)},update_open:function(){this.model.attributes.open?this.$el.children(".toolSectionBody").slideDown("fast"):this.$el.children(".toolSectionBody").slideUp("fast")}}),A=t.View.extend({tagName:"div",id:"tool-search",className:"bar",events:{click:"focus_and_select","keyup :input":"query_changed","change :input":"query_changed","click #search-clear-btn":"clear"},render:function(){return this.$el.append(z.tool_search(this.model.toJSON())),this.model.is_visible()||this.$el.hide(),i("#messagebox").is(":visible")&&this.$el.css("top","95px"),this.$el.find("[title]").tooltip(),this},focus_and_select:function(){this.$el.find(":input").focus().select()},clear:function(){return this.model.clear_search(),this.$el.find(":input").val(""),this.focus_and_select(),!1},query_changed:function(t){if(this.model.attributes.clear_key&&this.model.attributes.clear_key===t.which)return this.clear(),!1;this.model.set("query",this.$el.find(":input").val())}}),E=t.View.extend({tagName:"div",className:"toolMenu",initialize:function(){this.model.get("tool_search").on("change:results",this.handle_search_results,this)},render:function(){var t=this,e=new A({model:this.model.get("tool_search")});return e.render(),t.$el.append(e.$el),this.model.get("layout").each(function(e){if(e instanceof x){var n=new $({model:e});n.render(),t.$el.append(n.$el)}else if(e instanceof y){var i=new S({model:e,className:"toolTitleNoSection"});i.render(),t.$el.append(i.$el)}else if(e instanceof w){var r=new T({model:e});r.render(),t.$el.append(r.$el)}}),t.$el.find("a.tool-link").click(function(e){var n=i(this).attr("class").split(/\s+/)[0],r=t.model.get("tools").get(n);t.trigger("tool_link_click",e,r)}),this},handle_search_results:function(){var t=this.model.get("tool_search").get("results");t&&0===t.length?i("#search-no-results").show():i("#search-no-results").hide()}}),O=t.View.extend({className:"toolForm",render:function(){this.$el.children().remove(),this.$el.append(z.tool_form(this.model.toJSON()))}}),z=(t.View.extend({className:"toolMenuAndView",initialize:function(){this.tool_panel_view=new E({collection:this.collection}),this.tool_form_view=new O},render:function(){this.tool_panel_view.render(),this.tool_panel_view.$el.css("float","left"),this.$el.append(this.tool_panel_view.$el),this.tool_form_view.$el.hide(),this.$el.append(this.tool_form_view.$el);var t=this;this.tool_panel_view.on("tool_link_click",function(e,n){e.preventDefault(),t.show_tool(n)})},show_tool:function(t){var e=this;t.fetch().done(function(){e.tool_form_view.model=t,e.tool_form_view.render(),e.tool_form_view.$el.show(),i("#left").width("650px")})}}),{tool_search:o.template(['<input id="tool-search-query" class="search-query parent-width" name="query" ','placeholder="<%- search_hint_string %>" autocomplete="off" type="text" />','<a id="search-clear-btn" title="clear search (esc)"> </a>','<span id="search-spinner" class="search-spinner fa fa-spinner fa-spin"></span>'].join("")),panel_section:o.template(['<div class="toolSectionTitle" id="title_<%- id %>">','<a href="javascript:void(0)"><span><%- name %></span></a>',"</div>",'<div id="<%- id %>" class="toolSectionBody" style="display: none;">','<div class="toolSectionBg"></div>',"<div>"].join("")),tool_link:o.template(['<a class="<%- id %> tool-link" href="<%= link %>" target="<%- target %>" minsizehint="<%- min_width %>">','<span class="labels">',"<% _.each( labels, function( label ){ %>",'<span class="label label-default label-<%- label %>">',"<%- label %>","</span>","<% }); %>","</span>",'<span class="tool-old-link">',"<%- name %>","</span>"," <%- description %>","</a>"].join("")),tool_form:o.template(['<div class="toolFormTitle"><%- tool.name %> (version <%- tool.version %>)</div>','<div class="toolFormBody">',"<% _.each( tool.inputs, function( input ){ %>",'<div class="form-row">','<label for="<%- input.name %>"><%- input.label %>:</label>','<div class="form-row-input">',"<%= input.html %>","</div>",'<div class="toolParamHelp" style="clear: both;">',"<%- input.help %>","</div>",'<div style="clear: both;"></div>',"</div>","<% }); %>","</div>",'<div class="form-row form-actions">','<input type="submit" class="btn btn-primary" name="runtool_btn" value="Execute" />',"</div>",'<div class="toolHelp">','<div class="toolHelpBody"><% tool.help %></div>',"</div>"].join(""),{variable:"tool"})});e.default={ToolParameter:f,IntegerToolParameter:g,SelectToolParameter:m,Tool:y,ToolCollection:b,ToolSearch:k,ToolPanel:C,ToolPanelView:E,ToolFormView:O}}).call(e,n(1),n(0))},function(t,e,n){"use strict";(function(t,i,r){function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var o=n(3),s=a(o),l=n(4),u=a(l),c=n(9),h=a(c),d=n(60),f=a(d),p=n(40),_=a(p),g=t.View.extend({initialize:function(t){var e=this;this.modal=parent.Galaxy.modal||new h.default.View,this.form=new f.default(s.default.merge({listen_to_history:!0,always_refresh:!1,buildmodel:function(t,n){var r=n.model.attributes,a="",o={},l=r.job_id;l?a=Galaxy.root+"api/jobs/"+l+"/build_for_rerun":(a=Galaxy.root+"api/tools/"+r.id+"/build",o=i.extend({},Galaxy.params),o.tool_id&&delete o.tool_id),r.version&&(o.tool_version=r.version),s.default.get({url:a,data:o,success:function(i){if(!i.display)return void(window.location=Galaxy.root);n.model.set(i),e._customize(n),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model ready.",i),t.resolve()},error:function(e,a){var o=e&&e.err_msg||"Uncaught error.";401==a?window.location=Galaxy.root+"user/login?"+i.param({redirect:Galaxy.root+"?tool_id="+r.id}):n.$el.is(":empty")?n.$el.prepend(new u.default.Message({message:o,status:"danger",persistent:!0,large:!0}).$el):Galaxy.modal&&Galaxy.modal.show({title:"Tool request failed",body:o,buttons:{Close:function(){Galaxy.modal.hide()}}}),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model request failed.",e),t.reject()}})},postchange:function(t,e){var n={tool_id:e.model.get("id"),tool_version:e.model.get("version"),inputs:i.extend(!0,{},e.data.create())};e.wait(!0),Galaxy.emit.debug("tool-form::postchange()","Sending current state.",n),s.default.request({type:"POST",url:Galaxy.root+"api/tools/"+e.model.get("id")+"/build",data:n,success:function(n){e.update(n),e.wait(!1),Galaxy.emit.debug("tool-form::postchange()","Received new model.",n),t.resolve()},error:function(e){Galaxy.emit.debug("tool-form::postchange()","Refresh request failed.",e),t.reject()}})}},t)),this.deferred=this.form.deferred,this.setElement("<div/>"),this.$el.append(this.form.$el)},_customize:function(t){var e=this,n=t.model.attributes,i=new u.default.Button({icon:"fa-check",tooltip:"Execute: "+n.name+" ("+n.version+")",title:"Execute",cls:"btn btn-primary ui-clear-float",wait_cls:"btn btn-info ui-clear-float",onclick:function(){i.wait(),t.portlet.disable(),e.submit(n,function(){i.unwait(),t.portlet.enable()})}});n.buttons={execute:i},n.job_id&&n.job_remap&&n.inputs.push({label:"Resume dependencies from this job",name:"rerun_remap_job_id",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["Yes",n.job_id],["No","__ignore__"]],help:"The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run."})},submit:function(t,e){var n=this,a={tool_id:t.id,tool_version:t.version,inputs:this.form.data.create()};if(this.form.trigger("reset"),!n.validate(a))return Galaxy.emit.debug("tool-form::submit()","Submission canceled. Validation failed."),void(e&&e());if(t.action!==Galaxy.root+"tool_runner/index"){var o=i("<form/>").attr({action:t.action,method:t.method,enctype:t.enctype});return r.each(a.inputs,function(t,e){o.append(i("<input/>").attr({name:e,value:t}))}),o.hide().appendTo("body").submit().remove(),void(e&&e())}Galaxy.emit.debug("tool-form::submit()","Validation complete.",a),s.default.request({type:"POST",url:Galaxy.root+"api/tools",data:a,success:function(t){if(e&&e(),n.$el.children().hide(),n.$el.append(n._templateSuccess(t)),t.jobs&&t.jobs.length>0){n.$el.append(i("<div/>",{id:"webhook-view"}));new _.default.WebhookView({urlRoot:Galaxy.root+"api/webhooks/tool",toolId:a.tool_id})}parent.Galaxy&&parent.Galaxy.currHistoryPanel&&parent.Galaxy.currHistoryPanel.refreshContents()},error:function(t){e&&e(),Galaxy.emit.debug("tool-form::submit","Submission failed.",t);var i=!1;if(t&&t.err_data){var r=n.form.data.matchResponse(t.err_data);for(var o in r){n.form.highlight(o,r[o]),i=!0;break}}i||n.modal.show({title:"Job submission failed",body:n._templateError(a,t&&t.err_msg),buttons:{Close:function(){n.modal.hide()}}})}})},validate:function(t){var e=t.inputs,n=-1,i=null;for(var r in e){var a=e[r],o=this.form.data.match(r),s=this.form.field_list[o],l=this.form.input_list[o];if(o&&l&&s){if(!l.optional&&null==a)return this.form.highlight(o),!1;if(a&&a.batch){var u=a.values.length,c=u>0&&a.values[0]&&a.values[0].src;if(c)if(null===i)i=c;else if(i!==c)return this.form.highlight(o,"Please select either dataset or dataset list fields for all batch mode fields."),!1;if(-1===n)n=u;else if(n!==u)return this.form.highlight(o,"Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>"+u+"</b> selection(s) while a previous field contains <b>"+n+"</b>."),!1}}else Galaxy.emit.debug("tool-form::validate()","Retrieving input objects failed.")}return!0},_templateSuccess:function(t){if(t.jobs&&t.jobs.length>0){var e=t.jobs.length,n=1==e?"1 job has":e+" jobs have",a=i("<div/>").addClass("donemessagelarge").append(i("<p/>").text(n+" been successfully added to the queue - resulting in the following datasets:"));return r.each(t.outputs,function(t){a.append(i("<p/>").addClass("messagerow").append(i("<b/>").text(t.hid+": "+t.name)))}),a.append(i("<p/>").append("<b/>").text("You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.")),a}return this._templateError(t,"Invalid success response. No jobs found.")},_templateError:function(t,e){return i("<div/>").addClass("errormessagelarge").append(i("<p/>").text("The server could not complete the request. Please contact the Galaxy Team if this error persists. "+(e||""))).append(i("<pre/>").text(JSON.stringify(t,null,4)))}});e.default={View:g}}).call(e,n(1),n(0),n(2))},,function(t,e,n){"use strict";(function(t,n,i){Object.defineProperty(e,"__esModule",{value:!0}),e.default=t.Model.extend({defaults:{url_base:"",async:!1,async_ops:[],categorical_filters:[],filters:{},sort_key:null,show_item_checkboxes:!1,advanced_search:!1,cur_page:1,num_pages:1,operation:void 0,item_ids:void 0},can_async_op:function(t){return-1!==n.indexOf(this.attributes.async_ops,t)},add_filter:function(t,e,n){if(n){var i,r=this.attributes.filters[t];if(null===r||void 0===r)i=e;else if("string"==typeof r)if("All"==r||r==e)i=e;else{var a=[];a[0]=r,a[1]=e,i=a}else i=r,-1===i.indexOf(e)&&i.push(e);this.attributes.filters[t]=i}else this.attributes.filters[t]=e},remove_filter:function(t,e){var i=this.attributes.filters[t];if(null===i||void 0===i)return!1;if("string"==typeof i)this.attributes.filters[t]="";else{var r=n.indexOf(i,e);-1!==r&&(i[r]="")}},get_url_data:function(){var t={async:this.attributes.async,sort:this.attributes.sort_key,page:this.attributes.cur_page,show_item_checkboxes:this.attributes.show_item_checkboxes,advanced_search:this.attributes.advanced_search};this.attributes.operation&&(t.operation=this.attributes.operation),this.attributes.item_ids&&(t.id=this.attributes.item_ids);var e=this;return n.each(n.pairs(e.attributes.filters),function(e){t["f-"+e[0]]=e[1]}),t},get_url:function(t){return this.get("url_base")+"?"+i.param(this.get_url_data())+"&"+i.param(t)}})}).call(e,n(1),n(2),n(0))},function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(3),a=function(t){return t&&t.__esModule?t:{default:t}}(r);e.default={grid:function(t){var e="";return e=t.embedded?this.grid_header(t)+this.grid_table(t):'<div class="loading-elt-overlay"></div><table><tr><td width="75%">'+this.grid_header(t)+'</td><td></td><td></td></tr><tr><td width="100%" id="grid-message" valign="top"></td><td></td><td></td></tr></table>'+this.grid_table(t),t.info_text&&(e+='<br><div class="toolParamHelp" style="clear: both;">'+t.info_text+"</div>"),e},grid_table:function(t){return'<form method="post" onsubmit="return false;"><table id="grid-table" class="grid"><thead id="grid-table-header"></thead><tbody id="grid-table-body"></tbody><tfoot id="grid-table-footer"></tfoot></table></form>'},grid_header:function(t){var e='<div class="grid-header">';if(t.embedded||(e+="<h2>"+t.title+"</h2>"),t.global_actions){e+='<ul class="manage-table-actions">';var n=t.global_actions.length>=3;n&&(e+='<li><a class="action-button" id="popup-global-actions" class="menubutton">Actions</a></li><div popupmenu="popup-global-actions">');for(var i in t.global_actions){var r=t.global_actions[i];e+='<li><a class="action-button use-target" target="'+r.target+'" href="'+r.url_args+'" onclick="return false;" >'+r.label+"</a></li>"}n&&(e+="</div>"),e+="</ul>"}return t.insert&&(e+=t.insert),e+=this.grid_filters(t),e+="</div>"},header:function(t){var e="<tr>";t.show_item_checkboxes&&(e+="<th>",t.items.length>0&&(e+='<input type="checkbox" id="check_all" name=select_all_checkbox value="true"><input type="hidden" name=select_all_checkbox value="true">'),e+="</th>");for(var n in t.columns){var i=t.columns[n];i.visible&&(e+='<th id="'+i.key+'-header">',i.href?e+='<a href="'+i.href+'" class="sort-link" sort_key="'+i.key+'">'+i.label+"</a>":e+=i.label,e+='<span class="sort-arrow">'+i.extra+"</span></th>")}return e+="</tr>"},body:function(e){var n="",i=0;0==e.items.length&&(n+='<tr><td colspan="100"><em>No Items</em></td></tr>',i=1);for(var r in e.items){var a=e.items[r],o=a.encode_id;n+="<tr ",e.current_item_id==a.id&&(n+='class="current"'),n+=">",e.show_item_checkboxes&&(n+='<td style="width: 1.5em;"><input type="checkbox" name="id" value="'+o+'" id="'+o+'" class="grid-row-select-checkbox" /></td>');for(var s in e.columns){var l=e.columns[s];if(l.visible){var u="";l.nowrap&&(u='style="white-space:nowrap;"');var c=a.column_config[l.label],h=c.link,d=c.value,f=c.target;"string"===t.type(d)&&(d=d.replace(/\/\//g,"/"));var p="",_="";l.attach_popup&&(p="grid-"+r+"-popup",_="menubutton",""!=h&&(_+=" split"),_+=" popup"),n+="<td "+u+">",h?(0!=e.operations.length&&(n+='<div id="'+p+'" class="'+_+'" style="float: left;">'),n+='<a class="menubutton-label use-target" target="'+f+'" href="'+h+'" onclick="return false;">'+d+"</a>",0!=e.operations.length&&(n+="</div>")):n+='<div id="'+p+'" class="'+_+'"><label id="'+l.label_id_prefix+o+'" for="'+o+'">'+(d||"")+"</label></div>",n+="</td>"}}n+="</tr>",i++}return n},footer:function(t){var e="";if(t.use_paging&&t.num_pages>1){var n=t.num_page_links,i=t.cur_page_num,r=t.num_pages,a=n/2,o=i-a,s=0;o<=0&&(o=1,s=a-(i-o));var l,u=a+s,c=i+u;c<=r?l=0:(c=r,l=u-(c+1-i)),0!=l&&(o-=l)<1&&(o=1),e+='<tr id="page-links-row">',t.show_item_checkboxes&&(e+="<td></td>"),e+='<td colspan="100"><span id="page-link-container">Page:',o>1&&(e+='<span class="page-link" id="page-link-1"><a href="javascript:void(0);" page_num="1" onclick="return false;">1</a></span> ...');for(var h=o;h<c+1;h++)h==t.cur_page_num?e+='<span class="page-link inactive-link" id="page-link-'+h+'">'+h+"</span>":e+='<span class="page-link" id="page-link-'+h+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+h+'">'+h+"</a></span>";c<r&&(e+='...<span class="page-link" id="page-link-'+r+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+r+'">'+r+"</a></span>"),e+="</span>",e+='<span class="page-link" id="show-all-link-span"> | <a href="javascript:void(0);" onclick="return false;" page_num="all">Show All</a></span></td></tr>'}if(t.show_item_checkboxes){e+='<tr><input type="hidden" id="operation" name="operation" value=""><td></td><td colspan="100">For <span class="grid-selected-count"></span> selected items: ';for(var d in t.operations){var f=t.operations[d];f.allow_multiple&&(e+='<input type="button" value="'+f.label+'" class="operation-button action-button">&nbsp;')}e+="</td></tr>"}var p=!1;for(d in t.operations)if(t.operations[d].global_operation){p=!0;break}if(p){e+='<tr><td colspan="100">';for(d in t.operations){var f=t.operations[d];f.global_operation&&(e+='<a class="action-button" href="'+f.global_operation+'">'+f.label+"</a>")}e+="</td></tr>"}return t.legend&&(e+='<tr><td colspan="100">'+t.legend+"</td></tr>"),e},message:function(t){var e=t.status;return-1!=["success","ok"].indexOf(e)&&(e="done"),'<p><div class="'+e+'message transient-message">'+i.escape(t.message)+'</div><div style="clear: both"></div></p>'},grid_filters:function(t){var e=t.default_filter_dict,n=t.filters,i="none";t.advanced_search&&(i="block");var r=!1;for(var a in t.columns){var o=t.columns[a];if("advanced"==o.filterable){var s=o.key,l=n[s],u=e[s];l&&u&&l!=u&&(i="block"),r=!0}}var c="block";"block"==i&&(c="none");var h='<div id="standard-search" style="display: '+c+';"><table><tr><td style="padding: 0;"><table>';for(var a in t.columns){var o=t.columns[a];"standard"==o.filterable&&(h+=this.grid_column_filter(t,o))}h+="</table></td></tr><tr><td>",r&&(h+='<a href="" class="advanced-search-toggle">Advanced Search</a>'),h+="</td></tr></table></div>",h+='<div id="advanced-search" style="display: '+i+'; margin-top: 5px; border: 1px solid #ccc;"><table><tr><td style="text-align: left" colspan="100"><a href="" class="advanced-search-toggle">Close Advanced Search</a></td></tr>';for(var a in t.columns){var o=t.columns[a];"advanced"==o.filterable&&(h+=this.grid_column_filter(t,o))}return h+="</table></div>"},grid_column_filter:function(e,n){var i=(e.default_filter_dict,e.filters),r=n.label,a=n.key;"advanced"==n.filterable&&(r=r.toLowerCase());var o="<tr>";if("advanced"==n.filterable&&(o+='<td align="left" style="padding-left: 10px">'+r+":</td>"),o+='<td style="padding-bottom: 1px;">',n.is_text){o+='<form class="text-filter-form" column_key="'+a+'" action="'+e.url+'" method="get" >';for(h in e.columns){var s=e.columns[h],l=i[s.key];l&&"All"!=l&&(s.is_text&&(l=JSON.stringify(l)),o+='<input type="hidden" id="'+s.key+'" name="f-'+s.key+'" value="'+l+'"/>')}o+='<span id="'+a+'-filtering-criteria">';var u=i[a];if(u){var c=t.type(u);if("string"==c&&"All"!=u&&(o+=this.filter_element(a,u)),"array"==c)for(var h in u){var d=u[h],f=u;f=f.slice(h),o+=this.filter_element(a,d)}}o+="</span>";var p="";if("standard"==n.filterable){p=n.label.toLowerCase();var _=p.length;_<20&&(_=20),_+=4}o+='<span class="search-box"><input class="search-box-input" id="input-'+a+'-filter" name="f-'+a+'" type="text" placeholder="'+p+'" size="'+_+'"/><button type="submit" style="background: transparent; border: none; padding: 4px; margin: 0px;"><i class="fa fa-search"></i></button></span></form>'}else{o+='<span id="'+a+'-filtering-criteria">';var g=!1;for(var v in e.categorical_filters[a]){var m=e.categorical_filters[a][v],y="",b="";for(var w in m)y=w,b=m[w];g&&(o+=" | "),g=!0;var d=i[a];d&&m[a]&&d==b?o+='<span class="categorical-filter '+a+'-filter current-filter">'+v+"</span>":o+='<span class="categorical-filter '+a+'-filter"><a href="javascript:void(0);" filter_key="'+y+'" filter_val="'+b+'">'+v+"</a></span>"}o+="</span>"}return o+="</td></tr>"},filter_element:function(t,e){return'<span class="text-filter-val">'+(e=a.default.sanitize(e))+'<a href="javascript:void(0);" filter_key="'+t+'" filter_val="'+e+'"><i class="fa fa-times" style="padding-left: 5px; padding-bottom: 6px;"/></a></span>'}}}).call(e,n(0),n(2))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=n(2),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=n(146),l=r(s),u=n(13),c=r(u),h=n(41),d=r(h),f=n(58),p=r(f),_=n(26),g=r(_),v=n(3),m=r(v);n(170),n(169),n(171),n(157),n(174),n(159),n(172),n(173),n(25);var y=null,b=null,w=function(){this.initialize&&this.initialize.apply(this,arguments)};w.extend=t.Model.extend;var x=w.extend({initialize:function(t){m.default.cssLoadFile("static/style/jquery.rating.css"),m.default.cssLoadFile("static/style/autocomplete_tagging.css"),m.default.cssLoadFile("static/style/jquery-ui/smoothness/jquery-ui.css"),m.default.cssLoadFile("static/style/library.css"),m.default.cssLoadFile("static/style/trackster.css"),this.baseURL=t},save_viz:function(){Galaxy.modal.show({title:"Saving...",body:"progress"});var t=[];i(".bookmark").each(function(){t.push({position:i(this).children(".position").text(),annotation:i(this).children(".annotation").text()})});var e=b.overview_drawable?b.overview_drawable.config.get_value("name"):null,n={view:b.to_dict(),viewport:{chrom:b.chrom,start:b.low,end:b.high,overview:e},bookmarks:t};return i.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:b.vis_id,title:b.config.get_value("name"),dbkey:b.dbkey,type:"trackster",vis_json:JSON.stringify(n)}}).success(function(t){Galaxy.modal.hide(),b.vis_id=t.vis_id,b.has_changes=!1,window.history.pushState({},"",t.url+window.location.hash)}).error(function(){Galaxy.modal.show({title:"Could Not Save",body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})},createButtonMenu:function(){var t=this,e=d.default.create_icon_buttons_menu([{icon_class:"plus-button",title:"Add tracks",on_click:function(){c.default.select_datasets({dbkey:b.dbkey},function(t){o.each(t,function(t){b.add_drawable(l.default.object_from_template(t,b,b))})})}},{icon_class:"block--plus",title:"Add group",on_click:function(){b.add_drawable(new l.default.DrawableGroup(b,b,{name:"New Group"}))}},{icon_class:"bookmarks",title:"Bookmarks",on_click:function(){force_right_panel("0px"==i("div#right").css("right")?"hide":"show")}},{icon_class:"globe",title:"Circster",on_click:function(){window.location=t.baseURL+"visualization/circster?id="+b.vis_id}},{icon_class:"disk--arrow",title:"Save",on_click:function(){t.save_viz()}},{icon_class:"cross-circle",title:"Close",on_click:function(){t.handle_unsaved_changes(b)}}],{tooltip_config:{placement:"bottom"}});return this.buttonMenu=e,e},add_bookmark:function(t,e,n){var r=i("#right .unified-panel-body"),a=i("<div/>").addClass("bookmark").appendTo(r),o=i("<div/>").addClass("position").appendTo(a),s=(i("<a href=''/>").text(t).appendTo(o).click(function(){return b.go_to(t),!1}),i("<div/>").text(e).appendTo(a));if(n){var l=i("<div/>").addClass("delete-icon-container").prependTo(a).click(function(){return a.slideUp("fast"),a.remove(),b.has_changes=!0,!1});i("<a href=''/>").addClass("icon-button delete").appendTo(l);s.make_text_editable({num_rows:3,use_textarea:!0,help_text:"Edit bookmark note"}).addClass("annotation")}return b.has_changes=!0,a},create_visualization:function(t,e,n,r,a){var s=this,u=new l.default.TracksterView(o.extend(t,{header:!1}));return u.editor=!0,i.when(u.load_chroms_deferred).then(function(t){if(e){var i=e.chrom,o=e.start,c=e.end,h=e.overview;i&&void 0!==o&&c?u.change_chrom(i,o,c):u.change_chrom(t[0].chrom)}else u.change_chrom(t[0].chrom);if(n)for(var d=0;d<n.length;d++)u.add_drawable(l.default.object_from_template(n[d],u,u));for(var d=0;d<u.drawables.length;d++)if(u.drawables[d].config.get_value("name")===h){u.set_overview(u.drawables[d]);break}if(r)for(var f,d=0;d<r.length;d++)f=r[d],s.add_bookmark(f.position,f.annotation,a);u.has_changes=!1}),this.set_up_router({view:u}),u},set_up_router:function(e){new c.default.TrackBrowserRouter(e),t.history.start()},init_keyboard_nav:function(t){i(document).keyup(function(e){if(!i(e.srcElement).is(":input"))switch(e.which){case 37:t.move_fraction(.25);break;case 38:Math.round(t.viewport_container.height()/15);t.viewport_container.scrollTop(t.viewport_container.scrollTop()-20);break;case 39:t.move_fraction(-.25);break;case 40:Math.round(t.viewport_container.height()/15);t.viewport_container.scrollTop(t.viewport_container.scrollTop()+20)}})},handle_unsaved_changes:function(t){if(t.has_changes){var e=this;Galaxy.modal.show({title:"Close visualization",body:"There are unsaved changes to your visualization which will be lost if you do not save them.",buttons:{Cancel:function(){Galaxy.modal.hide()},"Leave without Saving":function(){i(window).off("beforeunload"),window.location=Galaxy.root+"visualization"},Save:function(){i.when(e.save_viz()).then(function(){window.location=Galaxy.root+"visualization"})}}})}else window.location=Galaxy.root+"visualization"}}),k=t.View.extend({initialize:function(){y=new x(Galaxy.root),y.createButtonMenu(),y.buttonMenu.$el.attr("style","float: right"),i("#center .unified-panel-header-inner").append(y.buttonMenu.$el),i("#right .unified-panel-title").append("Bookmarks"),i("#right .unified-panel-icons").append("<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>"),i("#right-border").click(function(){b.resize_window()}),force_right_panel("hide"),galaxy_config.app.id?this.view_existing():p.default.get("dataset_id")?this.choose_existing_or_new():this.view_new()},choose_existing_or_new:function(){var t=this,e=p.default.get("dbkey"),n={},i={dbkey:e,dataset_id:p.default.get("dataset_id"),hda_ldda:p.default.get("hda_ldda"),gene_region:p.default.get("gene_region")};e&&(n["f-dbkey"]=e),Galaxy.modal.show({title:"View Data in a New or Saved Visualization?",body:"<p><ul style='list-style: disc inside none'>You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>"+(e||"Not available.")+"</b></li><li>or create a new session with this dataset as the only track</li></ul></p>",buttons:{Cancel:function(){window.location=Galaxy.root+"visualizations/list"},"View in saved visualization":function(){t.view_in_saved(i)},"View in new visualization":function(){t.view_new()}}})},view_in_saved:function(t){var e=new g.default({url_base:Galaxy.root+"visualization/list_tracks",dict_format:!0,embedded:!0});Galaxy.modal.show({title:"Add Data to Saved Visualization",body:e.$el,buttons:{Cancel:function(){window.location=Galaxy.root+"visualizations/list"},"Add to visualization":function(){i(parent.document).find("input[name=id]:checked").each(function(){t.id=i(this).val(),window.location=Galaxy.root+"visualization/trackster?"+i.param(t)})}}})},view_existing:function(){var t=galaxy_config.app.viz_config;b=y.create_visualization({container:i("#center .unified-panel-body"),name:t.title,vis_id:t.vis_id,dbkey:t.dbkey},t.viewport,t.tracks,t.bookmarks,!0),this.init_editor()},view_new:function(){var t=this;i.ajax({url:Galaxy.root+"api/genomes?chrom_info=True",data:{},error:function(){alert("Couldn't create new browser.")},success:function(e){Galaxy.modal.show({title:"New Visualization",body:t.template_view_new(e),buttons:{Cancel:function(){window.location=Galaxy.root+"visualizations/list"},Create:function(){t.create_browser(i("#new-title").val(),i("#new-dbkey").val()),Galaxy.modal.hide()}}});var n=e.map(function(t){return t[1]});galaxy_config.app.default_dbkey&&o.contains(n,galaxy_config.app.default_dbkey)&&i("#new-dbkey").val(galaxy_config.app.default_dbkey),i("#new-title").focus(),i("select[name='dbkey']").select2(),i("#overlay").css("overflow","auto")}})},template_view_new:function(t){for(var e='<form id="new-browser-form" action="javascript:void(0);" method="post" onsubmit="return false;"><div class="form-row"><label for="new-title">Browser name:</label><div class="form-row-input"><input type="text" name="title" id="new-title" value="Unnamed"></input></div><div style="clear: both;"></div></div><div class="form-row"><label for="new-dbkey">Reference genome build (dbkey): </label><div class="form-row-input"><select name="dbkey" id="new-dbkey">',n=0;n<t.length;n++)e+='<option value="'+t[n][1]+'">'+t[n][0]+"</option>";return e+='</select></div><div style="clear: both;"></div></div><div class="form-row">Is the build not listed here? <a href="'+Galaxy.root+'user/dbkeys?use_panels=True">Add a Custom Build</a></div></form>'},create_browser:function(t,e){i(document).trigger("convert_to_values"),b=y.create_visualization({container:i("#center .unified-panel-body"),name:t,dbkey:e},galaxy_config.app.gene_region),this.init_editor(),b.editor=!0},init_editor:function(){i("#center .unified-panel-title").text(b.config.get_value("name")+" ("+b.dbkey+")"),galaxy_config.app.add_dataset&&i.ajax({url:Galaxy.root+"api/datasets/"+galaxy_config.app.add_dataset,data:{hda_ldda:"hda",data_type:"track_config"},dataType:"json",success:function(t){b.add_drawable(l.default.object_from_template(t,b,b))}}),i("#add-bookmark-button").click(function(){var t=b.chrom+":"+b.low+"-"+b.high;return y.add_bookmark(t,"Bookmark description",!0)}),y.init_keyboard_nav(b),i(window).on("beforeunload",function(){if(b.has_changes)return"There are unsaved changes to your visualization that will be lost if you leave this page."})}});e.default={TracksterUI:x,GalaxyApp:k}}).call(e,n(1),n(0))},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e){e||(e=0);var n=Math.pow(10,e);return Math.round(t*n)/n}function o(e){var n=t.Deferred();return t.ajax({type:"HEAD",url:e,beforeSend:function(t){t.setRequestHeader("Range","bytes=0-10")},success:function(t,e,i){n.resolve(206===i.status)}}),n}Object.defineProperty(e,"__esModule",{value:!0});var s=n(2),l=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(s),u=n(13),c=r(u),h=n(147),d=r(h),f=n(14),p=r(f),_=n(148),g=r(_),v=n(149),m=r(v),y=n(150),b=r(y),w=n(15),x=r(w),k=n(140),C=r(k),M=n(21),S=r(M),T=n(151),$=r(T);n(25);var A=l.extend,E={},O=function(t,e){E[t.attr("id")]=e},z=function(e,n,i,r){i=".group",E[e.attr("id")]=r,e.bind("drag",{handle:"."+n,relative:!0},function(e,n){var r,a,o,s,l,u=(t(this),t(this).parent()),c=u.children(".track,.group"),h=E[t(this).attr("id")];if(a=t(this).parents(i),0!==a.length){o=a.position().top,s=o+a.outerHeight();var d=E[a.attr("id")];if(n.offsetY<o)return t(this).insertBefore(a),d.remove_drawable(h),void d.container.add_drawable_before(h,d);if(n.offsetY>s)return t(this).insertAfter(a),d.remove_drawable(h),void d.container.add_drawable(h)}for(a=null,l=0;l<c.length;l++)if(r=t(c.get(l)),o=r.position().top,s=o+r.outerHeight(),r.is(i)&&this!==r.get(0)&&n.offsetY>=o&&n.offsetY<=s)return n.offsetY-o<s-n.offsetY?r.find(".content-div").prepend(this):r.find(".content-div").append(this),h.container&&h.container.remove_drawable(h),void E[r.attr("id")].add_drawable(h);for(l=0;l<c.length&&(r=t(c.get(l)),!(n.offsetY<r.position().top)||r.hasClass("reference-track")||r.hasClass("intro"));l++);l===c.length?this!==c.get(l-1)&&(u.append(this),E[u.attr("id")].move_drawable(h,l)):this!==c.get(l)&&(t(this).insertBefore(c.get(l)),E[u.attr("id")].move_drawable(h,n.deltaY>0?l-1:l))}).bind("dragstart",function(){t(this).addClass("dragging")}).bind("dragend",function(){t(this).removeClass("dragging")})},R="A converter for this dataset is not installed. Please check your datatypes_conf.xml file.",N=["Histogram","Line","Filled","Intensity"],P=function t(e,n,i){if(t.id_counter||(t.id_counter=0),this.id=t.id_counter++,this.view=e,this.container=n,this.drag_handle_class=i.drag_handle_class,this.is_overview=!1,this.action_icons={},this.config=S.default.ConfigSettingCollection.from_models_and_saved_values(this.config_params,i.prefs),this.config.get_value("name")||this.config.set_value("name",i.name),this.config_onchange&&this.config.on("change",this.config_onchange,this),this.container_div=this.build_container_div(),this.header_div=null,!1!==i.header){var r=new d.default.TrackHeaderView({model:this,id:this.id});this.header_div=r.$el,this.container_div.append(this.header_div);var a=r.icons_div;this.action_icons=r.action_icons,this.container_div.hover(function(){a.show()},function(){a.hide()})}};P.prototype.action_icons_def=[{name:"toggle_icon",title:"Hide/show content",css_class:"toggle",on_click_fn:function(t){t.config.get_value("content_visible")?(t.action_icons.toggle_icon.addClass("toggle-expand").removeClass("toggle"),t.hide_contents(),t.config.set_value("content_visible",!1)):(t.action_icons.toggle_icon.addClass("toggle").removeClass("toggle-expand"),t.config.set_value("content_visible",!0),t.show_contents())}},{name:"settings_icon",title:"Edit settings",css_class:"gear",on_click_fn:function(t){new S.default.ConfigSettingCollectionView({collection:t.config}).render_in_modal("Configure Track")}},{name:"remove_icon",title:"Remove",css_class:"remove-icon",on_click_fn:function(e){t(".tooltip").remove(),e.remove()}}],A(P.prototype,{config_params:[{key:"name",label:"Name",type:"text",default_value:""},{key:"content_visible",type:"bool",default_value:!0,hidden:!0}],config_onchange:function(){},init:function(){},changed:function(){this.view.changed()},can_draw:function(){return!(!this.enabled||!this.config.get_value("content_visible"))},request_draw:function(){},_draw:function(t){},to_dict:function(){},set_name:function(t){this.old_name=this.config.get_value("name"),this.config.set_value("name",t)},revert_name:function(){this.old_name&&this.config.set_value("name",this.old_name)},remove:function(){this.changed(),this.container.remove_drawable(this);var e=this.view;this.container_div.hide(0,function(){t(this).remove(),e.update_intro_div()})},build_container_div:function(){},update_icons:function(){},hide_contents:function(){},show_contents:function(){},get_drawables:function(){}});var q=function(t,e,n){P.call(this,t,e,n),this.obj_type=n.obj_type,this.drawables=[]};A(q.prototype,P.prototype,{unpack_drawables:function(t){this.drawables=[];for(var e,n=0;n<t.length;n++)e=it(t[n],this.view,this),this.add_drawable(e)},init:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].init()},_draw:function(t){for(var e=0;e<this.drawables.length;e++)this.drawables[e]._draw(t)},to_dict:function(){for(var t=[],e=0;e<this.drawables.length;e++)t.push(this.drawables[e].to_dict());return{prefs:this.config.to_key_value_dict(),obj_type:this.obj_type,drawables:t}},add_drawable:function(t){this.drawables.push(t),t.container=this,this.changed()},add_drawable_before:function(t,e){this.changed();var n=this.drawables.indexOf(e);return-1!==n&&(this.drawables.splice(n,0,t),!0)},replace_drawable:function(t,e,n){var i=this.drawables.indexOf(t);return-1!==i&&(this.drawables[i]=e,n&&t.container_div.replaceWith(e.container_div),this.changed()),i},remove_drawable:function(t){var e=this.drawables.indexOf(t);return-1!==e&&(this.drawables.splice(e,1),t.container=null,this.changed(),!0)},move_drawable:function(t,e){var n=this.drawables.indexOf(t);return-1!==n&&(this.drawables.splice(n,1),this.drawables.splice(e,0,t),this.changed(),!0)},get_drawables:function(){return this.drawables},get_tracks:function(t){for(var e,n=this.drawables.slice(0),i=[];0!==n.length;)e=n.shift(),e instanceof t?i.push(e):e.drawables&&(n=n.concat(e.drawables));return i}});var j=function(e,n,i){if(A(i,{obj_type:"DrawableGroup",drag_handle_class:"group-handle"}),q.call(this,e,n,i),this.content_div=t("<div/>").addClass("content-div").attr("id","group_"+this.id+"_content_div").appendTo(this.container_div),O(this.container_div,this),O(this.content_div,this),z(this.container_div,this.drag_handle_class,".group",this),this.filters_manager=new b.default.FiltersManager(this),this.header_div.after(this.filters_manager.parent_div),this.filters_manager.parent_div.after(t("<div style='clear: both'/>")),this.saved_filters_managers=[],"drawables"in i&&this.unpack_drawables(i.drawables),"filters"in i){var r=this.filters_manager;this.filters_manager=new b.default.FiltersManager(this,i.filters),r.parent_div.replaceWith(this.filters_manager.parent_div),i.filters.visible&&this.setup_multitrack_filtering()}};A(j.prototype,P.prototype,q.prototype,{action_icons_def:[P.prototype.action_icons_def[0],P.prototype.action_icons_def[1],{name:"composite_icon",title:"Show composite track",css_class:"layers-stack",on_click_fn:function(e){t(".tooltip").remove(),e.show_composite_track()}},{name:"filters_icon",title:"Filters",css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?(t.filters_manager.clear_filters(),t._restore_filter_managers()):(t.setup_multitrack_filtering(),t.request_draw({clear_tile_cache:!0})),t.filters_manager.toggle()}},P.prototype.action_icons_def[2]],build_container_div:function(){var e=t("<div/>").addClass("group").attr("id","group_"+this.id);return this.container&&this.container.content_div.append(e),e},hide_contents:function(){this.tiles_div.hide()},show_contents:function(){this.tiles_div.show(),this.request_draw()},update_icons:function(){var e=this.drawables.length;if(0===e)this.action_icons.composite_icon.hide(),this.action_icons.filters_icon.hide();else if(1===e)this.action_icons.composite_icon.toggle(this.drawables[0]instanceof W),this.action_icons.filters_icon.hide();else{var n,i,r,a=this.drawables[0].get_type(),o=0;for(n=0;n<e;n++){if(r=this.drawables[n],r.get_type()!==a){can_composite=!1;break}r instanceof Q&&o++}if(this.drawables[0]instanceof K?this.action_icons.composite_icon.show():(this.action_icons.composite_icon.hide(),t(".tooltip").remove()),o>1&&o===this.drawables.length){var s,l={};for(r=this.drawables[0],i=0;i<r.filters_manager.filters.length;i++)s=r.filters_manager.filters[i],l[s.name]=[s];for(n=1;n<this.drawables.length;n++)for(r=this.drawables[n],i=0;i<r.filters_manager.filters.length;i++)s=r.filters_manager.filters[i],s.name in l&&l[s.name].push(s);this.filters_manager.remove_all();var u,c;for(var h in l)u=l[h],u.length===o&&(c=new b.default.NumberFilter({name:u[0].name,index:u[0].index}),this.filters_manager.add_filter(c));this.action_icons.filters_icon.toggle(this.filters_manager.filters.length>0)}else this.action_icons.filters_icon.hide()}},_restore_filter_managers:function(){for(var t=0;t<this.drawables.length;t++)this.drawables[t].filters_manager=this.saved_filters_managers[t];this.saved_filters_managers=[]},setup_multitrack_filtering:function(){if(this.filters_manager.filters.length>0){this.saved_filters_managers=[];for(var t=0;t<this.drawables.length;t++){var e=this.drawables[t];this.saved_filters_managers.push(e.filters_manager),e.filters_manager=this.filters_manager}}this.filters_manager.init_filters()},show_composite_track:function(){var t=new W(this.view,this.view,{name:this.config.get_value("name"),drawables:this.drawables});this.container.replace_drawable(this,t,!0);t.request_draw()},add_drawable:function(t){q.prototype.add_drawable.call(this,t),this.update_icons()},remove_drawable:function(t){q.prototype.remove_drawable.call(this,t),this.update_icons()},to_dict:function(){this.filters_manager.visible()&&this._restore_filter_managers();var t=A(q.prototype.to_dict.call(this),{filters:this.filters_manager.to_dict()});return this.filters_manager.visible()&&this.setup_multitrack_filtering(),t},request_draw:function(t){l.each(this.drawables,function(e){e.request_draw(t)})}});var D=i.View.extend({initialize:function(t){A(t,{obj_type:"View"}),q.call(this,"View",t.container,t),this.chrom=null,this.vis_id=t.vis_id,this.dbkey=t.dbkey,this.stand_alone=void 0===t.stand_alone||t.stand_alone,this.label_tracks=[],this.tracks_to_be_redrawn=[],this.max_low=0,this.max_high=0,this.zoom_factor=3,this.min_separation=30,this.has_changes=!1,this.load_chroms_deferred=null,this.render(),this.canvas_manager=new c.default.CanvasManager(this.container.get(0).ownerDocument),this.reset(),this.config=S.default.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"}],{name:t.name})},render:function(){this.requested_redraw=!1;var e=this.container,n=this;this.top_container=t("<div/>").addClass("top-container").appendTo(e),this.browser_content_div=t("<div/>").addClass("content").appendTo(e),this.bottom_container=t("<div/>").addClass("bottom-container").appendTo(e),this.top_labeltrack=t("<div/>").addClass("top-labeltrack").appendTo(this.top_container),this.viewport_container=t("<div/>").addClass("viewport-container").attr("id","viewport-container").appendTo(this.browser_content_div),this.content_div=this.viewport_container,O(this.viewport_container,n),this.intro_div=t("<div/>").addClass("intro").appendTo(this.viewport_container);t("<div/>").text("Add Datasets to Visualization").addClass("action-button").appendTo(this.intro_div).click(function(){c.default.select_datasets({dbkey:n.dbkey},function(t){l.each(t,function(t){n.add_drawable(it(t,n,n))})})});this.nav_container=t("<div/>").addClass("trackster-nav-container").prependTo(this.top_container),this.nav=t("<div/>").addClass("trackster-nav").appendTo(this.nav_container),this.stand_alone&&(this.nav_container.addClass("stand-alone"),this.nav.addClass("stand-alone")),this.overview=t("<div/>").addClass("overview").appendTo(this.bottom_container),this.overview_viewport=t("<div/>").addClass("overview-viewport").appendTo(this.overview),this.overview_close=t("<a/>").attr("title","Close overview").addClass("icon-button overview-close tooltip").hide().appendTo(this.overview_viewport),this.overview_highlight=t("<div/>").addClass("overview-highlight").hide().appendTo(this.overview_viewport),this.overview_box_background=t("<div/>").addClass("overview-boxback").appendTo(this.overview_viewport),this.overview_box=t("<div/>").addClass("overview-box").appendTo(this.overview_viewport),this.default_overview_height=this.overview_box.height(),this.nav_controls=t("<div/>").addClass("nav-controls").appendTo(this.nav),this.chrom_select=t("<select/>").attr({name:"chrom"}).addClass("chrom-nav").append("<option value=''>Loading</option>").appendTo(this.nav_controls);var i=function(e){"focusout"!==e.type&&13!==(e.keyCode||e.which)&&27!==(e.keyCode||e.which)||(27!==(e.keyCode||e.which)&&n.go_to(t(this).val()),t(this).hide(),t(this).val(""),n.location_span.show(),n.chrom_select.show()),e.stopPropagation()};this.nav_input=t("<input/>").addClass("nav-input").hide().bind("keyup focusout",i).appendTo(this.nav_controls),this.location_span=t("<span/>").addClass("location").attr("title","Click to change location").tooltip({placement:"bottom"}).appendTo(this.nav_controls),this.location_span.click(function(){n.location_span.hide(),n.chrom_select.hide(),n.nav_input.val(n.chrom+":"+n.low+"-"+n.high),n.nav_input.css("display","inline-block"),n.nav_input.select(),n.nav_input.focus(),n.nav_input.autocomplete({source:function(e,i){var r=[],a=t.map(n.get_tracks(Q),function(t){return t.data_manager.search_features(e.term).success(function(t){r=r.concat(t)})});t.when.apply(t,a).done(function(){i(t.map(r,function(t){return{label:t[0],value:t[1]}}))})},minLength:2})}),void 0!==this.vis_id&&(this.hidden_input=t("<input/>").attr("type","hidden").val(this.vis_id).appendTo(this.nav_controls)),this.zo_link=t("<a/>").attr("id","zoom-out").attr("title","Zoom out").tooltip({placement:"bottom"}).click(function(){n.zoom_out()}).appendTo(this.nav_controls),this.zi_link=t("<a/>").attr("id","zoom-in").attr("title","Zoom in").tooltip({placement:"bottom"}).click(function(){n.zoom_in()}).appendTo(this.nav_controls),this.load_chroms_deferred=this.load_chroms({low:0}),this.chrom_select.bind("change",function(){n.change_chrom(n.chrom_select.val())}),this.browser_content_div.click(function(e){t(this).find("input").trigger("blur")}),this.browser_content_div.bind("dblclick",function(t){n.zoom_in(t.pageX,this.viewport_container)}),this.overview_box.bind("dragstart",function(t,e){this.current_x=e.offsetX}).bind("drag",function(t,e){var i=e.offsetX-this.current_x;this.current_x=e.offsetX;var r=Math.round(i/n.viewport_container.width()*(n.max_high-n.max_low));n.move_delta(-r)}),this.overview_close.click(function(){n.reset_overview()}),this.viewport_container.bind("draginit",function(t,e){if(t.clientX>n.viewport_container.width()-16)return!1}).bind("dragstart",function(t,e){e.original_low=n.low,e.current_height=t.clientY,e.current_x=e.offsetX}).bind("drag",function(e,i){var r=t(this),a=i.offsetX-i.current_x,o=r.scrollTop()-(e.clientY-i.current_height);r.scrollTop(o),i.current_height=e.clientY,i.current_x=i.offsetX;var s=Math.round(a/n.viewport_container.width()*(n.high-n.low));n.move_delta(s)}),this.top_labeltrack.bind("dragstart",function(e,i){return t("<div/>").addClass("zoom-area").css("height",n.browser_content_div.height()+n.top_labeltrack.height()+1).appendTo(t(this))}).bind("drag",function(e,i){t(i.proxy).css({left:Math.min(e.pageX,i.startX)-n.container.offset().left,width:Math.abs(e.pageX-i.startX)});var r=Math.min(e.pageX,i.startX)-n.container.offset().left,a=Math.max(e.pageX,i.startX)-n.container.offset().left,o=n.high-n.low,s=n.viewport_container.width();n.update_location(Math.round(r/s*o)+n.low,Math.round(a/s*o)+n.low)}).bind("dragend",function(e,i){var r=Math.min(e.pageX,i.startX),a=Math.max(e.pageX,i.startX),o=n.high-n.low,s=n.viewport_container.width(),l=n.low;n.low=Math.round(r/s*o)+l,n.high=Math.round(a/s*o)+l,t(i.proxy).remove(),n.request_redraw()}),this.add_label_track(new X(this,{content_div:this.top_labeltrack})),t(window).bind("resize",function(){this.resize_timer&&clearTimeout(this.resize_timer),this.resize_timer=setTimeout(function(){n.resize_window()},500)}),t(document).bind("redraw",function(){n.redraw()}),this.reset(),t(window).trigger("resize")},get_base_color:function(t){return this.config.get_value(t.toLowerCase()+"_color")||this.config.get_value("n_color")}});A(D.prototype,q.prototype,{changed:function(){this.has_changes=!0},update_intro_div:function(){this.intro_div.toggle(0===this.drawables.length)},trigger_navigate:function(t,e,n,i){if(this.timer&&clearTimeout(this.timer),i){var r=this;this.timer=setTimeout(function(){r.trigger("navigate",t+":"+e+"-"+n)},500)}else view.trigger("navigate",t+":"+e+"-"+n)},update_location:function(t,e){this.location_span.text(p.default.commatize(t)+" - "+p.default.commatize(e)),this.nav_input.val(this.chrom+":"+p.default.commatize(t)+"-"+p.default.commatize(e));var n=this.chrom_select.val();""!==n&&this.trigger_navigate(n,this.low,this.high,!0)},load_chroms:function(e){e.num=100;var n=this,i=t.Deferred();return t.ajax({url:Galaxy.root+"api/genomes/"+this.dbkey,data:e,dataType:"json",success:function(e){if(0!==e.chrom_info.length){if(e.reference){var r=new J(n);n.add_label_track(r),n.reference_track=r}n.chrom_data=e.chrom_info,n.chrom_select.html(""),n.chrom_select.append(t('<option value="">Select Chrom/Contig</option>'));for(var a=0,o=n.chrom_data.length;a<o;a++){var s=n.chrom_data[a].chrom,l=t("<option>");l.text(s),l.val(s),n.chrom_select.append(l)}e.prev_chroms&&n.chrom_select.append(t('<option value="previous">Previous 100</option>')),e.next_chroms&&n.chrom_select.append(t('<option value="next">Next 100</option>')),n.chrom_start_index=e.start_index,i.resolve(e.chrom_info)}},error:function(){alert("Could not load chroms for this dbkey: "+n.dbkey)}}),i},change_chrom:function(e,n,i){var r=this;if(!r.chrom_data)return void r.load_chroms_deferred.then(function(){r.change_chrom(e,n,i)});if(e&&"None"!==e){if("previous"===e)return void r.load_chroms({low:this.chrom_start_index-100});if("next"===e)return void r.load_chroms({low:this.chrom_start_index+100});var a=t.grep(r.chrom_data,function(t,n){return t.chrom===e})[0];if(void 0===a)return void r.load_chroms({chrom:e},function(){r.change_chrom(e,n,i)});if(e!==r.chrom){r.chrom=e,r.chrom_select.val(r.chrom),r.max_high=a.len-1,r.reset();for(var o=0,s=r.drawables.length;o<s;o++){var l=r.drawables[o];l.init&&l.init()}r.reference_track&&r.reference_track.init()}void 0===n&&void 0===i?(r.low=0,r.high=r.max_high):(r.low=void 0!==n?Math.max(n,0):0,void 0===i?(r.low=Math.max(r.low-15,0),r.high=r.low+30):r.high=Math.min(i,r.max_high)),r.request_redraw()}},go_to:function(t){t=t.replace(/,/g,""),t=t.replace(/:|\-/g," ");var e=t.split(/\s+/),n=e[0],i=e[1]?parseInt(e[1],10):void 0,r=e[2]?parseInt(e[2],10):void 0;this.change_chrom(n,i,r)},move_fraction:function(t){var e=this,n=e.high-e.low;this.move_delta(t*n)},move_delta:function(t){var e=this,n=e.high-e.low;e.low-t<e.max_low?(e.low=e.max_low,e.high=e.max_low+n):e.high-t>e.max_high?(e.high=e.max_high,e.low=e.max_high-n):(e.high-=t,e.low-=t),e.request_redraw({data_fetch:!1}),this.redraw_on_move_fn&&clearTimeout(this.redraw_on_move_fn),this.redraw_on_move_fn=setTimeout(function(){e.request_redraw()},200);var i=e.chrom_select.val();this.trigger_navigate(i,e.low,e.high,!0)},add_drawable:function(t){q.prototype.add_drawable.call(this,t),t.init(),this.changed(),this.update_intro_div();var e=this;t.config.on("change",function(){e.changed()})},add_label_track:function(t){t.view=this,t.init(),this.label_tracks.push(t)},remove_drawable:function(e,n){if(q.prototype.remove_drawable.call(this,e),n){var i=this;e.container_div.hide(0,function(){t(this).remove(),i.update_intro_div()})}},reset:function(){this.low=this.max_low,this.high=this.max_high,this.viewport_container.find(".yaxislabel").remove()},request_redraw:function(t,e){var n=this,i=e?[e]:n.drawables;l.each(i,function(e){var i=l.find(n.tracks_to_be_redrawn,function(t){return t[0]===e});i?i[1]=t:n.tracks_to_be_redrawn.push([e,t])}),this.requested_redraw||(requestAnimationFrame(function(){n._redraw()}),this.requested_redraw=!0)},_redraw:function(){this.requested_redraw=!1;var t=this.low,e=this.high;t<this.max_low&&(t=this.max_low),e>this.max_high&&(e=this.max_high);var n=this.high-this.low;0!==this.high&&n<this.min_separation&&(e=t+this.min_separation),this.low=Math.floor(t),this.high=Math.ceil(e),this.update_location(this.low,this.high),this.resolution_px_b=this.viewport_container.width()/(this.high-this.low);var i=this.low/(this.max_high-this.max_low)*this.overview_viewport.width()||0,r=(this.high-this.low)/(this.max_high-this.max_low)*this.overview_viewport.width()||0;this.overview_box.css({left:i,width:Math.max(13,r)}).show(),r<13&&this.overview_box.css("left",i-(13-r)/2),this.overview_highlight&&this.overview_highlight.css({left:i,width:r}),l.each(this.tracks_to_be_redrawn,function(t){var e=t[0],n=t[1];e&&e._draw(n)}),this.tracks_to_be_redrawn=[],l.each(this.label_tracks,function(t){t._draw()})},zoom_in:function(t,e){if(!(0===this.max_high||this.high-this.low<=this.min_separation)){var n=this.high-this.low,i=n/2+this.low,r=n/this.zoom_factor/2;t&&(i=t/this.viewport_container.width()*(this.high-this.low)+this.low),this.low=Math.round(i-r),this.high=Math.round(i+r),this.changed(),this.request_redraw()}},zoom_out:function(){if(0!==this.max_high){var t=this.high-this.low,e=t/2+this.low,n=t*this.zoom_factor/2;this.low=Math.round(e-n),this.high=Math.round(e+n),this.changed(),this.request_redraw()}},resize_viewport:function(){this.viewport_container.height(this.container.height()-this.top_container.height()-this.bottom_container.height())},resize_window:function(){this.resize_viewport(),this.request_redraw()},set_overview:function(t){if(this.overview_drawable){if(this.overview_drawable.dataset.id===t.dataset.id)return;this.overview_viewport.find(".track").remove()}var e=t.copy({content_div:this.overview_viewport}),n=this;e.header_div.hide(),e.is_overview=!0,n.overview_drawable=e,this.overview_drawable.postdraw_actions=function(){n.overview_highlight.show().height(n.overview_drawable.content_div.height()),n.overview_viewport.height(n.overview_drawable.content_div.height()+n.overview_box.outerHeight()),n.overview_close.show(),n.resize_window()},n.overview_drawable.request_draw(),this.changed()},reset_overview:function(){t(".tooltip").remove(),this.overview_viewport.find(".track-tile").remove(),this.overview_viewport.height(this.default_overview_height),this.overview_box.height(this.default_overview_height),this.overview_close.hide(),this.overview_highlight.hide(),view.resize_window(),view.overview_drawable=null}});var L=C.default.Tool.extend({defaults:{track:null},initialize:function(t){C.default.Tool.prototype.initialize.call(this,t);var e=!0;void 0!==t.tool_state&&void 0!==t.tool_state.hidden&&(e=t.tool_state.hidden),this.set("hidden",e),this.remove_inputs(["data","hidden_data","conditional"])},state_dict:function(t){return l.extend(this.get_inputs_dict(),{hidden:!this.is_visible()})}}),I=i.View.extend({events:{"change :input":"update_value"},render:function(){var e=this.$el.addClass("param-row"),n=this.model;t("<div>").addClass("param-label").text(n.get("label")).appendTo(e);t("<div/>").addClass("param-input").html(n.get("html")).appendTo(e).find(":input").val(n.get("value")),t("<div style='clear: both;'/>").appendTo(e)},update_value:function(e){this.model.set_value(t(e.target).val())}}),B=i.View.extend({initialize:function(t){this.model.on("change:hidden",this.set_visible,this)},render:function(){var e=this,n=this.model,i=this.$el.addClass("dynamic-tool").hide();i.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).keydown(function(t){t.stopPropagation()});t("<div class='tool-name'>").appendTo(i).text(n.get("name"));n.get("inputs").each(function(t){var e=new I({model:t});e.render(),i.append(e.$el)}),i.find("input").click(function(){t(this).select()});var r=t("<div>").addClass("param-row").appendTo(i),a=t("<input type='submit'>").attr("value","Run on complete dataset").appendTo(r);t("<input type='submit'>").attr("value","Run on visible region").appendTo(r).click(function(){e.run_on_region()}),a.click(function(){e.run_on_dataset()}),n.is_visible()&&this.$el.show()},set_visible:function(){this.$el.toggle(this.model.is_visible())},update_params:function(){for(var t=0;t<this.params.length;t++)this.params[t].update_value()},run_on_dataset:function(){var t=this.model;this.run({target_dataset_id:this.model.get("track").dataset.id,action:"rerun",tool_id:t.id},null,function(e){Galaxy.modal.show({title:t.get("name")+" is Running",body:t.get("name")+" is running on the complete dataset. Tool outputs are in dataset's history.",buttons:{Close:function(){Galaxy.modal.hide()}}})})},run_on_region:function(){var t,e=this.model.get("track"),n=this.model,i=new c.default.GenomeRegion({chrom:e.view.chrom,start:e.view.low,end:e.view.high}),r={target_dataset_id:e.dataset.id,action:"rerun",tool_id:n.id,regions:[i.toJSON()]},a=e,o=n.get("name")+a.tool_region_and_parameters_str(i);if(a.container===view){var s=new j(view,view,{name:e.config.get_value("name")}),l=a.container.replace_drawable(a,s,!1);s.container_div.insertBefore(a.view.content_div.children()[l]),s.add_drawable(a),a.container_div.appendTo(s.content_div),t=s}else t=a.container;var u=new a.constructor(view,t,{name:o,hda_ldda:"hda"});u.init_for_tool_data(),u.change_mode(a.mode),u.set_filters_manager(a.filters_manager.copy(u)),u.update_icons(),t.add_drawable(u),u.tiles_div.text("Starting job."),this.run(r,u,function(t){u.set_dataset(new x.default.Dataset(t)),u.tiles_div.text("Running job."),u.init()})},run:function(e,n,i){e.inputs=this.model.get_inputs_dict();var r=new p.default.ServerStateDeferred({ajax_settings:{url:Galaxy.root+"api/tools",data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(t){return"pending"!==t}});t.when(r.go()).then(function(t){"no converter"===t?(n.container_div.addClass("error"),n.content_div.text(R)):t.error?(n.container_div.addClass("error"),n.content_div.text("Tool cannot be rerun: "+t.message)):i(t)})}}),V=function(t,e){m.default.Scaler.call(this,e),this.filter=t};V.prototype.gen_val=function(t){return this.filter.high===Number.MAX_VALUE||this.filter.low===-Number.MAX_VALUE||this.filter.low===this.filter.high?this.default_val:(parseFloat(t[this.filter.index])-this.filter.low)/(this.filter.high-this.filter.low)};var U=function(e,n,i,r,a){this.track=e,this.region=n,this.low=n.get("start"),this.high=n.get("end"),this.w_scale=i,this.canvas=r,this.html_elt=t("<div class='track-tile'/>").append(r),this.data=a,this.stale=!1};U.prototype.predisplay_actions=function(){};var F=function(t,e,n,i,r){U.call(this,t,e,n,i,r)};F.prototype.predisplay_actions=function(){};var G=function(t,e,n,i,r,a,o,s,l,u,c){U.call(this,t,e,n,i,r),this.mode=a,this.all_slotted=s,this.feature_mapper=l,this.has_icons=!1,this.incomplete_features=u,this.other_tiles_features_drawn={},this.seq_data=c};A(G.prototype,U.prototype),G.prototype.predisplay_actions=function(){};var H=function(e,n,r){A(r,{drag_handle_class:"draghandle"}),P.call(this,e,n,r),this.dataset=null,r.dataset&&(this.dataset=r.dataset instanceof i.Model?r.dataset:new x.default.Dataset(r.dataset)),this.dataset_check_type="converted_datasets_state",this.data_url_extra_params={},this.data_query_wait="data_query_wait"in r?r.data_query_wait:5e3,this.data_manager="data_manager"in r?r.data_manager:new c.default.GenomeDataManager({dataset:this.dataset,genome:new c.default.Genome({key:e.dbkey,chroms_info:{chrom_info:e.chrom_data}}),data_mode_compatible:this.data_and_mode_compatible,can_subset:this.can_subset}),this.min_height_px=16,this.max_height_px=800,this.visible_height_px=this.config.get_value("height"),this.content_div=t("<div class='track-content'>").appendTo(this.container_div),this.container&&(this.container.content_div.append(this.container_div),"resize"in r&&!r.resize||this.add_resize_handle())};A(H.prototype,P.prototype,{action_icons_def:[{name:"mode_icon",title:"Set display mode",css_class:"chevron-expand",on_click_fn:function(){}},P.prototype.action_icons_def[0],{name:"overview_icon",title:"Set as overview",css_class:"application-dock-270",on_click_fn:function(t){t.view.set_overview(t)}},P.prototype.action_icons_def[1],{name:"filters_icon",title:"Filters",css_class:"ui-slider-050",on_click_fn:function(t){t.filters_manager.visible()?t.filters_manager.clear_filters():t.filters_manager.init_filters(),t.filters_manager.toggle()}},{name:"tools_icon",title:"Tool",css_class:"hammer",on_click_fn:function(e){e.tool.toggle(),e.tool.is_visible()?e.set_name(e.config.get_value("name")+e.tool_region_and_parameters_str()):e.revert_name(),t(".tooltip").remove()}},{name:"param_space_viz_icon",title:"Tool parameter space visualization",css_class:"arrow-split",on_click_fn:function(e){var n="<strong>Tool</strong>:"+e.tool.get("name")+"<br/><strong>Dataset</strong>:"+e.config.get_value("name")+'<br/><strong>Region(s)</strong>: <select name="regions"><option value="cur">current viewing area</option><option value="bookmarks">bookmarks</option><option value="both">current viewing area and bookmarks</option></select>',r=function(){Galaxy.modal.hide(),t(window).unbind("keypress.check_enter_esc")},a=function(){var n,r=t('select[name="regions"] option:selected').val(),a=new c.default.GenomeRegion({chrom:view.chrom,start:view.low,end:view.high}),o=l.map(t(".bookmark"),function(e){return new c.default.GenomeRegion({from_str:t(e).children(".position").text()})});n="cur"===r?[a]:"bookmarks"===r?o:[a].concat(o),Galaxy.modal.hide(),window.location.href=Galaxy.root+"visualization/sweepster?"+t.param({dataset_id:e.dataset.id,hda_ldda:e.dataset.get("hda_ldda"),regions:JSON.stringify(new i.Collection(n).toJSON())})};Galaxy.modal.show({title:"Visualize tool parameter space and output from different parameter settings?",body:n,buttons:{No:r,Yes:a}})}},P.prototype.action_icons_def[2]],can_draw:function(){return this.dataset&&P.prototype.can_draw.call(this)},build_container_div:function(){return t("<div/>").addClass("track").attr("id","track_"+this.id)},set_dataset:function(t){this.dataset=t,this.data_manager.set("dataset",t)},on_resize:function(){this.request_draw({clear_tile_cache:!0})},add_resize_handle:function(){var e=this,n=!1,i=!1,r=t("<div class='track-resize'>");t(e.container_div).hover(function(){e.config.get_value("content_visible")&&(n=!0,r.show())},function(){n=!1,i||r.hide()}),r.hide().bind("dragstart",function(n,r){i=!0,r.original_height=t(e.content_div).height()}).bind("drag",function(n,i){var r=Math.min(Math.max(i.original_height+i.deltaY,e.min_height_px),e.max_height_px);t(e.tiles_div).css("height",r),e.visible_height_px=e.max_height_px===r?0:r,e.on_resize()}).bind("dragend",function(t,a){e.tile_cache.clear(),i=!1,n||r.hide(),e.config.set_value("height",e.visible_height_px),e.changed()}).appendTo(e.container_div)},hide_contents:function(){this.tiles_div.hide(),this.container_div.find(".yaxislabel, .track-resize").hide()},show_contents:function(){this.tiles_div.show(),this.container_div.find(".yaxislabel, .track-resize").show(),this.request_draw()},get_type:function(){return this instanceof X?"LabelTrack":this instanceof J?"ReferenceTrack":this instanceof K?"LineTrack":this instanceof et?"ReadTrack":this instanceof tt?"VariantTrack":this instanceof W?"CompositeTrack":this instanceof Q?"FeatureTrack":""},show_message:function(e){return this.tiles_div.remove(),t("<span/>").addClass("message").html(e).appendTo(this.content_div)},init:function(e){var n=this;if(n.enabled=!1,n.tile_cache.clear(),n.data_manager.clear(),n.content_div.children().remove(),n.container_div.removeClass("nodata error pending"),n.tiles_div=t("<div/>").addClass("tiles").appendTo(n.content_div),n.dataset.id){var i=t.Deferred(),r={hda_ldda:n.dataset.get("hda_ldda"),data_type:this.dataset_check_type,chrom:n.view.chrom,retry:e};return t.getJSON(this.dataset.url(),r,function(e){if(e&&"error"!==e&&"error"!==e.kind)"no converter"===e?(n.container_div.addClass("error"),n.show_message(R)):"no data"===e||void 0!==e.data&&(null===e.data||0===e.data.length)?(n.container_div.addClass("nodata"),n.show_message("No data for this chrom/contig.")):"pending"===e?(n.container_div.addClass("pending"),n.show_message("Preparing data. This can take a while for a large dataset. If the visualization is saved and closed, preparation will continue in the background."),setTimeout(function(){n.init()},n.data_query_wait)):"data"!==e&&"data"!==e.status||(e.valid_chroms&&(n.valid_chroms=e.valid_chroms,n.update_icons()),n.tiles_div.text("Ready for display"),n.view.chrom?(n.tiles_div.text(""),n.tiles_div.css("height",n.visible_height_px+"px"),n.enabled=!0,t.when.apply(t,n.predraw_init()).done(function(){i.resolve(),n.container_div.removeClass("nodata error pending"),n.request_draw()})):i.resolve());else{n.container_div.addClass("error");var r=n.show_message("Cannot display dataset due to an error. ");e.message&&(r.append(t("<a href='javascript:void(0);'></a>").text("View error").click(function(){Galaxy.modal.show({title:"Trackster Error",body:"<pre>"+e.message+"</pre>",buttons:{Close:function(){Galaxy.modal.hide()}}})})),r.append(t("<span/>").text(" ")),r.append(t("<a href='javascript:void(0);'></a>").text("Try again").click(function(){n.init(!0)})))}}),this.update_icons(),i}},predraw_init:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){var n=t.data;if(n&&void 0!==n.min&&void 0!==n.max){var i=n.min,r=n.max;i=Math.floor(Math.min(0,Math.max(i,n.mean-2*n.sd))),r=Math.ceil(Math.max(0,Math.min(r,n.mean+2*n.sd))),e.config.set_default_value("min_value",i),e.config.set_default_value("max_value",r),e.config.set_value("min_value",i),e.config.set_value("max_value",r)}})},get_drawables:function(){return this}});var Y=function(e,n,i){H.call(this,e,n,i);var r=this;if(z(r.container_div,r.drag_handle_class,".group",r),this.filters_manager=new b.default.FiltersManager(this,"filters"in i?i.filters:null),this.data_manager.set("filters_manager",this.filters_manager),this.filters_available=!1,this.tool=i.tool?new L(l.extend(i.tool,{track:this,tool_state:i.tool_state})):null,this.tile_cache=new c.default.Cache(10),this.left_offset=0,this.header_div&&(this.set_filters_manager(this.filters_manager),this.tool)){var a=new B({model:this.tool});a.render(),this.dynamic_tool_div=a.$el,this.header_div.after(this.dynamic_tool_div)}this.tiles_div=t("<div/>").addClass("tiles").appendTo(this.content_div),this.config.get_value("content_visible")||this.tiles_div.hide(),this.overlay_div=t("<div/>").addClass("overlay").appendTo(this.content_div),i.mode&&this.change_mode(i.mode)};A(Y.prototype,P.prototype,H.prototype,{action_icons_def:H.prototype.action_icons_def.concat([{name:"show_more_rows_icon",title:"To minimize track height, not all feature rows are displayed. Click to display more rows.",css_class:"exclamation",on_click_fn:function(e){t(".tooltip").remove(),e.slotters[e.view.resolution_px_b].max_rows*=2,e.request_draw({clear_tile_cache:!0})},hide:!0}]),copy:function(t){var e=this.to_dict();A(e,{data_manager:this.data_manager});var n=new this.constructor(this.view,t,e);return n.change_mode(this.mode),n.enabled=this.enabled,n},set_filters_manager:function(t){this.filters_manager=t,this.header_div.after(this.filters_manager.parent_div)},to_dict:function(){return{track_type:this.get_type(),dataset:{id:this.dataset.id,hda_ldda:this.dataset.get("hda_ldda")},prefs:this.config.to_key_value_dict(),mode:this.mode,filters:this.filters_manager.to_dict(),tool_state:this.tool?this.tool.state_dict():{}}},set_min_max:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){var n=t.data;if(isNaN(parseFloat(e.config.get_value("min_value")))||isNaN(parseFloat(e.config.get_value("max_value")))){var i=n.min,r=n.max;i=Math.floor(Math.min(0,Math.max(i,n.mean-2*n.sd))),r=Math.ceil(Math.max(0,Math.min(r,n.mean+2*n.sd))),e.config.set_value("min_value",i),e.config.set_value("max_value",r)}})},change_mode:function(t){var e=this;return e.mode=t,e.config.set_value("mode",t),"Auto"===t&&this.data_manager.clear(),e.request_draw({clear_tile_cache:!0}),this.action_icons.mode_icon.attr("title","Set display mode (now: "+e.mode+")"),e},update_icons:function(){var t=this;t.action_icons.filters_icon.toggle(t.filters_available),t.action_icons.tools_icon.toggle(null!==t.tool),t.action_icons.param_space_viz_icon.toggle(null!==t.tool)},_gen_tile_cache_key:function(t,e){return t+"_"+e},request_draw:function(t){t&&t.clear_tile_cache&&this.tile_cache.clear(),this.view.request_redraw(t,this)},before_draw:function(){this.max_height_px=0},_draw:function(e){if(this.can_draw()){var n=e&&e.clear_after,i=this.view.low,r=this.view.high,a=this.view.container.width(),o=this.view.resolution_px_b,s=1/o;this.is_overview&&(i=this.view.max_low,r=this.view.max_high,o=a/(view.max_high-view.max_low),s=1/o),this.before_draw(),this.tiles_div.children().addClass("remove");for(var u,h,d=Math.floor(400*s),f=Math.floor(i/d),p=[],_=[];f*d<r;)u=new c.default.GenomeRegion({chrom:this.view.chrom,start:f*d,end:Math.min((f+1)*d,this.view.max_high)}),h=this.draw_helper(u,o,e),p.push(h),t.when(h).then(function(t){_.push(t)}),f+=1;n||this.tiles_div.children(".remove").removeClass("remove").remove();var g=this;t.when.apply(t,p).then(function(){g.tiles_div.children(".remove").remove(),_=l.filter(_,function(t){return null!==t}),0!==_.length&&g.postdraw_actions(_,a,o,n)})}},_add_yaxis_label:function(e,n){var i=this,r="max"===e?"top":"bottom",o="max"===e?"max":"min",s="max"===e?"max_value":"min_value",l=this.container_div.find(".yaxislabel."+r),u=a(i.config.get_value(s),1);n=n||function(){i.request_draw({clear_tile_cache:!0})},0!==l.length?l.text(u):(l=t("<div/>").text(u).make_text_editable({num_cols:12,on_finish:function(e){t(".tooltip").remove(),i.config.set_value(s,a(e,1)),n()},help_text:"Set "+o+" value"}).addClass("yaxislabel "+r).css("color",this.config.get_value("label_color")),this.container_div.prepend(l))},postdraw_actions:function(t,e,n,i){if(l.filter(t,function(t){return t instanceof F}).length>0){this.max_height_px=0;var r=this;l.each(t,function(t){t instanceof F||(t.html_elt.remove(),r.draw_helper(t.region,n,{force:!0,mode:"Coverage"}))}),r._add_yaxis_label("max")}else this.container_div.find(".yaxislabel").remove(),l.find(t,function(t){return t.has_icons})&&l.each(t,function(t){t.has_icons||t.html_elt.css("padding-top",20)})},get_mode:function(t){return this.mode},update_auto_mode:function(t){},_get_drawables:function(){return[this]},draw_helper:function(e,n,i){i||(i={});var r=i.force,a=i.mode||this.mode,o=1/n,s=this,u=this._get_drawables(),c=this._gen_tile_cache_key(n,e),h=r?void 0:s.tile_cache.get_elt(c);if(h)return function(t){return t&&"track"in t}(h)&&s.show_tile(h,n),h;if(!1===i.data_fetch)return null;var d=function(){var t=l.find(N,function(t){return t===a})?"Coverage":a,n=l.map(u,function(n){return n.data_manager.get_data(e,t,o,s.data_url_extra_params)});return view.reference_track&&n.push(view.reference_track.data_manager.get_data(e,a,o,view.reference_track.data_url_extra_params)),n},f=t.Deferred();return s.tile_cache.set_elt(c,f),t.when.apply(t,d()).then(function(){var r,a=d(),o=a;if(l.find(a,function(t){return p.default.is_deferred(t)}))return s.tile_cache.set_elt(c,void 0),void t.when(s.draw_helper(e,n,i)).then(function(t){f.resolve(t)});view.reference_track&&(r=view.reference_track.data_manager.subset_entry(a.pop(),e));var h=[],_=[];l.each(u,function(t,e){var i=t.mode,r=o[e];"Auto"===i&&(i=t.get_mode(r),t.update_auto_mode(i)),h.push(i),_.push(t.get_canvas_height(r,i,n,b))});var g,v=s.view.canvas_manager.new_canvas(),m=e.get("start"),y=e.get("end"),b=Math.ceil((y-m)*n)+s.left_offset,w=l.max(_);v.width=b,v.height=i.height||w;var x=v.getContext("2d");x.translate(s.left_offset,0),u.length>1&&(x.globalAlpha=.5,x.globalCompositeOperation="source-over"),l.each(u,function(t,i){g=t.draw_tile(o[i],x,h[i],e,n,r)}),void 0!==g&&(s.tile_cache.set_elt(c,g),s.show_tile(g,n)),f.resolve(g)}),f},get_canvas_height:function(t,e,n,i){return this.visible_height_px},_draw_line_track_tile:function(t,e,n,i,r){-1!==[void 0,null].indexOf(this.config.get_value("min_value"))&&this.config.set_value("min_value",0),-1!==[void 0,null,0].indexOf(this.config.get_value("max_value"))&&this.config.set_value("max_value",l.max(l.map(t.data,function(t){return t[1]}))||0);var a=e.canvas;return new m.default.LinePainter(t.data,i.get("start"),i.get("end"),this.config.to_key_value_dict(),n).draw(e,a.width,a.height,r),new F(this,i,r,a,t.data)},draw_tile:function(t,e,n,i,r,a){},show_tile:function(t,e){var n=t.html_elt;t.predisplay_actions();var i=Math.round((t.low-(this.is_overview?this.view.max_low:this.view.low))*e);this.left_offset&&(i-=this.left_offset),n.css("left",i),n.hasClass("remove")?n.removeClass("remove"):this.tiles_div.append(n),n.css("height","auto"),this.max_height_px=Math.max(this.max_height_px,n.height()-2),n.parent().children().css("height",this.max_height_px+"px");var r=this.max_height_px;0!==this.visible_height_px&&(r=Math.min(this.max_height_px,this.visible_height_px)),this.tiles_div.css("height",r+"px")},tool_region_and_parameters_str:function(t){var e=this;return" - region=["+(void 0!==t?t.toString():"all")+"], parameters=["+l.values(e.tool.get_inputs_dict()).join(", ")+"]"},data_and_mode_compatible:function(t,e){return"Auto"===e||("Coverage"===e?"bigwig"===t.dataset_type:"bigwig"!==t.dataset_type&&"no_detail"!==t.extra_info)},can_subset:function(t){return!t.message&&"no_detail"!==t.extra_info&&("bigwig"!==t.dataset_type||t.data[1][0]-t.data[0][0]==1)},init_for_tool_data:function(){this.data_manager.set("data_type","raw_data"),this.data_query_wait=1e3,this.dataset_check_type="state"}});var X=function(t,e){H.call(this,t,e,{resize:!1,header:!1}),this.container_div.addClass("label-track")};A(X.prototype,H.prototype,{init:function(){this.enabled=!0},predraw_init:function(){},_draw:function(e){for(var n=this.view,i=n.high-n.low,r=Math.floor(Math.pow(10,Math.floor(Math.log(i)/Math.log(10)))),a=Math.floor(n.low/r)*r,o=this.view.container.width(),s=t("<div/>").addClass("label-container");a<n.high;){var l=Math.floor((a-n.low)/i*o);s.append(t("<div/>").addClass("pos-label").text(p.default.commatize(a)).css({left:l})),a+=r}this.content_div.children(":first").remove(),this.content_div.append(s)}});var W=function(t,e,n){if(Y.call(this,t,e,n),this.drawables=[],"drawables"in n){for(var i,r=0;r<n.drawables.length;r++)i=n.drawables[r],this.drawables[r]=it(i,t,null),i.left_offset>this.left_offset&&(this.left_offset=i.left_offset);this.enabled=!0}l.each(this.drawables,function(t){(t instanceof Q||t instanceof et)&&t.change_mode("Coverage")}),this.update_icons(),this.obj_type="CompositeTrack"};A(W.prototype,Y.prototype,{display_modes:N,build_config_params:function(){return l.union(P.prototype.config_params,[{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},action_icons_def:[{name:"composite_icon",title:"Show individual tracks",css_class:"layers-stack",on_click_fn:function(e){t(".tooltip").remove(),e.show_group()}}].concat(Y.prototype.action_icons_def),to_dict:q.prototype.to_dict,add_drawable:q.prototype.add_drawable,unpack_drawables:q.prototype.unpack_drawables,config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},on_resize:function(){var t=this.visible_height_px;l.each(this.drawables,function(e){e.visible_height_px=t}),H.prototype.on_resize.call(this)},change_mode:function(t){Y.prototype.change_mode.call(this,t);for(var e=0;e<this.drawables.length;e++)this.drawables[e].change_mode(t)},init:function(){for(var e=[],n=0;n<this.drawables.length;n++)e.push(this.drawables[n].init());var i=this;t.when.apply(t,e).then(function(){i.enabled=!0,i.request_draw()})},update_icons:function(){this.action_icons.filters_icon.hide(),this.action_icons.tools_icon.hide(),this.action_icons.param_space_viz_icon.hide()},can_draw:P.prototype.can_draw,_get_drawables:function(){return this.drawables},show_group:function(){for(var t,e=new j(this.view,this.container,{name:this.config.get_value("name")}),n=0;n<this.drawables.length;n++)t=this.drawables[n],t.update_icons(),e.add_drawable(t),t.container=e,e.content_div.append(t.container_div);this.container.replace_drawable(this,e,!0);e.request_draw({clear_tile_cache:!0})},before_draw:function(){var t=l.min(l.map(this.drawables,function(t){return t.config.get_value("min_value")})),e=l.max(l.map(this.drawables,function(t){return t.config.get_value("max_value")}));this.config.set_value("min_value",t),this.config.set_value("max_value",e),l.each(this.drawables,function(n){n.config.set_value("min_value",t),n.config.set_value("max_value",e)})},update_all_min_max:function(){var t=this.config.get_value("min_value"),e=this.config.get_value("max_value");l.each(this.drawables,function(n){n.config.set_value("min_value",t),n.config.set_value("max_value",e)}),this.request_draw({clear_tile_cache:!0})},postdraw_actions:function(t,e,n,i){var r,a=-1;for(r=0;r<t.length;r++){var o=t[r].html_elt.find("canvas").height();o>a&&(a=o)}for(r=0;r<t.length;r++){var s=t[r];s.html_elt.find("canvas").height()!==a&&(this.draw_helper(s.region,n,{force:!0,height:a}),s.html_elt.remove())}var l=this,u=function(){l.update_all_min_max()};this._add_yaxis_label("min",u),this._add_yaxis_label("max",u)}});var J=function(t){Y.call(this,t,{content_div:t.top_labeltrack},{resize:!1,header:!1}),this.left_offset=t.canvas_manager.char_width_px,this.container_div.addClass("reference-track"),this.data_url=Galaxy.root+"api/genomes/"+this.view.dbkey,this.data_url_extra_params={reference:!0},this.data_manager=new c.default.GenomeReferenceDataManager({data_url:this.data_url,can_subset:this.can_subset}),this.hide_contents()};A(J.prototype,P.prototype,Y.prototype,{build_config_params:function(){return l.union(P.prototype.config_params,[{key:"height",type:"int",default_value:13,hidden:!0}])},init:function(){this.data_manager.clear(),this.enabled=!0},predraw_init:function(){},can_draw:P.prototype.can_draw,draw_helper:function(t,e,n){var i,r=this.tiles_div.is(":visible"),a=null;return e>this.view.canvas_manager.char_width_px?(this.tiles_div.show(),i=!0,a=Y.prototype.draw_helper.call(this,t,e,n)):(i=!1,this.tiles_div.hide()),r!==i&&this.view.resize_viewport(),a},can_subset:function(t){return!0},draw_tile:function(t,e,n,i,r){var a=this.data_manager.subset_entry(t,i),o=a.data,s=e.canvas;e.font=e.canvas.manager.default_font,e.textAlign="center";for(var l=0,u=o.length;l<u;l++)e.fillStyle=this.view.get_base_color(o[l]),e.fillText(o[l],Math.floor(l*r),10);return new U(this,i,r,s,a)}});var K=function(e,n,i){this.mode="Histogram",Y.call(this,e,n,i),this.left_offset=30;var r=this;t.when(o(Galaxy.root+"datasets/"+this.dataset.id+"/display")).then(function(t){t&&(r.data_manager=new $.default.BBIDataManager({dataset:r.dataset}))})};A(K.prototype,P.prototype,Y.prototype,{display_modes:N,build_config_params:function(){return l.union(P.prototype.config_params,[{key:"color",label:"Color",type:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},before_draw:function(){},draw_tile:function(t,e,n,i,r){return this._draw_line_track_tile(t,e,n,i,r)},can_subset:function(t){return t.data[1][0]-t.data[0][0]==1},postdraw_actions:function(t,e,n,i){this._add_yaxis_label("max"),this._add_yaxis_label("min")}});var Z=function(t,e,n){this.mode="Heatmap",Y.call(this,t,e,n)};A(Z.prototype,P.prototype,Y.prototype,{display_modes:["Heatmap"],build_config_params:function(){return l.union(P.prototype.config_params,[{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"min_value",label:"Min Value",type:"int",default_value:void 0},{key:"max_value",label:"Max Value",type:"int",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:500,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},predraw_init:function(){var e=this;return t.getJSON(e.dataset.url(),{data_type:"data",stats:!0,chrom:e.view.chrom,low:0,high:e.view.max_high,hda_ldda:e.dataset.get("hda_ldda")},function(t){t.data})},draw_tile:function(t,e,n,i,r){var a=e.canvas;return new m.default.DiagonalHeatmapPainter(t.data,i.get("start"),i.get("end"),this.config.to_key_value_dict(),n).draw(e,a.width,a.height,r),new U(this,i,r,a,t.data)}});var Q=function(t,e,n){Y.call(this,t,e,n),this.container_div.addClass("feature-track"),this.summary_draw_height=30,this.slotters={},this.start_end_dct={},this.left_offset=200,this.set_painter_from_config()};A(Q.prototype,P.prototype,Y.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return l.union(P.prototype.config_params,[{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0,help:"Show the number of items in each bin when drawing summary histogram"},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"connector_style",label:"Connector style",type:"select",default_value:"fishbones",options:[{label:"Line with arrows",value:"fishbone"},{label:"Arcs",value:"arcs"}]},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.set_painter_from_config(),this.request_draw({clear_tile_cache:!0})},set_painter_from_config:function(){"arcs"===this.config.get_value("connector_style")?this.painter=m.default.ArcLinkedFeaturePainter:this.painter=m.default.LinkedFeaturePainter},postdraw_actions:function(e,n,i,r){Y.prototype.postdraw_actions.call(this,e,n,i,r);var a,o=this;if(0===l.filter(e,function(t){return t instanceof F}).length){var s={};l.each(l.pluck(e,"incomplete_features"),function(t){l.each(t,function(t){s[t[0]]=t})});var u=this;l.each(e,function(e){var n=l.omit(s,l.map(e.incomplete_features,function(t){return t[0]}));if(n=l.omit(n,l.keys(e.other_tiles_features_drawn)),0!==l.size(n)){var i={data:l.values(n)},r=u.view.canvas_manager.new_canvas(),a=r.getContext("2d");r.height=Math.max(e.canvas.height,u.get_canvas_height(i,e.mode,e.w_scale,100)),r.width=e.canvas.width,a.drawImage(e.canvas,0,0),a.translate(o.left_offset,0);var c=u.draw_tile(i,a,e.mode,e.region,e.w_scale,e.seq_data);t(e.canvas).replaceWith(t(c.canvas)),e.canvas=r,l.extend(e.other_tiles_features_drawn,s)}})}if(o.filters_manager){var c,h=o.filters_manager.filters;for(c=0;c<h.length;c++)h[c].update_ui_elt();var d,f,p=!1;for(a=0;a<e.length;a++)if(e[a].data.length)for(d=e[a].data[0],c=0;c<h.length;c++)if(f=h[c],f.applies_to(d)&&f.min!==f.max){p=!0;break}o.filters_available!==p&&(o.filters_available=p,o.filters_available||o.filters_manager.hide(),o.update_icons())}if(e[0]instanceof G){var _=!0;for(a=0;a<e.length;a++)if(!e[a].all_slotted){_=!1;break}this.action_icons.show_more_rows_icon.toggle(!_)}else this.action_icons.show_more_rows_icon.hide()},update_auto_mode:function(t){"Auto"===this.mode&&("no_detail"===t&&(t="feature spans"),this.action_icons.mode_icon.attr("title","Set display mode (now: Auto/"+t+")"))},incremental_slots:function(t,e,n){var i=this.view.canvas_manager.dummy_context,r=this.slotters[t];return r&&r.mode===n||(r=new g.default.FeatureSlotter(t,n,100,function(t){return i.measureText(t)}),this.slotters[t]=r),r.slot_features(e)},get_mode:function(t){return"no_detail"===t.extra_info||this.is_overview?"no_detail":this.view.high-this.view.low>12e3?"Squish":"Pack"},get_canvas_height:function(t,e,n,i){if("Coverage"===e||"bigwig"===t.dataset_type)return this.summary_draw_height;var r=this.incremental_slots(n,t.data,e),a=new this.painter(null,null,null,this.config.to_key_value_dict(),e);return Math.max(this.min_height_px,a.get_required_height(r,i))},draw_tile:function(t,e,n,i,r,a,o){var s=this,l=e.canvas,u=i.get("start"),c=i.get("end"),h=this.left_offset;if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,n,i,r);var d=[],f=this.slotters[r].slots,p=!0;if(t.data)for(var _=this.filters_manager.filters,g=0,v=t.data.length;g<v;g++){for(var m,y=t.data[g],b=!1,w=0,x=_.length;w<x;w++)if(m=_[w],m.update_attrs(y),!m.keep(y)){b=!0;break}b||(d.push(y),y[0]in f||(p=!1))}var k=this.filters_manager.alpha_filter?new V(this.filters_manager.alpha_filter):null,C=this.filters_manager.height_filter?new V(this.filters_manager.height_filter):null,M=new this.painter(d,u,c,this.config.to_key_value_dict(),n,k,C,a,function(t){return s.view.get_base_color(t)}),S=null;if(e.fillStyle=this.config.get_value("block_color"),e.font=e.canvas.manager.default_font,e.textAlign="right",t.data){var T=M.draw(e,l.width,l.height,r,f);S=T.feature_mapper,incomplete_features=T.incomplete_features,S.translation=-h}return o?void 0:new G(s,i,r,l,t.data,n,t.message,p,S,incomplete_features,a)}});var tt=function(t,e,n){Y.call(this,t,e,n),this.painter=m.default.VariantPainter,this.summary_draw_height=30,this.left_offset=30};A(tt.prototype,P.prototype,Y.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return l.union(P.prototype.config_params,[{key:"color",label:"Histogram color",type:"color"},{key:"show_sample_data",label:"Show sample data",type:"bool",default_value:!0},{key:"show_labels",label:"Show summary and sample labels",type:"bool",default_value:!0},{key:"summary_height",label:"Locus summary height",type:"float",default_value:20},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},draw_tile:function(t,e,n,i,r){if("bigwig"===t.dataset_type)return this._draw_line_track_tile(t,e,"Histogram",i,r);var a=this.view;return new this.painter(t.data,i.get("start"),i.get("end"),this.config.to_key_value_dict(),n,function(t){return a.get_base_color(t)}).draw(e,e.canvas.width,e.canvas.height,r),new U(this,i,r,e.canvas,t.data)},get_canvas_height:function(t,e,n,i){if("bigwig"===t.dataset_type)return this.summary_draw_height;var r=this.dataset.get_metadata("sample_names")?this.dataset.get_metadata("sample_names").length:0;return 0===r&&0!==t.data.length&&(r=t.data[0][7].match(/,/g),r=null===r?1:r.length+1),new this.painter(null,null,null,this.config.to_key_value_dict(),e).get_required_height(r)},predraw_init:function(){var t=[H.prototype.predraw_init.call(this)];return this.dataset.get_metadata("sample_names")||t.push(this.dataset.fetch()),t},postdraw_actions:function(e,n,i,r){Y.prototype.postdraw_actions.call(this,e,n,i,r);var a=l.filter(e,function(t){return t instanceof F}),o=this.dataset.get_metadata("sample_names");if(0===a.length&&this.config.get_value("show_labels")&&o&&o.length>1){var s;if(0===this.container_div.find(".yaxislabel.variant").length&&(s=this.config.get_value("summary_height")/2,this.tiles_div.prepend(t("<div/>").text("Summary").addClass("yaxislabel variant top").css({"font-size":s+"px",top:(this.config.get_value("summary_height")-s)/2+"px"})),this.config.get_value("show_sample_data"))){var u=o.join("<br/>");this.tiles_div.prepend(t("<div/>").html(u).addClass("yaxislabel variant top sample").css({top:this.config.get_value("summary_height")}))}s=("Squish"===this.mode?5:10)+"px",t(this.tiles_div).find(".sample").css({"font-size":s,"line-height":s}),t(this.tiles_div).find(".yaxislabel").css("color",this.config.get_value("label_color"))}else this.container_div.find(".yaxislabel.variant").remove()}});var et=function(t,e,n){Q.call(this,t,e,n),this.painter=m.default.ReadPainter,this.update_icons()};A(et.prototype,P.prototype,Y.prototype,Q.prototype,{build_config_params:function(){return l.union(P.prototype.config_params,[{key:"block_color",label:"Histogram color",type:"color"},{key:"detail_block_color",label:"Sense strand block color",type:"color",default_value:"#AAAAAA"},{key:"reverse_strand_color",label:"Antisense strand block color",type:"color",default_value:"#DDDDDD"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})}});var nt={CompositeTrack:W,DrawableGroup:j,DiagonalHeatmapTrack:Z,FeatureTrack:Q,LineTrack:K,ReadTrack:et,VariantTrack:tt,VcfTrack:tt},it=function(t,e,n){if("copy"in t)return t.copy(n);var i=t.obj_type;return i||(i=t.track_type),new nt[i](e,n,t)};e.default={TracksterView:D,DrawableGroup:j,LineTrack:K,FeatureTrack:Q,DiagonalHeatmapTrack:Z,ReadTrack:et,VariantTrack:tt,CompositeTrack:W,object_from_template:it}}).call(e,n(0),n(1))},function(t,e,n){"use strict";(function(t,i){Object.defineProperty(e,"__esModule",{value:!0});var r=n(2),a=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(r),o=t.View.extend({className:"track-header",initialize:function(){this.model.config.get("name").on("change:value",this.update_name,this),this.render()},render:function(){this.$el.append(i("<div/>").addClass(this.model.drag_handle_class)),this.$el.append(i("<div/>").addClass("track-name").text(this.model.config.get_value("name"))),this.action_icons={},this.render_action_icons(),this.$el.dblclick(function(t){t.stopPropagation()}),this.$el.append(i("<div style='clear: both'/>"))},update_name:function(){this.$el.find(".track-name").text(this.model.config.get_value("name"))},render_action_icons:function(){var t=this;this.icons_div=i("<div/>").addClass("track-icons").hide().appendTo(this.$el),a.each(this.model.action_icons_def,function(e){t.add_action_icon(e.name,e.title,e.css_class,e.on_click_fn,e.prepend,e.hide)}),this.set_display_modes(this.model.display_modes)},add_action_icon:function(t,e,n,r,a,o){var s=this;this.action_icons[t]=i("<a/>").attr("title",e).addClass("icon-button").addClass(n).tooltip().click(function(){r(s.model)}).appendTo(this.icons_div),o&&this.action_icons[t].hide()},set_display_modes:function(t,e){if(t){this.model.display_modes=t,this.model.mode=e||this.model.config.get_value("mode")||this.model.display_modes[0],this.action_icons.mode_icon.attr("title","Set display mode (now: "+this.mode+")");for(var n=this.model,i={},r=0,a=n.display_modes.length;r<a;r++){var o=n.display_modes[r];i[o]=function(t){return function(){n.change_mode(t)}}(o)}make_popupmenu(this.action_icons.mode_icon,i)}}});e.default={TrackHeaderView:o}}).call(e,n(1),n(0))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(i),a=r.extend,o=function(t,e){this.slot=t,this.feature=e},s=function(t,e,n,i){this.slots={},this.start_end_dct={},this.w_scale=t,this.mode=e,this.include_label="Pack"===e,this.max_rows=n,this.measureText=i};a(s.prototype,{_get_draw_coords:function(t){var e=Math.floor(t[1]*this.w_scale),n=Math.ceil(t[2]*this.w_scale),i=t[3];if(void 0!==i&&this.include_label){var r=this.measureText(i).width+7;e-r>=0?(e-=r,"left"):(n+=r,"right")}return[e,n]},_find_slot:function(t){for(var e=t[0],n=t[1],i=0;i<=this.max_rows;i++){var r=!1,a=this.start_end_dct[i];if(void 0!==a)for(var o=0,s=a.length;o<s;o++){var l=a[o];if(n>l[0]&&e<l[1]){r=!0;break}}if(!r)return i}return-1},slot_features:function(t){for(var e,n,i=this.start_end_dct,r=[],a=0,s=0,l=t.length;s<l;s++){e=t[s],n=e[0];var u=this.slots[n];if(u){if(e[1]<u.feature[1]||u.feature[2]<e[2])for(var c=this._get_draw_coords(u.feature),h=this._get_draw_coords(e),d=this.start_end_dct[u.slot],f=0;f<d.length;f++){var p=d[f];p[0]===c[0]&&p[1]===c[1]&&(d[f]=h)}a=Math.max(a,this.slots[n].slot)}else r.push(s)}for(var s=0,l=r.length;s<l;s++){e=t[r[s]],n=e[0];var _=this._get_draw_coords(e),g=this._find_slot(_);g>=0&&(void 0===i[g]&&(i[g]=[]),i[g].push(_),this.slots[n]=new o(g,e),a=Math.max(a,g))}return a+1}}),e.default={FeatureSlotter:s}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(i),a=function(t,e){var n=t[0],i=t[1],r=e[0],a=e[1];return n<r?i<=r?1001:i<=a?1003:1002:n>a?1006:i<=a?1005:1004},o=function(t,e){var n=a(t,e);return 1001!==n&&1006!==n},s=function(t,e,n,i,r,a){void 0===a&&(a=4);var o,s=i-e,l=r-n,u=Math.floor(Math.sqrt(s*s+l*l)/a),c=s/u,h=l/u;for(o=0;o<u;o++,e+=c,n+=h)o%2==0&&t.fillRect(e,n,a,1)},l=function(t,e,n,i){var r=e-i/2,a=e+i/2,o=n-Math.sqrt(3*i/2);t.beginPath(),t.moveTo(r,o),t.lineTo(a,o),t.lineTo(e,n),t.lineTo(r,o),t.strokeStyle=this.fillStyle,t.fill(),t.stroke(),t.closePath()},u=function(t){this.default_val=t||1};u.prototype.gen_val=function(t){return this.default_val};var c=function(t){this.incomplete_features=t.incomplete_features,this.feature_mapper=t.feature_mapper},h=function(t,e,n,i,a){this.data=t,this.view_start=e,this.view_end=n,this.prefs=r.extend({},this.default_prefs,i),this.mode=a};h.prototype.default_prefs={},h.prototype.draw=function(t,e,n,i){},h.prototype.get_start_draw_pos=function(t,e){return this._chrom_pos_to_draw_pos(t,e,-.5)},h.prototype.get_end_draw_pos=function(t,e){return this._chrom_pos_to_draw_pos(t,e,.5)},h.prototype.get_draw_pos=function(t,e){return this._chrom_pos_to_draw_pos(t,e,0)},h.prototype._chrom_pos_to_draw_pos=function(t,e,n){return Math.floor(e*(Math.max(0,t-this.view_start)+n))};var d=function(t,e,n,i,r){h.call(this,t,e,n,i,r)};d.prototype.default_prefs={min_value:void 0,max_value:void 0,mode:"Histogram",color:"#000",overflow_color:"#F66"},d.prototype.draw=function(t,e,n,i){var a=!1,o=this.prefs.min_value,s=this.prefs.max_value,l=s-o,u=n,c=this.view_start,h=this.mode,d=this.data;t.save();var f=Math.round(n+o/l*n);"Intensity"!==h&&(t.fillStyle="#aaa",t.fillRect(0,f,e,1)),t.beginPath();var p,_,g;g=d.length>1?r.map(d.slice(0,-1),function(t,e){return Math.ceil((d[e+1][0]-d[e][0])*i)}):[10];for(var v,m=this.prefs.block_color||this.prefs.color,y=parseInt(m.slice(1),16),b=(16711680&y)>>16,w=(65280&y)>>8,x=255&y,k=!1,C=!1,M=0,S=d.length;M<S;M++)if(t.fillStyle=t.strokeStyle=m,k=C=!1,v=g[M],p=Math.floor((d[M][0]-c-.5)*i),null!==(_=d[M][1])){if(_<o?(C=!0,_=o):_>s&&(k=!0,_=s),"Histogram"===h)_=Math.round(_/l*u),t.fillRect(p,f,v,-_);else if("Intensity"===h){var T=(_-o)/l,$=Math.round(b+(255-b)*(1-T)),A=Math.round(w+(255-w)*(1-T)),E=Math.round(x+(255-x)*(1-T));t.fillStyle="rgb("+$+","+A+","+E+")",t.fillRect(p,0,v,u)}else _=Math.round(u-(_-o)/l*u),a?t.lineTo(p,_):(a=!0,"Filled"===h?(t.moveTo(p,u),t.lineTo(p,_)):t.moveTo(p,_));if(t.fillStyle=this.prefs.overflow_color,k||C){var O;"Histogram"===h||"Intensity"===h?O=v:(p-=2,O=4),k&&t.fillRect(p,0,O,3),C&&t.fillRect(p,u-3,O,3)}t.fillStyle=m}else a&&"Filled"===h&&t.lineTo(p,u),a=!1;"Filled"===h?(a&&(t.lineTo(p,f),t.lineTo(0,f)),t.fill()):t.stroke(),t.restore()};var f=function(t){this.feature_positions={},this.slot_height=t,this.translation=0,this.y_translation=0};f.prototype.map_feature_data=function(t,e,n,i){this.feature_positions[e]||(this.feature_positions[e]=[]),this.feature_positions[e].push({data:t,x_start:n,x_end:i})},f.prototype.get_feature_data=function(t,e){var n,i=Math.floor((e-this.y_translation)/this.slot_height);if(!this.feature_positions[i])return null;t+=this.translation;for(var r=0;r<this.feature_positions[i].length;r++)if(n=this.feature_positions[i][r],t>=n.x_start&&t<=n.x_end)return n.data};var p=function(t,e,n,i,r,a,o){h.call(this,t,e,n,i,r),this.alpha_scaler=a||new u,this.height_scaler=o||new u,this.max_label_length=200};p.prototype.default_prefs={block_color:"#FFF",connector_color:"#FFF"},r.extend(p.prototype,{get_required_height:function(t,e){var n=this.get_row_height(),i=n,r=this.mode;return"no_detail"!==r&&"Squish"!==r&&"Pack"!==r||(n=t*i),n+this.get_top_padding(e)},get_top_padding:function(t){return 0},draw:function(t,e,n,i,r){var a=this.data,o=this.view_start,s=this.view_end;t.save(),t.fillStyle=this.prefs.block_color,t.textAlign="right";for(var l,u=this.get_row_height(),h=new f(u),d=[],p=0,_=a.length;p<_;p++){var g=a[p],v=g[0],m=g[1],y=g[2],b=r&&void 0!==r[v]?r[v].slot:null;("Dense"===this.mode||null!==b)&&m<s&&y>o&&(l=this.draw_element(t,this.mode,g,b,o,s,i,u,e),h.map_feature_data(g,b,l[0],l[1]),(m<o||y>s)&&d.push(g))}return t.restore(),h.y_translation=this.get_top_padding(e),new c({incomplete_features:d,feature_mapper:h})},draw_element:function(t,e,n,i,r,a,o,s,l){return[0,0]}});var _=function(t,e,n,i,r,a,o){p.call(this,t,e,n,i,r,a,o),this.draw_background_connector=!0,this.draw_individual_connectors=!1};r.extend(_.prototype,p.prototype,{get_row_height:function(){var t=this.mode;return"Dense"===t?10:"no_detail"===t?3:"Squish"===t?5:10},draw_element:function(t,e,n,i,r,a,o,s,l){var u,c=(n[0],n[1]),h=n[2],d=n[3],f=n[4],p=Math.floor(Math.max(0,(c-r-.5)*o)),_=Math.ceil(Math.min(l,Math.max(0,(h-r-.5)*o))),g=p,v=_,u=("Dense"===e?0:0+i)*s+this.get_top_padding(l),m=null,y=null,b=f&&"+"!==f&&"."!==f?this.prefs.reverse_strand_color:this.prefs.block_color,w=this.prefs.label_color;if(t.globalAlpha=this.alpha_scaler.gen_val(n),"Dense"===e&&(i=1),"no_detail"===e)t.fillStyle=b,t.fillRect(p,u+5,_-p,1);else{var x=n[5],k=n[6],C=n[7],M=!0;x&&k&&(m=Math.floor(Math.max(0,(x-r)*o)),y=Math.ceil(Math.min(l,Math.max(0,(k-r)*o))));var S,T;if("Squish"===e?(S=1,T=3,M=!1):(S=5,T=9),C){var $,A;"Squish"===e||"Dense"===e?($=u+Math.floor(1.5)+1,A=1):f?($=u,A=T):($+=2.5,A=1),this.draw_background_connector&&("Squish"===e||"Dense"===e?t.fillStyle="#ccc":f?"+"===f?t.fillStyle=t.canvas.manager.get_pattern("right_strand"):"-"===f&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand")):t.fillStyle="#ccc",t.fillRect(p,$,_-p,A));for(var E=0,O=C.length;E<O;E++){var z,R,N=C[E],P=Math.floor(Math.max(0,(N[0]-r-.5)*o)),q=Math.ceil(Math.min(l,Math.max((N[1]-r-.5)*o)));if(!(P>q)){if(t.fillStyle=b,t.fillRect(P,u+(T-S)/2+1,q-P,S),void 0!==m&&k>x&&!(P>y||q<m)){var j=Math.max(P,m),D=Math.min(q,y);t.fillRect(j,u+1,D-j,T),1===C.length&&"Pack"===e&&("+"===f?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===f&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),j+14<D&&(j+=2,D-=2),t.fillRect(j,u+1,D-j,T))}this.draw_individual_connectors&&z&&this.draw_connector(t,z,R,P,q,u),z=P,R=q}}if("Pack"===e){t.globalAlpha=1,t.fillStyle="white";var L=this.height_scaler.gen_val(n),I=Math.ceil(T*L),B=Math.round((T-I)/2);1!==L&&(t.fillRect(p,$+1,_-p,B),t.fillRect(p,$+T-B+1,_-p,B))}}else t.fillStyle=b,t.fillRect(p,u+1,_-p,T),f&&M&&("+"===f?t.fillStyle=t.canvas.manager.get_pattern("right_strand_inv"):"-"===f&&(t.fillStyle=t.canvas.manager.get_pattern("left_strand_inv")),t.fillRect(p,u+1,_-p,T));t.globalAlpha=1,d&&"Pack"===e&&c>r&&(t.fillStyle=w,0===r&&p-t.measureText(d).width<0?(t.textAlign="left",t.fillText(d,_+2,u+8,this.max_label_length),v+=t.measureText(d).width+2):(t.textAlign="right",t.fillText(d,p-2,u+8,this.max_label_length),g-=t.measureText(d).width+2))}return t.globalAlpha=1,[g,v]}});var g=function(t,e,n,i,r,a,o,s,l){p.call(this,t,e,n,i,r,a,o),this.ref_seq=s?s.data:null,this.base_color_fn=l};r.extend(g.prototype,p.prototype,{get_row_height:function(){var t,e=this.mode;return"Dense"===e?t=10:"Squish"===e?t=5:(t=10,this.prefs.show_insertions&&(t*=2)),t},_parse_cigar:function(t){var e="MIDNSHP=X",n=[[0,0]],i=n[0],a=0,o=r.map(t.match(/[0-9]+[MIDNSHP=X]/g),function(t){var r=parseInt(t.slice(0,-1),10),o=t.slice(-1);return"N"===o?0!==i[1]&&(i=[a+r,a+r],n.push(i)):-1==="ISHP".indexOf(o)&&(i[1]+=r,a+=r),[e.indexOf(o),r]});return{blocks:n,cigar:o}},draw_read:function(t,e,n,i,r,s,u,c,h,d){var f=function(t){return Math.floor(Math.max(0,(t-r-.5)*n))};t.textAlign="center";var p,_,g=[r,s],v=0,m=0,y=Math.round(n/2),b=t.canvas.manager.char_width_px,w="+"===h?this.prefs.detail_block_color:this.prefs.reverse_strand_color,k="Pack"===e,C=k?9:3,M=i+1,S=new x(t,C,n,e),T=[],$=[],A=this._parse_cigar(c);c=A.cigar,T=A.blocks;for(var E=0;E<T.length;E++){var O=T[E];o([u+O[0],u+O[1]],g)&&(p=f(u+O[0]),_=f(u+O[1]),p===_&&(_+=1),t.fillStyle=w,t.fillRect(p,M,_-p,C))}for(var z=0,R=c.length;z<R;z++){var N=c[z],P="MIDNSHP=X"[N[0]],q=N[1],j=u+v;if(p=f(j),_=f(j+q),o([j,j+q],g))switch(p===_&&(_+=1),P){case"H":case"S":case"P":break;case"M":v+=q;break;case"=":case"X":var D="";"X"===P?D=d.slice(m,m+q):this.ref_seq&&(D=this.ref_seq.slice(Math.max(0,j-r),Math.min(j-r+q,s-r)));for(var L=Math.max(j,r),I=0;I<D.length;I++)if(D&&!this.prefs.show_differences||"X"===P){var B=Math.floor(Math.max(0,(L+I-r)*n));t.fillStyle=this.base_color_fn(D[I]),k&&n>b?t.fillText(D[I],B,i+9):n>.05&&t.fillRect(B-y,M,Math.max(1,Math.round(n)),C)}"X"===P&&(m+=q),v+=q;break;case"N":t.fillStyle="#ccc",t.fillRect(p,M+(C-1)/2,_-p,1),v+=q;break;case"D":S.draw_deletion(p,M,q),v+=q;break;case"I":var V=p-y;if(o([j,j+q],g)){var U=d.slice(m,m+q);if(this.prefs.show_insertions){var F=p-(_-p)/2;if(("Pack"===e||"Auto"===this.mode)&&void 0!==d&&n>b){switch(t.fillStyle="yellow",t.fillRect(F-y,i-9,_-p,9),$[$.length]={type:"triangle",data:[V,i+4,5]},t.fillStyle="#ccc",a([j,j+q],g)){case 1003:U=U.slice(r-j);break;case 1004:U=U.slice(0,j-s);break;case 1005:break;case 1002:U=U.slice(r-j,j-s)}for(var I=0,G=U.length;I<G;I++){var B=Math.floor(Math.max(0,(j+I-r)*n));t.fillText(U[I],B-(_-p)/2,i)}}else t.fillStyle="yellow",t.fillRect(F,i+("Dense"!==this.mode?2:5),_-p,"Dense"!==e?3:9)}else("Pack"===e||"Auto"===this.mode)&&void 0!==d&&n>b&&$.push({type:"text",data:[U.length,V,i+9]})}m+=q}else v=function(t,e,n){return-1!=="M=NXD".indexOf(e)&&(t+=n),t}(v,P,q),m=function(t,e,n){return-1!=="IX".indexOf(e)&&(t+=n),t}(m,P,q)}t.fillStyle="yellow";for(var H,Y,X,E=0;E<$.length;E++)H=$[E],Y=H.type,X=H.data,"text"===Y?(t.save(),t.font="bold "+t.font,t.fillText(X[0],X[1],X[2]),t.restore()):"triangle"===Y&&l(t,X[0],X[1],X[2])},draw_element:function(t,e,n,i,r,a,o,l,u){var c=(n[0],n[1]),h=n[2],d=n[3],f=Math.floor(Math.max(-.5*o,(c-r-.5)*o)),p=Math.ceil(Math.min(u,Math.max(0,(h-r-.5)*o))),_=("Dense"===e?0:0+i)*l,g="Pack"===e?9:3;this.prefs.label_color;if(n[5]instanceof Array){var v=!0;n[4][1]>=r&&n[4][0]<=a&&n[4][2]?this.draw_read(t,e,o,_,r,a,n[4][0],n[4][2],n[4][3],n[4][4]):v=!1,n[5][1]>=r&&n[5][0]<=a&&n[5][2]?this.draw_read(t,e,o,_,r,a,n[5][0],n[5][2],n[5][3],n[5][4]):v=!1;var m=Math.ceil(Math.min(u,Math.max(-.5*o,(n[4][1]-r-.5)*o))),y=Math.floor(Math.max(-.5*o,(n[5][0]-r-.5)*o));if(v&&y>m){t.fillStyle="#ccc";var b=_+1+(g-1)/2;s(t,m,b,y,b)}}else this.draw_read(t,e,o,_,r,a,c,n[4],n[5],n[6]);return"Pack"===e&&c>=r&&"."!==d&&(t.fillStyle=this.prefs.label_color,0===r&&f-t.measureText(d).width<0?(t.textAlign="left",t.fillText(d,p+2,_+9,this.max_label_length)):(t.textAlign="right",t.fillText(d,f-2,_+9,this.max_label_length))),[0,0]}});var v=function(t,e,n,i,r,a,o){_.call(this,t,e,n,i,r,a,o),this.longest_feature_length=this.calculate_longest_feature_length(),this.draw_background_connector=!1,this.draw_individual_connectors=!0};r.extend(v.prototype,p.prototype,_.prototype,{calculate_longest_feature_length:function(){for(var t=0,e=0,n=this.data.length;e<n;e++){var i=this.data[e],r=i[1],a=i[2];t=Math.max(t,a-r)}return t},get_top_padding:function(t){var e=this.view_end-this.view_start,n=t/e;return Math.min(128,Math.ceil(this.longest_feature_length/2*n))},draw_connector:function(t,e,n,i,r,a){var o=(n+i)/2,s=i-o;Math.PI;s>0&&(t.beginPath(),t.arc(o,a,i-o,Math.PI,0),t.stroke())}});var m=function(t,e){Array.isArray(t)?this.rgb=t:6==t.length?this.rgb=t.match(/.{2}/g).map(function(t){return parseInt(t,16)}):7==t.length?this.rgb=t.substring(1,7).match(/.{2}/g).map(function(t){return parseInt(t,16)}):this.rgb=t.split("").map(function(t){return parseInt(t+t,16)}),this.alpha="number"==typeof e?e:1};m.prototype={eval:function(){return this},toCSS:function(){return this.alpha<1?"rgba("+this.rgb.map(function(t){return Math.round(t)}).concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(t){return t=Math.round(t),t=(t>255?255:t<0?0:t).toString(16),1===t.length?"0"+t:t}).join("")},toHSL:function(){var t,e,n=this.rgb[0]/255,i=this.rgb[1]/255,r=this.rgb[2]/255,a=this.alpha,o=Math.max(n,i,r),s=Math.min(n,i,r),l=(o+s)/2,u=o-s;if(o===s)t=e=0;else{switch(e=l>.5?u/(2-o-s):u/(o+s),o){case n:t=(i-r)/u+(i<r?6:0);break;case i:t=(r-n)/u+2;break;case r:t=(n-i)/u+4}t/=6}return{h:360*t,s:e,l:l,a:a}},toARGB:function(){return"#"+[Math.round(255*this.alpha)].concat(this.rgb).map(function(t){return t=Math.round(t),t=(t>255?255:t<0?0:t).toString(16),1===t.length?"0"+t:t}).join("")},mix:function(t,e){var n=this,i=e,r=2*i-1,a=n.toHSL().a-t.toHSL().a,o=((r*a==-1?r:(r+a)/(1+r*a))+1)/2,s=1-o,l=[n.rgb[0]*o+t.rgb[0]*s,n.rgb[1]*o+t.rgb[1]*s,n.rgb[2]*o+t.rgb[2]*s],u=n.alpha*i+t.alpha*(1-i);return new m(l,u)}};var y=function(t,e,n,i){this.start_color=new m(t),this.end_color=new m(e),this.start_value=n,this.end_value=i,this.value_range=i-n};y.prototype.map_value=function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t=(t-this.start_value)/this.value_range,this.start_color.mix(this.end_color,1-t).toCSS()};var b=function(t,e,n,i,r){this.positive_ramp=new y(e,n,0,r),this.negative_ramp=new y(e,t,0,-i),this.start_value=i,this.end_value=r};b.prototype.map_value=function(t){return t=Math.max(t,this.start_value),t=Math.min(t,this.end_value),t>=0?this.positive_ramp.map_value(t):this.negative_ramp.map_value(-t)};var w=function(t,e,n,i,r){h.call(this,t,e,n,i,r);var a,o;if(void 0===this.prefs.min_value){var s=1/0;for(a=0,o=this.data.length;a<o;a++)s=Math.min(s,this.data[a][6]);this.prefs.min_value=s}if(void 0===this.prefs.max_value){var l=-1/0;for(a=0,o=this.data.length;a<o;a++)l=Math.max(l,this.data[a][6]);this.prefs.max_value=l}};w.prototype.default_prefs={min_value:void 0,max_value:void 0,mode:"Heatmap",pos_color:"#FF8C00",neg_color:"#4169E1"},w.prototype.draw=function(t,e,n,i){var r,a,o,s,l,u,c=this.prefs.min_value,h=this.prefs.max_value,d=this.view_start,f=(this.mode,this.data),p=1/Math.sqrt(2),_=new b(this.prefs.neg_color,"#FFFFFF",this.prefs.pos_color,c,h),g=function(t){return(t-d)*i};t.save(),t.rotate(-45*Math.PI/180),t.scale(p,p);for(var v=0,m=f.length;v<m;v++)r=f[v],a=g(r[1]),o=g(r[2]),s=g(r[4]),l=g(r[5]),u=r[6],t.fillStyle=_.map_value(u),t.fillRect(a,s,o-a,l-s);t.restore()};var x=function(t,e,n,i){this.ctx=t,this.row_height=e,this.px_per_base=n,this.draw_details=("Pack"===i||"Auto"===i)&&n>=t.canvas.manager.char_width_px,this.delete_details_thickness=.2};r.extend(x.prototype,{draw_deletion:function(t,e,n){this.ctx.fillStyle="black";var i=(this.draw_details?this.delete_details_thickness:1)*this.row_height;e+=.5*(this.row_height-i),this.ctx.fillRect(t,e,n*this.px_per_base,i)}});var k=function(t,e,n,i,r,a){h.call(this,t,e,n,i,r),this.base_color_fn=a,this.divider_height=1};r.extend(k.prototype,h.prototype,{get_row_height:function(){var t=this.mode;return"Dense"===t?10:"Squish"===t?5:10},get_required_height:function(t){var e=this.prefs.summary_height;return t>1&&this.prefs.show_sample_data&&(e+=this.divider_height+t*this.get_row_height()),e},draw:function(t,e,n,i){t.save();var a,o,s,l,u,c,h,d,f,p,_,g=function(t,e){var n=t.length,i=e.length,r=0,a=1,o=null;return"-"===e?(o="deletion",a=t.length):0===t.indexOf(e)&&n>i?(o="deletion",a=n-i,r=i):0===e.indexOf(t)&&n<i&&(o="insertion",a=i-n,r=i),null!==o?{type:o,start:r,len:a}:{}},v=Math.max(1,Math.floor(i)),m=this.data.length?this.data[0][7].split(",").length:0,y="Squish"===this.mode?5:10,b=i<.1?y:"Squish"===this.mode?3:9,w=!0,k=new x(t,y,i,this.mode);1===m&&(y=b=i<t.canvas.manager.char_width_px?this.prefs.summary_height:y,k.row_height=y,w=!1),this.prefs.show_sample_data&&w&&(t.fillStyle="#F3F3F3",t.globalAlpha=1,t.fillRect(0,this.prefs.summary_height-this.divider_height,e,this.divider_height)),t.textAlign="center";for(var C=0;C<this.data.length;C++)if(a=this.data[C],o=a[1],s=a[3],l=[a[4].split(",")],u=a[7].split(","),c=a.slice(8),l=r.map(r.flatten(l),function(t){var e={type:"snp",value:t,start:0},n=g(s,t);return r.extend(e,n)}),!(o<this.view_start||o>this.view_end)){if(w)for(t.fillStyle="#999999",t.globalAlpha=1,_=0;_<l.length;_++)for(d=this.get_start_draw_pos(o+l[_].start,i),t.fillRect(d,0,v,this.prefs.summary_height),f=this.prefs.summary_height,_=0;_<l.length;_++){t.fillStyle="deletion"===l[_].type?"black":this.base_color_fn(l[_].value);var M=c/u.length,S=Math.ceil(this.prefs.summary_height*M);t.fillRect(d,f-S,v,S),f-=S}if(this.prefs.show_sample_data)for(f=w?this.prefs.summary_height+this.divider_height:0,_=0;_<u.length;_++,f+=y)if(p=u[_]?u[_].split(/\/|\|/):["0","0"],h=null,p[0]===p[1]?"."===p[0]||"0"!==p[0]&&(h=l[parseInt(p[0],10)-1],t.globalAlpha=1):(h="0"!==p[0]?p[0]:p[1],h=l[parseInt(h,10)-1],t.globalAlpha=.5),h)if(d=this.get_start_draw_pos(o+h.start,i),"snp"===h.type){var T=h.value;t.fillStyle=this.base_color_fn(T),k.draw_details?t.fillText(T,this.get_draw_pos(o,i),f+y):t.fillRect(d,f+1,v,b)}else"deletion"===h.type&&k.draw_deletion(d,f+1,h.len)}t.restore()}}),e.default={Scaler:u,LinePainter:d,LinkedFeaturePainter:_,ReadPainter:g,ArcLinkedFeaturePainter:v,DiagonalHeatmapPainter:w,VariantPainter:k}},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(2),r=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(i),a=r.extend,o=function(t){this.manager=null,this.name=t.name,this.index=t.index,this.tool_id=t.tool_id,this.tool_exp_name=t.tool_exp_name};a(o.prototype,{to_dict:function(){return{name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name}}});var s=function(e,n,i){return t("<a/>").attr("href","javascript:void(0);").attr("title",e).addClass("icon-button").addClass(n).tooltip().click(i)},l=function(e){o.call(this,e),this.low="low"in e?e.low:-Number.MAX_VALUE,this.high="high"in e?e.high:Number.MAX_VALUE,this.min="min"in e?e.min:Number.MAX_VALUE,this.max="max"in e?e.max:-Number.MAX_VALUE,this.container=null,this.slider=null,this.slider_label=null;var n=this;n.parent_div=t("<div/>").addClass("filter-row slider-row");var i=t("<div/>").addClass("elt-label").appendTo(n.parent_div),r=(t("<span/>").addClass("slider-name").text(n.name+"  ").appendTo(i),t("<span/>").text(this.low+"-"+this.high)),a=t("<span/>").addClass("slider-value").appendTo(i).append("[").append(r).append("]");n.values_span=r;var l=t("<div/>").addClass("slider").appendTo(n.parent_div);n.control_element=t("<div/>").attr("id",n.name+"-filter-control").appendTo(l),n.control_element.slider({range:!0,min:this.min,max:this.max,step:this.get_slider_step(this.min,this.max),values:[this.low,this.high],slide:function(t,e){n.slide(t,e)},change:function(t,e){n.control_element.slider("option","slide").call(n.control_element,t,e)}}),n.slider=n.control_element,n.slider_label=r,function(e,n,i){e.click(function(){var e=n.text(),r=parseFloat(i.slider("option","max")),a=r<=1?4:r<=1e6?r.toString().length:6,o=!1,s=t(this).parents(".slider-row");s.addClass("input"),i.slider("option","values")&&(a=2*a+1,o=!0),n.text(""),t("<input type='text'/>").attr("size",a).attr("maxlength",a).attr("value",e).appendTo(n).focus().select().click(function(t){t.stopPropagation()}).blur(function(){t(this).remove(),n.text(e),s.removeClass("input")}).keyup(function(e){if(27===e.keyCode)t(this).trigger("blur");else if(13===e.keyCode){var n=i.slider("option","min"),r=i.slider("option","max"),a=function(t){return isNaN(t)||t>r||t<n},l=t(this).val();if(o){if(l=l.split("-"),l=[parseFloat(l[0]),parseFloat(l[1])],a(l[0])||a(l[1]))return alert("Parameter value must be in the range ["+n+"-"+r+"]"),t(this)}else if(l=parseFloat(l),a(l))return alert("Parameter value must be in the range ["+n+"-"+r+"]"),t(this);i.slider(o?"values":"value",l),s.removeClass("input")}})})}(a,r,n.control_element);var u=t("<div/>").addClass("display-controls").appendTo(n.parent_div);this.transparency_icon=s("Use filter for data transparency","layer-transparent",function(){n.manager.alpha_filter!==n?(n.manager.alpha_filter=n,n.manager.parent_div.find(".layer-transparent").removeClass("active").hide(),n.transparency_icon.addClass("active").show()):(n.manager.alpha_filter=null,n.transparency_icon.removeClass("active")),n.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(u).hide(),this.height_icon=s("Use filter for data height","arrow-resize-090",function(){n.manager.height_filter!==n?(n.manager.height_filter=n,n.manager.parent_div.find(".arrow-resize-090").removeClass("active").hide(),n.height_icon.addClass("active").show()):(n.manager.height_filter=null,n.height_icon.removeClass("active")),n.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(u).hide(),n.parent_div.hover(function(){n.transparency_icon.show(),n.height_icon.show()},function(){n.manager.alpha_filter!==n&&n.transparency_icon.hide(),n.manager.height_filter!==n&&n.height_icon.hide()}),t("<div style='clear: both;'/>").appendTo(n.parent_div)};a(l.prototype,{to_dict:function(){var t=o.prototype.to_dict.call(this);return a(t,{type:"number",min:this.min,max:this.max,low:this.low,high:this.high})},copy:function(){return new l({name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name})},get_slider_step:function(t,e){return e-t<=2?.01:1},slide:function(t,e){var n=e.values;this.values_span.text(n[0]+"-"+n[1]),this.low=n[0],this.high=n[1];var i=this;setTimeout(function(){n[0]===i.low&&n[1]===i.high&&i.manager.track.request_draw({force:!0,clear_after:!0})},25)},applies_to:function(t){return t.length>this.index},_keep_val:function(t){return isNaN(t)||t>=this.low&&t<=this.high},keep:function(t){if(!this.applies_to(t))return!0;var e=t[this.index];if(e instanceof Array){for(var n=!0,i=0;i<e.length;i++)if(!this._keep_val(e[i])){n=!1;break}return n}return this._keep_val(t[this.index])},update_attrs:function(t){var e=!1;if(!this.applies_to(t))return e;var n=t[this.index];n instanceof Array||(n=[n]);for(var i=0;i<n.length;i++){var r=n[i];r<this.min&&(this.min=Math.floor(r),e=!0),r>this.max&&(this.max=Math.ceil(r),e=!0)}return e},update_ui_elt:function(){this.min<this.max?this.parent_div.show():this.parent_div.hide();var t=this.slider.slider("option","min"),e=this.slider.slider("option","max");(this.min<t||this.max>e)&&(this.slider.slider("option","min",this.min),this.slider.slider("option","max",this.max),this.slider.slider("option","step",this.get_slider_step(this.min,this.max)),this.slider.slider("option","values",[this.min,this.max]))}});var u=function(e,n){if(this.track=e,this.alpha_filter=null,this.height_filter=null,this.filters=[],this.parent_div=t("<div/>").addClass("filters").hide(),this.parent_div.bind("drag",function(t){t.stopPropagation()}).click(function(t){t.stopPropagation()}).bind("dblclick",function(t){t.stopPropagation()}).bind("keydown",function(t){t.stopPropagation()}),n&&"filters"in n){for(var i,r=("alpha_filter"in n?n.alpha_filter:null),a=("height_filter"in n?n.height_filter:null),o=n.filters,s=0;s<o.length;s++)"number"===o[s].type?(i=new l(o[s]),this.add_filter(i),i.name===r&&(this.alpha_filter=i,i.transparency_icon.addClass("active").show()),i.name===a&&(this.height_filter=i,i.height_icon.addClass("active").show())):console.log("ERROR: unsupported filter: ",name,type);"visible"in n&&n.visible&&this.parent_div.show()}if(0!==this.filters.length){var u=t("<div/>").addClass("param-row").appendTo(this.parent_div),c=this;t("<input type='submit'/>").attr("value","Run on complete dataset").appendTo(u).click(function(){c.run_on_dataset()})}};a(u.prototype,{show:function(){this.parent_div.show()},hide:function(){this.parent_div.hide()},toggle:function(){this.parent_div.toggle()},visible:function(){return this.parent_div.is(":visible")},to_dict:function(){for(var t,e={},n=[],i=0;i<this.filters.length;i++)t=this.filters[i],n.push(t.to_dict());return e.filters=n,e.alpha_filter=this.alpha_filter?this.alpha_filter.name:null,e.height_filter=this.height_filter?this.height_filter.name:null,e.visible=this.parent_div.is(":visible"),e},copy:function(t){for(var e=new u(t),n=0;n<this.filters.length;n++)e.add_filter(this.filters[n].copy());return e},add_filter:function(t){t.manager=this,this.parent_div.append(t.parent_div),this.filters.push(t)},remove_all:function(){this.filters=[],this.parent_div.children().remove()},init_filters:function(){for(var t=0;t<this.filters.length;t++){this.filters[t].update_ui_elt()}},clear_filters:function(){for(var t=0;t<this.filters.length;t++){var e=this.filters[t];e.slider.slider("option","values",[e.min,e.max])}this.alpha_filter=null,this.height_filter=null,this.parent_div.find(".icon-button").hide()},run_on_dataset:function(){for(var e,n,i=(function(t,e,n){return e in t||(t[e]=n),t[e]}),r={},a=0;a<this.filters.length;a++)e=this.filters[a],e.tool_id&&(e.min!==e.low&&(n=i(r,e.tool_id,[]),n[n.length]=e.tool_exp_name+" >= "+e.low),e.max!==e.high&&(n=i(r,e.tool_id,[]),n[n.length]=e.tool_exp_name+" <= "+e.high));var o=[];for(var s in r)o[o.length]=[s,r[s]];!function e(n,i){var r=i[0],a=r[0],o=r[1],s="("+o.join(") and (")+")",l={cond:s,input:n,target_dataset_id:n,tool_id:a};i=i.slice(1),t.getJSON(run_tool_url,l,function(t){t.error?Galaxy.modal.show({title:"Filter Dataset",body:"Error running tool "+a,buttons:{Close:Galaxy.modal.hide()}}):0===i.length?Galaxy.modal.show({title:"Filtering Dataset",body:"Filter(s) are running on the complete dataset. Outputs are in dataset's history.",buttons:{Close:Galaxy.modal.hide()}}):e(t.dataset_id,i)})}(this.track.dataset_id,o)}}),e.default={FiltersManager:u,NumberFilter:l}}).call(e,n(0))},function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var i=n(13),r=function(t){return t&&t.__esModule?t:{default:t}}(i),a=n(152),o=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}(a),s=r.default.GenomeDataManager.extend({load_data:function(e,n,i,r){var a=t.Deferred();this.set_data(e,a);var s=Galaxy.root+"datasets/"+this.get("dataset").id+"/display",l=this;new t.Deferred;return t.when(o.makeBwg(s)).then(function(n,i){t.when(n.readWigData(e.get("chrom"),e.get("start"),e.get("end"))).then(function(t){var n=[],i={max:Number.MIN_VALUE};t.forEach(function(t){i.max!==t.min-1&&(n.push([i.max+1,0]),n.push([t.min-2,0])),n.push([t.min-1,t.score]),n.push([t.max,t.score]),i=t});var r={data:n,region:e,dataset_type:"bigwig"};l.set_data(e,r),a.resolve(r)})}),a}});e.default={BBIDataManager:s}}).call(e,n(0))},function(t,e,n){(function(i){var r,a;r=[n(153),n(154),n(155)],void 0!==(a=function(t,e){"use strict";function n(){}function r(t){t&&(this.id=t)}function a(t,e){return t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function o(t,e,n){Math.pow(10,6);return i.ajax({type:"GET",dataType:"native",url:t,timeout:5e3,beforeSend:function(t){t.setRequestHeader("Range","bytes="+e+"-"+(e+(n-1)))},xhrFields:{responseType:"arraybuffer"}})}function s(t,e){return t[e]+t[e+1]*w+t[e+2]*x+t[e+3]*k+t[e+4]*C}function l(){}function u(t,e,n,i){this.bwg=t,this.cirTreeOffset=e,this.cirTreeLength=n,this.isSummary=i}function c(t){var e=i.Deferred(),n=new l;return n.url=t,i.when(o(n.url,0,512)).then(function(t){if(!t)return e.resolve(null,"Couldn't fetch file");var r=t,a=new Uint8Array(r),o=new Int16Array(r),l=new Int32Array(r),u=a[0]+w*a[1]+x*a[2]+k*a[3];if(u==v)n.type="bigwig";else{if(u!=y)return u==m||u==b?e.resolve(null,"Currently don't support big-endian BBI files"):e.resolve(null,"Not a supported format, magic=0x"+u.toString(16));n.type="bigbed"}n.version=o[2],n.numZoomLevels=o[3],n.chromTreeOffset=s(a,8),n.unzoomedDataOffset=s(a,16),n.unzoomedIndexOffset=s(a,24),n.fieldCount=o[16],n.definedFieldCount=o[17],n.asOffset=s(a,36),n.totalSummaryOffset=s(a,44),n.uncompressBufSize=l[13],n.extHeaderOffset=s(a,56),n.zoomLevels=[];for(var c=0;c<n.numZoomLevels;++c){var h=l[6*c+16],d=s(a,24*c+72),f=s(a,24*c+80);n.zoomLevels.push({reduction:h,dataOffset:d,indexOffset:f})}i.when(n.readChromTree()).then(function(){n.getAutoSQL(function(t){return n.schema=t,e.resolve(n)})})}),e}function h(t,e,n,i,r){this.bbi=t,this.type=e,this.fieldCount=n,this.offset=i,this.field=r}var d=t.Range,f=t.union,p=t.intersection,_=e.inflateBuffer,g=e.arrayCopy,v=2291137574,m=654086024,y=2273964779,b=3958540679,w=256,x=65536,k=16777216,C=4294967296,M=new RegExp("^[0-9]+,[0-9]+,[0-9]+");return l.prototype.readChromTree=function(){var t=this;this.chromsToIDs={},this.idsToChroms={},this.maxID=0;var e=this.unzoomedDataOffset;return e=e+4-(e-this.chromTreeOffset&3),i.when(o(this.url,this.chromTreeOffset,e-this.chromTreeOffset)).then(function(e){var n=new Uint8Array(e),i=new Int16Array(e),r=new Int32Array(e),a=(r[0],r[1],r[2]),o=(r[3],s(n,16),function(e){var r=n[e],l=i[e/2+1];e+=4;for(var u=0;u<l;++u)if(0===r){e+=a;var c=s(n,e);e+=8,c-=t.chromTreeOffset,o(c)}else{for(var h="",d=0;d<a;++d){var f=n[e++];0!==f&&(h+=String.fromCharCode(f))}var p=n[e+3]<<24|n[e+2]<<16|n[e+1]<<8|n[e+0];n[e+7],n[e+6],n[e+5],n[e+4],e+=8,t.chromsToIDs[h]=p,0===h.indexOf("chr")&&(t.chromsToIDs[h.substr(3)]=p),t.idsToChroms[p]=h,t.maxID=Math.max(t.maxID,p)}});o(32)})},u.prototype.readWigData=function(t,e,n){var i=this.bwg.chromsToIDs[t];return void 0===i?[]:this.readWigDataById(i,e,n)},u.prototype.readWigDataById=function(t,e,n){var r=this,a=i.Deferred();if(!this.cirHeader)return i.when(o(r.bwg.url,this.cirTreeOffset,48)).then(function(o){r.cirHeader=o;var s=new Int32Array(r.cirHeader);r.cirBlockSize=s[1],i.when(r.readWigDataById(t,e,n)).then(function(t){a.resolve(t)})}),a;var l=[],u=0,c=(Date.now(),function(i,r,a,o){return(t<0||i==t)&&r<=n&&a>=e}),h=function(t,e){if(r.bwg.instrument&&console.log("level="+e+"; offset="+t+"; time="+(0|Date.now())),u+=t.length,1==t.length&&t[0]-r.cirTreeOffset==48&&r.cachedCirRoot)return _(r.cachedCirRoot,0,e),void(0===--u&&i.when(r.fetchFeatures(c,l)).then(function(t){a.resolve(t)}));for(var n,o=4+32*r.cirBlockSize,s=0;s<t.length;++s){var h=new d(t[s],t[s]+o);n=n?f(n,h):h}for(var g=n.ranges(),v=0;v<g.length;++v){var m=g[v];p(t,m,e)}},p=function(t,e,n,s){e.max(),e.min();i.when(o(r.bwg.url,e.min(),e.max()-e.min())).then(function(o){for(var s=0;s<t.length;++s)e.contains(t[s])&&(_(o,t[s]-e.min(),n),t[s]-r.cirTreeOffset==48&&t[s]-e.min()==0&&(r.cachedCirRoot=o),0===--u&&i.when(r.fetchFeatures(c,l)).then(function(t){a.resolve(t)}))})},_=function(i,r,a){var o=new Uint8Array(i),u=new Int16Array(i),c=new Int32Array(i),d=o[r],f=u[r/2+1];if(r+=4,0!==d)for(var p=0;p<f;++p){var _=r/4,g=c[_],v=c[_+1],m=c[_+2],y=c[_+3],b=s(o,r+16),w=s(o,r+24);(t<0||g<t||g==t&&v<=n)&&(t<0||m>t||m==t&&y>=e)&&l.push({offset:b,size:w}),r+=32}else{for(var x=[],p=0;p<f;++p){var _=r/4,g=c[_],v=c[_+1],m=c[_+2],y=c[_+3],b=s(o,r+16);(t<0||g<t||g==t&&v<=n)&&(t<0||m>t||m==t&&y>=e)&&x.push(b),r+=24}x.length>0&&h(x,a+1)}};return h([r.cirTreeOffset+48],1),a},u.prototype.fetchFeatures=function(t,e){var r=this,a=i.Deferred();if(e.sort(function(t,e){return(0|t.offset)-(0|e.offset)}),0===e.length)return[];var s=[],l=function(t,e,i,a){a||(a={});var o=new n;o._chromId=t,o.segment=r.bwg.idsToChroms[t],o.min=e,o.max=i,o.type=r.bwg.type;for(var l in a)o[l]=a[l];s.push(o)},u=function(){if(0===e.length){Date.now();return a.resolve(s)}var n=e[0];if(n.data)r.parseFeatures(n.data,l,t),e.splice(0,1),u();else{for(var c=n.offset,h=n.size,d=1;d<e.length&&e[d].offset==c+h;)h+=e[d].size,++d;i.when(o(r.bwg.url,c,h)).then(function(t){for(var n=0,i=0;n<h;){var a,o=e[i];if(r.bwg.uncompressBufSize>0)a=_(t,n+2,o.size-2);else{var s=new Uint8Array(o.size);g(new Uint8Array(t,n,o.size),0,s,0,o.size),a=s.buffer}o.data=a,n+=o.size,++i}u()})}};return u(),a},u.prototype.parseFeatures=function(t,e,n){var a=new Uint8Array(t);if(this.isSummary)for(var o=new Int16Array(t),s=new Int32Array(t),l=new Float32Array(t),u=t.byteLength/32,c=0;c<u;++c){var h=s[8*c],_=s[8*c+1],g=s[8*c+2],v=s[8*c+3],m=(l[8*c+4],l[8*c+5]),y=l[8*c+6];l[8*c+7];if(n(h,_+1,g)){var b={type:"bigwig",score:y/v,maxScore:m};"bigbed"==this.bwg.type&&(b.type="density"),e(h,_+1,g,b)}}else if("bigwig"==this.bwg.type){var o=new Int16Array(t),s=new Int32Array(t),l=new Float32Array(t),h=s[0],w=s[1],x=(s[2],s[3]),k=s[4],C=a[20],u=o[11];if(3==C)for(var c=0;c<u;++c){var S=l[c+6],T=w+c*x+1,$=w+c*x+k;n(h,T,$)&&e(h,T,$,{score:S})}else if(2==C)for(var c=0;c<u;++c){var _=s[2*c+6]+1,g=_+k-1,S=l[2*c+7];n(h,_,g)&&e(h,_,g,{score:S})}else if(1==C)for(var c=0;c<u;++c){var _=s[3*c+6]+1,g=s[3*c+7],S=l[3*c+8];_>g&&(_=g),n(h,_,g)&&e(h,_,g,{score:S})}else console.log("Currently not handling bwgType="+C)}else{if("bigbed"!=this.bwg.type)throw Error("Don't know what to do with "+this.bwg.type);for(var A=0,E=this.bwg.definedFieldCount,O=this.bwg.schema;A<a.length;){var h=a[A+3]<<24|a[A+2]<<16|a[A+1]<<8|a[A+0],_=a[A+7]<<24|a[A+6]<<16|a[A+5]<<8|a[A+4],g=a[A+11]<<24|a[A+10]<<16|a[A+9]<<8|a[A+8];A+=12;for(var z="";;){var R=a[A++];if(0==R)break;z+=String.fromCharCode(R)}var N,P={};if(N=z.length>0?z.split("\t"):[],N.length>0&&E>3&&(P.label=N[0]),N.length>1&&E>4){var S=parseInt(N[1]);isNaN(S)||(P.score=S)}if(N.length>2&&E>5&&(P.orientation=N[2]),N.length>5&&E>8){var q=N[5];M.test(q)&&(P.itemRgb="rgb("+q+")")}if(N.length>E-3&&O)for(var j=E-3;j<N.length;++j)P[O.fields[j+3].name]=N[j];if(n(h,_+1,g,N))if(E<12)e(h,_+1,g,P);else{var D=0|N[3],L=0|N[4],I=0|N[6],B=N[7].split(","),V=N[8].split(",");if(P.exonFrames){var U=P.exonFrames.split(",");P.exonFrames=void 0}P.type="transcript";var F=new r;for(var G in P)F[G]=P[G];if(F.id=N[0],F.segment=this.bwg.idsToChroms[h],F.min=_+1,F.max=g,F.notes=[],P.groups=[F],N.length>9){var H=P.geneName||N[9],Y=H;N.length>10&&(Y=N[10]),P.geneName2&&(Y=P.geneName2);var X=i.extend({},F);X.id=H,X.label=Y,X.type="gene",P.groups.push(X)}for(var W=[],J=0;J<I;++J){var K=(0|V[J])+_,Z=K+(0|B[J]),Q=new d(K,Z);W.push(Q)}for(var tt=f(W),et=tt.ranges(),nt=0;nt<et.length;++nt){var it=et[nt];e(h,it.min()+1,it.max(),P)}if(L>D){var rt="+"==P.orientation?new d(D,L+3):new d(D-3,L),at=p(tt,rt);if(at){P.type="translation";for(var ot=at.ranges(),st=0,lt=0;ot[0].min()>et[lt].max();)lt++;for(var nt=0;nt<ot.length;++nt){var ut=nt;"-"==P.orientation&&(ut=ot.length-nt-1);var it=ot[ut];if(P.readframe=st,U){var ct=parseInt(U[ut+lt]);"number"==typeof ct&&ct>=0&&ct<=2&&(P.readframe=ct,P.readframeExplicit=!0)}var ht=it.max()-it.min();st=(st+ht)%3,e(h,it.min()+1,it.max(),P)}}}}}}},u.prototype.getFirstAdjacent=function(t,e,n,i){var r=this.bwg.chromsToIDs[t];if(void 0===r)return i([]);this.getFirstAdjacentById(r,e,n,i)},u.prototype.getFirstAdjacentById=function(t,e,n,i){var r=this;if(!this.cirHeader)return void this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(a){r.cirHeader=a;var o=new Int32Array(r.cirHeader);r.cirBlockSize=o[1],r.getFirstAdjacentById(t,e,n,i)});var a=null,o=-1,l=-1,u=0,c=(Date.now(),function(t,e){u+=t.length;for(var n,i=4+32*r.cirBlockSize,a=0;a<t.length;++a){var o=new d(t[a],t[a]+i);n=n?f(n,o):o}for(var s=n.ranges(),l=0;l<s.length;++l){var c=s[l];h(t,c,e)}}),h=function(o,s,l,c){s.max(),s.min();r.bwg.data.slice(s.min(),s.max()-s.min()).fetch(function(c){for(var h=0;h<o.length;++h)if(s.contains(o[h])&&(p(c,o[h]-s.min(),l),0==--u)){if(!a)return n>0&&(0!=t||e>0)?r.getFirstAdjacentById(0,0,n,i):n<0&&(t!=r.bwg.maxID||e<1e9)?r.getFirstAdjacentById(r.bwg.maxID,1e9,n,i):i([]);r.fetchFeatures(function(i,r,a,o){return n<0&&(i<t||a<e)||n>0&&(i>t||r>e)},[a],function(t){for(var e=null,r=-1,a=-1,o=0;o<t.length;++o){var s=t[o],l=s._chromId,u=s.min,c=s.max;(null==e||n<0&&(l>r||c>a)||n>0&&(l<r||u<a))&&(e=s,a=n<0?c:u,r=l)}return i(null!=e?[e]:[])})}})},p=function(i,u,h){var d=new Uint8Array(i),f=new Int16Array(i),p=new Int32Array(i),_=d[u],g=f[u/2+1];if(u+=4,0!=_)for(var v=0;v<g;++v){var m=u/4,y=p[m],b=p[m+1],w=p[m+2],x=p[m+3],k=s(d,u+16),C=s(d,u+24);(n<0&&(y<t||y==t&&b<=e)||n>0&&(w>t||w==t&&x>=e))&&(/_random/.exec(r.bwg.idsToChroms[y])||(null==a||n<0&&(w>o||w==o&&x>l)||n>0&&(y<o||y==o&&b<l))&&(a={offset:k,size:C},l=n<0?x:b,o=n<0?w:y)),u+=32}else{for(var M=-1,S=-1,v=0;v<g;++v){var m=u/4,y=p[m],b=p[m+1],w=p[m+2],x=p[m+3],k=p[m+4]<<32|p[m+5];(n<0&&(y<t||y==t&&b<=e)&&w>=t||n>0&&(w>t||w==t&&x>=e)&&y<=t)&&(M<0||x>S)&&(M=k,S=n<0?x:b,n<0?w:y),u+=24}M>=0&&c([M],h+1)}};c([r.cirTreeOffset+48],1)},l.prototype.readWigData=function(t,e,n){var i,r=n-e;if(r<=25e3||0===this.zoomLevels.length)i=this.getUnzoomedView();else for(var a=0;a<this.zoomLevels.length;a++)if(r/this.zoomLevels[a].reduction<25e3){i=this.getZoomedView(a);break}return i.readWigData(t,e,n)},l.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var t=4e3;this.zoomLevels[0]&&(t=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset),this.unzoomedView=new u(this,this.unzoomedIndexOffset,t,!1)}return this.unzoomedView},l.prototype.getZoomedView=function(t){var e=this.zoomLevels[t];return e.view||(e.view=new u(this,e.indexOffset,4e3,!0)),e.view},l.prototype._tsFetch=function(t,e,n,i,r){var a=this;if(!(t>=this.zoomLevels.length-1)){var o;return o=t<0?this.getUnzoomedView():this.getZoomedView(t),o.readWigDataById(e,n,i,r)}if(this.topLevelReductionCache){for(var s=[],l=this.topLevelReductionCache,u=0;u<l.length;++u)l[u]._chromId==e&&s.push(l[u]);return r(s)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3e8,function(o){return a.topLevelReductionCache=o,a._tsFetch(t,e,n,i,r)})},l.prototype.thresholdSearch=function(t,e,n,i,r){function a(){if(0==l.length)return r(null);l.sort(function(t,e){var i=t.zoom-e.zoom;return 0!=i?i:(i=t.chrOrd-e.chrOrd,0!=i?i:t.min-e.min*n)});var t=l.splice(0,1)[0];o._tsFetch(t.zoom,t.chr,t.min,t.max,function(o){var s=n>0?0:3e8;t.fromRef&&(s=e);for(var u=0;u<o.length;++u){var c,h=o[u];if(c=void 0!=h.maxScore?h.maxScore:h.score,n>0){if(c>i)if(t.zoom<0){if(h.min>s)return r(h)}else h.max>s&&l.push({chr:t.chr,chrOrd:t.chrOrd,zoom:t.zoom-2,min:h.min,max:h.max,fromRef:t.fromRef})}else if(c>i)if(t.zoom<0){if(h.max<s)return r(h)}else h.min<s&&l.push({chr:t.chr,chrOrd:t.chrOrd,zoom:t.zoom-2,min:h.min,max:h.max,fromRef:t.fromRef})}a()})}n=n<0?-1:1;for(var o=this,s=this.chromsToIDs[t],l=[{chrOrd:0,chr:s,zoom:o.zoomLevels.length-4,min:0,max:3e8,fromRef:!0}],u=1;u<=this.maxID+1;++u){var c=(s+n*u)%(this.maxID+1);c<0&&(c+=this.maxID+1),l.push({chrOrd:u,chr:c,zoom:o.zoomLevels.length-1,min:0,max:3e8})}a()},l.prototype.getAutoSQL=function(t){if(!this.asOffset)return t(null);i.when(o(this.url,this.asOffset,2048)).then(function(e){for(var n=new Uint8Array(e),i="",r=0;r<n.length&&0!=n[r];++r)i+=String.fromCharCode(n[r]);var a=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/,o=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,s=a.exec(i);if(s){var l={declType:s[1],name:s[2],comment:s[4],fields:[]};i=i.substring(s[0]);for(var u=o.exec(i);null!=u;u=o.exec(i))l.fields.push({type:u[1],name:u[2],comment:u[4]});return t(l)}})},l.prototype.getExtraIndices=function(t){var e=this;if(this.version<4||0==this.extHeaderOffset||"bigbed"!=this.type)return t(null);this.data.slice(this.extHeaderOffset,64).fetch(function(n){if(!n)return t(null,"Couldn't fetch extension header");var i=new Uint8Array(n),r=new Int16Array(n),a=(new Int32Array(n),r[0],r[1]),o=s(i,4);if(0==a)return t(null);e.data.slice(o,20*a).fetch(function(n){if(!n)return t(null,"Couldn't fetch index info");for(var i=new Uint8Array(n),r=new Int16Array(n),o=(new Int32Array(n),[]),l=0;l<a;++l){var u=r[10*l],c=r[10*l+1],d=s(i,20*l+4),f=r[10*l+8],p=new h(e,u,c,d,f);o.push(p)}t(o)})})},h.prototype.lookup=function(t,e){var n=this;this.bbi.data.slice(this.offset,32).fetch(function(i){function r(i){n.bbi.data.slice(i,4+u*(c+h)).fetch(function(i){var o=new Uint8Array(i),l=new Uint16Array(i),u=(new Uint32Array(i),o[0]),d=l[1],f=4;if(0!=u){for(var p=0;p<d;++p){for(var _="",g=0;g<c;++g){var v=o[f++];0!=v&&(_+=String.fromCharCode(v))}if(_==t){var m=s(o,f),y=a(o,f+8);return n.bbi.getUnzoomedView().fetchFeatures(function(e,i,r,a){if(a&&a.length>n.field-3)return a[n.field-3]==t},[{offset:m,size:y}],e)}f+=h}return e([])}for(var b=null,p=0;p<d;++p){for(var _="",g=0;g<c;++g){var v=o[f++];0!=v&&(_+=String.fromCharCode(v))}var w=s(o,f);if(f+=8,t.localeCompare(_)<0&&b)return void r(b);b=w}r(b)})}var o=new Uint8Array(i),l=(new Int16Array(i),new Int32Array(i)),u=(l[0],l[1]),c=l[2],h=l[3];s(o,16);r(n.offset+32)})},{makeBwg:c}}.apply(e,r))&&(t.exports=a)}).call(e,n(0))},function(t,e,n){var i,r;i=[],void 0!==(r=function(){"use strict";function t(t,e){if("number"!=typeof t||"number"!=typeof e)throw"Bad range "+t+","+e;this._min=t,this._max=e}function e(t){var e=t.sort(o),n=[],i=e.shift();e.forEach(function(t){t._min<=i._max?t._max>i._max&&(i._max=t._max):(n.push(i),i=t)}),n.push(i),this._ranges=n}function n(t,n){return t instanceof e||(t instanceof Array||(t=[t]),t=new e(t)),n&&t.insertRange(n),t}function i(n,i){for(var r=n.ranges(),a=i.ranges(),o=r.length,s=a.length,l=0,u=0,c=[];l<o&&u<s;){var n=r[l],i=a[u],h=Math.max(n.min(),i.min()),d=Math.min(n.max(),i.max());d>=h&&c.push(new t(h,d)),n.max()>i.max()?++u:++l}return 0==c.length?null:1==c.length?c[0]:new e(c)}function r(t){for(var e=0,n=t.ranges(),i=0;i<n.length;++i){var r=n[i];e+=r.max()-r.min()+1}return e}function a(t,e){return t.min()<e.min()?-1:t.min()>e.min()?1:t.max()<e.max()?-1:e.max()>t.max()?1:0}function o(t,e){return t._min<e._min?-1:t._min>e._min?1:t._max<e._max?-1:e._max>t._max?1:0}return t.prototype.min=function(){return this._min},t.prototype.max=function(){return this._max},t.prototype.contains=function(t){return t>=this._min&&t<=this._max},t.prototype.isContiguous=function(){return!0},t.prototype.ranges=function(){return[this]},t.prototype._pushRanges=function(t){t.push(this)},t.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"},e.prototype.min=function(){return this._ranges[0].min()},e.prototype.max=function(){return this._ranges[this._ranges.length-1].max()},e.prototype.lower_bound=function(t){var e=this.ranges();if(t>this.max())return e.length;if(t<this.min())return 0;for(var n=0,i=e.length-1;n<=i;){var r=Math.floor((n+i)/2);if(t>e[r]._max)n=r+1;else{if(!(t<e[r]._min))return r;i=r-1}}return n},e.prototype.contains=function(t){var e=this.lower_bound(t);return!!(e<this._ranges.length&&this._ranges[e].contains(t))},e.prototype.insertRange=function(t){var e=this.lower_bound(t._min);if(e===this._ranges.length)return void this._ranges.push(t);var n=this.ranges();if(t._max<n[e]._min)return void this._ranges.splice(e,0,t);n[e]._min<t._min&&(t._min=n[e]._min);for(var i=e+1;i<n.length&&n[i]._min<=t._max;)i++;i--,n[i]._max>t._max&&(t._max=n[i]._max),this._ranges.splice(e,i-e+1,t)},e.prototype.isContiguous=function(){return this._ranges.length>1},e.prototype.ranges=function(){return this._ranges},e.prototype._pushRanges=function(t){for(var e=0;e<this._ranges.length;++e)t.push(this._ranges[e])},e.prototype.toString=function(){for(var t="",e=0;e<this._ranges.length;++e)e>0&&(t+=","),t+=this._ranges[e].toString();return t},{Range:t,union:n,intersection:i,coverage:r,rangeOver:a,_rangeOrder:o}}.apply(e,i))&&(t.exports=r)},function(t,e,n){var i,r;i=[],void 0!==(r=function(){function t(){}function e(){this.was=[0]}function n(t,e,n){this.hufts=new Int32Array(3*h),this.window=new Uint8Array(n),this.end=n,this.checkfn=e,this.mode=v,this.reset(t,null),this.left=0,this.table=0,this.index=0,this.blens=null,this.bb=new Int32Array(1),this.tb=new Int32Array(1),this.codes=new i,this.last=0,this.bitk=0,this.bitb=0,this.read=0,this.write=0,this.check=0,this.inftree=new r}function i(){}function r(){}function a(t,e,n,i,r){return t[0]=m,e[0]=y,n[0]=b,i[0]=w,f}function o(t,e,n,i,r){if(0!=r){if(!t)throw"Undef src";if(!n)throw"Undef dest";0==e&&r==t.length?l(t,n,i):A?l(t.subarray(e,e+r),n,i):1==t.BYTES_PER_ELEMENT&&r>100?l(new Uint8Array(t.buffer,t.byteOffset+e,r),n,i):s(t,e,n,i,r)}}function s(t,e,n,i,r){for(var a=0;a<r;++a)n[i+a]=t[e+a]}function l(t,e,n){e.set(t,n)}function u(e,n,i,r){e=n?i?new Uint8Array(e,n,i):new Uint8Array(e,n,e.byteLength-n):new Uint8Array(e);var a=new t;a.inflateInit(c,!0),a.next_in=e,a.next_in_index=0,a.avail_in=e.length;for(var s=[],l=0;;){var u=new Uint8Array(32e3);a.next_out=u,a.next_out_index=0,a.avail_out=u.length;var h=a.inflate(d);if(h!=f&&h!=p&&h!=_)throw a.msg;if(0!=a.avail_out){var g=new Uint8Array(u.length-a.avail_out);o(u,0,g,0,u.length-a.avail_out),u=g}if(s.push(u),l+=u.length,h==p||h==_)break}if(r&&(r[0]=(n||0)+a.next_in_index),1==s.length)return s[0].buffer;for(var v=new Uint8Array(l),m=0,y=0;y<s.length;++y){var b=s[y];o(b,0,v,m,b.length),m+=b.length}return v.buffer}var c=15,h=1440,d=0,f=0,p=1,_=-5,g=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],v=0,m=9,y=5,b=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],w=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],M=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];t.prototype.inflateInit=function(t,n){return t||(t=c),n&&(n=!1),this.istate=new e,this.istate.inflateInit(this,n?-t:t)},t.prototype.inflate=function(t){return null==this.istate?-2:this.istate.inflate(this,t)},t.prototype.inflateEnd=function(){if(null==this.istate)return-2;var t=istate.inflateEnd(this);return this.istate=null,t},t.prototype.inflateSync=function(){return istate.inflateSync(this)},t.prototype.inflateSetDictionary=function(t,e){return istate.inflateSetDictionary(this,t,e)},e.prototype.inflateReset=function(t){return null==t||null==t.istate?-2:(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=0!=t.istate.nowrap?7:0,t.istate.blocks.reset(t,null),f)},e.prototype.inflateEnd=function(t){return null!=this.blocks&&this.blocks.free(t),this.blocks=null,f},e.prototype.inflateInit=function(t,e){return t.msg=null,this.blocks=null,nowrap=0,e<0&&(e=-e,nowrap=1),e<8||e>15?(this.inflateEnd(t),-2):(this.wbits=e,t.istate.blocks=new n(t,0!=t.istate.nowrap?null:this,1<<e),this.inflateReset(t),f)},e.prototype.inflate=function(t,e){var n,i;if(null==t||null==t.istate||null==t.next_in)return-2;for(e=4==e?_:f,n=_;;)switch(t.istate.mode){case 0:if(0==t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,8!=(15&(t.istate.method=t.next_in[t.next_in_index++]))){t.istate.mode=13,t.msg="unknown compression method",t.istate.marker=5;break}if(8+(t.istate.method>>4)>t.istate.wbits){t.istate.mode=13,t.msg="invalid window size",t.istate.marker=5;break}t.istate.mode=1;case 1:if(0==t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,i=255&t.next_in[t.next_in_index++],((t.istate.method<<8)+i)%31!=0){t.istate.mode=13,t.msg="incorrect header check",t.istate.marker=5;break}if(0==(32&i)){t.istate.mode=7;break}t.istate.mode=2;case 2:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=3;case 3:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=4;case 4:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=5;case 5:return 0==t.avail_in?n:(n=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.adler=t.istate.need,t.istate.mode=6,2);case 6:return t.istate.mode=13,t.msg="need dictionary",t.istate.marker=0,-2;case 7:if(-3==(n=t.istate.blocks.proc(t,n))){t.istate.mode=13,t.istate.marker=0;break}if(n==f&&(n=e),n!=p)return n;if(n=e,t.istate.blocks.reset(t,t.istate.was),0!=t.istate.nowrap){t.istate.mode=12;break}t.istate.mode=8;case 8:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need=(255&t.next_in[t.next_in_index++])<<24&4278190080,t.istate.mode=9;case 9:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<16&16711680,t.istate.mode=10;case 10:if(0==t.avail_in)return n;n=e,t.avail_in--,t.total_in++,t.istate.need+=(255&t.next_in[t.next_in_index++])<<8&65280,t.istate.mode=11;case 11:if(0==t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,t.istate.need+=255&t.next_in[t.next_in_index++],t.istate.was[0]!=t.istate.need){t.istate.mode=13,t.msg="incorrect data check",t.istate.marker=5;break}t.istate.mode=12;case 12:return p;case 13:return-3;default:return-2}},e.prototype.inflateSetDictionary=function(t,e,n){var i=0,r=n;return null==t||null==t.istate||6!=t.istate.mode?-2:t._adler.adler32(1,e,0,n)!=t.adler?-3:(t.adler=t._adler.adler32(0,null,0,0),r>=1<<t.istate.wbits&&(r=(1<<t.istate.wbits)-1,i=n-r),t.istate.blocks.set_dictionary(e,i,r),t.istate.mode=7,f)};var S=[0,0,255,255];e.prototype.inflateSync=function(t){var e,n,i,r,a;if(null==t||null==t.istate)return-2;if(13!=t.istate.mode&&(t.istate.mode=13,t.istate.marker=0),0==(e=t.avail_in))return _;for(n=t.next_in_index,i=t.istate.marker;0!=e&&i<4;)t.next_in[n]==S[i]?i++:i=0!=t.next_in[n]?0:4-i,n++,e--;return t.total_in+=n-t.next_in_index,t.next_in_index=n,t.avail_in=e,t.istate.marker=i,4!=i?-3:(r=t.total_in,a=t.total_out,this.inflateReset(t),t.total_in=r,t.total_out=a,t.istate.mode=7,f)},e.prototype.inflateSyncPoint=function(t){return null==t||null==t.istate||null==t.istate.blocks?-2:t.istate.blocks.sync_point()};var T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];n.prototype.reset=function(t,e){e&&(e[0]=this.check),6==this.mode&&this.codes.free(t),this.mode=v,this.bitk=0,this.bitb=0,this.read=this.write=0,this.checkfn&&(t.adler=this.check=t._adler.adler32(0,null,0,0))},n.prototype.proc=function(t,e){var n,i,r,s,l,u,c;for(s=t.next_in_index,l=t.avail_in,i=this.bitb,r=this.bitk,u=this.write,c=u<this.read?this.read-u-1:this.end-u;;)switch(this.mode){case v:for(;r<3;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}switch(n=7&i,this.last=1&n,n>>>1){case 0:i>>>=3,r-=3,n=7&r,i>>>=n,r-=n,this.mode=1;break;case 1:var h=new Int32Array(1),d=new Int32Array(1),_=[],m=[];a(h,d,_,m,t),this.codes.init(h[0],d[0],_[0],0,m[0],0,t),i>>>=3,r-=3,this.mode=6;break;case 2:i>>>=3,r-=3,this.mode=3;break;case 3:return i>>>=3,r-=3,this.mode=13,t.msg="invalid block type",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e)}break;case 1:for(;r<32;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if((~i>>>16&65535)!=(65535&i))return this.mode=13,t.msg="invalid stored block lengths",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);this.left=65535&i,i=r=0,this.mode=0!=this.left?2:0!=this.last?7:v;break;case 2:if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,write=u,this.inflate_flush(t,e);if(0==c&&(u==end&&0!=read&&(u=0,c=u<this.read?this.read-u-1:this.end-u),0==c&&(this.write=u,e=this.inflate_flush(t,e),u=this.write,c=u<this.read?this.read-u-1:this.end-u,u==this.end&&0!=this.read&&(u=0,c=u<this.read?this.read-u-1:this.end-u),0==c)))return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);if(e=f,n=this.left,n>l&&(n=l),n>c&&(n=c),o(t.next_in,s,this.window,u,n),s+=n,l-=n,u+=n,c-=n,0!=(this.left-=n))break;this.mode=0!=this.last?7:v;break;case 3:for(;r<14;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if(this.table=n=16383&i,(31&n)>29||(n>>5&31)>29)return this.mode=9,t.msg="too many length or distance symbols",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);if(n=258+(31&n)+(n>>5&31),null==this.blens||this.blens.length<n)this.blens=new Int32Array(n);else for(var y=0;y<n;y++)this.blens[y]=0;i>>>=14,r-=14,this.index=0,mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;r<3;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}this.blens[T[this.index++]]=7&i,i>>>=3,r-=3}for(;this.index<19;)this.blens[T[this.index++]]=0;if(this.bb[0]=7,(n=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,t))!=f)return e=n,-3==e&&(this.blens=null,this.mode=9),this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,write=u,this.inflate_flush(t,e);this.index=0,this.mode=5;case 5:for(;;){if(n=this.table,!(this.index<258+(31&n)+(n>>5&31)))break;var y,b,w;for(n=this.bb[0];r<n;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if(n=this.hufts[3*(this.tb[0]+(i&g[n]))+1],(w=this.hufts[3*(this.tb[0]+(i&g[n]))+2])<16)i>>>=n,r-=n,this.blens[this.index++]=w;else{for(y=18==w?7:w-14,b=18==w?11:3;r<n+y;){if(0==l)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);e=f,l--,i|=(255&t.next_in[s++])<<r,r+=8}if(i>>>=n,r-=n,b+=i&g[y],i>>>=y,r-=y,y=this.index,n=this.table,y+b>258+(31&n)+(n>>5&31)||16==w&&y<1)return this.blens=null,this.mode=9,t.msg="invalid bit length repeat",e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);w=16==w?this.blens[y-1]:0;do{this.blens[y++]=w}while(0!=--b);this.index=y}}this.tb[0]=-1;var h=new Int32Array(1),d=new Int32Array(1),_=new Int32Array(1),m=new Int32Array(1);if(h[0]=9,d[0]=6,n=this.table,(n=this.inftree.inflate_trees_dynamic(257+(31&n),1+(n>>5&31),this.blens,h,d,_,m,this.hufts,t))!=f)return-3==n&&(this.blens=null,this.mode=13),e=n,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);this.codes.init(h[0],d[0],this.hufts,_[0],this.hufts,m[0],t),this.mode=6;case 6:if(this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,(e=this.codes.proc(this,t,e))!=p)return this.inflate_flush(t,e);if(e=f,this.codes.free(t),s=t.next_in_index,l=t.avail_in,i=this.bitb,r=this.bitk,u=this.write,c=u<this.read?this.read-u-1:this.end-u,0==this.last){this.mode=v;break}this.mode=7;case 7:if(this.write=u,e=this.inflate_flush(t,e),u=this.write,c=u<this.read?this.read-u-1:this.end-u,this.read!=this.write)return this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);mode=12;case 8:return e=p,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);case 9:return e=-3,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e);default:return e=-2,this.bitb=i,this.bitk=r,t.avail_in=l,t.total_in+=s-t.next_in_index,t.next_in_index=s,this.write=u,this.inflate_flush(t,e)}},n.prototype.free=function(t){this.reset(t,null),this.window=null,this.hufts=null},n.prototype.set_dictionary=function(t,e,n){o(t,e,window,0,n),this.read=this.write=n},n.prototype.sync_point=function(){return 1==this.mode},n.prototype.inflate_flush=function(t,e){var n,i,r;return i=t.next_out_index,r=this.read,n=(r<=this.write?this.write:this.end)-r,n>t.avail_out&&(n=t.avail_out),0!=n&&e==_&&(e=f),t.avail_out-=n,t.total_out+=n,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,r,n)),o(this.window,r,t.next_out,i,n),i+=n,r+=n,r==this.end&&(r=0,this.write==this.end&&(this.write=0),n=this.write-r,n>t.avail_out&&(n=t.avail_out),0!=n&&e==_&&(e=f),t.avail_out-=n,t.total_out+=n,null!=this.checkfn&&(t.adler=this.check=t._adler.adler32(this.check,this.window,r,n)),o(this.window,r,t.next_out,i,n),i+=n,r+=n),t.next_out_index=i,this.read=r,e};i.prototype.init=function(t,e,n,i,r,a,o){this.mode=0,this.lbits=t,this.dbits=e,this.ltree=n,this.ltree_index=i,this.dtree=r,this.dtree_index=a,this.tree=null},i.prototype.proc=function(t,e,n){var i,r,a,o,s,l,u,c=0,h=0,d=0;for(d=e.next_in_index,o=e.avail_in,c=t.bitb,h=t.bitk,s=t.write,l=s<t.read?t.read-s-1:t.end-s;;)switch(this.mode){case 0:if(l>=258&&o>=10&&(t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,n=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,t,e),d=e.next_in_index,o=e.avail_in,c=t.bitb,h=t.bitk,s=t.write,l=s<t.read?t.read-s-1:t.end-s,n!=f)){this.mode=n==p?7:9;break}this.need=this.lbits,this.tree=this.ltree,this.tree_index=this.ltree_index,this.mode=1;case 1:for(i=this.need;h<i;){if(0==o)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,o--,c|=(255&e.next_in[d++])<<h,h+=8}if(r=3*(this.tree_index+(c&g[i])),c>>>=this.tree[r+1],h-=this.tree[r+1],0==(a=this.tree[r])){this.lit=this.tree[r+2],this.mode=6;break}if(0!=(16&a)){this.get=15&a,this.len=this.tree[r+2],this.mode=2;break}if(0==(64&a)){this.need=a,this.tree_index=r/3+this.tree[r+2];break}if(0!=(32&a)){this.mode=7;break}return this.mode=9,e.msg="invalid literal/length code",n=-3,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);case 2:for(i=this.get;h<i;){if(0==o)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,o--,c|=(255&e.next_in[d++])<<h,h+=8}this.len+=c&g[i],c>>=i,h-=i,this.need=this.dbits,this.tree=this.dtree,this.tree_index=this.dtree_index,this.mode=3;case 3:for(i=this.need;h<i;){if(0==o)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,o--,c|=(255&e.next_in[d++])<<h,h+=8}if(r=3*(this.tree_index+(c&g[i])),c>>=this.tree[r+1],h-=this.tree[r+1],0!=(16&(a=this.tree[r]))){this.get=15&a,this.dist=this.tree[r+2],this.mode=4;break}if(0==(64&a)){this.need=a,this.tree_index=r/3+this.tree[r+2];break}return this.mode=9,e.msg="invalid distance code",n=-3,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);case 4:for(i=this.get;h<i;){if(0==o)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,o--,c|=(255&e.next_in[d++])<<h,h+=8}this.dist+=c&g[i],c>>=i,h-=i,this.mode=5;case 5:for(u=s-this.dist;u<0;)u+=t.end;for(;0!=this.len;){if(0==l&&(s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l&&(t.write=s,n=t.inflate_flush(e,n),s=t.write,l=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l)))return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);t.window[s++]=t.window[u++],l--,u==t.end&&(u=0),this.len--}this.mode=0;break;case 6:if(0==l&&(s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l&&(t.write=s,n=t.inflate_flush(e,n),s=t.write,l=s<t.read?t.read-s-1:t.end-s,s==t.end&&0!=t.read&&(s=0,l=s<t.read?t.read-s-1:t.end-s),0==l)))return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);n=f,t.window[s++]=this.lit,l--,this.mode=0;break;case 7:if(h>7&&(h-=8,o++,d--),t.write=s,n=t.inflate_flush(e,n),s=t.write,l=s<t.read?t.read-s-1:t.end-s,t.read!=t.write)return t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);this.mode=8;case 8:return n=p,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);case 9:return n=-3,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n);default:return n=-2,t.bitb=c,t.bitk=h,e.avail_in=o,e.total_in+=d-e.next_in_index,e.next_in_index=d,t.write=s,t.inflate_flush(e,n)}},i.prototype.free=function(t){},i.prototype.inflate_fast=function(t,e,n,i,r,a,s,l){var u,c,h,d,_,v,m,y,b,w,x,k,C,M,S,T;m=l.next_in_index,y=l.avail_in,_=s.bitb,v=s.bitk,b=s.write,w=b<s.read?s.read-b-1:s.end-b,x=g[t],k=g[e];do{for(;v<20;)y--,_|=(255&l.next_in[m++])<<v,v+=8;if(u=_&x,c=n,h=i,T=3*(h+u),0!=(d=c[T]))for(;;){if(_>>=c[T+1],v-=c[T+1],0!=(16&d)){for(d&=15,C=c[T+2]+(_&g[d]),_>>=d,v-=d;v<15;)y--,_|=(255&l.next_in[m++])<<v,v+=8;for(u=_&k,c=r,h=a,T=3*(h+u),d=c[T];;){if(_>>=c[T+1],v-=c[T+1],0!=(16&d)){for(d&=15;v<d;)y--,_|=(255&l.next_in[m++])<<v,v+=8;if(M=c[T+2]+(_&g[d]),_>>=d,v-=d,w-=C,b>=M)S=b-M,s.window[b++]=s.window[S++],s.window[b++]=s.window[S++],C-=2;else{S=b-M;do{S+=s.end}while(S<0);if(d=s.end-S,C>d){if(C-=d,b-S>0&&d>b-S)do{s.window[b++]=s.window[S++]}while(0!=--d);else o(s.window,S,s.window,b,d),b+=d,S+=d,d=0;S=0}}do{s.window[b++]=s.window[S++]}while(0!=--C);break}if(0!=(64&d))return l.msg="invalid distance code",C=l.avail_in-y,C=v>>3<C?v>>3:C,y+=C,m-=C,v-=C<<3,s.bitb=_,s.bitk=v,l.avail_in=y,l.total_in+=m-l.next_in_index,l.next_in_index=m,s.write=b,-3;u+=c[T+2],u+=_&g[d],T=3*(h+u),d=c[T]}break}if(0!=(64&d))return 0!=(32&d)?(C=l.avail_in-y,C=v>>3<C?v>>3:C,y+=C,m-=C,v-=C<<3,s.bitb=_,s.bitk=v,l.avail_in=y,l.total_in+=m-l.next_in_index,l.next_in_index=m,s.write=b,p):(l.msg="invalid literal/length code",C=l.avail_in-y,C=v>>3<C?v>>3:C,y+=C,m-=C,v-=C<<3,s.bitb=_,s.bitk=v,l.avail_in=y,l.total_in+=m-l.next_in_index,l.next_in_index=m,s.write=b,-3);if(u+=c[T+2],u+=_&g[d],T=3*(h+u),0==(d=c[T])){_>>=c[T+1],v-=c[T+1],s.window[b++]=c[T+2],w--;break}}else _>>=c[T+1],v-=c[T+1],s.window[b++]=c[T+2],w--}while(w>=258&&y>=10);return C=l.avail_in-y,C=v>>3<C?v>>3:C,y+=C,m-=C,v-=C<<3,s.bitb=_,s.bitk=v,l.avail_in=y,l.total_in+=m-l.next_in_index,l.next_in_index=m,s.write=b,f},r.prototype.huft_build=function(t,e,n,i,r,a,s,l,u,c,d){var p,g,v,m,y,b,w,x,k,C,M,S,T,$,A;C=0,y=n;do{this.c[t[e+C]]++,C++,y--}while(0!=y);if(this.c[0]==n)return s[0]=-1,l[0]=0,f;for(x=l[0],b=1;b<=15&&0==this.c[b];b++);for(w=b,x<b&&(x=b),y=15;0!=y&&0==this.c[y];y--);for(v=y,x>y&&(x=y),l[0]=x,$=1<<b;b<y;b++,$<<=1)if(($-=this.c[b])<0)return-3;if(($-=this.c[y])<0)return-3;for(this.c[y]+=$,this.x[1]=b=0,C=1,T=2;0!=--y;)this.x[T]=b+=this.c[C],T++,C++;y=0,C=0;do{0!=(b=t[e+C])&&(this.v[this.x[b]++]=y),C++}while(++y<n);for(n=this.x[v],this.x[0]=y=0,C=0,m=-1,S=-x,this.u[0]=0,M=0,A=0;w<=v;w++)for(p=this.c[w];0!=p--;){for(;w>S+x;){if(m++,S+=x,A=v-S,A=A>x?x:A,(g=1<<(b=w-S))>p+1&&(g-=p+1,T=w,b<A))for(;++b<A&&!((g<<=1)<=this.c[++T]);)g-=this.c[T];if(A=1<<b,this.hn[0]+A>h)return-3;this.u[m]=M=this.hn[0],this.hn[0]+=A,0!=m?(this.x[m]=y,this.r[0]=b,this.r[1]=x,b=y>>>S-x,this.r[2]=M-this.u[m-1]-b,o(this.r,0,u,3*(this.u[m-1]+b),3)):s[0]=M}for(this.r[1]=w-S,C>=n?this.r[0]=192:d[C]<i?(this.r[0]=this.v[C]<256?0:96,this.r[2]=this.v[C++]):(this.r[0]=a[this.v[C]-i]+16+64,this.r[2]=r[this.v[C++]-i]),g=1<<w-S,b=y>>>S;b<A;b+=g)o(this.r,0,u,3*(M+b),3);for(b=1<<w-1;0!=(y&b);b>>>=1)y^=b;for(y^=b,k=(1<<S)-1;(y&k)!=this.x[m];)m--,S-=x,k=(1<<S)-1}return 0!=$&&1!=v?_:f},r.prototype.inflate_trees_bits=function(t,e,n,i,r){var a;return this.initWorkArea(19),this.hn[0]=0,a=this.huft_build(t,0,19,19,null,null,n,e,i,this.hn,this.v),-3==a?r.msg="oversubscribed dynamic bit lengths tree":a!=_&&0!=e[0]||(r.msg="incomplete dynamic bit lengths tree",a=-3),a},r.prototype.inflate_trees_dynamic=function(t,e,n,i,r,a,o,s,l){var u;return this.initWorkArea(288),this.hn[0]=0,(u=this.huft_build(n,0,t,257,x,k,a,i,s,this.hn,this.v))!=f||0==i[0]?(-3==u?l.msg="oversubscribed literal/length tree":-4!=u&&(l.msg="incomplete literal/length tree",u=-3),u):(this.initWorkArea(288),u=this.huft_build(n,t,e,0,C,M,o,r,s,this.hn,this.v),u!=f||0==r[0]&&t>257?(-3==u?l.msg="oversubscribed distance tree":u==_?(l.msg="incomplete distance tree",u=-3):-4!=u&&(l.msg="empty distance tree with lengths",u=-3),u):f)},r.prototype.initWorkArea=function(t){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(t),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16)),this.v.length<t&&(this.v=new Int32Array(t));for(var e=0;e<t;e++)this.v[e]=0;for(var e=0;e<16;e++)this.c[e]=0;for(var e=0;e<3;e++)this.r[e]=0;o(this.c,0,this.u,0,15),o(this.c,0,this.x,0,16)};var $=new Uint8Array(1),A="function"==typeof $.subarray;return{inflateBuffer:u,arrayCopy:o}}.apply(e,i))&&(t.exports=r)},function(t,e,n){(function(i){var r,a,o;!function(i,s){a=[n(0)],r=s,void 0!==(o="function"==typeof r?r.apply(e,a):r)&&(t.exports=o)}(0,function(t){var e=t.ajaxSettings;e.responseFields.native="responseNative",e.converters["* native"]=!0;var n={},r=0,a={0:200,1223:204},o={},s=i.ajaxSettings.xhr();window.ActiveXObject&&t(window).on("unload",function(){for(var t in o)o[t]()}),n.cors=!!s&&"withCredentials"in s,n.ajax=s=!!s,t.ajaxTransport("native",function(t){var e;if(n.cors||s&&!t.crossDomain)return{send:function(n,i){var s,l=t.xhr(),u=++r,c={};if(l.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(s in t.xhrFields)l[s]=t.xhrFields[s];t.mimeType&&l.overrideMimeType&&l.overrideMimeType(t.mimeType),t.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(s in n)l.setRequestHeader(s,n[s]);e=function(t){return function(){e&&(delete o[u],e=l.onload=l.onerror=null,"abort"===t?l.abort():"error"===t?i(l.status,l.statusText):(l.response&&(c.native=l.response),i(a[l.status]||l.status,l.statusText,c,l.getAllResponseHeaders())))}},l.onload=e(),l.onerror=e("error"),e=o[u]=e("abort");try{l.send(t.hasContent&&t.data||null)}catch(t){if(e)throw t}},abort:function(){e&&e()}}}),t.getNative=function(e,n){return t.ajax({dataType:"native",url:e,xhrFields:{responseType:"arraybuffer"},success:n})}})}).call(e,n(0))},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t){new s.default.GalaxyApp(t)}function a(t){new u.default.GalaxyApp(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.tracksterApp=r,e.circsterApp=a;var o=n(145),s=i(o),l=n(291),u=i(l);window.tracksterApp=r,window.circsterApp=a},function(t,e,n){"use strict";(function(t,i){function r(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var o=n(2),s=a(o),l=n(292),u=a(l),c=n(13),h=r(c),d=n(3),f=r(d),p=n(21),_=r(p),g=n(41),v=r(g);n(159);var m=t.Model.extend({is_visible:function(t,e){var n=t.getBoundingClientRect(),r=i("svg")[0].getBoundingClientRect();return!(n.right<0||n.left>r.right||n.bottom<0||n.top>r.bottom)}}),y={drawTicks:function(t,e,n,i,r){var a=t.append("g").selectAll("g").data(e).enter().append("g").selectAll("g").data(n).enter().append("g").attr("class","tick").attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+t.radius+",0)"}),o=[],s=[],l=function(t){return t.angle>Math.PI?"end":null};return r?(o=[0,0,0,-4],s=[4,0,"",".35em"],l=null):(o=[1,0,4,0],s=[0,4,".35em",""]),a.append("line").attr("x1",o[0]).attr("y1",o[1]).attr("x2",o[2]).attr("y1",o[3]).style("stroke","#000"),a.append("text").attr("x",s[0]).attr("y",s[1]).attr("dx",s[2]).attr("dy",s[3]).attr("text-anchor",l).attr("transform",i).text(function(t){return t.label})},formatNum:function(t,e){if(void 0===e&&(e=2),null===t)return null;var n=null;if(Math.abs(t)<1)n=t.toPrecision(e);else{var i=Math.round(t.toPrecision(e));t=Math.abs(t),t<1e3?n=i:t<1e6?n=Math.round((i/1e3).toPrecision(3)).toFixed(0)+"K":t<1e9&&(n=Math.round((i/1e6).toPrecision(3)).toFixed(0)+"M")}return n}},b=t.Model.extend({}),w=t.View.extend({className:"circster",initialize:function(t){this.genome=t.genome,this.label_arc_height=50,this.scale=1,this.circular_views=null,this.chords_views=null,this.model.get("drawables").on("add",this.add_track,this),this.model.get("drawables").on("remove",this.remove_track,this);var e=this.model.get("config");e.get("arc_dataset_height").on("change:value",this.update_track_bounds,this),e.get("track_gap").on("change:value",this.update_track_bounds,this)},get_circular_tracks:function(){return this.model.get("drawables").filter(function(t){return"DiagonalHeatmapTrack"!==t.get("track_type")})},get_chord_tracks:function(){return this.model.get("drawables").filter(function(t){return"DiagonalHeatmapTrack"===t.get("track_type")})},get_tracks_bounds:function(){var t=this.get_circular_tracks(),e=this.model.get("config").get_value("arc_dataset_height"),n=this.model.get("config").get_value("track_gap"),i=Math.min(this.$el.width(),this.$el.height())-20,r=i/2-t.length*(e+n)+n-this.label_arc_height,a=u.range(r,i/2,e+n);return s.map(a,function(t){return[t,t+e]})},render:function(){var t=this,e=t.$el.width(),n=t.$el.height(),i=this.get_circular_tracks(),r=this.get_chord_tracks(),a=t.model.get("config").get_value("total_gap"),o=this.get_tracks_bounds(),s=u.select(t.$el[0]).append("svg").attr("width",e).attr("height",n).attr("pointer-events","all").append("svg:g").call(u.behavior.zoom().on("zoom",function(){var e=u.event.scale;s.attr("transform","translate("+u.event.translate+") scale("+e+")"),t.scale!==e&&(t.zoom_drag_timeout&&clearTimeout(t.zoom_drag_timeout),t.zoom_drag_timeout=setTimeout(function(){},400))})).attr("transform","translate("+e/2+","+n/2+")").append("svg:g").attr("class","tracks");this.circular_views=i.map(function(e,n){var i=new M({el:s.append("g")[0],track:e,radius_bounds:o[n],genome:t.genome,total_gap:a});return i.render(),i}),this.chords_views=r.map(function(e){var n=new S({el:s.append("g")[0],track:e,radius_bounds:o[0],genome:t.genome,total_gap:a});return n.render(),n});var l=this.circular_views[this.circular_views.length-1].radius_bounds[1],c=[l,l+this.label_arc_height];this.label_track_view=new k({el:s.append("g")[0],track:new b,radius_bounds:c,genome:t.genome,total_gap:a}),this.label_track_view.render()},add_track:function(t){var e=this.model.get("config").get_value("total_gap");if("DiagonalHeatmapTrack"===t.get("track_type")){var n=this.circular_views[0].radius_bounds,i=new S({el:u.select("g.tracks").append("g")[0],track:t,radius_bounds:n,genome:this.genome,total_gap:e});i.render(),this.chords_views.push(i)}else{var r=this.get_tracks_bounds();s.each(this.circular_views,function(t,e){t.update_radius_bounds(r[e])}),s.each(this.chords_views,function(t){t.update_radius_bounds(r[0])});var a=this.circular_views.length,o=new M({el:u.select("g.tracks").append("g")[0],track:t,radius_bounds:r[a],genome:this.genome,total_gap:e});o.render(),this.circular_views.push(o)}},remove_track:function(t,e,n){var i=this.circular_views[n.index];this.circular_views.splice(n.index,1),i.$el.remove();var r=this.get_tracks_bounds();s.each(this.circular_views,function(t,e){t.update_radius_bounds(r[e])})},update_track_bounds:function(){var t=this.get_tracks_bounds();s.each(this.circular_views,function(e,n){e.update_radius_bounds(t[n])}),s.each(this.chords_views,function(e){e.update_radius_bounds(t[0])})}}),x=t.View.extend({tagName:"g",initialize:function(t){this.bg_stroke="#ddd",this.loading_bg_fill="#ffc",this.bg_fill="#ddd",this.total_gap=t.total_gap,this.track=t.track,this.radius_bounds=t.radius_bounds,this.genome=t.genome,this.chroms_layout=this._chroms_layout(),this.data_bounds=[],this.scale=1,this.parent_elt=u.select(this.$el[0])},get_fill_color:function(){var t=this.track.get("config").get_value("block_color");return t||(t=this.track.get("config").get_value("color")),t},render:function(){var t=this.parent_elt,e=this.chroms_layout,n=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]),r=t.selectAll("g").data(e).enter().append("svg:g"),a=r.append("path").attr("d",n).attr("class","chrom-background").style("stroke",this.bg_stroke).style("fill",this.loading_bg_fill);a.append("title").text(function(t){return t.data.chrom});var o=this,s=o.track.get("data_manager"),l=!s||s.data_is_ready();i.when(l).then(function(){i.when(o._render_data(t)).then(function(){a.style("fill",o.bg_fill),o.render_labels()})})},render_labels:function(){},update_radius_bounds:function(t){this.radius_bounds=t;var e=u.svg.arc().innerRadius(this.radius_bounds[0]).outerRadius(this.radius_bounds[1]);this.parent_elt.selectAll("g>path.chrom-background").transition().duration(1e3).attr("d",e),this._transition_chrom_data(),this._transition_labels()},update_scale:function(t){var e=this.scale;if(this.scale=t,!(t<=e)){var n=this,r=new m;return this.parent_elt.selectAll("path.chrom-data").filter(function(t,e){return r.is_visible(this)}).each(function(e,r){var a,o=u.select(this),l=o.attr("chrom"),c=n.genome.get_chrom_region(l),h=n.track.get("data_manager");h.can_get_more_detailed_data(c)&&(a=n.track.get("data_manager").get_more_detailed_data(c,"Coverage",0,t),i.when(a).then(function(t){o.remove(),n._update_data_bounds();var e=s.find(n.chroms_layout,function(t){return t.data.chrom===l}),i=n.get_fill_color();n._render_chrom_data(n.parent_elt,e,t).style("stroke",i).style("fill",i)}))}),n}},_transition_chrom_data:function(){var t=this.track,e=this.chroms_layout,n=this.parent_elt.selectAll("g>path.chrom-data");if(n[0].length>0){var r=this;i.when(t.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){var a=s.reject(s.map(i,function(t,n){var i=null,a=r._get_path_function(e[n],t);return a&&(i=a(t.data)),i}),function(t){return null===t}),o=t.get("config").get_value("color");n.each(function(t,e){u.select(this).transition().duration(1e3).style("stroke",o).style("fill",o).attr("d",a[e])})})}},_transition_labels:function(){},_update_data_bounds:function(t){this.data_bounds;this.data_bounds=t||this.get_data_bounds(this.track.get("data_manager").get_genome_wide_data(this.genome)),this._transition_chrom_data()},_render_data:function(t){var e=this,n=this.chroms_layout,r=this.track,a=i.Deferred();return i.when(r.get("data_manager").get_genome_wide_data(this.genome)).then(function(i){e.data_bounds=e.get_data_bounds(i),r.get("config").set_value("min_value",e.data_bounds[0],{silent:!0}),r.get("config").set_value("max_value",e.data_bounds[1],{silent:!0});var o=s.zip(n,i);s.each(o,function(n){var i=n[0],r=n[1];return e._render_chrom_data(t,i,r)});var l=e.get_fill_color();e.parent_elt.selectAll("path.chrom-data").style("stroke",l).style("fill",l),a.resolve(t)}),a},_render_chrom_data:function(t,e,n){},_get_path_function:function(t,e){},_chroms_layout:function(){var t=this.genome.get_chroms_info(),e=u.layout.pie().value(function(t){return t.len}).sort(null),n=e(t),i=2*Math.PI*this.total_gap/t.length;return s.map(n,function(t,e){var n=t.endAngle-i;return t.endAngle=n>t.startAngle?n:t.startAngle,t})}}),k=x.extend({initialize:function(t){x.prototype.initialize.call(this,t),this.innerRadius=this.radius_bounds[0],this.radius_bounds[0]=this.radius_bounds[1],this.bg_stroke="#fff",this.bg_fill="#fff",this.min_arc_len=.05},_render_data:function(t){var e=this,n=t.selectAll("g");n.selectAll("path").attr("id",function(t){return"label-"+t.data.chrom}),n.append("svg:text").filter(function(t){return t.endAngle-t.startAngle>e.min_arc_len}).attr("text-anchor","middle").append("svg:textPath").attr("class","chrom-label").attr("xlink:href",function(t){return"#label-"+t.data.chrom}).attr("startOffset","25%").text(function(t){return t.data.chrom});var i=function(t){var n=(t.endAngle-t.startAngle)/t.value,i=u.range(0,t.value,25e6).map(function(i,r){return{radius:e.innerRadius,angle:i*n+t.startAngle,label:0===r?0:r%3?null:e.formatNum(i)}});return i.length<4&&(i[i.length-1].label=e.formatNum(Math.round((i[i.length-1].angle-t.startAngle)/n))),i},r=function(t){return t.angle>Math.PI?"rotate(180)translate(-16)":null},a=s.filter(this.chroms_layout,function(t){return t.endAngle-t.startAngle>e.min_arc_len});this.drawTicks(this.parent_elt,a,i,r)}});s.extend(k.prototype,y);var C=x.extend({initialize:function(t){x.prototype.initialize.call(this,t);var e=this.track.get("config");e.get("min_value").on("change:value",this._update_min_max,this),e.get("max_value").on("change:value",this._update_min_max,this),e.get("color").on("change:value",this._transition_chrom_data,this)},_update_min_max:function(){var t=this.track.get("config"),e=[t.get_value("min_value"),t.get_value("max_value")];this._update_data_bounds(e),this.parent_elt.selectAll(".min_max").text(function(t,n){return e[n]})},_quantile:function(t,e){return t.sort(u.ascending),u.quantile(t,e)},_render_chrom_data:function(t,e,n){var i=this._get_path_function(e,n);return i?t.datum(n.data).append("path").attr("class","chrom-data").attr("chrom",e.data.chrom).attr("d",i):null},_get_path_function:function(t,e){if("string"==typeof e||!e.data||0===e.data.length)return null;var n=u.scale.linear().domain(this.data_bounds).range(this.radius_bounds).clamp(!0),i=u.scale.linear().domain([0,e.data.length]).range([t.startAngle,t.endAngle]),r=u.svg.line.radial().interpolate("linear").radius(function(t){return n(t[1])}).angle(function(t,e){return i(e)});return u.svg.area.radial().interpolate(r.interpolate()).innerRadius(n(0)).outerRadius(r.radius()).angle(r.angle())},render_labels:function(){var t=this,e=function(){return"rotate(90)"},n=this.drawTicks(this.parent_elt,[this.chroms_layout[0]],this._data_bounds_ticks_fn(),e,!0).classed("min_max",!0);s.each(n,function(e){i(e).click(function(){new _.default.ConfigSettingCollectionView({collection:t.track.get("config")}).render_in_modal("Configure Track")})})},_transition_labels:function(){if(0!==this.data_bounds.length){var t=this,e=s.filter(this.chroms_layout,function(t){return t.endAngle-t.startAngle>.08}),n=s.filter(e,function(t,e){return e%3==0}),i=s.flatten(s.map(n,function(e){return t._data_bounds_ticks_fn()(e)}));this.parent_elt.selectAll("g.tick").data(i).transition().attr("transform",function(t){return"rotate("+(180*t.angle/Math.PI-90)+")translate("+t.radius+",0)"})}},_data_bounds_ticks_fn:function(){var t=this;return visibleChroms=0,function(e){return[{radius:t.radius_bounds[0],angle:e.startAngle,label:t.formatNum(t.data_bounds[0])},{radius:t.radius_bounds[1],angle:e.startAngle,label:t.formatNum(t.data_bounds[1])}]}},get_data_bounds:function(t){}});s.extend(C.prototype,y);var M=C.extend({get_data_bounds:function(t){var e=s.flatten(s.map(t,function(t){return t?s.map(t.data,function(t){return parseInt(t[1],10)||0}):0}));return[s.min(e),this._quantile(e,.98)||s.max(e)]}}),S=x.extend({render:function(){var t=this;i.when(t.track.get("data_manager").data_is_ready()).then(function(){i.when(t.track.get("data_manager").get_genome_wide_data(t.genome)).then(function(e){var n=[],i=t.genome.get_chroms_info();s.each(e,function(e,r){var a=i[r].chrom,o=s.map(e.data,function(e){var n=t._get_region_angle(a,e[1]),i=t._get_region_angle(e[3],e[4]);return{source:{startAngle:n,endAngle:n+.01},target:{startAngle:i,endAngle:i+.01}}});n=n.concat(o)}),t.parent_elt.append("g").attr("class","chord").selectAll("path").data(n).enter().append("path").style("fill",t.get_fill_color()).attr("d",u.svg.chord().radius(t.radius_bounds[0])).style("opacity",1)})})},update_radius_bounds:function(t){this.radius_bounds=t,this.parent_elt.selectAll("path").transition().attr("d",u.svg.chord().radius(this.radius_bounds[0]))},_get_region_angle:function(t,e){var n=s.find(this.chroms_layout,function(e){return e.data.chrom===t});return n.endAngle-(n.endAngle-n.startAngle)*(n.data.len-e)/n.data.len}}),T=t.View.extend({initialize:function(){f.default.cssLoadFile("static/style/circster.css");var t=new h.default.Genome(galaxy_config.app.genome),e=new h.default.GenomeVisualization(galaxy_config.app.viz_config);e.get("config").add([{key:"arc_dataset_height",label:"Arc Dataset Height",type:"int",value:25,view:"circster"},{key:"track_gap",label:"Gap Between Tracks",type:"int",value:5,view:"circster"},{key:"total_gap",label:"Gap [0-1]",type:"float",value:.4,view:"circster",hidden:!0}]),new w({el:i("#center .unified-panel-body"),genome:t,model:e}).render(),i("#center .unified-panel-header-inner").append(galaxy_config.app.viz_config.title+" "+galaxy_config.app.viz_config.dbkey);var n=v.default.create_icon_buttons_menu([{icon_class:"plus-button",title:"Add tracks",on_click:function(){h.default.select_datasets({dbkey:e.get("dbkey")},function(t){e.add_tracks(t)})}},{icon_class:"gear",title:"Settings",on_click:function(){new _.default.ConfigSettingCollectionView({collection:e.get("config")}).render_in_modal("Configure Visualization")}},{icon_class:"disk--arrow",title:"Save",on_click:function(){Galaxy.modal.show({title:"Saving...",body:"progress"}),i.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:e.get("vis_id"),title:e.get("title"),dbkey:e.get("dbkey"),type:"trackster",vis_json:JSON.stringify(e)}}).success(function(t){Galaxy.modal.hide(),e.set("vis_id",t.vis_id)}).error(function(){Galaxy.modal.show({title:"Could Not Save",body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})}},{icon_class:"cross-circle",title:"Close",on_click:function(){window.location=Galaxy.root+"visualizations/list"}}],{tooltip_config:{placement:"bottom"}});n.$el.attr("style","float: right"),i("#center .unified-panel-header-inner").append(n.$el),i(".menu-button").tooltip({placement:"bottom"})}});e.default={GalaxyApp:T}}).call(e,n(1),n(0))},function(t,e,n){var i,r;!function(){function a(t){return t&&(t.ownerDocument||t.document||t).documentElement}function o(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}function s(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function l(t){return null===t?NaN:+t}function u(t){return!isNaN(t)}function c(t){return{left:function(e,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)<0?i=a+1:r=a}return i},right:function(e,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=e.length);i<r;){var a=i+r>>>1;t(e[a],n)>0?r=a:i=a+1}return i}}}function h(t){return t.length}function d(t){for(var e=1;t*e%1;)e*=10;return e}function f(t,e){for(var n in e)Object.defineProperty(t.prototype,n,{value:e[n],enumerable:!1})}function p(){this._=Object.create(null)}function _(t){return(t+="")===Co||t[0]===Mo?Mo+t:t}function g(t){return(t+="")[0]===Mo?t.slice(1):t}function v(t){return _(t)in this._}function m(t){return(t=_(t))in this._&&delete this._[t]}function y(){var t=[];for(var e in this._)t.push(g(e));return t}function b(){var t=0;for(var e in this._)++t;return t}function w(){for(var t in this._)return!1;return!0}function x(){this._=Object.create(null)}function k(t){return t}function C(t,e,n){return function(){var i=n.apply(e,arguments);return i===e?t:i}}function M(t,e){if(e in t)return e;e=e.charAt(0).toUpperCase()+e.slice(1);for(var n=0,i=So.length;n<i;++n){var r=So[n]+e;if(r in t)return r}}function S(){}function T(){}function $(t){function e(){for(var e,i=n,r=-1,a=i.length;++r<a;)(e=i[r].on)&&e.apply(this,arguments);return t}var n=[],i=new p;return e.on=function(e,r){var a,o=i.get(e);return arguments.length<2?o&&o.on:(o&&(o.on=null,n=n.slice(0,a=n.indexOf(o)).concat(n.slice(a+1)),i.remove(e)),r&&n.push(i.set(e,{on:r})),t)},e}function A(){fo.event.preventDefault()}function E(){for(var t,e=fo.event;t=e.sourceEvent;)e=t;return e}function O(t){for(var e=new T,n=0,i=arguments.length;++n<i;)e[arguments[n]]=$(e);return e.of=function(n,i){return function(r){try{var a=r.sourceEvent=fo.event;r.target=t,fo.event=r,e[r.type].apply(n,i)}finally{fo.event=a}}},e}function z(t){return $o(t,zo),t}function R(t){return"function"==typeof t?t:function(){return Ao(t,this)}}function N(t){return"function"==typeof t?t:function(){return Eo(t,this)}}function P(t,e){function n(){this.removeAttribute(t)}function i(){this.removeAttributeNS(t.space,t.local)}function r(){this.setAttribute(t,e)}function a(){this.setAttributeNS(t.space,t.local,e)}function o(){var n=e.apply(this,arguments);null==n?this.removeAttribute(t):this.setAttribute(t,n)}function s(){var n=e.apply(this,arguments);null==n?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}return t=fo.ns.qualify(t),null==e?t.local?i:n:"function"==typeof e?t.local?s:o:t.local?a:r}function q(t){return t.trim().replace(/\s+/g," ")}function j(t){return new RegExp("(?:^|\\s+)"+fo.requote(t)+"(?:\\s+|$)","g")}function D(t){return(t+"").trim().split(/^|\s+/)}function L(t,e){function n(){for(var n=-1;++n<r;)t[n](this,e)}function i(){for(var n=-1,i=e.apply(this,arguments);++n<r;)t[n](this,i)}t=D(t).map(I);var r=t.length;return"function"==typeof e?i:n}function I(t){var e=j(t);return function(n,i){if(r=n.classList)return i?r.add(t):r.remove(t);var r=n.getAttribute("class")||"";i?(e.lastIndex=0,e.test(r)||n.setAttribute("class",q(r+" "+t))):n.setAttribute("class",q(r.replace(e," ")))}}function B(t,e,n){function i(){this.style.removeProperty(t)}function r(){this.style.setProperty(t,e,n)}function a(){var i=e.apply(this,arguments);null==i?this.style.removeProperty(t):this.style.setProperty(t,i,n)}return null==e?i:"function"==typeof e?a:r}function V(t,e){function n(){delete this[t]}function i(){this[t]=e}function r(){var n=e.apply(this,arguments);null==n?delete this[t]:this[t]=n}return null==e?n:"function"==typeof e?r:i}function U(t){function e(){var e=this.ownerDocument,n=this.namespaceURI;return n===Ro&&e.documentElement.namespaceURI===Ro?e.createElement(t):e.createElementNS(n,t)}function n(){return this.ownerDocument.createElementNS(t.space,t.local)}return"function"==typeof t?t:(t=fo.ns.qualify(t)).local?n:e}function F(){var t=this.parentNode;t&&t.removeChild(this)}function G(t){return{__data__:t}}function H(t){return function(){return Oo(this,t)}}function Y(t){return arguments.length||(t=s),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function X(t,e){for(var n=0,i=t.length;n<i;n++)for(var r,a=t[n],o=0,s=a.length;o<s;o++)(r=a[o])&&e(r,o,n);return t}function W(t){return $o(t,Po),t}function J(t){var e,n;return function(i,r,a){var o,s=t[a].update,l=s.length;for(a!=n&&(n=a,e=0),r>=e&&(e=r+1);!(o=s[e])&&++e<l;);return o}}function K(t,e,n){function i(){var e=this[o];e&&(this.removeEventListener(t,e,e.$),delete this[o])}function r(){var r=l(e,_o(arguments));i.call(this),this.addEventListener(t,this[o]=r,r.$=n),r._=e}function a(){var e,n=new RegExp("^__on([^.]+)"+fo.requote(t)+"$");for(var i in this)if(e=i.match(n)){var r=this[i];this.removeEventListener(e[1],r,r.$),delete this[i]}}var o="__on"+t,s=t.indexOf("."),l=Z;s>0&&(t=t.slice(0,s));var u=qo.get(t);return u&&(t=u,l=Q),s?e?r:i:e?S:a}function Z(t,e){return function(n){var i=fo.event;fo.event=n,e[0]=this.__data__;try{t.apply(this,e)}finally{fo.event=i}}}function Q(t,e){var n=Z(t,e);return function(t){var e=this,i=t.relatedTarget;i&&(i===e||8&i.compareDocumentPosition(e))||n.call(e,t)}}function tt(t){var e=".dragsuppress-"+ ++Do,n="click"+e,i=fo.select(o(t)).on("touchmove"+e,A).on("dragstart"+e,A).on("selectstart"+e,A);if(null==jo&&(jo=!("onselectstart"in t)&&M(t.style,"userSelect")),jo){var r=a(t).style,s=r[jo];r[jo]="none"}return function(t){if(i.on(e,null),jo&&(r[jo]=s),t){var a=function(){i.on(n,null)};i.on(n,function(){A(),a()},!0),setTimeout(a,0)}}}function et(t,e){e.changedTouches&&(e=e.changedTouches[0]);var n=t.ownerSVGElement||t;if(n.createSVGPoint){var i=n.createSVGPoint();if(Lo<0){var r=o(t);if(r.scrollX||r.scrollY){n=fo.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important");var a=n[0][0].getScreenCTM();Lo=!(a.f||a.e),n.remove()}}return Lo?(i.x=e.pageX,i.y=e.pageY):(i.x=e.clientX,i.y=e.clientY),i=i.matrixTransform(t.getScreenCTM().inverse()),[i.x,i.y]}var s=t.getBoundingClientRect();return[e.clientX-s.left-t.clientLeft,e.clientY-s.top-t.clientTop]}function nt(){return fo.event.changedTouches[0].identifier}function it(t){return t>0?1:t<0?-1:0}function rt(t,e,n){return(e[0]-t[0])*(n[1]-t[1])-(e[1]-t[1])*(n[0]-t[0])}function at(t){return t>1?0:t<-1?Vo:Math.acos(t)}function ot(t){return t>1?Go:t<-1?-Go:Math.asin(t)}function st(t){return((t=Math.exp(t))-1/t)/2}function lt(t){return((t=Math.exp(t))+1/t)/2}function ut(t){return((t=Math.exp(2*t))-1)/(t+1)}function ct(t){return(t=Math.sin(t/2))*t}function ht(){}function dt(t,e,n){return this instanceof dt?(this.h=+t,this.s=+e,void(this.l=+n)):arguments.length<2?t instanceof dt?new dt(t.h,t.s,t.l):St(""+t,Tt,dt):new dt(t,e,n)}function ft(t,e,n){function i(t){return t>360?t-=360:t<0&&(t+=360),t<60?a+(o-a)*t/60:t<180?o:t<240?a+(o-a)*(240-t)/60:a}function r(t){return Math.round(255*i(t))}var a,o;return t=isNaN(t)?0:(t%=360)<0?t+360:t,e=isNaN(e)?0:e<0?0:e>1?1:e,n=n<0?0:n>1?1:n,o=n<=.5?n*(1+e):n+e-n*e,a=2*n-o,new xt(r(t+120),r(t),r(t-120))}function pt(t,e,n){return this instanceof pt?(this.h=+t,this.c=+e,void(this.l=+n)):arguments.length<2?t instanceof pt?new pt(t.h,t.c,t.l):t instanceof gt?mt(t.l,t.a,t.b):mt((t=$t((t=fo.rgb(t)).r,t.g,t.b)).l,t.a,t.b):new pt(t,e,n)}function _t(t,e,n){return isNaN(t)&&(t=0),isNaN(e)&&(e=0),new gt(n,Math.cos(t*=Ho)*e,Math.sin(t)*e)}function gt(t,e,n){return this instanceof gt?(this.l=+t,this.a=+e,void(this.b=+n)):arguments.length<2?t instanceof gt?new gt(t.l,t.a,t.b):t instanceof pt?_t(t.h,t.c,t.l):$t((t=xt(t)).r,t.g,t.b):new gt(t,e,n)}function vt(t,e,n){var i=(t+16)/116,r=i+e/500,a=i-n/200;return r=yt(r)*es,i=yt(i)*ns,a=yt(a)*is,new xt(wt(3.2404542*r-1.5371385*i-.4985314*a),wt(-.969266*r+1.8760108*i+.041556*a),wt(.0556434*r-.2040259*i+1.0572252*a))}function mt(t,e,n){return t>0?new pt(Math.atan2(n,e)*Yo,Math.sqrt(e*e+n*n),t):new pt(NaN,NaN,t)}function yt(t){return t>.206893034?t*t*t:(t-4/29)/7.787037}function bt(t){return t>.008856?Math.pow(t,1/3):7.787037*t+4/29}function wt(t){return Math.round(255*(t<=.00304?12.92*t:1.055*Math.pow(t,1/2.4)-.055))}function xt(t,e,n){return this instanceof xt?(this.r=~~t,this.g=~~e,void(this.b=~~n)):arguments.length<2?t instanceof xt?new xt(t.r,t.g,t.b):St(""+t,xt,ft):new xt(t,e,n)}function kt(t){return new xt(t>>16,t>>8&255,255&t)}function Ct(t){return kt(t)+""}function Mt(t){return t<16?"0"+Math.max(0,t).toString(16):Math.min(255,t).toString(16)}function St(t,e,n){var i,r,a,o=0,s=0,l=0;if(i=/([a-z]+)\((.*)\)/.exec(t=t.toLowerCase()))switch(r=i[2].split(","),i[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return e(Et(r[0]),Et(r[1]),Et(r[2]))}return(a=os.get(t))?e(a.r,a.g,a.b):(null==t||"#"!==t.charAt(0)||isNaN(a=parseInt(t.slice(1),16))||(4===t.length?(o=(3840&a)>>4,o|=o>>4,s=240&a,s|=s>>4,l=15&a,l|=l<<4):7===t.length&&(o=(16711680&a)>>16,s=(65280&a)>>8,l=255&a)),e(o,s,l))}function Tt(t,e,n){var i,r,a=Math.min(t/=255,e/=255,n/=255),o=Math.max(t,e,n),s=o-a,l=(o+a)/2;return s?(r=l<.5?s/(o+a):s/(2-o-a),i=t==o?(e-n)/s+(e<n?6:0):e==o?(n-t)/s+2:(t-e)/s+4,i*=60):(i=NaN,r=l>0&&l<1?0:i),new dt(i,r,l)}function $t(t,e,n){t=At(t),e=At(e),n=At(n);var i=bt((.4124564*t+.3575761*e+.1804375*n)/es),r=bt((.2126729*t+.7151522*e+.072175*n)/ns);return gt(116*r-16,500*(i-r),200*(r-bt((.0193339*t+.119192*e+.9503041*n)/is)))}function At(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Et(t){var e=parseFloat(t);return"%"===t.charAt(t.length-1)?Math.round(2.55*e):e}function Ot(t){return"function"==typeof t?t:function(){return t}}function zt(t){return function(e,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),Rt(e,n,t,i)}}function Rt(t,e,n,i){function r(){var t,e=l.status;if(!e&&Pt(l)||e>=200&&e<300||304===e){try{t=n.call(a,l)}catch(t){return void o.error.call(a,t)}o.load.call(a,t)}else o.error.call(a,l)}var a={},o=fo.dispatch("beforesend","progress","load","error"),s={},l=new XMLHttpRequest,u=null;return!this.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(t)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=r:l.onreadystatechange=function(){l.readyState>3&&r()},l.onprogress=function(t){var e=fo.event;fo.event=t;try{o.progress.call(a,l)}finally{fo.event=e}},a.header=function(t,e){return t=(t+"").toLowerCase(),arguments.length<2?s[t]:(null==e?delete s[t]:s[t]=e+"",a)},a.mimeType=function(t){return arguments.length?(e=null==t?null:t+"",a):e},a.responseType=function(t){return arguments.length?(u=t,a):u},a.response=function(t){return n=t,a},["get","post"].forEach(function(t){a[t]=function(){return a.send.apply(a,[t].concat(_o(arguments)))}}),a.send=function(n,i,r){if(2===arguments.length&&"function"==typeof i&&(r=i,i=null),l.open(n,t,!0),null==e||"accept"in s||(s.accept=e+",*/*"),l.setRequestHeader)for(var c in s)l.setRequestHeader(c,s[c]);return null!=e&&l.overrideMimeType&&l.overrideMimeType(e),null!=u&&(l.responseType=u),null!=r&&a.on("error",r).on("load",function(t){r(null,t)}),o.beforesend.call(a,l),l.send(null==i?null:i),a},a.abort=function(){return l.abort(),a},fo.rebind(a,o,"on"),null==i?a:a.get(Nt(i))}function Nt(t){return 1===t.length?function(e,n){t(null==e?n:null)}:t}function Pt(t){var e=t.responseType;return e&&"text"!==e?t.response:t.responseText}function qt(t,e,n){var i=arguments.length;i<2&&(e=0),i<3&&(n=Date.now());var r=n+e,a={c:t,t:r,n:null};return ls?ls.n=a:ss=a,ls=a,us||(cs=clearTimeout(cs),us=1,hs(jt)),a}function jt(){var t=Dt(),e=Lt()-t;e>24?(isFinite(e)&&(clearTimeout(cs),cs=setTimeout(jt,e)),us=0):(us=1,hs(jt))}function Dt(){for(var t=Date.now(),e=ss;e;)t>=e.t&&e.c(t-e.t)&&(e.c=null),e=e.n;return t}function Lt(){for(var t,e=ss,n=1/0;e;)e.c?(e.t<n&&(n=e.t),e=(t=e).n):e=t?t.n=e.n:ss=e.n;return ls=t,n}function It(t,e){return e-(t?Math.ceil(Math.log(t)/Math.LN10):1)}function Bt(t,e){var n=Math.pow(10,3*ko(8-e));return{scale:e>8?function(t){return t/n}:function(t){return t*n},symbol:t}}function Vt(t){var e=t.decimal,n=t.thousands,i=t.grouping,r=t.currency,a=i&&n?function(t,e){for(var r=t.length,a=[],o=0,s=i[0],l=0;r>0&&s>0&&(l+s+1>e&&(s=Math.max(1,e-l)),a.push(t.substring(r-=s,r+s)),!((l+=s+1)>e));)s=i[o=(o+1)%i.length];return a.reverse().join(n)}:k;return function(t){var n=fs.exec(t),i=n[1]||" ",o=n[2]||">",s=n[3]||"-",l=n[4]||"",u=n[5],c=+n[6],h=n[7],d=n[8],f=n[9],p=1,_="",g="",v=!1,m=!0;switch(d&&(d=+d.substring(1)),(u||"0"===i&&"="===o)&&(u=i="0",o="="),f){case"n":h=!0,f="g";break;case"%":p=100,g="%",f="f";break;case"p":p=100,g="%",f="r";break;case"b":case"o":case"x":case"X":"#"===l&&(_="0"+f.toLowerCase());case"c":m=!1;case"d":v=!0,d=0;break;case"s":p=-1,f="r"}"$"===l&&(_=r[0],g=r[1]),"r"!=f||d||(f="g"),null!=d&&("g"==f?d=Math.max(1,Math.min(21,d)):"e"!=f&&"f"!=f||(d=Math.max(0,Math.min(20,d)))),f=ps.get(f)||Ut;var y=u&&h;return function(t){var n=g;if(v&&t%1)return"";var r=t<0||0===t&&1/t<0?(t=-t,"-"):"-"===s?"":s;if(p<0){var l=fo.formatPrefix(t,d);t=l.scale(t),n=l.symbol+g}else t*=p;t=f(t,d);var b,w,x=t.lastIndexOf(".");if(x<0){var k=m?t.lastIndexOf("e"):-1;k<0?(b=t,w=""):(b=t.substring(0,k),w=t.substring(k))}else b=t.substring(0,x),w=e+t.substring(x+1);!u&&h&&(b=a(b,1/0));var C=_.length+b.length+w.length+(y?0:r.length),M=C<c?new Array(C=c-C+1).join(i):"";return y&&(b=a(M+b,M.length?c-w.length:1/0)),r+=_,t=b+w,("<"===o?r+t+M:">"===o?M+r+t:"^"===o?M.substring(0,C>>=1)+r+t+M.substring(C):r+(y?t:M+t))+n}}}function Ut(t){return t+""}function Ft(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Gt(t,e,n){function i(e){var n=t(e),i=a(n,1);return e-n<i-e?n:i}function r(n){return e(n=t(new gs(n-1)),1),n}function a(t,n){return e(t=new gs(+t),n),t}function o(t,i,a){var o=r(t),s=[];if(a>1)for(;o<i;)n(o)%a||s.push(new Date(+o)),e(o,1);else for(;o<i;)s.push(new Date(+o)),e(o,1);return s}function s(t,e,n){try{gs=Ft;var i=new Ft;return i._=t,o(i,e,n)}finally{gs=Date}}t.floor=t,t.round=i,t.ceil=r,t.offset=a,t.range=o;var l=t.utc=Ht(t);return l.floor=l,l.round=Ht(i),l.ceil=Ht(r),l.offset=Ht(a),l.range=s,t}function Ht(t){return function(e,n){try{gs=Ft;var i=new Ft;return i._=e,t(i,n)._}finally{gs=Date}}}function Yt(t){function e(t){function e(e){for(var n,r,a,o=[],s=-1,l=0;++s<i;)37===t.charCodeAt(s)&&(o.push(t.slice(l,s)),null!=(r=ms[n=t.charAt(++s)])&&(n=t.charAt(++s)),(a=$[n])&&(n=a(e,null==r?"e"===n?" ":"0":r)),o.push(n),l=s+1);return o.push(t.slice(l,s)),o.join("")}var i=t.length;return e.parse=function(e){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(n(i,t,e,0)!=e.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var r=null!=i.Z&&gs!==Ft,a=new(r?Ft:gs);return"j"in i?a.setFullYear(i.y,0,i.j):"W"in i||"U"in i?("w"in i||(i.w="W"in i?1:0),a.setFullYear(i.y,0,1),a.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(a.getDay()+5)%7:i.w+7*i.U-(a.getDay()+6)%7)):a.setFullYear(i.y,i.m,i.d),a.setHours(i.H+(i.Z/100|0),i.M+i.Z%100,i.S,i.L),r?a._:a},e.toString=function(){return t},e}function n(t,e,n,i){for(var r,a,o,s=0,l=e.length,u=n.length;s<l;){if(i>=u)return-1;if(37===(r=e.charCodeAt(s++))){if(o=e.charAt(s++),!(a=A[o in ms?e.charAt(s++):o])||(i=a(t,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}function i(t,e,n){x.lastIndex=0;var i=x.exec(e.slice(n));return i?(t.w=k.get(i[0].toLowerCase()),n+i[0].length):-1}function r(t,e,n){b.lastIndex=0;var i=b.exec(e.slice(n));return i?(t.w=w.get(i[0].toLowerCase()),n+i[0].length):-1}function a(t,e,n){S.lastIndex=0;var i=S.exec(e.slice(n));return i?(t.m=T.get(i[0].toLowerCase()),n+i[0].length):-1}function o(t,e,n){C.lastIndex=0;var i=C.exec(e.slice(n));return i?(t.m=M.get(i[0].toLowerCase()),n+i[0].length):-1}function s(t,e,i){return n(t,$.c.toString(),e,i)}function l(t,e,i){return n(t,$.x.toString(),e,i)}function u(t,e,i){return n(t,$.X.toString(),e,i)}function c(t,e,n){var i=y.get(e.slice(n,n+=2).toLowerCase());return null==i?-1:(t.p=i,n)}var h=t.dateTime,d=t.date,f=t.time,p=t.periods,_=t.days,g=t.shortDays,v=t.months,m=t.shortMonths;e.utc=function(t){function n(t){try{gs=Ft;var e=new gs;return e._=t,i(e)}finally{gs=Date}}var i=e(t);return n.parse=function(t){try{gs=Ft;var e=i.parse(t);return e&&e._}finally{gs=Date}},n.toString=i.toString,n},e.multi=e.utc.multi=fe;var y=fo.map(),b=Wt(_),w=Jt(_),x=Wt(g),k=Jt(g),C=Wt(v),M=Jt(v),S=Wt(m),T=Jt(m);p.forEach(function(t,e){y.set(t.toLowerCase(),e)});var $={a:function(t){return g[t.getDay()]},A:function(t){return _[t.getDay()]},b:function(t){return m[t.getMonth()]},B:function(t){return v[t.getMonth()]},c:e(h),d:function(t,e){return Xt(t.getDate(),e,2)},e:function(t,e){return Xt(t.getDate(),e,2)},H:function(t,e){return Xt(t.getHours(),e,2)},I:function(t,e){return Xt(t.getHours()%12||12,e,2)},j:function(t,e){return Xt(1+_s.dayOfYear(t),e,3)},L:function(t,e){return Xt(t.getMilliseconds(),e,3)},m:function(t,e){return Xt(t.getMonth()+1,e,2)},M:function(t,e){return Xt(t.getMinutes(),e,2)},p:function(t){return p[+(t.getHours()>=12)]},S:function(t,e){return Xt(t.getSeconds(),e,2)},U:function(t,e){return Xt(_s.sundayOfYear(t),e,2)},w:function(t){return t.getDay()},W:function(t,e){return Xt(_s.mondayOfYear(t),e,2)},x:e(d),X:e(f),y:function(t,e){return Xt(t.getFullYear()%100,e,2)},Y:function(t,e){return Xt(t.getFullYear()%1e4,e,4)},Z:he,"%":function(){return"%"}},A={a:i,A:r,b:a,B:o,c:s,d:ae,e:ae,H:se,I:se,j:oe,L:ce,m:re,M:le,p:c,S:ue,U:Zt,w:Kt,W:Qt,x:l,X:u,y:ee,Y:te,Z:ne,"%":de};return e}function Xt(t,e,n){var i=t<0?"-":"",r=(i?-t:t)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(e)+r:r)}function Wt(t){return new RegExp("^(?:"+t.map(fo.requote).join("|")+")","i")}function Jt(t){for(var e=new p,n=-1,i=t.length;++n<i;)e.set(t[n].toLowerCase(),n);return e}function Kt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+1));return i?(t.w=+i[0],n+i[0].length):-1}function Zt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n));return i?(t.U=+i[0],n+i[0].length):-1}function Qt(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n));return i?(t.W=+i[0],n+i[0].length):-1}function te(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+4));return i?(t.y=+i[0],n+i[0].length):-1}function ee(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.y=ie(+i[0]),n+i[0].length):-1}function ne(t,e,n){return/^[+-]\d{4}$/.test(e=e.slice(n,n+5))?(t.Z=-e,n+5):-1}function ie(t){return t+(t>68?1900:2e3)}function re(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.m=i[0]-1,n+i[0].length):-1}function ae(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.d=+i[0],n+i[0].length):-1}function oe(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+3));return i?(t.j=+i[0],n+i[0].length):-1}function se(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.H=+i[0],n+i[0].length):-1}function le(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.M=+i[0],n+i[0].length):-1}function ue(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+2));return i?(t.S=+i[0],n+i[0].length):-1}function ce(t,e,n){ys.lastIndex=0;var i=ys.exec(e.slice(n,n+3));return i?(t.L=+i[0],n+i[0].length):-1}function he(t){var e=t.getTimezoneOffset(),n=e>0?"-":"+",i=ko(e)/60|0,r=ko(e)%60;return n+Xt(i,"0",2)+Xt(r,"0",2)}function de(t,e,n){bs.lastIndex=0;var i=bs.exec(e.slice(n,n+1));return i?n+i[0].length:-1}function fe(t){for(var e=t.length,n=-1;++n<e;)t[n][0]=this(t[n][0]);return function(e){for(var n=0,i=t[n];!i[1](e);)i=t[++n];return i[0](e)}}function pe(){}function _e(t,e,n){var i=n.s=t+e,r=i-t,a=i-r;n.t=t-a+(e-r)}function ge(t,e){t&&Cs.hasOwnProperty(t.type)&&Cs[t.type](t,e)}function ve(t,e,n){var i,r=-1,a=t.length-n;for(e.lineStart();++r<a;)i=t[r],e.point(i[0],i[1],i[2]);e.lineEnd()}function me(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)ve(t[n],e,1);e.polygonEnd()}function ye(){function t(t,e){t*=Ho,e=e*Ho/2+Vo/4;var n=t-i,o=n>=0?1:-1,s=o*n,l=Math.cos(e),u=Math.sin(e),c=a*u,h=r*l+c*Math.cos(s),d=c*o*Math.sin(s);Ss.add(Math.atan2(d,h)),i=t,r=l,a=u}var e,n,i,r,a;Ts.point=function(o,s){Ts.point=t,i=(e=o)*Ho,r=Math.cos(s=(n=s)*Ho/2+Vo/4),a=Math.sin(s)},Ts.lineEnd=function(){t(e,n)}}function be(t){var e=t[0],n=t[1],i=Math.cos(n);return[i*Math.cos(e),i*Math.sin(e),Math.sin(n)]}function we(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function xe(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function ke(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Ce(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Me(t){var e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function Se(t){return[Math.atan2(t[1],t[0]),ot(t[2])]}function Te(t,e){return ko(t[0]-e[0])<Io&&ko(t[1]-e[1])<Io}function $e(t,e){t*=Ho;var n=Math.cos(e*=Ho);Ae(n*Math.cos(t),n*Math.sin(t),Math.sin(e))}function Ae(t,e,n){++$s,Es+=(t-Es)/$s,Os+=(e-Os)/$s,zs+=(n-zs)/$s}function Ee(){function t(t,r){t*=Ho;var a=Math.cos(r*=Ho),o=a*Math.cos(t),s=a*Math.sin(t),l=Math.sin(r),u=Math.atan2(Math.sqrt((u=n*l-i*s)*u+(u=i*o-e*l)*u+(u=e*s-n*o)*u),e*o+n*s+i*l);As+=u,Rs+=u*(e+(e=o)),Ns+=u*(n+(n=s)),Ps+=u*(i+(i=l)),Ae(e,n,i)}var e,n,i;Ls.point=function(r,a){r*=Ho;var o=Math.cos(a*=Ho);e=o*Math.cos(r),n=o*Math.sin(r),i=Math.sin(a),Ls.point=t,Ae(e,n,i)}}function Oe(){Ls.point=$e}function ze(){function t(t,e){t*=Ho;var n=Math.cos(e*=Ho),o=n*Math.cos(t),s=n*Math.sin(t),l=Math.sin(e),u=r*l-a*s,c=a*o-i*l,h=i*s-r*o,d=Math.sqrt(u*u+c*c+h*h),f=i*o+r*s+a*l,p=d&&-at(f)/d,_=Math.atan2(d,f);qs+=p*u,js+=p*c,Ds+=p*h,As+=_,Rs+=_*(i+(i=o)),Ns+=_*(r+(r=s)),Ps+=_*(a+(a=l)),Ae(i,r,a)}var e,n,i,r,a;Ls.point=function(o,s){e=o,n=s,Ls.point=t,o*=Ho;var l=Math.cos(s*=Ho);i=l*Math.cos(o),r=l*Math.sin(o),a=Math.sin(s),Ae(i,r,a)},Ls.lineEnd=function(){t(e,n),Ls.lineEnd=Oe,Ls.point=$e}}function Re(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function Ne(){return!0}function Pe(t,e,n,i,r){var a=[],o=[];if(t.forEach(function(t){if(!((e=t.length-1)<=0)){var e,n=t[0],i=t[e];if(Te(n,i)){r.lineStart();for(var s=0;s<e;++s)r.point((n=t[s])[0],n[1]);return void r.lineEnd()}var l=new je(n,t,null,!0),u=new je(n,null,l,!1);l.o=u,a.push(l),o.push(u),l=new je(i,t,null,!1),u=new je(i,null,l,!0),l.o=u,a.push(l),o.push(u)}}),o.sort(e),qe(a),qe(o),a.length){for(var s=0,l=n,u=o.length;s<u;++s)o[s].e=l=!l;for(var c,h,d=a[0];;){for(var f=d,p=!0;f.v;)if((f=f.n)===d)return;c=f.z,r.lineStart();do{if(f.v=f.o.v=!0,f.e){if(p)for(var s=0,u=c.length;s<u;++s)r.point((h=c[s])[0],h[1]);else i(f.x,f.n.x,1,r);f=f.n}else{if(p){c=f.p.z;for(var s=c.length-1;s>=0;--s)r.point((h=c[s])[0],h[1])}else i(f.x,f.p.x,-1,r);f=f.p}f=f.o,c=f.z,p=!p}while(!f.v);r.lineEnd()}}}function qe(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function je(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function De(t,e,n,i){return function(r,a){function o(e,n){var i=r(e,n);t(e=i[0],n=i[1])&&a.point(e,n)}function s(t,e){var n=r(t,e);g.point(n[0],n[1])}function l(){m.point=s,g.lineStart()}function u(){m.point=o,g.lineEnd()}function c(t,e){_.push([t,e]);var n=r(t,e);b.point(n[0],n[1])}function h(){b.lineStart(),_=[]}function d(){c(_[0][0],_[0][1]),b.lineEnd();var t,e=b.clean(),n=y.buffer(),i=n.length;if(_.pop(),p.push(_),_=null,i)if(1&e){t=n[0];var r,i=t.length-1,o=-1;if(i>0){for(w||(a.polygonStart(),w=!0),a.lineStart();++o<i;)a.point((r=t[o])[0],r[1]);a.lineEnd()}}else i>1&&2&e&&n.push(n.pop().concat(n.shift())),f.push(n.filter(Le))}var f,p,_,g=e(a),v=r.invert(i[0],i[1]),m={point:o,lineStart:l,lineEnd:u,polygonStart:function(){m.point=c,m.lineStart=h,m.lineEnd=d,f=[],p=[]},polygonEnd:function(){m.point=o,m.lineStart=l,m.lineEnd=u,f=fo.merge(f);var t=Ge(v,p);f.length?(w||(a.polygonStart(),w=!0),Pe(f,Be,t,n,a)):t&&(w||(a.polygonStart(),w=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),w&&(a.polygonEnd(),w=!1),f=p=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}},y=Ie(),b=e(y),w=!1;return m}}function Le(t){return t.length>1}function Ie(){var t,e=[];return{lineStart:function(){e.push(t=[])},point:function(e,n){t.push([e,n])},lineEnd:S,buffer:function(){var n=e;return e=[],t=null,n},rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))}}}function Be(t,e){return((t=t.x)[0]<0?t[1]-Go-Io:Go-t[1])-((e=e.x)[0]<0?e[1]-Go-Io:Go-e[1])}function Ve(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(a,o){var s=a>0?Vo:-Vo,l=ko(a-n);ko(l-Vo)<Io?(t.point(n,i=(i+o)/2>0?Go:-Go),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),t.point(a,i),e=0):r!==s&&l>=Vo&&(ko(n-r)<Io&&(n-=r*Io),ko(a-s)<Io&&(a-=s*Io),i=Ue(n,i,a,o),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(s,i),e=0),t.point(n=a,i=o),r=s},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}function Ue(t,e,n,i){var r,a,o=Math.sin(t-n);return ko(o)>Io?Math.atan((Math.sin(e)*(a=Math.cos(i))*Math.sin(n)-Math.sin(i)*(r=Math.cos(e))*Math.sin(t))/(r*a*o)):(e+i)/2}function Fe(t,e,n,i){var r;if(null==t)r=n*Go,i.point(-Vo,r),i.point(0,r),i.point(Vo,r),i.point(Vo,0),i.point(Vo,-r),i.point(0,-r),i.point(-Vo,-r),i.point(-Vo,0),i.point(-Vo,r);else if(ko(t[0]-e[0])>Io){var a=t[0]<e[0]?Vo:-Vo;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(e[0],e[1])}function Ge(t,e){var n=t[0],i=t[1],r=[Math.sin(n),-Math.cos(n),0],a=0,o=0;Ss.reset();for(var s=0,l=e.length;s<l;++s){var u=e[s],c=u.length;if(c)for(var h=u[0],d=h[0],f=h[1]/2+Vo/4,p=Math.sin(f),_=Math.cos(f),g=1;;){g===c&&(g=0),t=u[g];var v=t[0],m=t[1]/2+Vo/4,y=Math.sin(m),b=Math.cos(m),w=v-d,x=w>=0?1:-1,k=x*w,C=k>Vo,M=p*y;if(Ss.add(Math.atan2(M*x*Math.sin(k),_*b+M*Math.cos(k))),a+=C?w+x*Uo:w,C^d>=n^v>=n){var S=xe(be(h),be(t));Me(S);var T=xe(r,S);Me(T);var $=(C^w>=0?-1:1)*ot(T[2]);(i>$||i===$&&(S[0]||S[1]))&&(o+=C^w>=0?1:-1)}if(!g++)break;d=v,p=y,_=b,h=t}}return(a<-Io||a<Io&&Ss<-Io)^1&o}function He(t){function e(t,e){return Math.cos(t)*Math.cos(e)>a}function n(t){var n,a,l,u,c;return{lineStart:function(){u=l=!1,c=1},point:function(h,d){var f,p=[h,d],_=e(h,d),g=o?_?0:r(h,d):_?r(h+(h<0?Vo:-Vo),d):0;if(!n&&(u=l=_)&&t.lineStart(),_!==l&&(f=i(n,p),(Te(n,f)||Te(p,f))&&(p[0]+=Io,p[1]+=Io,_=e(p[0],p[1]))),_!==l)c=0,_?(t.lineStart(),f=i(p,n),t.point(f[0],f[1])):(f=i(n,p),t.point(f[0],f[1]),t.lineEnd()),n=f;else if(s&&n&&o^_){var v;g&a||!(v=i(p,n,!0))||(c=0,o?(t.lineStart(),t.point(v[0][0],v[0][1]),t.point(v[1][0],v[1][1]),t.lineEnd()):(t.point(v[1][0],v[1][1]),t.lineEnd(),t.lineStart(),t.point(v[0][0],v[0][1])))}!_||n&&Te(n,p)||t.point(p[0],p[1]),n=p,l=_,a=g},lineEnd:function(){l&&t.lineEnd(),n=null},clean:function(){return c|(u&&l)<<1}}}function i(t,e,n){var i=be(t),r=be(e),o=[1,0,0],s=xe(i,r),l=we(s,s),u=s[0],c=l-u*u;if(!c)return!n&&t;var h=a*l/c,d=-a*u/c,f=xe(o,s),p=Ce(o,h);ke(p,Ce(s,d));var _=f,g=we(p,_),v=we(_,_),m=g*g-v*(we(p,p)-1);if(!(m<0)){var y=Math.sqrt(m),b=Ce(_,(-g-y)/v);if(ke(b,p),b=Se(b),!n)return b;var w,x=t[0],k=e[0],C=t[1],M=e[1];k<x&&(w=x,x=k,k=w);var S=k-x,T=ko(S-Vo)<Io,$=T||S<Io;if(!T&&M<C&&(w=C,C=M,M=w),$?T?C+M>0^b[1]<(ko(b[0]-x)<Io?C:M):C<=b[1]&&b[1]<=M:S>Vo^(x<=b[0]&&b[0]<=k)){var A=Ce(_,(-g+y)/v);return ke(A,p),[b,Se(A)]}}}function r(e,n){var i=o?t:Vo-t,r=0;return e<-i?r|=1:e>i&&(r|=2),n<-i?r|=4:n>i&&(r|=8),r}var a=Math.cos(t),o=a>0,s=ko(a)>Io;return De(e,n,bn(t,6*Ho),o?[0,-t]:[-Vo,t-Vo])}function Ye(t,e,n,i){return function(r){var a,o=r.a,s=r.b,l=o.x,u=o.y,c=s.x,h=s.y,d=0,f=1,p=c-l,_=h-u;if(a=t-l,p||!(a>0)){if(a/=p,p<0){if(a<d)return;a<f&&(f=a)}else if(p>0){if(a>f)return;a>d&&(d=a)}if(a=n-l,p||!(a<0)){if(a/=p,p<0){if(a>f)return;a>d&&(d=a)}else if(p>0){if(a<d)return;a<f&&(f=a)}if(a=e-u,_||!(a>0)){if(a/=_,_<0){if(a<d)return;a<f&&(f=a)}else if(_>0){if(a>f)return;a>d&&(d=a)}if(a=i-u,_||!(a<0)){if(a/=_,_<0){if(a>f)return;a>d&&(d=a)}else if(_>0){if(a<d)return;a<f&&(f=a)}return d>0&&(r.a={x:l+d*p,y:u+d*_}),f<1&&(r.b={x:l+f*p,y:u+f*_}),r}}}}}}function Xe(t,e,n,i){function r(i,r){return ko(i[0]-t)<Io?r>0?0:3:ko(i[0]-n)<Io?r>0?2:1:ko(i[1]-e)<Io?r>0?1:0:r>0?3:2}function a(t,e){return o(t.x,e.x)}function o(t,e){var n=r(t,1),i=r(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){function l(t){for(var e=0,n=g.length,i=t[1],r=0;r<n;++r)for(var a,o=1,s=g[r],l=s.length,u=s[0];o<l;++o)a=s[o],u[1]<=i?a[1]>i&&rt(u,a,t)>0&&++e:a[1]<=i&&rt(u,a,t)<0&&--e,u=a;return 0!==e}function u(a,s,l,u){var c=0,h=0;if(null==a||(c=r(a,l))!==(h=r(s,l))||o(a,s)<0^l>0)do{u.point(0===c||3===c?t:n,c>1?i:e)}while((c=(c+l+4)%4)!==h);else u.point(s[0],s[1])}function c(r,a){return t<=r&&r<=n&&e<=a&&a<=i}function h(t,e){c(t,e)&&s.point(t,e)}function d(){A.point=p,g&&g.push(v=[]),C=!0,k=!1,w=x=NaN}function f(){_&&(p(m,y),b&&k&&T.rejoin(),_.push(T.buffer())),A.point=h,k&&s.lineEnd()}function p(t,e){t=Math.max(-Bs,Math.min(Bs,t)),e=Math.max(-Bs,Math.min(Bs,e));var n=c(t,e);if(g&&v.push([t,e]),C)m=t,y=e,b=n,C=!1,n&&(s.lineStart(),s.point(t,e));else if(n&&k)s.point(t,e);else{var i={a:{x:w,y:x},b:{x:t,y:e}};$(i)?(k||(s.lineStart(),s.point(i.a.x,i.a.y)),s.point(i.b.x,i.b.y),n||s.lineEnd(),M=!1):n&&(s.lineStart(),s.point(t,e),M=!1)}w=t,x=e,k=n}var _,g,v,m,y,b,w,x,k,C,M,S=s,T=Ie(),$=Ye(t,e,n,i),A={point:h,lineStart:d,lineEnd:f,polygonStart:function(){s=T,_=[],g=[],M=!0},polygonEnd:function(){s=S,_=fo.merge(_);var e=l([t,i]),n=M&&e,r=_.length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),u(null,null,1,s),s.lineEnd()),r&&Pe(_,a,e,u,s),s.polygonEnd()),_=g=v=null}};return A}}function We(t){var e=0,n=Vo/3,i=dn(t),r=i(e,n);return r.parallels=function(t){return arguments.length?i(e=t[0]*Vo/180,n=t[1]*Vo/180):[e/Vo*180,n/Vo*180]},r}function Je(t,e){function n(t,e){var n=Math.sqrt(a-2*r*Math.sin(e))/r;return[n*Math.sin(t*=r),o-n*Math.cos(t)]}var i=Math.sin(t),r=(i+Math.sin(e))/2,a=1+i*(2*r-i),o=Math.sqrt(a)/r;return n.invert=function(t,e){var n=o-e;return[Math.atan2(t,n)/r,ot((a-(t*t+n*n)*r*r)/(2*r))]},n}function Ke(){function t(t,e){Us+=r*t-i*e,i=t,r=e}var e,n,i,r;Xs.point=function(a,o){Xs.point=t,e=i=a,n=r=o},Xs.lineEnd=function(){t(e,n)}}function Ze(t,e){t<Fs&&(Fs=t),t>Hs&&(Hs=t),e<Gs&&(Gs=e),e>Ys&&(Ys=e)}function Qe(){function t(t,e){o.push("M",t,",",e,a)}function e(t,e){o.push("M",t,",",e),s.point=n}function n(t,e){o.push("L",t,",",e)}function i(){s.point=t}function r(){o.push("Z")}var a=tn(4.5),o=[],s={point:t,lineStart:function(){s.point=e},lineEnd:i,polygonStart:function(){s.lineEnd=r},polygonEnd:function(){s.lineEnd=i,s.point=t},pointRadius:function(t){return a=tn(t),s},result:function(){if(o.length){var t=o.join("");return o=[],t}}};return s}function tn(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function en(t,e){Es+=t,Os+=e,++zs}function nn(){function t(t,i){var r=t-e,a=i-n,o=Math.sqrt(r*r+a*a);Rs+=o*(e+t)/2,Ns+=o*(n+i)/2,Ps+=o,en(e=t,n=i)}var e,n;Js.point=function(i,r){Js.point=t,en(e=i,n=r)}}function rn(){Js.point=en}function an(){function t(t,e){var n=t-i,a=e-r,o=Math.sqrt(n*n+a*a);Rs+=o*(i+t)/2,Ns+=o*(r+e)/2,Ps+=o,o=r*t-i*e,qs+=o*(i+t),js+=o*(r+e),Ds+=3*o,en(i=t,r=e)}var e,n,i,r;Js.point=function(a,o){Js.point=t,en(e=i=a,n=r=o)},Js.lineEnd=function(){t(e,n)}}function on(t){function e(e,n){t.moveTo(e+o,n),t.arc(e,n,o,0,Uo)}function n(e,n){t.moveTo(e,n),s.point=i}function i(e,n){t.lineTo(e,n)}function r(){s.point=e}function a(){t.closePath()}var o=4.5,s={point:e,lineStart:function(){s.point=n},lineEnd:r,polygonStart:function(){s.lineEnd=a},polygonEnd:function(){s.lineEnd=r,s.point=e},pointRadius:function(t){return o=t,s},result:S};return s}function sn(t){function e(t){return(s?i:n)(t)}function n(e){return cn(e,function(n,i){n=t(n,i),e.point(n[0],n[1])})}function i(e){function n(n,i){n=t(n,i),e.point(n[0],n[1])}function i(){y=NaN,C.point=a,e.lineStart()}function a(n,i){var a=be([n,i]),o=t(n,i);r(y,b,m,w,x,k,y=o[0],b=o[1],m=n,w=a[0],x=a[1],k=a[2],s,e),e.point(y,b)}function o(){C.point=n,e.lineEnd()}function l(){i(),C.point=u,C.lineEnd=c}function u(t,e){a(h=t,d=e),f=y,p=b,_=w,g=x,v=k,C.point=a}function c(){r(y,b,m,w,x,k,f,p,h,_,g,v,s,e),C.lineEnd=o,o()}var h,d,f,p,_,g,v,m,y,b,w,x,k,C={point:n,lineStart:i,lineEnd:o,polygonStart:function(){e.polygonStart(),C.lineStart=l},polygonEnd:function(){e.polygonEnd(),C.lineStart=i}};return C}function r(e,n,i,s,l,u,c,h,d,f,p,_,g,v){var m=c-e,y=h-n,b=m*m+y*y;if(b>4*a&&g--){var w=s+f,x=l+p,k=u+_,C=Math.sqrt(w*w+x*x+k*k),M=Math.asin(k/=C),S=ko(ko(k)-1)<Io||ko(i-d)<Io?(i+d)/2:Math.atan2(x,w),T=t(S,M),$=T[0],A=T[1],E=$-e,O=A-n,z=y*E-m*O;(z*z/b>a||ko((m*E+y*O)/b-.5)>.3||s*f+l*p+u*_<o)&&(r(e,n,i,s,l,u,$,A,S,w/=C,x/=C,k,g,v),v.point($,A),r($,A,S,w,x,k,c,h,d,f,p,_,g,v))}}var a=.5,o=Math.cos(30*Ho),s=16;return e.precision=function(t){return arguments.length?(s=(a=t*t)>0&&16,e):Math.sqrt(a)},e}function ln(t){var e=sn(function(e,n){return t([e*Yo,n*Yo])});return function(t){return fn(e(t))}}function un(t){this.stream=t}function cn(t,e){return{point:e,sphere:function(){t.sphere()},lineStart:function(){t.lineStart()},lineEnd:function(){t.lineEnd()},polygonStart:function(){t.polygonStart()},polygonEnd:function(){t.polygonEnd()}}}function hn(t){return dn(function(){return t})()}function dn(t){function e(t){return t=s(t[0]*Ho,t[1]*Ho),[t[0]*d+l,u-t[1]*d]}function n(t){return(t=s.invert((t[0]-l)/d,(u-t[1])/d))&&[t[0]*Yo,t[1]*Yo]}function i(){s=Re(o=gn(v,m,y),a);var t=a(_,g);return l=f-t[0]*d,u=p+t[1]*d,r()}function r(){return c&&(c.valid=!1,c=null),e}var a,o,s,l,u,c,h=sn(function(t,e){return t=a(t,e),[t[0]*d+l,u-t[1]*d]}),d=150,f=480,p=250,_=0,g=0,v=0,m=0,y=0,b=Is,w=k,x=null,C=null;return e.stream=function(t){return c&&(c.valid=!1),c=fn(b(o,h(w(t)))),c.valid=!0,c},e.clipAngle=function(t){return arguments.length?(b=null==t?(x=t,Is):He((x=+t)*Ho),r()):x},e.clipExtent=function(t){return arguments.length?(C=t,w=t?Xe(t[0][0],t[0][1],t[1][0],t[1][1]):k,r()):C},e.scale=function(t){return arguments.length?(d=+t,i()):d},e.translate=function(t){return arguments.length?(f=+t[0],p=+t[1],i()):[f,p]},e.center=function(t){return arguments.length?(_=t[0]%360*Ho,g=t[1]%360*Ho,i()):[_*Yo,g*Yo]},e.rotate=function(t){return arguments.length?(v=t[0]%360*Ho,m=t[1]%360*Ho,y=t.length>2?t[2]%360*Ho:0,i()):[v*Yo,m*Yo,y*Yo]},fo.rebind(e,h,"precision"),function(){return a=t.apply(this,arguments),e.invert=a.invert&&n,i()}}function fn(t){return cn(t,function(e,n){t.point(e*Ho,n*Ho)})}function pn(t,e){return[t,e]}function _n(t,e){return[t>Vo?t-Uo:t<-Vo?t+Uo:t,e]}function gn(t,e,n){return t?e||n?Re(mn(t),yn(e,n)):mn(t):e||n?yn(e,n):_n}function vn(t){return function(e,n){return e+=t,[e>Vo?e-Uo:e<-Vo?e+Uo:e,n]}}function mn(t){var e=vn(t);return e.invert=vn(-t),e}function yn(t,e){function n(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,u=Math.sin(e),c=u*i+s*r;return[Math.atan2(l*a-c*o,s*i-u*r),ot(c*a+l*o)]}var i=Math.cos(t),r=Math.sin(t),a=Math.cos(e),o=Math.sin(e);return n.invert=function(t,e){var n=Math.cos(e),s=Math.cos(t)*n,l=Math.sin(t)*n,u=Math.sin(e),c=u*a-l*o;return[Math.atan2(l*a+u*o,s*i+c*r),ot(c*i-s*r)]},n}function bn(t,e){var n=Math.cos(t),i=Math.sin(t);return function(r,a,o,s){var l=o*e;null!=r?(r=wn(n,r),a=wn(n,a),(o>0?r<a:r>a)&&(r+=o*Uo)):(r=t+o*Uo,a=t-.5*l);for(var u,c=r;o>0?c>a:c<a;c-=l)s.point((u=Se([n,-i*Math.cos(c),-i*Math.sin(c)]))[0],u[1])}}function wn(t,e){var n=be(e);n[0]-=t,Me(n);var i=at(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-Io)%(2*Math.PI)}function xn(t,e,n){var i=fo.range(t,e-Io,n).concat(e);return function(t){return i.map(function(e){return[t,e]})}}function kn(t,e,n){var i=fo.range(t,e-Io,n).concat(e);return function(t){return i.map(function(e){return[e,t]})}}function Cn(t){return t.source}function Mn(t){return t.target}function Sn(t,e,n,i){var r=Math.cos(e),a=Math.sin(e),o=Math.cos(i),s=Math.sin(i),l=r*Math.cos(t),u=r*Math.sin(t),c=o*Math.cos(n),h=o*Math.sin(n),d=2*Math.asin(Math.sqrt(ct(i-e)+r*o*ct(n-t))),f=1/Math.sin(d),p=d?function(t){var e=Math.sin(t*=d)*f,n=Math.sin(d-t)*f,i=n*l+e*c,r=n*u+e*h,o=n*a+e*s;return[Math.atan2(r,i)*Yo,Math.atan2(o,Math.sqrt(i*i+r*r))*Yo]}:function(){return[t*Yo,e*Yo]};return p.distance=d,p}function Tn(){function t(t,r){var a=Math.sin(r*=Ho),o=Math.cos(r),s=ko((t*=Ho)-e),l=Math.cos(s);Ks+=Math.atan2(Math.sqrt((s=o*Math.sin(s))*s+(s=i*a-n*o*l)*s),n*a+i*o*l),e=t,n=a,i=o}var e,n,i;Zs.point=function(r,a){e=r*Ho,n=Math.sin(a*=Ho),i=Math.cos(a),Zs.point=t},Zs.lineEnd=function(){Zs.point=Zs.lineEnd=S}}function $n(t,e){function n(e,n){var i=Math.cos(e),r=Math.cos(n),a=t(i*r);return[a*r*Math.sin(e),a*Math.sin(n)]}return n.invert=function(t,n){var i=Math.sqrt(t*t+n*n),r=e(i),a=Math.sin(r),o=Math.cos(r);return[Math.atan2(t*a,i*o),Math.asin(i&&n*a/i)]},n}function An(t,e){function n(t,e){o>0?e<-Go+Io&&(e=-Go+Io):e>Go-Io&&(e=Go-Io);var n=o/Math.pow(r(e),a);return[n*Math.sin(a*t),o-n*Math.cos(a*t)]}var i=Math.cos(t),r=function(t){return Math.tan(Vo/4+t/2)},a=t===e?Math.sin(t):Math.log(i/Math.cos(e))/Math.log(r(e)/r(t)),o=i*Math.pow(r(t),a)/a;return a?(n.invert=function(t,e){var n=o-e,i=it(a)*Math.sqrt(t*t+n*n);return[Math.atan2(t,n)/a,2*Math.atan(Math.pow(o/i,1/a))-Go]},n):On}function En(t,e){function n(t,e){var n=a-e;return[n*Math.sin(r*t),a-n*Math.cos(r*t)]}var i=Math.cos(t),r=t===e?Math.sin(t):(i-Math.cos(e))/(e-t),a=i/r+t;return ko(r)<Io?pn:(n.invert=function(t,e){var n=a-e;return[Math.atan2(t,n)/r,a-it(r)*Math.sqrt(t*t+n*n)]},n)}function On(t,e){return[t,Math.log(Math.tan(Vo/4+e/2))]}function zn(t){var e,n=hn(t),i=n.scale,r=n.translate,a=n.clipExtent;return n.scale=function(){var t=i.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.translate=function(){var t=r.apply(n,arguments);return t===n?e?n.clipExtent(null):n:t},n.clipExtent=function(t){var o=a.apply(n,arguments);if(o===n){if(e=null==t){var s=Vo*i(),l=r();a([[l[0]-s,l[1]-s],[l[0]+s,l[1]+s]])}}else e&&(o=null);return o},n.clipExtent(null)}function Rn(t,e){return[Math.log(Math.tan(Vo/4+e/2)),-t]}function Nn(t){return t[0]}function Pn(t){return t[1]}function qn(t){for(var e=t.length,n=[0,1],i=2,r=2;r<e;r++){for(;i>1&&rt(t[n[i-2]],t[n[i-1]],t[r])<=0;)--i;n[i++]=r}return n.slice(0,i)}function jn(t,e){return t[0]-e[0]||t[1]-e[1]}function Dn(t,e,n){return(n[0]-e[0])*(t[1]-e[1])<(n[1]-e[1])*(t[0]-e[0])}function Ln(t,e,n,i){var r=t[0],a=n[0],o=e[0]-r,s=i[0]-a,l=t[1],u=n[1],c=e[1]-l,h=i[1]-u,d=(s*(l-u)-h*(r-a))/(h*o-s*c);return[r+d*o,l+d*c]}function In(t){var e=t[0],n=t[t.length-1];return!(e[0]-n[0]||e[1]-n[1])}function Bn(){li(this),this.edge=this.site=this.circle=null}function Vn(t){var e=cl.pop()||new Bn;return e.site=t,e}function Un(t){Qn(t),sl.remove(t),cl.push(t),li(t)}function Fn(t){var e=t.circle,n=e.x,i=e.cy,r={x:n,y:i},a=t.P,o=t.N,s=[t];Un(t);for(var l=a;l.circle&&ko(n-l.circle.x)<Io&&ko(i-l.circle.cy)<Io;)a=l.P,s.unshift(l),Un(l),l=a;s.unshift(l),Qn(l);for(var u=o;u.circle&&ko(n-u.circle.x)<Io&&ko(i-u.circle.cy)<Io;)o=u.N,s.push(u),Un(u),u=o;s.push(u),Qn(u);var c,h=s.length;for(c=1;c<h;++c)u=s[c],l=s[c-1],ai(u.edge,l.site,u.site,r);l=s[0],u=s[h-1],u.edge=ii(l.site,u.site,null,r),Zn(l),Zn(u)}function Gn(t){for(var e,n,i,r,a=t.x,o=t.y,s=sl._;s;)if((i=Hn(s,o)-a)>Io)s=s.L;else{if(!((r=a-Yn(s,o))>Io)){i>-Io?(e=s.P,n=s):r>-Io?(e=s,n=s.N):e=n=s;break}if(!s.R){e=s;break}s=s.R}var l=Vn(t);if(sl.insert(e,l),e||n){if(e===n)return Qn(e),n=Vn(e.site),sl.insert(l,n),l.edge=n.edge=ii(e.site,l.site),Zn(e),void Zn(n);if(!n)return void(l.edge=ii(e.site,l.site));Qn(e),Qn(n);var u=e.site,c=u.x,h=u.y,d=t.x-c,f=t.y-h,p=n.site,_=p.x-c,g=p.y-h,v=2*(d*g-f*_),m=d*d+f*f,y=_*_+g*g,b={x:(g*m-f*y)/v+c,y:(d*y-_*m)/v+h};ai(n.edge,u,p,b),l.edge=ii(u,t,null,b),n.edge=ii(t,p,null,b),Zn(e),Zn(n)}}function Hn(t,e){var n=t.site,i=n.x,r=n.y,a=r-e;if(!a)return i;var o=t.P;if(!o)return-1/0;n=o.site;var s=n.x,l=n.y,u=l-e;if(!u)return s;var c=s-i,h=1/a-1/u,d=c/u;return h?(-d+Math.sqrt(d*d-2*h*(c*c/(-2*u)-l+u/2+r-a/2)))/h+i:(i+s)/2}function Yn(t,e){var n=t.N;if(n)return Hn(n,e);var i=t.site;return i.y===e?i.x:1/0}function Xn(t){this.site=t,this.edges=[]}function Wn(t){for(var e,n,i,r,a,o,s,l,u,c,h=t[0][0],d=t[1][0],f=t[0][1],p=t[1][1],_=ol,g=_.length;g--;)if((a=_[g])&&a.prepare())for(s=a.edges,l=s.length,o=0;o<l;)c=s[o].end(),i=c.x,r=c.y,u=s[++o%l].start(),e=u.x,n=u.y,(ko(i-e)>Io||ko(r-n)>Io)&&(s.splice(o,0,new oi(ri(a.site,c,ko(i-h)<Io&&p-r>Io?{x:h,y:ko(e-h)<Io?n:p}:ko(r-p)<Io&&d-i>Io?{x:ko(n-p)<Io?e:d,y:p}:ko(i-d)<Io&&r-f>Io?{x:d,y:ko(e-d)<Io?n:f}:ko(r-f)<Io&&i-h>Io?{x:ko(n-f)<Io?e:h,y:f}:null),a.site,null)),++l)}function Jn(t,e){return e.angle-t.angle}function Kn(){li(this),this.x=this.y=this.arc=this.site=this.cy=null}function Zn(t){var e=t.P,n=t.N;if(e&&n){var i=e.site,r=t.site,a=n.site;if(i!==a){var o=r.x,s=r.y,l=i.x-o,u=i.y-s,c=a.x-o,h=a.y-s,d=2*(l*h-u*c);if(!(d>=-Bo)){var f=l*l+u*u,p=c*c+h*h,_=(h*f-u*p)/d,g=(l*p-c*f)/d,h=g+s,v=hl.pop()||new Kn;v.arc=t,v.site=r,v.x=_+o,v.y=h+Math.sqrt(_*_+g*g),v.cy=h,t.circle=v;for(var m=null,y=ul._;y;)if(v.y<y.y||v.y===y.y&&v.x<=y.x){if(!y.L){m=y.P;break}y=y.L}else{if(!y.R){m=y;break}y=y.R}ul.insert(m,v),m||(ll=v)}}}}function Qn(t){var e=t.circle;e&&(e.P||(ll=e.N),ul.remove(e),hl.push(e),li(e),t.circle=null)}function ti(t){for(var e,n=al,i=Ye(t[0][0],t[0][1],t[1][0],t[1][1]),r=n.length;r--;)e=n[r],(!ei(e,t)||!i(e)||ko(e.a.x-e.b.x)<Io&&ko(e.a.y-e.b.y)<Io)&&(e.a=e.b=null,n.splice(r,1))}function ei(t,e){var n=t.b;if(n)return!0;var i,r,a=t.a,o=e[0][0],s=e[1][0],l=e[0][1],u=e[1][1],c=t.l,h=t.r,d=c.x,f=c.y,p=h.x,_=h.y,g=(d+p)/2,v=(f+_)/2;if(_===f){if(g<o||g>=s)return;if(d>p){if(a){if(a.y>=u)return}else a={x:g,y:l};n={x:g,y:u}}else{if(a){if(a.y<l)return}else a={x:g,y:u};n={x:g,y:l}}}else if(i=(d-p)/(_-f),r=v-i*g,i<-1||i>1)if(d>p){if(a){if(a.y>=u)return}else a={x:(l-r)/i,y:l};n={x:(u-r)/i,y:u}}else{if(a){if(a.y<l)return}else a={x:(u-r)/i,y:u};n={x:(l-r)/i,y:l}}else if(f<_){if(a){if(a.x>=s)return}else a={x:o,y:i*o+r};n={x:s,y:i*s+r}}else{if(a){if(a.x<o)return}else a={x:s,y:i*s+r};n={x:o,y:i*o+r}}return t.a=a,t.b=n,!0}function ni(t,e){this.l=t,this.r=e,this.a=this.b=null}function ii(t,e,n,i){var r=new ni(t,e);return al.push(r),n&&ai(r,t,e,n),i&&ai(r,e,t,i),ol[t.i].edges.push(new oi(r,t,e)),ol[e.i].edges.push(new oi(r,e,t)),r}function ri(t,e,n){var i=new ni(t,null);return i.a=e,i.b=n,al.push(i),i}function ai(t,e,n,i){t.a||t.b?t.l===n?t.b=i:t.a=i:(t.a=i,t.l=e,t.r=n)}function oi(t,e,n){var i=t.a,r=t.b;this.edge=t,this.site=e,this.angle=n?Math.atan2(n.y-e.y,n.x-e.x):t.l===e?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y)}function si(){this._=null}function li(t){t.U=t.C=t.L=t.R=t.P=t.N=null}function ui(t,e){var n=e,i=e.R,r=n.U;r?r.L===n?r.L=i:r.R=i:t._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function ci(t,e){var n=e,i=e.L,r=n.U;r?r.L===n?r.L=i:r.R=i:t._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function hi(t){for(;t.L;)t=t.L;return t}function di(t,e){var n,i,r,a=t.sort(fi).pop();for(al=[],ol=new Array(t.length),sl=new si,ul=new si;;)if(r=ll,a&&(!r||a.y<r.y||a.y===r.y&&a.x<r.x))a.x===n&&a.y===i||(ol[a.i]=new Xn(a),Gn(a),n=a.x,i=a.y),a=t.pop();else{if(!r)break;Fn(r.arc)}e&&(ti(e),Wn(e));var o={cells:ol,edges:al};return sl=ul=al=ol=null,o}function fi(t,e){return e.y-t.y||e.x-t.x}function pi(t,e,n){return(t.x-n.x)*(e.y-t.y)-(t.x-e.x)*(n.y-t.y)}function _i(t){return t.x}function gi(t){return t.y}function vi(){return{leaf:!0,nodes:[],point:null,x:null,y:null}}function mi(t,e,n,i,r,a){if(!t(e,n,i,r,a)){var o=.5*(n+r),s=.5*(i+a),l=e.nodes;l[0]&&mi(t,l[0],n,i,o,s),l[1]&&mi(t,l[1],o,i,r,s),l[2]&&mi(t,l[2],n,s,o,a),l[3]&&mi(t,l[3],o,s,r,a)}}function yi(t,e,n,i,r,a,o){var s,l=1/0;return function t(u,c,h,d,f){if(!(c>a||h>o||d<i||f<r)){if(p=u.point){var p,_=e-u.x,g=n-u.y,v=_*_+g*g;if(v<l){var m=Math.sqrt(l=v);i=e-m,r=n-m,a=e+m,o=n+m,s=p}}for(var y=u.nodes,b=.5*(c+d),w=.5*(h+f),x=e>=b,k=n>=w,C=k<<1|x,M=C+4;C<M;++C)if(u=y[3&C])switch(3&C){case 0:t(u,c,h,b,w);break;case 1:t(u,b,h,d,w);break;case 2:t(u,c,w,b,f);break;case 3:t(u,b,w,d,f)}}}(t,i,r,a,o),s}function bi(t,e){t=fo.rgb(t),e=fo.rgb(e);var n=t.r,i=t.g,r=t.b,a=e.r-n,o=e.g-i,s=e.b-r;return function(t){return"#"+Mt(Math.round(n+a*t))+Mt(Math.round(i+o*t))+Mt(Math.round(r+s*t))}}function wi(t,e){var n,i={},r={};for(n in t)n in e?i[n]=Ci(t[n],e[n]):r[n]=t[n];for(n in e)n in t||(r[n]=e[n]);return function(t){for(n in i)r[n]=i[n](t);return r}}function xi(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function ki(t,e){var n,i,r,a=fl.lastIndex=pl.lastIndex=0,o=-1,s=[],l=[];for(t+="",e+="";(n=fl.exec(t))&&(i=pl.exec(e));)(r=i.index)>a&&(r=e.slice(a,r),s[o]?s[o]+=r:s[++o]=r),(n=n[0])===(i=i[0])?s[o]?s[o]+=i:s[++o]=i:(s[++o]=null,l.push({i:o,x:xi(n,i)})),a=pl.lastIndex;return a<e.length&&(r=e.slice(a),s[o]?s[o]+=r:s[++o]=r),s.length<2?l[0]?(e=l[0].x,function(t){return e(t)+""}):function(){return e}:(e=l.length,function(t){for(var n,i=0;i<e;++i)s[(n=l[i]).i]=n.x(t);return s.join("")})}function Ci(t,e){for(var n,i=fo.interpolators.length;--i>=0&&!(n=fo.interpolators[i](t,e)););return n}function Mi(t,e){var n,i=[],r=[],a=t.length,o=e.length,s=Math.min(t.length,e.length);for(n=0;n<s;++n)i.push(Ci(t[n],e[n]));for(;n<a;++n)r[n]=t[n];for(;n<o;++n)r[n]=e[n];return function(t){for(n=0;n<s;++n)r[n]=i[n](t);return r}}function Si(t){return function(e){return e<=0?0:e>=1?1:t(e)}}function Ti(t){return function(e){return 1-t(1-e)}}function $i(t){return function(e){return.5*(e<.5?t(2*e):2-t(2-2*e))}}function Ai(t){return t*t}function Ei(t){return t*t*t}function Oi(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function zi(t){return function(e){return Math.pow(e,t)}}function Ri(t){return 1-Math.cos(t*Go)}function Ni(t){return Math.pow(2,10*(t-1))}function Pi(t){return 1-Math.sqrt(1-t*t)}function qi(t,e){var n;return arguments.length<2&&(e=.45),arguments.length?n=e/Uo*Math.asin(1/t):(t=1,n=e/4),function(i){return 1+t*Math.pow(2,-10*i)*Math.sin((i-n)*Uo/e)}}function ji(t){return t||(t=1.70158),function(e){return e*e*((t+1)*e-t)}}function Di(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function Li(t,e){t=fo.hcl(t),e=fo.hcl(e);var n=t.h,i=t.c,r=t.l,a=e.h-n,o=e.c-i,s=e.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?e.c:i),isNaN(a)?(a=0,n=isNaN(n)?e.h:n):a>180?a-=360:a<-180&&(a+=360),function(t){return _t(n+a*t,i+o*t,r+s*t)+""}}function Ii(t,e){t=fo.hsl(t),e=fo.hsl(e);var n=t.h,i=t.s,r=t.l,a=e.h-n,o=e.s-i,s=e.l-r;return isNaN(o)&&(o=0,i=isNaN(i)?e.s:i),isNaN(a)?(a=0,n=isNaN(n)?e.h:n):a>180?a-=360:a<-180&&(a+=360),function(t){return ft(n+a*t,i+o*t,r+s*t)+""}}function Bi(t,e){t=fo.lab(t),e=fo.lab(e);var n=t.l,i=t.a,r=t.b,a=e.l-n,o=e.a-i,s=e.b-r;return function(t){return vt(n+a*t,i+o*t,r+s*t)+""}}function Vi(t,e){return e-=t,function(n){return Math.round(t+e*n)}}function Ui(t){var e=[t.a,t.b],n=[t.c,t.d],i=Gi(e),r=Fi(e,n),a=Gi(Hi(n,e,-r))||0;e[0]*n[1]<n[0]*e[1]&&(e[0]*=-1,e[1]*=-1,i*=-1,r*=-1),this.rotate=(i?Math.atan2(e[1],e[0]):Math.atan2(-n[0],n[1]))*Yo,this.translate=[t.e,t.f],this.scale=[i,a],this.skew=a?Math.atan2(r,a)*Yo:0}function Fi(t,e){return t[0]*e[0]+t[1]*e[1]}function Gi(t){var e=Math.sqrt(Fi(t,t));return e&&(t[0]/=e,t[1]/=e),e}function Hi(t,e,n){return t[0]+=n*e[0],t[1]+=n*e[1],t}function Yi(t){return t.length?t.pop()+",":""}function Xi(t,e,n,i){if(t[0]!==e[0]||t[1]!==e[1]){var r=n.push("translate(",null,",",null,")");i.push({i:r-4,x:xi(t[0],e[0])},{i:r-2,x:xi(t[1],e[1])})}else(e[0]||e[1])&&n.push("translate("+e+")")}function Wi(t,e,n,i){t!==e?(t-e>180?e+=360:e-t>180&&(t+=360),i.push({i:n.push(Yi(n)+"rotate(",null,")")-2,x:xi(t,e)})):e&&n.push(Yi(n)+"rotate("+e+")")}function Ji(t,e,n,i){t!==e?i.push({i:n.push(Yi(n)+"skewX(",null,")")-2,x:xi(t,e)}):e&&n.push(Yi(n)+"skewX("+e+")")}function Ki(t,e,n,i){if(t[0]!==e[0]||t[1]!==e[1]){var r=n.push(Yi(n)+"scale(",null,",",null,")");i.push({i:r-4,x:xi(t[0],e[0])},{i:r-2,x:xi(t[1],e[1])})}else 1===e[0]&&1===e[1]||n.push(Yi(n)+"scale("+e+")")}function Zi(t,e){var n=[],i=[];return t=fo.transform(t),e=fo.transform(e),Xi(t.translate,e.translate,n,i),Wi(t.rotate,e.rotate,n,i),Ji(t.skew,e.skew,n,i),Ki(t.scale,e.scale,n,i),t=e=null,function(t){for(var e,r=-1,a=i.length;++r<a;)n[(e=i[r]).i]=e.x(t);return n.join("")}}function Qi(t,e){return e=(e-=t=+t)||1/e,function(n){return(n-t)/e}}function tr(t,e){return e=(e-=t=+t)||1/e,function(n){return Math.max(0,Math.min(1,(n-t)/e))}}function er(t){for(var e=t.source,n=t.target,i=ir(e,n),r=[e];e!==i;)e=e.parent,r.push(e);for(var a=r.length;n!==i;)r.splice(a,0,n),n=n.parent;return r}function nr(t){for(var e=[],n=t.parent;null!=n;)e.push(t),t=n,n=n.parent;return e.push(t),e}function ir(t,e){if(t===e)return t;for(var n=nr(t),i=nr(e),r=n.pop(),a=i.pop(),o=null;r===a;)o=r,r=n.pop(),a=i.pop();return o}function rr(t){t.fixed|=2}function ar(t){t.fixed&=-7}function or(t){t.fixed|=4,t.px=t.x,t.py=t.y}function sr(t){t.fixed&=-5}function lr(t,e,n){var i=0,r=0;if(t.charge=0,!t.leaf)for(var a,o=t.nodes,s=o.length,l=-1;++l<s;)null!=(a=o[l])&&(lr(a,e,n),t.charge+=a.charge,i+=a.charge*a.cx,r+=a.charge*a.cy);if(t.point){t.leaf||(t.point.x+=Math.random()-.5,t.point.y+=Math.random()-.5);var u=e*n[t.point.index];t.charge+=t.pointCharge=u,i+=u*t.point.x,r+=u*t.point.y}t.cx=i/t.charge,t.cy=r/t.charge}function ur(t,e){return fo.rebind(t,e,"sort","children","value"),t.nodes=t,t.links=_r,t}function cr(t,e){for(var n=[t];null!=(t=n.pop());)if(e(t),(r=t.children)&&(i=r.length))for(var i,r;--i>=0;)n.push(r[i])}function hr(t,e){for(var n=[t],i=[];null!=(t=n.pop());)if(i.push(t),(a=t.children)&&(r=a.length))for(var r,a,o=-1;++o<r;)n.push(a[o]);for(;null!=(t=i.pop());)e(t)}function dr(t){return t.children}function fr(t){return t.value}function pr(t,e){return e.value-t.value}function _r(t){return fo.merge(t.map(function(t){return(t.children||[]).map(function(e){return{source:t,target:e}})}))}function gr(t){return t.x}function vr(t){return t.y}function mr(t,e,n){t.y0=e,t.y=n}function yr(t){return fo.range(t.length)}function br(t){for(var e=-1,n=t[0].length,i=[];++e<n;)i[e]=0;return i}function wr(t){for(var e,n=1,i=0,r=t[0][1],a=t.length;n<a;++n)(e=t[n][1])>r&&(i=n,r=e);return i}function xr(t){return t.reduce(kr,0)}function kr(t,e){return t+e[1]}function Cr(t,e){return Mr(t,Math.ceil(Math.log(e.length)/Math.LN2+1))}function Mr(t,e){for(var n=-1,i=+t[0],r=(t[1]-i)/e,a=[];++n<=e;)a[n]=r*n+i;return a}function Sr(t){return[fo.min(t),fo.max(t)]}function Tr(t,e){return t.value-e.value}function $r(t,e){var n=t._pack_next;t._pack_next=e,e._pack_prev=t,e._pack_next=n,n._pack_prev=e}function Ar(t,e){t._pack_next=e,e._pack_prev=t}function Er(t,e){var n=e.x-t.x,i=e.y-t.y,r=t.r+e.r;return.999*r*r>n*n+i*i}function Or(t){function e(t){c=Math.min(t.x-t.r,c),h=Math.max(t.x+t.r,h),d=Math.min(t.y-t.r,d),f=Math.max(t.y+t.r,f)}if((n=t.children)&&(u=n.length)){var n,i,r,a,o,s,l,u,c=1/0,h=-1/0,d=1/0,f=-1/0;if(n.forEach(zr),i=n[0],i.x=-i.r,i.y=0,e(i),u>1&&(r=n[1],r.x=r.r,r.y=0,e(r),u>2))for(a=n[2],Pr(i,r,a),e(a),$r(i,a),i._pack_prev=a,$r(a,r),r=i._pack_next,o=3;o<u;o++){Pr(i,r,a=n[o]);var p=0,_=1,g=1;for(s=r._pack_next;s!==r;s=s._pack_next,_++)if(Er(s,a)){p=1;break}if(1==p)for(l=i._pack_prev;l!==s._pack_prev&&!Er(l,a);l=l._pack_prev,g++);p?(_<g||_==g&&r.r<i.r?Ar(i,r=s):Ar(i=l,r),o--):($r(i,a),r=a,e(a))}var v=(c+h)/2,m=(d+f)/2,y=0;for(o=0;o<u;o++)a=n[o],a.x-=v,a.y-=m,y=Math.max(y,a.r+Math.sqrt(a.x*a.x+a.y*a.y));t.r=y,n.forEach(Rr)}}function zr(t){t._pack_next=t._pack_prev=t}function Rr(t){delete t._pack_next,delete t._pack_prev}function Nr(t,e,n,i){var r=t.children;if(t.x=e+=i*t.x,t.y=n+=i*t.y,t.r*=i,r)for(var a=-1,o=r.length;++a<o;)Nr(r[a],e,n,i)}function Pr(t,e,n){var i=t.r+n.r,r=e.x-t.x,a=e.y-t.y;if(i&&(r||a)){var o=e.r+n.r,s=r*r+a*a;o*=o,i*=i;var l=.5+(i-o)/(2*s),u=Math.sqrt(Math.max(0,2*o*(i+s)-(i-=s)*i-o*o))/(2*s);n.x=t.x+l*r+u*a,n.y=t.y+l*a-u*r}else n.x=t.x+i,n.y=t.y}function qr(t,e){return t.parent==e.parent?1:2}function jr(t){var e=t.children;return e.length?e[0]:t.t}function Dr(t){var e,n=t.children;return(e=n.length)?n[e-1]:t.t}function Lr(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function Ir(t){for(var e,n=0,i=0,r=t.children,a=r.length;--a>=0;)e=r[a],e.z+=n,e.m+=n,n+=e.s+(i+=e.c)}function Br(t,e,n){return t.a.parent===e.parent?t.a:n}function Vr(t){return 1+fo.max(t,function(t){return t.y})}function Ur(t){return t.reduce(function(t,e){return t+e.x},0)/t.length}function Fr(t){var e=t.children;return e&&e.length?Fr(e[0]):t}function Gr(t){var e,n=t.children;return n&&(e=n.length)?Gr(n[e-1]):t}function Hr(t){return{x:t.x,y:t.y,dx:t.dx,dy:t.dy}}function Yr(t,e){var n=t.x+e[3],i=t.y+e[0],r=t.dx-e[1]-e[3],a=t.dy-e[0]-e[2];return r<0&&(n+=r/2,r=0),a<0&&(i+=a/2,a=0),{x:n,y:i,dx:r,dy:a}}function Xr(t){var e=t[0],n=t[t.length-1];return e<n?[e,n]:[n,e]}function Wr(t){return t.rangeExtent?t.rangeExtent():Xr(t.range())}function Jr(t,e,n,i){var r=n(t[0],t[1]),a=i(e[0],e[1]);return function(t){return a(r(t))}}function Kr(t,e){var n,i=0,r=t.length-1,a=t[i],o=t[r];return o<a&&(n=i,i=r,r=n,n=a,a=o,o=n),t[i]=e.floor(a),t[r]=e.ceil(o),t}function Zr(t){return t?{floor:function(e){return Math.floor(e/t)*t},ceil:function(e){return Math.ceil(e/t)*t}}:Ml}function Qr(t,e,n,i){var r=[],a=[],o=0,s=Math.min(t.length,e.length)-1;for(t[s]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++o<=s;)r.push(n(t[o-1],t[o])),a.push(i(e[o-1],e[o]));return function(e){var n=fo.bisect(t,e,1,s)-1;return a[n](r[n](e))}}function ta(t,e,n,i){function r(){var r=Math.min(t.length,e.length)>2?Qr:Jr,l=i?tr:Qi;return o=r(t,e,l,n),s=r(e,t,l,Ci),a}function a(t){return o(t)}var o,s;return a.invert=function(t){return s(t)},a.domain=function(e){return arguments.length?(t=e.map(Number),r()):t},a.range=function(t){return arguments.length?(e=t,r()):e},a.rangeRound=function(t){return a.range(t).interpolate(Vi)},a.clamp=function(t){return arguments.length?(i=t,r()):i},a.interpolate=function(t){return arguments.length?(n=t,r()):n},a.ticks=function(e){return ra(t,e)},a.tickFormat=function(e,n){return aa(t,e,n)},a.nice=function(e){return na(t,e),r()},a.copy=function(){return ta(t,e,n,i)},r()}function ea(t,e){return fo.rebind(t,e,"range","rangeRound","interpolate","clamp")}function na(t,e){return Kr(t,Zr(ia(t,e)[2])),Kr(t,Zr(ia(t,e)[2])),t}function ia(t,e){null==e&&(e=10);var n=Xr(t),i=n[1]-n[0],r=Math.pow(10,Math.floor(Math.log(i/e)/Math.LN10)),a=e/i*r;return a<=.15?r*=10:a<=.35?r*=5:a<=.75&&(r*=2),n[0]=Math.ceil(n[0]/r)*r,n[1]=Math.floor(n[1]/r)*r+.5*r,n[2]=r,n}function ra(t,e){return fo.range.apply(fo,ia(t,e))}function aa(t,e,n){var i=ia(t,e);if(n){var r=fs.exec(n);if(r.shift(),"s"===r[8]){var a=fo.formatPrefix(Math.max(ko(i[0]),ko(i[1])));return r[7]||(r[7]="."+oa(a.scale(i[2]))),r[8]="f",n=fo.format(r.join("")),function(t){return n(a.scale(t))+a.symbol}}r[7]||(r[7]="."+sa(r[8],i)),n=r.join("")}else n=",."+oa(i[2])+"f";return fo.format(n)}function oa(t){return-Math.floor(Math.log(t)/Math.LN10+.01)}function sa(t,e){var n=oa(e[2]);return t in Sl?Math.abs(n-oa(Math.max(ko(e[0]),ko(e[1]))))+ +("e"!==t):n-2*("%"===t)}function la(t,e,n,i){function r(t){return(n?Math.log(t<0?0:t):-Math.log(t>0?0:-t))/Math.log(e)}function a(t){return n?Math.pow(e,t):-Math.pow(e,-t)}function o(e){return t(r(e))}return o.invert=function(e){return a(t.invert(e))},o.domain=function(e){return arguments.length?(n=e[0]>=0,t.domain((i=e.map(Number)).map(r)),o):i},o.base=function(n){return arguments.length?(e=+n,t.domain(i.map(r)),o):e},o.nice=function(){var e=Kr(i.map(r),n?Math:$l);return t.domain(e),i=e.map(a),o},o.ticks=function(){var t=Xr(i),o=[],s=t[0],l=t[1],u=Math.floor(r(s)),c=Math.ceil(r(l)),h=e%1?2:e;if(isFinite(c-u)){if(n){for(;u<c;u++)for(var d=1;d<h;d++)o.push(a(u)*d);o.push(a(u))}else for(o.push(a(u));u++<c;)for(var d=h-1;d>0;d--)o.push(a(u)*d);for(u=0;o[u]<s;u++);for(c=o.length;o[c-1]>l;c--);o=o.slice(u,c)}return o},o.tickFormat=function(t,n){if(!arguments.length)return Tl;arguments.length<2?n=Tl:"function"!=typeof n&&(n=fo.format(n));var i=Math.max(1,e*t/o.ticks().length);return function(t){var o=t/a(Math.round(r(t)));return o*e<e-.5&&(o*=e),o<=i?n(t):""}},o.copy=function(){return la(t.copy(),e,n,i)},ea(o,t)}function ua(t,e,n){function i(e){return t(r(e))}var r=ca(e),a=ca(1/e);return i.invert=function(e){return a(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain((n=e.map(Number)).map(r)),i):n},i.ticks=function(t){return ra(n,t)},i.tickFormat=function(t,e){return aa(n,t,e)},i.nice=function(t){return i.domain(na(n,t))},i.exponent=function(o){return arguments.length?(r=ca(e=o),a=ca(1/e),t.domain(n.map(r)),i):e},i.copy=function(){return ua(t.copy(),e,n)},ea(i,t)}function ca(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function ha(t,e){function n(n){return a[((r.get(n)||("range"===e.t?r.set(n,t.push(n)):NaN))-1)%a.length]}function i(e,n){return fo.range(t.length).map(function(t){return e+n*t})}var r,a,o;return n.domain=function(i){if(!arguments.length)return t;t=[],r=new p;for(var a,o=-1,s=i.length;++o<s;)r.has(a=i[o])||r.set(a,t.push(a));return n[e.t].apply(n,e.a)},n.range=function(t){return arguments.length?(a=t,o=0,e={t:"range",a:arguments},n):a},n.rangePoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],u=r[1],c=t.length<2?(l=(l+u)/2,0):(u-l)/(t.length-1+s);return a=i(l+c*s/2,c),o=0,e={t:"rangePoints",a:arguments},n},n.rangeRoundPoints=function(r,s){arguments.length<2&&(s=0);var l=r[0],u=r[1],c=t.length<2?(l=u=Math.round((l+u)/2),0):(u-l)/(t.length-1+s)|0;return a=i(l+Math.round(c*s/2+(u-l-(t.length-1+s)*c)/2),c),o=0,e={t:"rangeRoundPoints",a:arguments},n},n.rangeBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var u=r[1]<r[0],c=r[u-0],h=r[1-u],d=(h-c)/(t.length-s+2*l);return a=i(c+d*l,d),u&&a.reverse(),o=d*(1-s),e={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(r,s,l){arguments.length<2&&(s=0),arguments.length<3&&(l=s);var u=r[1]<r[0],c=r[u-0],h=r[1-u],d=Math.floor((h-c)/(t.length-s+2*l));return a=i(c+Math.round((h-c-(t.length-s)*d)/2),d),u&&a.reverse(),o=Math.round(d*(1-s)),e={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return o},n.rangeExtent=function(){return Xr(e.a[0])},n.copy=function(){return ha(t,e)},n.domain(t)}function da(t,e){function n(){var n=0,a=e.length;for(r=[];++n<a;)r[n-1]=fo.quantile(t,n/a);return i}function i(t){if(!isNaN(t=+t))return e[fo.bisect(r,t)]}var r;return i.domain=function(e){return arguments.length?(t=e.map(l).filter(u).sort(s),n()):t},i.range=function(t){return arguments.length?(e=t,n()):e},i.quantiles=function(){return r},i.invertExtent=function(n){return n=e.indexOf(n),n<0?[NaN,NaN]:[n>0?r[n-1]:t[0],n<r.length?r[n]:t[t.length-1]]},i.copy=function(){return da(t,e)},n()}function fa(t,e,n){function i(e){return n[Math.max(0,Math.min(o,Math.floor(a*(e-t))))]}function r(){return a=n.length/(e-t),o=n.length-1,i}var a,o;return i.domain=function(n){return arguments.length?(t=+n[0],e=+n[n.length-1],r()):[t,e]},i.range=function(t){return arguments.length?(n=t,r()):n},i.invertExtent=function(e){return e=n.indexOf(e),e=e<0?NaN:e/a+t,[e,e+1/a]},i.copy=function(){return fa(t,e,n)},r()}function pa(t,e){function n(n){if(n<=n)return e[fo.bisect(t,n)]}return n.domain=function(e){return arguments.length?(t=e,n):t},n.range=function(t){return arguments.length?(e=t,n):e},n.invertExtent=function(n){return n=e.indexOf(n),[t[n-1],t[n]]},n.copy=function(){return pa(t,e)},n}function _a(t){function e(t){return+t}return e.invert=e,e.domain=e.range=function(n){return arguments.length?(t=n.map(e),e):t},e.ticks=function(e){return ra(t,e)},e.tickFormat=function(e,n){return aa(t,e,n)},e.copy=function(){return _a(t)},e}function ga(){return 0}function va(t){return t.innerRadius}function ma(t){return t.outerRadius}function ya(t){return t.startAngle}function ba(t){return t.endAngle}function wa(t){return t&&t.padAngle}function xa(t,e,n,i){return(t-n)*e-(e-i)*t>0?0:1}function ka(t,e,n,i,r){var a=t[0]-e[0],o=t[1]-e[1],s=(r?i:-i)/Math.sqrt(a*a+o*o),l=s*o,u=-s*a,c=t[0]+l,h=t[1]+u,d=e[0]+l,f=e[1]+u,p=(c+d)/2,_=(h+f)/2,g=d-c,v=f-h,m=g*g+v*v,y=n-i,b=c*f-d*h,w=(v<0?-1:1)*Math.sqrt(Math.max(0,y*y*m-b*b)),x=(b*v-g*w)/m,k=(-b*g-v*w)/m,C=(b*v+g*w)/m,M=(-b*g+v*w)/m,S=x-p,T=k-_,$=C-p,A=M-_;return S*S+T*T>$*$+A*A&&(x=C,k=M),[[x-l,k-u],[x*n/y,k*n/y]]}function Ca(t){function e(e){function o(){u.push("M",a(t(c),s))}for(var l,u=[],c=[],h=-1,d=e.length,f=Ot(n),p=Ot(i);++h<d;)r.call(this,l=e[h],h)?c.push([+f.call(this,l,h),+p.call(this,l,h)]):c.length&&(o(),c=[]);return c.length&&o(),u.length?u.join(""):null}var n=Nn,i=Pn,r=Ne,a=Ma,o=a.key,s=.7;return e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e.defined=function(t){return arguments.length?(r=t,e):r},e.interpolate=function(t){return arguments.length?(o="function"==typeof t?a=t:(a=Nl.get(t)||Ma).key,e):o},e.tension=function(t){return arguments.length?(s=t,e):s},e}function Ma(t){return t.length>1?t.join("L"):t+"Z"}function Sa(t){return t.join("L")+"Z"}function Ta(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("H",(i[0]+(i=t[e])[0])/2,"V",i[1]);return n>1&&r.push("H",i[0]),r.join("")}function $a(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("V",(i=t[e])[1],"H",i[0]);return r.join("")}function Aa(t){for(var e=0,n=t.length,i=t[0],r=[i[0],",",i[1]];++e<n;)r.push("H",(i=t[e])[0],"V",i[1]);return r.join("")}function Ea(t,e){return t.length<4?Ma(t):t[1]+Ra(t.slice(1,-1),Na(t,e))}function Oa(t,e){return t.length<3?Sa(t):t[0]+Ra((t.push(t[0]),t),Na([t[t.length-2]].concat(t,[t[1]]),e))}function za(t,e){return t.length<3?Ma(t):t[0]+Ra(t,Na(t,e))}function Ra(t,e){if(e.length<1||t.length!=e.length&&t.length!=e.length+2)return Ma(t);var n=t.length!=e.length,i="",r=t[0],a=t[1],o=e[0],s=o,l=1;if(n&&(i+="Q"+(a[0]-2*o[0]/3)+","+(a[1]-2*o[1]/3)+","+a[0]+","+a[1],r=t[1],l=2),e.length>1){s=e[1],a=t[l],l++,i+="C"+(r[0]+o[0])+","+(r[1]+o[1])+","+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1];for(var u=2;u<e.length;u++,l++)a=t[l],s=e[u],i+="S"+(a[0]-s[0])+","+(a[1]-s[1])+","+a[0]+","+a[1]}if(n){var c=t[l];i+="Q"+(a[0]+2*s[0]/3)+","+(a[1]+2*s[1]/3)+","+c[0]+","+c[1]}return i}function Na(t,e){for(var n,i=[],r=(1-e)/2,a=t[0],o=t[1],s=1,l=t.length;++s<l;)n=a,a=o,o=t[s],i.push([r*(o[0]-n[0]),r*(o[1]-n[1])]);return i}function Pa(t){if(t.length<3)return Ma(t);var e=1,n=t.length,i=t[0],r=i[0],a=i[1],o=[r,r,r,(i=t[1])[0]],s=[a,a,a,i[1]],l=[r,",",a,"L",La(jl,o),",",La(jl,s)];for(t.push(t[n-1]);++e<=n;)i=t[e],o.shift(),o.push(i[0]),s.shift(),s.push(i[1]),Ia(l,o,s);return t.pop(),l.push("L",i),l.join("")}function qa(t){if(t.length<4)return Ma(t);for(var e,n=[],i=-1,r=t.length,a=[0],o=[0];++i<3;)e=t[i],a.push(e[0]),o.push(e[1]);for(n.push(La(jl,a)+","+La(jl,o)),--i;++i<r;)e=t[i],a.shift(),a.push(e[0]),o.shift(),o.push(e[1]),Ia(n,a,o);return n.join("")}function ja(t){for(var e,n,i=-1,r=t.length,a=r+4,o=[],s=[];++i<4;)n=t[i%r],o.push(n[0]),s.push(n[1]);for(e=[La(jl,o),",",La(jl,s)],--i;++i<a;)n=t[i%r],o.shift(),o.push(n[0]),s.shift(),s.push(n[1]),Ia(e,o,s);return e.join("")}function Da(t,e){var n=t.length-1;if(n)for(var i,r,a=t[0][0],o=t[0][1],s=t[n][0]-a,l=t[n][1]-o,u=-1;++u<=n;)i=t[u],r=u/n,i[0]=e*i[0]+(1-e)*(a+r*s),i[1]=e*i[1]+(1-e)*(o+r*l);return Pa(t)}function La(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Ia(t,e,n){t.push("C",La(Pl,e),",",La(Pl,n),",",La(ql,e),",",La(ql,n),",",La(jl,e),",",La(jl,n))}function Ba(t,e){return(e[1]-t[1])/(e[0]-t[0])}function Va(t){for(var e=0,n=t.length-1,i=[],r=t[0],a=t[1],o=i[0]=Ba(r,a);++e<n;)i[e]=(o+(o=Ba(r=a,a=t[e+1])))/2;return i[e]=o,i}function Ua(t){for(var e,n,i,r,a=[],o=Va(t),s=-1,l=t.length-1;++s<l;)e=Ba(t[s],t[s+1]),ko(e)<Io?o[s]=o[s+1]=0:(n=o[s]/e,i=o[s+1]/e,(r=n*n+i*i)>9&&(r=3*e/Math.sqrt(r),o[s]=r*n,o[s+1]=r*i));for(s=-1;++s<=l;)r=(t[Math.min(l,s+1)][0]-t[Math.max(0,s-1)][0])/(6*(1+o[s]*o[s])),a.push([r||0,o[s]*r||0]);return a}function Fa(t){return t.length<3?Ma(t):t[0]+Ra(t,Ua(t))}function Ga(t){for(var e,n,i,r=-1,a=t.length;++r<a;)e=t[r],n=e[0],i=e[1]-Go,e[0]=n*Math.cos(i),e[1]=n*Math.sin(i);return t}function Ha(t){function e(e){function l(){_.push("M",s(t(v),h),c,u(t(g.reverse()),h),"Z")}for(var d,f,p,_=[],g=[],v=[],m=-1,y=e.length,b=Ot(n),w=Ot(r),x=n===i?function(){return f}:Ot(i),k=r===a?function(){return p}:Ot(a);++m<y;)o.call(this,d=e[m],m)?(g.push([f=+b.call(this,d,m),p=+w.call(this,d,m)]),v.push([+x.call(this,d,m),+k.call(this,d,m)])):g.length&&(l(),g=[],v=[]);return g.length&&l(),_.length?_.join(""):null}var n=Nn,i=Nn,r=0,a=Pn,o=Ne,s=Ma,l=s.key,u=s,c="L",h=.7;return e.x=function(t){return arguments.length?(n=i=t,e):i},e.x0=function(t){return arguments.length?(n=t,e):n},e.x1=function(t){return arguments.length?(i=t,e):i},e.y=function(t){return arguments.length?(r=a=t,e):a},e.y0=function(t){return arguments.length?(r=t,e):r},e.y1=function(t){return arguments.length?(a=t,e):a},e.defined=function(t){return arguments.length?(o=t,e):o},e.interpolate=function(t){return arguments.length?(l="function"==typeof t?s=t:(s=Nl.get(t)||Ma).key,u=s.reverse||s,c=s.closed?"M":"L",e):l},e.tension=function(t){return arguments.length?(h=t,e):h},e}function Ya(t){return t.radius}function Xa(t){return[t.x,t.y]}function Wa(t){return function(){var e=t.apply(this,arguments),n=e[0],i=e[1]-Go;return[n*Math.cos(i),n*Math.sin(i)]}}function Ja(){return 64}function Ka(){return"circle"}function Za(t){var e=Math.sqrt(t/Vo);return"M0,"+e+"A"+e+","+e+" 0 1,1 0,"+-e+"A"+e+","+e+" 0 1,1 0,"+e+"Z"}function Qa(t){return function(){var e,n,i;(e=this[t])&&(i=e[n=e.active])&&(i.timer.c=null,i.timer.t=NaN,--e.count?delete e[n]:delete this[t],e.active+=.5,i.event&&i.event.interrupt.call(this,this.__data__,i.index))}}function to(t,e,n){return $o(t,Fl),t.namespace=e,t.id=n,t}function eo(t,e,n,i){var r=t.id,a=t.namespace;return X(t,"function"==typeof n?function(t,o,s){t[a][r].tween.set(e,i(n.call(t,t.__data__,o,s)))}:(n=i(n),function(t){t[a][r].tween.set(e,n)}))}function no(t){return null==t&&(t=""),function(){this.textContent=t}}function io(t){return null==t?"__transition__":"__transition_"+t+"__"}function ro(t,e,n,i,r){function a(t){var e=_.delay;if(u.t=e+l,e<=t)return o(t-e);u.c=o}function o(n){var r=f.active,a=f[r];a&&(a.timer.c=null,a.timer.t=NaN,--f.count,delete f[r],a.event&&a.event.interrupt.call(t,t.__data__,a.index));for(var o in f)if(+o<i){var p=f[o];p.timer.c=null,p.timer.t=NaN,--f.count,delete f[o]}u.c=s,qt(function(){return u.c&&s(n||1)&&(u.c=null,u.t=NaN),1},0,l),f.active=i,_.event&&_.event.start.call(t,t.__data__,e),d=[],_.tween.forEach(function(n,i){(i=i.call(t,t.__data__,e))&&d.push(i)}),h=_.ease,c=_.duration}function s(r){for(var a=r/c,o=h(a),s=d.length;s>0;)d[--s].call(t,o);if(a>=1)return _.event&&_.event.end.call(t,t.__data__,e),--f.count?delete f[i]:delete t[n],1}var l,u,c,h,d,f=t[n]||(t[n]={active:0,count:0}),_=f[i];_||(l=r.time,u=qt(a,0,l),_=f[i]={tween:new p,time:l,timer:u,delay:r.delay,duration:r.duration,ease:r.ease,index:e},r=null,++f.count)}function ao(t,e,n){t.attr("transform",function(t){var i=e(t);return"translate("+(isFinite(i)?i:n(t))+",0)"})}function oo(t,e,n){t.attr("transform",function(t){var i=e(t);return"translate(0,"+(isFinite(i)?i:n(t))+")"})}function so(t){return t.toISOString()}function lo(t,e,n){function i(e){return t(e)}function r(t,n){var i=t[1]-t[0],r=i/n,a=fo.bisect(Ql,r);return a==Ql.length?[e.year,ia(t.map(function(t){return t/31536e6}),n)[2]]:a?e[r/Ql[a-1]<Ql[a]/r?a-1:a]:[nu,ia(t,n)[2]]}return i.invert=function(e){return uo(t.invert(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain().map(uo)},i.nice=function(t,e){function n(n){return!isNaN(n)&&!t.range(n,uo(+n+1),e).length}var a=i.domain(),o=Xr(a),s=null==t?r(o,10):"number"==typeof t&&r(o,t);return s&&(t=s[0],e=s[1]),i.domain(Kr(a,e>1?{floor:function(e){for(;n(e=t.floor(e));)e=uo(e-1);return e},ceil:function(e){for(;n(e=t.ceil(e));)e=uo(+e+1);return e}}:t))},i.ticks=function(t,e){var n=Xr(i.domain()),a=null==t?r(n,10):"number"==typeof t?r(n,t):!t.range&&[{range:t},e];return a&&(t=a[0],e=a[1]),t.range(n[0],uo(+n[1]+1),e<1?1:e)},i.tickFormat=function(){return n},i.copy=function(){return lo(t.copy(),e,n)},ea(i,t)}function uo(t){return new Date(t)}function co(t){return JSON.parse(t.responseText)}function ho(t){var e=go.createRange();return e.selectNode(go.body),e.createContextualFragment(t.responseText)}var fo={version:"3.5.17"},po=[].slice,_o=function(t){return po.call(t)},go=this.document;if(go)try{_o(go.documentElement.childNodes)[0].nodeType}catch(t){_o=function(t){for(var e=t.length,n=new Array(e);e--;)n[e]=t[e];return n}}if(Date.now||(Date.now=function(){return+new Date}),go)try{go.createElement("DIV").style.setProperty("opacity",0,"")}catch(t){var vo=this.Element.prototype,mo=vo.setAttribute,yo=vo.setAttributeNS,bo=this.CSSStyleDeclaration.prototype,wo=bo.setProperty;vo.setAttribute=function(t,e){mo.call(this,t,e+"")},vo.setAttributeNS=function(t,e,n){yo.call(this,t,e,n+"")},bo.setProperty=function(t,e,n){wo.call(this,t,e+"",n)}}fo.ascending=s,fo.descending=function(t,e){return e<t?-1:e>t?1:e>=t?0:NaN},fo.min=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=t[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=t[r])&&n>i&&(n=i)}else{for(;++r<a;)if(null!=(i=e.call(t,t[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=e.call(t,t[r],r))&&n>i&&(n=i)}return n},fo.max=function(t,e){var n,i,r=-1,a=t.length;if(1===arguments.length){for(;++r<a;)if(null!=(i=t[r])&&i>=i){n=i;break}for(;++r<a;)null!=(i=t[r])&&i>n&&(n=i)}else{for(;++r<a;)if(null!=(i=e.call(t,t[r],r))&&i>=i){n=i;break}for(;++r<a;)null!=(i=e.call(t,t[r],r))&&i>n&&(n=i)}return n},fo.extent=function(t,e){var n,i,r,a=-1,o=t.length;if(1===arguments.length){for(;++a<o;)if(null!=(i=t[a])&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=t[a])&&(n>i&&(n=i),r<i&&(r=i))}else{for(;++a<o;)if(null!=(i=e.call(t,t[a],a))&&i>=i){n=r=i;break}for(;++a<o;)null!=(i=e.call(t,t[a],a))&&(n>i&&(n=i),r<i&&(r=i))}return[n,r]},fo.sum=function(t,e){var n,i=0,r=t.length,a=-1;if(1===arguments.length)for(;++a<r;)u(n=+t[a])&&(i+=n);else for(;++a<r;)u(n=+e.call(t,t[a],a))&&(i+=n);return i},fo.mean=function(t,e){var n,i=0,r=t.length,a=-1,o=r;if(1===arguments.length)for(;++a<r;)u(n=l(t[a]))?i+=n:--o;else for(;++a<r;)u(n=l(e.call(t,t[a],a)))?i+=n:--o;if(o)return i/o},fo.quantile=function(t,e){var n=(t.length-1)*e+1,i=Math.floor(n),r=+t[i-1],a=n-i;return a?r+a*(t[i]-r):r},fo.median=function(t,e){var n,i=[],r=t.length,a=-1;if(1===arguments.length)for(;++a<r;)u(n=l(t[a]))&&i.push(n);else for(;++a<r;)u(n=l(e.call(t,t[a],a)))&&i.push(n);if(i.length)return fo.quantile(i.sort(s),.5)},fo.variance=function(t,e){var n,i,r=t.length,a=0,o=0,s=-1,c=0;if(1===arguments.length)for(;++s<r;)u(n=l(t[s]))&&(i=n-a,a+=i/++c,o+=i*(n-a));else for(;++s<r;)u(n=l(e.call(t,t[s],s)))&&(i=n-a,a+=i/++c,o+=i*(n-a));if(c>1)return o/(c-1)},fo.deviation=function(){var t=fo.variance.apply(this,arguments);return t?Math.sqrt(t):t};var xo=c(s);fo.bisectLeft=xo.left,fo.bisect=fo.bisectRight=xo.right,fo.bisector=function(t){return c(1===t.length?function(e,n){return s(t(e),n)}:t)},fo.shuffle=function(t,e,n){(a=arguments.length)<3&&(n=t.length,a<2&&(e=0));for(var i,r,a=n-e;a;)r=Math.random()*a--|0,i=t[a+e],t[a+e]=t[r+e],t[r+e]=i;return t},fo.permute=function(t,e){for(var n=e.length,i=new Array(n);n--;)i[n]=t[e[n]];return i},fo.pairs=function(t){for(var e=0,n=t.length-1,i=t[0],r=new Array(n<0?0:n);e<n;)r[e]=[i,i=t[++e]];return r},fo.transpose=function(t){if(!(r=t.length))return[];for(var e=-1,n=fo.min(t,h),i=new Array(n);++e<n;)for(var r,a=-1,o=i[e]=new Array(r);++a<r;)o[a]=t[a][e];return i},fo.zip=function(){return fo.transpose(arguments)},fo.keys=function(t){var e=[];for(var n in t)e.push(n);return e},fo.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},fo.entries=function(t){var e=[];for(var n in t)e.push({key:n,value:t[n]});return e},fo.merge=function(t){for(var e,n,i,r=t.length,a=-1,o=0;++a<r;)o+=t[a].length;for(n=new Array(o);--r>=0;)for(i=t[r],e=i.length;--e>=0;)n[--o]=i[e];return n};var ko=Math.abs;fo.range=function(t,e,n){if(arguments.length<3&&(n=1,arguments.length<2&&(e=t,t=0)),(e-t)/n==1/0)throw new Error("infinite range");var i,r=[],a=d(ko(n)),o=-1;if(t*=a,e*=a,n*=a,n<0)for(;(i=t+n*++o)>e;)r.push(i/a);else for(;(i=t+n*++o)<e;)r.push(i/a);return r},fo.map=function(t,e){var n=new p;if(t instanceof p)t.forEach(function(t,e){n.set(t,e)});else if(Array.isArray(t)){var i,r=-1,a=t.length;if(1===arguments.length)for(;++r<a;)n.set(r,t[r]);else for(;++r<a;)n.set(e.call(t,i=t[r],r),i)}else for(var o in t)n.set(o,t[o]);return n};var Co="__proto__",Mo="\0";f(p,{has:v,get:function(t){return this._[_(t)]},set:function(t,e){return this._[_(t)]=e},remove:m,keys:y,values:function(){var t=[];for(var e in this._)t.push(this._[e]);return t},entries:function(){var t=[];for(var e in this._)t.push({key:g(e),value:this._[e]});return t},size:b,empty:w,forEach:function(t){for(var e in this._)t.call(this,g(e),this._[e])}}),fo.nest=function(){function t(e,o,s){if(s>=a.length)return i?i.call(r,o):n?o.sort(n):o;for(var l,u,c,h,d=-1,f=o.length,_=a[s++],g=new p;++d<f;)(h=g.get(l=_(u=o[d])))?h.push(u):g.set(l,[u]);return e?(u=e(),c=function(n,i){u.set(n,t(e,i,s))}):(u={},c=function(n,i){u[n]=t(e,i,s)}),g.forEach(c),u}function e(t,n){if(n>=a.length)return t;var i=[],r=o[n++];return t.forEach(function(t,r){i.push({key:t,values:e(r,n)})}),r?i.sort(function(t,e){return r(t.key,e.key)}):i}var n,i,r={},a=[],o=[];return r.map=function(e,n){return t(n,e,0)},r.entries=function(n){return e(t(fo.map,n,0),0)},r.key=function(t){return a.push(t),r},r.sortKeys=function(t){return o[a.length-1]=t,r},r.sortValues=function(t){return n=t,r},r.rollup=function(t){return i=t,r},r},fo.set=function(t){var e=new x;if(t)for(var n=0,i=t.length;n<i;++n)e.add(t[n]);return e},f(x,{has:v,add:function(t){return this._[_(t+="")]=!0,t},remove:m,values:y,size:b,empty:w,forEach:function(t){for(var e in this._)t.call(this,g(e))}}),fo.behavior={},fo.rebind=function(t,e){for(var n,i=1,r=arguments.length;++i<r;)t[n=arguments[i]]=C(t,e,e[n]);return t};var So=["webkit","ms","moz","Moz","o","O"];fo.dispatch=function(){for(var t=new T,e=-1,n=arguments.length;++e<n;)t[arguments[e]]=$(t);return t},T.prototype.on=function(t,e){var n=t.indexOf("."),i="";if(n>=0&&(i=t.slice(n+1),t=t.slice(0,n)),t)return arguments.length<2?this[t].on(i):this[t].on(i,e);if(2===arguments.length){if(null==e)for(t in this)this.hasOwnProperty(t)&&this[t].on(i,null);return this}},fo.event=null,fo.requote=function(t){return t.replace(To,"\\$&")};var To=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,$o={}.__proto__?function(t,e){t.__proto__=e}:function(t,e){for(var n in e)t[n]=e[n]},Ao=function(t,e){return e.querySelector(t)},Eo=function(t,e){return e.querySelectorAll(t)},Oo=function(t,e){var n=t.matches||t[M(t,"matchesSelector")];return(Oo=function(t,e){return n.call(t,e)})(t,e)};"function"==typeof Sizzle&&(Ao=function(t,e){return Sizzle(t,e)[0]||null},Eo=Sizzle,Oo=Sizzle.matchesSelector),fo.selection=function(){return fo.select(go.documentElement)};var zo=fo.selection.prototype=[];zo.select=function(t){var e,n,i,r,a=[];t=R(t);for(var o=-1,s=this.length;++o<s;){a.push(e=[]),e.parentNode=(i=this[o]).parentNode;for(var l=-1,u=i.length;++l<u;)(r=i[l])?(e.push(n=t.call(r,r.__data__,l,o)),n&&"__data__"in r&&(n.__data__=r.__data__)):e.push(null)}return z(a)},zo.selectAll=function(t){var e,n,i=[];t=N(t);for(var r=-1,a=this.length;++r<a;)for(var o=this[r],s=-1,l=o.length;++s<l;)(n=o[s])&&(i.push(e=_o(t.call(n,n.__data__,s,r))),e.parentNode=n);return z(i)};var Ro="http://www.w3.org/1999/xhtml",No={svg:"http://www.w3.org/2000/svg",xhtml:Ro,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};fo.ns={prefix:No,qualify:function(t){var e=t.indexOf(":"),n=t;return e>=0&&"xmlns"!==(n=t.slice(0,e))&&(t=t.slice(e+1)),No.hasOwnProperty(n)?{space:No[n],local:t}:t}},zo.attr=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node();return t=fo.ns.qualify(t),t.local?n.getAttributeNS(t.space,t.local):n.getAttribute(t)}for(e in t)this.each(P(e,t[e]));return this}return this.each(P(t,e))},zo.classed=function(t,e){if(arguments.length<2){if("string"==typeof t){var n=this.node(),i=(t=D(t)).length,r=-1;if(e=n.classList){for(;++r<i;)if(!e.contains(t[r]))return!1}else for(e=n.getAttribute("class");++r<i;)if(!j(t[r]).test(e))return!1;return!0}for(e in t)this.each(L(e,t[e]));return this}return this.each(L(t,e))},zo.style=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e="");for(n in t)this.each(B(n,t[n],e));return this}if(i<2){var r=this.node();return o(r).getComputedStyle(r,null).getPropertyValue(t)}n=""}return this.each(B(t,e,n))},zo.property=function(t,e){if(arguments.length<2){if("string"==typeof t)return this.node()[t];for(e in t)this.each(V(e,t[e]));return this}return this.each(V(t,e))},zo.text=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.textContent=null==e?"":e}:null==t?function(){this.textContent=""}:function(){this.textContent=t}):this.node().textContent},zo.html=function(t){return arguments.length?this.each("function"==typeof t?function(){var e=t.apply(this,arguments);this.innerHTML=null==e?"":e}:null==t?function(){this.innerHTML=""}:function(){this.innerHTML=t}):this.node().innerHTML},zo.append=function(t){return t=U(t),this.select(function(){return this.appendChild(t.apply(this,arguments))})},zo.insert=function(t,e){return t=U(t),e=R(e),this.select(function(){return this.insertBefore(t.apply(this,arguments),e.apply(this,arguments)||null)})},zo.remove=function(){return this.each(F)},zo.data=function(t,e){function n(t,n){var i,r,a,o=t.length,c=n.length,h=Math.min(o,c),d=new Array(c),f=new Array(c),_=new Array(o);if(e){var g,v=new p,m=new Array(o);for(i=-1;++i<o;)(r=t[i])&&(v.has(g=e.call(r,r.__data__,i))?_[i]=r:v.set(g,r),m[i]=g);for(i=-1;++i<c;)(r=v.get(g=e.call(n,a=n[i],i)))?!0!==r&&(d[i]=r,r.__data__=a):f[i]=G(a),v.set(g,!0);for(i=-1;++i<o;)i in m&&!0!==v.get(m[i])&&(_[i]=t[i])}else{for(i=-1;++i<h;)r=t[i],a=n[i],r?(r.__data__=a,d[i]=r):f[i]=G(a);for(;i<c;++i)f[i]=G(n[i]);for(;i<o;++i)_[i]=t[i]}f.update=d,f.parentNode=d.parentNode=_.parentNode=t.parentNode,s.push(f),l.push(d),u.push(_)}var i,r,a=-1,o=this.length;if(!arguments.length){for(t=new Array(o=(i=this[0]).length);++a<o;)(r=i[a])&&(t[a]=r.__data__);return t}var s=W([]),l=z([]),u=z([]);if("function"==typeof t)for(;++a<o;)n(i=this[a],t.call(i,i.parentNode.__data__,a));else for(;++a<o;)n(i=this[a],t);return l.enter=function(){return s},l.exit=function(){return u},l},zo.datum=function(t){return arguments.length?this.property("__data__",t):this.property("__data__")},zo.filter=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=H(t));for(var a=0,o=this.length;a<o;a++){r.push(e=[]),e.parentNode=(n=this[a]).parentNode;for(var s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,a)&&e.push(i)}return z(r)},zo.order=function(){for(var t=-1,e=this.length;++t<e;)for(var n,i=this[t],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&a!==n.nextSibling&&a.parentNode.insertBefore(n,a),a=n);return this},zo.sort=function(t){t=Y.apply(this,arguments);for(var e=-1,n=this.length;++e<n;)this[e].sort(t);return this.order()},zo.each=function(t){return X(this,function(e,n,i){t.call(e,e.__data__,n,i)})},zo.call=function(t){var e=_o(arguments);return t.apply(e[0]=this,e),this},zo.empty=function(){return!this.node()},zo.node=function(){for(var t=0,e=this.length;t<e;t++)for(var n=this[t],i=0,r=n.length;i<r;i++){var a=n[i];if(a)return a}return null},zo.size=function(){var t=0;return X(this,function(){++t}),t};var Po=[];fo.selection.enter=W,fo.selection.enter.prototype=Po,Po.append=zo.append,Po.empty=zo.empty,Po.node=zo.node,Po.call=zo.call,Po.size=zo.size,Po.select=function(t){for(var e,n,i,r,a,o=[],s=-1,l=this.length;++s<l;){i=(r=this[s]).update,o.push(e=[]),e.parentNode=r.parentNode;for(var u=-1,c=r.length;++u<c;)(a=r[u])?(e.push(i[u]=n=t.call(r.parentNode,a.__data__,u,s)),n.__data__=a.__data__):e.push(null)}return z(o)},Po.insert=function(t,e){return arguments.length<2&&(e=J(this)),zo.insert.call(this,t,e)},fo.select=function(t){var e;return"string"==typeof t?(e=[Ao(t,go)],e.parentNode=go.documentElement):(e=[t],e.parentNode=a(t)),z([e])},fo.selectAll=function(t){var e;return"string"==typeof t?(e=_o(Eo(t,go)),e.parentNode=go.documentElement):(e=_o(t),e.parentNode=null),z([e])},zo.on=function(t,e,n){var i=arguments.length;if(i<3){if("string"!=typeof t){i<2&&(e=!1);for(n in t)this.each(K(n,t[n],e));return this}if(i<2)return(i=this.node()["__on"+t])&&i._;n=!1}return this.each(K(t,e,n))};var qo=fo.map({mouseenter:"mouseover",mouseleave:"mouseout"});go&&qo.forEach(function(t){"on"+t in go&&qo.remove(t)});var jo,Do=0;fo.mouse=function(t){return et(t,E())};var Lo=this.navigator&&/WebKit/.test(this.navigator.userAgent)?-1:0;fo.touch=function(t,e,n){if(arguments.length<3&&(n=e,e=E().changedTouches),e)for(var i,r=0,a=e.length;r<a;++r)if((i=e[r]).identifier===n)return et(t,i)},fo.behavior.drag=function(){function t(){this.on("mousedown.drag",r).on("touchstart.drag",a)}function e(t,e,r,a,o){return function(){function s(){var t,n,i=e(d,_);i&&(t=i[0]-y[0],n=i[1]-y[1],p|=t|n,y=i,f({type:"drag",x:i[0]+u[0],y:i[1]+u[1],dx:t,dy:n}))}function l(){e(d,_)&&(v.on(a+g,null).on(o+g,null),m(p),f({type:"dragend"}))}var u,c=this,h=fo.event.target.correspondingElement||fo.event.target,d=c.parentNode,f=n.of(c,arguments),p=0,_=t(),g=".drag"+(null==_?"":"-"+_),v=fo.select(r(h)).on(a+g,s).on(o+g,l),m=tt(h),y=e(d,_);i?(u=i.apply(c,arguments),u=[u.x-y[0],u.y-y[1]]):u=[0,0],f({type:"dragstart"})}}var n=O(t,"drag","dragstart","dragend"),i=null,r=e(S,fo.mouse,o,"mousemove","mouseup"),a=e(nt,fo.touch,k,"touchmove","touchend");return t.origin=function(e){return arguments.length?(i=e,t):i},fo.rebind(t,n,"on")},fo.touches=function(t,e){return arguments.length<2&&(e=E().touches),e?_o(e).map(function(e){var n=et(t,e);return n.identifier=e.identifier,n}):[]};var Io=1e-6,Bo=Io*Io,Vo=Math.PI,Uo=2*Vo,Fo=Uo-Io,Go=Vo/2,Ho=Vo/180,Yo=180/Vo,Xo=Math.SQRT2;fo.interpolateZoom=function(t,e){var n,i,r=t[0],a=t[1],o=t[2],s=e[0],l=e[1],u=e[2],c=s-r,h=l-a,d=c*c+h*h;if(d<Bo)i=Math.log(u/o)/Xo,n=function(t){return[r+t*c,a+t*h,o*Math.exp(Xo*t*i)]};else{var f=Math.sqrt(d),p=(u*u-o*o+4*d)/(2*o*2*f),_=(u*u-o*o-4*d)/(2*u*2*f),g=Math.log(Math.sqrt(p*p+1)-p),v=Math.log(Math.sqrt(_*_+1)-_);i=(v-g)/Xo,n=function(t){var e=t*i,n=lt(g),s=o/(2*f)*(n*ut(Xo*e+g)-st(g));return[r+s*c,a+s*h,o*n/lt(Xo*e+g)]}}return n.duration=1e3*i,n},fo.behavior.zoom=function(){function t(t){t.on(E,h).on(Jo+".zoom",f).on("dblclick.zoom",p).on(N,d)}function e(t){return[(t[0]-C.x)/C.k,(t[1]-C.y)/C.k]}function n(t){return[t[0]*C.k+C.x,t[1]*C.k+C.y]}function i(t){C.k=Math.max(S[0],Math.min(S[1],t))}function r(t,e){e=n(e),C.x+=t[0]-e[0],C.y+=t[1]-e[1]}function a(e,n,a,o){e.__chart__={x:C.x,y:C.y,k:C.k},i(Math.pow(2,o)),r(g=n,a),e=fo.select(e),T>0&&(e=e.transition().duration(T)),e.call(t.event)}function s(){w&&w.domain(b.range().map(function(t){return(t-C.x)/C.k}).map(b.invert)),k&&k.domain(x.range().map(function(t){return(t-C.y)/C.k}).map(x.invert))}function l(t){$++||t({type:"zoomstart"})}function u(t){s(),t({type:"zoom",scale:C.k,translate:[C.x,C.y]})}function c(t){--$||(t({type:"zoomend"}),g=null)}function h(){function t(){s=1,r(fo.mouse(i),d),u(a)}function n(){h.on(z,null).on(R,null),f(s),c(a)}var i=this,a=P.of(i,arguments),s=0,h=fo.select(o(i)).on(z,t).on(R,n),d=e(fo.mouse(i)),f=tt(i);Ul.call(i),l(a)}function d(){function t(){var t=fo.touches(p);return f=C.k,t.forEach(function(t){t.identifier in g&&(g[t.identifier]=e(t))}),t}function n(){var e=fo.event.target;fo.select(e).on(b,o).on(w,s),x.push(e);for(var n=fo.event.changedTouches,i=0,r=n.length;i<r;++i)g[n[i].identifier]=null;var l=t(),u=Date.now();if(1===l.length){if(u-y<500){var c=l[0];a(p,c,g[c.identifier],Math.floor(Math.log(C.k)/Math.LN2)+1),A()}y=u}else if(l.length>1){var c=l[0],h=l[1],d=c[0]-h[0],f=c[1]-h[1];v=d*d+f*f}}function o(){var t,e,n,a,o=fo.touches(p);Ul.call(p);for(var s=0,l=o.length;s<l;++s,a=null)if(n=o[s],a=g[n.identifier]){if(e)break;t=n,e=a}if(a){var c=(c=n[0]-t[0])*c+(c=n[1]-t[1])*c,h=v&&Math.sqrt(c/v);t=[(t[0]+n[0])/2,(t[1]+n[1])/2],e=[(e[0]+a[0])/2,(e[1]+a[1])/2],i(h*f)}y=null,r(t,e),u(_)}function s(){if(fo.event.touches.length){for(var e=fo.event.changedTouches,n=0,i=e.length;n<i;++n)delete g[e[n].identifier];for(var r in g)return void t()}fo.selectAll(x).on(m,null),k.on(E,h).on(N,d),M(),c(_)}var f,p=this,_=P.of(p,arguments),g={},v=0,m=".zoom-"+fo.event.changedTouches[0].identifier,b="touchmove"+m,w="touchend"+m,x=[],k=fo.select(p),M=tt(p);n(),l(_),k.on(E,null).on(N,n)}function f(){var t=P.of(this,arguments);m?clearTimeout(m):(Ul.call(this),_=e(g=v||fo.mouse(this)),l(t)),m=setTimeout(function(){m=null,c(t)},50),A(),i(Math.pow(2,.002*Wo())*C.k),r(g,_),u(t)}function p(){var t=fo.mouse(this),n=Math.log(C.k)/Math.LN2;a(this,t,e(t),fo.event.shiftKey?Math.ceil(n)-1:Math.floor(n)+1)}var _,g,v,m,y,b,w,x,k,C={x:0,y:0,k:1},M=[960,500],S=Ko,T=250,$=0,E="mousedown.zoom",z="mousemove.zoom",R="mouseup.zoom",N="touchstart.zoom",P=O(t,"zoomstart","zoom","zoomend");return Jo||(Jo="onwheel"in go?(Wo=function(){return-fo.event.deltaY*(fo.event.deltaMode?120:1)},"wheel"):"onmousewheel"in go?(Wo=function(){return fo.event.wheelDelta},"mousewheel"):(Wo=function(){return-fo.event.detail},"MozMousePixelScroll")),t.event=function(t){t.each(function(){var t=P.of(this,arguments),e=C;Bl?fo.select(this).transition().each("start.zoom",function(){C=this.__chart__||{x:0,y:0,k:1},l(t)}).tween("zoom:zoom",function(){var n=M[0],i=M[1],r=g?g[0]:n/2,a=g?g[1]:i/2,o=fo.interpolateZoom([(r-C.x)/C.k,(a-C.y)/C.k,n/C.k],[(r-e.x)/e.k,(a-e.y)/e.k,n/e.k]);return function(e){var i=o(e),s=n/i[2];this.__chart__=C={x:r-i[0]*s,y:a-i[1]*s,k:s},u(t)}}).each("interrupt.zoom",function(){c(t)}).each("end.zoom",function(){c(t)}):(this.__chart__=C,l(t),u(t),c(t))})},t.translate=function(e){return arguments.length?(C={x:+e[0],y:+e[1],k:C.k},s(),t):[C.x,C.y]},t.scale=function(e){return arguments.length?(C={x:C.x,y:C.y,k:null},i(+e),s(),t):C.k},t.scaleExtent=function(e){return arguments.length?(S=null==e?Ko:[+e[0],+e[1]],t):S},t.center=function(e){return arguments.length?(v=e&&[+e[0],+e[1]],t):v},t.size=function(e){return arguments.length?(M=e&&[+e[0],+e[1]],t):M},t.duration=function(e){return arguments.length?(T=+e,t):T},t.x=function(e){return arguments.length?(w=e,b=e.copy(),C={x:0,y:0,k:1},t):w},t.y=function(e){return arguments.length?(k=e,x=e.copy(),C={x:0,y:0,k:1},t):k},fo.rebind(t,P,"on")};var Wo,Jo,Ko=[0,1/0];fo.color=ht,ht.prototype.toString=function(){return this.rgb()+""},fo.hsl=dt;var Zo=dt.prototype=new ht;Zo.brighter=function(t){return t=Math.pow(.7,arguments.length?t:1),new dt(this.h,this.s,this.l/t)},Zo.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new dt(this.h,this.s,t*this.l)},Zo.rgb=function(){return ft(this.h,this.s,this.l)},fo.hcl=pt;var Qo=pt.prototype=new ht;Qo.brighter=function(t){return new pt(this.h,this.c,Math.min(100,this.l+ts*(arguments.length?t:1)))},Qo.darker=function(t){return new pt(this.h,this.c,Math.max(0,this.l-ts*(arguments.length?t:1)))},Qo.rgb=function(){return _t(this.h,this.c,this.l).rgb()},fo.lab=gt;var ts=18,es=.95047,ns=1,is=1.08883,rs=gt.prototype=new ht;rs.brighter=function(t){return new gt(Math.min(100,this.l+ts*(arguments.length?t:1)),this.a,this.b)},rs.darker=function(t){return new gt(Math.max(0,this.l-ts*(arguments.length?t:1)),this.a,this.b)},rs.rgb=function(){return vt(this.l,this.a,this.b)},fo.rgb=xt;var as=xt.prototype=new ht;as.brighter=function(t){t=Math.pow(.7,arguments.length?t:1);var e=this.r,n=this.g,i=this.b,r=30;return e||n||i?(e&&e<r&&(e=r),n&&n<r&&(n=r),i&&i<r&&(i=r),new xt(Math.min(255,e/t),Math.min(255,n/t),Math.min(255,i/t))):new xt(r,r,r)},as.darker=function(t){return t=Math.pow(.7,arguments.length?t:1),new xt(t*this.r,t*this.g,t*this.b)},as.hsl=function(){return Tt(this.r,this.g,this.b)},as.toString=function(){return"#"+Mt(this.r)+Mt(this.g)+Mt(this.b)};var os=fo.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});os.forEach(function(t,e){os.set(t,kt(e))}),fo.functor=Ot,fo.xhr=zt(k),fo.dsv=function(t,e){function n(t,n,a){arguments.length<3&&(a=n,n=null);var o=Rt(t,e,null==n?i:r(n),a);return o.row=function(t){return arguments.length?o.response(null==(n=t)?i:r(t)):n},o}function i(t){return n.parse(t.responseText)}function r(t){return function(e){return n.parse(e.responseText,t)}}function a(e){return e.map(o).join(t)}function o(t){return s.test(t)?'"'+t.replace(/\"/g,'""')+'"':t}var s=new RegExp('["'+t+"\n]"),l=t.charCodeAt(0);return n.parse=function(t,e){var i;return n.parseRows(t,function(t,n){if(i)return i(t,n-1);var r=new Function("d","return {"+t.map(function(t,e){return JSON.stringify(t)+": d["+e+"]"}).join(",")+"}");i=e?function(t,n){return e(r(t),n)}:r})},n.parseRows=function(t,e){function n(){if(c>=u)return o;if(r)return r=!1,a;var e=c;if(34===t.charCodeAt(e)){for(var n=e;n++<u;)if(34===t.charCodeAt(n)){if(34!==t.charCodeAt(n+1))break;++n}c=n+2;var i=t.charCodeAt(n+1);return 13===i?(r=!0,10===t.charCodeAt(n+2)&&++c):10===i&&(r=!0),t.slice(e+1,n).replace(/""/g,'"')}for(;c<u;){var i=t.charCodeAt(c++),s=1;if(10===i)r=!0;else if(13===i)r=!0,10===t.charCodeAt(c)&&(++c,++s);else if(i!==l)continue;return t.slice(e,c-s)}return t.slice(e)}for(var i,r,a={},o={},s=[],u=t.length,c=0,h=0;(i=n())!==o;){for(var d=[];i!==a&&i!==o;)d.push(i),i=n();e&&null==(d=e(d,h++))||s.push(d)}return s},n.format=function(e){if(Array.isArray(e[0]))return n.formatRows(e);var i=new x,r=[];return e.forEach(function(t){for(var e in t)i.has(e)||r.push(i.add(e))}),[r.map(o).join(t)].concat(e.map(function(e){return r.map(function(t){return o(e[t])}).join(t)})).join("\n")},n.formatRows=function(t){return t.map(a).join("\n")},n},fo.csv=fo.dsv(",","text/csv"),fo.tsv=fo.dsv("\t","text/tab-separated-values");var ss,ls,us,cs,hs=this[M(this,"requestAnimationFrame")]||function(t){setTimeout(t,17)};fo.timer=function(){qt.apply(this,arguments)},fo.timer.flush=function(){Dt(),Lt()},fo.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)};var ds=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(Bt);fo.formatPrefix=function(t,e){var n=0;return(t=+t)&&(t<0&&(t*=-1),e&&(t=fo.round(t,It(t,e))),n=1+Math.floor(1e-12+Math.log(t)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),ds[8+n/3]};var fs=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,ps=fo.map({b:function(t){return t.toString(2)},c:function(t){return String.fromCharCode(t)},o:function(t){return t.toString(8)},x:function(t){return t.toString(16)},X:function(t){return t.toString(16).toUpperCase()},g:function(t,e){return t.toPrecision(e)},e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},r:function(t,e){return(t=fo.round(t,It(t,e))).toFixed(Math.max(0,Math.min(20,It(t*(1+1e-15),e))))}}),_s=fo.time={},gs=Date;Ft.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){vs.setUTCDate.apply(this._,arguments)},setDay:function(){vs.setUTCDay.apply(this._,arguments)},setFullYear:function(){vs.setUTCFullYear.apply(this._,arguments)},setHours:function(){vs.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){vs.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){vs.setUTCMinutes.apply(this._,arguments)},setMonth:function(){vs.setUTCMonth.apply(this._,arguments)},setSeconds:function(){vs.setUTCSeconds.apply(this._,arguments)},setTime:function(){vs.setTime.apply(this._,arguments)}};var vs=Date.prototype;_s.year=Gt(function(t){return t=_s.day(t),t.setMonth(0,1),t},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t){return t.getFullYear()}),_s.years=_s.year.range,_s.years.utc=_s.year.utc.range,_s.day=Gt(function(t){var e=new gs(2e3,0);return e.setFullYear(t.getFullYear(),t.getMonth(),t.getDate()),e},function(t,e){t.setDate(t.getDate()+e)},function(t){return t.getDate()-1}),_s.days=_s.day.range,_s.days.utc=_s.day.utc.range,_s.dayOfYear=function(t){var e=_s.year(t);return Math.floor((t-e-6e4*(t.getTimezoneOffset()-e.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(t,e){e=7-e;var n=_s[t]=Gt(function(t){return(t=_s.day(t)).setDate(t.getDate()-(t.getDay()+e)%7),t},function(t,e){t.setDate(t.getDate()+7*Math.floor(e))},function(t){var n=_s.year(t).getDay();return Math.floor((_s.dayOfYear(t)+(n+e)%7)/7)-(n!==e)});_s[t+"s"]=n.range,_s[t+"s"].utc=n.utc.range,_s[t+"OfYear"]=function(t){var n=_s.year(t).getDay();return Math.floor((_s.dayOfYear(t)+(n+e)%7)/7)}}),_s.week=_s.sunday,_s.weeks=_s.sunday.range,_s.weeks.utc=_s.sunday.utc.range,_s.weekOfYear=_s.sundayOfYear;var ms={"-":"",_:" ",0:"0"},ys=/^\s*\d+/,bs=/^%/;fo.locale=function(t){return{numberFormat:Vt(t),timeFormat:Yt(t)}};var ws=fo.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});fo.format=ws.numberFormat,fo.geo={},pe.prototype={s:0,t:0,add:function(t){_e(t,this.t,xs),_e(xs.s,this.s,this),this.s?this.t+=xs.t:this.s=xs.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var xs=new pe;fo.geo.stream=function(t,e){t&&ks.hasOwnProperty(t.type)?ks[t.type](t,e):ge(t,e)};var ks={Feature:function(t,e){ge(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)ge(n[i].geometry,e)}},Cs={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)t=n[i],e.point(t[0],t[1],t[2])},LineString:function(t,e){ve(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)ve(n[i],e,0)},Polygon:function(t,e){me(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)me(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)ge(n[i],e)}};fo.geo.area=function(t){return Ms=0,fo.geo.stream(t,Ts),Ms};var Ms,Ss=new pe,Ts={sphere:function(){Ms+=4*Vo},point:S,lineStart:S,lineEnd:S,polygonStart:function(){Ss.reset(),Ts.lineStart=ye},polygonEnd:function(){var t=2*Ss;Ms+=t<0?4*Vo+t:t,Ts.lineStart=Ts.lineEnd=Ts.point=S}};fo.geo.bounds=function(){function t(t,e){y.push(b=[c=t,d=t]),e<h&&(h=e),e>f&&(f=e)}function e(e,n){var i=be([e*Ho,n*Ho]);if(v){var r=xe(v,i),a=[r[1],-r[0],0],o=xe(a,r);Me(o),o=Se(o);var l=e-p,u=l>0?1:-1,_=o[0]*Yo*u,g=ko(l)>180;if(g^(u*p<_&&_<u*e)){var m=o[1]*Yo;m>f&&(f=m)}else if(_=(_+360)%360-180,g^(u*p<_&&_<u*e)){var m=-o[1]*Yo;m<h&&(h=m)}else n<h&&(h=n),n>f&&(f=n);g?e<p?s(c,e)>s(c,d)&&(d=e):s(e,d)>s(c,d)&&(c=e):d>=c?(e<c&&(c=e),e>d&&(d=e)):e>p?s(c,e)>s(c,d)&&(d=e):s(e,d)>s(c,d)&&(c=e)}else t(e,n);v=i,p=e}function n(){w.point=e}function i(){b[0]=c,b[1]=d,w.point=t,v=null}function r(t,n){if(v){var i=t-p;m+=ko(i)>180?i+(i>0?360:-360):i}else _=t,g=n;Ts.point(t,n),e(t,n)}function a(){Ts.lineStart()}function o(){r(_,g),Ts.lineEnd(),ko(m)>Io&&(c=-(d=180)),b[0]=c,b[1]=d,v=null}function s(t,e){return(e-=t)<0?e+360:e}function l(t,e){return t[0]-e[0]}function u(t,e){return e[0]<=e[1]?e[0]<=t&&t<=e[1]:t<e[0]||e[1]<t}var c,h,d,f,p,_,g,v,m,y,b,w={point:t,lineStart:n,lineEnd:i,polygonStart:function(){w.point=r,w.lineStart=a,w.lineEnd=o,m=0,Ts.polygonStart()},polygonEnd:function(){Ts.polygonEnd(),w.point=t,w.lineStart=n,w.lineEnd=i,Ss<0?(c=-(d=180),h=-(f=90)):m>Io?f=90:m<-Io&&(h=-90),b[0]=c,b[1]=d}};return function(t){f=d=-(c=h=1/0),y=[],fo.geo.stream(t,w);var e=y.length;if(e){y.sort(l);for(var n,i=1,r=y[0],a=[r];i<e;++i)n=y[i],u(n[0],r)||u(n[1],r)?(s(r[0],n[1])>s(r[0],r[1])&&(r[1]=n[1]),s(n[0],r[1])>s(r[0],r[1])&&(r[0]=n[0])):a.push(r=n);for(var o,n,p=-1/0,e=a.length-1,i=0,r=a[e];i<=e;r=n,++i)n=a[i],(o=s(r[1],n[0]))>p&&(p=o,c=n[0],d=r[1])}return y=b=null,c===1/0||h===1/0?[[NaN,NaN],[NaN,NaN]]:[[c,h],[d,f]]}}(),fo.geo.centroid=function(t){$s=As=Es=Os=zs=Rs=Ns=Ps=qs=js=Ds=0,fo.geo.stream(t,Ls);var e=qs,n=js,i=Ds,r=e*e+n*n+i*i;return r<Bo&&(e=Rs,n=Ns,i=Ps,As<Io&&(e=Es,n=Os,i=zs),(r=e*e+n*n+i*i)<Bo)?[NaN,NaN]:[Math.atan2(n,e)*Yo,ot(i/Math.sqrt(r))*Yo]};var $s,As,Es,Os,zs,Rs,Ns,Ps,qs,js,Ds,Ls={sphere:S,point:$e,lineStart:Ee,lineEnd:Oe,polygonStart:function(){Ls.lineStart=ze},polygonEnd:function(){Ls.lineStart=Ee}},Is=De(Ne,Ve,Fe,[-Vo,-Vo/2]),Bs=1e9;fo.geo.clipExtent=function(){var t,e,n,i,r,a,o={stream:function(t){return r&&(r.valid=!1),r=a(t),r.valid=!0,r},extent:function(s){return arguments.length?(a=Xe(t=+s[0][0],e=+s[0][1],n=+s[1][0],i=+s[1][1]),r&&(r.valid=!1,r=null),o):[[t,e],[n,i]]}};return o.extent([[0,0],[960,500]])},(fo.geo.conicEqualArea=function(){return We(Je)}).raw=Je,fo.geo.albers=function(){return fo.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},fo.geo.albersUsa=function(){function t(t){var a=t[0],o=t[1];return e=null,n(a,o),e||(i(a,o),e)||r(a,o),e}var e,n,i,r,a=fo.geo.albers(),o=fo.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),s=fo.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(t,n){e=[t,n]}};return t.invert=function(t){var e=a.scale(),n=a.translate(),i=(t[0]-n[0])/e,r=(t[1]-n[1])/e;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?o:r>=.166&&r<.234&&i>=-.214&&i<-.115?s:a).invert(t)},t.stream=function(t){var e=a.stream(t),n=o.stream(t),i=s.stream(t);return{point:function(t,r){e.point(t,r),n.point(t,r),i.point(t,r)},sphere:function(){e.sphere(),n.sphere(),i.sphere()},lineStart:function(){e.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){e.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){e.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){e.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},t.precision=function(e){return arguments.length?(a.precision(e),o.precision(e),s.precision(e),t):a.precision()},t.scale=function(e){return arguments.length?(a.scale(e),o.scale(.35*e),s.scale(e),t.translate(a.translate())):a.scale()},t.translate=function(e){if(!arguments.length)return a.translate();var u=a.scale(),c=+e[0],h=+e[1];return n=a.translate(e).clipExtent([[c-.455*u,h-.238*u],[c+.455*u,h+.238*u]]).stream(l).point,i=o.translate([c-.307*u,h+.201*u]).clipExtent([[c-.425*u+Io,h+.12*u+Io],[c-.214*u-Io,h+.234*u-Io]]).stream(l).point,r=s.translate([c-.205*u,h+.212*u]).clipExtent([[c-.214*u+Io,h+.166*u+Io],[c-.115*u-Io,h+.234*u-Io]]).stream(l).point,t},t.scale(1070)};var Vs,Us,Fs,Gs,Hs,Ys,Xs={point:S,lineStart:S,lineEnd:S,polygonStart:function(){Us=0,Xs.lineStart=Ke},polygonEnd:function(){Xs.lineStart=Xs.lineEnd=Xs.point=S,Vs+=ko(Us/2)}},Ws={point:Ze,lineStart:S,lineEnd:S,polygonStart:S,polygonEnd:S},Js={point:en,lineStart:nn,lineEnd:rn,polygonStart:function(){Js.lineStart=an},polygonEnd:function(){Js.point=en,Js.lineStart=nn,Js.lineEnd=rn}};fo.geo.path=function(){function t(t){return t&&("function"==typeof s&&a.pointRadius(+s.apply(this,arguments)),o&&o.valid||(o=r(a)),fo.geo.stream(t,o)),a.result()}function e(){return o=null,t}var n,i,r,a,o,s=4.5;return t.area=function(t){return Vs=0,fo.geo.stream(t,r(Xs)),Vs},t.centroid=function(t){return Es=Os=zs=Rs=Ns=Ps=qs=js=Ds=0,fo.geo.stream(t,r(Js)),Ds?[qs/Ds,js/Ds]:Ps?[Rs/Ps,Ns/Ps]:zs?[Es/zs,Os/zs]:[NaN,NaN]},t.bounds=function(t){return Hs=Ys=-(Fs=Gs=1/0),fo.geo.stream(t,r(Ws)),[[Fs,Gs],[Hs,Ys]]},t.projection=function(t){return arguments.length?(r=(n=t)?t.stream||ln(t):k,e()):n},t.context=function(t){return arguments.length?(a=null==(i=t)?new Qe:new on(t),"function"!=typeof s&&a.pointRadius(s),e()):i},t.pointRadius=function(e){return arguments.length?(s="function"==typeof e?e:(a.pointRadius(+e),+e),t):s},t.projection(fo.geo.albersUsa()).context(null)},fo.geo.transform=function(t){return{stream:function(e){var n=new un(e);for(var i in t)n[i]=t[i];return n}}},un.prototype={point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},fo.geo.projection=hn,fo.geo.projectionMutator=dn,(fo.geo.equirectangular=function(){return hn(pn)}).raw=pn.invert=pn,fo.geo.rotation=function(t){function e(e){return e=t(e[0]*Ho,e[1]*Ho),e[0]*=Yo,e[1]*=Yo,e}return t=gn(t[0]%360*Ho,t[1]*Ho,t.length>2?t[2]*Ho:0),e.invert=function(e){return e=t.invert(e[0]*Ho,e[1]*Ho),e[0]*=Yo,e[1]*=Yo,e},e},_n.invert=pn,fo.geo.circle=function(){function t(){var t="function"==typeof i?i.apply(this,arguments):i,e=gn(-t[0]*Ho,-t[1]*Ho,0).invert,r=[];return n(null,null,1,{point:function(t,n){r.push(t=e(t,n)),t[0]*=Yo,t[1]*=Yo}}),{type:"Polygon",coordinates:[r]}}var e,n,i=[0,0],r=6;return t.origin=function(e){return arguments.length?(i=e,t):i},t.angle=function(i){return arguments.length?(n=bn((e=+i)*Ho,r*Ho),t):e},t.precision=function(i){return arguments.length?(n=bn(e*Ho,(r=+i)*Ho),t):r},t.angle(90)},fo.geo.distance=function(t,e){var n,i=(e[0]-t[0])*Ho,r=t[1]*Ho,a=e[1]*Ho,o=Math.sin(i),s=Math.cos(i),l=Math.sin(r),u=Math.cos(r),c=Math.sin(a),h=Math.cos(a);return Math.atan2(Math.sqrt((n=h*o)*n+(n=u*c-l*h*s)*n),l*c+u*h*s)},fo.geo.graticule=function(){function t(){return{type:"MultiLineString",coordinates:e()}}function e(){return fo.range(Math.ceil(a/g)*g,r,g).map(d).concat(fo.range(Math.ceil(u/v)*v,l,v).map(f)).concat(fo.range(Math.ceil(i/p)*p,n,p).filter(function(t){return ko(t%g)>Io}).map(c)).concat(fo.range(Math.ceil(s/_)*_,o,_).filter(function(t){return ko(t%v)>Io}).map(h))}var n,i,r,a,o,s,l,u,c,h,d,f,p=10,_=p,g=90,v=360,m=2.5;return t.lines=function(){return e().map(function(t){return{type:"LineString",coordinates:t}})},t.outline=function(){return{type:"Polygon",coordinates:[d(a).concat(f(l).slice(1),d(r).reverse().slice(1),f(u).reverse().slice(1))]}},t.extent=function(e){return arguments.length?t.majorExtent(e).minorExtent(e):t.minorExtent()},t.majorExtent=function(e){return arguments.length?(a=+e[0][0],r=+e[1][0],u=+e[0][1],l=+e[1][1],a>r&&(e=a,a=r,r=e),u>l&&(e=u,u=l,l=e),t.precision(m)):[[a,u],[r,l]]},t.minorExtent=function(e){return arguments.length?(i=+e[0][0],n=+e[1][0],s=+e[0][1],o=+e[1][1],i>n&&(e=i,i=n,n=e),s>o&&(e=s,s=o,o=e),t.precision(m)):[[i,s],[n,o]]},t.step=function(e){return arguments.length?t.majorStep(e).minorStep(e):t.minorStep()},t.majorStep=function(e){return arguments.length?(g=+e[0],v=+e[1],t):[g,v]},t.minorStep=function(e){return arguments.length?(p=+e[0],_=+e[1],t):[p,_]},t.precision=function(e){return arguments.length?(m=+e,c=xn(s,o,90),h=kn(i,n,m),d=xn(u,l,90),f=kn(a,r,m),t):m},t.majorExtent([[-180,-90+Io],[180,90-Io]]).minorExtent([[-180,-80-Io],[180,80+Io]])},fo.geo.greatArc=function(){function t(){return{type:"LineString",coordinates:[e||i.apply(this,arguments),n||r.apply(this,arguments)]}}var e,n,i=Cn,r=Mn;return t.distance=function(){return fo.geo.distance(e||i.apply(this,arguments),n||r.apply(this,arguments))},t.source=function(n){return arguments.length?(i=n,e="function"==typeof n?null:n,t):i},t.target=function(e){return arguments.length?(r=e,n="function"==typeof e?null:e,t):r},t.precision=function(){return arguments.length?t:0},t},fo.geo.interpolate=function(t,e){return Sn(t[0]*Ho,t[1]*Ho,e[0]*Ho,e[1]*Ho)},fo.geo.length=function(t){return Ks=0,fo.geo.stream(t,Zs),Ks};var Ks,Zs={sphere:S,point:S,lineStart:Tn,lineEnd:S,polygonStart:S,polygonEnd:S},Qs=$n(function(t){return Math.sqrt(2/(1+t))},function(t){return 2*Math.asin(t/2)});(fo.geo.azimuthalEqualArea=function(){return hn(Qs)}).raw=Qs;var tl=$n(function(t){var e=Math.acos(t);return e&&e/Math.sin(e)},k);(fo.geo.azimuthalEquidistant=function(){return hn(tl)}).raw=tl,(fo.geo.conicConformal=function(){return We(An)}).raw=An,(fo.geo.conicEquidistant=function(){return We(En)}).raw=En;var el=$n(function(t){return 1/t},Math.atan);(fo.geo.gnomonic=function(){return hn(el)}).raw=el,On.invert=function(t,e){return[t,2*Math.atan(Math.exp(e))-Go]},(fo.geo.mercator=function(){return zn(On)}).raw=On;var nl=$n(function(){return 1},Math.asin);(fo.geo.orthographic=function(){return hn(nl)}).raw=nl;var il=$n(function(t){return 1/(1+t)},function(t){return 2*Math.atan(t)});(fo.geo.stereographic=function(){return hn(il)}).raw=il,Rn.invert=function(t,e){return[-e,2*Math.atan(Math.exp(t))-Go]},(fo.geo.transverseMercator=function(){var t=zn(Rn),e=t.center,n=t.rotate;return t.center=function(t){return t?e([-t[1],t[0]]):(t=e(),[t[1],-t[0]])},t.rotate=function(t){return t?n([t[0],t[1],t.length>2?t[2]+90:90]):(t=n(),[t[0],t[1],t[2]-90])},n([0,0,90])}).raw=Rn,fo.geom={},fo.geom.hull=function(t){function e(t){if(t.length<3)return[];var e,r=Ot(n),a=Ot(i),o=t.length,s=[],l=[];for(e=0;e<o;e++)s.push([+r.call(this,t[e],e),+a.call(this,t[e],e),e]);for(s.sort(jn),e=0;e<o;e++)l.push([s[e][0],-s[e][1]]);var u=qn(s),c=qn(l),h=c[0]===u[0],d=c[c.length-1]===u[u.length-1],f=[];for(e=u.length-1;e>=0;--e)f.push(t[s[u[e]][2]]);for(e=+h;e<c.length-d;++e)f.push(t[s[c[e]][2]]);return f}var n=Nn,i=Pn;return arguments.length?e(t):(e.x=function(t){return arguments.length?(n=t,e):n},e.y=function(t){return arguments.length?(i=t,e):i},e)},fo.geom.polygon=function(t){return $o(t,rl),t};var rl=fo.geom.polygon.prototype=[];rl.area=function(){for(var t,e=-1,n=this.length,i=this[n-1],r=0;++e<n;)t=i,i=this[e],r+=t[1]*i[0]-t[0]*i[1];return.5*r},rl.centroid=function(t){var e,n,i=-1,r=this.length,a=0,o=0,s=this[r-1];for(arguments.length||(t=-1/(6*this.area()));++i<r;)e=s,s=this[i],n=e[0]*s[1]-s[0]*e[1],a+=(e[0]+s[0])*n,o+=(e[1]+s[1])*n;return[a*t,o*t]},rl.clip=function(t){for(var e,n,i,r,a,o,s=In(t),l=-1,u=this.length-In(this),c=this[u-1];++l<u;){for(e=t.slice(),t.length=0,r=this[l],a=e[(i=e.length-s)-1],n=-1;++n<i;)o=e[n],Dn(o,c,r)?(Dn(a,c,r)||t.push(Ln(a,o,c,r)),t.push(o)):Dn(a,c,r)&&t.push(Ln(a,o,c,r)),a=o;s&&t.push(t[0]),c=r}return t};var al,ol,sl,ll,ul,cl=[],hl=[];Xn.prototype.prepare=function(){for(var t,e=this.edges,n=e.length;n--;)t=e[n].edge,t.b&&t.a||e.splice(n,1);return e.sort(Jn),e.length},oi.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},si.prototype={insert:function(t,e){var n,i,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;n=t}else this._?(t=hi(this._),e.P=null,e.N=t,t.P=t.L=e,n=t):(e.P=e.N=null,this._=e,n=null);for(e.L=e.R=null,e.U=n,e.C=!0,t=e;n&&n.C;)i=n.U,n===i.L?(r=i.R,r&&r.C?(n.C=r.C=!1,i.C=!0,t=i):(t===n.R&&(ui(this,n),t=n,n=t.U),n.C=!1,i.C=!0,ci(this,i))):(r=i.L,r&&r.C?(n.C=r.C=!1,i.C=!0,t=i):(t===n.L&&(ci(this,n),t=n,n=t.U),n.C=!1,i.C=!0,ui(this,i))),n=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e,n,i,r=t.U,a=t.L,o=t.R;if(n=a?o?hi(o):a:o,r?r.L===t?r.L=n:r.R=n:this._=n,a&&o?(i=n.C,n.C=t.C,n.L=a,a.U=n,n!==o?(r=n.U,n.U=t.U,t=n.R,r.L=t,n.R=o,o.U=n):(n.U=r,r=n,t=n.R)):(i=t.C,t=n),t&&(t.U=r),!i){if(t&&t.C)return void(t.C=!1);do{if(t===this._)break;if(t===r.L){if(e=r.R,e.C&&(e.C=!1,r.C=!0,ui(this,r),e=r.R),e.L&&e.L.C||e.R&&e.R.C){e.R&&e.R.C||(e.L.C=!1,e.C=!0,ci(this,e),e=r.R),e.C=r.C,r.C=e.R.C=!1,ui(this,r),t=this._;break}}else if(e=r.L,e.C&&(e.C=!1,r.C=!0,ci(this,r),e=r.L),e.L&&e.L.C||e.R&&e.R.C){e.L&&e.L.C||(e.R.C=!1,e.C=!0,ui(this,e),e=r.L),e.C=r.C,r.C=e.L.C=!1,ci(this,r),t=this._;break}e.C=!0,t=r,r=r.U}while(!t.C);t&&(t.C=!1)}}},fo.geom.voronoi=function(t){function e(t){var e=new Array(t.length),i=s[0][0],r=s[0][1],a=s[1][0],o=s[1][1];return di(n(t),s).cells.forEach(function(n,s){var l=n.edges,u=n.site;(e[s]=l.length?l.map(function(t){var e=t.start();return[e.x,e.y]}):u.x>=i&&u.x<=a&&u.y>=r&&u.y<=o?[[i,o],[a,o],[a,r],[i,r]]:[]).point=t[s]}),e}function n(t){return t.map(function(t,e){return{x:Math.round(a(t,e)/Io)*Io,y:Math.round(o(t,e)/Io)*Io,i:e}})}var i=Nn,r=Pn,a=i,o=r,s=dl;return t?e(t):(e.links=function(t){return di(n(t)).edges.filter(function(t){return t.l&&t.r}).map(function(e){return{source:t[e.l.i],target:t[e.r.i]}})},e.triangles=function(t){var e=[];return di(n(t)).cells.forEach(function(n,i){for(var r,a=n.site,o=n.edges.sort(Jn),s=-1,l=o.length,u=o[l-1].edge,c=u.l===a?u.r:u.l;++s<l;)u,r=c,u=o[s].edge,c=u.l===a?u.r:u.l,i<r.i&&i<c.i&&pi(a,r,c)<0&&e.push([t[i],t[r.i],t[c.i]])}),e},e.x=function(t){return arguments.length?(a=Ot(i=t),e):i},e.y=function(t){return arguments.length?(o=Ot(r=t),e):r},e.clipExtent=function(t){return arguments.length?(s=null==t?dl:t,e):s===dl?null:s},e.size=function(t){return arguments.length?e.clipExtent(t&&[[0,0],t]):s===dl?null:s&&s[1]},e)};var dl=[[-1e6,-1e6],[1e6,1e6]];fo.geom.delaunay=function(t){return fo.geom.voronoi().triangles(t)},fo.geom.quadtree=function(t,e,n,i,r){function a(t){function a(t,e,n,i,r,a,o,s){if(!isNaN(n)&&!isNaN(i))if(t.leaf){var l=t.x,c=t.y;if(null!=l)if(ko(l-n)+ko(c-i)<.01)u(t,e,n,i,r,a,o,s);else{var h=t.point;t.x=t.y=t.point=null,u(t,h,l,c,r,a,o,s),u(t,e,n,i,r,a,o,s)}else t.x=n,t.y=i,t.point=e}else u(t,e,n,i,r,a,o,s)}function u(t,e,n,i,r,o,s,l){var u=.5*(r+s),c=.5*(o+l),h=n>=u,d=i>=c,f=d<<1|h;t.leaf=!1,t=t.nodes[f]||(t.nodes[f]=vi()),h?r=u:s=u,d?o=c:l=c,a(t,e,n,i,r,o,s,l)}var c,h,d,f,p,_,g,v,m,y=Ot(s),b=Ot(l);if(null!=e)_=e,g=n,v=i,m=r;else if(v=m=-(_=g=1/0),h=[],d=[],p=t.length,o)for(f=0;f<p;++f)c=t[f],c.x<_&&(_=c.x),c.y<g&&(g=c.y),c.x>v&&(v=c.x),c.y>m&&(m=c.y),h.push(c.x),d.push(c.y);else for(f=0;f<p;++f){var w=+y(c=t[f],f),x=+b(c,f);w<_&&(_=w),x<g&&(g=x),w>v&&(v=w),x>m&&(m=x),h.push(w),d.push(x)}var k=v-_,C=m-g;k>C?m=g+k:v=_+C;var M=vi();if(M.add=function(t){a(M,t,+y(t,++f),+b(t,f),_,g,v,m)},M.visit=function(t){mi(t,M,_,g,v,m)},M.find=function(t){return yi(M,t[0],t[1],_,g,v,m)},f=-1,null==e){for(;++f<p;)a(M,t[f],h[f],d[f],_,g,v,m);--f}else t.forEach(M.add);return h=d=t=c=null,M}var o,s=Nn,l=Pn;return(o=arguments.length)?(s=_i,l=gi,3===o&&(r=n,i=e,n=e=0),a(t)):(a.x=function(t){return arguments.length?(s=t,a):s},a.y=function(t){return arguments.length?(l=t,a):l},a.extent=function(t){return arguments.length?(null==t?e=n=i=r=null:(e=+t[0][0],n=+t[0][1],i=+t[1][0],r=+t[1][1]),a):null==e?null:[[e,n],[i,r]]},a.size=function(t){return arguments.length?(null==t?e=n=i=r=null:(e=n=0,i=+t[0],r=+t[1]),a):null==e?null:[i-e,r-n]},a)},fo.interpolateRgb=bi,fo.interpolateObject=wi,fo.interpolateNumber=xi,fo.interpolateString=ki;var fl=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,pl=new RegExp(fl.source,"g");fo.interpolate=Ci,fo.interpolators=[function(t,e){var n=typeof e;return("string"===n?os.has(e.toLowerCase())||/^(#|rgb\(|hsl\()/i.test(e)?bi:ki:e instanceof ht?bi:Array.isArray(e)?Mi:"object"===n&&isNaN(e)?wi:xi)(t,e)}],fo.interpolateArray=Mi;var _l=function(){return k},gl=fo.map({linear:_l,poly:zi,quad:function(){return Ai},cubic:function(){return Ei},sin:function(){return Ri},exp:function(){return Ni},circle:function(){return Pi},elastic:qi,back:ji,bounce:function(){return Di}}),vl=fo.map({in:k,out:Ti,"in-out":$i,"out-in":function(t){return $i(Ti(t))}});fo.ease=function(t){var e=t.indexOf("-"),n=e>=0?t.slice(0,e):t,i=e>=0?t.slice(e+1):"in";return n=gl.get(n)||_l,i=vl.get(i)||k,Si(i(n.apply(null,po.call(arguments,1))))},fo.interpolateHcl=Li,fo.interpolateHsl=Ii,fo.interpolateLab=Bi,fo.interpolateRound=Vi,fo.transform=function(t){var e=go.createElementNS(fo.ns.prefix.svg,"g");return(fo.transform=function(t){if(null!=t){e.setAttribute("transform",t);var n=e.transform.baseVal.consolidate()}return new Ui(n?n.matrix:ml)})(t)},Ui.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var ml={a:1,b:0,c:0,d:1,e:0,f:0};fo.interpolateTransform=Zi,fo.layout={},fo.layout.bundle=function(){return function(t){for(var e=[],n=-1,i=t.length;++n<i;)e.push(er(t[n]));return e}},fo.layout.chord=function(){function t(){var t,u,h,d,f,p={},_=[],g=fo.range(a),v=[];for(n=[],i=[],t=0,d=-1;++d<a;){for(u=0,f=-1;++f<a;)u+=r[d][f];_.push(u),v.push(fo.range(a)),t+=u}for(o&&g.sort(function(t,e){return o(_[t],_[e])}),s&&v.forEach(function(t,e){t.sort(function(t,n){return s(r[e][t],r[e][n])})}),t=(Uo-c*a)/t,u=0,d=-1;++d<a;){for(h=u,f=-1;++f<a;){var m=g[d],y=v[m][f],b=r[m][y],w=u,x=u+=b*t;p[m+"-"+y]={index:m,subindex:y,startAngle:w,endAngle:x,value:b}}i[m]={index:m,startAngle:h,endAngle:u,value:_[m]},u+=c}for(d=-1;++d<a;)for(f=d-1;++f<a;){var k=p[d+"-"+f],C=p[f+"-"+d];(k.value||C.value)&&n.push(k.value<C.value?{source:C,target:k}:{source:k,target:C})}l&&e()}function e(){n.sort(function(t,e){return l((t.source.value+t.target.value)/2,(e.source.value+e.target.value)/2)})}var n,i,r,a,o,s,l,u={},c=0;return u.matrix=function(t){return arguments.length?(a=(r=t)&&r.length,n=i=null,u):r},u.padding=function(t){return arguments.length?(c=t,n=i=null,u):c},u.sortGroups=function(t){return arguments.length?(o=t,n=i=null,u):o},u.sortSubgroups=function(t){return arguments.length?(s=t,n=null,u):s},u.sortChords=function(t){return arguments.length?(l=t,n&&e(),u):l},u.chords=function(){return n||t(),n},u.groups=function(){return i||t(),i},u},fo.layout.force=function(){function t(t){return function(e,n,i,r){if(e.point!==t){var a=e.cx-t.x,o=e.cy-t.y,s=r-n,l=a*a+o*o;if(s*s/v<l){if(l<_){var u=e.charge/l;t.px-=a*u,t.py-=o*u}return!0}if(e.point&&l&&l<_){var u=e.pointCharge/l;t.px-=a*u,t.py-=o*u}}return!e.charge}}function e(t){t.px=fo.event.x,t.py=fo.event.y,l.resume()}var n,i,r,a,o,s,l={},u=fo.dispatch("start","tick","end"),c=[1,1],h=.9,d=yl,f=bl,p=-30,_=wl,g=.1,v=.64,m=[],y=[];return l.tick=function(){if((r*=.99)<.005)return n=null,u.end({type:"end",alpha:r=0}),!0;var e,i,l,d,f,_,v,b,w,x=m.length,k=y.length;for(i=0;i<k;++i)l=y[i],d=l.source,f=l.target,b=f.x-d.x,w=f.y-d.y,(_=b*b+w*w)&&(_=r*o[i]*((_=Math.sqrt(_))-a[i])/_,b*=_,w*=_,f.x-=b*(v=d.weight+f.weight?d.weight/(d.weight+f.weight):.5),f.y-=w*v,d.x+=b*(v=1-v),d.y+=w*v);if((v=r*g)&&(b=c[0]/2,w=c[1]/2,i=-1,v))for(;++i<x;)l=m[i],l.x+=(b-l.x)*v,l.y+=(w-l.y)*v;if(p)for(lr(e=fo.geom.quadtree(m),r,s),i=-1;++i<x;)(l=m[i]).fixed||e.visit(t(l));for(i=-1;++i<x;)l=m[i],l.fixed?(l.x=l.px,l.y=l.py):(l.x-=(l.px-(l.px=l.x))*h,l.y-=(l.py-(l.py=l.y))*h);u.tick({type:"tick",alpha:r})},l.nodes=function(t){return arguments.length?(m=t,l):m},l.links=function(t){return arguments.length?(y=t,l):y},l.size=function(t){return arguments.length?(c=t,l):c},l.linkDistance=function(t){return arguments.length?(d="function"==typeof t?t:+t,l):d},l.distance=l.linkDistance,l.linkStrength=function(t){return arguments.length?(f="function"==typeof t?t:+t,l):f},l.friction=function(t){return arguments.length?(h=+t,l):h},l.charge=function(t){return arguments.length?(p="function"==typeof t?t:+t,l):p},l.chargeDistance=function(t){return arguments.length?(_=t*t,l):Math.sqrt(_)},l.gravity=function(t){return arguments.length?(g=+t,l):g},l.theta=function(t){return arguments.length?(v=t*t,l):Math.sqrt(v)},l.alpha=function(t){return arguments.length?(t=+t,r?t>0?r=t:(n.c=null,n.t=NaN,n=null,u.end({type:"end",alpha:r=0})):t>0&&(u.start({type:"start",alpha:r=t}),n=qt(l.tick)),l):r},l.start=function(){function t(t,i){if(!n){for(n=new Array(r),l=0;l<r;++l)n[l]=[];for(l=0;l<u;++l){var a=y[l];n[a.source.index].push(a.target),n[a.target.index].push(a.source)}}for(var o,s=n[e],l=-1,c=s.length;++l<c;)if(!isNaN(o=s[l][t]))return o;return Math.random()*i}var e,n,i,r=m.length,u=y.length,h=c[0],_=c[1];for(e=0;e<r;++e)(i=m[e]).index=e,i.weight=0;for(e=0;e<u;++e)i=y[e],"number"==typeof i.source&&(i.source=m[i.source]),"number"==typeof i.target&&(i.target=m[i.target]),++i.source.weight,++i.target.weight;for(e=0;e<r;++e)i=m[e],isNaN(i.x)&&(i.x=t("x",h)),isNaN(i.y)&&(i.y=t("y",_)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(a=[],"function"==typeof d)for(e=0;e<u;++e)a[e]=+d.call(this,y[e],e);else for(e=0;e<u;++e)a[e]=d;if(o=[],"function"==typeof f)for(e=0;e<u;++e)o[e]=+f.call(this,y[e],e);else for(e=0;e<u;++e)o[e]=f;if(s=[],"function"==typeof p)for(e=0;e<r;++e)s[e]=+p.call(this,m[e],e);else for(e=0;e<r;++e)s[e]=p;return l.resume()},l.resume=function(){return l.alpha(.1)},l.stop=function(){return l.alpha(0)},l.drag=function(){if(i||(i=fo.behavior.drag().origin(k).on("dragstart.force",rr).on("drag.force",e).on("dragend.force",ar)),!arguments.length)return i;this.on("mouseover.force",or).on("mouseout.force",sr).call(i)},fo.rebind(l,u,"on")};var yl=20,bl=1,wl=1/0;fo.layout.hierarchy=function(){function t(r){var a,o=[r],s=[];for(r.depth=0;null!=(a=o.pop());)if(s.push(a),(u=n.call(t,a,a.depth))&&(l=u.length)){for(var l,u,c;--l>=0;)o.push(c=u[l]),c.parent=a,c.depth=a.depth+1;i&&(a.value=0),a.children=u}else i&&(a.value=+i.call(t,a,a.depth)||0),delete a.children;return hr(r,function(t){var n,r;e&&(n=t.children)&&n.sort(e),i&&(r=t.parent)&&(r.value+=t.value)}),s}var e=pr,n=dr,i=fr;return t.sort=function(n){return arguments.length?(e=n,t):e},t.children=function(e){return arguments.length?(n=e,t):n},t.value=function(e){return arguments.length?(i=e,t):i},t.revalue=function(e){return i&&(cr(e,function(t){t.children&&(t.value=0)}),hr(e,function(e){var n;e.children||(e.value=+i.call(t,e,e.depth)||0),(n=e.parent)&&(n.value+=e.value)})),e},t},fo.layout.partition=function(){function t(e,n,i,r){var a=e.children;if(e.x=n,e.y=e.depth*r,e.dx=i,e.dy=r,a&&(o=a.length)){var o,s,l,u=-1;for(i=e.value?i/e.value:0;++u<o;)t(s=a[u],n,l=s.value*i,r),n+=l}}function e(t){var n=t.children,i=0;if(n&&(r=n.length))for(var r,a=-1;++a<r;)i=Math.max(i,e(n[a]));return 1+i}function n(n,a){var o=i.call(this,n,a);return t(o[0],0,r[0],r[1]/e(o[0])),o}var i=fo.layout.hierarchy(),r=[1,1];return n.size=function(t){return arguments.length?(r=t,n):r},ur(n,i)},fo.layout.pie=function(){function t(o){var s,l=o.length,u=o.map(function(n,i){return+e.call(t,n,i)}),c=+("function"==typeof i?i.apply(this,arguments):i),h=("function"==typeof r?r.apply(this,arguments):r)-c,d=Math.min(Math.abs(h)/l,+("function"==typeof a?a.apply(this,arguments):a)),f=d*(h<0?-1:1),p=fo.sum(u),_=p?(h-l*f)/p:0,g=fo.range(l),v=[];return null!=n&&g.sort(n===xl?function(t,e){return u[e]-u[t]}:function(t,e){return n(o[t],o[e])}),g.forEach(function(t){v[t]={data:o[t],value:s=u[t],startAngle:c,endAngle:c+=s*_+f,padAngle:d}}),v}var e=Number,n=xl,i=0,r=Uo,a=0;return t.value=function(n){return arguments.length?(e=n,t):e},t.sort=function(e){return arguments.length?(n=e,t):n},t.startAngle=function(e){return arguments.length?(i=e,t):i},t.endAngle=function(e){return arguments.length?(r=e,t):r},t.padAngle=function(e){return arguments.length?(a=e,t):a},t};var xl={};fo.layout.stack=function(){function t(s,l){if(!(d=s.length))return s;var u=s.map(function(n,i){return e.call(t,n,i)}),c=u.map(function(e){return e.map(function(e,n){return[a.call(t,e,n),o.call(t,e,n)]})}),h=n.call(t,c,l);u=fo.permute(u,h),c=fo.permute(c,h);var d,f,p,_,g=i.call(t,c,l),v=u[0].length;for(p=0;p<v;++p)for(r.call(t,u[0][p],_=g[p],c[0][p][1]),f=1;f<d;++f)r.call(t,u[f][p],_+=c[f-1][p][1],c[f][p][1]);return s}var e=k,n=yr,i=br,r=mr,a=gr,o=vr;return t.values=function(n){return arguments.length?(e=n,t):e},t.order=function(e){return arguments.length?(n="function"==typeof e?e:kl.get(e)||yr,t):n},t.offset=function(e){return arguments.length?(i="function"==typeof e?e:Cl.get(e)||br,t):i},t.x=function(e){return arguments.length?(a=e,t):a},t.y=function(e){return arguments.length?(o=e,t):o},t.out=function(e){return arguments.length?(r=e,t):r},t};var kl=fo.map({"inside-out":function(t){var e,n,i=t.length,r=t.map(wr),a=t.map(xr),o=fo.range(i).sort(function(t,e){return r[t]-r[e]}),s=0,l=0,u=[],c=[];for(e=0;e<i;++e)n=o[e],s<l?(s+=a[n],u.push(n)):(l+=a[n],c.push(n));return c.reverse().concat(u)},reverse:function(t){return fo.range(t.length).reverse()},default:yr}),Cl=fo.map({silhouette:function(t){var e,n,i,r=t.length,a=t[0].length,o=[],s=0,l=[];for(n=0;n<a;++n){for(e=0,i=0;e<r;e++)i+=t[e][n][1];i>s&&(s=i),o.push(i)}for(n=0;n<a;++n)l[n]=(s-o[n])/2;return l},wiggle:function(t){var e,n,i,r,a,o,s,l,u,c=t.length,h=t[0],d=h.length,f=[];for(f[0]=l=u=0,n=1;n<d;++n){for(e=0,r=0;e<c;++e)r+=t[e][n][1];for(e=0,a=0,s=h[n][0]-h[n-1][0];e<c;++e){for(i=0,o=(t[e][n][1]-t[e][n-1][1])/(2*s);i<e;++i)o+=(t[i][n][1]-t[i][n-1][1])/s;a+=o*t[e][n][1]}f[n]=l-=r?a/r*s:0,l<u&&(u=l)}for(n=0;n<d;++n)f[n]-=u;return f},expand:function(t){var e,n,i,r=t.length,a=t[0].length,o=1/r,s=[];for(n=0;n<a;++n){for(e=0,i=0;e<r;e++)i+=t[e][n][1];if(i)for(e=0;e<r;e++)t[e][n][1]/=i;else for(e=0;e<r;e++)t[e][n][1]=o}for(n=0;n<a;++n)s[n]=0;return s},zero:br});fo.layout.histogram=function(){function t(t,a){for(var o,s,l=[],u=t.map(n,this),c=i.call(this,u,a),h=r.call(this,c,u,a),a=-1,d=u.length,f=h.length-1,p=e?1:1/d;++a<f;)o=l[a]=[],o.dx=h[a+1]-(o.x=h[a]),o.y=0;if(f>0)for(a=-1;++a<d;)(s=u[a])>=c[0]&&s<=c[1]&&(o=l[fo.bisect(h,s,1,f)-1],o.y+=p,o.push(t[a]));return l}var e=!0,n=Number,i=Sr,r=Cr;return t.value=function(e){return arguments.length?(n=e,t):n},t.range=function(e){return arguments.length?(i=Ot(e),t):i},t.bins=function(e){return arguments.length?(r="number"==typeof e?function(t){return Mr(t,e)}:Ot(e),t):r},t.frequency=function(n){return arguments.length?(e=!!n,t):e},t},fo.layout.pack=function(){function t(t,a){var o=n.call(this,t,a),s=o[0],l=r[0],u=r[1],c=null==e?Math.sqrt:"function"==typeof e?e:function(){return e};if(s.x=s.y=0,hr(s,function(t){t.r=+c(t.value)}),hr(s,Or),i){var h=i*(e?1:Math.max(2*s.r/l,2*s.r/u))/2;hr(s,function(t){t.r+=h}),hr(s,Or),hr(s,function(t){t.r-=h})}return Nr(s,l/2,u/2,e?1:1/Math.max(2*s.r/l,2*s.r/u)),o}var e,n=fo.layout.hierarchy().sort(Tr),i=0,r=[1,1];return t.size=function(e){return arguments.length?(r=e,t):r},t.radius=function(n){return arguments.length?(e=null==n||"function"==typeof n?n:+n,t):e},t.padding=function(e){return arguments.length?(i=+e,t):i},ur(t,n)},fo.layout.tree=function(){function t(t,r){var c=o.call(this,t,r),h=c[0],d=e(h);if(hr(d,n),d.parent.m=-d.z,cr(d,i),u)cr(h,a);else{var f=h,p=h,_=h;cr(h,function(t){t.x<f.x&&(f=t),t.x>p.x&&(p=t),t.depth>_.depth&&(_=t)});var g=s(f,p)/2-f.x,v=l[0]/(p.x+s(p,f)/2+g),m=l[1]/(_.depth||1);cr(h,function(t){t.x=(t.x+g)*v,t.y=t.depth*m})}return c}function e(t){for(var e,n={A:null,children:[t]},i=[n];null!=(e=i.pop());)for(var r,a=e.children,o=0,s=a.length;o<s;++o)i.push((a[o]=r={_:a[o],parent:e,children:(r=a[o].children)&&r.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:o}).a=r);return n.children[0]}function n(t){var e=t.children,n=t.parent.children,i=t.i?n[t.i-1]:null;if(e.length){Ir(t);var a=(e[0].z+e[e.length-1].z)/2;i?(t.z=i.z+s(t._,i._),t.m=t.z-a):t.z=a}else i&&(t.z=i.z+s(t._,i._));t.parent.A=r(t,i,t.parent.A||n[0])}function i(t){t._.x=t.z+t.parent.m,t.m+=t.parent.m}function r(t,e,n){if(e){for(var i,r=t,a=t,o=e,l=r.parent.children[0],u=r.m,c=a.m,h=o.m,d=l.m;o=Dr(o),r=jr(r),o&&r;)l=jr(l),a=Dr(a),a.a=t,i=o.z+h-r.z-u+s(o._,r._),i>0&&(Lr(Br(o,t,n),t,i),u+=i,c+=i),h+=o.m,u+=r.m,d+=l.m,c+=a.m;o&&!Dr(a)&&(a.t=o,a.m+=h-c),r&&!jr(l)&&(l.t=r,l.m+=u-d,n=t)}return n}function a(t){t.x*=l[0],t.y=t.depth*l[1]}var o=fo.layout.hierarchy().sort(null).value(null),s=qr,l=[1,1],u=null;return t.separation=function(e){return arguments.length?(s=e,t):s},t.size=function(e){return arguments.length?(u=null==(l=e)?a:null,t):u?null:l},t.nodeSize=function(e){return arguments.length?(u=null==(l=e)?null:a,t):u?l:null},ur(t,o)},fo.layout.cluster=function(){function t(t,a){var o,s=e.call(this,t,a),l=s[0],u=0;hr(l,function(t){var e=t.children;e&&e.length?(t.x=Ur(e),t.y=Vr(e)):(t.x=o?u+=n(t,o):0,t.y=0,o=t)});var c=Fr(l),h=Gr(l),d=c.x-n(c,h)/2,f=h.x+n(h,c)/2;return hr(l,r?function(t){t.x=(t.x-l.x)*i[0],t.y=(l.y-t.y)*i[1]}:function(t){t.x=(t.x-d)/(f-d)*i[0],t.y=(1-(l.y?t.y/l.y:1))*i[1]}),s}var e=fo.layout.hierarchy().sort(null).value(null),n=qr,i=[1,1],r=!1;return t.separation=function(e){return arguments.length?(n=e,t):n},t.size=function(e){return arguments.length?(r=null==(i=e),t):r?null:i},t.nodeSize=function(e){return arguments.length?(r=null!=(i=e),t):r?i:null},ur(t,e)},fo.layout.treemap=function(){function t(t,e){for(var n,i,r=-1,a=t.length;++r<a;)i=(n=t[r]).value*(e<0?0:e),n.area=isNaN(i)||i<=0?0:i}function e(n){var a=n.children;if(a&&a.length){var o,s,l,u=h(n),c=[],d=a.slice(),p=1/0,_="slice"===f?u.dx:"dice"===f?u.dy:"slice-dice"===f?1&n.depth?u.dy:u.dx:Math.min(u.dx,u.dy);for(t(d,u.dx*u.dy/n.value),c.area=0;(l=d.length)>0;)c.push(o=d[l-1]),c.area+=o.area,"squarify"!==f||(s=i(c,_))<=p?(d.pop(),p=s):(c.area-=c.pop().area,r(c,_,u,!1),_=Math.min(u.dx,u.dy),c.length=c.area=0,p=1/0);c.length&&(r(c,_,u,!0),c.length=c.area=0),a.forEach(e)}}function n(e){var i=e.children;if(i&&i.length){var a,o=h(e),s=i.slice(),l=[];for(t(s,o.dx*o.dy/e.value),l.area=0;a=s.pop();)l.push(a),l.area+=a.area,null!=a.z&&(r(l,a.z?o.dx:o.dy,o,!s.length),l.length=l.area=0);i.forEach(n)}}function i(t,e){for(var n,i=t.area,r=0,a=1/0,o=-1,s=t.length;++o<s;)(n=t[o].area)&&(n<a&&(a=n),n>r&&(r=n));return i*=i,e*=e,i?Math.max(e*r*p/i,i/(e*a*p)):1/0}function r(t,e,n,i){var r,a=-1,o=t.length,s=n.x,u=n.y,c=e?l(t.area/e):0;if(e==n.dx){for((i||c>n.dy)&&(c=n.dy);++a<o;)r=t[a],r.x=s,r.y=u,r.dy=c,s+=r.dx=Math.min(n.x+n.dx-s,c?l(r.area/c):0);r.z=!0,r.dx+=n.x+n.dx-s,n.y+=c,n.dy-=c}else{for((i||c>n.dx)&&(c=n.dx);++a<o;)r=t[a],r.x=s,r.y=u,r.dx=c,u+=r.dy=Math.min(n.y+n.dy-u,c?l(r.area/c):0);r.z=!1,r.dy+=n.y+n.dy-u,n.x+=c,n.dx-=c}}function a(i){var r=o||s(i),a=r[0];return a.x=a.y=0,a.value?(a.dx=u[0],a.dy=u[1]):a.dx=a.dy=0,o&&s.revalue(a),t([a],a.dx*a.dy/a.value),(o?n:e)(a),d&&(o=r),r}var o,s=fo.layout.hierarchy(),l=Math.round,u=[1,1],c=null,h=Hr,d=!1,f="squarify",p=.5*(1+Math.sqrt(5));return a.size=function(t){return arguments.length?(u=t,a):u},a.padding=function(t){function e(e){var n=t.call(a,e,e.depth);return null==n?Hr(e):Yr(e,"number"==typeof n?[n,n,n,n]:n)}function n(e){return Yr(e,t)}if(!arguments.length)return c;var i;return h=null==(c=t)?Hr:"function"==(i=typeof t)?e:"number"===i?(t=[t,t,t,t],n):n,a},a.round=function(t){return arguments.length?(l=t?Math.round:Number,a):l!=Number},a.sticky=function(t){return arguments.length?(d=t,o=null,a):d},a.ratio=function(t){return arguments.length?(p=t,a):p},a.mode=function(t){return arguments.length?(f=t+"",a):f},ur(a,s)},fo.random={normal:function(t,e){var n=arguments.length;return n<2&&(e=1),n<1&&(t=0),function(){var n,i,r;do{n=2*Math.random()-1,i=2*Math.random()-1,r=n*n+i*i}while(!r||r>1);return t+e*n*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var t=fo.random.normal.apply(fo,arguments);return function(){return Math.exp(t())}},bates:function(t){var e=fo.random.irwinHall(t);return function(){return e()/t}},irwinHall:function(t){return function(){for(var e=0,n=0;n<t;n++)e+=Math.random();return e}}},fo.scale={};var Ml={floor:k,ceil:k};fo.scale.linear=function(){return ta([0,1],[0,1],Ci,!1)};var Sl={s:1,g:1,p:1,r:1,e:1};fo.scale.log=function(){return la(fo.scale.linear().domain([0,1]),10,!0,[1,10])};var Tl=fo.format(".0e"),$l={floor:function(t){return-Math.ceil(-t)},ceil:function(t){return-Math.floor(-t)}};fo.scale.pow=function(){return ua(fo.scale.linear(),1,[0,1])},fo.scale.sqrt=function(){return fo.scale.pow().exponent(.5)},fo.scale.ordinal=function(){return ha([],{t:"range",a:[[]]})},fo.scale.category10=function(){return fo.scale.ordinal().range(Al)},fo.scale.category20=function(){return fo.scale.ordinal().range(El)},fo.scale.category20b=function(){return fo.scale.ordinal().range(Ol)},fo.scale.category20c=function(){return fo.scale.ordinal().range(zl)};var Al=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(Ct),El=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(Ct),Ol=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(Ct),zl=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(Ct);fo.scale.quantile=function(){return da([],[])},fo.scale.quantize=function(){return fa(0,1,[0,1])},fo.scale.threshold=function(){return pa([.5],[0,1])},fo.scale.identity=function(){return _a([0,1])},fo.svg={},fo.svg.arc=function(){function t(){var t=Math.max(0,+n.apply(this,arguments)),u=Math.max(0,+i.apply(this,arguments)),c=o.apply(this,arguments)-Go,h=s.apply(this,arguments)-Go,d=Math.abs(h-c),f=c>h?0:1;if(u<t&&(p=u,u=t,t=p),d>=Fo)return e(u,f)+(t?e(t,1-f):"")+"Z";var p,_,g,v,m,y,b,w,x,k,C,M,S=0,T=0,$=[];if((v=(+l.apply(this,arguments)||0)/2)&&(g=a===Rl?Math.sqrt(t*t+u*u):+a.apply(this,arguments),f||(T*=-1),u&&(T=ot(g/u*Math.sin(v))),t&&(S=ot(g/t*Math.sin(v)))),u){m=u*Math.cos(c+T),y=u*Math.sin(c+T),b=u*Math.cos(h-T),w=u*Math.sin(h-T);var A=Math.abs(h-c-2*T)<=Vo?0:1;if(T&&xa(m,y,b,w)===f^A){var E=(c+h)/2;m=u*Math.cos(E),y=u*Math.sin(E),b=w=null}}else m=y=0;if(t){x=t*Math.cos(h-S),k=t*Math.sin(h-S),C=t*Math.cos(c+S),M=t*Math.sin(c+S);var O=Math.abs(c-h+2*S)<=Vo?0:1;if(S&&xa(x,k,C,M)===1-f^O){var z=(c+h)/2;x=t*Math.cos(z),k=t*Math.sin(z),C=M=null}}else x=k=0;if(d>Io&&(p=Math.min(Math.abs(u-t)/2,+r.apply(this,arguments)))>.001){_=t<u^f?0:1;var R=p,N=p;if(d<Vo){var P=null==C?[x,k]:null==b?[m,y]:Ln([m,y],[C,M],[b,w],[x,k]),q=m-P[0],j=y-P[1],D=b-P[0],L=w-P[1],I=1/Math.sin(Math.acos((q*D+j*L)/(Math.sqrt(q*q+j*j)*Math.sqrt(D*D+L*L)))/2),B=Math.sqrt(P[0]*P[0]+P[1]*P[1]);N=Math.min(p,(t-B)/(I-1)),R=Math.min(p,(u-B)/(I+1))}if(null!=b){var V=ka(null==C?[x,k]:[C,M],[m,y],u,R,f),U=ka([b,w],[x,k],u,R,f);p===R?$.push("M",V[0],"A",R,",",R," 0 0,",_," ",V[1],"A",u,",",u," 0 ",1-f^xa(V[1][0],V[1][1],U[1][0],U[1][1]),",",f," ",U[1],"A",R,",",R," 0 0,",_," ",U[0]):$.push("M",V[0],"A",R,",",R," 0 1,",_," ",U[0])}else $.push("M",m,",",y);if(null!=C){var F=ka([m,y],[C,M],t,-N,f),G=ka([x,k],null==b?[m,y]:[b,w],t,-N,f);p===N?$.push("L",G[0],"A",N,",",N," 0 0,",_," ",G[1],"A",t,",",t," 0 ",f^xa(G[1][0],G[1][1],F[1][0],F[1][1]),",",1-f," ",F[1],"A",N,",",N," 0 0,",_," ",F[0]):$.push("L",G[0],"A",N,",",N," 0 0,",_," ",F[0])}else $.push("L",x,",",k)}else $.push("M",m,",",y),null!=b&&$.push("A",u,",",u," 0 ",A,",",f," ",b,",",w),$.push("L",x,",",k),null!=C&&$.push("A",t,",",t," 0 ",O,",",1-f," ",C,",",M);return $.push("Z"),$.join("")}function e(t,e){return"M0,"+t+"A"+t+","+t+" 0 1,"+e+" 0,"+-t+"A"+t+","+t+" 0 1,"+e+" 0,"+t}var n=va,i=ma,r=ga,a=Rl,o=ya,s=ba,l=wa;return t.innerRadius=function(e){return arguments.length?(n=Ot(e),t):n},t.outerRadius=function(e){return arguments.length?(i=Ot(e),t):i},t.cornerRadius=function(e){return arguments.length?(r=Ot(e),t):r},t.padRadius=function(e){return arguments.length?(a=e==Rl?Rl:Ot(e),t):a},t.startAngle=function(e){return arguments.length?(o=Ot(e),t):o},t.endAngle=function(e){return arguments.length?(s=Ot(e),t):s},t.padAngle=function(e){return arguments.length?(l=Ot(e),t):l},t.centroid=function(){var t=(+n.apply(this,arguments)+ +i.apply(this,arguments))/2,e=(+o.apply(this,arguments)+ +s.apply(this,arguments))/2-Go;return[Math.cos(e)*t,Math.sin(e)*t]},t};var Rl="auto";fo.svg.line=function(){return Ca(k)};var Nl=fo.map({linear:Ma,"linear-closed":Sa,step:Ta,"step-before":$a,"step-after":Aa,basis:Pa,"basis-open":qa,"basis-closed":ja,bundle:Da,cardinal:za,"cardinal-open":Ea,"cardinal-closed":Oa,monotone:Fa});Nl.forEach(function(t,e){e.key=t,e.closed=/-closed$/.test(t)});var Pl=[0,2/3,1/3,0],ql=[0,1/3,2/3,0],jl=[0,1/6,2/3,1/6];fo.svg.line.radial=function(){var t=Ca(Ga);return t.radius=t.x,delete t.x,t.angle=t.y,delete t.y,t},$a.reverse=Aa,Aa.reverse=$a,fo.svg.area=function(){return Ha(k)},fo.svg.area.radial=function(){var t=Ha(Ga);return t.radius=t.x,delete t.x,t.innerRadius=t.x0,delete t.x0,t.outerRadius=t.x1,delete t.x1,t.angle=t.y,delete t.y,t.startAngle=t.y0,delete t.y0,t.endAngle=t.y1,delete t.y1,t},fo.svg.chord=function(){function t(t,s){var l=e(this,a,t,s),u=e(this,o,t,s);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,u)?r(l.r,l.p1,l.r,l.p0):r(l.r,l.p1,u.r,u.p0)+i(u.r,u.p1,u.a1-u.a0)+r(u.r,u.p1,l.r,l.p0))+"Z"}function e(t,e,n,i){var r=e.call(t,n,i),a=s.call(t,r,i),o=l.call(t,r,i)-Go,c=u.call(t,r,i)-Go;return{r:a,a0:o,a1:c,p0:[a*Math.cos(o),a*Math.sin(o)],p1:[a*Math.cos(c),a*Math.sin(c)]}}function n(t,e){return t.a0==e.a0&&t.a1==e.a1}function i(t,e,n){return"A"+t+","+t+" 0 "+ +(n>Vo)+",1 "+e}function r(t,e,n,i){return"Q 0,0 "+i}var a=Cn,o=Mn,s=Ya,l=ya,u=ba;return t.radius=function(e){return arguments.length?(s=Ot(e),t):s},t.source=function(e){return arguments.length?(a=Ot(e),t):a},t.target=function(e){return arguments.length?(o=Ot(e),t):o},t.startAngle=function(e){return arguments.length?(l=Ot(e),t):l},t.endAngle=function(e){return arguments.length?(u=Ot(e),t):u},t},fo.svg.diagonal=function(){function t(t,r){var a=e.call(this,t,r),o=n.call(this,t,r),s=(a.y+o.y)/2,l=[a,{x:a.x,y:s},{x:o.x,y:s},o];return l=l.map(i),"M"+l[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var e=Cn,n=Mn,i=Xa;return t.source=function(n){return arguments.length?(e=Ot(n),t):e},t.target=function(e){return arguments.length?(n=Ot(e),t):n},t.projection=function(e){return arguments.length?(i=e,t):i},t},fo.svg.diagonal.radial=function(){var t=fo.svg.diagonal(),e=Xa,n=t.projection;return t.projection=function(t){return arguments.length?n(Wa(e=t)):e},t},fo.svg.symbol=function(){function t(t,i){return(Dl.get(e.call(this,t,i))||Za)(n.call(this,t,i))}var e=Ka,n=Ja;return t.type=function(n){return arguments.length?(e=Ot(n),t):e},t.size=function(e){return arguments.length?(n=Ot(e),t):n},t};var Dl=fo.map({circle:Za,cross:function(t){var e=Math.sqrt(t/5)/2;return"M"+-3*e+","+-e+"H"+-e+"V"+-3*e+"H"+e+"V"+-e+"H"+3*e+"V"+e+"H"+e+"V"+3*e+"H"+-e+"V"+e+"H"+-3*e+"Z"},diamond:function(t){var e=Math.sqrt(t/(2*Il)),n=e*Il;return"M0,"+-e+"L"+n+",0 0,"+e+" "+-n+",0Z"},square:function(t){var e=Math.sqrt(t)/2;return"M"+-e+","+-e+"L"+e+","+-e+" "+e+","+e+" "+-e+","+e+"Z"},"triangle-down":function(t){var e=Math.sqrt(t/Ll),n=e*Ll/2;return"M0,"+n+"L"+e+","+-n+" "+-e+","+-n+"Z"},"triangle-up":function(t){var e=Math.sqrt(t/Ll),n=e*Ll/2;return"M0,"+-n+"L"+e+","+n+" "+-e+","+n+"Z"}});fo.svg.symbolTypes=Dl.keys();var Ll=Math.sqrt(3),Il=Math.tan(30*Ho);zo.transition=function(t){for(var e,n,i=Bl||++Gl,r=io(t),a=[],o=Vl||{time:Date.now(),ease:Oi,delay:0,duration:250},s=-1,l=this.length;++s<l;){a.push(e=[]);for(var u=this[s],c=-1,h=u.length;++c<h;)(n=u[c])&&ro(n,c,r,i,o),e.push(n)}return to(a,r,i)},zo.interrupt=function(t){return this.each(null==t?Ul:Qa(io(t)))};var Bl,Vl,Ul=Qa(io()),Fl=[],Gl=0;Fl.call=zo.call,Fl.empty=zo.empty,Fl.node=zo.node,Fl.size=zo.size,fo.transition=function(t,e){return t&&t.transition?Bl?t.transition(e):t:fo.selection().transition(t)},fo.transition.prototype=Fl,Fl.select=function(t){var e,n,i,r=this.id,a=this.namespace,o=[];t=R(t);for(var s=-1,l=this.length;++s<l;){o.push(e=[]);for(var u=this[s],c=-1,h=u.length;++c<h;)(i=u[c])&&(n=t.call(i,i.__data__,c,s))?("__data__"in i&&(n.__data__=i.__data__),ro(n,c,a,r,i[a][r]),e.push(n)):e.push(null)}return to(o,a,r)},Fl.selectAll=function(t){var e,n,i,r,a,o=this.id,s=this.namespace,l=[];t=N(t);for(var u=-1,c=this.length;++u<c;)for(var h=this[u],d=-1,f=h.length;++d<f;)if(i=h[d]){a=i[s][o],n=t.call(i,i.__data__,d,u),l.push(e=[]);for(var p=-1,_=n.length;++p<_;)(r=n[p])&&ro(r,p,s,o,a),e.push(r)}return to(l,s,o)},Fl.filter=function(t){var e,n,i,r=[];"function"!=typeof t&&(t=H(t));for(var a=0,o=this.length;a<o;a++){r.push(e=[]);for(var n=this[a],s=0,l=n.length;s<l;s++)(i=n[s])&&t.call(i,i.__data__,s,a)&&e.push(i)}return to(r,this.namespace,this.id)},Fl.tween=function(t,e){var n=this.id,i=this.namespace;return arguments.length<2?this.node()[i][n].tween.get(t):X(this,null==e?function(e){e[i][n].tween.remove(t)}:function(r){r[i][n].tween.set(t,e)})},Fl.attr=function(t,e){function n(){this.removeAttribute(s)}function i(){this.removeAttributeNS(s.space,s.local)}function r(t){return null==t?n:(t+="",function(){var e,n=this.getAttribute(s);return n!==t&&(e=o(n,t),function(t){this.setAttribute(s,e(t))})})}function a(t){return null==t?i:(t+="",function(){var e,n=this.getAttributeNS(s.space,s.local);return n!==t&&(e=o(n,t),function(t){this.setAttributeNS(s.space,s.local,e(t))})})}if(arguments.length<2){for(e in t)this.attr(e,t[e]);return this}var o="transform"==t?Zi:Ci,s=fo.ns.qualify(t);return eo(this,"attr."+t,e,s.local?a:r)},Fl.attrTween=function(t,e){function n(t,n){var i=e.call(this,t,n,this.getAttribute(r));return i&&function(t){this.setAttribute(r,i(t))}}function i(t,n){var i=e.call(this,t,n,this.getAttributeNS(r.space,r.local));return i&&function(t){this.setAttributeNS(r.space,r.local,i(t))}}var r=fo.ns.qualify(t);return this.tween("attr."+t,r.local?i:n)},Fl.style=function(t,e,n){function i(){this.style.removeProperty(t)}function r(e){return null==e?i:(e+="",function(){var i,r=o(this).getComputedStyle(this,null).getPropertyValue(t);return r!==e&&(i=Ci(r,e),function(e){this.style.setProperty(t,i(e),n)})})}var a=arguments.length;if(a<3){if("string"!=typeof t){a<2&&(e="");for(n in t)this.style(n,t[n],e);return this}n=""}return eo(this,"style."+t,e,r)},Fl.styleTween=function(t,e,n){function i(i,r){var a=e.call(this,i,r,o(this).getComputedStyle(this,null).getPropertyValue(t));return a&&function(e){this.style.setProperty(t,a(e),n)}}return arguments.length<3&&(n=""),this.tween("style."+t,i)},Fl.text=function(t){return eo(this,"text",t,no)},Fl.remove=function(){var t=this.namespace;return this.each("end.transition",function(){var e;this[t].count<2&&(e=this.parentNode)&&e.removeChild(this)})},Fl.ease=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].ease:("function"!=typeof t&&(t=fo.ease.apply(fo,arguments)),X(this,function(i){i[n][e].ease=t}))},Fl.delay=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].delay:X(this,"function"==typeof t?function(i,r,a){i[n][e].delay=+t.call(i,i.__data__,r,a)}:(t=+t,function(i){i[n][e].delay=t}))},Fl.duration=function(t){var e=this.id,n=this.namespace;return arguments.length<1?this.node()[n][e].duration:X(this,"function"==typeof t?function(i,r,a){i[n][e].duration=Math.max(1,t.call(i,i.__data__,r,a))}:(t=Math.max(1,t),function(i){i[n][e].duration=t}))},Fl.each=function(t,e){var n=this.id,i=this.namespace;if(arguments.length<2){var r=Vl,a=Bl;try{Bl=n,X(this,function(e,r,a){Vl=e[i][n],t.call(e,e.__data__,r,a)})}finally{Vl=r,Bl=a}}else X(this,function(r){var a=r[i][n];(a.event||(a.event=fo.dispatch("start","end","interrupt"))).on(t,e)});return this},Fl.transition=function(){for(var t,e,n,i,r=this.id,a=++Gl,o=this.namespace,s=[],l=0,u=this.length;l<u;l++){s.push(t=[]);for(var e=this[l],c=0,h=e.length;c<h;c++)(n=e[c])&&(i=n[o][r],ro(n,c,o,a,{time:i.time,ease:i.ease,delay:i.delay+i.duration,duration:i.duration})),t.push(n)}return to(s,o,a)},fo.svg.axis=function(){function t(t){t.each(function(){var t,u=fo.select(this),c=this.__chart__||n,h=this.__chart__=n.copy(),d=null==l?h.ticks?h.ticks.apply(h,s):h.domain():l,f=null==e?h.tickFormat?h.tickFormat.apply(h,s):k:e,p=u.selectAll(".tick").data(d,h),_=p.enter().insert("g",".domain").attr("class","tick").style("opacity",Io),g=fo.transition(p.exit()).style("opacity",Io).remove(),v=fo.transition(p.order()).style("opacity",1),m=Math.max(r,0)+o,y=Wr(h),b=u.selectAll(".domain").data([0]),w=(b.enter().append("path").attr("class","domain"),fo.transition(b));_.append("line"),_.append("text");var x,C,M,S,T=_.select("line"),$=v.select("line"),A=p.select("text").text(f),E=_.select("text"),O=v.select("text"),z="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(t=ao,x="x",M="y",C="x2",S="y2",A.attr("dy",z<0?"0em":".71em").style("text-anchor","middle"),w.attr("d","M"+y[0]+","+z*a+"V0H"+y[1]+"V"+z*a)):(t=oo,x="y",M="x",C="y2",S="x2",A.attr("dy",".32em").style("text-anchor",z<0?"end":"start"),w.attr("d","M"+z*a+","+y[0]+"H0V"+y[1]+"H"+z*a)),T.attr(S,z*r),E.attr(M,z*m),$.attr(C,0).attr(S,z*r),O.attr(x,0).attr(M,z*m),h.rangeBand){var R=h,N=R.rangeBand()/2;c=h=function(t){return R(t)+N}}else c.rangeBand?c=h:g.call(t,h,c);_.call(t,c,h),v.call(t,h,h)})}var e,n=fo.scale.linear(),i=Hl,r=6,a=6,o=3,s=[10],l=null;return t.scale=function(e){return arguments.length?(n=e,t):n},t.orient=function(e){return arguments.length?(i=e in Yl?e+"":Hl,t):i},t.ticks=function(){return arguments.length?(s=_o(arguments),t):s},t.tickValues=function(e){return arguments.length?(l=e,t):l},t.tickFormat=function(n){return arguments.length?(e=n,t):e},t.tickSize=function(e){var n=arguments.length;return n?(r=+e,a=+arguments[n-1],t):r},t.innerTickSize=function(e){return arguments.length?(r=+e,t):r},t.outerTickSize=function(e){return arguments.length?(a=+e,t):a},t.tickPadding=function(e){return arguments.length?(o=+e,t):o},t.tickSubdivide=function(){return arguments.length&&t},t};var Hl="bottom",Yl={top:1,right:1,bottom:1,left:1};fo.svg.brush=function(){function t(a){a.each(function(){var a=fo.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",r).on("touchstart.brush",r),o=a.selectAll(".background").data([0]);o.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),a.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var s=a.selectAll(".resize").data(_,k);s.exit().remove(),s.enter().append("g").attr("class",function(t){return"resize "+t}).style("cursor",function(t){return Xl[t]}).append("rect").attr("x",function(t){return/[ew]$/.test(t)?-3:null}).attr("y",function(t){return/^[ns]/.test(t)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),s.style("display",t.empty()?"none":null);var l,h=fo.transition(a),d=fo.transition(o);u&&(l=Wr(u),d.attr("x",l[0]).attr("width",l[1]-l[0]),n(h)),c&&(l=Wr(c),d.attr("y",l[0]).attr("height",l[1]-l[0]),i(h)),e(h)})}function e(t){t.selectAll(".resize").attr("transform",function(t){return"translate("+h[+/e$/.test(t)]+","+d[+/^s/.test(t)]+")"})}function n(t){t.select(".extent").attr("x",h[0]),t.selectAll(".extent,.n>rect,.s>rect").attr("width",h[1]-h[0])}function i(t){t.select(".extent").attr("y",d[0]),t.selectAll(".extent,.e>rect,.w>rect").attr("height",d[1]-d[0])}function r(){function r(){32==fo.event.keyCode&&($||(y=null,O[0]-=h[1],O[1]-=d[1],$=2),A())}function _(){32==fo.event.keyCode&&2==$&&(O[0]+=h[1],O[1]+=d[1],$=0,A())}function g(){var t=fo.mouse(w),r=!1;b&&(t[0]+=b[0],t[1]+=b[1]),$||(fo.event.altKey?(y||(y=[(h[0]+h[1])/2,(d[0]+d[1])/2]),O[0]=h[+(t[0]<y[0])],O[1]=d[+(t[1]<y[1])]):y=null),S&&v(t,u,0)&&(n(C),r=!0),T&&v(t,c,1)&&(i(C),r=!0),r&&(e(C),k({type:"brush",mode:$?"move":"resize"}))}function v(t,e,n){var i,r,o=Wr(e),l=o[0],u=o[1],c=O[n],_=n?d:h,g=_[1]-_[0];if($&&(l-=c,u-=g+c),i=(n?p:f)?Math.max(l,Math.min(u,t[n])):t[n],$?r=(i+=c)+g:(y&&(c=Math.max(l,Math.min(u,2*y[n]-i))),c<i?(r=i,i=c):r=c),_[0]!=i||_[1]!=r)return n?s=null:a=null,_[0]=i,_[1]=r,!0}function m(){g(),C.style("pointer-events","all").selectAll(".resize").style("display",t.empty()?"none":null),fo.select("body").style("cursor",null),z.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),E(),k({type:"brushend"})}var y,b,w=this,x=fo.select(fo.event.target),k=l.of(w,arguments),C=fo.select(w),M=x.datum(),S=!/^(n|s)$/.test(M)&&u,T=!/^(e|w)$/.test(M)&&c,$=x.classed("extent"),E=tt(w),O=fo.mouse(w),z=fo.select(o(w)).on("keydown.brush",r).on("keyup.brush",_);if(fo.event.changedTouches?z.on("touchmove.brush",g).on("touchend.brush",m):z.on("mousemove.brush",g).on("mouseup.brush",m),C.interrupt().selectAll("*").interrupt(),$)O[0]=h[0]-O[0],O[1]=d[0]-O[1];else if(M){var R=+/w$/.test(M),N=+/^n/.test(M);b=[h[1-R]-O[0],d[1-N]-O[1]],O[0]=h[R],O[1]=d[N]}else fo.event.altKey&&(y=O.slice());C.style("pointer-events","none").selectAll(".resize").style("display",null),fo.select("body").style("cursor",x.style("cursor")),k({type:"brushstart"}),g()}var a,s,l=O(t,"brushstart","brush","brushend"),u=null,c=null,h=[0,0],d=[0,0],f=!0,p=!0,_=Wl[0];return t.event=function(t){t.each(function(){var t=l.of(this,arguments),e={x:h,y:d,i:a,j:s},n=this.__chart__||e;this.__chart__=e,Bl?fo.select(this).transition().each("start.brush",function(){a=n.i,s=n.j,h=n.x,d=n.y,t({type:"brushstart"})}).tween("brush:brush",function(){var n=Mi(h,e.x),i=Mi(d,e.y);return a=s=null,function(r){h=e.x=n(r),d=e.y=i(r),t({type:"brush",mode:"resize"})}}).each("end.brush",function(){a=e.i,s=e.j,t({type:"brush",mode:"resize"}),t({type:"brushend"})}):(t({type:"brushstart"}),t({type:"brush",mode:"resize"}),t({type:"brushend"}))})},t.x=function(e){return arguments.length?(u=e,_=Wl[!u<<1|!c],t):u},t.y=function(e){return arguments.length?(c=e,_=Wl[!u<<1|!c],t):c},t.clamp=function(e){return arguments.length?(u&&c?(f=!!e[0],p=!!e[1]):u?f=!!e:c&&(p=!!e),t):u&&c?[f,p]:u?f:c?p:null},t.extent=function(e){var n,i,r,o,l;return arguments.length?(u&&(n=e[0],i=e[1],c&&(n=n[0],i=i[0]),a=[n,i],u.invert&&(n=u(n),i=u(i)),i<n&&(l=n,n=i,i=l),n==h[0]&&i==h[1]||(h=[n,i])),c&&(r=e[0],o=e[1],u&&(r=r[1],o=o[1]),s=[r,o],c.invert&&(r=c(r),o=c(o)),o<r&&(l=r,r=o,o=l),r==d[0]&&o==d[1]||(d=[r,o])),t):(u&&(a?(n=a[0],i=a[1]):(n=h[0],i=h[1],u.invert&&(n=u.invert(n),i=u.invert(i)),i<n&&(l=n,n=i,i=l))),c&&(s?(r=s[0],o=s[1]):(r=d[0],o=d[1],c.invert&&(r=c.invert(r),o=c.invert(o)),o<r&&(l=r,r=o,o=l))),u&&c?[[n,r],[i,o]]:u?[n,i]:c&&[r,o])},t.clear=function(){return t.empty()||(h=[0,0],d=[0,0],a=s=null),t},t.empty=function(){return!!u&&h[0]==h[1]||!!c&&d[0]==d[1]},fo.rebind(t,l,"on")};var Xl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},Wl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],Jl=_s.format=ws.timeFormat,Kl=Jl.utc,Zl=Kl("%Y-%m-%dT%H:%M:%S.%LZ");Jl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?so:Zl,so.parse=function(t){var e=new Date(t);return isNaN(e)?null:e},so.toString=Zl.toString,_s.second=Gt(function(t){return new gs(1e3*Math.floor(t/1e3))},function(t,e){t.setTime(t.getTime()+1e3*Math.floor(e))},function(t){return t.getSeconds()}),_s.seconds=_s.second.range,_s.seconds.utc=_s.second.utc.range,_s.minute=Gt(function(t){return new gs(6e4*Math.floor(t/6e4))},function(t,e){t.setTime(t.getTime()+6e4*Math.floor(e))},function(t){return t.getMinutes()}),_s.minutes=_s.minute.range,_s.minutes.utc=_s.minute.utc.range,_s.hour=Gt(function(t){var e=t.getTimezoneOffset()/60;return new gs(36e5*(Math.floor(t/36e5-e)+e))},function(t,e){t.setTime(t.getTime()+36e5*Math.floor(e))},function(t){return t.getHours()}),_s.hours=_s.hour.range,_s.hours.utc=_s.hour.utc.range,_s.month=Gt(function(t){return t=_s.day(t),t.setDate(1),t},function(t,e){t.setMonth(t.getMonth()+e)},function(t){return t.getMonth()}),_s.months=_s.month.range,_s.months.utc=_s.month.utc.range;var Ql=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],tu=[[_s.second,1],[_s.second,5],[_s.second,15],[_s.second,30],[_s.minute,1],[_s.minute,5],[_s.minute,15],[_s.minute,30],[_s.hour,1],[_s.hour,3],[_s.hour,6],[_s.hour,12],[_s.day,1],[_s.day,2],[_s.week,1],[_s.month,1],[_s.month,3],[_s.year,1]],eu=Jl.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%I:%M",function(t){return t.getMinutes()}],["%I %p",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",Ne]]),nu={range:function(t,e,n){return fo.range(Math.ceil(t/n)*n,+e,n).map(uo)},floor:k,ceil:k};tu.year=_s.year,_s.scale=function(){return lo(fo.scale.linear(),tu,eu)};var iu=tu.map(function(t){return[t[0].utc,t[1]]}),ru=Kl.multi([[".%L",function(t){return t.getUTCMilliseconds()}],[":%S",function(t){return t.getUTCSeconds()}],["%I:%M",function(t){return t.getUTCMinutes()}],["%I %p",function(t){return t.getUTCHours()}],["%a %d",function(t){return t.getUTCDay()&&1!=t.getUTCDate()}],["%b %d",function(t){return 1!=t.getUTCDate()}],["%B",function(t){return t.getUTCMonth()}],["%Y",Ne]]);iu.year=_s.year.utc,_s.scale.utc=function(){return lo(fo.scale.linear(),iu,ru)},fo.text=zt(function(t){return t.responseText}),fo.json=function(t,e){return Rt(t,"application/json",co,e)},fo.html=function(t,e){return Rt(t,"text/html",ho,e)},fo.xml=zt(function(t){return t.responseXML}),this.d3=fo,i=fo,void 0!==(r="function"==typeof i?i.call(e,n,e,t):i)&&(t.exports=r)}()}],[290]);