webpackJsonp([0],[,,,,function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=(s(o),i(22)),l=s(r),d=i(46),c=s(d),u=i(23),h=s(u),f=i(47),p=s(f),m=i(12),_=s(m),g=i(9),v=s(g),w=e.View.extend({tagName:"label",initialize:function(t){this.model=t&&t.model||new e.Model(t),this.tagName=t.tagName||this.tagName,this.setElement(n("<"+this.tagName+"/>")),this.listenTo(this.model,"change",this.render,this),this.render()},title:function(e){this.model.set("title",e)},value:function(){return this.model.get("title")},render:function(){return this.$el.removeClass().addClass("ui-label").addClass(this.model.get("cls")).html(this.model.get("title")),this}}),b=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model({message:null,status:"info",cls:"",persistent:!1,fade:!0}).set(t),this.listenTo(this.model,"change",this.render,this),this.render()},update:function(e){this.model.set(e)},render:function(){this.$el.removeClass().addClass("ui-message").addClass(this.model.get("cls"));var e=this.model.get("status");if(this.model.get("large")?this.$el.addClass(("success"==e&&"done"||"danger"==e&&"error"||e)+"messagelarge"):this.$el.addClass("alert").addClass("alert-"+e),this.model.get("message")){if(this.$el.html(this.messageForDisplay()),this.$el[this.model.get("fade")?"fadeIn":"show"](),this.timeout&&window.clearTimeout(this.timeout),!this.model.get("persistent")){var t=this;this.timeout=window.setTimeout(function(){t.model.set("message","")},3e3)}}else this.$el.fadeOut();return this},messageForDisplay:function(){return a.escape(this.model.get("message"))}}),y=b.extend({messageForDisplay:function(){return this.model.get("message")}}),x=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model({type:"text",placeholder:"",disabled:!1,readonly:!1,visible:!0,cls:"",area:!1,color:null,style:null}).set(t),this.tagName=this.model.get("area")?"textarea":"input",this.setElement(n("<"+this.tagName+"/>")),this.listenTo(this.model,"change",this.render,this),this.render()},events:{input:"_onchange"},value:function(e){return void 0!==e&&this.model.set("value","string"==typeof e?e:""),this.model.get("value")},render:function(){var e=this;this.$el.removeClass().addClass("ui-"+this.tagName).addClass(this.model.get("cls")).addClass(this.model.get("style")).attr("id",this.model.id).attr("type",this.model.get("type")).attr("placeholder",this.model.get("placeholder")).css("color",this.model.get("color")||"").css("border-color",this.model.get("color")||"");var t=this.model.get("datalist");return n.isArray(t)&&t.length>0&&this.$el.autocomplete({source:function(t,i){i(e.model.get("datalist"))},change:function(){e._onchange()}}),this.model.get("value")!==this.$el.val()&&this.$el.val(this.model.get("value")),a.each(["readonly","disabled"],function(t){e.model.get(t)?e.$el.attr(t,!0):e.$el.removeAttr(t)}),this.$el[this.model.get("visible")?"show":"hide"](),this},_onchange:function(){this.value(this.$el.val()),this.model.get("onchange")&&this.model.get("onchange")(this.model.get("value"))}}),k=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model(t),this.setElement(n("<div/>").append(this.$info=n("<div/>")).append(this.$hidden=n("<div/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},value:function(e){return void 0!==e&&this.model.set("value",e),this.model.get("value")},render:function(){return this.$el.attr("id",this.model.id),this.$hidden.val(this.model.get("value")),this.model.get("info")?this.$info.show().text(this.model.get("info")):this.$info.hide(),this}}),C=e.View.extend({initialize:function(t){var i=this;this.model=t&&t.model||new e.Model(t),this.setElement(n("<div/>").append(this.$info=n("<div/>")).append(this.$file=n("<input/>").attr("type","file").addClass("ui-margin-bottom")).append(this.$text=n("<textarea/>").addClass("ui-textarea").attr("disabled",!0)).append(this.$wait=n("<i/>").addClass("fa fa-spinner fa-spin"))),this.listenTo(this.model,"change",this.render,this),this.$file.on("change",function(e){i._readFile(e)}),this.render()},value:function(e){return void 0!==e&&this.model.set("value",e),this.model.get("value")},render:function(){return this.$el.attr("id",this.model.id),this.model.get("info")?this.$info.show().text(this.model.get("info")):this.$info.hide(),this.model.get("value")?this.$text.text(this.model.get("value")).show():this.$text.hide(),this.model.get("wait")?this.$wait.show():this.$wait.hide(),this},_readFile:function(e){var t=this,i=e.target.files&&e.target.files[0];if(i){var n=new FileReader;n.onload=function(){t.model.set({wait:!1,value:this.result})},this.model.set({wait:!0,value:null}),n.readAsText(i)}}});t.default={Button:_.default.ButtonDefault,ButtonIcon:_.default.ButtonIcon,ButtonCheck:_.default.ButtonCheck,ButtonMenu:_.default.ButtonMenu,ButtonLink:_.default.ButtonLink,Input:x,Label:w,Message:b,UnescapedMessage:y,Upload:C,Modal:v.default,RadioButton:h.default.RadioButton,Checkbox:h.default.Checkbox,Radio:h.default.Radio,Select:l.default,Hidden:k,Slider:c.default,Drilldown:p.default}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";function n(e){return"[object Array]"===C.call(e)}function a(e){return"[object ArrayBuffer]"===C.call(e)}function s(e){return"undefined"!=typeof FormData&&e instanceof FormData}function o(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer}function r(e){return"string"==typeof e}function l(e){return"number"==typeof e}function d(e){return void 0===e}function c(e){return null!==e&&"object"==typeof e}function u(e){return"[object Date]"===C.call(e)}function h(e){return"[object File]"===C.call(e)}function f(e){return"[object Blob]"===C.call(e)}function p(e){return"[object Function]"===C.call(e)}function m(e){return c(e)&&p(e.pipe)}function _(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams}function g(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}function v(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)}function w(e,t){if(null!==e&&void 0!==e)if("object"==typeof e||n(e)||(e=[e]),n(e))for(var i=0,a=e.length;i<a;i++)t.call(null,e[i],i,e);else for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.call(null,e[s],s,e)}function b(){function e(e,i){"object"==typeof t[i]&&"object"==typeof e?t[i]=b(t[i],e):t[i]=e}for(var t={},i=0,n=arguments.length;i<n;i++)w(arguments[i],e);return t}function y(e,t,i){return w(t,function(t,n){e[n]=i&&"function"==typeof t?x(t,i):t}),e}var x=i(27),k=i(74),C=Object.prototype.toString;e.exports={isArray:n,isArrayBuffer:a,isBuffer:k,isFormData:s,isArrayBufferView:o,isString:r,isNumber:l,isObject:c,isUndefined:d,isDate:u,isFile:h,isBlob:f,isFunction:p,isStream:m,isURLSearchParams:_,isStandardBrowserEnv:v,forEach:w,merge:b,extend:y,trim:g}},function(e,t,i){"use strict";function n(e,t){return function(i){if(e.hasOwnProperty(i))return e[i];if(!t)throw new Error("I do not know how to modify the following string: "+i+". Change your TeX file or submit a feature request at https://github.com/digitalheir/tex-to-unicode/issues.");return i+t}}Object.defineProperty(t,"__esModule",{value:!0}),t.lookupOrAppend=n},,function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function s(e,t){var i=Array.prototype.slice.call(arguments,0),n=i.pop();return i.unshift(n),d.defaults.apply(d,i)}function o(e,t){t=t||"model";var i=d.template(e.join(""));return function(e,n){var a={view:n||{},_l:m.default};return a[t]=e||{},i(a)}}function r(e,t){t=t||{};var i=t.ascending?1:-1;return function(t,n){return t=t.get(e),n=n.get(e),(t<n?-1:t>n?1:0)*i}}Object.defineProperty(t,"__esModule",{value:!0});var l=i(2),d=a(l),c=i(1),u=a(c),h=i(59),f=n(h),p=i(7),m=n(p),_={logger:null,_logNamespace:"."};(0,f.default)(_);var g=u.Model.extend({initialize:function(e){if(this._checkEnabledSessionStorage(),!e.id)throw new Error("SessionStorageModel requires an id in the initial attributes");this.id=e.id;var t=this.isNew()?{}:this._read(this);this.clear({silent:!0}),this.save(d.extend({},this.defaults,t,e),{silent:!0}),this.on("change",function(){this.save()})},_checkEnabledSessionStorage:function(){try{return window.sessionStorage.length>=0}catch(e){return alert("Please enable cookies in your browser for this Galaxy site"),!1}},sync:function(e,t,i){i.silent||t.trigger("request",t,{},i);var n={};switch(e){case"create":n=this._create(t);break;case"read":n=this._read(t);break;case"update":n=this._update(t);break;case"delete":n=this._delete(t)}return void 0!==n||null!==n?i.success&&i.success():i.error&&i.error(),n},_create:function(e){try{var t=e.toJSON(),i=sessionStorage.setItem(e.id,JSON.stringify(t));return null===i?i:t}catch(e){if(!(e instanceof DOMException&&navigator.userAgent.indexOf("Safari")>-1))throw e}return null},_read:function(e){return JSON.parse(sessionStorage.getItem(e.id))},_update:function(e){return e._create(e)},_delete:function(e){return sessionStorage.removeItem(e.id)},isNew:function(){return!sessionStorage.hasOwnProperty(this.id)},_log:function(){return JSON.stringify(this.toJSON(),null,"  ")},toString:function(){return"SessionStorageModel("+this.id+")"}});!function(){g.prototype=d.omit(g.prototype,"url","urlRoot")}();var v={searchAttributes:[],searchAliases:{},searchAttribute:function(e,t){var i=this.get(e);return!(!t||void 0===i||null===i)&&(d.isArray(i)?this._searchArrayAttribute(i,t):-1!==i.toString().toLowerCase().indexOf(t.toLowerCase()))},_searchArrayAttribute:function(e,t){return t=t.toLowerCase(),d.any(e,function(e){return-1!==e.toString().toLowerCase().indexOf(t.toLowerCase())})},search:function(e){var t=this;return d.filter(this.searchAttributes,function(i){return t.searchAttribute(i,e)})},matches:function(e){var t=e.split("=");if(t.length>=2){var i=t[0];return i=this.searchAliases[i]||i,this.searchAttribute(i,t[1])}return!!this.search(e).length},matchesAll:function(e){var t=this;return e=e.match(/(".*"|\w*=".*"|\S*)/g).filter(function(e){return!!e}),d.all(e,function(e){return e=e.replace(/"/g,""),t.matches(e)})}},w={hiddenUntilActivated:function(t,i){if(i=i||{},this.HUAVOptions={$elementShown:this.$el,showFn:e.prototype.toggle,showSpeed:"fast"},d.extend(this.HUAVOptions,i||{}),this.HUAVOptions.hasBeenShown=this.HUAVOptions.$elementShown.is(":visible"),this.hidden=this.isHidden(),t){var n=this;t.on("click",function(e){n.toggle(n.HUAVOptions.showSpeed)})}},isHidden:function(){return this.HUAVOptions.$elementShown.is(":hidden")},toggle:function(){return this.hidden?(this.HUAVOptions.hasBeenShown||d.isFunction(this.HUAVOptions.onshowFirstTime)&&(this.HUAVOptions.hasBeenShown=!0,this.HUAVOptions.onshowFirstTime.call(this)),d.isFunction(this.HUAVOptions.onshow)&&(this.HUAVOptions.onshow.call(this),this.trigger("hiddenUntilActivated:shown",this)),this.hidden=!1):(d.isFunction(this.HUAVOptions.onhide)&&(this.HUAVOptions.onhide.call(this),this.trigger("hiddenUntilActivated:hidden",this)),this.hidden=!0),this.HUAVOptions.showFn.apply(this.HUAVOptions.$elementShown,arguments)}},b={initialize:function(e){this.draggable=e.draggable||!1},$dragHandle:function(){return this.$(".title-bar")},toggleDraggable:function(){this.draggable?this.draggableOff():this.draggableOn()},draggableOn:function(){this.draggable=!0,this.dragStartHandler=d.bind(this._dragStartHandler,this),this.dragEndHandler=d.bind(this._dragEndHandler,this);var e=this.$dragHandle().attr("draggable",!0).get(0);e.addEventListener("dragstart",this.dragStartHandler,!1),e.addEventListener("dragend",this.dragEndHandler,!1)},draggableOff:function(){this.draggable=!1;var e=this.$dragHandle().attr("draggable",!1).get(0);e.removeEventListener("dragstart",this.dragStartHandler,!1),e.removeEventListener("dragend",this.dragEndHandler,!1)},_dragStartHandler:function(e){return e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text",JSON.stringify(this.model.toJSON())),this.trigger("draggable:dragstart",e,this),!1},_dragEndHandler:function(e){return this.trigger("draggable:dragend",e,this),!1}},y={initialize:function(e){this.selectable=e.selectable||!1,this.selected=e.selected||!1},$selector:function(){return this.$(".selector")},_renderSelected:function(){this.$selector().find("span").toggleClass("fa-check-square-o",this.selected).toggleClass("fa-square-o",!this.selected)},toggleSelector:function(){this.$selector().is(":visible")?this.hideSelector():this.showSelector()},showSelector:function(e){e=void 0!==e?e:this.fxSpeed,this.selectable=!0,this.trigger("selectable",!0,this),this._renderSelected(),e?this.$selector().show(e):this.$selector().show()},hideSelector:function(e){e=void 0!==e?e:this.fxSpeed,this.selectable=!1,this.trigger("selectable",!1,this),e?this.$selector().hide(e):this.$selector().hide()},toggleSelect:function(e){this.selected?this.deselect(e):this.select(e)},select:function(e){return this.selected||(this.trigger("selected",this,e),this.selected=!0,this._renderSelected()),!1},deselect:function(e){return this.selected&&(this.trigger("de-selected",this,e),this.selected=!1,this._renderSelected()),!1}};t.default={LoggableMixin:_,SessionStorageModel:g,mixin:s,SearchableModelMixin:v,HiddenUntilActivatedViewMixin:w,DraggableViewMixin:b,SelectableViewMixin:y,wrapTemplate:o,buildComparator:r}}).call(t,i(0))},function(e,t,i){"use strict";(function(e,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=e.View.extend({className:"ui-modal",optionsDefault:{container:"body",title:"ui-modal",cls:"ui-modal",body:"",backdrop:!0,height:null,width:null,closing_events:!1,closing_callback:null,title_separator:!0},buttonList:{},initialize:function(e){this.options=i.defaults(e||{},this.optionsDefault),n(this.options.container).prepend(this.el),e&&this.render()},show:function(e){if(e&&(this.options=i.defaults(e,this.optionsDefault),this.render()),!this.visible&&(this.visible=!0,this.$el.fadeIn("fast"),this.options.closing_events)){var t=this;n(document).on("keyup.ui-modal",function(e){27==e.keyCode&&t.hide(!0)}),this.$backdrop.on("click",function(){t.hide(!0)})}},hide:function(e){this.visible=!1,this.$el.fadeOut("fast"),this.options.closing_callback&&this.options.closing_callback(e),n(document).off("keyup.ui-modal"),this.$backdrop.off("click")},render:function(){var e=this;if(this.$el.html(this._template()),this.$header=this.$(".modal-header"),this.$dialog=this.$(".modal-dialog"),this.$body=this.$(".modal-body"),this.$footer=this.$(".modal-footer"),this.$backdrop=this.$(".modal-backdrop"),this.$buttons=this.$(".buttons"),"progress"==this.options.body&&(this.options.body=n('<div class="progress progress-striped active"><div class="progress-bar progress-bar-info" style="width:100%"/></div>')),this.$el.removeClass().addClass("modal").addClass(this.options.cls),this.$header.find(".title").html(this.options.title),this.$body.html(this.options.body),this.$buttons.empty(),this.buttonList={},this.options.buttons){var t=0;n.each(this.options.buttons,function(i,a){var s=n("<button/>").attr("id","button-"+t++).text(i).click(a);e.$buttons.append(s).append("&nbsp;"),e.buttonList[i]=s})}else this.$footer.hide();this.$backdrop[this.options.backdrop&&"addClass"||"removeClass"]("in"),this.$header[!this.options.title_separator&&"addClass"||"removeClass"]("no-separator"),this.$body.removeAttr("style"),this.options.height?(this.$body.css("height",this.options.height),this.$body.css("overflow","hidden")):this.$body.css("max-height",n(window).height()/2),this.options.width&&this.$dialog.css("width",this.options.width)},getButton:function(e){return this.buttonList[e]},enableButton:function(e){this.getButton(e).prop("disabled",!1)},disableButton:function(e){this.getButton(e).prop("disabled",!0)},showButton:function(e){this.getButton(e).show()},hideButton:function(e){this.getButton(e).hide()},scrollTop:function(){return this.$body.scrollTop()},_template:function(){return'<div class="modal-backdrop fade"/><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="title"/></div><div class="modal-body"/><div class="modal-footer"><div class="buttons"/></div></div></div>'}});t.default={View:a}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";function n(e){return"("+e+")"}Object.defineProperty(t,"__esModule",{value:!0}),t.simpleSuffix=function(e){return function(t){return t+e}},t.isSingleTerm=/^.$|^[0-9]+$/,t.addParenthesis=n},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(4),d=s(l),c=e.View.extend({visible:!1,initialize:function(t){var i=this;this.model=t&&t.model||new e.Model({id:r.default.uid(),cls:"ui-portlet",title:"",icon:"",buttons:null,body:null,scrollable:!0,nopadding:!1,operations:null,collapsible:!1,collapsible_button:!1,collapsed:!1,onchange_title:null}).set(t),this.setElement(this._template()),this.$body=this.$(".portlet-body"),this.$title_text=this.$(".portlet-title-text"),this.$title_icon=this.$(".portlet-title-icon"),this.$header=this.$(".portlet-header"),this.$content=this.$(".portlet-content"),this.$backdrop=this.$(".portlet-backdrop"),this.$buttons=this.$(".portlet-buttons"),this.$operations=this.$(".portlet-operations"),this.model.get("body")&&this.append(this.model.get("body")),this.collapsible_button=new d.default.ButtonIcon({icon:"fa-eye",tooltip:"Collapse/Expand",cls:"ui-button-icon-plain",onclick:function(){i[i.collapsed?"expand":"collapse"]()}}),this.render()},render:function(){var e=this,t=this.model.attributes;return this.$el.removeClass().addClass(t.cls).attr("id",t.id),this.$header[t.title?"show":"hide"](),this.$title_text.html(t.title),n.each([this.$content,this.$body],function(e){e[t.nopadding?"addClass":"removeClass"]("no-padding")}),t.icon?this.$title_icon.removeClass().addClass("portlet-title-icon fa").addClass(t.icon).show():this.$title_icon.hide(),this.$title_text[t.collapsible?"addClass":"removeClass"]("no-highlight collapsible").off(),t.collapsible&&(this.$title_text.on("click",function(){e[e.collapsed?"expand":"collapse"]()}),t.collapsed?this.collapse():this.expand()),this.$title_text.prop("disabled",!t.onchange_title),t.onchange_title&&this.$title_text.make_text_editable({on_finish:function(e){t.onchange_title(e)}}),t.buttons?(this.$buttons.empty().show(),a.each(this.model.get("buttons"),function(t,i){i.$el.prop("id",t),e.$buttons.append(i.$el)})):this.$buttons.hide(),this.$operations.empty,t.collapsible_button&&this.$operations.append(this.collapsible_button.$el),t.operations&&a.each(t.operations,function(t,i){i.$el.prop("id",t),e.$operations.append(i.$el)}),this},append:function(e){this.$body.append(e)},empty:function(){this.$body.empty()},header:function(){return this.$header},body:function(){return this.$body},show:function(){this.visible=!0,this.$el.fadeIn("fast")},hide:function(){this.visible=!1,this.$el.hide()},enableButton:function(e){this.$buttons.find("#"+e).prop("disabled",!1)},disableButton:function(e){this.$buttons.find("#"+e).prop("disabled",!0)},hideOperation:function(e){this.$operations.find("#"+e).hide()},showOperation:function(e){this.$operations.find("#"+e).show()},setOperation:function(e,t){this.$operations.find("#"+e).off("click").on("click",t)},title:function(e){return e&&this.$title_text.html(e),this.$title_text.html()},collapse:function(){this.collapsed=!0,this.$content.height("0%"),this.$body.hide(),this.collapsible_button.setIcon("fa-eye-slash")},expand:function(){this.collapsed=!1,this.$content.height("100%"),this.$body.fadeIn("fast"),this.collapsible_button.setIcon("fa-eye")},disable:function(){this.$backdrop.show()},enable:function(){this.$backdrop.hide()},_template:function(){return a("<div/>").append(a("<div/>").addClass("portlet-header").append(a("<div/>").addClass("portlet-operations")).append(a("<div/>").addClass("portlet-title").append(a("<i/>").addClass("portlet-title-icon")).append(a("<span/>").addClass("portlet-title-text")))).append(a("<div/>").addClass("portlet-content").append(a("<div/>").addClass("portlet-body")).append(a("<div/>").addClass("portlet-buttons"))).append(a("<div/>").addClass("portlet-backdrop"))}});t.default={View:c}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model({id:s.default.uid(),title:"",icon:"",cls:"btn btn-default",wait:!1,wait_text:"Sending...",wait_cls:"btn btn-info",disabled:!1,percentage:-1}).set(t),this.setElement(n("<button/>").attr("type","button").append(this.$icon=n("<i/>")).append(this.$title=n("<span/>")).append(this.$progress=n("<div/>").append(this.$progress_bar=n("<div/>")))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var e=this,t=this.model.attributes;this.$el.removeClass().addClass("ui-button-default").addClass(t.disabled&&"disabled").attr("id",t.id).attr("disabled",t.disabled).off("click").on("click",function(){n(".tooltip").hide(),t.onclick&&!e.disabled&&t.onclick()}).tooltip({title:t.tooltip,placement:"bottom"}),this.$progress.addClass("progress").css("display",-1!==t.percentage?"block":"none"),this.$progress_bar.addClass("progress-bar").css({width:t.percentage+"%"}),this.$icon.removeClass().addClass("icon fa"),this.$title.removeClass().addClass("title"),t.wait?(this.$el.addClass(t.wait_cls).prop("disabled",!0),this.$icon.addClass("fa-spinner fa-spin ui-margin-right"),this.$title.html(t.wait_text)):(this.$el.addClass(t.cls),this.$icon.addClass(t.icon),this.$title.html(t.title),t.icon&&t.title&&this.$icon.addClass("ui-margin-right"))},show:function(){this.$el.show()},hide:function(){this.$el.hide()},disable:function(){this.model.set("disabled",!0)},enable:function(){this.model.set("disabled",!1)},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},setIcon:function(e){this.model.set("icon",e)}}),r=o.extend({initialize:function(t){this.model=t&&t.model||new e.Model({id:s.default.uid(),title:"",icon:"",cls:""}).set(t),this.setElement(n("<a/>").append(this.$icon=n("<span/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var e=this.model.attributes;this.$el.removeClass().addClass(e.cls).attr({id:e.id,href:e.href||"javascript:void(0)",title:e.title,target:e.target||"_top",disabled:e.disabled}).tooltip({placement:"bottom"}).off("click").on("click",function(){e.onclick&&!e.disabled&&e.onclick()}),this.$icon.removeClass().addClass(e.icon)}}),l=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model({id:s.default.uid(),title:"Select/Unselect all",icons:["fa-square-o","fa-minus-square-o","fa-check-square-o"],value:0,onchange:function(){}}).set(t),this.setElement(n("<div/>").append(this.$icon=n("<span/>")).append(this.$title=n("<span/>"))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(e){var t=this,e=this.model.attributes;this.$el.addClass("ui-button-check").off("click").on("click",function(){t.model.set("value",0===t.model.get("value")&&2||0),e.onclick&&e.onclick()}),this.$title.html(e.title),this.$icon.removeClass().addClass("icon fa ui-margin-right").addClass(e.icons[e.value])},value:function(e,t){return void 0!==e&&(t&&0!==e&&(e=e!==t&&1||2),this.model.set("value",e),this.model.get("onchange")(this.model.get("value"))),this.model.get("value")}}),d=o.extend({initialize:function(t){this.model=t&&t.model||new e.Model({id:s.default.uid(),title:"",icon:"",cls:"ui-button-icon",disabled:!1}).set(t),this.setElement(n("<div/>").append(this.$button=n("<div/>").append(this.$icon=n("<i/>")).append(this.$title=n("<span/>")))),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(e){var e=this.model.attributes;this.$el.removeClass().addClass(e.cls).addClass(e.disabled&&"disabled").attr("disabled",e.disabled).attr("id",e.id).off("click").on("click",function(){n(".tooltip").hide(),!e.disabled&&e.onclick&&e.onclick()}),this.$button.addClass("button").tooltip({title:e.tooltip,placement:"bottom"}),this.$icon.removeClass().addClass("icon fa").addClass(e.icon),this.$title.addClass("title").html(e.title),e.icon&&e.title&&this.$icon.addClass("ui-margin-right")}}),c=o.extend({$menu:null,initialize:function(t){this.model=t&&t.model||new e.Model({id:"",title:"",pull:"right",icon:null,onclick:null,cls:"ui-button-icon ui-button-menu",tooltip:"",target:"",href:"",onunload:null,visible:!0,tag:""}).set(t),this.collection=new e.Collection,this.setElement(n("<div/>").append(this.$root=n("<div/>").append(this.$icon=n("<i/>")).append(this.$title=n("<span/>")))),this.listenTo(this.model,"change",this.render,this),this.listenTo(this.collection,"change add remove reset",this.render,this),this.render()},render:function(){var e=this,t=this.model.attributes;this.$el.removeClass().addClass("dropdown").addClass(t.cls).attr("id",t.id).css({display:t.visible&&this.collection.where({visible:!0}).length>0?"block":"none"}),this.$root.addClass("root button dropdown-toggle").attr("data-toggle","dropdown").tooltip({title:t.tooltip,placement:"bottom"}).off("click").on("click",function(e){n(".tooltip").hide(),e.preventDefault(),t.onclick&&t.onclick()}),this.$icon.removeClass().addClass("icon fa").addClass(t.icon),this.$title.removeClass().addClass("title").html(t.title),t.icon&&t.title&&this.$icon.addClass("ui-margin-right"),this.$menu&&this.$menu.remove(),this.collection.length>0&&(this.$menu=n("<ul/>").addClass("menu dropdown-menu").addClass("pull-"+e.model.get("pull")).attr("role","menu"),this.$el.append(this.$menu)),this.collection.each(function(t){var i=t.attributes;if(i.visible){var a=n("<a/>").addClass("dropdown-item").attr({href:i.href,target:i.target}).append(n("<i/>").addClass("fa").addClass(i.icon).css("display",i.icon?"inline-block":"none")).append(i.title).on("click",function(e){i.onclick&&(e.preventDefault(),i.onclick())});e.$menu.append(n("<li/>").append(a)),i.divider&&e.$menu.append(n("<li/>").addClass("divider"))}})},addMenu:function(e){this.collection.add(s.default.merge(e,{title:"",target:"",href:"",onclick:null,divider:!1,visible:!0,icon:null,cls:"button-menu btn-group"}))}});t.default={ButtonDefault:o,ButtonLink:r,ButtonIcon:d,ButtonCheck:l,ButtonMenu:c}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(s),r=i(15),l=a(r),d=i(14),c=a(d),u=i(21),h=a(u),f=i(26),p=a(f),m=i(68),_=a(m),g=i(4),v=(a(g),{toJSON:function(){var e=this,t={};return o.each(e.constructor.to_json_keys,function(i){var n=e.get(i);i in e.constructor.to_json_mappers&&(n=e.constructor.to_json_mappers[i](n,e)),t[i]=n}),t}}),w=function(t,i){var n=new p.default({url_base:Galaxy.root+"visualization/list_history_datasets",filters:t,dict_format:!0,embedded:!0}),a=new p.default({url_base:Galaxy.root+"visualization/list_library_datasets",dict_format:!0,embedded:!0}),s=new _.default.View;s.add({id:"histories",title:"Histories",$el:e("<div/>").append(n.$el)}),s.add({id:"libraries",title:"Libraries",$el:e("<div/>").append(a.$el)}),Galaxy.modal.show({title:"Select datasets for new tracks",body:s.$el,closing_events:!0,buttons:{Cancel:function(){Galaxy.modal.hide()},Add:function(){var t=[];s.$("input.grid-row-select-checkbox[name=id]:checked").each(function(){window.console.log(e(this).val()),t[t.length]=e.ajax({url:Galaxy.root+"api/datasets/"+e(this).val(),dataType:"json",data:{data_type:"track_config",hda_ldda:"histories"==s.current()?"hda":"ldda"}})}),e.when.apply(e,t).then(function(){var t=arguments[0]instanceof Array?e.map(arguments,function(e){return e[0]}):[arguments[0]];i(t)}),Galaxy.modal.hide()}}})},b=function(e){this.default_font=void 0!==e?e:"9px Monaco, Lucida Console, monospace",this.dummy_canvas=this.new_canvas(),this.dummy_context=this.dummy_canvas.getContext("2d"),this.dummy_context.font=this.default_font,this.char_width_px=this.dummy_context.measureText("A").width,this.patterns={},this.load_pattern("right_strand","/visualization/strand_right.png"),this.load_pattern("left_strand","/visualization/strand_left.png"),this.load_pattern("right_strand_inv","/visualization/strand_right_inv.png"),this.load_pattern("left_strand_inv","/visualization/strand_left_inv.png")};o.extend(b.prototype,{load_pattern:function(e,t){var i=this.patterns,n=this.dummy_context,a=new Image;a.src=Galaxy.root+"static/images"+t,a.onload=function(){i[e]=n.createPattern(a,"repeat")}},get_pattern:function(e){return this.patterns[e]},new_canvas:function(){var t=e("<canvas/>")[0];return t.manager=this,t}});var y=n.Model.extend({defaults:{num_elements:20,obj_cache:null,key_ary:null},initialize:function(e){this.clear()},get_elt:function(e){var t=this.attributes.obj_cache,i=this.attributes.key_ary,n=e.toString(),a=o.indexOf(i,function(e){return e.toString()===n});return-1!==a&&(t[n].stale?(i.splice(a,1),delete t[n]):this.move_key_to_end(e,a)),t[n]},set_elt:function(e,t){var i=this.attributes.obj_cache,n=this.attributes.key_ary,a=e.toString(),s=this.attributes.num_elements;if(!i[a]){if(n.length>=s){delete i[n.shift().toString()]}n.push(e)}return i[a]=t,t},move_key_to_end:function(e,t){this.attributes.key_ary.splice(t,1),this.attributes.key_ary.push(e)},clear:function(){this.attributes.obj_cache={},this.attributes.key_ary=[]},size:function(){return this.attributes.key_ary.length},most_recently_added:function(){return 0===this.size()?null:this.attributes.key_ary[this.attributes.key_ary.length-1]}}),x=y.extend({defaults:o.extend({},y.prototype.defaults,{dataset:null,genome:null,init_data:null,min_region_size:200,filters_manager:null,data_type:"data",data_mode_compatible:function(e,t){return!0},can_subset:function(e){return!1}}),initialize:function(e){y.prototype.initialize.call(this);var t=this.get("init_data");t&&this.add_data(t)},add_data:function(e){this.get("num_elements")<e.length&&this.set("num_elements",e.length);var t=this;o.each(e,function(e){t.set_data(e.region,e)})},data_is_ready:function(){var t=this.get("dataset"),i=e.Deferred(),n="raw_data"===this.get("data_type")?"state":"data"===this.get("data_type")?"converted_datasets_state":"error",a=new c.default.ServerStateDeferred({ajax_settings:{url:this.get("dataset").url(),data:{hda_ldda:t.get("hda_ldda"),data_type:n},dataType:"json"},interval:5e3,success_fn:function(e){return"pending"!==e}});return e.when(a.go()).then(function(e){i.resolve("ok"===e||"data"===e)}),i},search_features:function(t){var i=this.get("dataset"),n={query:t,hda_ldda:i.get("hda_ldda"),data_type:"features"};return e.getJSON(i.url(),n)},load_data:function(t,i,n,a){var s=this.get("dataset"),o={data_type:this.get("data_type"),chrom:t.get("chrom"),low:t.get("start"),high:t.get("end"),mode:i,resolution:n,hda_ldda:s.get("hda_ldda")};e.extend(o,a);var r=this.get("filters_manager");if(r){for(var l=[],d=r.filters,c=0;c<d.length;c++)l.push(d[c].name);o.filter_cols=JSON.stringify(l)}var u=this,h=e.getJSON(s.url(),o,function(e){e.region=t,u.set_data(t,e)});return this.set_data(t,h),h},get_data:function(e,t,i,n){var a=this.get_elt(e);if(a&&(c.default.is_deferred(a)||this.get("data_mode_compatible")(a,t)))return a;for(var s,o,r=this.get("key_ary"),l=this.get("obj_cache"),d=0;d<r.length;d++)if(s=r[d],s.contains(e)&&(o=!0,a=l[s.toString()],c.default.is_deferred(a)||this.get("data_mode_compatible")(a,t)&&this.get("can_subset")(a))){if(this.move_key_to_end(s,d),!c.default.is_deferred(a)){var u=this.subset_entry(a,e);this.set_data(e,u),a=u}return a}if(!o&&e.length()<this.attributes.min_region_size){e=e.copy();var h=this.most_recently_added();!h||e.get("start")>h.get("start")?e.set("end",e.get("start")+this.attributes.min_region_size):e.set("start",e.get("end")-this.attributes.min_region_size),e.set("genome",this.attributes.genome),e.trim()}return this.load_data(e,t,i,n)},set_data:function(e,t){this.set_elt(e,t)},DEEP_DATA_REQ:"deep",BROAD_DATA_REQ:"breadth",get_more_data:function(t,i,n,a,s){var o=this._mark_stale(t);if(!o||!this.get("data_mode_compatible")(o,i))return void console.log("ERROR: problem with getting more data: current data is not compatible");var r=t.get("start");s===this.DEEP_DATA_REQ?e.extend(a,{start_val:o.data.length+1}):s===this.BROAD_DATA_REQ&&(r=(o.max_high?o.max_high:o.data[o.data.length-1][2])+1);var l=t.copy().set("start",r),d=this,c=this.load_data(l,i,n,a),u=e.Deferred();return this.set_data(t,u),e.when(c).then(function(e){e.data&&(e.data=o.data.concat(e.data),e.max_low&&(e.max_low=o.max_low),e.message&&(e.message=e.message.replace(/[0-9]+/,e.data.length))),d.set_data(t,e),u.resolve(e)}),u},can_get_more_detailed_data:function(e){var t=this.get_elt(e);return"bigwig"===t.dataset_type&&t.data.length<8e3},get_more_detailed_data:function(e,t,i,n,a){var s=this._mark_stale(e);return s?(a||(a={}),"bigwig"===s.dataset_type&&(a.num_samples=1e3*n),this.load_data(e,t,i,a)):void console.log("ERROR getting more detailed data: no current data")},_mark_stale:function(e){var t=this.get_elt(e);return t||console.log("ERROR: no data to mark as stale: ",this.get("dataset"),e.toString()),t.stale=!0,t},get_genome_wide_data:function(t){var i=this,n=!0,a=o.map(t.get("chroms_info").chrom_info,function(e){var t=i.get_elt(new $({chrom:e.chrom,start:0,end:e.len}));return t||(n=!1),t});if(n)return a;var s=e.Deferred();return e.getJSON(this.get("dataset").url(),{data_type:"genome_data"},function(e){i.add_data(e.data),s.resolve(e.data)}),s},subset_entry:function(e,t){var i={bigwig:function(e,t){return o.filter(e,function(e){return e[0]>=t.get("start")&&e[0]<=t.get("end")})},refseq:function(t,i){var n=i.get("start")-e.region.get("start");return e.data.slice(n,n+i.length())}},n=e.data;return!e.region.same(t)&&e.dataset_type in i&&(n=i[e.dataset_type](e.data,t)),{region:t,data:n,dataset_type:e.dataset_type}}}),k=x.extend({initialize:function(e){var t=new n.Model;t.urlRoot=e.data_url,this.set("dataset",t)},load_data:function(e,t,i,n){return e.length()<=1e5?x.prototype.load_data.call(this,e,t,i,n):{data:null,region:e}}}),C=n.Model.extend({defaults:{name:null,key:null,chroms_info:null},initialize:function(e){this.id=e.dbkey},get_chroms_info:function(){return this.attributes.chroms_info.chrom_info},get_chrom_region:function(e){var t=o.find(this.get_chroms_info(),function(t){return t.chrom===e});return new $({chrom:t.chrom,end:t.len})},get_chrom_len:function(e){return o.find(this.get_chroms_info(),function(t){return t.chrom===e}).len}}),$=n.Model.extend({defaults:{chrom:null,start:0,end:0,str_val:null,genome:null},same:function(e){return this.attributes.chrom===e.get("chrom")&&this.attributes.start===e.get("start")&&this.attributes.end===e.get("end")},initialize:function(e){if(e.from_str){var t=e.from_str.split(":"),i=t[0],n=t[1].split("-");this.set({chrom:i,start:parseInt(n[0],10),end:parseInt(n[1],10)})}this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end"),this.on("change",function(){this.attributes.str_val=this.get("chrom")+":"+this.get("start")+"-"+this.get("end")},this)},copy:function(){return new $({chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")})},length:function(){return this.get("end")-this.get("start")},toString:function(){return this.attributes.str_val},toJSON:function(){return{chrom:this.get("chrom"),start:this.get("start"),end:this.get("end")}},compute_overlap:function(e){var t=this.get("chrom"),i=e.get("chrom"),n=this.get("start"),a=e.get("start"),s=this.get("end"),o=e.get("end");return t&&i&&t!==i?$.overlap_results.DIF_CHROMS:n<a?s<a?$.overlap_results.BEFORE:s<o?$.overlap_results.OVERLAP_START:$.overlap_results.CONTAINS:n>a?n>o?$.overlap_results.AFTER:s<=o?$.overlap_results.CONTAINED_BY:$.overlap_results.OVERLAP_END:s>=o?$.overlap_results.CONTAINS:$.overlap_results.CONTAINED_BY},trim:function(e){if(this.attributes.start<0&&(this.attributes.start=0),this.attributes.genome){var t=this.attributes.genome.get_chrom_len(this.attributes.chrom);this.attributes.end>t&&(this.attributes.end=t-1)}return this},contains:function(e){return this.compute_overlap(e)===$.overlap_results.CONTAINS},overlaps:function(e){return 0===o.intersection([this.compute_overlap(e)],[$.overlap_results.DIF_CHROMS,$.overlap_results.BEFORE,$.overlap_results.AFTER]).length}},{overlap_results:{DIF_CHROMS:1e3,BEFORE:1001,CONTAINS:1002,OVERLAP_START:1003,OVERLAP_END:1004,CONTAINED_BY:1005,AFTER:1006}}),S=n.Collection.extend({model:$}),T=n.Model.extend({defaults:{region:null,note:""},initialize:function(e){this.set("region",new $(e.region))}}),M=n.Collection.extend({model:T}),E=n.Model.extend(v).extend({defaults:{mode:"Auto"},initialize:function(e){this.set("dataset",new l.default.Dataset(e.dataset));var t=[{key:"name",default_value:this.get("dataset").get("name")},{key:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:0},{key:"max_value",label:"Max Value",type:"float",default_value:1}];this.set("config",h.default.ConfigSettingCollection.from_models_and_saved_values(t,e.prefs));var i=this.get("preloaded_data");i=i?i.data:[],this.set("data_manager",new x({dataset:this.get("dataset"),init_data:i}))}},{to_json_keys:["track_type","dataset","prefs","mode","filters","tool_state"],to_json_mappers:{prefs:function(e,t){return 0===o.size(e)&&(e={name:t.get("config").get("name").get("value"),color:t.get("config").get("color").get("value")}),e},dataset:function(e){return{id:e.id,hda_ldda:e.get("hda_ldda")}}}}),P=n.Collection.extend({model:E}),O=n.Model.extend({defaults:{title:"",type:""},urlRoot:Galaxy.root+"api/visualizations",save:function(){return e.ajax({url:this.url(),type:"POST",dataType:"json",data:{vis_json:JSON.stringify(this)}})}}),A=O.extend(v).extend({defaults:o.extend({},O.prototype.defaults,{dbkey:"",drawables:null,bookmarks:null,viewport:null}),initialize:function(e){this.set("drawables",new P(e.tracks));var t=[];this.set("config",h.default.ConfigSettingCollection.from_models_and_saved_values(t,e.prefs)),this.unset("tracks"),this.get("drawables").each(function(e){e.unset("preloaded_data")})},add_tracks:function(e){this.get("drawables").add(e)}},{to_json_keys:["view","viewport","bookmarks"],to_json_mappers:{view:function(e,t){return{obj_type:"View",prefs:{name:t.get("title"),content_visible:!0},drawables:t.get("drawables")}}}}),D=n.Router.extend({initialize:function(e){this.view=e.view,this.route(/([\w]+)$/,"change_location"),this.route(/([\w\+]+\:[\d,]+-[\d,]+)$/,"change_location");var t=this;t.view.on("navigate",function(e){t.navigate(e)})},change_location:function(e){this.view.go_to(e)}});t.default={BackboneTrack:E,BrowserBookmark:T,BrowserBookmarkCollection:M,Cache:y,CanvasManager:b,Genome:C,GenomeDataManager:x,GenomeRegion:$,GenomeRegionCollection:S,GenomeVisualization:A,GenomeReferenceDataManager:k,TrackBrowserRouter:D,Visualization:O,select_datasets:w}}).call(t,i(0),i(1))},function(e,t,i){"use strict";(function(e,i){function n(e){e+="";for(var t=/(\d+)(\d{3})/;t.test(e);)e=e.replace(t,"$1,$2");return e}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e){return"promise"in e},s=e.Model.extend({defaults:{ajax_settings:{},interval:1e3,success_fn:function(e){return!0}},go:function(){var e=i.Deferred(),t=this,n=t.get("ajax_settings"),a=t.get("success_fn"),s=t.get("interval");return function t(){i.ajax(n).success(function(i){a(i)?e.resolve(i):setTimeout(t,s)})}(),e}}),o=function(e){e||(e="#ffffff"),"string"==typeof e&&(e=[e]);for(var t=0;t<e.length;t++)e[t]=parseInt(e[t].slice(1),16);var i,n,a,s,o,r,l,d,c,u,h,f=function(e,t,i){return(299*e+587*t+114*i)/1e3},p=!1,m=0;do{for(i=Math.round(16777215*Math.random()),n=(16711680&i)>>16,a=(65280&i)>>8,s=255&i,c=f(n,a,s),p=!0,t=0;t<e.length;t++)if(o=e[t],r=(16711680&o)>>16,l=(65280&o)>>8,d=255&o,u=f(r,l,d),h=function(e,t,i,n,a,s){return Math.max(e,n)-Math.min(e,n)+(Math.max(t,a)-Math.min(t,a))+(Math.max(i,s)-Math.min(i,s))}(n,a,s,r,l,d),Math.abs(c-u)<40||h<200){p=!1;break}m++}while(!p&&m<=10);return"#"+(16777216+i).toString(16).substr(1,6)};t.default={commatize:n,is_deferred:a,ServerStateDeferred:s,get_random_color:o}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(9),r=(s(o),i(45)),l=(s(r),i(41)),d=s(l),c=e.Model.extend({}),u=e.Model.extend({defaults:{id:"",type:"",name:"",hda_ldda:"hda",metadata:null},initialize:function(){this.get("metadata")||this._set_metadata(),this.on("change",this._set_metadata,this)},_set_metadata:function(){var e=new c;n.each(n.keys(this.attributes),function(t){if(0===t.indexOf("metadata_")){var i=t.split("metadata_")[1];e.set(i,this.attributes[t]),delete this.attributes[t]}},this),this.set("metadata",e,{silent:!0})},get_metadata:function(e){return this.attributes.metadata.get(e)},urlRoot:Galaxy.root+"api/datasets"}),h=u.extend({defaults:n.extend({},u.prototype.defaults,{chunk_url:null,first_data_chunk:null,offset:0,at_eof:!1}),initialize:function(e){u.prototype.initialize.call(this),this.attributes.first_data_chunk&&(this.attributes.offset=this.attributes.first_data_chunk.offset),this.attributes.chunk_url=Galaxy.root+"dataset/display?dataset_id="+this.id,this.attributes.url_viz=Galaxy.root+"visualization"},get_next_chunk:function(){if(this.attributes.at_eof)return null;var e=this,t=a.Deferred();return a.getJSON(this.attributes.chunk_url,{offset:e.attributes.offset}).success(function(i){var n;""!==i.ck_data?(n=i,e.attributes.offset=i.offset):(e.attributes.at_eof=!0,n=null),t.resolve(n)}),t}}),f=e.Collection.extend({model:u}),p=e.View.extend({initialize:function(e){this.row_count=0,this.loading_chunk=!1,new g({model:e.model,$el:this.$el})},expand_to_container:function(){this.$el.height()<this.scroll_elt.height()&&this.attempt_to_fetch()},attempt_to_fetch:function(e){var t=this;!this.loading_chunk&&this.scrolled_to_bottom()&&(this.loading_chunk=!0,this.loading_indicator.show(),a.when(t.model.get_next_chunk()).then(function(e){e&&(t._renderChunk(e),t.loading_chunk=!1),t.loading_indicator.hide(),t.expand_to_container()}))},render:function(){this.loading_indicator=a("<div/>").attr("id","loading_indicator"),this.$el.append(this.loading_indicator);var e=a("<table/>").attr({id:"content_table",cellpadding:0});this.$el.append(e);var t=this.model.get_metadata("column_names"),i=a("<thead/>").appendTo(e),n=a("<tr/>").appendTo(i);if(t)n.append("<th>"+t.join("</th><th>")+"</th>");else for(var s=1;s<=this.model.get_metadata("columns");s++)n.append("<th>"+s+"</th>");var o=this,r=this.model.get("first_data_chunk");r?this._renderChunk(r):a.when(o.model.get_next_chunk()).then(function(e){o._renderChunk(e)}),this.scroll_elt.scroll(function(){o.attempt_to_fetch()})},scrolled_to_bottom:function(){return!1},_renderCell:function(e,t,i){var n=a("<td>").text(e),s=this.model.get_metadata("column_types");return void 0!==i?n.attr("colspan",i).addClass("stringalign"):s&&t<s.length&&("str"!==s[t]&&"list"!==s[t]||n.addClass("stringalign")),n},_renderRow:function(e){var t=e.split("\t"),i=a("<tr>"),s=this.model.get_metadata("columns");return this.row_count%2!=0&&i.addClass("dark_row"),t.length===s?n.each(t,function(e,t){i.append(this._renderCell(e,t))},this):t.length>s?(n.each(t.slice(0,s-1),function(e,t){i.append(this._renderCell(e,t))},this),i.append(this._renderCell(t.slice(s-1).join("\t"),s-1))):1===t.length?i.append(this._renderCell(e,0,s)):(n.each(t,function(e,t){i.append(this._renderCell(e,t))},this),n.each(n.range(s-t.length),function(){i.append(a("<td>"))})),this.row_count++,i},_renderChunk:function(e){var t=this.$el.find("table");n.each(e.ck_data.split("\n"),function(e,i){""!==e&&t.append(this._renderRow(e))},this)}}),m=p.extend({initialize:function(e){p.prototype.initialize.call(this,e);var t=n.find(this.$el.parents(),function(e){return"auto"===a(e).css("overflow")});t||(t=window),this.scroll_elt=a(t)},scrolled_to_bottom:function(){return this.$el.height()-this.scroll_elt.scrollTop()-this.scroll_elt.height()<=0}}),_=p.extend({initialize:function(e){p.prototype.initialize.call(this,e),this.scroll_elt=this.$el.css({position:"relative",overflow:"scroll",height:e.height||"500px"})},scrolled_to_bottom:function(){return this.$el.scrollTop()+this.$el.innerHeight()>=this.el.scrollHeight}}),g=e.View.extend({col:{chrom:null,start:null,end:null},url_viz:null,dataset_id:null,genome_build:null,file_ext:null,initialize:function(e){var t=parent.Galaxy;if(t&&t.modal&&(this.modal=t.modal),t&&t.frame&&(this.frame=t.frame),this.modal&&this.frame){var i=e.model,n=i.get("metadata");if(i.get("file_ext")){if(this.file_ext=i.get("file_ext"),"bed"==this.file_ext){if(!(n.get("chromCol")&&n.get("startCol")&&n.get("endCol")))return void console.log("TabularButtonTrackster : Bed-file metadata incomplete.");this.col.chrom=n.get("chromCol")-1,this.col.start=n.get("startCol")-1,this.col.end=n.get("endCol")-1}if("vcf"==this.file_ext){var a=function(e,t){for(var i=0;i<t.length;i++)if(t[i].match(e))return i;return-1};if(this.col.chrom=a("Chrom",n.get("column_names")),this.col.start=a("Pos",n.get("column_names")),this.col.end=null,-1==this.col.chrom||-1==this.col.start)return void console.log("TabularButtonTrackster : VCF-file metadata incomplete.")}if(void 0!==this.col.chrom){if(!i.id)return void console.log("TabularButtonTrackster : Dataset identification is missing.");if(this.dataset_id=i.id,!i.get("url_viz"))return void console.log("TabularButtonTrackster : Url for visualization controller is missing.");this.url_viz=i.get("url_viz"),i.get("genome_build")&&(this.genome_build=i.get("genome_build"));var s=new d.default.IconButtonView({model:new d.default.IconButton({title:"Visualize",icon_class:"chart_curve",id:"btn_viz"})});this.setElement(e.$el),this.$el.append(s.render().$el),this.hide()}}}},events:{"mouseover tr":"show",mouseleave:"hide"},show:function(e){var t=this;if(null!==this.col.chrom){var i=a(e.target).parent(),n=i.children().eq(this.col.chrom).html(),s=i.children().eq(this.col.start).html(),o=this.col.end?i.children().eq(this.col.end).html():s;if(!n.match("^#")&&""!==n&&function(e){return!isNaN(parseFloat(e))&&isFinite(e)}(s)){var r={dataset_id:this.dataset_id,gene_region:n+":"+s+"-"+o},l=i.offset(),d=l.left-10,c=l.top-a(window).scrollTop()+3;a("#btn_viz").css({position:"fixed",top:c+"px",left:d+"px"}),a("#btn_viz").off("click"),a("#btn_viz").click(function(){t.frame.add({title:"Trackster",url:t.url_viz+"/trackster?"+a.param(r)})}),a("#btn_viz").show()}else a("#btn_viz").hide()}},hide:function(){this.$("#btn_viz").hide()}}),v=function(e){e.model||(e.model=new h(e.dataset_config));var t=e.parent_elt,i=e.embedded;delete e.embedded,delete e.parent_elt,delete e.dataset_config;var n=i?new _(e):new m(e);return n.render(),t&&(t.append(n.$el),n.expand_to_container()),n};t.default={Dataset:u,TabularDataset:h,DatasetCollection:f,TabularDatasetChunkedView:p,createTabularDatasetChunkedView:v}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(t){function n(e,t){!a.isUndefined(e)&&a.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var a=i(5),s=i(77),o={"Content-Type":"application/x-www-form-urlencoded"},r={adapter:function(){var e;return"undefined"!=typeof XMLHttpRequest?e=i(28):void 0!==t&&(e=i(28)),e}(),transformRequest:[function(e,t){return s(t,"Content-Type"),a.isFormData(e)||a.isArrayBuffer(e)||a.isBuffer(e)||a.isStream(e)||a.isFile(e)||a.isBlob(e)?e:a.isArrayBufferView(e)?e.buffer:a.isURLSearchParams(e)?(n(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):a.isObject(e)?(n(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};r.headers={common:{Accept:"application/json, text/plain, */*"}},a.forEach(["delete","get","head"],function(e){r.headers[e]={}}),a.forEach(["post","put","patch"],function(e){r.headers[e]=a.merge(o)}),e.exports=r}).call(t,i(76))},function(e,t,i){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i(18)),n(i(19)),n(i(96))},function(e,t,i){"use strict";function n(e,t,i,n){if(void 0===n&&(n={writable:!0,enumerable:!0,configurable:!0}),!(e instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0!==t){if(!(t instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===n)n={writable:!0,enumerable:!0,configurable:!0};else if(!(n instanceof Object))throw new TypeError('"attributes" isn\'t an Object instance');if(void 0===i)for(var a in t)void 0!==t[a]&&Object.defineProperty(e,a,Object.create(n,{value:{value:t[a]}}));else if(i instanceof Array)i.forEach(function(i){void 0!==t[i]&&Object.defineProperty(e,i,Object.create(n,{value:{value:t[i]}}))});else{if(!(i instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var s in i){var a=i[s];void 0!==t[a]&&Object.defineProperty(e,s,Object.create(n,{value:{value:t[a]}}))}}}}function a(e,t,i,n){if(void 0===n&&(n=!0),!(e instanceof Object))throw new TypeError('"target" isn\'t an Object instance');if(void 0===t)return!0;if(!(t instanceof Object))throw new TypeError('"properties" isn\'t an Object instance');if(void 0===n&&(n=!0),void 0===i){for(var a in t)if(e[a]!==t[a]&&(void 0!==t[a]||!n))return!1}else{if(i instanceof Array)return i.every(function(i){return e[i]===t[i]||void 0===t[i]&&n});if(!(i instanceof Object))throw new TypeError('"keys" isn\'t an Object instance');for(var s in i){var a=i[s];if(e[s]!==t[a]&&(void 0!==t[a]||!n))return!1}}return!0}function s(e){return"number"==typeof e}function o(e){return"string"==typeof e}function r(e,t){if(!e)throw new Error(t);return e}function l(e,t){if(!(e instanceof Object))throw new TypeError(t||"Expected Object");return e}function d(e,t){if("string"!=typeof e)throw new TypeError(t||"Expected string");return e}function c(e,t){if(!u(e))throw new TypeError(t||"Expected Array");return e}function u(e){return!!e&&e.constructor===Array}function h(e,t){return[].concat.apply([],e.map(t))}Object.defineProperty(t,"__esModule",{value:!0}),t.updateProperties=n,t.testProperties=a,t.mustBeNumber=function(e,t){if(!s(e))throw new TypeError(t||"Expected number");return e},t.isNumber=s,t.isString=o,t.mustNotBeUndefined=r,t.mustBeObject=l,t.mustBeString=d,t.mustBeArray=c,t.isArray=u,t.mconcat=function(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduceRight(e)},t.snd=function(e){return e[1]},t.concatMap=h},function(e,t,i){"use strict";function n(e){return s(e)||o(e)}function a(e){return t.measureTypes.hasOwnProperty(e)}function s(e){return a(e.type)&&W.isNumber(e.value)}function o(e){return m(e.expression)}function r(e){if(void 0===e)return!1;switch(e){case"Parentheses":case"Square":case"Dollar":return!0;default:return!1}}function l(e,t){return void 0!==e&&(void 0===t?"string"==typeof e.name:t===e.name)}function d(e){return void 0!==e&&"string"==typeof e.text}function c(e){return void 0!==e&&W.isArray(e.latex)}function u(e){return e.arguments instanceof Array}function h(e){return e===X.SUP||e===X.SUB}function f(e){switch(e){case"#":return"\\#";case"$":return"\\$";case"%":return"\\%";case"^":return"\\^{}";case"&":return"\\&";case"{":return"\\{";case"}":return"\\}";case"~":return"\\~{}";case"\\":return"\\textbackslash{}";case"_":return"\\_{}";default:return e}}function p(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return 0===t.length?"string"==typeof e.type:t.some(function(t){return e.type===t})}function m(e){return g(e)||_(e)}function _(e){return P(e)||w(e)||b(e)||x(e)||k(e)||C(e)||S(e)||E(e)}function g(e){return P(e)||v(e)||b(e)||x(e)||k(e)||C(e)||S(e)||E(e)}function v(e){return void 0!==e&&void 0!==e.type&&d(e)&&p(e,t.typeTeXRaw)}function w(e){return void 0!==e&&"string"==typeof e.string&&"number"==typeof e.category}function b(e){return l(e)&&u(e)&&p(e,t.typeTeXComm,t.typeTeXCommS)}function y(e){return b(e)&&0===e.arguments.length}function x(e,i){return p(e,t.typeTeXEnv)}function k(e){return c(e)&&p(e)&&r(e.type)}function C(e){return void 0!==e&&"boolean"==typeof e.noNewPage&&(void 0===e.measure||n(e.measure))}function $(e){return h(e.type)}function S(e){return c(e)&&p(e,t.typeTeXBraces)}function T(e){return p(e,"FixArg")}function M(e){return p(e,"OptArg")}function E(e){return d(e)&&p(e,t.typeTeXComment)}function P(e){return void 0!==e&&0===Object.keys(e).length}function O(e){return{type:"FixArg",latex:e}}function A(e){return 1===e.length?{type:"OptArg",latex:e}:{type:"MOptArg",latex:e}}function D(e){return{type:"SymArg",latex:[e]}}function I(e){return{type:"ParArg",latex:[e]}}function z(e){return{type:"MOptArg",latex:e}}function j(e){return{type:"MSymArg",latex:e}}function L(e){return{type:"MParArg",latex:e}}function R(e){return{name:e,arguments:[],type:t.typeTeXCommS}}function V(e){return{text:e,type:t.typeTeXRaw,characterCategories:J.convertToTeXCharsDefault(e)}}function N(e,t,i,n){return{latex:n,type:e,startSymbol:t,endSymbol:i}}function G(e){return{latex:[e],type:t.typeTeXBraces}}function U(e){return{text:e,type:t.typeTeXComment}}function H(e){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return{name:e,arguments:i,type:t.typeTeXComm}}function F(e,t,i){return{type:e,symbol:t,arguments:i}}function B(e,i){for(var n=[],a=2;a<arguments.length;a++)n[a-2]=arguments[a];return{name:e,latex:i,arguments:n,type:t.typeTeXEnv}}function q(e){var t=[];return Y(e,t),t.join("")}function Y(e,t){if(b(e))t.push("\\",e.name),e.arguments.forEach(function(e){return Y(e,t)});else{if(x(e))throw new Error("not supported yet");if(k(e))t.push(e.startSymbol),e.latex.forEach(function(e){return Y(e,t)}),t.push(e.endSymbol);else if(C(e))t.push("\n");else if($(e))t.push(e.symbol),e.arguments&&e.arguments.forEach(function(e){return Y(e,t)});else if(S(e))t.push("{"),e.latex.forEach(function(e){return Y(e,t)}),t.push("}");else if(E(e))t.push("%"+e.text+"\n");else if(v(e))t.push(e.text);else{if(w(e))throw new Error("not supported yet");if(T(e))t.push("{"),e.latex.forEach(function(e){return Y(e,t)}),t.push("}");else{if(!M(e))throw new Error("Did not recognize "+JSON.stringify(e));t.push("["),e.latex.forEach(function(e){return Y(e,t)}),t.push("]")}}}}Object.defineProperty(t,"__esModule",{value:!0});var W=i(18),J=i(33);t.isMeasure=n,t.measureTypes={pt:!0,mm:!0,cm:!0,in:!0,ex:!0,em:!0},t.isMeasureType=a,t.isBuiltInMeasure=s,t.isCustomMeasure=o,t.mathTypes={Parentheses:"Parentheses",Square:"Square",Dollar:"Dollar"},t.isMathType=r,t.isNameHaving=l,t.isTextHaving=d,t.isLaTeXHaving=c,t.isArgumentHaving=u,t.typeTeXSeq="TeXSeq",t.typeTeXEnv="TeXEnv",t.typeTeXBraces="TeXBraces",t.typeTeXComment="TeXComment",t.typeTeXRaw="TeXRaw",t.typeTeXComm="TeXComm",t.typeTeXCommS="TeXCommS";var X;!function(e){e[e.SUP=0]="SUP",e[e.SUB=1]="SUB"}(X=t.SubOrSuperSymbol||(t.SubOrSuperSymbol={})),t.isSubOrSuperSymbol=h,t.fromStringLaTeX=function(e){return V(t.protectString(e))},t.protectString=function(e){for(var t=[],i=0;i<e.length;i++)t.push(f(e.charAt(i)));return t.join()},t.protectChar=f,t.isTypeHaving=p,t.isLaTeXBlock=m,t.isLaTeXNoRaw=_,t.isLaTeXRaw=g,t.isTeXRaw=v,t.isTeXChar=w,t.isTeXComm=b,t.isTeXCommS=y,t.isTeXEnv=x,t.isTeXMath=k,t.isTeXLineBreak=C,t.isSubOrSuperScript=$,t.isTeXBraces=S,t.isFixArg=T,t.isOptArg=M,t.isTeXComment=E,t.isTeXEmpty=P,t.newFixArg=O,t.newOptArg=A,t.newSymArg=D,t.newParArg=I,t.newMOptArg=z,t.newMSymArg=j,t.newMParArg=L,t.newCommandS=R,t.newTeXRaw=V,t.newTeXMath=N,t.newTeXBraces=G,t.newTeXMathDol=function(e){return N("Dollar","$","$",e)},t.newTeXComment=U,t.newTeXComm=H,t.newSubOrSuperScript=F,t.newTeXEnv=B,t.stringifyLaTeX=q},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=(s(o),i(11)),l=s(r),d=i(4),c=s(d),u=i(48),h=s(u),f=i(44),p=s(f);t.default=e.View.extend({initialize:function(t){this.model=new e.Model({initial_errors:!1,cls:"ui-portlet-limited",icon:null,always_refresh:!0,status:"warning",hide_operations:!1,onchange:function(){}}).set(t),this.setElement("<div/>"),this.render()},update:function(e){var t=this;this.data.matchModel(e,function(e,i){var a=t.input_list[i];if(a&&a.options&&!n.isEqual(a.options,e.options)){a.options=e.options;var s=t.field_list[i];if(s.update){var o=[];if(-1!=["data","data_collection","drill_down"].indexOf(a.type))o=a.options;else for(var r in e.options){var l=e.options[r];l.length>2&&o.push({label:l[0],value:l[1]})}s.update(o),s.trigger("change"),Galaxy.emit.debug("form-view::update()","Updating options for "+i)}}})},wait:function(e){for(var t in this.input_list){var i=this.field_list[t];this.input_list[t].is_dynamic&&i.wait&&i.unwait&&i[e?"wait":"unwait"]()}},highlight:function(e,t,i){var n=this.element_list[e];if(n&&(n.error(t||"Please verify this parameter."),this.portlet.expand(),this.trigger("expand",e),!i)){var s=this.$el.parents().filter(function(){return-1!=["auto","scroll"].indexOf(a(this).css("overflow"))}).first();s.animate({scrollTop:s.scrollTop()+n.$el.offset().top-120},500)}},errors:function(e){if(this.trigger("reset"),e&&e.errors){var t=this.data.matchResponse(e.errors);for(var i in this.element_list){this.element_list[i];t[i]&&this.highlight(i,t[i],!0)}}},render:function(){var e=this;this.off("change"),this.off("reset"),this.field_list={},this.input_list={},this.element_list={},this.data=new p.default.Manager(this),this._renderForm(),this.data.create(),this.model.get("initial_errors")&&this.errors(this.model.attributes);var t=this.data.checksum();return this.on("change",function(i){var n=e.input_list[i];if(!n||n.refresh_on_change||e.model.get("always_refresh")){var a=e.data.checksum();a!=t&&(t=a,e.model.get("onchange")())}}),this.on("reset",function(){n.each(e.element_list,function(e){e.reset()})}),this},_renderForm:function(){a(".tooltip").remove();var e=this.model.attributes;this.message=new c.default.UnescapedMessage,this.section=new h.default.View(this,{inputs:e.inputs}),this.portlet=new l.default.View({icon:e.icon,title:e.title,cls:e.cls,operations:!e.hide_operations&&e.operations,buttons:e.buttons,collapsible:e.collapsible,collapsed:e.collapsed,onchange_title:e.onchange_title}),this.portlet.append(this.message.$el),this.portlet.append(this.section.$el),this.$el.empty(),e.inputs&&this.$el.append(this.portlet.$el),e.message&&this.message.update({persistent:!0,status:e.status,message:e.message}),Galaxy.emit.debug("form-view::initialize()","Completed")}})}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(s),r=i(14),l=a(r),d=i(21),c=(a(d),e.Model.extend({initialize:function(e){var t=this.get("key");this.set("id",t);var i=o.find([{key:"name",label:"Name",type:"text",default_value:""},{key:"color",label:"Color",type:"color",default_value:null},{key:"min_value",label:"Min Value",type:"float",default_value:null},{key:"max_value",label:"Max Value",type:"float",default_value:null},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:32,hidden:!0},{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"block_color",label:"Block color",type:"color",default_value:null},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"reverse_strand_color",label:"Antisense strand color",type:"color",default_value:null},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0}],function(e){return e.key===t});i&&this.set(o.extend({},i,e)),void 0===this.get("value")&&void 0!==this.get("default_value")&&(this.set_value(this.get("default_value")),this.get("value")||"color"!==this.get("type")||this.set("value",l.default.get_random_color()))},set_value:function(e,t){var i=this.get("type");"float"===i?e=parseFloat(e):"int"===i&&(e=parseInt(e,10)),this.set({value:e},t)}})),u=e.Collection.extend({model:c,to_key_value_dict:function(){var e={};return this.each(function(t){e[t.get("key")]=t.get("value")}),e},get_value:function(e){var t=this.get(e);if(t)return t.get("value")},set_value:function(e,t,i){var n=this.get(e);if(n)return n.set_value(t,i)},set_default_value:function(e,t){var i=this.get(e);if(i)return i.set("default_value",t)}},{from_models_and_saved_values:function(e,t){return t&&(e=o.map(e,function(e){return o.extend({},e,{value:t[e.key]})})),new u(e)}}),h=e.View.extend({className:"config-settings-view",render:function(){var e=this.$el;return this.collection.each(function(t,i){if(!t.get("hidden")){var a="param_"+i,s=t.get("type"),r=t.get("value"),d=n("<div class='form-row' />").appendTo(e);if(d.append(n("<label />").attr("for",a).text(t.get("label")+":")),"bool"===s)d.append(n('<input type="checkbox" />').attr("id",a).attr("name",a).attr("checked",r));else if("text"===s)d.append(n('<input type="text"/>').attr("id",a).val(r).click(function(){n(this).select()}));else if("select"===s){var c=n("<select />").attr("id",a);o.each(t.get("options"),function(e){n("<option/>").text(e.label).attr("value",e.value).appendTo(c)}),c.val(r),d.append(c)}else if("color"===s){var u=n("<div/>").appendTo(d),h=n("<input />").attr("id",a).attr("name",a).val(r).css("float","left").appendTo(u).click(function(e){n(".tooltip").removeClass("in");var t=n(this).siblings(".tooltip").addClass("in");t.css({left:n(this).position().left+n(this).width()+5,top:n(this).position().top-n(t).height()/2+n(this).height()/2}).show(),t.click(function(e){e.stopPropagation()}),n(document).bind("click.color-picker",function(){t.hide(),n(document).unbind("click.color-picker")}),e.stopPropagation()}),f=n("<a href='javascript:void(0)'/>").addClass("icon-button arrow-circle").appendTo(u).attr("title","Set new random color").tooltip(),p=n("<div class='tooltip right' style='position: absolute;' />").appendTo(u).hide(),m=n("<div class='tooltip-inner' style='text-align: inherit'></div>").appendTo(p),_=(n("<div class='tooltip-arrow'></div>").appendTo(p),n.farbtastic(m,{width:100,height:100,callback:h,color:r}));u.append(n("<div/>").css("clear","both")),function(e){f.click(function(){e.setColor(l.default.get_random_color())})}(_)}else d.append(n("<input />").attr("id",a).attr("name",a).val(r));t.help&&d.append(n("<div class='help'/>").text(t.help))}}),this},render_in_modal:function(e){var t=this,i=function(){Galaxy.modal.hide(),n(window).unbind("keypress.check_enter_esc")},a=function(){Galaxy.modal.hide(),n(window).unbind("keypress.check_enter_esc"),t.update_from_form()},s=function(e){27===(e.keyCode||e.which)?i():13===(e.keyCode||e.which)&&a()};n(window).bind("keypress.check_enter_esc",s),0===this.$el.children().length&&this.render(),Galaxy.modal.show({title:e||"Configure",body:this.$el,buttons:{Cancel:i,OK:a}})},update_from_form:function(){var e=this;this.collection.each(function(t,i){if(!t.get("hidden")){var n="param_"+i,a=e.$el.find("#"+n).val();"bool"===t.get("type")&&(a=e.$el.find("#"+n).is(":checked")),t.set_value(a)}})}});t.default={ConfigSetting:c,ConfigSettingCollection:u,ConfigSettingCollectionView:h}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(12),d=s(l),c=e.View.extend({initialize:function(t){var i=this;this.data=[],this.data2=[],this.model=t&&t.model||new e.Model({id:r.default.uid(),cls:"ui-select",error_text:"No options available",empty_text:"Nothing selected",visible:!0,wait:!1,multiple:!1,searchable:!0,optional:!1,disabled:!1,readonly:!1,onchange:function(){},value:null,individual:!1,pagesize:20}).set(t),this.on("change",function(){i.model.get("onchange")&&i.model.get("onchange")(i.value())}),this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:disabled",this._changeDisabled,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:visible",this._changeVisible,this),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:multiple change:searchable change:cls change:id",this.render,this),this.render()},render:function(){var e=this;this.model.get("searchable")?this._renderSearchable():this._renderClassic(),this.$el.addClass(this.model.get("cls")).attr("id",this.model.get("id")),this.$select.empty().addClass("select").attr("id",this.model.get("id")+"_select").prop("multiple",this.model.get("multiple")).on("change",function(){e.value(e._getValue()),e.trigger("change")}),this._changeData(),this._changeWait(),this._changeVisible(),this._changeDisabled()},_renderClassic:function(){var e=this;this.$el.addClass(this.model.get("multiple")?"ui-select-multiple":"ui-select").append(this.$select=n("<select/>")).append(this.$dropdown=n("<div/>")).append(this.$resize=n("<div/>").append(this.$resize_icon=n("<i/>"))),this.model.get("multiple")?(this.$dropdown.hide(),this.$resize_icon.addClass("fa fa-angle-double-right fa-rotate-45").show(),this.$resize.removeClass().addClass("icon-resize").show().off("mousedown").on("mousedown",function(t){var i=t.pageY,a=e.$select.height();e.minHeight=e.minHeight||a,n("#dd-helper").show().on("mousemove",function(t){e.$select.height(Math.max(a+(t.pageY-i),e.minHeight))}).on("mouseup mouseleave",function(){n("#dd-helper").hide().off()})})):(this.$dropdown.show(),this.$resize.hide(),this.$resize_icon.hide())},_renderSearchable:function(){var e=this;this.$el.append(this.$select=n("<div/>")).append(this.$dropdown=n("<div/>")),this.$dropdown.hide(),this.model.get("multiple")||this.$dropdown.show().on("click",function(){e.$select.select2&&e.$select.select2("open")}),this.all_button=null,!this.model.get("multiple")||this.model.get("individual")||this.model.get("readonly")||(this.all_button=new d.default.ButtonCheck({onclick:function(){var t=[];0!==e.all_button.value()&&a.each(e.model.get("data"),function(e){t.push(e.value)}),e.value(t),e.trigger("change")}}),this.$el.prepend(this.all_button.$el))},_match:function(e,t){return!e||""==e||String(t).toUpperCase().indexOf(e.toUpperCase())>=0},_changeData:function(){var e=this;this.data=[],!this.model.get("multiple")&&this.model.get("optional")&&this.data.push({value:"__null__",label:e.model.get("empty_text")}),a.each(this.model.get("data"),function(t){e.data.push(t)}),0==this.length()&&this.data.push({value:"__null__",label:this.model.get("error_text")}),this.model.get("searchable")?(this.data2=[],a.each(this.data,function(t,i){e.data2.push({order:i,id:t.value,text:t.label,tags:t.tags})}),this.$select.data("select2")&&this.$select.select2("destroy"),this.matched_tags={},this.$select.select2({data:e.data2,closeOnSelect:!this.model.get("multiple"),multiple:this.model.get("multiple"),query:function(t){e.matched_tags={};var i=e.model.get("pagesize"),n=a.filter(e.data2,function(i){var n=!1;return a.each(i.tags,function(i){e._match(t.term,i)&&(n=e.matched_tags[i]=!0)}),n||e._match(t.term,i.text)});t.callback({results:n.slice((t.page-1)*i,t.page*i),more:n.length>=t.page*i})},formatResult:function(t){return a.escape(t.text)+'<div class="ui-tags">'+a.reduce(t.tags,function(t,i){return e.matched_tags[i]?t+'&nbsp;<div class="label label-info">'+a.escape(i)+"</div>":t},"")+"</div>"}}),this.$(".select2-container .select2-search input").off("blur")):(this.$select.find("option").remove(),a.each(this.data,function(t){e.$select.append(n("<option/>").attr("value",t.value).html(a.escape(t.label)))})),this.model.set("disabled",this.model.get("readonly")||0==this.length()),this._changeValue()},_changeDisabled:function(){this.model.get("searchable")?this.$select.select2(this.model.get("disabled")?"disable":"enable"):this.$select.prop("disabled",this.model.get("disabled"))},_changeWait:function(){this.$dropdown.removeClass().addClass("icon-dropdown fa").addClass(this.model.get("wait")?"fa-spinner fa-spin":"fa-caret-down")},_changeVisible:function(){this.$el[this.model.get("visible")?"show":"hide"](),this.$select[this.model.get("visible")?"show":"hide"]()},_changeValue:function(){if(this._setValue(this.model.get("value")),this.model.get("multiple")){if(this.all_button){var e=this._getValue();this.all_button.value(n.isArray(e)?e.length:0,this.length())}}else null!==this._getValue()||this.model.get("optional")||this._setValue(this.first())},value:function(e){return void 0!==e&&this.model.set("value",e),this._getValue()},first:function(){return this.data.length>0?this.data[0].value:null},exists:function(e){return a.findWhere(this.data,{value:e})},text:function(){var e=this._getValue(),t=this.exists(n.isArray(e)?e[0]:e);return t?t.label:""},show:function(){this.model.set("visible",!0)},hide:function(){this.model.set("visible",!1)},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},disabled:function(){return this.model.get("disabled")},enable:function(){this.model.set("disabled",!1)},disable:function(){this.model.set("disabled",!0)},add:function(e,t){a.each(this.model.get("data"),function(t){t.keep&&!a.findWhere(e,{value:t.value})&&e.push(t)}),t&&e&&e.sort(t),this.model.set("data",e)},update:function(e){this.model.set("data",e)},setOnChange:function(e){this.model.set("onchange",e)},length:function(){return n.isArray(this.model.get("data"))?this.model.get("data").length:0},_setValue:function(e){var t=this;if(null!==e&&void 0!==e||(e="__null__"),this.model.get("multiple")?e=n.isArray(e)?e:[e]:n.isArray(e)&&(e=e.length>0?e[0]:"__null__"),this.model.get("searchable")){if(n.isArray(e)){var i=[];a.each(e,function(e){var n=a.findWhere(t.data2,{id:e});n&&i.push(n)}),e=i}else{e=a.findWhere(this.data2,{id:e})}this.$select.select2("data",e)}else this.$select.val(e)},_getValue:function(){var e=null;if(this.model.get("searchable")){var t=this.$select.select2("data");t&&(n.isArray(t)?(e=[],t.sort(function(e,t){return e.order-t.order}),a.each(t,function(t){e.push(t.id)})):e=t.id)}else e=this.$select.val();return r.default.isEmpty(e)?null:e}});t.default={View:c}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(12),d=s(l),c=e.View.extend({initialize:function(t){var i=this;this.model=t&&t.model||new e.Model({visible:!0,data:[],id:r.default.uid(),error_text:"No options available.",wait_text:"Please wait...",multiple:!1,optional:!1,onchange:function(){}}).set(t),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:visible",this._changeVisible,this),this.on("change",function(){i.model.get("onchange")(i.value())}),this.render()},render:function(){var e=this;this.$el.empty().removeClass().addClass("ui-options").append(this.$message=n("<div/>")).append(this.$menu=n("<div/>").addClass("ui-options-menu")).append(this.$options=n(this._template())),this.all_button=null,this.model.get("multiple")&&(this.all_button=new d.default.ButtonCheck({onclick:function(){e.$("input").prop("checked",0!==e.all_button.value()),e.value(e._getValue()),e.trigger("change")}}),this.$menu.append(this.all_button.$el)),this._changeData(),this._changeWait(),this._changeVisible()},update:function(e){this.model.set("data",e)},_changeData:function(){var e=this;this.$options.empty(),this._templateOptions?this.$options.append(this._templateOptions(this.model.get("data"))):a.each(this.model.get("data"),function(t){e.$options.append(n(e._templateOption(t)).addClass("ui-option").tooltip({title:t.tooltip,placement:"bottom"}))});var e=this;this.$("input").on("change",function(){e.value(e._getValue()),e.trigger("change")}),this._changeValue(),this._changeWait()},_changeVisible:function(){this.$el[this.model.get("visible")?"show":"hide"]()},_changeWait:function(){this.model.get("wait")?0===this.length()&&(this._messageShow(this.model.get("wait_text"),"info"),this.$options.hide(),this.$menu.hide()):0===this.length()?(this._messageShow(this.model.get("error_text"),"danger"),this.$options.hide(),this.$menu.hide()):(this.$message.hide(),this.$options.css("display","inline-block"),this.$menu.show())},_changeValue:function(){this._setValue(this.model.get("value")),null!==this._getValue()||this.model.get("multiple")||this.model.get("optional")||this._setValue(this.first()),this.all_button&&this.all_button.value(n.isArray(this._getValue())?this._getValue().length:0,this.length())},value:function(e){return void 0!==e&&this.model.set("value",e),this._getValue()},first:function(){var e=this.$("input").first();return e.length>0?e.val():null},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},length:function(){return this.$(".ui-option").length},_setValue:function(e){var t=this;if(void 0!==e&&(this.$("input").prop("checked",!1),null!==e)){var i=n.isArray(e)?e:[e];a.each(i,function(e){t.$('input[value="'+e+'"]').first().prop("checked",!0)})}},_getValue:function(){var e=[];return this.$(":checked").each(function(){e.push(n(this).val())}),r.default.isEmpty(e)?null:this.model.get("multiple")?e:e[0]},_messageShow:function(e,t){this.$message.show().removeClass().addClass("ui-message alert alert-"+t).html(e)},_template:function(){return n("<div/>").addClass("ui-options-list")}}),u=c.extend({_templateOption:function(e){var t=r.default.uid();return n("<div/>").addClass("ui-option").append(n("<input/>").attr({id:t,type:this.model.get("type"),name:this.model.id,value:e.value})).append(n("<label/>").addClass("ui-options-label").attr("for",t).html(e.label))}}),h={};h.View=u.extend({initialize:function(e){e.type="radio",u.prototype.initialize.call(this,e)}});var f={};f.View=u.extend({initialize:function(e){e.type="checkbox",e.multiple=!0,u.prototype.initialize.call(this,e)}});var p={};p.View=c.extend({initialize:function(e){c.prototype.initialize.call(this,e)},_setValue:function(e){void 0!==e&&(this.$("input").prop("checked",!1),this.$("label").removeClass("active"),this.$('[value="'+e+'"]').prop("checked",!0).closest("label").addClass("active"))},_templateOption:function(e){var t=n("<label/>").addClass("btn btn-default");return e.icon&&t.append(n("<i/>").addClass("fa").addClass(e.icon).addClass(!e.label&&"no-padding")),t.append(n("<input/>").attr({type:"radio",name:this.model.id,value:e.value})),e.label&&t.append(e.label),t},_template:function(){return n("<div/>").addClass("btn-group ui-radiobutton").attr("data-toggle","buttons")}}),t.default={Base:c,BaseIcons:u,Radio:h,RadioButton:p,Checkbox:f}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=a(s),r=i(11),l=a(r),d=i(4),c=a(d),u=e.View.extend({initialize:function(e){var t=this;this.options=e,this.name=e.name||"element",this.multiple=e.multiple||!1,this.message=new c.default.Message,this.portlet=new l.default.View({cls:"ui-portlet-section"}),this.select=new c.default.Select.View({optional:e.optional}),this.button=new c.default.ButtonIcon({icon:"fa fa-sign-in",tooltip:"Insert new "+this.name,onclick:function(){t.add({id:t.select.value(),name:t.select.text()})}}),this.setElement(this._template(e)),this.$(".ui-list-message").append(this.message.$el),this.$(".ui-list-portlet").append(this.portlet.$el),this.$(".ui-list-button").append(this.button.$el),this.$(".ui-list-select").append(this.select.$el)},value:function(e){if(void 0!==e){if(this.portlet.empty(),n.isArray(e))for(var t in e){var i=e[t],a=null,s=null;"string"!=n.type(i)?(a=i.id,s=i.name):a=s=i,null!=a&&this.add({id:a,name:s})}this._refresh()}var o=[];return this.$(".ui-list-id").each(function(){o.push({id:n(this).prop("id"),name:n(this).find(".ui-list-name").html()})}),0==o.length?null:o},add:function(e){var t=this;if(0===this.$('[id="'+e.id+'"]').length)if(o.default.isEmpty(e.id))this.message.update({message:"Please select a valid "+this.name+".",status:"danger"});else{var i=n(this._templateRow({id:e.id,name:e.name}));i.on("click",function(){i.remove(),t._refresh()}),i.on("mouseover",function(){i.addClass("portlet-highlight")}),i.on("mouseout",function(){i.removeClass("portlet-highlight")}),this.portlet.append(i),this._refresh()}else this.message.update({message:"This "+this.name+" is already in the list."})},update:function(e){this.select.update(e)},_refresh:function(){this.$(".ui-list-id").length>0?(!this.multiple&&this.button.disable(),this.$(".ui-list-portlet").show()):(this.button.enable(),this.$(".ui-list-portlet").hide()),this.options.onchange&&this.options.onchange()},_template:function(e){return'<div class="ui-list"><div class="ui-margin-top"><span class="ui-list-button"/><span class="ui-list-select"/></div><div class="ui-list-message"/><div class="ui-list-portlet"/></div>'},_templateRow:function(e){return'<div id="'+e.id+'" class="ui-list-id"><span class="ui-list-delete fa fa-trash"/><span class="ui-list-name">'+e.name+"</span></div>"}});t.default={View:u}}).call(t,i(1),i(0))},function(e,t,i){"use strict";var n=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n),s=a.default;s.fn.make_text_editable=function(e){var t="num_cols"in e?e.num_cols:30,i="num_rows"in e?e.num_rows:4,n="use_textarea"in e&&e.use_textarea,a="on_finish"in e?e.on_finish:null,o="help_text"in e?e.help_text:null,r=s(this);return r.addClass("editable-text").click(function(o){if(!(s(this).children(":input").length>0)){r.removeClass("editable-text");var l,d,c=function(e){r.find(":input").remove(),""!==e?r.text(e):r.html("<br>"),r.addClass("editable-text"),a&&a(e)},u="cur_text"in e?e.cur_text:r.text();n?(l=s("<textarea/>").attr({rows:i,cols:t}).text(s.trim(u)).keyup(function(e){27===e.keyCode&&c(u)}),d=s("<button/>").text("Done").click(function(){return c(l.val()),!1})):l=s("<input type='text'/>").attr({value:s.trim(u),size:t}).blur(function(){c(u)}).keyup(function(e){27===e.keyCode?s(this).trigger("blur"):13===e.keyCode&&c(s(this).val()),e.stopPropagation()}),r.text(""),r.append(l),d&&r.append(d),l.focus(),l.select(),o.stopPropagation()}}),o&&r.attr("title",o).tooltip(),r}},function(e,t,i){"use strict";(function(e,n,a,s){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(3),l=o(r),d=i(143),c=o(d),u=i(144),h=o(u),f=i(67),p=o(f);e.ajaxSettings.traditional=!0,t.default=n.View.extend({grid:null,initialize:function(e){this.grid=new c.default,this.dict_format=e.dict_format,this.title=e.title;var t=this;if(window.add_tag_to_grid_filter=function(e,i){var n=e+(void 0!==i&&""!==i?":"+i:"");a("#advanced-search").is(":visible")||(a("#standard-search").slideToggle("fast"),a("#advanced-search").slideToggle("fast")),t.add_filter_condition("tags",n)},this.dict_format)if(this.setElement("<div/>"),e.url_base&&!e.items){var i=e.url_data||{};s.each(e.filters,function(e,t){i["f-"+t]=e}),a.ajax({url:e.url_base+"?"+a.param(i),success:function(i){i.embedded=e.embedded,i.filters=e.filters||{},t.init_grid(i)}})}else this.init_grid(e);else this.setElement("#grid-container"),this.init_grid(e);e.use_panels&&a("#center").css({padding:"10px",overflow:"auto"})},handle_refresh:function(e){e&&a.inArray("history",e)>-1&&window.top.Galaxy&&window.top.Galaxy.currHistoryPanel&&window.top.Galaxy.currHistoryPanel.loadCurrentHistory()},init_grid:function(e){this.grid.set(e);var t=this.grid.attributes;this.allow_title_display&&t.title&&l.default.setWindowTitle(t.title),this.handle_refresh(t.refresh_frames);var i=this.grid.get("url_base");if(i=i.replace(/^.*\/\/[^\/]+/,""),this.grid.set("url_base",i),this.$el.html(h.default.grid(t)),this.$el.find("#grid-table-header").html(h.default.header(t)),this.$el.find("#grid-table-body").html(h.default.body(t)),this.$el.find("#grid-table-footer").html(h.default.footer(t)),t.message){this.$el.find("#grid-message").html(h.default.message(t));var n=this;t.use_hide_message&&setTimeout(function(){n.$el.find("#grid-message").html("")},5e3)}this.init_grid_elements(),this.init_grid_controls(),init_refresh_on_change()},init_grid_controls:function(){var e=this;this.$el.find(".operation-button").each(function(){a(this).off(),a(this).click(function(){return e.submit_operation(this),!1})}),this.$el.find("input[type=text]").each(function(){a(this).off(),a(this).click(function(){a(this).select()}).keyup(function(){a(this).css("font-style","normal")})}),this.$el.find(".sort-link").each(function(){a(this).off(),a(this).click(function(){return e.set_sort_condition(a(this).attr("sort_key")),!1})}),this.$el.find(".text-filter-form").each(function(){a(this).off(),a(this).submit(function(){var t=a(this).attr("column_key"),i=a("#input-"+t+"-filter"),n=i.val();return i.val(""),e.add_filter_condition(t,n),!1})}),this.$el.find(".text-filter-val > a").each(function(){a(this).off(),a(this).click(function(){return a(this).parent().remove(),e.remove_filter_condition(a(this).attr("filter_key"),a(this).attr("filter_val")),!1})}),this.$el.find(".categorical-filter > a").each(function(){a(this).off(),a(this).click(function(){return e.set_categorical_filter(a(this).attr("filter_key"),a(this).attr("filter_val")),!1})}),this.$el.find(".advanced-search-toggle").each(function(){a(this).off(),a(this).click(function(){return e.$el.find("#standard-search").slideToggle("fast"),e.$el.find("#advanced-search").slideToggle("fast"),!1})}),this.$el.find("#check_all").off(),this.$el.find("#check_all").on("click",function(){e.check_all_items()})},init_grid_elements:function(){this.$el.find(".grid").each(function(){var e=a(this).find("input.grid-row-select-checkbox"),t=a(this).find("span.grid-selected-count"),i=function(){t.text(a(e).filter(":checked").length)};a(e).each(function(){a(this).change(i)}),i()}),0!==this.$el.find(".community_rating_star").length&&this.$el.find(".community_rating_star").rating({});var e=this.grid.attributes,t=this;this.$el.find(".page-link > a").each(function(){a(this).click(function(){return t.set_page(a(this).attr("page_num")),!1})}),this.$el.find(".use-target").each(function(){a(this).click(function(e){return t.execute({href:a(this).attr("href"),target:a(this).attr("target")}),!1})}),0!=e.items.length&&s.each(e.items,function(i,n){var a=t.$("#grid-"+n+"-popup").off(),o=new p.default(a);s.each(e.operations,function(e){t._add_operation(o,e,i)})})},_add_operation:function(e,t,i){var n=this,s=i.operation_config[t.label];s.allowed&&t.allow_popup&&e.addItem({html:t.label,href:s.url_args,target:s.target,confirmation_text:t.confirm,func:function(e){e.preventDefault();var s=a(e.target).html();t.onclick?t.onclick(i.encode_id):n.execute(this.findItemByHtml(s))}})},add_filter_condition:function(e,t){if(""===t)return!1;this.grid.add_filter(e,t,!0);var i=a(h.default.filter_element(e,t)),n=this;i.click(function(){a(this).remove(),n.remove_filter_condition(e,t)}),this.$el.find("#"+e+"-filtering-criteria").append(i),this.go_page_one(),this.execute()},remove_filter_condition:function(e,t){this.grid.remove_filter(e,t),this.go_page_one(),this.execute()},set_sort_condition:function(e){var t=this.grid.get("sort_key"),i=e;-1!==t.indexOf(e)&&"-"!==t.substring(0,1)&&(i="-"+e),this.$el.find(".sort-arrow").remove();var n="-"==i.substring(0,1)?"&uarr;":"&darr;",s=a("<span>"+n+"</span>").addClass("sort-arrow");this.$el.find("#"+e+"-header").append(s),this.grid.set("sort_key",i),this.go_page_one(),this.execute()},set_categorical_filter:function(e,t){var i=this.grid.get("categorical_filters")[e],n=this.grid.get("filters")[e],s=this;this.$el.find("."+e+"-filter").each(function(){var o=a.trim(a(this).text()),r=i[o],l=r[e];if(l==t)a(this).empty(),a(this).addClass("current-filter"),a(this).append(o);else if(l==n){a(this).empty();var d=a('<a href="#">'+o+"</a>");d.click(function(){s.set_categorical_filter(e,l)}),a(this).removeClass("current-filter"),a(this).append(d)}}),this.grid.add_filter(e,t),this.go_page_one(),this.execute()},set_page:function(e){var t=this;this.$el.find(".page-link").each(function(){var i,n=a(this).attr("id"),s=parseInt(n.split("-")[2],10),o=t.grid.get("cur_page");if(s===e)i=a(this).children().text(),a(this).empty(),a(this).addClass("inactive-link"),a(this).text(i);else if(s===o){i=a(this).text(),a(this).empty(),a(this).removeClass("inactive-link");var r=a('<a href="#">'+i+"</a>");r.click(function(){t.set_page(s)}),a(this).append(r)}}),"all"===e?this.grid.set("cur_page",e):this.grid.set("cur_page",parseInt(e,10)),this.execute()},submit_operation:function(e,t){var i=a(e).val();if(!this.$el.find('input[name="id"]:checked').length>0)return!1;var n=s.findWhere(this.grid.attributes.operations,{label:i});n&&!t&&(t=n.confirm||"");var o=[];this.$el.find("input[name=id]:checked").each(function(){o.push(a(this).val())});var r={operation:i,id:o,confirmation_text:t};return"top"!=n.target&&"center"!=n.target||(r=s.extend(r,{href:n.href,target:n.target})),this.execute(r),!0},check_all_items:function(){var e=this.$(".grid-row-select-checkbox"),t=this.$("#check_all").prop("checked");s.each(e,function(e){a(e).prop("checked",t)}),this.init_grid_elements()},go_page_one:function(){var e=this.grid.get("cur_page");null!==e&&void 0!==e&&"all"!==e&&this.grid.set("cur_page",1)},execute:function(e){var t=null,i=null,n=null,s=null,o=null;if(e&&(i=e.href,n=e.operation,t=e.id,s=e.confirmation_text,o=e.target,void 0!==i&&-1!=i.indexOf("operation="))){var r=i.split("?");if(r.length>1)for(var l=r[1],d=l.split("&"),c=0;c<d.length;c++)-1!=d[c].indexOf("operation")?(n=d[c].split("=")[1],n=n.replace(/\+/g," ")):-1!=d[c].indexOf("id")&&(t=d[c].split("=")[1])}return n&&t?!(s&&""!=s&&"None"!=s&&"null"!=s&&!confirm(s))&&(n=n.toLowerCase(),this.grid.set({operation:n,item_ids:t}),"top"==o?window.top.location=i+"?"+a.param(this.grid.get_url_data()):"center"==o?a("#galaxy_main").attr("src",i+"?"+a.param(this.grid.get_url_data())):this.grid.can_async_op(n)||this.dict_format?this.update_grid():this.go_to(o,i),!1):i?(this.go_to(o,i),!1):(this.grid.get("async")||this.dict_format?this.update_grid():this.go_to(o,i),!1)},go_to:function(e,t){var i=this.grid.get("async");this.grid.set("async",!1);var n=this.$el.find("#advanced-search").is(":visible");switch(this.grid.set("advanced_search",n),t||(t=this.grid.get("url_base")+"?"+a.param(this.grid.get_url_data())),this.grid.set({operation:void 0,item_ids:void 0,async:i}),e){case"center":a("#galaxy_main").attr("src",t);break;case"top":window.top.location=t;break;default:window.location=t}},update_grid:function(){var e=this.grid.get("operation")?"POST":"GET";this.$el.find(".loading-elt-overlay").show();var t=this;a.ajax({type:e,url:t.grid.get("url_base"),data:t.grid.get_url_data(),error:function(e){alert("Grid refresh failed")},success:function(e){var i=t.grid.get("embedded"),n=t.grid.get("insert"),s=t.$el.find("#advanced-search").is(":visible"),o=t.dict_format?e:a.parseJSON(e);o.embedded=i,o.insert=n,o.advanced_search=s,t.init_grid(o),t.$el.find(".loading-elt-overlay").hide()},complete:function(){t.grid.set({operation:void 0,item_ids:void 0})}})}})}).call(t,i(0),i(1),i(0),i(2))},function(e,t,i){"use strict";e.exports=function(e,t){return function(){for(var i=new Array(arguments.length),n=0;n<i.length;n++)i[n]=arguments[n];return e.apply(t,i)}}},function(e,t,i){"use strict";var n=i(5),a=i(78),s=i(80),o=i(81),r=i(82),l=i(29),d="undefined"!=typeof window&&window.btoa&&window.btoa.bind(window)||i(83);e.exports=function(e){return new Promise(function(t,c){var u=e.data,h=e.headers;n.isFormData(u)&&delete h["Content-Type"];var f=new XMLHttpRequest,p="onreadystatechange",m=!1;if(window.XMLHttpRequest||"undefined"==typeof window||!window.XDomainRequest||"withCredentials"in f||r(e.url)||(f=new window.XDomainRequest,p="onload",m=!0,f.onprogress=function(){},f.ontimeout=function(){}),e.auth){var _=e.auth.username||"",g=e.auth.password||"";h.Authorization="Basic "+d(_+":"+g)}if(f.open(e.method.toUpperCase(),s(e.url,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,f[p]=function(){if(f&&(4===f.readyState||m)&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var i="getAllResponseHeaders"in f?o(f.getAllResponseHeaders()):null,n=e.responseType&&"text"!==e.responseType?f.response:f.responseText,s={data:n,status:1223===f.status?204:f.status,statusText:1223===f.status?"No Content":f.statusText,headers:i,config:e,request:f};a(t,c,s),f=null}},f.onerror=function(){c(l("Network Error",e,null,f)),f=null},f.ontimeout=function(){c(l("timeout of "+e.timeout+"ms exceeded",e,"ECONNABORTED",f)),f=null},n.isStandardBrowserEnv()){var v=i(84),w=(e.withCredentials||r(e.url))&&e.xsrfCookieName?v.read(e.xsrfCookieName):void 0;w&&(h[e.xsrfHeaderName]=w)}if("setRequestHeader"in f&&n.forEach(h,function(e,t){void 0===u&&"content-type"===t.toLowerCase()?delete h[t]:f.setRequestHeader(t,e)}),e.withCredentials&&(f.withCredentials=!0),e.responseType)try{f.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then(function(e){f&&(f.abort(),c(e),f=null)}),void 0===u&&(u=null),f.send(u)})}},function(e,t,i){"use strict";var n=i(79);e.exports=function(e,t,i,a,s){var o=new Error(e);return n(o,t,i,a,s)}},function(e,t,i){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,i){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.supportedMarkups={ascii:!0,unicode:!0,html:!0}},function(e,t,i){"use strict";function n(e){return a(t.defaultCategories,e)}function a(e,t){for(var i=[],n=0;n<t.length;n++){var a=t.charAt(n);i.push({string:a,category:e(a)})}return i}Object.defineProperty(t,"__esModule",{value:!0}),t.defaultCategories=function(e){switch(e){case"\\":return 0;case"{":return 1;case"}":return 2;case"$":return 3;case"&":return 4;case"\r":return 5;case"#":return 6;case"^":return 7;case"_":return 8;case"\0":return 9;case" ":return 10;case"~":return 13;case"%":return 14;case"d":return 15;default:return 11}},t.convertToTeXCharsDefault=n,t.convertToTeXChars=a},function(e,t,i){!function(t,i){e.exports=i()}(0,function(){return function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var i={};return t.m=e,t.c=i,t.i=function(e){return e},t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){"use strict";function n(e){if(!(this instanceof n))return new n(e);this._=e}function a(e){return e instanceof n}function s(e){return"[object Array]"==={}.toString.call(e)}function o(e,t){return{status:!0,index:e,value:t,furthest:-1,expected:[]}}function r(e,t){return{status:!1,index:-1,value:null,furthest:e,expected:[t]}}function l(e,t){if(!t)return e;if(e.furthest>t.furthest)return e;var i=e.furthest===t.furthest?c(e.expected,t.expected):t.expected;return{status:e.status,index:e.index,value:e.value,furthest:t.furthest,expected:i}}function d(e,t){var i=e.slice(0,t).split("\n");return{offset:t,line:i.length,column:i[i.length-1].length+1}}function c(e,t){var i=e.length,n=t.length;if(0===i)return t;if(0===n)return e;for(var a={},s=0;s<i;s++)a[e[s]]=!0;for(var o=0;o<n;o++)a[t[o]]=!0;var r=[];for(var l in a)a.hasOwnProperty(l)&&r.push(l);return r.sort(),r}function u(e){if(!a(e))throw new Error("not a parser: "+e)}function h(e){if(!s(e))throw new Error("not an array: "+e)}function f(e){if("number"!=typeof e)throw new Error("not a number: "+e)}function p(e){if(!(e instanceof RegExp))throw new Error("not a regexp: "+e);for(var t=b(e),i=0;i<t.length;i++){var n=t.charAt(i);if("i"!==n&&"m"!==n&&"u"!==n)throw new Error('unsupported regexp flag "'+n+'": '+e)}}function m(e){if("function"!=typeof e)throw new Error("not a function: "+e)}function _(e){if("string"!=typeof e)throw new Error("not a string: "+e)}function g(e){return 1===e.length?e[0]:"one of "+e.join(", ")}function v(e,t){var i=t.index,n=i.offset;if(n===e.length)return", got the end of the input";var a=n>0?"'...":"'",s=e.length-n>12?"...'":"'";return" at line "+i.line+" column "+i.column+", got "+a+e.slice(n,n+12)+s}function w(e,t){return"expected "+g(t.expected)+v(e,t)}function b(e){var t=""+e;return t.slice(t.lastIndexOf("/")+1)}function y(e){return RegExp("^(?:"+e.source+")",b(e))}function x(){for(var e=[].slice.call(arguments),t=e.length,i=0;i<t;i+=1)u(e[i]);return n(function(i,n){for(var a,s=new Array(t),r=0;r<t;r+=1){if(a=l(e[r]._(i,n),a),!a.status)return a;s[r]=a.value,n=a.index}return l(o(n,s),a)})}function k(){for(var e={},t=0,i=[].slice.call(arguments),r=i.length,d=0;d<r;d+=1){var c=i[d];if(!a(c)){if(s(c)&&2===c.length&&"string"==typeof c[0]&&a(c[1])){var u=c[0];if(e[u])throw new Error("seqObj: duplicate key "+u);e[u]=!0,t++;continue}throw new Error("seqObj arguments must be parsers or [string, parser] array pairs.")}}if(0===t)throw new Error("seqObj expects at least one named parser, found zero");return n(function(e,t){for(var n,a={},d=0;d<r;d+=1){var c,u;if(s(i[d])?(c=i[d][0],u=i[d][1]):(c=null,u=i[d]),n=l(u._(e,t),n),!n.status)return n;c&&(a[c]=n.value),t=n.index}return l(o(t,a),n)})}function C(){var e=[].slice.call(arguments);if(0===e.length)throw new Error("seqMap needs at least one argument");var t=e.pop();return m(t),x.apply(null,e).map(function(e){return t.apply(null,e)})}function $(e){var t={};for(var i in e)({}).hasOwnProperty.call(e,i)&&function(i){var n=function(){return e[i](t)};t[i]=G(n)}(i);return t}function S(){var e=[].slice.call(arguments),t=e.length;if(0===t)return A("zero alternates");for(var i=0;i<t;i+=1)u(e[i]);return n(function(t,i){for(var n,a=0;a<e.length;a+=1)if(n=l(e[a]._(t,i),n),n.status)return n;return n})}function T(e,t){return M(e,t).or(O([]))}function M(e,t){u(e),u(t);var i=t.then(e).many();return e.chain(function(e){return i.map(function(t){return[e].concat(t)})})}function E(e){_(e);var t="'"+e+"'";return n(function(i,n){var a=n+e.length,s=i.slice(n,a);return s===e?o(a,s):r(n,t)})}function P(e,t){p(e),arguments.length>=2?f(t):t=0;var i=y(e),a=""+e;return n(function(e,n){var s=i.exec(e.slice(n));if(s){if(0<=t&&t<=s.length){var l=s[0],d=s[t];return o(n+l.length,d)}return r(n,"valid match group (0 to "+s.length+") in "+a)}return r(n,a)})}function O(e){return n(function(t,i){return o(i,e)})}function A(e){return n(function(t,i){return r(i,e)})}function D(e){if(a(e))return n(function(t,i){var n=e._(t,i);return n.index=i,n.value="",n});if("string"==typeof e)return D(E(e));if(e instanceof RegExp)return D(P(e));throw new Error("not a string, regexp, or parser: "+e)}function I(e){return u(e),n(function(t,i){var n=e._(t,i),a=t.slice(i,n.index);return n.status?r(i,'not "'+a+'"'):o(i,null)})}function z(e){return m(e),n(function(t,i){var n=t.charAt(i);return i<t.length&&e(n)?o(i+1,n):r(i,"a character matching "+e)})}function j(e){return z(function(t){return e.indexOf(t)>=0})}function L(e){return z(function(t){return e.indexOf(t)<0})}function R(e){return n(e(o,r))}function V(e,t){return z(function(i){return e<=i&&i<=t}).desc(e+"-"+t)}function N(e){return m(e),n(function(t,i){for(var n=i;n<t.length&&e(t.charAt(n));)n++;return o(n,t.slice(i,n))})}function G(e,t){arguments.length<2&&(t=e,e=void 0);var i=n(function(e,n){return i._=t()._,i._(e,n)});return e?i.desc(e):i}function U(){return A("fantasy-land/empty")}var H=n.prototype;H.parse=function(e){if("string"!=typeof e)throw new Error(".parse must be called with a string as its argument");var t=this.skip(Y)._(e,0);return t.status?{status:!0,value:t.value}:{status:!1,index:d(e,t.furthest),expected:t.expected}},H.tryParse=function(e){var t=this.parse(e);if(t.status)return t.value;var i=w(e,t),n=new Error(i);throw n.type="ParsimmonError",n.result=t,n},H.or=function(e){return S(this,e)},H.trim=function(e){return this.wrap(e,e)},H.wrap=function(e,t){return C(e,this,t,function(e,t){return t})},H.thru=function(e){return e(this)},H.then=function(e){return u(e),x(this,e).map(function(e){return e[1]})},H.many=function(){var e=this;return n(function(t,i){for(var n=[],a=void 0;;){if(a=l(e._(t,i),a),!a.status)return l(o(i,n),a);i=a.index,n.push(a.value)}})},H.tie=function(){return this.map(function(e){h(e);for(var t="",i=0;i<e.length;i++)_(e[i]),t+=e[i];return t})},H.times=function(e,t){var i=this;return arguments.length<2&&(t=e),f(e),f(t),n(function(n,a){for(var s=[],r=void 0,d=void 0,c=0;c<e;c+=1){if(r=i._(n,a),d=l(r,d),!r.status)return d;a=r.index,s.push(r.value)}for(;c<t&&(r=i._(n,a),d=l(r,d),r.status);c+=1)a=r.index,s.push(r.value);return l(o(a,s),d)})},H.result=function(e){return this.map(function(){return e})},H.atMost=function(e){return this.times(0,e)},H.atLeast=function(e){return C(this.times(e),this.many(),function(e,t){return e.concat(t)})},H.map=function(e){m(e);var t=this;return n(function(i,n){var a=t._(i,n);return a.status?l(o(a.index,e(a.value)),a):a})},H.skip=function(e){return x(this,e).map(function(e){return e[0]})},H.mark=function(){return C(F,this,F,function(e,t,i){return{start:e,value:t,end:i}})},H.node=function(e){return C(F,this,F,function(t,i,n){return{name:e,value:i,start:t,end:n}})},H.sepBy=function(e){return T(this,e)},H.sepBy1=function(e){return M(this,e)},H.lookahead=function(e){return this.skip(D(e))},H.notFollowedBy=function(e){return this.skip(I(e))},H.desc=function(e){var t=this;return n(function(i,n){var a=t._(i,n);return a.status||(a.expected=[e]),a})},H.fallback=function(e){return this.or(O(e))},H.ap=function(e){return C(e,this,function(e,t){return e(t)})},H.chain=function(e){var t=this;return n(function(i,n){var a=t._(i,n);return a.status?l(e(a.value)._(i,a.index),a):a})},H.concat=H.or,H.empty=U,H.of=O,H["fantasy-land/ap"]=H.ap,H["fantasy-land/chain"]=H.chain,H["fantasy-land/concat"]=H.concat,H["fantasy-land/empty"]=H.empty,H["fantasy-land/of"]=H.of,H["fantasy-land/map"]=H.map;var F=n(function(e,t){return o(t,d(e,t))}),B=n(function(e,t){return t>=e.length?r(t,"any character"):o(t+1,e.charAt(t))}),q=n(function(e,t){return o(e.length,e.slice(t))}),Y=n(function(e,t){return t<e.length?r(t,"EOF"):o(t,null)}),W=P(/[0-9]/).desc("a digit"),J=P(/[0-9]*/).desc("optional digits"),X=P(/[a-z]/i).desc("a letter"),K=P(/[a-z]*/i).desc("optional letters"),Q=P(/\s*/).desc("optional whitespace"),Z=P(/\s+/).desc("whitespace");n.all=q,n.alt=S,n.any=B,n.createLanguage=$,n.custom=R,n.digit=W,n.digits=J,n.empty=U,n.eof=Y,n.fail=A,n.formatError=w,n.index=F,n.isParser=a,n.lazy=G,n.letter=X,n.letters=K,n.lookahead=D,n.makeFailure=r,n.makeSuccess=o,n.noneOf=L,n.notFollowedBy=I,n.of=O,n.oneOf=j,n.optWhitespace=Q,n.Parser=n,n.range=V,n.regex=P,n.regexp=P,n.sepBy=T,n.sepBy1=M,n.seq=x,n.seqMap=C,n.seqObj=k,n.string=E,n.succeed=O,n.takeWhile=N,n.test=z,n.whitespace=Z,n["fantasy-land/empty"]=U,n["fantasy-land/of"]=O,e.exports=n}])})},function(e,t,i){"use strict";function n(e){return new Error("I do not know command "+e)}Object.defineProperty(t,"__esModule",{value:!0}),t.unknownCommandError=n},function(e,t,i){"use strict";function n(e,t,i,n){return{name:e,optionalArguments:t,argumentCount:i,apply:n}}function a(e,t,i){return{name:e,optionalArguments:t,argumentCount:i}}function s(e,t){return{name:e,optionalArguments:0,argumentCount:t}}Object.defineProperty(t,"__esModule",{value:!0}),t.createCommandHandler=n,t.createKnownCommandWithOptArgs=a,t.createKnownCommandWithArgs=s},function(e,t,i){"use strict";function n(e){return"bb"===e||"mathbb"===e||"textbb"===e}function a(e){return"bf"===e||"mathbf"===e||"textbf"===e}function s(e){return"mono"===e}function o(e){return"frak"===e||"mathfrak"===e||"textfrak"===e}function r(e){return"it"===e||"mathit"===e||"textit"===e}function l(e){return"tt"===e||"mathtt"===e||"texttt"===e}function d(e){return"cal"===e||"mathcal"===e||"textcal"===e}function c(e){return"sup"===e||"mathsup"===e||"textsup"===e||"superscript"===e||"mathsuperscript"===e||"textsuperscript"===e}function u(e){return"sub"===e||"mathsub"===e||"textsub"===e||"subscript"===e||"mathsubscript"===e||"textsubscript"===e}function h(e){return t.formattingText.hasOwnProperty(e)||t.formattingMath.hasOwnProperty(e)||t.formattingNoMode.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.formattingText={textbb:!0,textbf:!0,textfrak:!0,textit:!0,texttt:!0,textcal:!0,textsup:!0,textsub:!0,textsuperscript:!0,textsubscript:!0},t.formattingNoMode={bb:!0,bf:!0,frak:!0,it:!0,tt:!0,cal:!0,mono:!0,sup:!0,sub:!0,superscript:!0,subscript:!0},t.formattingMath={mathbb:!0,mathbf:!0,mathfrak:!0,mathit:!0,mathtt:!0,mathcal:!0,mathsup:!0,mathsub:!0,mathsuperscript:!0,mathsubscript:!0},t.isBbCmd=n,t.isBfCmd=a,t.isMonoCmd=s,t.isFrakCmd=o,t.isItCmd=r,t.isTtCmd=l,t.isCalCmd=d,t.isSupCmd=c,t.isSubCmd=u,t.isFormattingCmd=h},function(e,t,i){"use strict";function n(e){return t.superscriptCharacters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.superscriptCharacters={0:"⁰",1:"¹",2:"²",3:"³",4:"⁴",5:"⁵",6:"⁶",7:"⁷",8:"⁸",9:"⁹","+":"⁺","-":"⁻","=":"⁼","(":"⁽",")":"⁾",a:"ᵃ",b:"ᵇ",c:"ᶜ",d:"ᵈ",e:"ᵉ",f:"ᶠ",g:"ᵍ",h:"ʰ",i:"ⁱ",j:"ʲ",k:"ᵏ",l:"ˡ",m:"ᵐ",n:"ⁿ",o:"ᵒ",p:"ᵖ",r:"ʳ",s:"ˢ",t:"ᵗ",u:"ᵘ",v:"ᵛ",w:"ʷ",x:"ˣ",y:"ʸ",z:"ᶻ",A:"ᴬ",B:"ᴮ",D:"ᴰ",E:"ᴱ",G:"ᴳ",H:"ᴴ",I:"ᴵ",J:"ᴶ",K:"ᴷ",L:"ᴸ",M:"ᴹ",N:"ᴺ",O:"ᴼ",P:"ᴾ",R:"ᴿ",T:"ᵀ",U:"ᵁ",V:"ⱽ",W:"ᵂ","α":"ᵅ","β":"ᵝ","γ":"ᵞ","δ":"ᵟ","∊":"ᵋ","θ":"ᶿ","ι":"ᶥ","Φ":"ᶲ","φ":"ᵠ","χ":"ᵡ"},t.isSuperscriptCharacter=n,t.translateCharToSuperscript=function(e){return n(e)?t.superscriptCharacters[e]:void 0}},function(e,t,i){"use strict";function n(e){return t.oneArgsCommands.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(128),s=i(129),o=i(37);t.oneArgsCommands=Object.assign({},a.spaceCmds1arg,o.formattingText,o.formattingMath,o.formattingNoMode,s.diacriticsTextMode,s.diacriticsMathMode,{cyrchar:!0,vec:!0,mono:!0}),t.is1argsCommand=n},function(e,t,i){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0});var n=e.Model.extend({defaults:{activate:!1}}),a=e.Collection.extend({model:n}),s=e.View.extend({el:"#webhook-view",initialize:function(e){var t=this,i=e.toolId||"",a=e.toolVersion||"";this.$el.attr("tool_id",i),this.$el.attr("tool_version",a),this.model=new n,this.model.urlRoot=e.urlRoot,this.model.fetch({success:function(){t.render()}})},render:function(){var e=this.model.toJSON();return this.$el.html('<div id="'+e.name+'"></div>'),e.styles&&i("<style/>",{type:"text/css"}).text(e.styles).appendTo("head"),e.script&&i("<script/>",{type:"text/javascript"}).text(e.script).appendTo("head"),this}}),o=function(e){var t=new a;t.url=Galaxy.root+e.url,t.fetch({async:!e.async||e.async,success:e.callback})};t.default={Webhooks:a,WebhookView:s,add:o}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=e.Model.extend({defaults:{title:"",icon_class:"",on_click:null,menu_options:null,is_menu_button:!0,id:null,href:null,target:null,enabled:!0,visible:!0,tooltip_config:{}}}),s=e.View.extend({initialize:function(){this.model.attributes.tooltip_config={placement:"bottom"},this.model.bind("change",this.render,this)},render:function(){this.$el.tooltip("hide");var e=this.template(this.model.toJSON());return e.tooltip(this.model.get("tooltip_config")),this.$el.replaceWith(e),this.setElement(e),this},events:{click:"click"},click:function(e){return!i.isFunction(this.model.get("on_click"))||(this.model.get("on_click")(e),!1)},template:function(e){var t='title="'+e.title+'" class="icon-button';return e.is_menu_button&&(t+=" menu-button"),t+=" "+e.icon_class,e.enabled||(t+="_disabled"),t+='"',e.id&&(t+=' id="'+e.id+'"'),t+=' href="'+e.href+'"',e.target&&(t+=' target="'+e.target+'"'),e.visible||(t+=' style="display: none;"'),t=e.enabled?"<a "+t+"/>":"<span "+t+"/>",n(t)}}),o=e.Collection.extend({model:a}),r=e.View.extend({tagName:"div",initialize:function(){this.render()},render:function(){var e=this;return this.collection.each(function(t){var i=n("<a/>").attr("href","javascript:void(0)").attr("title",t.attributes.title).addClass("icon-button menu-button").addClass(t.attributes.icon_class).appendTo(e.$el).click(t.attributes.on_click);t.attributes.tooltip_config&&i.tooltip(t.attributes.tooltip_config);var a=t.get("options");a&&make_popupmenu(i,a)}),this}}),l=function(e,t){t||(t={});var n=new o(i.map(e,function(e){return new a(i.extend(e,t))}));return new r({collection:n})};t.default={IconButton:a,IconButtonView:s,IconButtonCollection:o,IconButtonMenuView:r,create_icon_buttons_menu:l}}).call(t,i(1),i(2),i(0))},,function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=e.View.extend({initialize:function(e){this.options=s.default.merge(e,{content:"No content available.",onchange:null,ondblclick:null,onconfirm:null,cls:"ui-table",selectable:!0,cls_tr:""}),this.setElement(this._template()),this.$thead=this.$("thead"),this.$tbody=this.$("tbody"),this.$tmessage=this.$("tmessage"),this.row=this._row(),this.row_count=0},events:{click:"_onclick",dblclick:"_ondblclick"},addHeader:function(e){this.row.append(n("<th/>").append(e))},appendHeader:function(){this.$thead.append(this.row),this.row=n("<tr/>")},add:function(e,t,i){var a=n("<td/>");t&&a.css("width",t),i&&a.css("text-align",i),this.row.append(a.append(e))},append:function(e,t){this._commit(e,t,!1)},prepend:function(e,t){this._commit(e,t,!0)},get:function(e){return this.$("#"+e)},del:function(e){var t=this.$tbody.find("#"+e);t.length>0&&(t.remove(),this.row_count--,this._refresh())},delAll:function(){this.$tbody.empty(),this.row_count=0,this._refresh()},value:function(e){if(this.options.selectable){this.before=this.$tbody.find(".current").attr("id"),void 0!==e&&(this.$tbody.find("tr").removeClass("current"),e&&this.$tbody.find("#"+e).addClass("current"));var t=this.$tbody.find(".current").attr("id");return void 0===t?null:(t!=this.before&&this.options.onchange&&this.options.onchange(e),t)}},size:function(){return this.$tbody.find("tr").length},_commit:function(e,t,i){this.del(e),this.row.attr("id",e),i?this.$tbody.prepend(this.row):this.$tbody.append(this.row),t&&(this.row.hide(),this.row.fadeIn()),this.row=this._row(),this.row_count++,this._refresh()},_row:function(){return n('<tr class="'+this.options.cls_tr+'"></tr>')},_onclick:function(e){var t=this.value(),i=n(e.target).closest("tr").attr("id");""!=i&&i&&t!=i&&(this.options.onconfirm?this.options.onconfirm(i):this.value(i))},_ondblclick:function(e){var t=this.value();t&&this.options.ondblclick&&this.options.ondblclick(t)},_refresh:function(){0==this.row_count?this.$tmessage.show():this.$tmessage.hide()},_template:function(){return'<div><table class="'+this.options.cls+'"><thead/><tbody/></table><tmessage>'+this.options.content+"</tmessage><div>"}});t.default={View:o}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a){Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=(function(e){e&&e.__esModule}(s),e.Model.extend({initialize:function(e){this.app=e},checksum:function(){var e="",t=this;return this.app.section.$el.find(".section-row").each(function(){var i=n(this).attr("id"),a=t.app.field_list[i];a&&(e+=i+":"+JSON.stringify(a.value&&a.value())+":"+a.collapsed+";")}),e},create:function(){function e(e,t,n){i.flat_dict[e]=t,a[e]=n,i.app.element_list[t]&&i.app.element_list[t].$el.attr("tour_id",e)}function t(n,a){for(var s in a){var o=a[s];if(o.input){var l=o.input,d=n;switch(""!=n&&(d+="|"),d+=l.name,l.type){case"repeat":var c=[],u=null;for(var h in o){var f=h.indexOf("section-");-1!=f&&(f+="section-".length,c.push(parseInt(h.substr(f))),u||(u=h.substr(0,f)))}c.sort(function(e,t){return e-t});var s=0;for(var p in c)t(d+"_"+s++,o[u+c[p]]);break;case"conditional":var m=i.app.field_list[l.id].value();e(d+"|"+l.test_param.name,l.id,m);var _=r(l,m);-1!=_&&t(d,a[l.id+"-section-"+_]);break;case"section":t(!l.flat&&d||"",o);break;default:var g=i.app.field_list[l.id];if(g&&g.value){var m=g.value();if((void 0===l.ignore||l.ignore!=m)&&(g.collapsed&&l.collapsible_value&&(m=l.collapsible_value),e(d,l.id,m),l.payload))for(var v in l.payload)e(v,l.id,l.payload[v])}}}}}var i=this,n={};this._iterate(this.app.section.$el,n);var a={};return this.flat_dict={},t("",n),a},match:function(e){return this.flat_dict&&this.flat_dict[e]},matchCase:function(e,t){return r(e,t)},matchModel:function(e,t){var i=this;l(e.inputs,function(e,n){i.flat_dict[n]&&t(e,i.flat_dict[n])})},matchResponse:function(e){function t(e,a){if("string"==typeof a){var s=n.flat_dict[e];s&&(i[s]=a)}else for(var o in a){var r=o;if(""!==e){var l="|";a instanceof Array&&(l="_"),r=e+l+r}t(r,a[o])}}var i={},n=this;return t("",e),i},_iterate:function(e,t){var i=this;n(e).children().each(function(){var e=this,a=n(e).attr("id");if(n(e).hasClass("section-row")){var s=i.app.input_list[a];t[a]=s&&{input:s}||{},i._iterate(e,t[a])}else i._iterate(e,t)})}})),r=function(e,t){"boolean"==e.test_param.type&&(t="true"==t?e.test_param.truevalue||"true":e.test_param.falsevalue||"false");for(var i in e.cases)if(e.cases[i].value==t)return i;return-1},l=function e(t,i,s,o){o=n.extend(!0,{},o),a.each(t,function(e){e&&e.type&&e.name&&(o[e.name]=e)});for(var l in t){var d=t[l];d.name=d.name||l;var c=s?s+"|"+d.name:d.name;switch(d.type){case"repeat":a.each(d.cache,function(t,n){e(t,i,c+"_"+n,o)});break;case"conditional":if(d.test_param){i(d.test_param,c+"|"+d.test_param.name,o);var u=r(d,d.test_param.value);-1!=u?e(d.cases[u].inputs,i,c,o):Galaxy.emit.debug("form-data::visitInputs() - Invalid case for "+c+".")}else Galaxy.emit.debug("form-data::visitInputs() - Conditional test parameter missing for "+c+".");break;case"section":e(d.inputs,i,c,o);break;default:i(d,c,o)}}};t.default={Manager:o,visitInputs:l}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,i,n){Object.defineProperty(t,"__esModule",{value:!0});var a=e.View.extend({initialize:function(t){this.model=t&&t.model||new e.Model(t),this.setElement(i("<div/>").addClass("corner frame")),this.$el.append(i("<div/>").addClass("f-header corner").append(i("<div/>").addClass("f-title")).append(i("<div/>").addClass("f-icon f-close fa fa-close").tooltip({title:"Close",placement:"bottom"}))).append(i("<div/>").addClass("f-content")).append(i("<div/>").addClass("f-resize f-icon corner fa fa-expand").tooltip({title:"Resize"})).append(i("<div/>").addClass("f-cover")),this.$header=this.$(".f-header"),this.$title=this.$(".f-title"),this.$content=this.$(".f-content"),this.render(),this.listenTo(this.model,"change",this.render,this)},render:function(){var e=this,t=this.model.attributes;this.$title.html(t.title||""),this.$header.find(".f-icon-left").remove(),n.each(t.menu,function(t){var a=i("<div/>").addClass("f-icon-left").addClass(t.icon);n.isFunction(t.disabled)&&t.disabled()?a.attr("disabled",!0):a.on("click",function(){t.onclick(e)}).tooltip({title:t.tooltip,placement:"bottom"}),e.$header.append(a)}),t.url?this.$content.html(i("<iframe/>").addClass("f-iframe").attr("scrolling","auto").attr("src",t.url+(-1===t.url.indexOf("?")?"?":"&")+"widget=True")):t.content&&(n.isFunction(t.content)?t.content(e.$content):e.$content.html(t.content))}}),s=e.View.extend({defaultOptions:{frame:{cols:6,rows:3},rows:1e3,cell:130,margin:5,scroll:5,top_min:40,frame_max:9,visible:!0},cols:0,top:0,top_max:0,frame_z:0,frame_counter:0,frame_uid:0,frame_list:{},frame_shadow:null,visible:!1,event:{},initialize:function(t){var a=this;this.options=n.defaults(t||{},this.defaultOptions),this.visible=this.options.visible,this.top=this.top_max=this.options.top_min,this.setElement(i("<div/>").addClass("galaxy-frame").append(i("<div/>").addClass("frame-background")).append(i("<div/>").addClass("frame-menu frame-scroll-up fa fa-chevron-up fa-2x")).append(i("<div/>").addClass("frame-menu frame-scroll-down fa fa-chevron-down fa-2x"))),this.frame_shadow=new e.View({el:i("<div/>").addClass("corner frame-shadow")}),this.$el.append(this.frame_shadow.$el),this._frameInit(this.frame_shadow,"#frame-shadow"),this._frameResize(this.frame_shadow,{width:0,height:0}),this.frame_list["#frame-shadow"]=this.frame_shadow,this.visible?this.show():this.hide(),this._panelRefresh(),i(window).resize(function(){a.visible&&a._panelRefresh()})},render:function(){this.$(".frame-scroll-up")[this.top!=this.options.top_min&&"show"||"hide"](),this.$(".frame-scroll-down")[this.top!=this.top_max&&"show"||"hide"]()},add:function(e){if(this.frame_counter>=this.options.frame_max)Galaxy.modal.show({title:"Warning",body:"You have reached the maximum number of allowed frames ("+this.options.frame_max+").",buttons:{Close:function(){Galaxy.modal.hide()}}});else{var t="#frame-"+this.frame_uid++;if(0!==i(t).length)Galaxy.modal.show({title:"Error",body:"This frame already exists. This page might contain multiple frame managers.",buttons:{Close:function(){Galaxy.modal.hide()}}});else{this.top=this.options.top_min;var n=new a(e);this.$el.append(n.$el),e.width=this._toPixelCoord("width",this.options.frame.cols),e.height=this._toPixelCoord("height",this.options.frame.rows),this.frame_z=parseInt(n.$el.css("z-index")),this.frame_list[t]=n,this.frame_counter++,this._frameInit(n,t),this._frameResize(n,{width:e.width,height:e.height}),this._frameInsert(n,{top:0,left:0},!0),!this.visible&&this.show(),this.trigger("add")}}},del:function(e){var t=this,i=e.$el;i.fadeOut("fast",function(){i.remove(),delete t.frame_list[e.id],t.frame_counter--,t._panelRefresh(!0),t._panelAnimationComplete(),t.trigger("remove")})},show:function(){this.visible=!0,this.$el.fadeIn("fast"),this.trigger("show")},hide:function(){this.event.type||(this.visible=!1,this.$el.fadeOut("fast",function(){i(this).hide()}),this.trigger("hide"))},length:function(){return this.frame_counter},events:{mousemove:"_eventFrameMouseMove",mouseup:"_eventFrameMouseUp",mouseleave:"_eventFrameMouseUp",mousewheel:"_eventPanelScroll",DOMMouseScroll:"_eventPanelScroll","mousedown .frame":"_eventFrameMouseDown","mousedown .frame-background":"_eventHide","mousedown .frame-scroll-up":"_eventPanelScroll_up","mousedown .frame-scroll-down":"_eventPanelScroll_down","mousedown .f-close":"_eventFrameClose"},_eventFrameMouseDown:function(e){i(".tooltip").hide(),this.event.type||((i(e.target).hasClass("f-header")||i(e.target).hasClass("f-title"))&&(this.event.type="drag"),i(e.target).hasClass("f-resize")&&(this.event.type="resize"),this.event.type&&(e.preventDefault(),this.event.target=this._frameIdentify(e.target),this.event.xy={x:e.originalEvent.pageX,y:e.originalEvent.pageY},this._frameDragStart(this.event.target)))},_eventFrameMouseMove:function(e){if(this.event.type){var t={x:e.originalEvent.pageX,y:e.originalEvent.pageY},i={x:t.x-this.event.xy.x,y:t.y-this.event.xy.y};this.event.xy=t;var n=this._frameScreen(this.event.target);if("resize"==this.event.type){n.width+=i.x,n.height+=i.y;var a=this.options.cell-this.options.margin-1;n.width=Math.max(n.width,a),n.height=Math.max(n.height,a),this._frameResize(this.event.target,n),n.width=this._toGridCoord("width",n.width)+1,n.height=this._toGridCoord("height",n.height)+1,n.width=this._toPixelCoord("width",n.width),n.height=this._toPixelCoord("height",n.height),this._frameResize(this.frame_shadow,n),this._frameInsert(this.frame_shadow,{top:this._toGridCoord("top",n.top),left:this._toGridCoord("left",n.left)})}else if("drag"==this.event.type){n.left+=i.x,n.top+=i.y,this._frameOffset(this.event.target,n);var s={top:this._toGridCoord("top",n.top),left:this._toGridCoord("left",n.left)};0!==s.left&&s.left++,this._frameInsert(this.frame_shadow,s)}}},_eventFrameMouseUp:function(e){this.event.type&&(this._frameDragStop(this.event.target),this.event.type=null)},_eventFrameClose:function(e){this.event.type||(e.preventDefault(),this.del(this._frameIdentify(e.target)))},_eventHide:function(e){!this.event.type&&this.hide()},_eventPanelScroll:function(e){if(!this.event.type&&this.visible){0!==i(e.srcElement).parents(".frame").length?e.stopPropagation():(e.preventDefault(),this._panelScroll(e.originalEvent.detail?e.originalEvent.detail:e.originalEvent.wheelDelta/-3))}},_eventPanelScroll_up:function(e){this.event.type||(e.preventDefault(),this._panelScroll(-this.options.scroll))},_eventPanelScroll_down:function(e){this.event.type||(e.preventDefault(),this._panelScroll(this.options.scroll))},_frameIdentify:function(e){return this.frame_list["#"+i(e).closest(".frame").attr("id")]},_frameDragStart:function(e){this._frameFocus(e,!0);var t=this._frameScreen(e);this._frameResize(this.frame_shadow,t),this._frameGrid(this.frame_shadow,e.grid_location),e.grid_location=null,this.frame_shadow.$el.show(),i(".f-cover").show()},_frameDragStop:function(e){this._frameFocus(e,!1);var t=this._frameScreen(this.frame_shadow);this._frameResize(e,t),this._frameGrid(e,this.frame_shadow.grid_location,!0),this.frame_shadow.grid_location=null,this.frame_shadow.$el.hide(),i(".f-cover").hide(),this._panelAnimationComplete()},_toGridCoord:function(e,t){var i="width"==e||"height"==e?1:-1;return"top"==e&&(t-=this.top),parseInt((t+i*this.options.margin)/this.options.cell,10)},_toPixelCoord:function(e,t){var i="width"==e||"height"==e?1:-1,n=t*this.options.cell-i*this.options.margin;return"top"==e&&(n+=this.top),n},_toGrid:function(e){return{top:this._toGridCoord("top",e.top),left:this._toGridCoord("left",e.left),width:this._toGridCoord("width",e.width),height:this._toGridCoord("height",e.height)}},_toPixel:function(e){return{top:this._toPixelCoord("top",e.top),left:this._toPixelCoord("left",e.left),width:this._toPixelCoord("width",e.width),height:this._toPixelCoord("height",e.height)}},_isCollision:function(e){for(var t in this.frame_list){var i=this.frame_list[t];if(null!==i.grid_location&&function(e,t){return!(e.left>t.left+t.width-1||e.left+e.width-1<t.left||e.top>t.top+t.height-1||e.top+e.height-1<t.top)}(e,i.grid_location))return!0}return!1},_locationRank:function(e){return e.top*this.cols+e.left},_panelRefresh:function(e){this.cols=parseInt(i(window).width()/this.options.cell,10)+1,this._frameInsert(null,null,e)},_panelAnimationComplete:function(){var e=this;i(".frame").promise().done(function(){e._panelScroll(0,!0)})},_panelScroll:function(e,t){var i=this.top-this.options.scroll*e;if(i=Math.max(i,this.top_max),i=Math.min(i,this.options.top_min),this.top!=i){for(var n in this.frame_list){var a=this.frame_list[n];if(null!==a.grid_location){var s={top:a.screen_location.top-(this.top-i),left:a.screen_location.left};this._frameOffset(a,s,t)}}this.top=i}this.render()},_frameInit:function(e,t){e.id=t,e.screen_location={},e.grid_location={},e.grid_rank=null,e.$el.attr("id",t.substring(1))},_frameInsert:function(e,t,a){var s=this,o=[];e&&(e.grid_location=null,o.push([e,this._locationRank(t)])),n.each(this.frame_list,function(e){null!==e.grid_location&&(e.grid_location=null,o.push([e,e.grid_rank]))}),o.sort(function(e,t){return e[1]<t[1]?-1:e[1]>t[1]?1:0}),n.each(o,function(e){s._framePlace(e[0],a)}),this.top_max=0,n.each(this.frame_list,function(e){null!==e.grid_location&&(s.top_max=Math.max(s.top_max,e.grid_location.top+e.grid_location.height))}),this.top_max=i(window).height()-this.top_max*this.options.cell-2*this.options.margin,this.top_max=Math.min(this.top_max,this.options.top_min),this.render()},_framePlace:function(e,t){e.grid_location=null;for(var i=this._toGrid(this._frameScreen(e)),n=!1,a=0;a<this.options.rows;a++){for(var s=0;s<Math.max(1,this.cols-i.width);s++)if(i.top=a,i.left=s,!this._isCollision(i)){n=!0;break}if(n)break}n?this._frameGrid(e,i,t):console.log("Grid dimensions exceeded.")},_frameFocus:function(e,t){e.$el.css("z-index",this.frame_z+(t?1:0))},_frameOffset:function(e,t,i){if(e.screen_location.left=t.left,e.screen_location.top=t.top,i){this._frameFocus(e,!0);var n=this;e.$el.animate({top:t.top,left:t.left},"fast",function(){n._frameFocus(e,!1)})}else e.$el.css({top:t.top,left:t.left})},_frameResize:function(e,t){e.$el.css({width:t.width,height:t.height}),e.screen_location.width=t.width,e.screen_location.height=t.height},_frameGrid:function(e,t,i){e.grid_location=t,this._frameOffset(e,this._toPixel(t),i),e.grid_rank=this._locationRank(t)},_frameScreen:function(e){var t=e.screen_location;return{top:t.top,left:t.left,width:t.width,height:t.height}}});t.default={View:s}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=e.View.extend({initialize:function(t){var i=this;this.model=t&&t.model||new e.Model({id:s.default.uid(),min:null,max:null,step:null,precise:!1,split:1e4,value:null,onchange:function(){}}).set(t),this.setElement(this._template()),this.$el.attr("id",this.model.id),this.$text=this.$(".ui-form-slider-text"),this.$slider=this.$(".ui-form-slider-element");var a=[];this.$text.on("change",function(){i.value(n(this).val())}).on("keyup",function(e){a[e.which]=!1}).on("keydown",function(e){var t=e.which;a[t]=!0,i.model.get("is_workflow")&&a[16]&&52==t?(i.value("$"),event.preventDefault()):8==t||9==t||13==t||37==t||39==t||t>=48&&t<=57&&!a[16]||t>=96&&t<=105||(190==t||110==t)&&-1==n(this).val().indexOf(".")&&i.model.get("precise")||(189==t||109==t)&&-1==n(this).val().indexOf("-")||i._isParameter(n(this).val())||a[91]||a[17]||event.preventDefault()});var o=this.model.attributes;this.has_slider=null!==o.max&&null!==o.min&&o.max>o.min;var r=o.step;r||(r=o.precise&&this.has_slider?(o.max-o.min)/o.split:1),this.has_slider?(this.$text.addClass("ui-form-slider-left"),this.$slider.slider({min:o.min,max:o.max,step:r}).on("slide",function(e,t){i.value(t.value)})):this.$slider.hide(),this.listenTo(this.model,"change",this.render,this),this.render()},render:function(){var e=this.model.get("value");this.has_slider&&this.$slider.slider("value",e),e!==this.$text.val()&&this.$text.val(e)},value:function(e){var t=this.model.attributes;return void 0!==e&&(null===e||""===e||this._isParameter(e)||(isNaN(e)&&(e=0),!t.precise&&(e=Math.round(e)),null!==t.max&&(e=Math.min(e,t.max)),null!==t.min&&(e=Math.max(e,t.min))),this.model.set("value",e),this.model.trigger("change"),t.onchange(e)),this.model.get("value")},_isParameter:function(e){return this.model.get("is_workflow")&&"$"===String(e).substring(0,1)},_template:function(){return'<div class="ui-form-slider"><input class="ui-form-slider-text" type="text"/><div class="ui-form-slider-element"/></div>'}});t.default={View:o}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=a(s),r=i(23),l=a(r),d=l.default.BaseIcons.extend({initialize:function(e){e.type=e.display||"checkbox",e.multiple="checkbox"==e.type,l.default.BaseIcons.prototype.initialize.call(this,e)},_setValue:function(t){if(l.default.BaseIcons.prototype._setValue.call(this,t),void 0!==t&&null!==t&&this.header_index){var i=this,a=e.isArray(t)?t:[t];n.each(a,function(e){var t=i.header_index[e];n.each(t,function(e){i._setState(e,!0)})})}},_setState:function(e,t){var i=this.$(".button-"+e),n=this.$(".subgroup-"+e);i.data("is_expanded",t),t?(n.show(),i.removeClass("fa-plus-square").addClass("fa-minus-square")):(n.hide(),i.removeClass("fa-minus-square").addClass("fa-plus-square"))},_templateOptions:function(){function t(e,t){var i=e.find(".button-"+t);i.on("click",function(){n._setState(t,!i.data("is_expanded"))})}function i(a,s,r){r=r||[];for(var l in s){var d=s[l],c=d.options&&d.options.length>0,u=r.slice(0);n.header_index[d.value]=u.slice(0);var h=e("<div/>");if(c){var f=o.default.uid(),p=e("<span/>").addClass("button-"+f).addClass("ui-drilldown-button fa fa-plus-square"),m=e("<div/>").addClass("subgroup-"+f).addClass("ui-drilldown-subgroup");h.append(e("<div/>").append(p).append(n._templateOption({label:d.name,value:d.value}))),u.push(f),i(m,d.options,u),h.append(m),t(h,f)}else h.append(n._templateOption({label:d.name,value:d.value}));a.append(h)}}var n=this;this.header_index={};var a=e("<div/>");return i(a,this.model.get("data")),a},_template:function(){return e("<div/>").addClass("ui-options-list drilldown-container").attr("id",this.model.id)}});t.default={View:d}}).call(t,i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a,s){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(3),l=o(r),d=i(4),c=(o(d),i(11)),u=o(c),h=i(49),f=o(h),p=i(50),m=o(p),_=i(51),g=o(_),v=e.View.extend({initialize:function(e,t){this.app=e,this.inputs=t.inputs,this.parameters=new g.default,this.setElement(n("<div/>")),this.render()},render:function(){var e=this;this.$el.empty(),a.each(this.inputs,function(t){e.add(t)})},add:function(e){var t=s.extend(!0,{},e);switch(t.id=e.id=l.default.uid(),this.app.input_list[t.id]=t,t.type){case"conditional":this._addConditional(t);break;case"repeat":this._addRepeat(t);break;case"section":this._addSection(t);break;default:this._addRow(t)}},_addConditional:function(e){var t=this;e.test_param.id=e.id,this.app.model.get("sustain_conditionals")&&(e.test_param.disabled=!0);var i=this._addRow(e.test_param);i.model&&i.model.set("onchange",function(i){var n=t.app.data.matchCase(e,i);for(var a in e.cases){var s=e.cases[a],o=t.$("#"+e.id+"-section-"+a),r=!1;for(var l in s.inputs)if(!s.inputs[l].hidden){r=!0;break}a==n&&r?o.fadeIn("fast"):o.hide()}t.app.trigger("change")});for(var n in e.cases){var a=new v(this.app,{inputs:e.cases[n].inputs});this._append(a.$el.addClass("ui-form-section"),e.id+"-section-"+n)}i.trigger("change")},_addRepeat:function(e){function t(t){var a=e.id+"-section-"+n++,o=new v(i.app,{inputs:t});s.add({id:a,$el:o.$el,ondel:function(){s.del(a),i.app.trigger("change")}})}for(var i=this,n=0,s=new f.default.View({title:e.title||"Repeat",min:e.min,max:e.max,onnew:function(){t(e.inputs),i.app.trigger("change")}}),o=a.size(e.cache),r=0;r<Math.max(Math.max(o,e.min||0),e.default||0);r++)t(r<o?e.cache[r]:e.inputs);this.app.model.get("sustain_repeats")&&s.hideOptions();var l=new m.default(this.app,{label:e.title||e.name,help:e.help,field:s});this._append(l.$el,e.id)},_addSection:function(e){var t=new u.default.View({title:e.title||e.name,cls:"ui-portlet-section",collapsible:!0,collapsible_button:!0,collapsed:!e.expanded});t.append(new v(this.app,{inputs:e.inputs}).$el),t.append(n("<div/>").addClass("ui-form-info").html(e.help)),this.app.on("expand",function(e){t.$("#"+e).length>0&&t.expand()}),this._append(t.$el,e.id)},_addRow:function(e){var t=this,i=e.id;e.onchange=e.onchange||function(){t.app.trigger("change",i)};var n=this.parameters.create(e);this.app.field_list[i]=n;var a=new m.default(this.app,{name:e.name,label:e.hide_label?"":e.label||e.name,value:e.value,text_value:e.text_value,collapsible_value:e.collapsible_value,collapsible_preview:e.collapsible_preview,help:e.help,argument:e.argument,disabled:e.disabled,color:e.color,style:e.style,backdrop:e.backdrop,hidden:e.hidden,fixed:e.fixed,field:n});return this.app.element_list[i]=a,this._append(a.$el,e.id),n},_append:function(e,t){this.$el.append(e.addClass("section-row").attr("id",t))}});t.default={View:v}}).call(t,i(1),i(0),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(11),d=s(l),c=i(4),u=s(c),h=e.View.extend({initialize:function(e){this.list={},this.options=r.default.merge(e,{title:"Repeat",empty_text:"Not available.",max:null,min:null}),this.button_new=new u.default.ButtonIcon({icon:"fa-plus",title:"Insert "+this.options.title,tooltip:"Add new "+this.options.title+" block",cls:"ui-button-icon ui-clear-float form-repeat-add",onclick:function(){e.onnew&&e.onnew()}}),this.setElement(n("<div/>").append(this.$list=n("<div/>")).append(n("<div/>").append(this.button_new.$el)))},size:function(){return a.size(this.list)},add:function(e){if(!e.id||this.list[e.id])return void Galaxy.emit.debug("form-repeat::add()","Duplicate or invalid repeat block id.");var t=new u.default.ButtonIcon({icon:"fa-trash-o",tooltip:"Delete this repeat block",cls:"ui-button-icon-plain form-repeat-delete",onclick:function(){e.ondel&&e.ondel()}}),i=new d.default.View({id:e.id,title:"placeholder",cls:e.cls||"ui-portlet-repeat",operations:{button_delete:t}});i.append(e.$el),i.$el.addClass("section-row").hide(),this.list[e.id]=i,this.$list.append(i.$el.fadeIn("fast")),this.options.max>0&&this.size()>=this.options.max&&this.button_new.disable(),this._refresh()},del:function(e){if(!this.list[e])return void Galaxy.emit.debug("form-repeat::del()","Invalid repeat block id.");this.$list.find("#"+e).remove(),delete this.list[e],this.button_new.enable(),this._refresh()},delAll:function(){for(var e in this.list)this.del(e)},hideOptions:function(){this.button_new.$el.hide(),a.each(this.list,function(e){e.hideOperation("button_delete")}),a.isEmpty(this.list)&&this.$el.append(n("<div/>").addClass("ui-form-info").html(this.options.empty_text))},_refresh:function(){var e=0;for(var t in this.list){var i=this.list[t];i.title(++e+": "+this.options.title),i[this.size()>this.options.min?"showOperation":"hideOperation"]("button_delete")}}});t.default={View:h}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e.View.extend({initialize:function(t,i){this.app=t,this.app_options=t.model?t.model.attributes:{},this.field=i&&i.field||new e.View,this.model=i&&i.model||new e.Model({text_enable:this.app_options.text_enable||"Enable",text_disable:this.app_options.text_disable||"Disable",cls_enable:this.app_options.cls_enable||"fa fa-caret-square-o-down",cls_disable:this.app_options.cls_disable||"fa fa-caret-square-o-up",always_refresh:this.app_options.always_refresh}).set(i),this.setElement(this._template()),this.$field=this.$(".ui-form-field"),this.$info=this.$(".ui-form-info"),this.$preview=this.$(".ui-form-preview"),this.$collapsible=this.$(".ui-form-collapsible"),this.$collapsible_text=this.$(".ui-form-collapsible-text"),this.$collapsible_icon=this.$(".ui-form-collapsible-icon"),this.$title=this.$(".ui-form-title"),this.$title_text=this.$(".ui-form-title-text"),this.$error_text=this.$(".ui-form-error-text"),this.$error=this.$(".ui-form-error"),this.$backdrop=this.$(".ui-form-backdrop"),this.$field.prepend(this.field.$el);var n=this.model.get("collapsible_value");this.field.collapsed=void 0!==n&&JSON.stringify(this.model.get("value"))==JSON.stringify(n),this.listenTo(this.model,"change",this.render,this),this.render();var a=this;this.$collapsible.on("click",function(){a.field.collapsed=!a.field.collapsed,t.trigger&&t.trigger("change"),a.render()}),this.field.model&&!this.model.get("always_refresh")&&this.listenTo(this.field.model,"change:value",function(){a.reset()})},backdrop:function(){this.model.set("backdrop",!0)},error:function(e){this.model.set("error_text",e)},reset:function(){!this.model.get("fixed")&&this.model.set("error_text",null)},render:function(){i(".tooltip").hide();var e=this.model.get("help",""),t=this.model.get("argument");t&&-1==e.indexOf("("+t+")")&&(e+=" ("+t+")"),this.$info.html(e),this.$el[this.model.get("hidden")?"hide":"show"](),this.$preview[this.field.collapsed&&this.model.get("collapsible_preview")||this.model.get("disabled")?"show":"hide"]().html(n.escape(this.model.get("text_value")));var a=this.model.get("error_text");if(this.$error[a?"show":"hide"](),this.$el[a?"addClass":"removeClass"]("ui-error"),this.$error_text.html(a),this.$backdrop[this.model.get("backdrop")?"show":"hide"](),this.field.collapsed||this.model.get("disabled")?this.$field.hide():this.$field.show(),this.field.model&&this.field.model.set({color:this.model.get("color"),style:this.model.get("style")}),this.model.get("disabled")||void 0===this.model.get("collapsible_value"))this.$title_text.show().text(this.model.get("label")),this.$collapsible.hide();else{var s=this.field.collapsed?"enable":"disable";this.$title_text.hide(),this.$collapsible.show(),this.$collapsible_text.text(this.model.get("label")),this.$collapsible_icon.removeClass().addClass("icon").addClass(this.model.get("cls_"+s)).attr("data-original-title",this.model.get("text_"+s)).tooltip({placement:"bottom"})}},_template:function(){return i("<div/>").addClass("ui-form-element").append(i("<div/>").addClass("ui-form-error ui-error").append(i("<span/>").addClass("fa fa-arrow-down")).append(i("<span/>").addClass("ui-form-error-text"))).append(i("<div/>").addClass("ui-form-title").append(i("<div/>").addClass("ui-form-collapsible").append(i("<i/>").addClass("ui-form-collapsible-icon")).append(i("<span/>").addClass("ui-form-collapsible-text"))).append(i("<span/>").addClass("ui-form-title-text"))).append(i("<div/>").addClass("ui-form-field").append(i("<span/>").addClass("ui-form-info")).append(i("<div/>").addClass("ui-form-backdrop"))).append(i("<div/>").addClass("ui-form-preview"))}})}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(4),d=s(l),c=i(52),u=s(c),h=i(53),f=s(h),p=i(54),m=s(p),_=i(55),g=s(_),v=i(57),w=s(v);t.default=e.Model.extend({types:{text:"_fieldText",password:"_fieldText",select:"_fieldSelect",data_column:"_fieldSelect",genomebuild:"_fieldSelect",data:"_fieldData",data_collection:"_fieldData",integer:"_fieldSlider",float:"_fieldSlider",boolean:"_fieldBoolean",drill_down:"_fieldDrilldown",color:"_fieldColor",hidden:"_fieldHidden",hidden_data:"_fieldHidden",baseurl:"_fieldHidden",library_data:"_fieldLibrary",ftpfile:"_fieldFtp",upload:"_fieldUpload",genomespacefile:"_fieldGenomeSpace"},create:function(e){var t=this.types[e.type],i="function"==typeof this[t]?this[t].call(this,e):null;return i||(i=e.options?this._fieldSelect(e):this._fieldText(e),Galaxy.emit.debug("form-parameters::_addRow()","Auto matched field type ("+e.type+").")),void 0===e.value&&(e.value=null),i.value(e.value),i},_fieldData:function(e){return new u.default.View({id:"field-"+e.id,extensions:e.extensions,optional:e.optional,multiple:e.multiple,type:e.type,flavor:e.flavor,data:e.options,onchange:e.onchange})},_fieldSelect:function(e){if(e.is_workflow)return this._fieldText(e);"data_column"==e.type&&(e.error_text="Missing columns in referenced dataset.");var t=e.data;t||(t=[],n.each(e.options,function(e){t.push({label:e[0],value:e[1]})}));var i=d.default.Select;switch(e.display){case"checkboxes":i=d.default.Checkbox;break;case"radio":i=d.default.Radio;break;case"radiobutton":i=d.default.RadioButton}return new i.View({id:"field-"+e.id,data:t,error_text:e.error_text||"No options available",readonly:e.readonly,multiple:e.multiple,optional:e.optional,onchange:e.onchange,individual:e.individual,searchable:"workflow"!==e.flavor})},_fieldDrilldown:function(e){return e.is_workflow?this._fieldText(e):new d.default.Drilldown.View({id:"field-"+e.id,data:e.options,display:e.display,optional:e.optional,onchange:e.onchange})},_fieldText:function(e){if(e.options&&e.data)if(e.area=e.multiple,r.default.isEmpty(e.value))e.value=null;else if(a.isArray(e.value)){var t="";for(var i in e.value){if(t+=String(e.value[i]),!e.multiple)break;t+="\n"}e.value=t}return new d.default.Input({id:"field-"+e.id,type:e.type,area:e.area,readonly:e.readonly,placeholder:e.placeholder,datalist:e.datalist,onchange:e.onchange})},_fieldSlider:function(e){return new d.default.Slider.View({id:"field-"+e.id,precise:"float"==e.type,is_workflow:e.is_workflow,min:e.min,max:e.max,onchange:e.onchange})},_fieldHidden:function(e){return new d.default.Hidden({id:"field-"+e.id,info:e.info})},_fieldBoolean:function(e){return new d.default.RadioButton.View({id:"field-"+e.id,data:[{label:"Yes",value:"true"},{label:"No",value:"false"}],onchange:e.onchange})},_fieldColor:function(e){return new w.default({id:"field-"+e.id,onchange:e.onchange})},_fieldLibrary:function(e){return new f.default.View({id:"field-"+e.id,optional:e.optional,multiple:e.multiple,onchange:e.onchange})},_fieldFtp:function(e){return new m.default.View({id:"field-"+e.id,optional:e.optional,multiple:e.multiple,onchange:e.onchange})},_fieldGenomeSpace:function(e){var t=this;return new g.default.View({id:"field-"+e.id,onchange:function(){t.app.trigger("change")}})},_fieldUpload:function(e){return new d.default.Upload({id:"field-"+e.id,onchange:e.onchange})}})}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(4),d=s(l),c=i(22),u=s(c),h={DISABLED:"disabled",ENABLED:"enabled",LINKED:"linked"},f={data:[{src:"hda",icon:"fa-file-o",tooltip:"Single dataset",multiple:!1,batch:h.DISABLED},{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:h.LINKED},{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:h.LINKED}],data_multiple:[{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:h.DISABLED},{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collections",multiple:!0,batch:h.DISABLED}],data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:h.DISABLED}],workflow_data:[{src:"hda",icon:"fa-file-o",tooltip:"Single dataset",multiple:!1,batch:h.DISABLED}],workflow_data_multiple:[{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:h.DISABLED}],workflow_data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:h.DISABLED}],module_data:[{src:"hda",icon:"fa-file-o",tooltip:"Single dataset",multiple:!1,batch:h.DISABLED},{src:"hda",icon:"fa-files-o",tooltip:"Multiple datasets",multiple:!0,batch:h.ENABLED}],module_data_collection:[{src:"hdca",icon:"fa-folder-o",tooltip:"Dataset collection",multiple:!1,batch:h.DISABLED},{src:"hdca",icon:"fa-folder",tooltip:"Multiple collections",multiple:!0,batch:h.ENABLED}]},p=e.View.extend({initialize:function(t){var i=this;this.model=t&&t.model||new e.Model({src_labels:{hda:"dataset",hdca:"dataset collection"},pagelimit:100,statustimer:1e3}).set(t),this.setElement(n("<div/>").addClass("ui-select-content")),this.button_product=new d.default.RadioButton.View({value:"false",data:[{icon:"fa fa-chain",value:"false",tooltip:"Linked inputs will be run in matched order with other datasets e.g. use this for matching forward and reverse reads."},{icon:"fa fa-chain-broken",value:"true",tooltip:"Unlinked dataset inputs will be run against *all* other inputs."}]});var a=n("<div/>").addClass("ui-form-info").append(n("<i/>").addClass("fa fa-sitemap")).append(n("<span/>").html("This is a batch mode input field. Separate jobs will be triggered for each dataset selection."));this.$batch={linked:a.clone(),enabled:a.clone().append(n("<div/>").append(n("<div/>").addClass("ui-form-title").html("Batch options:")).append(this.button_product.$el)).append(n("<div/>").css("clear","both"))},this.$el.on("dragenter",function(e){this.lastenter=e.target,i.$el.addClass("ui-dragover")}).on("dragover",function(e){e.preventDefault()}).on("dragleave",function(e){this.lastenter===e.target&&i.$el.removeClass("ui-dragover")}).on("drop",function(e){i._handleDrop(e)}),this.history={},this.listenTo(this.model,"change:data",this._changeData,this),this.listenTo(this.model,"change:wait",this._changeWait,this),this.listenTo(this.model,"change:current",this._changeCurrent,this),this.listenTo(this.model,"change:value",this._changeValue,this),this.listenTo(this.model,"change:type change:optional change:multiple change:extensions",this._changeType,this),this.render(),this.on("change",function(){t.onchange&&t.onchange(i.value())})},render:function(){this._changeType(),this._changeValue(),this._changeWait()},wait:function(){this.model.set("wait",!0)},unwait:function(){this.model.set("wait",!1)},update:function(e){this.model.set("data",e)},value:function(e){void 0!==e&&this.model.set("value",e);var t=this.model.get("current");if(this.config[t]){var i=this.fields[t].value();if(null!==i&&(i=n.isArray(i)?i:[i],i.length>0)){var a=this._batch({values:[]});for(var s in i){var o=this.history[i[s]+"_"+this.config[t].src];if(!o)return Galaxy.emit.debug("ui-select-content::value()","Requested details not found for '"+i[s]+"'."),null;a.values.push(o)}return a.values.sort(function(e,t){return e.hid-t.hid}),a}}else Galaxy.emit.debug("ui-select-content::value()","Invalid value/source '"+e+"'.");return null},_changeCurrent:function(){var e=this;a.each(this.fields,function(t,i){e.model.get("current")==i?(t.$el.show(),a.each(e.$batch,function(t,n){t[e.config[i].batch==n?"show":"hide"]()}),e.button_type.value(i)):t.$el.hide()})},_changeType:function(){var e=this,t=(this.model.get("flavor")?this.model.get("flavor")+"_":"")+String(this.model.get("type"))+(this.model.get("multiple")?"_multiple":"");f[t]?this.config=f[t]:(this.config=f.data,Galaxy.emit.debug("ui-select-content::_changeType()","Invalid configuration/type id '"+t+"'."));var i=e.model.get("data"),n=r.default.textify(this.model.get("extensions")),s=this.model.get("src_labels");this.fields=[],this.button_data=[],a.each(this.config,function(t,a){e.button_data.push({value:a,icon:t.icon,tooltip:t.tooltip}),e.fields.push(new u.default.View({optional:e.model.get("optional"),multiple:t.multiple,searchable:!t.multiple||i&&i[t.src]&&i[t.src].length>e.model.get("pagelimit"),individual:!0,error_text:"No "+(n?n+" ":"")+(s[t.src]||"content")+" available.",onchange:function(){e.trigger("change")}}))}),this.button_type=new d.default.RadioButton.View({value:this.model.get("current"),data:this.button_data,onchange:function(t){e.model.set("current",t),e.trigger("change")}}),this.$el.empty();var o=0;this.fields.length>1&&(this.$el.append(this.button_type.$el),o=Math.max(0,36*this.fields.length)+"px"),a.each(this.fields,function(t){e.$el.append(t.$el.css({"margin-left":o}))}),a.each(this.$batch,function(t,i){e.$el.append(t.css({"margin-left":o}))}),this.model.set("current",0),this._changeCurrent(),this._changeData()},_changeWait:function(){var e=this;a.each(this.fields,function(t){t[e.model.get("wait")?"wait":"unwait"]()})},_changeData:function(){var e=this.model.get("data"),t=this,i={};a.each(e,function(e,n){i[n]=[],a.each(e,function(e){i[n].push({hid:e.hid,keep:e.keep,label:e.hid+": "+e.name,value:e.id,tags:e.tags}),t.history[e.id+"_"+n]=e})}),a.each(this.config,function(e,n){i[e.src]&&t.fields[n].add(i[e.src],function(e,t){return t.hid-e.hid})})},_changeValue:function(){var e=this.model.get("value");if(e&&e.values&&e.values.length>0){var t=[];a.each(e.values,function(e){t.push(e.id)});for(var i=e.values[0].src,n=e.values.length>1,s=0;s<this.config.length;s++){var o=this.fields[s],r=this.config[s];if(r.src==i&&-1!==[n,!0].indexOf(r.multiple)){this.model.set("current",s),o.value(t);break}}}else a.each(this.fields,function(e){e.value(null)})},_handleDrop:function(e){try{var t=this.model.get("data"),i=this.model.get("current"),n=this.config[i],s=this.fields[i],o=JSON.parse(e.originalEvent.dataTransfer.getData("text"))[0],r=o.id,l="dataset"==o.history_content_type?"hda":"hdca",d={id:r,src:l};if(t&&a.findWhere(t[l],d)){if(n.src==l){var c=s.value();c&&n.multiple?-1==c.indexOf(r)&&c.push(r):c=r,s.value(c)}else this.model.set("value",{values:[d]}),this.model.trigger("change:value");this.trigger("change"),this._handleDropStatus("success")}else this._handleDropStatus("danger")}catch(e){this._handleDropStatus("danger")}e.preventDefault()},_handleDropStatus:function(e){var t=this;this.$el.removeClass("ui-dragover").addClass("ui-dragover-"+e),setTimeout(function(){t.$el.removeClass("ui-dragover-"+e)},this.model.get("statustimer"))},_batch:function(e){e.batch=!1;var t=this.model.get("current"),i=this.config[t];if("hdca"==i.src&&!i.multiple){var n=this.history[this.fields[t].value()+"_hdca"];n&&n.map_over_type&&(e.batch=!0)}return i.batch!=h.LINKED&&i.batch!=h.ENABLED||(e.batch=!0,i.batch==h.ENABLED&&"true"===this.button_product.value()&&(e.product=!0)),e}});t.default={View:p}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=(n(a),i(4)),o=n(s),r=i(43),l=(n(r),i(24)),d=n(l),c=e.Collection.extend({url:Galaxy.root+"api/libraries?deleted=false"}),u=e.Collection.extend({initialize:function(){var t=this;this.config=new e.Model({library_id:null}),this.config.on("change",function(){t.fetch({reset:!0})})},url:function(){return Galaxy.root+"api/libraries/"+this.config.get("library_id")+"/contents"}}),h=e.View.extend({initialize:function(e){var t=this;this.libraries=new c,this.datasets=new u,this.options=e,this.library_select=new o.default.Select.View({onchange:function(e){t.datasets.config.set("library_id",e)}}),this.dataset_list=new d.default.View({name:"dataset",optional:e.optional,multiple:e.multiple,onchange:function(){t.trigger("change")}}),this.libraries.on("reset",function(){var e=[];t.libraries.each(function(t){e.push({value:t.id,label:t.get("name")})}),t.library_select.update(e)}),this.datasets.on("reset",function(){var e=[];null!==t.library_select.text()&&t.datasets.each(function(t){"file"===t.get("type")&&e.push({value:t.id,label:t.get("name")})}),t.dataset_list.update(e)}),this.on("change",function(){e.onchange&&e.onchange(t.value())}),this.setElement(this._template()),this.$(".library-select").append(this.library_select.$el),this.$el.append(this.dataset_list.$el),this.libraries.fetch({reset:!0,success:function(){t.library_select.trigger("change"),void 0!==t.options.value&&t.value(t.options.value)}})},value:function(e){return this.dataset_list.value(e)},_template:function(){return'<div class="ui-select-library"><div class="library ui-margin-bottom"><span class="library-title">Select Library</span><span class="library-select"/></div></div>'}});t.default={View:h}}).call(t,i(1))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=n(a),o=i(24),r=n(o),l=e.View.extend({initialize:function(e){var t=this;this.ftpfile_list=new r.default.View({name:"file",optional:e.optional,multiple:e.multiple,onchange:function(){e.onchange&&e.onchange(t.value())}}),this.setElement(this.ftpfile_list.$el),s.default.get({url:Galaxy.root+"api/remote_files",success:function(e){var i=[];for(var n in e)i.push({value:e[n].path,label:e[n].path});t.ftpfile_list.update(i)}})},value:function(e){return this.ftpfile_list.value(e)}});t.default={View:l}}).call(t,i(1))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=(n(a),i(4)),o=n(s),r=i(56),l=n(r),d=e.View.extend({initialize:function(e){var t=this;this.browse_button=new o.default.ButtonIcon({title:"Browse",icon:"fa fa-sign-in",tooltip:"Browse GenomeSpace",onclick:function(){t.browseGenomeSpace()}}),this.filename_textbox=new o.default.Input,this.token_textbox=new o.default.Input({type:"password"}),this.setElement(this._template(e)),this.$(".ui-gs-browse-button").append(this.browse_button.$el),this.$(".ui-gs-filename-textbox").append(this.filename_textbox.$el),this.$(".ui-gs-token-textbox").append(this.token_textbox.$el)},browseGenomeSpace:function(e){var t=this;l.default.openFileBrowser({successCallback:function(e){t.value(e.destination+"^"+e.token)}})},_template:function(e){return'<div class="ui-gs-select-file"><div class="ui-gs-browse-field"><span class="ui-gs-browse-button" /><span class="ui-gs-filename-textbox" /></div><div class="ui-gs-token-field"><span class=ui-gs-label"><div class="ui-gs-token-label">Token</div></span><span class="ui-gs-token-textbox" /></div></div>'},value:function(e){if(void 0===e)return this._getValue();this._setValue(e)},_getValue:function(){return this.filename_textbox.value()+"^"+this.token_textbox.value()},_setValue:function(e){e&&(values=e.split("^"),this.filename_textbox.value(values[0]),this.token_textbox.value(values[1]))}});t.default={View:d}}).call(t,i(1))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={openFileBrowser:function(e){var t=window.Galaxy.config.genomespace_ui_url,i=t+"upload/loadUrlToGenomespace.html?getLocation=true",n=window.open(i,"GenomeSpace File Browser","height=360px,width=600px");successCalBack=e.successCallback,window.addEventListener("message",function(e){successCalBack(e.data)},!1),n.focus(),null!=e.errorCallback&&(n.setCallbackOnGSUploadError=config.errorCallback)}}},function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=e.View.extend({colors:{standard:["c00000","ff0000","ffc000","ffff00","92d050","00b050","00b0f0","0070c0","002060","7030a0"],base:["ffffff","000000","eeece1","1f497d","4f81bd","c0504d","9bbb59","8064a2","4bacc6","f79646"],theme:[["f2f2f2","7f7f7f","ddd9c3","c6d9f0","dbe5f1","f2dcdb","ebf1dd","e5e0ec","dbeef3","fdeada"],["d8d8d8","595959","c4bd97","8db3e2","b8cce4","e5b9b7","d7e3bc","ccc1d9","b7dde8","fbd5b5"],["bfbfbf","3f3f3f","938953","548dd4","95b3d7","d99694","c3d69b","b2a2c7","92cddc","fac08f"],["a5a5a5","262626","494429","17365d","366092","953734","76923c","5f497a","31859b","e36c09"],["7f7f7e","0c0c0c","1d1b10","0f243e","244061","632423","4f6128","3f3151","205867","974806"]]},initialize:function(e){this.options=s.default.merge(e,{}),this.setElement(this._template()),this.$panel=this.$(".ui-color-picker-panel"),this.$view=this.$(".ui-color-picker-view"),this.$value=this.$(".ui-color-picker-value"),this.$header=this.$(".ui-color-picker-header"),this._build(),this.visible=!1,this.value(this.options.value),this.$boxes=this.$(".ui-color-picker-box");var t=this;this.$boxes.on("click",function(){t.value(n(this).css("background-color")),t.$header.trigger("click")}),this.$header.on("click",function(){t.visible=!t.visible,t.visible?t.$view.fadeIn("fast"):t.$view.fadeOut("fast")})},value:function(e){return void 0!==e&&null!==e&&(this.$value.css("background-color",e),this.$(".ui-color-picker-box").empty(),this.$(this._getValue()).html(this._templateCheck()),this.options.onchange&&this.options.onchange(e)),this._getValue()},_getValue:function(){var e=this.$value.css("background-color");if(e=e.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/)){var t=function(e){return("0"+parseInt(e).toString(16)).slice(-2)};return"#"+t(e[1])+t(e[2])+t(e[3])}return null},_build:function(){this._content({colors:this.colors.base});for(var e in this.colors.theme){var t={};0==e?t.bottom=!0:e!=this.colors.theme.length-1?(t.top=!0,t.bottom=!0):t.top=!0,t.colors=this.colors.theme[e],this._content(t)}this._content({colors:this.colors.standard})},_content:function(e){var t=e.colors,i=n(this._templateContent()),a=i.find(".line");this.$panel.append(i);for(var s in t){var o=n(this._templateBox(t[s]));e.top&&(o.css("border-top","none"),o.css("border-top-left-radius","0px"),o.css("border-top-right-radius","0px")),e.bottom&&(o.css("border-bottom","none"),o.css("border-bottom-left-radius","0px"),o.css("border-bottom-right-radius","0px")),a.append(o)}return i},_templateCheck:function(){return'<div class="ui-color-picker-check fa fa-check"/>'},_templateContent:function(){return'<div class="ui-color-picker-content"><div class="line"/></div>'},_templateBox:function(e){return'<div id="'+e+'" class="ui-color-picker-box" style="background-color: #'+e+';"/>'},_template:function(){return'<div class="ui-color-picker"><div class="ui-color-picker-header"><div class="ui-color-picker-value"/><div class="ui-color-picker-label">Select a color</div></div><div class="ui-color-picker-view ui-input"><div class="ui-color-picker-panel"/></div>'}})}).call(t,i(1),i(0))},,function(e,t,i){"use strict";function n(e,t){var i=void 0!==e.prototype?e.prototype:e;return void 0!==t&&(i._logNamespace=t),a.forEach(function(e){i[e]=function(){if(this.logger)return this.logger.emit?this.logger.emit(e,this._logNamespace,arguments):this.logger[e]?this.logger[e].apply(this.logger,arguments):void 0}}),e}Object.defineProperty(t,"__esModule",{value:!0});var a=["log","debug","info","warn","error","metric"];t.default=n},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=(a(s),i(61)),r=a(o),l=i(4),d=a(l),c=i(20),u=a(c),h=i(62),f=a(h),p=i(142),m=a(p);t.default=u.default.extend({initialize:function(e){var t=this;this.deferred=new r.default,u.default.prototype.initialize.call(this,e),this._update(this.model.get("initialmodel")),this.model.get("listen_to_history")&&parent.Galaxy&&parent.Galaxy.currHistoryPanel&&this.listenTo(parent.Galaxy.currHistoryPanel.collection,"change",function(){t.model.get("onchange")()}),this.$el.on("remove",function(){t._destroy()})},_update:function(e){var t=this;e=e||this.model.get("buildmodel"),e?(this.deferred.reset(),this.deferred.execute(function(i){e(i,t),i.then(function(){t._render()})})):this._render()},_destroy:function(){var e=this;this.$el.off().hide(),this.deferred.execute(function(){u.default.prototype.remove.call(e),Galaxy.emit.debug("tool-form-base::_destroy()","Destroy view.")})},_render:function(){var t=this,i=this.model.attributes;this.model.set({title:i.fixed_title||"<b>"+i.name+"</b> "+i.description+" (Galaxy Version "+i.version+")",operations:!i.hide_operations&&this._operations(),onchange:function(){t.deferred.reset(),t.deferred.execute(function(e){t.model.get("postchange")(e,t)})}}),this.render(),this.model.get("collapsible")||this.$el.append(e("<div/>").addClass("ui-margin-top-large").append(this._footer())),this.show_message&&this.message.update({status:"success",message:"Now you are using '"+i.name+"' version "+i.version+", id '"+i.id+"'.",persistent:!1}),this.show_message=!0},_operations:function(){var t=this,i=this.model.attributes,a=new d.default.ButtonMenu({icon:"fa-cubes",title:!i.narrow&&"Versions"||null,tooltip:"Select another tool version"});if(!i.sustain_version&&i.versions&&i.versions.length>1)for(var s in i.versions){var o=i.versions[s];o!=i.version&&a.addMenu({title:"Switch to "+o,version:o,icon:"fa-cube",onclick:function(){t.model.set("id",i.id.replace(i.version,this.version)),t.model.set("version",this.version),t._update()}})}else a.$el.hide();var r=new d.default.ButtonMenu({id:"options",icon:"fa-caret-down",title:!i.narrow&&"Options"||null,tooltip:"View available options"});return i.biostar_url&&(r.addMenu({icon:"fa-question-circle",title:"Question?",onclick:function(){window.open(i.biostar_url+"/p/new/post/")}}),r.addMenu({icon:"fa-search",title:"Search",onclick:function(){window.open(i.biostar_url+"/local/search/page/?q="+i.name)}})),r.addMenu({icon:"fa-share",title:"Share",onclick:function(){prompt("Copy to clipboard: Ctrl+C, Enter",window.location.origin+Galaxy.root+"root?tool_id="+i.id)}}),Galaxy.user&&Galaxy.user.get("is_admin")&&r.addMenu({icon:"fa-download",title:"Download",onclick:function(){window.location.href=Galaxy.root+"api/tools/"+i.id+"/download"}}),i.requirements&&i.requirements.length>0&&r.addMenu({icon:"fa-info-circle",title:"Requirements",onclick:function(){!this.requirements_visible||t.portlet.collapsed?(this.requirements_visible=!0,t.portlet.expand(),t.message.update({persistent:!0,message:t._templateRequirements(i),status:"info"})):(this.requirements_visible=!1,t.message.update({message:""}))}}),i.sharable_url&&r.addMenu({icon:"fa-external-link",title:"See in Tool Shed",onclick:function(){window.open(i.sharable_url)}}),e.getJSON("/api/webhooks/tool-menu/all",function(e){n.each(e,function(e){e.activate&&e.config.function&&r.addMenu({icon:e.config.icon,title:e.config.title,onclick:function(){new Function("options",e.config.function)(i)}})})}),{menu:r,versions:a}},_footer:function(){var t=this.model.attributes,i=e("<div/>").append(this._templateHelp(t));if(t.citations){var n=m.default.extend(f.default),a=document.createElement("div");i.append(a),new n({propsData:{id:t.id,source:"tools"}}).$mount(a)}return i},_templateHelp:function(t){var i=e("<div/>").addClass("ui-form-help").append(t.help);return i.find("a").attr("target","_blank"),i},_templateRequirements:function(t){var i=t.requirements.length;if(i>0){var a="This tool requires ";n.each(t.requirements,function(e,t){a+=e.name+(e.version?" (Version "+e.version+")":"")+(t<i-2?", ":t==i-2?" and ":"")});var s=e("<a/>").attr("target","_blank").attr("href","https://galaxyproject.org/tools/requirements/").text("here");return e("<span/>").append(a+". Click ").append(s).append(" for more information.")}return"No requirements found."}})}).call(t,i(0),i(2))},function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default=e.Model.extend({initialize:function(){this.active={},this.last=null},execute:function(e){var t=this,i=s.default.uid(),a=e.length>0;this.active[i]=!0;var o=n.Deferred();o.promise().always(function(){delete t.active[i],a&&Galaxy.emit.debug("deferred::execute()",this.state().charAt(0).toUpperCase()+this.state().slice(1)+" "+i)}),n.when(this.last).always(function(){t.active[i]?(a&&Galaxy.emit.debug("deferred::execute()","Running "+i),e(o),!a&&o.resolve()):o.reject()}),this.last=o.promise()},reset:function(){Galaxy.emit.debug("deferred::execute()","Reset");for(var e in this.active)this.active[e]=!1},ready:function(){return n.isEmptyObject(this.active)}})}).call(t,i(1),i(0))},function(e,t,i){"use strict";function n(e){i(69)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(72),s=i.n(a),o=i(138),r=i(65),l=n,d=r(s.a,o.a,!1,l,null,null);t.default=d.exports},function(e,t){function i(e,t){var i=e[1]||"",a=e[3];if(!a)return i;if(t&&"function"==typeof btoa){var s=n(a);return[i].concat(a.sources.map(function(e){return"/*# sourceURL="+a.sourceRoot+e+" */"})).concat([s]).join("\n")}return[i].join("\n")}function n(e){return"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(e))))+" */"}e.exports=function(e){var t=[];return t.toString=function(){return this.map(function(t){var n=i(t,e);return t[2]?"@media "+t[2]+"{"+n+"}":n}).join("")},t.i=function(e,i){"string"==typeof e&&(e=[[null,e,""]]);for(var n={},a=0;a<this.length;a++){var s=this[a][0];"number"==typeof s&&(n[s]=!0)}for(a=0;a<e.length;a++){var o=e[a];"number"==typeof o[0]&&n[o[0]]||(i&&!o[2]?o[2]=i:i&&(o[2]="("+o[2]+") and ("+i+")"),t.push(o))}},t}},function(e,t,i){function n(e){for(var t=0;t<e.length;t++){var i=e[t],n=c[i.id];if(n){n.refs++;for(var a=0;a<n.parts.length;a++)n.parts[a](i.parts[a]);for(;a<i.parts.length;a++)n.parts.push(s(i.parts[a]));n.parts.length>i.parts.length&&(n.parts.length=i.parts.length)}else{for(var o=[],a=0;a<i.parts.length;a++)o.push(s(i.parts[a]));c[i.id]={id:i.id,refs:1,parts:o}}}}function a(){var e=document.createElement("style");return e.type="text/css",u.appendChild(e),e}function s(e){var t,i,n=document.querySelector('style[data-vue-ssr-id~="'+e.id+'"]');if(n){if(p)return m;n.parentNode.removeChild(n)}if(_){var s=f++;n=h||(h=a()),t=o.bind(null,n,s,!1),i=o.bind(null,n,s,!0)}else n=a(),t=r.bind(null,n),i=function(){n.parentNode.removeChild(n)};return t(e),function(n){if(n){if(n.css===e.css&&n.media===e.media&&n.sourceMap===e.sourceMap)return;t(e=n)}else i()}}function o(e,t,i,n){var a=i?"":n.css;if(e.styleSheet)e.styleSheet.cssText=g(t,a);else{var s=document.createTextNode(a),o=e.childNodes;o[t]&&e.removeChild(o[t]),o.length?e.insertBefore(s,o[t]):e.appendChild(s)}}function r(e,t){var i=t.css,n=t.media,a=t.sourceMap;if(n&&e.setAttribute("media",n),a&&(i+="\n/*# sourceURL="+a.sources[0]+" */",i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),e.styleSheet)e.styleSheet.cssText=i;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(i))}}var l="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!l)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var d=i(71),c={},u=l&&(document.head||document.getElementsByTagName("head")[0]),h=null,f=0,p=!1,m=function(){},_="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());e.exports=function(e,t,i){p=i;var a=d(e,t);return n(a),function(t){for(var i=[],s=0;s<a.length;s++){var o=a[s],r=c[o.id];r.refs--,i.push(r)}t?(a=d(e,t),n(a)):a=[];for(var s=0;s<i.length;s++){var r=i[s];if(0===r.refs){for(var l=0;l<r.parts.length;l++)r.parts[l]();delete c[r.id]}}}};var g=function(){var e=[];return function(t,i){return e[t]=i,e.filter(Boolean).join("\n")}}()},function(e,t){e.exports=function(e,t,i,n,a,s){var o,r=e=e||{},l=typeof e.default;"object"!==l&&"function"!==l||(o=e,r=e.default);var d="function"==typeof r?r.options:r;t&&(d.render=t.render,d.staticRenderFns=t.staticRenderFns,d._compiled=!0),i&&(d.functional=!0),a&&(d._scopeId=a);var c;if(s?(c=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(s)},d._ssrRegister=c):n&&(c=n),c){var u=d.functional,h=u?d.render:d.beforeCreate;u?(d._injectStyles=c,d.render=function(e,t){return c.call(t),h(e,t)}):d.beforeCreate=h?[].concat(h,c):[c]}return{esModule:o,exports:r,options:d}}},function(e,t,i){e.exports=i(73)},function(e,t,i){"use strict";(function(e,i,n,a){Object.defineProperty(t,"__esModule",{value:!0});var s=e.View.extend({initialize:function(e,t){this.$button=e,this.$button.length||(this.$button=i("<div/>")),this.options=t||[],this.$button.data("popupmenu",this);var n=this;this.$button.click(function(e){return i(".popmenu-wrapper").remove(),n._renderAndShow(e),!1})},_renderAndShow:function(e){this.render(),this.$el.appendTo("body").css(this._getShownPosition(e)).show(),this._setUpCloseBehavior()},render:function(){if(this.$el.addClass("popmenu-wrapper").hide().css({position:"absolute"}).html(this.template(this.$button.attr("id"),this.options)),this.options.length){var e=this;this.$el.find("li").each(function(t,n){var a=e.options[t];a.func&&i(this).children("a.popupmenu-option").click(function(t){a.func.call(e,t,a),t.preventDefault()})})}return this},template:function(e,t){return['<ul id="',e,'-menu" class="dropdown-menu">',this._templateOptions(t),"</ul>"].join("")},_templateOptions:function(e){return e.length?n.map(e,function(e){return e.divider?'<li class="divider"></li>':e.header?['<li class="head"><a href="javascript:void(0);">',e.html,"</a></li>"].join(""):['<li><a class="popupmenu-option" href="',e.href||"javascript:void(0);",'"',e.target?' target="'+e.target+'"':"",">",e.checked?'<span class="fa fa-check"></span>':"",e.html,"</a></li>"].join("")}).join(""):"<li>(no options)</li>"},_getShownPosition:function(e){var t=this.$el.width(),n=e.pageX-t/2;return n=Math.min(n,i(document).scrollLeft()+i(window).width()-t-5),n=Math.max(n,i(document).scrollLeft()+5),{top:e.pageY,left:n}},_setUpCloseBehavior:function(){function e(e){if(i(document).off("click.close_popup"),window&&window.parent!==window)try{i(window.parent.document).off("click.close_popup")}catch(e){}else try{i("iframe#galaxy_main").contents().off("click.close_popup")}catch(e){}t.remove()}var t=this;if(i("html").one("click.close_popup",e),window&&window.parent!==window)try{i(window.parent.document).find("html").one("click.close_popup",e)}catch(e){}else try{i("iframe#galaxy_main").contents().one("click.close_popup",e)}catch(e){}},addItem:function(e,t){return t=t>=0?t:this.options.length,this.options.splice(t,0,e),this},removeItem:function(e){return e>=0&&this.options.splice(e,1),this},findIndexByHtml:function(e){for(var t=0;t<this.options.length;t++)if(n.has(this.options[t],"html")&&this.options[t].html===e)return t;return null},findItemByHtml:function(e){return this.options[this.findIndexByHtml(e)]},toString:function(){return"PopupMenu"}});s.create=function(e,t){return new s(e,t)},s.make_popupmenu=function(e,t){var o=[];return n.each(t,function(e,t){var i={html:t};null===e?i.header=!0:"function"===a.type(e)&&(i.func=e),o.push(i)}),new s(i(e),o)},s.convertLinksToOptions=function(e,t){e=i(e),t=t||"a";var n=[];return e.find(t).each(function(e,t){var a={},s=i(e);if(a.html=s.text(),s.attr("href")){var o=s.attr("href"),r=s.attr("target"),l=s.attr("confirm");a.func=function(){if(!l||confirm(l))switch(r){case"_parent":window.parent.location=o;break;case"_top":window.top.location=o;break;default:window.location=o}}}n.push(a)}),n},s.fromExistingDom=function(e,t,n){e=i(e),t=i(t);var a=s.convertLinksToOptions(t,n);return t.remove(),new s(e,a)},s.make_popup_menus=function(e,t,n){e=e||document,t=t||"div[popupmenu]",n=n||function(e,t){return"#"+e.attr("popupmenu")};var a=[];return i(e).find(t).each(function(){var t=i(this),o=i(e).find(n(t,e));a.push(s.fromDom(o,t)),o.addClass("popup")}),a},t.default=s}).call(t,i(1),i(0),i(2),i(0))},function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=(function(e){e&&e.__esModule}(a),e.View.extend({initialize:function(t){this.collection=new e.Collection,this.model=t&&t.model||new e.Model({onchange:null,visible:!0}).set(t),this.setElement(n(this._template())),this.$nav=this.$(".tab-navigation"),this.$content=this.$(".tab-content"),this.$el.on("click",function(){n(".tooltip").hide()}),this.render(),this.listenTo(this.model,"change",this.render,this),this.listenTo(this.collection,"add",this._add,this),this.listenTo(this.collection,"remove",this._remove,this),this.listenTo(this.collection,"change",this._change,this),this.listenTo(this.collection,"reset",this._reset,this),this.listenTo(this.collection,"add remove reset",this.render,this)},render:function(){var e=this.model.get("current");e=this.$("#"+e).length>0?e:this.first(),e&&(this.$nav.children().removeClass("active"),this.$content.children().removeClass("active"),this.$("#tab-"+e).addClass("active"),this.$("#"+e).addClass("active")),this.$el[this.model.get("visible")?"fadeIn":"fadeOut"]("fast"),this.$nav[this.size()>1?"show":"hide"]()},current:function(){return this.model.get("current")},show:function(e){e&&(this.model.set({current:e,visible:!0}),this.model.get("onchange")&&this.model.get("onchange")(e))},hide:function(){this.model.set("visible",!1)},first:function(){var e=this.collection.first();return e&&e.id},size:function(){return this.collection.length},add:function(e){this.collection.add(e)},del:function(e){this.collection.remove(e)},delAll:function(){this.collection.reset()},showTab:function(e){this.collection.get(e).set("hidden",!1)},hideTab:function(e){this.collection.get(e).set("hidden",!0)},_add:function(e){var t=this,i=e.attributes;this.$content.append(n("<div/>").attr("id",i.id).addClass("tab-pane").append(i.$el)),this.$nav.append(n(this._template_tab(i)).show().tooltip({title:i.tooltip,placement:"bottom",container:t.$el}).on("click",function(e){e.preventDefault(),t.show(i.id)})),1==this.size()&&this.show(i.id)},_remove:function(e){this.$("#tab-"+e.id).remove(),this.$("#"+e.id).remove()},_reset:function(){this.$nav.empty(),this.$content.empty()},_change:function(e){this.$("#tab-"+e.id)[e.get("hidden")?"hide":"show"]()},_template:function(){return n("<div/>").addClass("ui-tabs tabbable tabs-left").append(n("<ul/>").addClass("tab-navigation nav nav-tabs")).append(n("<div/>").addClass("tab-content"))},_template_tab:function(e){var t=n("<li/>").addClass("tab-element").attr("id","tab-"+e.id).append(n("<a/>").attr("id","tab-title-link-"+e.id)),i=t.find("a");return e.icon&&i.append(n("<i/>").addClass("tab-icon fa").addClass(e.icon)),i.append(n("<span/>").attr("id","tab-title-text-"+e.id).addClass("tab-title-text").append(e.title)),t}}));t.default={View:s}}).call(t,i(1),i(0))},function(e,t,i){var n=i(70);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);i(64)("52175cf9",n,!0)},function(e,t,i){t=e.exports=i(63)(void 0),t.push([e.i,".citations-formatted{word-wrap:break-word}.citations-bibtex-text{width:100%;height:500px}.citation-padding{padding:5px 10px}",""])},function(e,t){e.exports=function(e,t){for(var i=[],n={},a=0;a<t.length;a++){var s=t[a],o=s[0],r=s[1],l=s[2],d=s[3],c={id:e+":"+a,css:r,media:l,sourceMap:d};n[o]?n[o].parts.push(c):i.push(n[o]={id:o,parts:[c]})}return i}},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i(66),a=function(e){return e&&e.__esModule?e:{default:e}}(n),s=i(92),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(s),r=i(93),l=i(17);t.default={props:{source:{type:String,required:!0},id:{type:String,required:!0},viewRender:{type:Boolean,requried:!1,default:!0}},data:function(){return{citations:[],content:"",errors:[]}},computed:{formattedReferences:function(){var e=this;return this.citations.reduce(function(t,i){return t.concat('<p class="formatted-reference">'+e.formattedReference(i)+"</p>")},"")}},created:function(){var t=this;a.default.get(Galaxy.root+"api/"+this.source+"/"+this.id+"/citations").then(function(i){t.content="";var n=!0,a=!1,s=void 0;try{for(var r,l=i.data[Symbol.iterator]();!(n=(r=l.next()).done);n=!0){var d=r.value;try{var c={fields:{},entryType:void 0},u=o.toJSON(d.content);if(u){u=e.first(u),c.entryType=u.entryType||void 0;for(var h in u.entryTags)c.fields[h.toLowerCase()]=u.entryTags[h]}t.citations.push(c),t.content+=d.content}catch(e){console.warn("Error parsing bibtex: "+e)}}}catch(e){a=!0,s=e}finally{try{!n&&l.return&&l.return()}finally{if(a)throw s}}}).catch(function(e){console.error(e)})},methods:{formattedReference:function(e){var t=e.entryType,i=e.fields,n="",a=this._asSentence((i.author?i.author:"")+(i.year?" ("+i.year+")":""))+" ",s=i.title||"",o=i.pages?"pp. "+i.pages:"",d=i.address;if("article"==t){var c=(i.volume?i.volume:"")+(i.number?" ("+i.number+")":"")+(o?", "+o:"");n=a+this._asSentence(s)+(i.journal?"In <em>"+i.journal+", ":"")+this._asSentence(c)+this._asSentence(i.address)+"</em>"}else n="inproceedings"==t||"proceedings"==t?a+this._asSentence(s)+(i.booktitle?"In <em>"+i.booktitle+", ":"")+(o||"")+(d?", "+d:"")+".</em>":"mastersthesis"==t||"phdthesis"==t?a+this._asSentence(s)+(i.howpublished?i.howpublished+". ":"")+(i.note?i.note+".":""):"techreport"==t?a+this._asSentence(s)+this._asSentence(i.institution)+this._asSentence(i.number)+this._asSentence(i.type):"book"==t||"inbook"==t||"incollection"==t?a+" "+this._formatBookInfo(i):a+" "+this._asSentence(s)+this._asSentence(i.howpublished)+this._asSentence(i.note);var u="";i.doi&&(u="http://dx.doi.org/"+i.doi,n+='[<a href="'+u+'" target="_blank">doi:'+i.doi+"</a>]");var h=i.url||u;return h&&(n+='[<a href="'+h+'" target="_blank">Link</a>]'),(0,r.convertLaTeX)({onError:function(e,t){return"{"+(0,l.stringifyLaTeX)(t)+"}"}},n)},_formatBookInfo:function(e){var t="";return e.chapter&&(t+=e.chapter+" in "),e.title&&(t+="<em>"+e.title+"</em>"),e.editor&&(t+=", Edited by "+e.editor+", "),e.publisher&&(t+=", "+e.publisher),e.pages&&(t+=", pp. "+e.pages),e.series&&(t+=", <em>"+e.series+"</em>"),e.volume&&(t+=", Vol."+e.volume),e.issn&&(t+=", ISBN: "+e.issn),t+"."},_asSentence:function(e){return e&&e.trim()?e+". ":""},toggleViewRender:function(){this.viewRender=!this.viewRender}}}}).call(t,i(2))},function(e,t,i){"use strict";function n(e){var t=new o(e),i=s(o.prototype.request,t);return a.extend(i,o.prototype,t),a.extend(i,t),i}var a=i(5),s=i(27),o=i(75),r=i(16),l=n(r);l.Axios=o,l.create=function(e){return n(a.merge(r,e))},l.Cancel=i(31),l.CancelToken=i(90),l.isCancel=i(30),l.all=function(e){return Promise.all(e)},l.spread=i(91),e.exports=l,e.exports.default=l},function(e,t){function i(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function n(e){return"function"==typeof e.readFloatLE&&"function"==typeof e.slice&&i(e.slice(0,0))}/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
e.exports=function(e){return null!=e&&(i(e)||n(e)||!!e._isBuffer)}},function(e,t,i){"use strict";function n(e){this.defaults=e,this.interceptors={request:new o,response:new o}}var a=i(16),s=i(5),o=i(85),r=i(86);n.prototype.request=function(e){"string"==typeof e&&(e=s.merge({url:arguments[0]},arguments[1])),e=s.merge(a,this.defaults,{method:"get"},e),e.method=e.method.toLowerCase();var t=[r,void 0],i=Promise.resolve(e);for(this.interceptors.request.forEach(function(e){t.unshift(e.fulfilled,e.rejected)}),this.interceptors.response.forEach(function(e){t.push(e.fulfilled,e.rejected)});t.length;)i=i.then(t.shift(),t.shift());return i},s.forEach(["delete","get","head","options"],function(e){n.prototype[e]=function(t,i){return this.request(s.merge(i||{},{method:e,url:t}))}}),s.forEach(["post","put","patch"],function(e){n.prototype[e]=function(t,i,n){return this.request(s.merge(n||{},{method:e,url:t,data:i}))}}),e.exports=n},function(e,t){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function a(e){if(c===setTimeout)return setTimeout(e,0);if((c===i||!c)&&setTimeout)return c=setTimeout,setTimeout(e,0);try{return c(e,0)}catch(t){try{return c.call(null,e,0)}catch(t){return c.call(this,e,0)}}}function s(e){if(u===clearTimeout)return clearTimeout(e);if((u===n||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}function o(){m&&f&&(m=!1,f.length?p=f.concat(p):_=-1,p.length&&r())}function r(){if(!m){var e=a(o);m=!0;for(var t=p.length;t;){for(f=p,p=[];++_<t;)f&&f[_].run();_=-1,t=p.length}f=null,m=!1,s(e)}}function l(e,t){this.fun=e,this.array=t}function d(){}var c,u,h=e.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:i}catch(e){c=i}try{u="function"==typeof clearTimeout?clearTimeout:n}catch(e){u=n}}();var f,p=[],m=!1,_=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];p.push(new l(e,t)),1!==p.length||m||a(r)},l.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=d,h.addListener=d,h.once=d,h.off=d,h.removeListener=d,h.removeAllListeners=d,h.emit=d,h.prependListener=d,h.prependOnceListener=d,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(e,t,i){"use strict";var n=i(5);e.exports=function(e,t){n.forEach(e,function(i,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=i,delete e[n])})}},function(e,t,i){"use strict";var n=i(29);e.exports=function(e,t,i){var a=i.config.validateStatus;i.status&&a&&!a(i.status)?t(n("Request failed with status code "+i.status,i.config,null,i.request,i)):e(i)}},function(e,t,i){"use strict";e.exports=function(e,t,i,n,a){return e.config=t,i&&(e.code=i),e.request=n,e.response=a,e}},function(e,t,i){"use strict";function n(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var a=i(5);e.exports=function(e,t,i){if(!t)return e;var s;if(i)s=i(t);else if(a.isURLSearchParams(t))s=t.toString();else{var o=[];a.forEach(t,function(e,t){null!==e&&void 0!==e&&(a.isArray(e)&&(t+="[]"),a.isArray(e)||(e=[e]),a.forEach(e,function(e){a.isDate(e)?e=e.toISOString():a.isObject(e)&&(e=JSON.stringify(e)),o.push(n(t)+"="+n(e))}))}),s=o.join("&")}return s&&(e+=(-1===e.indexOf("?")?"?":"&")+s),e}},function(e,t,i){"use strict";var n=i(5),a=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,i,s,o={};return e?(n.forEach(e.split("\n"),function(e){if(s=e.indexOf(":"),t=n.trim(e.substr(0,s)).toLowerCase(),i=n.trim(e.substr(s+1)),t){if(o[t]&&a.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([i]):o[t]?o[t]+", "+i:i}}),o):o}},function(e,t,i){"use strict";var n=i(5);e.exports=n.isStandardBrowserEnv()?function(){function e(e){var t=e;return i&&(a.setAttribute("href",t),t=a.href),a.setAttribute("href",t),{href:a.href,protocol:a.protocol?a.protocol.replace(/:$/,""):"",host:a.host,search:a.search?a.search.replace(/^\?/,""):"",hash:a.hash?a.hash.replace(/^#/,""):"",hostname:a.hostname,port:a.port,pathname:"/"===a.pathname.charAt(0)?a.pathname:"/"+a.pathname}}var t,i=/(msie|trident)/i.test(navigator.userAgent),a=document.createElement("a");return t=e(window.location.href),function(i){var a=n.isString(i)?e(i):i;return a.protocol===t.protocol&&a.host===t.host}}():function(){return function(){return!0}}()},function(e,t,i){"use strict";function n(){this.message="String contains an invalid character"}function a(e){for(var t,i,a=String(e),o="",r=0,l=s;a.charAt(0|r)||(l="=",r%1);o+=l.charAt(63&t>>8-r%1*8)){if((i=a.charCodeAt(r+=.75))>255)throw new n;t=t<<8|i}return o}var s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.prototype=new Error,n.prototype.code=5,n.prototype.name="InvalidCharacterError",e.exports=a},function(e,t,i){"use strict";var n=i(5);e.exports=n.isStandardBrowserEnv()?function(){return{write:function(e,t,i,a,s,o){var r=[];r.push(e+"="+encodeURIComponent(t)),n.isNumber(i)&&r.push("expires="+new Date(i).toGMTString()),n.isString(a)&&r.push("path="+a),n.isString(s)&&r.push("domain="+s),!0===o&&r.push("secure"),document.cookie=r.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}()},function(e,t,i){"use strict";function n(){this.handlers=[]}var a=i(5);n.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},n.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},n.prototype.forEach=function(e){a.forEach(this.handlers,function(t){null!==t&&e(t)})},e.exports=n},function(e,t,i){"use strict";function n(e){e.cancelToken&&e.cancelToken.throwIfRequested()}var a=i(5),s=i(87),o=i(30),r=i(16),l=i(88),d=i(89);e.exports=function(e){return n(e),e.baseURL&&!l(e.url)&&(e.url=d(e.baseURL,e.url)),e.headers=e.headers||{},e.data=s(e.data,e.headers,e.transformRequest),e.headers=a.merge(e.headers.common||{},e.headers[e.method]||{},e.headers||{}),a.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||r.adapter)(e).then(function(t){return n(e),t.data=s(t.data,t.headers,e.transformResponse),t},function(t){return o(t)||(n(e),t&&t.response&&(t.response.data=s(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})}},function(e,t,i){"use strict";var n=i(5);e.exports=function(e,t,i){return n.forEach(i,function(i){e=i(e,t)}),e}},function(e,t,i){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,i){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,i){"use strict";function n(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(e){t=e});var i=this;e(function(e){i.reason||(i.reason=new a(e),t(i.reason))})}var a=i(31);n.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},n.source=function(){var e;return{token:new n(function(t){e=t}),cancel:e}},e.exports=n},function(e,t,i){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t,i){!function(e){function t(){this.months=["jan","feb","mar","apr","may","jun","jul","aug","sep","oct","nov","dec"],this.notKey=[",","{","}"," ","="],this.pos=0,this.input="",this.entries=new Array,this.currentEntry="",this.setInput=function(e){this.input=e},this.getEntries=function(){return this.entries},this.isWhitespace=function(e){return" "==e||"\r"==e||"\t"==e||"\n"==e},this.match=function(e,t){if(void 0!=t&&null!=t||(t=!0),this.skipWhitespace(t),this.input.substring(this.pos,this.pos+e.length)!=e)throw"Token mismatch, expected "+e+", found "+this.input.substring(this.pos);this.pos+=e.length,this.skipWhitespace(t)},this.tryMatch=function(e,t){return void 0!=t&&null!=t||(t=!0),this.skipWhitespace(t),this.input.substring(this.pos,this.pos+e.length)==e},this.matchAt=function(){for(;this.input.length>this.pos&&"@"!=this.input[this.pos];)this.pos++;return"@"==this.input[this.pos]},this.skipWhitespace=function(e){for(;this.isWhitespace(this.input[this.pos]);)this.pos++;if("%"==this.input[this.pos]&&1==e){for(;"\n"!=this.input[this.pos];)this.pos++;this.skipWhitespace(e)}},this.value_braces=function(){var e=0;this.match("{",!1);for(var t=this.pos,i=!1;;){if(!i)if("}"==this.input[this.pos]){if(!(e>0)){var n=this.pos;return this.match("}",!1),this.input.substring(t,n)}e--}else if("{"==this.input[this.pos])e++;else if(this.pos>=this.input.length-1)throw"Unterminated value";i="\\"==this.input[this.pos]&&0==i,this.pos++}},this.value_comment=function(){for(var e="",t=0;!this.tryMatch("}",!1)||0!=t;){if(e+=this.input[this.pos],"{"==this.input[this.pos]&&t++,"}"==this.input[this.pos]&&t--,this.pos>=this.input.length-1)throw"Unterminated value:"+this.input.substring(start);this.pos++}return e},this.value_quotes=function(){this.match('"',!1);for(var e=this.pos,t=!1;;){if(!t){if('"'==this.input[this.pos]){var i=this.pos;return this.match('"',!1),this.input.substring(e,i)}if(this.pos>=this.input.length-1)throw"Unterminated value:"+this.input.substring(e)}t="\\"==this.input[this.pos]&&0==t,this.pos++}},this.single_value=function(){var e=this.pos;if(this.tryMatch("{"))return this.value_braces();if(this.tryMatch('"'))return this.value_quotes();var t=this.key();if(t.match("^[0-9]+$"))return t;if(this.months.indexOf(t.toLowerCase())>=0)return t.toLowerCase();throw"Value expected:"+this.input.substring(e)+" for key: "+t},this.value=function(){var e=[];for(e.push(this.single_value());this.tryMatch("#");)this.match("#"),e.push(this.single_value());return e.join("")},this.key=function(e){for(var t=this.pos;;){if(this.pos>=this.input.length)throw"Runaway key";if(this.notKey.indexOf(this.input[this.pos])>=0)return e&&","!=this.input[this.pos]?(this.pos=t,null):this.input.substring(t,this.pos);this.pos++}},this.key_equals_value=function(){var e=this.key();if(this.tryMatch("=")){this.match("=");var t=this.value();return e=e.trim(),[e,t]}throw"... = value expected, equals sign missing:"+this.input.substring(this.pos)},this.key_value_list=function(){var e=this.key_equals_value();for(this.currentEntry.entryTags={},this.currentEntry.entryTags[e[0]]=e[1];this.tryMatch(",")&&(this.match(","),!this.tryMatch("}"));)e=this.key_equals_value(),this.currentEntry.entryTags[e[0]]=e[1]},this.entry_body=function(e){this.currentEntry={},this.currentEntry.citationKey=this.key(!0),this.currentEntry.entryType=e.substring(1),null!=this.currentEntry.citationKey&&this.match(","),this.key_value_list(),this.entries.push(this.currentEntry)},this.directive=function(){return this.match("@"),"@"+this.key()},this.preamble=function(){this.currentEntry={},this.currentEntry.entryType="PREAMBLE",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.comment=function(){this.currentEntry={},this.currentEntry.entryType="COMMENT",this.currentEntry.entry=this.value_comment(),this.entries.push(this.currentEntry)},this.entry=function(e){this.entry_body(e)},this.alernativeCitationKey=function(){this.entries.forEach(function(e){!e.citationKey&&e.entryTags&&(e.citationKey="",e.entryTags.author&&(e.citationKey+=e.entryTags.author.split(",")[0]+=", "),e.citationKey+=e.entryTags.year)})},this.bibtex=function(){for(;this.matchAt();){var e=this.directive();this.match("{"),"@STRING"==e.toUpperCase()?this.string():"@PREAMBLE"==e.toUpperCase()?this.preamble():"@COMMENT"==e.toUpperCase()?this.comment():this.entry(e),this.match("}")}this.alernativeCitationKey()}}e.toJSON=function(e){var i=new t;return i.setInput(e),i.bibtex(),i.entries},e.toBibtex=function(e){var t="";for(var i in e){if(t+="@"+e[i].entryType,t+="{",e[i].citationKey&&(t+=e[i].citationKey+", "),e[i].entry&&(t+=e[i].entry),e[i].entryTags){var n="";for(var a in e[i].entryTags)0!=n.length&&(n+=", "),n+=a+"= {"+e[i].entryTags[a]+"}";t+=n}t+="}\n\n"}return t}}(t)},function(e,t,i){"use strict";function n(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),n(i(94)),n(i(95)),n(i(32)),n(i(35)),n(i(10)),n(i(36)),n(i(136)),n(i(137)),n(i(39))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.aliases={mathfrak:"frak",mathcal:"cal",mathbb:"bb",mathbf:"bf",dfrac:"frac",ldots:"dots"}},function(e,t,i){"use strict";function n(e,t){return s(e,r.mustNotBeUndefined(r.mustBeOk(r.latexParser.parse(t)).value))}function a(e){return s({translateTo:"unicode",mode:"Any"},r.mustNotBeUndefined(r.mustBeOk(r.latexParser.parse(e)).value))}function s(e,t){var i=e.translateTo;switch(i){case"html":throw new Error("Unsupported format: '"+i+"'. Use one of: "+Object.keys(o.supportedMarkups));case"unicode":default:return l.convertLaTeXBlocksToUnicode(e,t).result}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(32),r=i(17),l=i(97);t.convertLaTeX=n,t.convertLaTeXToUnicode=a,t.convertLaTeXBlocks=s},function(e,t,i){"use strict";function n(e,t){var i=e.length,n=t.length;if(0===i)return t;if(0===n)return e;for(var a={},s=0;s<i;s++)a[e[s]]=!0;for(var o=0;o<n;o++)a[t[o]]=!0;var r=[];for(var l in a)a.hasOwnProperty(l)&&r.push(l);return r.sort(),r}function a(e,t){if(!t)return e;if(e.furthest>t.furthest)return e;var i=e.furthest===t.furthest?n(e.expected,t.expected):t.expected;return{status:e.status,index:e.index,value:e.value,furthest:t.furthest,expected:i}}function s(e,t,i,n){return k.Parser(function(s,o){for(var r=n,l=0,d=void 0;o<s.length;){var c=t._(s,o);if(c.status){o=S.mustBeNumber(c.index);break}var u=e._(s,o);if(y(u))return u;if(d=S.mustNotBeUndefined(a(u,d)),y(d))return d;l++;var h=S.mustNotBeUndefined(d.value);r=i(r,h),o=S.mustBeNumber(d.index)}return x(a(k.makeSuccess(o,r),d))})}function o(e,t){return s(e,t,function(e,t){return e.concat([t])},[])}function r(e){return k.Parser(function(t,i){var n=t.charAt(i);if(i>=t.length||e(n))return T.makeFailure(i,"text character");var a=[n];i++;for(var s=t.charAt(i);!e(s)&&i<t.length;)a.push(s),i++,s=t.charAt(i);return k.makeSuccess(i,a.join(""))})}function l(e){return r(c(e)).map(function(e){return $.newTeXRaw(e)})}function d(e,i){return(void 0===i?t.specialCharsDefault:i).hasOwnProperty(e)}function c(e){return function(t){return e.hasOwnProperty(t)}}function u(e,i,n){switch(void 0===i&&(i="_"),void 0===n&&(n="^"),e){case"Math":return t.latexBlockParserMathMode(i,n);default:return t.latexBlockParserTextMode}}function h(e){return e>="A"&&e<="Z"}function f(e){return e>="a"&&e<="z"}function p(e){return z.then(o(u(e,"_"),j)).map(C.newFixArg)}function m(e){return O.then(o(u(e),A)).map(C.newOptArg)}function _(e){return k.alt(p(e),m(e))}function g(e){return k.alt(k.string("{}").map(function(){return[]}),_(e).map(function(e){return e}).atLeast(0)).map(function(e){return e})}function v(e){return k.seqMap(t.commandSymbol,k.alt(t.specialChar,t.takeTill(t.endCmd)),g(e),function(e,t,i){return void 0!==i?C.newTeXComm.apply(void 0,[t].concat(i)):C.newTeXComm(t)}).map(function(e){return e})}function w(e,i,n){return k.seqMap(t.subOrSuperscriptSymbolParser(i,n),g(e),function(e,t){return C.newSubOrSuperScript(e,e===C.SubOrSuperSymbol.SUB?i:n,t)}).map(function(e){return e})}function b(e){return void 0!==e&&!0===e.status}function y(e){return void 0!==e&&!1===e.status}function x(e){if(!b(e))throw new Error("Expected parse to be success: "+JSON.stringify(e));return e}Object.defineProperty(t,"__esModule",{value:!0});var k=i(34),C=i(19),$=i(19),S=i(18),T=i(34);t.defaultParserConf={verbatimEnvironments:["verbatim"]},t.takeTill=function(e){return k.takeWhile(function(t){return!e(t)})};var M=k.regexp(/[^\n]*/),E=k.regexp(/\n?/),P=(k.regexp(/\s*/m),k.string("%")),O=k.string("["),A=k.string("]");t.notTextDefault={$:!0,"%":!0,"\\":!0,"{":!0,"]":!0,"}":!0},t.notTextMathMode={"^":!0,_:!0,$:!0,"%":!0,"\\":!0,"{":!0,"]":!0,"}":!0},t.notTextMathModeAndNotClosingBracket={"^":!0,_:!0,$:!0,"%":!0,"\\":!0,"{":!0,"}":!0},t.notTextDefaultAndNotClosingBracket={$:!0,"%":!0,"\\":!0,"{":!0,"}":!0},t.textParser=l;var D=(l(t.notTextDefault),l(t.notTextDefaultAndNotClosingBracket),k.regexp(/ */).map($.newTeXRaw));t.comment=P.then(M).skip(E).map(C.newTeXComment),t.specialCharsDefault={"'":!0,"(":!0,")":!0,",":!0,".":!0,"-":!0,'"':!0,"!":!0,"^":!0,$:!0,"&":!0,"#":!0,"{":!0,"}":!0,"%":!0,"~":!0,"|":!0,"/":!0,":":!0,";":!0,"=":!0,"[":!0,"]":!0,"\\":!0,"`":!0," ":!0},t.isSpecialCharacter=d,t.isNotText=c,t.mathSymbol=k.string("$"),t.commandSymbol=k.string("\\"),t.latexBlockParser=u,t.latexBlockParserTextMode=k.lazy(function(){return k.alt(k.alt(l(t.notTextDefault),t.dolMath,t.comment,l(t.notTextDefaultAndNotClosingBracket),t.environment,v("Paragraph")))}),t.latexBlockParserMathMode=function(e,i){return k.lazy(function(){return k.alt(k.alt(w("Math",e,i),l(t.notTextMathMode),t.dolMath,t.comment,l(t.notTextMathModeAndNotClosingBracket),t.environment,v("Math")))})},t.latexParser=t.latexBlockParserTextMode.many();var I=k.string("{").then(t.latexBlockParserTextMode.many()).skip(k.string("}"));t.env=k.Parser(function(e,i){var n=k.string("\\begin").then(k.string("{")).then(D).then(k.regexp(/[a-zA-Z]+/)).skip(D).skip(k.string("}"))._(e,i);if(y(n))return n;i=S.mustBeNumber(n.index);var a=n.value;return o(t.latexBlockParserTextMode,k.string("\\end").then(k.string("{")).then(D).then(k.string(a)).then(D).then(k.string("}"))).map(function(e){return C.newTeXEnv(a,e)})._(e,i)}),t.environment=k.alt(I,t.env),t.specialChar=k.test(d),t.endCmd=function(e){return!f(e)&&!h(e)};var z=k.string("{"),j=k.string("}");t.fixArg=p,t.optArg=m,t.cmdArg=_,t.cmdArgs=g,t.command=v,t.subOrSuperscriptSymbolParser=function(e,t){return k.alt(k.string(e),k.string(t)).map(function(t){return t===e?C.SubOrSuperSymbol.SUB:C.SubOrSuperSymbol.SUP})},t.shiftedScript=w,t.dolMath=function(e,t,i){return void 0===e&&(e="Dollar"),void 0===t&&(t="$"),void 0===i&&(i="$"),k.string(t).then(u("Math","_").many().map(function(n){return C.newTeXMath(e,t,i,n)})).skip(k.string(i))}(),t.isOk=b,t.isNotOk=y,t.mustBeOk=x},function(e,t,i){"use strict";function n(e){return"string"==typeof e}function a(e,t){var i=e;do{e++}while(h.isTeXChar(t[e]));return{result:t.slice(i,e).map(function(e){return e.string}).join(""),blockIndex:e}}function s(e,t,i,a){var s=u(e,a);if(n(s))return{result:s,blockIndex:t+1};for(var o=[],l=[];o.length<s.argumentCount&&t<i.length-1;){t++;var d=t;if(i.length<d-1)throw new Error("Could not gobble "+s.argumentCount+" arguments for "+a.name);var c=i[d];if(h.isTeXRaw(c)){for(var f=/\s+/g,p=c.text.replace(x,""),m=-1,_=0;o.length<s.argumentCount;){var g=f.exec(p);if(!g){o.push.apply(o,y.convertToTeXCharsDefault(p));break}var v=p.substring(_,g.index);m=g.index,_=g.index+v.length,o.push.apply(o,y.convertToTeXCharsDefault(v))}m>=0&&l.push(p.substring(m))}else o.push(c)}t++;var w=o.map(function(t){return r(e,[t]).result}).map(h.newTeXRaw).map(function(e){return h.newFixArg([e])});if(w.length<s.argumentCount)throw new Error("Could not find enough arguments for command \\"+s.name+". Expected "+s.argumentCount+", but found "+w.length);var b=[s.apply(function(){},w)];return l.length>0&&b.push(l.join("")),{result:b.join(""),blockIndex:t}}function o(e){return void 0!==e&&"string"==typeof e.string&&"number"==typeof e.category}function r(e,t){var i=0;if(t.length<=0)return{result:"",blockIndex:i};for(var n=[];i<t.length;){var l=t[i];try{if(o(l)){var d=a(i,t);i=d.blockIndex,n.push(d.result)}else if(h.isTeXComm(l)){var c=s(e,i,t,l);i=c.blockIndex,n.push(c.result)}else if(h.isFixArg(l)||h.isOptArg(l)){var c=r(e,l.latex);n.push(c.result),i++}else if(h.isTextHaving(l))n.push(l.text),i++;else{if(h.isTeXMath(l))return r(e,l.latex);if(h.isTeXRaw(l))n.push(l.text),i++;else if(h.isSubOrSuperScript(l)){var u=l.arguments?l.arguments:[],c=s(e,i,t,h.newTeXComm.apply(void 0,[l.type===h.SubOrSuperSymbol.SUB?"mathsubscript":"mathsuperscript"].concat(u)));i=c.blockIndex,n.push(c.result)}else{if(!h.isArray(l))throw new Error("Can't handle LaTeX block yet: "+JSON.stringify(l)+". Leave an issue at https://github.com/digitalheir/tex-to-unicode/issues");var c=r(e,l);n.push(c.result),i++}}}catch(t){if(void 0===e.onError)throw t;var f=e.onError(t,l);if(void 0===f)throw t;n.push(f),i++}}return{result:n.join(""),blockIndex:i}}function l(e,t){if(t.arguments.length>0){var i=_.expand1argsCommand(t.name,r(e,[t.arguments[0]]).result||"");return t.arguments.length>1?i+r(e,t.arguments.slice(1)).result:i}return m.createCommandHandler(t.name,0,1,function(i,n){var a=n[0],s=n.slice(1);return _.expand1argsCommand(t.name,r(e,[a]).result)+r(e,s).result})}function d(e,t){if(t.arguments.length>1){var i=w.expand2argsCommand(t.name,r(e,[t.arguments[0]]).result||"",r(e,[t.arguments[1]]).result||"");return t.arguments.length>2?i+r(e,t.arguments.slice(1)).result:i}return m.createCommandHandler(t.name,0,2,function(i,n){var a=n[0],s=n[1],o=n.slice(2);return w.expand2argsCommand(t.name,r(e,[a]).result,r(e,[s]).result)+r(e,o).result})}function c(e,t){for(var i=void 0,n=void 0,a=0;void 0===n&&a<t.arguments.length;){var s=t.arguments[a],o=r(e,[s]).result;h.isOptArg(s)&&!i?i=o:n=o,a++}return n?v.convertSqrtToUnicode(n,i):m.createCommandHandler(t.name,1,1,function(t,i){var n=i[0],a=v.convertSqrtToUnicode(r(e,[n]).result);if(i.length>1){var s=i.slice(1);return a+r(e,s).result}return a})}function u(e,t){var i=t.name,n=p.expand0argsCommand(i);if(n)return t.arguments&&t.arguments.length>0?n+r(e,t.arguments).result:n;if(g.is1argsCommand(i))return l(e,t);if(b.is2argsCommand(i))return d(e,t);if("sqrt"===i)return c(e,t);throw f.unknownCommandError(i)}Object.defineProperty(t,"__esModule",{value:!0});var h=i(17),f=i(35),p=i(98),m=i(36),_=i(105),g=i(39),v=i(130),w=i(131),b=i(134),y=i(33),x=/^\s*/;t.isTeXChar2=o,t.convertLaTeXBlocksToUnicode=r,t.convertCommand=u},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(99),a=i(100),s=i(101),o=i(102),r=i(103),l=i(104);t.expand0argsCommand=function(e){for(var t=0,i=[s.barredLUnicode,n.spaceUnicode,o.slashedOUnicode,a.characterUnicode,l.specialCharacter,r.cyrillicUnicode];t<i.length;t++){var d=i[t],c=d(e);if(c)return c}}},function(e,t,i){"use strict";function n(e){return t.spaceCharactersUnicode.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.mathSpace="芇",t.spaceCharactersUnicode={",":" ",quad:" ",qquad:"  "," ":" ",space:" ",";":"　",":":"　",hfill:"\t"},t.isSpaceCharactersUnicode=n,t.spaceUnicode=function(e){return n(e)?t.spaceCharactersUnicode[e]:void 0}},function(e,t,i){"use strict";function n(e){return t.characterUnicodeChart.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.characterUnicodeChart={leftrightsquigarrow:"↭",Longleftrightarrow:"⟺",blacktriangleright:"▶",longleftrightarrow:"⟷",blacktriangledown:"▼",blacktriangleleft:"◀",leftrightharpoons:"⇋",rightleftharpoons:"⇌",twoheadrightarrow:"↠",circlearrowright:"↻",downharpoonright:"⇂",rightharpoondown:"⇁",rightrightarrows:"⇉",twoheadleftarrow:"↞",vartriangleright:"⊳",bigtriangledown:"▽",circlearrowleft:"↺",curvearrowright:"↷",downharpoonleft:"⇃",leftharpoondown:"↽",leftrightarrows:"⇆",rightleftarrows:"⇄",rightsquigarrow:"⇝",rightthreetimes:"⋌",trianglerighteq:"⊵",vartriangleleft:"⊲",Leftrightarrow:"⇔",Longrightarrow:"⟹",curvearrowleft:"↶",dashrightarrow:"⇢",doublebarwedge:"⩞",downdownarrows:"⇊",hookrightarrow:"↪",leftleftarrows:"⇇",leftrightarrow:"↔",leftthreetimes:"⋋",longrightarrow:"⟶",looparrowright:"↬",rightarrowtail:"↣",rightharpoonup:"⇀",sphericalangle:"∢",textregistered:"®",trianglelefteq:"⊴",upharpoonright:"↾",Longleftarrow:"⟸",bigtriangleup:"△",blacktriangle:"▲",dashleftarrow:"⇠",divideontimes:"⋇",fallingdotseq:"≒",hookleftarrow:"↩",leftarrowtail:"↢",leftharpoonup:"↼",longleftarrow:"⟵",looparrowleft:"↫",measuredangle:"∡",shortparallel:"∥",smallsetminus:"∖",texttrademark:"™",triangleright:"▷",upharpoonleft:"↿",blacklozenge:"◆",risingdotseq:"≓",triangledown:"▽",triangleleft:"◁",Rrightarrow:"⇛",Updownarrow:"⇕",backepsilon:"∍",blacksquare:"■",circledcirc:"⊚",circleddash:"⊝",curlyeqprec:"⋞",curlyeqsucc:"⋟",diamondsuit:"♢",preccurlyeq:"≼",succcurlyeq:"≽",textgreater:">",thickapprox:"≈",updownarrow:"↕",vartriangle:"△",Lleftarrow:"⇚",Rightarrow:"⇒",circledast:"⊛",complement:"∁",curlywedge:"⋏",longmapsto:"⟼",registered:"®",rightarrow:"→",smallfrown:"⌢",smallsmile:"⌣",sqsubseteq:"⊑",sqsupseteq:"⊒",textlangle:"〈",textrangle:"〉",upuparrows:"⇈",varepsilon:"ε",varnothing:"∅",Downarrow:"⇓",Leftarrow:"⇐",backprime:"‵",bigotimes:"⨂",centerdot:"⋅",copyright:"©",downarrow:"↓",gtreqless:"⋛",heartsuit:"♡",leftarrow:"←",lesseqgtr:"⋚",pitchfork:"⋔",spadesuit:"♠",therefore:"∴",trademark:"™",triangleq:"≜",varpropto:"∝",approxeq:"≊",barwedge:"⊼",bigoplus:"⨁",bigsqcup:"⨆",biguplus:"⨄",bigwedge:"⋀",boxminus:"⊟",boxtimes:"⊠",circledS:"Ⓢ",clubsuit:"♣",curlyvee:"⋎",doteqdot:"≑",emptyset:"∅",intercal:"⊺",leqslant:"⩽",multimap:"⊸",parallel:"∥",setminus:"∖",sqsubset:"⊏",sqsupset:"⊐",subseteq:"⊆",supseteq:"⊇",textless:"<",thicksim:"∼",triangle:"△",varkappa:"ϰ",varsigma:"ς",vartheta:"ϑ",Diamond:"◇",Uparrow:"⇑",Upsilon:"Υ",backsim:"∽",because:"∵",between:"≬",bigodot:"⨀",bigstar:"★",boxplus:"⊞",ddagger:"‡",diamond:"⋄",digamma:"Ϝ",dotplus:"∔",epsilon:"∊",gtrless:"≷",implies:"⇒",leadsto:"↝",lessdot:"⋖",lessgtr:"≶",lesssim:"≲",lozenge:"◊",natural:"♮",nearrow:"↗",nexists:"∄",nwarrow:"↖",partial:"∂",pilcrow:"¶",precsim:"≾",searrow:"↘",section:"§",succsim:"≿",swarrow:"↙",textbar:"|",uparrow:"↑",upsilon:"υ",Bumpeq:"≎",Lambda:"Λ",Subset:"⋐",Supset:"⋑",Vvdash:"⊪",approx:"≈",bigcap:"⋂",bigcup:"⋃",bigvee:"⋁",bowtie:"⋈",boxdot:"⊡",bullet:"∙",bumpeq:"≏",circeq:"≗",coprod:"∐",dagger:"†",daleth:"ד",degree:"°",eqcirc:"≖",exists:"∃",forall:"∀",gtrdot:"⋗",gtrsim:"≳",hslash:"ℏ",lambda:"λ",lfloor:"⌊",ltimes:"⋉",mapsto:"↦",models:"⊨",ominus:"⊖",oslash:"⊘",otimes:"⊗",preceq:"⪯",propto:"∝",rfloor:"⌋",rtimes:"⋊",square:"□",subset:"⊂",succeq:"⪰",supset:"⊃",varphi:"φ",varrho:"ϱ",veebar:"⊻",Delta:"Δ",Gamma:"Γ",Omega:"Ω",Theta:"Θ",Vdash:"⊩",aleph:"ℵ",Alpha:"Α",alpha:"α",angle:"∠",asymp:"≍",cdots:"⋯",cents:"¢",dashv:"⊣",ddots:"⋱",delta:"δ",doteq:"≐",equiv:"≡",frown:"⌢",gamma:"γ",gimel:"ℷ",infty:"∞",kappa:"κ",Kappa:"Κ",lceil:"⌈",nabla:"∇",notin:"∉",omega:"ω",oplus:"⊕",pound:"£",prime:"′",qquad:"  ",rceil:"⌉",sharp:"♯",sigma:"σ",simeq:"≃",smile:"⌣",space:"␣",sqcap:"⊓",sqcup:"⊔",theta:"θ",times:"×",unlhd:"⊴",unrhd:"⊵",uplus:"⊎",vDash:"⊨",varpi:"ϖ",vdash:"⊢",vdots:"⋮",wedge:"∧",Finv:"Ⅎ",Join:"⋈",atop:"¦",beta:"β",Beta:"Β",beth:"ב",cdot:"⋅",circ:"∘",cong:"≅",dots:"…",euro:"€",flat:"♭",geqq:"≧",hbar:"ℏ",iota:"ι",leqq:"≦",odot:"⊙",oint:"∮",perp:"⊥",prec:"≺",prod:"∏",quad:" ",star:"⋆",succ:"≻",surd:"√",zeta:"ζ",Box:"□",Cap:"⋒",Cup:"⋓",Lsh:"↰",Phi:"Φ",Psi:"Ψ",Rsh:"↱",ast:"∗",bot:"⊥",cap:"∩",chi:"χ",Chi:"Χ",cup:"∪",div:"÷",ell:"ℓ",eta:"η",eth:"ð",geq:"≥",ggg:"⋙",int:"∫",leq:"≤",lhd:"⊲",lll:"⋘",mho:"℧",mid:"∣",neg:"¬",neq:"≠",phi:"ϕ",psi:"ψ",rhd:"⊳",rho:"ρ",Rho:"Ρ",sim:"∼",sum:"∑",tau:"τ",Tau:"Τ",top:"⊤",vee:"∨",Im:"ℑ",Pi:"Π",Re:"ℜ",Xi:"Ξ",ge:"≥",gg:"≫",in:"∈",le:"≤",ll:"≪",mp:"∓",mu:"μ",Mu:"Μ",ni:"∋",nu:"ν",Nu:"Ν",pi:"π",pm:"±",wp:"℘",wr:"≀",xi:"ξ",Omicron:"Ο",omicron:"ο",textdollar:"$",textquotesingle:"'",textbackslash:"\\",textasciigrave:"`",lbrace:"{",vert:"|",rbrace:"}",textasciitilde:"~",textexclamdown:"¡",textcent:"¢",textsterling:"£",textcurrency:"¤",textyen:"¥",textbrokenbar:"¦",textsection:"§",textasciidieresis:"¨",textcopyright:"©",textordfeminine:"ª",guillemotleft:"«",lnot:"¬",textasciimacron:"¯",textdegree:"°",textasciiacute:"´",textparagraph:"¶",textordmasculine:"º",guillemotright:"»",textonequarter:"¼",textonehalf:"½",textthreequarters:"¾",textquestiondown:"¿",AA:"Å",AE:"Æ",DH:"Ð",texttimes:"×",TH:"Þ",ss:"ß",aa:"å",ae:"æ",dh:"ð",th:"þ",DJ:"Đ",dj:"đ",Elzxh:"ħ",i:"ı",NG:"Ŋ",ng:"ŋ",OE:"Œ",oe:"œ",texthvlig:"ƕ",textnrleg:"ƞ",textdoublepipe:"ǂ",Elztrna:"ɐ",Elztrnsa:"ɒ",Elzopeno:"ɔ",Elzrtld:"ɖ",Elzschwa:"ə",Elzpgamma:"ɣ",Elzpbgam:"ɤ",Elztrnh:"ɥ",Elzbtdl:"ɬ",Elzrtll:"ɭ",Elztrnm:"ɯ",Elztrnmlr:"ɰ",Elzltlmr:"ɱ",Elzltln:"ɲ",Elzrtln:"ɳ",Elzclomeg:"ɷ",textphi:"ɸ",Elztrnr:"ɹ",Elztrnrl:"ɺ",Elzrttrnr:"ɻ",Elzrl:"ɼ",Elzrtlr:"ɽ",Elzfhr:"ɾ",Elzrtls:"ʂ",Elzesh:"ʃ",Elztrnt:"ʇ",Elzrtlt:"ʈ",Elzpupsil:"ʊ",Elzpscrv:"ʋ",Elzinvv:"ʌ",Elzinvw:"ʍ",Elztrny:"ʎ",Elzrtlz:"ʐ",Elzyogh:"ʒ",Elzglst:"ʔ",Elzreglst:"ʕ",Elzinglst:"ʖ",textturnk:"ʞ",Elzdyogh:"ʤ",Elztesh:"ʧ",textasciicaron:"ˇ",Elzverts:"ˈ",Elzverti:"ˌ",Elzlmrk:"ː",Elzhlmrk:"ˑ",Elzsbrhr:"˒",Elzsblhr:"˓",Elzrais:"˔",Elzlow:"˕",textasciibreve:"˘",textperiodcentered:"˙",texttildelow:"˜",Epsilon:"Ε",Zeta:"Ζ",Eta:"Η",Iota:"Ι",Sigma:"Σ",texttheta:"θ",textvartheta:"ϑ",Stigma:"Ϛ",Digamma:"Ϝ",Koppa:"Ϟ",Sampi:"Ϡ",textTheta:"ϴ",textendash:"–",textemdash:"—",Vert:"‖",Elzreapos:"‛",textquotedblleft:"“",textquotedblright:"”",textdagger:"†",textdaggerdbl:"‡",textbullet:"•",ldots:"…",textperthousand:"‰",textpertenthousand:"‱",guilsinglleft:"‹",guilsinglright:"›",nolinebreak:"⁠",Elzxrat:"℞",nleftarrow:"↚",nrightarrow:"↛",arrowwaveleft:"↜",arrowwaveright:"↝",nleftrightarrow:"↮",dblarrowupdown:"⇅",nLeftarrow:"⇍",nLeftrightarrow:"⇎",nRightarrow:"⇏",DownArrowUpArrow:"⇵",rightangle:"∟",nmid:"∤",nparallel:"∦",surfintegral:"∯",volintegral:"∰",clwintegral:"∱",Colon:"∷",homothetic:"∻",lazysinv:"∾",NotEqualTilde:"≂",approxnotequal:"≆",tildetrpl:"≋",allequal:"≌",NotHumpDownHump:"≎",NotHumpEqual:"≏",estimates:"≙",starequal:"≛",lneqq:"≨",lvertneqq:"≨",gneqq:"≩",gvertneqq:"≩",NotLessLess:"≪",NotGreaterGreater:"≫",lessequivlnt:"≲",greaterequivlnt:"≳",notlessgreater:"≸",notgreaterless:"≹",precapprox:"≾",NotPrecedesTilde:"≾",succapprox:"≿",NotSucceedsTilde:"≿",subsetneq:"⊊",varsubsetneqq:"⊊",supsetneq:"⊋",varsupsetneq:"⊋",NotSquareSubset:"⊏",NotSquareSuperset:"⊐",truestate:"⊧",forcesextra:"⊨",VDash:"⊫",nvdash:"⊬",nvDash:"⊭",nVdash:"⊮",nVDash:"⊯",original:"⊶",image:"⊷",hermitconjmatrix:"⊹",rightanglearc:"⊾",backsimeq:"⋍",verymuchless:"⋘",verymuchgreater:"⋙",Elzsqspne:"⋥",lnsim:"⋦",gnsim:"⋧",precedesnotsimilar:"⋨",succnsim:"⋩",ntriangleleft:"⋪",ntriangleright:"⋫",ntrianglelefteq:"⋬",ntrianglerighteq:"⋭",upslopeellipsis:"⋰",downslopeellipsis:"⋱",perspcorrespond:"⌆",recorder:"⌕",ulcorner:"⌜",urcorner:"⌝",llcorner:"⌞",lrcorner:"⌟",langle:"〈",rangle:"〉",Elzdlcorn:"⎣",lmoustache:"⎰",rmoustache:"⎱",textvisiblespace:"␣",Elzdshfnc:"┆",Elzsqfnw:"┙",diagup:"╱",Elzvrecto:"▯",Elzcirfl:"◐",Elzcirfr:"◑",Elzcirfb:"◒",Elzrvbull:"◘",Elzsqfl:"◧",Elzsqfr:"◨",Elzsqfse:"◪",bigcirc:"◯",rightmoon:"☾",mercury:"☿",venus:"♀",male:"♂",jupiter:"♃",saturn:"♄",uranus:"♅",neptune:"♆",pluto:"♇",aries:"♈",taurus:"♉",gemini:"♊",cancer:"♋",leo:"♌",virgo:"♍",libra:"♎",scorpio:"♏",sagittarius:"♐",capricornus:"♑",aquarius:"♒",pisces:"♓",quarternote:"♩",eighthnote:"♪",UpArrowBar:"⤒",DownArrowBar:"⤓",Elolarr:"⥀",Elorarr:"⥁",ElzRlarr:"⥂",ElzrLarr:"⥄",Elzrarrx:"⥇",LeftRightVector:"⥎",RightUpDownVector:"⥏",DownLeftRightVector:"⥐",LeftUpDownVector:"⥑",LeftVectorBar:"⥒",RightVectorBar:"⥓",RightUpVectorBar:"⥔",RightDownVectorBar:"⥕",DownLeftVectorBar:"⥖",DownRightVectorBar:"⥗",LeftUpVectorBar:"⥘",LeftDownVectorBar:"⥙",LeftTeeVector:"⥚",RightTeeVector:"⥛",RightUpTeeVector:"⥜",RightDownTeeVector:"⥝",DownLeftTeeVector:"⥞",DownRightTeeVector:"⥟",LeftUpTeeVector:"⥠",LeftDownTeeVector:"⥡",UpEquilibrium:"⥮",ReverseUpEquilibrium:"⥯",RoundImplies:"⥰",Elztfnc:"⦀",Elroang:"⦆",Elzddfnc:"⦙",Angle:"⦜",Elzlpargt:"⦠",ElzLap:"⧊",Elzdefas:"⧋",LeftTriangleBar:"⧏",NotLeftTriangleBar:"⧏",RightTriangleBar:"⧐",NotRightTriangleBar:"⧐",RuleDelayed:"⧴",Elxuplus:"⨄",ElzThr:"⨅",Elxsqcup:"⨆",ElzInf:"⨇",ElzSup:"⨈",ElzCint:"⨍",clockoint:"⨏",sqrint:"⨖",ElzTimes:"⨯",amalg:"⨿",ElzAnd:"⩓",ElzOr:"⩔",ElOr:"⩖",Elzminhat:"⩟",Equal:"⩵",nleqslant:"⩽",geqslant:"⩾",ngeqslant:"⩾",lessapprox:"⪅",gtrapprox:"⪆",lneq:"⪇",gneq:"⪈",lnapprox:"⪉",gnapprox:"⪊",lesseqqgtr:"⪋",gtreqqless:"⪌",eqslantless:"⪕",eqslantgtr:"⪖",NestedLessLess:"⪡",NotNestedLessLess:"⪡",NestedGreaterGreater:"⪢",NotNestedGreaterGreater:"⪢",precneqq:"⪵",succneqq:"⪶",precnapprox:"⪹",succnapprox:"⪺",subseteqq:"⫅",nsubseteqq:"⫅",supseteqq:"⫆",subsetneqq:"⫋",supsetneqq:"⫌",Elztdcol:"⫶",openbracketleft:"〚",openbracketright:"〛"},t.isCharacterUnicode=n,t.characterUnicode=function(e){return n(e)?t.characterUnicodeChart[e]:void 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.barredLUnicodeChart={l:"ł",L:"Ł"},t.barredLUnicode=function(e){return t.barredLUnicodeChart[e]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.slashed_o="ø",t.slashed_O="Ø",t.slashedOUnicodeChart={o:t.slashed_o,O:t.slashed_O},t.slashedOUnicode=function(e){return t.slashedOUnicodeChart[e]}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cyrillicUnicodeChart={CYRF:"Ф",CYRII:"І",CYROMEGA:"Ѡ",CYRG:"Г",cyrkvcrs:"ҝ",cyryo:"ё",CYRH:"Х",CYRZHDSC:"Җ",cyrphk:"ҧ",CYRTDSC:"Ҭ",CYRI:"И",cyryi:"ї",CYRDZHE:"Џ",cyriote:"ѥ",CYRK:"К",CYRSHHA:"Һ",CYRL:"Л",CYRM:"М",CYRCHLDSC:"Ӌ",CYRNJE:"Њ",CYRYAT:"Ѣ",CYRA:"А",CYRB:"Б",cyrchrdsc:"ҷ",cyrschwa:"ә",CYRDZE:"Ѕ",CYRIE:"Є",CYRC:"Ц",CYRZH:"Ж",CYRD:"Д",CYRABHCHDSC:"Ҿ",CYRFITA:"Ѳ",CYRE:"Е",CYRABHHA:"Ҩ",cyrya:"я",cyrdzhe:"џ",CYRIOTLYUS:"Ѩ",cyrsemisftsn:"ҍ",CYRV:"В",cyrishrt:"й",cyrdje:"ђ",cyrchldsc:"ӌ",CYRY:"Ү",cyrndsc:"ң",CYRZ:"З",CYRKHCRS:"Ҟ",CYRNG:"Ҥ",CYRCHRDSC:"Ҷ",CYRYHCRS:"Ұ",CYRSHCH:"Щ",CYRUSHRT:"Ў",cyryu:"ю",cyrksi:"ѯ",CYRN:"Н",CYRO:"О",CYRBYUS:"Ѫ",CYRP:"П",CYRZDSC:"Ҙ",CYRAE:"Ӕ",CYRR:"Р",CYRS:"С",CYRT:"Т",CYRABHCH:"Ҽ",cyruk:"ѹ",CYRU:"У",cyrii:"і",CYRSEMISFTSN:"Ҍ",cyrghcrs:"ғ",CYRISHRT:"Й",cyromegatitlo:"ѽ",cyrkbeak:"ҡ",cyrie:"є",cyrzdsc:"ҙ",CYRNDSC:"Ң",CYRGUP:"Ґ",cyrshch:"щ",CYRKHK:"Ӄ",cyrzh:"ж",CYRJE:"Ј",cyrthousands:"҂",cyrabhch:"ҽ",textnumero:"№",cyrng:"ҥ",CYRPSI:"Ѱ",CYRTETSE:"Ҵ",CYRIOTBYUS:"Ѭ",cyrnje:"њ",CYRIOTE:"Ѥ",cyrdze:"ѕ",cyrae:"ӕ",CYRHRDSN:"Ъ",CYRKOPPA:"Ҁ",CYRRTICK:"Ҏ",CYRSCHWA:"Ә",cyrtdsc:"ҭ",CYRGHK:"Ҕ",cyrabhha:"ҩ",cyrshha:"һ",CYRSH:"Ш",cyru:"у",cyrkhcrs:"ҟ",cyrt:"т",CYRERY:"Ы",cyrs:"с",cyrr:"р",CYROT:"Ѿ",cyrlyus:"ѧ",CYRNHK:"Ӈ",CYRSFTSN:"Ь",cyrghk:"ҕ",cyrp:"п",cyrabhdze:"ӡ",cyro:"о",CYRTSHE:"Ћ",cyrn:"н",CYRSDSC:"Ҫ",cyryhcrs:"ұ",cyrpsi:"ѱ",cyrz:"з",cyry:"ү",cyrje:"ј",cyrv:"в",cyrchvcrs:"ҹ",cyrkhk:"ӄ",cyre:"е",cyromega:"ѡ",cyrd:"д",cyrc:"ц",cyrb:"б",CYROTLD:"Ө",cyrgup:"ґ",CYRLJE:"Љ",cyra:"а",CYROMEGATITLO:"Ѽ",CYRGHCRS:"Ғ",CYRCHVCRS:"Ҹ",cyrm:"м",cyrl:"л",cyrsh:"ш",cyrk:"к",cyri:"и",cyrh:"х",CYRHDSC:"Ҳ",CYRIZH:"Ѵ",CYRABHDZE:"Ӡ",cyrkdsc:"қ",cyrg:"г",CYRCH:"Ч",cyrf:"ф",CYRYI:"Ї",cyrmillions:"҉",CYRKSI:"Ѯ",CYROMEGARND:"Ѻ",cyrot:"ѿ",cyrtetse:"ҵ",cyrhdsc:"ҳ",cyrushrt:"ў",cyriotlyus:"ѩ",CYRYA:"Я",cyrlje:"љ",cyrotld:"ө",CYRKDSC:"Қ",cyrhrdsn:"ъ",cyrrtick:"ҏ",cyrkoppa:"ҁ",CYRDJE:"Ђ",cyriotbyus:"ѭ",cyrhundredthousands:"҈",CYRpalochka:"Ӏ",CYRKVCRS:"Ҝ",cyromegarnd:"ѻ",cyrsftsn:"ь",cyrabhchdsc:"ҿ",cyrzhdsc:"җ",cyrerev:"э",CYRLYUS:"Ѧ",CYRKBEAK:"Ҡ",cyrery:"ы",CYREREV:"Э",cyrnhk:"ӈ",cyrsdsc:"ҫ",cyrch:"ч",cyrtshe:"ћ",CYRPHK:"Ҧ",CYRYO:"Ё",CYRYU:"Ю",CYRUK:"Ѹ"},t.cyrillicUnicode=function(e){return t.cyrillicUnicodeChart[e]}},function(e,t,i){"use strict";function n(e){return t.specialCharacters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.specialCharacters={i:"ı",j:"ȷ",oe:"œ",OE:"Œ",ae:"æ",AE:"Æ",aa:"å",AA:"Å",o:"ø",O:"Ø",ss:"ß",l:"ł",L:"Ł"},t.isSpecialCharacter=n,t.specialCharacter=function(e){return n(e)?t.specialCharacters[e]:void 0}},function(e,t,i){"use strict";function n(e,t){switch(e){case"cyrchar":var i=o.translateCharToCyrillic(t);if(i)return i;break;default:for(var n=0,r=[a.diacriticUnicode,s.formattingUnicode];n<r.length;n++){var l=r[n],d=l(e,t);if(d)return d}}throw new Error("No implementation found to expand \\"+e+" with argument {"+t+"}")}Object.defineProperty(t,"__esModule",{value:!0});var a=i(106),s=i(118),o=i(127);t.expand1argsCommand=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(107),a=i(108),s=i(109),o=i(110),r=i(111),l=i(112),d=i(113),c=i(114),u=i(10),h=i(115),f=i(116),p=i(117);t.barUnderLetter=u.simpleSuffix("̱"),t.dotUnderLetter=u.simpleSuffix("̣"),t.breve=u.simpleSuffix("̆"),t.macrron=u.simpleSuffix("̄"),t.dotOverLetter=u.simpleSuffix("̇"),t.longHungarianUmlaut=u.simpleSuffix("̋"),t.modifiersTextModeUnicodeChart={"`":s.graveAccent,"'":a.acuteAccent,"^":o.circumflex,"~":r.tilde,"=":t.macrron,".":t.dotOverLetter,'"':l.dieresis,H:t.longHungarianUmlaut,c:d.cedilla,k:h.ogonek,b:t.barUnderLetter,d:t.dotUnderLetter,r:n.ringOverLetter,u:t.breve,v:c.caron,t:f.tieLetters},t.modifiersMathModeUnicodeChart={check:c.caron,acute:a.acuteAccent,grave:a.acuteAccent,breve:t.breve,vec:p.vectorArrow,mathring:n.ringOverLetter},t.diacriticUnicode=function(e,i){var n=t.modifiersTextModeUnicodeChart[e];return n||(n=t.modifiersMathModeUnicodeChart[e]),n&&n(i)}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6);t.ringOverLetter=n.lookupOrAppend({a:"å",A:"Å",y:"ẙ"},"̊")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6);t.acuteAccent=n.lookupOrAppend({e:"é",y:"ý",u:"ú",i:"í",o:"ó",a:"á",E:"É",Y:"Ý",U:"Ú",I:"Í",O:"Ó",A:"Á",cyrk:"ќ",cyrg:"ѓ",CYRK:"Ќ",CYRG:"Ѓ"},"́")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6);t.graveAccent=n.lookupOrAppend({e:"è",u:"ù",i:"ì",o:"ò",a:"à",E:"È",U:"Ù",I:"Ì",O:"Ò",A:"À"},"̀")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6);t.circumflex=n.lookupOrAppend({e:"ê",u:"û",i:"î",o:"ô",a:"â",E:"Ê",U:"Û",I:"Î",O:"Ô",A:"Â"},"̂")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6);t.tilde=n.lookupOrAppend({o:"õ",a:"ã",n:"ñ",O:"Õ",A:"Ã",N:"Ñ"},"̃")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6);t.dieresis=n.lookupOrAppend({e:"ë",y:"ÿ",u:"ü",i:"ï",o:"ö",a:"ä",E:"Ë",Y:"Ÿ",U:"Ü",I:"Ï",O:"Ö",A:"Ä"},"̈")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6);t.cedilla=n.lookupOrAppend({c:"ç"},"̧")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6);t.caron=n.lookupOrAppend({s:"š"},"̌")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(10);t.ogonek=n.simpleSuffix("̨")},function(e,t,i){"use strict";function n(e){return a(e.charAt(0),e.substring(1))}function a(e,t){return e+"͡"+t}function s(e){return"t"===e}Object.defineProperty(t,"__esModule",{value:!0}),t.tieLetters=n,t.tie2Letters=a,t.isTieLetters=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6);t.vectorArrow=n.lookupOrAppend({},"⃗")},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(119),a=i(120),s=i(121),o=i(122),r=i(123),l=i(124),d=i(37),c=i(125),u=i(38),h=i(126);t.formattingUnicode=function(e,t){var i=void 0;if(d.isBbCmd(e)?i=n.translateCharToBlackboard:d.isBfCmd(e)?i=a.translateCharToBold:d.isFrakCmd(e)?i=s.translateCharToFraktur:d.isItCmd(e)?i=o.translateCharToItalic:d.isTtCmd(e)?i=r.translateCharToMonospace:d.isCalCmd(e)?i=l.translateCharToCalligraphic:d.isSubCmd(e)?i=c.translateCharToSubscript:d.isSupCmd(e)?i=u.translateCharToSuperscript:d.isMonoCmd(e)&&(i=h.translateCharToMono),i){var f=i;return t.split("").map(function(e){return f(e)||e}).join("")}}},function(e,t,i){"use strict";function n(e){return t.blackboardCharacters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.blackboardCharacters={A:"𝔸",B:"𝔹",C:"ℂ",D:"𝔻",E:"𝔼",F:"𝔽",G:"𝔾",H:"ℍ",I:"𝕀",J:"𝕁",K:"𝕂",L:"𝕃",M:"𝕄",N:"ℕ",O:"𝕆",P:"ℙ",Q:"ℚ",R:"ℝ",S:"𝕊",T:"𝕋",U:"𝕌",V:"𝕍",W:"𝕎",X:"𝕏",Y:"𝕐",Z:"ℤ",a:"𝕒",b:"𝕓",c:"𝕔",d:"𝕕",e:"𝕖",f:"𝕗",g:"𝕘",h:"𝕙",i:"𝕚",j:"𝕛",k:"𝕜",l:"𝕝",m:"𝕞",n:"𝕟",o:"𝕠",p:"𝕡",q:"𝕢",r:"𝕣",s:"𝕤",t:"𝕥",u:"𝕦",v:"𝕧",w:"𝕨",x:"𝕩",y:"𝕪",z:"𝕫",0:"𝟘",1:"𝟙",2:"𝟚",3:"𝟛",4:"𝟜",5:"𝟝",6:"𝟞",7:"𝟟",8:"𝟠",9:"𝟡"},t.isBlackboardCharacter=n,t.translateCharToBlackboard=function(e){return n(e)?t.blackboardCharacters[e]:void 0}},function(e,t,i){"use strict";function n(e){return t.boldCharacters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.boldCharacters={A:"𝐀",B:"𝐁",C:"𝐂",D:"𝐃",E:"𝐄",F:"𝐅",G:"𝐆",H:"𝐇",I:"𝐈",J:"𝐉",K:"𝐊",L:"𝐋",M:"𝐌",N:"𝐍",O:"𝐎",P:"𝐏",Q:"𝐐",R:"𝐑",S:"𝐒",T:"𝐓",U:"𝐔",V:"𝐕",W:"𝐖",X:"𝐗",Y:"𝐘",Z:"𝐙",a:"𝐚",b:"𝐛",c:"𝐜",d:"𝐝",e:"𝐞",f:"𝐟",g:"𝐠",h:"𝐡",i:"𝐢",j:"𝐣",k:"𝐤",l:"𝐥",m:"𝐦",n:"𝐧",o:"𝐨",p:"𝐩",q:"𝐪",r:"𝐫",s:"𝐬",t:"𝐭",u:"𝐮",v:"𝐯",w:"𝐰",x:"𝐱",y:"𝐲",z:"𝐳","Α":"𝚨","Β":"𝚩","Γ":"𝚪","Δ":"𝚫","Ε":"𝚬","Ζ":"𝚭","Η":"𝚮","Θ":"𝚯","Ι":"𝚰","Κ":"𝚱","Λ":"𝚲","Μ":"𝚳","Ν":"𝚴","Ξ":"𝚵","Ο":"𝚶","Π":"𝚷","Ρ":"𝚸","ϴ":"𝚹","Σ":"𝚺","Τ":"𝚻","Υ":"𝚼","Φ":"𝚽","Χ":"𝚾","Ψ":"𝚿","Ω":"𝛀","∇":"𝛁","α":"𝛂","β":"𝛃","γ":"𝛄","δ":"𝛅","ε":"𝛆","ζ":"𝛇","η":"𝛈","θ":"𝛉","ι":"𝛊","κ":"𝛋","λ":"𝛌","μ":"𝛍","ν":"𝛎","ξ":"𝛏","ο":"𝛐","π":"𝛑","ρ":"𝛒","ς":"𝛓","σ":"𝛔","τ":"𝛕","υ":"𝛖","φ":"𝛗","χ":"𝛘","ψ":"𝛙","ω":"𝛚","∂":"𝛛","ϵ":"𝛜","ϑ":"𝛝","ϰ":"𝛞","ϕ":"𝛟","ϱ":"𝛠","ϖ":"𝛡",0:"𝟎",1:"𝟏",2:"𝟐",3:"𝟑",4:"𝟒",5:"𝟓",6:"𝟔",7:"𝟕",8:"𝟖",9:"𝟗"},t.isBlackboardCharacter=n,t.translateCharToBold=function(e){return n(e)?t.boldCharacters[e]:void 0}},function(e,t,i){"use strict";function n(e){return t.frakturCharacters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.frakturCharacters={A:"𝔄",B:"𝔅",C:"ℭ",D:"𝔇",E:"𝔈",F:"𝔉",G:"𝔊",H:"ℌ",I:"ℑ",J:"𝔍",K:"𝔎",L:"𝔏",M:"𝔐",N:"𝔑",O:"𝔒",P:"𝔓",Q:"𝔔",R:"ℜ",S:"𝔖",T:"𝔗",U:"𝔘",V:"𝔙",W:"𝔚",X:"𝔛",Y:"𝔜",Z:"ℨ",a:"𝔞",b:"𝔟",c:"𝔠",d:"𝔡",e:"𝔢",f:"𝔣",g:"𝔤",h:"𝔥",i:"𝔦",j:"𝔧",k:"𝔨",l:"𝔩",m:"𝔪",n:"𝔫",o:"𝔬",p:"𝔭",q:"𝔮",r:"𝔯",s:"𝔰",t:"𝔱",u:"𝔲",v:"𝔳",w:"𝔴",x:"𝔵",y:"𝔶",z:"𝔷"},t.isFrakturCharacter=n,t.translateCharToFraktur=function(e){return n(e)?t.frakturCharacters[e]:void 0}},function(e,t,i){"use strict";function n(e){return t.italicCharacters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.italicCharacters={A:"𝐴",B:"𝐵",C:"𝐶",D:"𝐷",E:"𝐸",F:"𝐹",G:"𝐺",H:"𝐻",I:"𝐼",J:"𝐽",K:"𝐾",L:"𝐿",M:"𝑀",N:"𝑁",O:"𝑂",P:"𝑃",Q:"𝑄",R:"𝑅",S:"𝑆",T:"𝑇",U:"𝑈",V:"𝑉",W:"𝑊",X:"𝑋",Y:"𝑌",Z:"𝑍",a:"𝑎",b:"𝑏",c:"𝑐",d:"𝑑",e:"𝑒",f:"𝑓",g:"𝑔",h:"ℎ",i:"𝑖",j:"𝑗",k:"𝑘",l:"𝑙",m:"𝑚",n:"𝑛",o:"𝑜",p:"𝑝",q:"𝑞",r:"𝑟",s:"𝑠",t:"𝑡",u:"𝑢",v:"𝑣",w:"𝑤",x:"𝑥",y:"𝑦",z:"𝑧","Α":"𝛢","Β":"𝛣","Γ":"𝛤","Δ":"𝛥","Ε":"𝛦","Ζ":"𝛧","Η":"𝛨","Θ":"𝛩","Ι":"𝛪","Κ":"𝛫","Λ":"𝛬","Μ":"𝛭","Ν":"𝛮","Ξ":"𝛯","Ο":"𝛰","Π":"𝛱","Ρ":"𝛲","ϴ":"𝛳","Σ":"𝛴","Τ":"𝛵","Υ":"𝛶","Φ":"𝛷","Χ":"𝛸","Ψ":"𝛹","Ω":"𝛺","∇":"𝛻","α":"𝛼","β":"𝛽","γ":"𝛾","δ":"𝛿","ε":"𝜀","ζ":"𝜁","η":"𝜂","θ":"𝜃","ι":"𝜄","κ":"𝜅","λ":"𝜆","μ":"𝜇","ν":"𝜈","ξ":"𝜉","ο":"𝜊","π":"𝜋","ρ":"𝜌","ς":"𝜍","σ":"𝜎","τ":"𝜏","υ":"𝜐","φ":"𝜑","χ":"𝜒","ψ":"𝜓","ω":"𝜔","∂":"𝜕","ϵ":"𝜖","ϑ":"𝜗","ϰ":"𝜘","ϕ":"𝜙","ϱ":"𝜚","ϖ":"𝜛"},t.isItalicCharacter=n,t.translateCharToItalic=function(e){return n(e)?t.italicCharacters[e]:void 0}},function(e,t,i){"use strict";function n(e){return t.monospaceCharacters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.monospaceCharacters={A:"𝙰",B:"𝙱",C:"𝙲",D:"𝙳",E:"𝙴",F:"𝙵",G:"𝙶",H:"𝙷",I:"𝙸",J:"𝙹",K:"𝙺",L:"𝙻",M:"𝙼",N:"𝙽",O:"𝙾",P:"𝙿",Q:"𝚀",R:"𝚁",S:"𝚂",T:"𝚃",U:"𝚄",V:"𝚅",W:"𝚆",X:"𝚇",Y:"𝚈",Z:"𝚉",a:"𝚊",b:"𝚋",c:"𝚌",d:"𝚍",e:"𝚎",f:"𝚏",g:"𝚐",h:"𝚑",i:"𝚒",j:"𝚓",k:"𝚔",l:"𝚕",m:"𝚖",n:"𝚗",o:"𝚘",p:"𝚙",q:"𝚚",r:"𝚛",s:"𝚜",t:"𝚝",u:"𝚞",v:"𝚟",w:"𝚠",x:"𝚡",y:"𝚢",z:"𝚣",0:"𝟶",1:"𝟷",2:"𝟸",3:"𝟹",4:"𝟺",5:"𝟻",6:"𝟼",7:"𝟽",8:"𝟾",9:"𝟿"},t.isMonospaceCharacter=n,t.translateCharToMonospace=function(e){return n(e)?t.monospaceCharacters[e]:void 0}},function(e,t,i){"use strict";function n(e){return t.calligraphicLetters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.calligraphicLetters={A:"𝓐",B:"𝓑",C:"𝓒",D:"𝓓",E:"𝓔",F:"𝓕",G:"𝓖",H:"𝓗",I:"𝓘",J:"𝓙",K:"𝓚",L:"𝓛",M:"𝓜",N:"𝓝",O:"𝓞",P:"𝓟",Q:"𝓠",R:"𝓡",S:"𝓢",T:"𝓣",U:"𝓤",V:"𝓥",W:"𝓦",X:"𝓧",Y:"𝓨",Z:"𝓩",a:"𝓪",b:"𝓫",c:"𝓬",d:"𝓭",e:"𝓮",f:"𝓯",g:"𝓰",h:"𝓱",i:"𝓲",j:"𝓳",k:"𝓴",l:"𝓵",m:"𝓶",n:"𝓷",o:"𝓸",p:"𝓹",q:"𝓺",r:"𝓻",s:"𝓼",t:"𝓽",u:"𝓾",v:"𝓿",w:"𝔀",x:"𝔁",y:"𝔂",z:"𝔃"},t.isCalligraphicLetter=n,t.translateCharToCalligraphic=function(e){return n(e)?t.calligraphicLetters[e]:void 0}},function(e,t,i){"use strict";function n(e){return t.subscriptCharacters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.subscriptCharacters={0:"₀",1:"₁",2:"₂",3:"₃",4:"₄",5:"₅",6:"₆",7:"₇",8:"₈",9:"₉","+":"₊","-":"₋","=":"₌","(":"₍",")":"₎",a:"ₐ",e:"ₑ",h:"ₕ",i:"ᵢ",j:"ⱼ",k:"ₖ",l:"ₗ",m:"ₘ",n:"ₙ",o:"ₒ",p:"ₚ",r:"ᵣ",s:"ₛ",t:"ₜ",u:"ᵤ",v:"ᵥ",x:"ₓ","β":"ᵦ","γ":"ᵧ","ρ":"ᵨ","φ":"ᵩ","χ":"ᵪ"},t.isSubscriptCharacter=n,t.translateCharToSubscript=function(e){return n(e)?t.subscriptCharacters[e]:void 0}},function(e,t,i){"use strict";function n(e){return t.monoCharacters.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.monoCharacters={A:"𝙰",B:"𝙱",C:"𝙲",D:"𝙳",E:"𝙴",F:"𝙵",G:"𝙶",H:"𝙷",I:"𝙸",J:"𝙹",K:"𝙺",L:"𝙻",M:"𝙼",N:"𝙽",O:"𝙾",P:"𝙿",Q:"𝚀",R:"𝚁",S:"𝚂",T:"𝚃",U:"𝚄",V:"𝚅",W:"𝚆",X:"𝚇",Y:"𝚈",Z:"𝚉",a:"𝚊",b:"𝚋",c:"𝚌",d:"𝚍",e:"𝚎",f:"𝚏",g:"𝚐",h:"𝚑",i:"𝚒",j:"𝚓",k:"𝚔",l:"𝚕",m:"𝚖",n:"𝚗",o:"𝚘",p:"𝚙",q:"𝚚",r:"𝚛",s:"𝚜",t:"𝚝",u:"𝚞",v:"𝚟",w:"𝚠",x:"𝚡",y:"𝚢",z:"𝚣",0:"𝟶",1:"𝟷",2:"𝟸",3:"𝟹",4:"𝟺",5:"𝟻",6:"𝟼",7:"𝟽",8:"𝟾",9:"𝟿"},t.isMonoCharacter=n,t.translateCharToMono=function(e){return n(e)?t.monoCharacters[e]:void 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cyrillicCharacters={"Ф":"Ф","І":"І","Ѡ":"Ѡ","Г":"Г","ҝ":"ҝ","ё":"ё","Х":"Х","Җ":"Җ","ҧ":"ҧ","Ҭ":"Ҭ","И":"И","ї":"ї","Џ":"Џ","ѥ":"ѥ","К":"К","Һ":"Һ","Л":"Л","М":"М","Ӌ":"Ӌ","Њ":"Њ","Ѣ":"Ѣ","А":"А","Б":"Б","ҷ":"ҷ","ә":"ә","Ѕ":"Ѕ","Є":"Є","Ц":"Ц","Ж":"Ж","Д":"Д","Ҿ":"Ҿ","Ѳ":"Ѳ","Е":"Е","Ҩ":"Ҩ","я":"я","џ":"џ","Ѩ":"Ѩ","ҍ":"ҍ","В":"В","й":"й","ђ":"ђ","ӌ":"ӌ","Ү":"Ү","ң":"ң","З":"З","Ҟ":"Ҟ","Ҥ":"Ҥ","Ҷ":"Ҷ","Ұ":"Ұ","Щ":"Щ","Ў":"Ў","ю":"ю","ѯ":"ѯ","Н":"Н","О":"О","Ѫ":"Ѫ","П":"П","Ҙ":"Ҙ","Ӕ":"Ӕ","Р":"Р","С":"С","Т":"Т","Ҽ":"Ҽ","ѹ":"ѹ","У":"У","і":"і","Ҍ":"Ҍ","ғ":"ғ","Й":"Й","ѽ":"ѽ","ҡ":"ҡ","є":"є","ҙ":"ҙ","Ң":"Ң","Ґ":"Ґ","щ":"щ","Ӄ":"Ӄ","ж":"ж","Ј":"Ј","҂":"҂","ҽ":"ҽ","№":"№","ҥ":"ҥ","Ѱ":"Ѱ","Ҵ":"Ҵ","Ѭ":"Ѭ","њ":"њ","Ѥ":"Ѥ","ѕ":"ѕ","ӕ":"ӕ","Ъ":"Ъ","Ҁ":"Ҁ","Ҏ":"Ҏ","Ә":"Ә","ҭ":"ҭ","Ҕ":"Ҕ","ҩ":"ҩ","һ":"һ","Ш":"Ш","у":"у","ҟ":"ҟ","т":"т","Ы":"Ы","с":"с","р":"р","Ѿ":"Ѿ","ѧ":"ѧ","Ӈ":"Ӈ","Ь":"Ь","ҕ":"ҕ","п":"п","ӡ":"ӡ","о":"о","Ћ":"Ћ","н":"н","Ҫ":"Ҫ","ұ":"ұ","ѱ":"ѱ","з":"з","ү":"ү","̏":"̏","ј":"ј","в":"в","ҹ":"ҹ","ӄ":"ӄ","е":"е","ѡ":"ѡ","д":"д","ц":"ц","б":"б","Ө":"Ө","ґ":"ґ","Љ":"Љ","а":"а","Ѽ":"Ѽ","Ғ":"Ғ","Ҹ":"Ҹ","м":"м","л":"л","ш":"ш","к":"к","и":"и","х":"х","Ҳ":"Ҳ","Ѵ":"Ѵ","Ӡ":"Ӡ","қ":"қ","г":"г","Ч":"Ч","ф":"ф","Ї":"Ї","҉":"҉","Ѯ":"Ѯ","Ѻ":"Ѻ","ѿ":"ѿ","ҵ":"ҵ","ҳ":"ҳ","ў":"ў","ѩ":"ѩ","Я":"Я","љ":"љ","ө":"ө","Қ":"Қ","ъ":"ъ","ҏ":"ҏ","ҁ":"ҁ","Ђ":"Ђ","ѭ":"ѭ","҈":"҈","Ӏ":"Ӏ","Ҝ":"Ҝ","ѻ":"ѻ","ь":"ь","ҿ":"ҿ","җ":"җ","э":"э","Ѧ":"Ѧ","Ҡ":"Ҡ","ы":"ы","Э":"Э","ӈ":"ӈ","ҫ":"ҫ","ч":"ч","ћ":"ћ","Ҧ":"Ҧ","Ё":"Ё","Ю":"Ю","Ѹ":"Ѹ","ќ":"ќ","ѓ":"ѓ","Ќ":"Ќ","Ѓ":"Ѓ"},t.isCyrillicCharacter=function(e){return t.cyrillicCharacters.hasOwnProperty(e)},t.translateCharToCyrillic=function(e){return t.isCyrillicCharacter(e)?t.cyrillicCharacters[e]:void 0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.spaceCmds1arg={kern:!0,hskip:!0,hspace:!0,hphantom:!0}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.diacriticsTextMode={"`":!0,"'":!0,"^":!0,"~":!0,"=":!0,".":!0,'"':!0,H:!0,c:!0,k:!0,b:!0,d:!0,r:!0,u:!0,v:!0},t.diacriticsMathMode={hat:!0,widehat:!0,check:!0,tilde:!0,widetilde:!0,acute:!0,grave:!0,dot:!0,ddot:!0,breve:!0,bar:!0,vec:!0,mathring:!0}},function(e,t,i){"use strict";function n(e){var t=e?e.trim():void 0;if(!t)return"√";switch(t){case"2":return"√";case"3":return"∛";case"4":return"∜";default:for(var i=[],n=0;n<t.length;n++){var a=s.translateCharToSuperscript(t.charAt(n));if(!a)throw new Error('Could not translate "'+a+'" to superscript');i.push(a)}return i.join("")+"√"}}function a(e,t){var i=n(t),a=e.trim();return""===a?i:i+"("+a+")"}Object.defineProperty(t,"__esModule",{value:!0});var s=i(38);t.convertSqrtToUnicode=a},function(e,t,i){"use strict";function n(e,t,i){switch(e){case"frac":case"nfrac":case"cfrac":case"xfrac":case"sfrac":return a.convertFracToUnicode(t,i);case"binom":return s.convertBinom(t,i)}throw new Error("No implementation found to expand \\"+e+" with arguments {"+t+", "+i)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(132),s=i(133);t.expand2argsCommand=n},function(e,t,i){"use strict";function n(e,t){return"1"===e&&"2"===t?"½":"1"===e&&"3"===t?"⅓":"1"===e&&"4"===t?"¼":"1"===e&&"5"===t?"⅕":"1"===e&&"6"===t?"⅙":"1"===e&&"8"===t?"⅛":"2"===e&&"3"===t?"⅔":"2"===e&&"5"===t?"⅖":"3"===e&&"4"===t?"¾":"3"===e&&"5"===t?"⅗":"3"===e&&"8"===t?"⅜":"4"===e&&"5"===t?"⅘":"5"===e&&"6"===t?"⅚":"5"===e&&"8"===t?"⅝":"7"===e&&"8"===t?"⅞":o.test(e)&&o.test(t)?s+e+"⁄"+t+s:(e=a.isSingleTerm.test(e)?e:a.addParenthesis(e),t=a.isSingleTerm.test(t)?t:a.addParenthesis(t),"("+e+" / "+t+")")}Object.defineProperty(t,"__esModule",{value:!0});var a=i(10),s="‌",o=/^[0-9]*$/;t.convertFracToUnicode=n},function(e,t,i){"use strict";function n(e,t){return e=s.test(e)?e:a.addParenthesis(e),t=s.test(t)?t:a.addParenthesis(t),"("+e+" ¦ "+t+")"}Object.defineProperty(t,"__esModule",{value:!0});var a=i(10),s=/^.$|^[0-9]+$/;t.convertBinom=n},function(e,t,i){"use strict";function n(e){return t.twoArgsCommands.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(135);t.twoArgsCommands=Object.assign({},a.fracCmds,{binom:!0}),t.is2argsCommand=n},function(e,t,i){"use strict";function n(e){return t.fracCmds.hasOwnProperty(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.fracCmds={frac:!0,nfrac:!0,cfrac:!0,xfrac:!0,sfrac:!0},t.isFracCmd=n},function(e,t,i){"use strict";function n(e){return{name:e,optionalArguments:0,argumentCount:0}}Object.defineProperty(t,"__esModule",{value:!0}),t.createKnownCommand=n},function(e,t,i){"use strict";function n(e){return{name:e,optionalArguments:0,argumentCount:1}}Object.defineProperty(t,"__esModule",{value:!0}),t.createKnownCommandWith1Arg=n},function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"toolForm"},[i("div",{staticClass:"toolFormTitle"},[e._v("\n        Citations\n        "),e.viewRender?i("button",{staticClass:"btn btn-xs",attrs:{type:"button",title:"Show all in BibTeX format."},on:{click:e.toggleViewRender}},[i("i",{staticClass:"fa fa-pencil-square-o"}),e._v("\n            Show BibTeX\n        ")]):i("button",{staticClass:"btn btn-xs",attrs:{type:"button",title:"Return to formatted citation list."},on:{click:e.toggleViewRender}},[i("i",{staticClass:"fa fa-times"}),e._v("\n            Hide BibTeX\n        ")])]),e._v(" "),i("div",{staticClass:"citations-bibtex toolFormBody citation-padding"},["histories"===e.source?i("div",{staticClass:"infomessage"},[e._v("\n            When writing up your analysis, remember to include all references that should be cited in order\n            to completely describe your work. Also, please remember to "),i("a",{attrs:{href:"https://galaxyproject.org/citing-galaxy"}},[e._v("cite Galaxy")]),e._v(".\n        ")]):e._e(),e._v(" "),e.viewRender?i("span",{staticClass:"citations-formatted"},[i("p",{domProps:{innerHTML:e._s(e.formattedReferences)}})]):i("textarea",{staticClass:"citations-bibtex-text"},[e._v("            "+e._s(e.content)+"\n        ")])])])},a=[],s={render:n,staticRenderFns:a};t.a=s},function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=e.View.extend({optionsDefault:{css:"",placeholder:"No data available",data:[],value:null,multiple:!1,minimumInputLength:0,initialData:""},initialize:function(e){if(this.options=s.default.merge(e,this.optionsDefault),this.setElement(this._template(this.options)),!this.options.container)return void console.log("ui-select::initialize() : container not specified.");if(this.options.container.append(this.$el),this.select_data=this.options.data,this._refresh(),!this.options.multiple){this.options.value&&this._setValue(this.options.value);var t=this;this.options.onchange&&this.$el.on("change",function(){t.options.onchange(t.value())})}},value:function(e){var t=this._getValue();void 0!==e&&this._setValue(e);var i=this._getValue();return i!=t&&this.options.onchange&&this.options.onchange(i),i},text:function(){return this.$el.select2("data").text},disabled:function(){return!this.$el.select2("enable")},enable:function(){this.$el.select2("enable",!0)},disable:function(){this.$el.select2("enable",!1)},add:function(e){this.select_data.push({id:e.id,text:e.text}),this._refresh()},del:function(e){var t=this._getIndex(e);-1!=t&&(this.select_data.splice(t,1),this._refresh())},remove:function(){this.$el.select2("destroy")},update:function(e){this.select_data=[];for(var t in e.data)this.select_data.push(e.data[t]);this._refresh()},_refresh:function(){if(this.options.multiple){var e={multiple:this.options.multiple,containerCssClass:this.options.css,placeholder:this.options.placeholder,minimumInputLength:this.options.minimumInputLength,ajax:this.options.ajax,dropdownCssClass:this.options.dropdownCssClass,escapeMarkup:this.options.escapeMarkup,formatResult:this.options.formatResult,formatSelection:this.options.formatSelection,initSelection:this.options.initSelection,initialData:this.options.initialData};this.$el.select2(e)}else{var t=this._getValue(),e={data:this.select_data,containerCssClass:this.options.css,placeholder:this.options.placeholder,dropdownAutoWidth:!0};this.$el.select2(e),this._setValue(t)}},_getIndex:function(e){n.findIndex(this.select_data,{id:e})},_getValue:function(){return this.$el.select2("val")},_setValue:function(e){-1==this._getIndex(e)&&this.select_data.length>0&&(e=this.select_data[0].id),this.$el.select2("val",e)},_template:function(e){return'<input type="hidden" value="'+this.options.initialData+'"/>'}});t.default={View:o}}).call(t,i(1),i(2))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(s),r=i(14),l=a(r),d=i(15),c=a(d),u=i(141),h=(a(u),{hidden:!1,show:function(){this.set("hidden",!1)},hide:function(){this.set("hidden",!0)},toggle:function(){this.set("hidden",!this.get("hidden"))},is_visible:function(){return!this.attributes.hidden}}),f=e.Model.extend({defaults:{name:null,label:null,type:null,value:null,html:null,num_samples:5},initialize:function(e){this.attributes.html=unescape(this.attributes.html)},copy:function(){return new f(this.toJSON())},set_value:function(e){this.set("value",e||"")}}),p=e.Collection.extend({model:f}),m=f.extend({}),_=f.extend({set_value:function(e){this.set("value",parseInt(e,10))},get_samples:function(){return d3.scale.linear().domain([this.get("min"),this.get("max")]).ticks(this.get("num_samples"))}}),g=_.extend({set_value:function(e){this.set("value",parseFloat(e))}}),v=f.extend({get_samples:function(){return o.map(this.get("options"),function(e){return e[0]})}});f.subModelTypes={integer:_,float:g,data:m,select:v};var w=e.Model.extend({defaults:{id:null,name:null,description:null,target:null,inputs:[],outputs:[]},urlRoot:Galaxy.root+"api/tools",initialize:function(e){this.set("inputs",new p(o.map(e.inputs,function(e){return new(f.subModelTypes[e.type]||f)(e)})))},toJSON:function(){var t=e.Model.prototype.toJSON.call(this);return t.inputs=this.get("inputs").map(function(e){return e.toJSON()}),t},remove_inputs:function(e){var t=this,i=t.get("inputs").filter(function(t){return-1!==e.indexOf(t.get("type"))});t.get("inputs").remove(i)},copy:function(t){var i=new w(this.toJSON());if(t){var n=new e.Collection;i.get("inputs").each(function(e){e.get_samples()&&n.push(e)}),i.set("inputs",n)}return i},apply_search_results:function(e){return-1!==o.indexOf(e,this.attributes.id)?this.show():this.hide(),this.is_visible()},set_input_value:function(e,t){this.get("inputs").find(function(t){return t.get("name")===e}).set("value",t)},set_input_values:function(e){var t=this;o.each(o.keys(e),function(i){t.set_input_value(i,e[i])})},run:function(){return this._run()},rerun:function(e,t){return this._run({action:"rerun",target_dataset_id:e.id,regions:t})},get_inputs_dict:function(){var e={};return this.get("inputs").each(function(t){e[t.get("name")]=t.get("value")}),e},_run:function(e){var t=o.extend({tool_id:this.id,inputs:this.get_inputs_dict()},e),i=n.Deferred(),a=new l.default.ServerStateDeferred({ajax_settings:{url:this.urlRoot,data:JSON.stringify(t),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(e){return"pending"!==e}});return n.when(a.go()).then(function(e){i.resolve(new c.default.DatasetCollection(e))}),i}});o.extend(w.prototype,h);var b=(e.View.extend({}),e.Collection.extend({model:w})),y=e.Model.extend(h),x=e.Model.extend({defaults:{elems:[],open:!1},clear_search_results:function(){o.each(this.attributes.elems,function(e){e.show()}),this.show(),this.set("open",!1)},apply_search_results:function(e){var t,i=!0;o.each(this.attributes.elems,function(n){n instanceof y?(t=n,t.hide()):n instanceof w&&n.apply_search_results(e)&&(i=!1,t&&t.show())}),i?this.hide():(this.show(),this.set("open",!0))}});o.extend(x.prototype,h);var k=e.Model.extend({defaults:{search_hint_string:"search tools",min_chars_for_search:3,clear_btn_url:"",visible:!0,query:"",results:null,clear_key:27},urlRoot:Galaxy.root+"api/tools",initialize:function(){this.on("change:query",this.do_search)},do_search:function(){var e=this.attributes.query;if(e.length<this.attributes.min_chars_for_search)return void this.set("results",null);var t=e;this.timer&&clearTimeout(this.timer),n("#search-clear-btn").hide(),n("#search-spinner").show();var i=this;this.timer=setTimeout(function(){"undefined"!=typeof ga&&ga("send","pageview",Galaxy.root+"?q="+t),n.get(i.urlRoot,{q:t},function(e){i.set("results",e),n("#search-spinner").hide(),n("#search-clear-btn").show()},"json")},400)},clear_search:function(){this.set("query",""),this.set("results",null)}});o.extend(k.prototype,h);var C=e.Model.extend({initialize:function(t){this.attributes.tool_search=t.tool_search,this.attributes.tool_search.on("change:results",this.apply_search_results,this),this.attributes.tools=t.tools,this.attributes.layout=new e.Collection(this.parse(t.layout))},parse:function(e){var t=this,i=function e(i){var n=i.model_class;if(n.indexOf("Tool")===n.length-4)return t.attributes.tools.get(i.id);if("ToolSection"===n){var a=o.map(i.elems,e);return i.elems=a,new x(i)}return"ToolSectionLabel"===n?new y(i):void 0};return o.map(e,i)},clear_search_results:function(){this.get("layout").each(function(e){e instanceof x?e.clear_search_results():e.show()})},apply_search_results:function(){var e=this.get("tool_search").get("results");if(null===e)return void this.clear_search_results();var t=null;this.get("layout").each(function(i){i instanceof y?(t=i,t.hide()):i instanceof w?i.apply_search_results(e)&&t&&t.show():(t=null,i.apply_search_results(e))})}}),$=e.View.extend({initialize:function(){this.model.on("change:hidden",this.update_visible,this),this.update_visible()},update_visible:function(){this.model.attributes.hidden?this.$el.hide():this.$el.show()}}),S=$.extend({tagName:"div",render:function(){var e=n("<div/>");e.append(A.tool_link(this.model.toJSON()));var t=this.model.get("form_style",null);if("upload1"===this.model.id)e.find("a").on("click",function(e){e.preventDefault(),Galaxy.upload.show()});else if("regular"===t){var i=this;e.find("a").on("click",function(e){e.preventDefault(),Galaxy.router.push("/",{tool_id:i.model.id,version:i.model.get("version")})})}return this.$el.append(e),this}}),T=$.extend({tagName:"div",className:"toolPanelLabel",render:function(){return this.$el.append(n("<span/>").text(this.model.attributes.text)),this}}),M=$.extend({tagName:"div",className:"toolSectionWrapper",initialize:function(){$.prototype.initialize.call(this),this.model.on("change:open",this.update_open,this)},render:function(){this.$el.append(A.panel_section(this.model.toJSON()));var e=this.$el.find(".toolSectionBody");return o.each(this.model.attributes.elems,function(t){if(t instanceof w){var i=new S({model:t,className:"toolTitle"});i.render(),e.append(i.$el)}else if(t instanceof y){var n=new T({model:t});n.render(),e.append(n.$el)}}),this},events:{"click .toolSectionTitle > a":"toggle"},toggle:function(){this.model.set("open",!this.model.attributes.open)},update_open:function(){this.model.attributes.open?this.$el.children(".toolSectionBody").slideDown("fast"):this.$el.children(".toolSectionBody").slideUp("fast")}}),E=e.View.extend({tagName:"div",id:"tool-search",className:"bar",events:{click:"focus_and_select","keyup :input":"query_changed","change :input":"query_changed","click #search-clear-btn":"clear"},render:function(){return this.$el.append(A.tool_search(this.model.toJSON())),this.model.is_visible()||this.$el.hide(),n("#messagebox").is(":visible")&&this.$el.css("top","95px"),this.$el.find("[title]").tooltip(),this},focus_and_select:function(){this.$el.find(":input").focus().select()},clear:function(){return this.model.clear_search(),this.$el.find(":input").val(""),this.focus_and_select(),!1},query_changed:function(e){if(this.model.attributes.clear_key&&this.model.attributes.clear_key===e.which)return this.clear(),!1;this.model.set("query",this.$el.find(":input").val())}}),P=e.View.extend({tagName:"div",className:"toolMenu",initialize:function(){this.model.get("tool_search").on("change:results",this.handle_search_results,this)},render:function(){var e=this,t=new E({model:this.model.get("tool_search")});return t.render(),e.$el.append(t.$el),this.model.get("layout").each(function(t){if(t instanceof x){var i=new M({model:t});i.render(),e.$el.append(i.$el)}else if(t instanceof w){var n=new S({model:t,className:"toolTitleNoSection"});n.render(),e.$el.append(n.$el)}else if(t instanceof y){var a=new T({model:t});a.render(),e.$el.append(a.$el)}}),e.$el.find("a.tool-link").click(function(t){var i=n(this).attr("class").split(/\s+/)[0],a=e.model.get("tools").get(i);e.trigger("tool_link_click",t,a)}),this},handle_search_results:function(){var e=this.model.get("tool_search").get("results");e&&0===e.length?n("#search-no-results").show():n("#search-no-results").hide()}}),O=e.View.extend({className:"toolForm",render:function(){this.$el.children().remove(),this.$el.append(A.tool_form(this.model.toJSON()))}}),A=(e.View.extend({className:"toolMenuAndView",initialize:function(){this.tool_panel_view=new P({collection:this.collection}),this.tool_form_view=new O},render:function(){this.tool_panel_view.render(),this.tool_panel_view.$el.css("float","left"),this.$el.append(this.tool_panel_view.$el),this.tool_form_view.$el.hide(),this.$el.append(this.tool_form_view.$el);var e=this;this.tool_panel_view.on("tool_link_click",function(t,i){t.preventDefault(),e.show_tool(i)})},show_tool:function(e){var t=this;e.fetch().done(function(){t.tool_form_view.model=e,t.tool_form_view.render(),t.tool_form_view.$el.show(),n("#left").width("650px")})}}),{tool_search:o.template(['<input id="tool-search-query" class="search-query parent-width" name="query" ','placeholder="<%- search_hint_string %>" autocomplete="off" type="text" />','<a id="search-clear-btn" title="clear search (esc)"> </a>','<span id="search-spinner" class="search-spinner fa fa-spinner fa-spin"></span>'].join("")),panel_section:o.template(['<div class="toolSectionTitle" id="title_<%- id %>">','<a href="javascript:void(0)"><span><%- name %></span></a>',"</div>",'<div id="<%- id %>" class="toolSectionBody" style="display: none;">','<div class="toolSectionBg"></div>',"<div>"].join("")),tool_link:o.template(['<a class="<%- id %> tool-link" href="<%= link %>" target="<%- target %>" minsizehint="<%- min_width %>">','<span class="labels">',"<% _.each( labels, function( label ){ %>",'<span class="label label-default label-<%- label %>">',"<%- label %>","</span>","<% }); %>","</span>",'<span class="tool-old-link">',"<%- name %>","</span>"," <%- description %>","</a>"].join("")),tool_form:o.template(['<div class="toolFormTitle"><%- tool.name %> (version <%- tool.version %>)</div>','<div class="toolFormBody">',"<% _.each( tool.inputs, function( input ){ %>",'<div class="form-row">','<label for="<%- input.name %>"><%- input.label %>:</label>','<div class="form-row-input">',"<%= input.html %>","</div>",'<div class="toolParamHelp" style="clear: both;">',"<%- input.help %>","</div>",'<div style="clear: both;"></div>',"</div>","<% }); %>","</div>",'<div class="form-row form-actions">','<input type="submit" class="btn btn-primary" name="runtool_btn" value="Execute" />',"</div>",'<div class="toolHelp">','<div class="toolHelpBody"><% tool.help %></div>',"</div>"].join(""),{variable:"tool"})});t.default={ToolParameter:f,IntegerToolParameter:_,SelectToolParameter:v,Tool:w,ToolCollection:b,ToolSearch:k,ToolPanel:C,ToolPanelView:P,ToolFormView:O}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(4),d=s(l),c=i(9),u=s(c),h=i(60),f=s(h),p=i(40),m=s(p),_=e.View.extend({initialize:function(e){var t=this;this.modal=parent.Galaxy.modal||new u.default.View,this.form=new f.default(r.default.merge({listen_to_history:!0,always_refresh:!1,buildmodel:function(e,i){var a=i.model.attributes,s="",o={},l=a.job_id;l?s=Galaxy.root+"api/jobs/"+l+"/build_for_rerun":(s=Galaxy.root+"api/tools/"+a.id+"/build",o=n.extend({},Galaxy.params),o.tool_id&&delete o.tool_id),a.version&&(o.tool_version=a.version),r.default.get({url:s,data:o,success:function(n){if(!n.display)return void(window.location=Galaxy.root);i.model.set(n),t._customize(i),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model ready.",n),e.resolve()},error:function(t,s){var o=t&&t.err_msg||"Uncaught error.";401==s?window.location=Galaxy.root+"user/login?"+n.param({redirect:Galaxy.root+"?tool_id="+a.id}):i.$el.is(":empty")?i.$el.prepend(new d.default.Message({message:o,status:"danger",persistent:!0,large:!0}).$el):Galaxy.modal&&Galaxy.modal.show({title:"Tool request failed",body:o,buttons:{Close:function(){Galaxy.modal.hide()}}}),Galaxy.emit.debug("tool-form-base::_buildModel()","Initial tool model request failed.",t),e.reject()}})},postchange:function(e,t){var i={tool_id:t.model.get("id"),tool_version:t.model.get("version"),inputs:n.extend(!0,{},t.data.create())};t.wait(!0),Galaxy.emit.debug("tool-form::postchange()","Sending current state.",i),r.default.request({type:"POST",url:Galaxy.root+"api/tools/"+t.model.get("id")+"/build",data:i,success:function(i){t.update(i),t.wait(!1),Galaxy.emit.debug("tool-form::postchange()","Received new model.",i),e.resolve()},error:function(t){Galaxy.emit.debug("tool-form::postchange()","Refresh request failed.",t),e.reject()}})}},e)),this.deferred=this.form.deferred,this.setElement("<div/>"),this.$el.append(this.form.$el)},_customize:function(e){var t=this,i=e.model.attributes,n=new d.default.Button({icon:"fa-check",tooltip:"Execute: "+i.name+" ("+i.version+")",title:"Execute",cls:"btn btn-primary ui-clear-float",wait_cls:"btn btn-info ui-clear-float",onclick:function(){n.wait(),e.portlet.disable(),t.submit(i,function(){n.unwait(),e.portlet.enable()})}});i.buttons={execute:n},i.job_id&&i.job_remap&&i.inputs.push({label:"Resume dependencies from this job",name:"rerun_remap_job_id",type:"select",display:"radio",ignore:"__ignore__",value:"__ignore__",options:[["Yes",i.job_id],["No","__ignore__"]],help:"The previous run of this tool failed and other tools were waiting for it to finish successfully. Use this option to resume those tools using the new output(s) of this tool run."})},submit:function(e,t){var i=this,s={tool_id:e.id,tool_version:e.version,inputs:this.form.data.create()};if(this.form.trigger("reset"),!i.validate(s))return Galaxy.emit.debug("tool-form::submit()","Submission canceled. Validation failed."),void(t&&t());if(e.action!==Galaxy.root+"tool_runner/index"){var o=n("<form/>").attr({action:e.action,method:e.method,enctype:e.enctype});return a.each(s.inputs,function(e,t){o.append(n("<input/>").attr({name:t,value:e}))}),o.hide().appendTo("body").submit().remove(),void(t&&t())}Galaxy.emit.debug("tool-form::submit()","Validation complete.",s),r.default.request({type:"POST",url:Galaxy.root+"api/tools",data:s,success:function(e){if(t&&t(),i.$el.children().hide(),i.$el.append(i._templateSuccess(e)),e.jobs&&e.jobs.length>0){i.$el.append(n("<div/>",{id:"webhook-view"}));new m.default.WebhookView({urlRoot:Galaxy.root+"api/webhooks/tool",toolId:s.tool_id})}parent.Galaxy&&parent.Galaxy.currHistoryPanel&&parent.Galaxy.currHistoryPanel.refreshContents()},error:function(e){t&&t(),Galaxy.emit.debug("tool-form::submit","Submission failed.",e);var n=!1;if(e&&e.err_data){var a=i.form.data.matchResponse(e.err_data);for(var o in a){i.form.highlight(o,a[o]),n=!0;break}}n||i.modal.show({title:"Job submission failed",body:i._templateError(s,e&&e.err_msg),buttons:{Close:function(){i.modal.hide()}}})}})},validate:function(e){var t=e.inputs,i=-1,n=null;for(var a in t){var s=t[a],o=this.form.data.match(a),r=this.form.field_list[o],l=this.form.input_list[o];if(o&&l&&r){if(!l.optional&&null==s)return this.form.highlight(o),!1;if(s&&s.batch){var d=s.values.length,c=d>0&&s.values[0]&&s.values[0].src;if(c)if(null===n)n=c;else if(n!==c)return this.form.highlight(o,"Please select either dataset or dataset list fields for all batch mode fields."),!1;if(-1===i)i=d;else if(i!==d)return this.form.highlight(o,"Please make sure that you select the same number of inputs for all batch mode fields. This field contains <b>"+d+"</b> selection(s) while a previous field contains <b>"+i+"</b>."),!1}}else Galaxy.emit.debug("tool-form::validate()","Retrieving input objects failed.")}return!0},_templateSuccess:function(e){if(e.jobs&&e.jobs.length>0){var t=e.jobs.length,i=1==t?"1 job has":t+" jobs have",s=n("<div/>").addClass("donemessagelarge").append(n("<p/>").text(i+" been successfully added to the queue - resulting in the following datasets:"));return a.each(e.outputs,function(e){s.append(n("<p/>").addClass("messagerow").append(n("<b/>").text(e.hid+": "+e.name)))}),s.append(n("<p/>").append("<b/>").text("You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.")),s}return this._templateError(e,"Invalid success response. No jobs found.")},_templateError:function(e,t){return n("<div/>").addClass("errormessagelarge").append(n("<p/>").text("The server could not complete the request. Please contact the Galaxy Team if this error persists. "+(t||""))).append(n("<pre/>").text(JSON.stringify(e,null,4)))}});t.default={View:_}}).call(t,i(1),i(0),i(2))},,function(e,t,i){"use strict";(function(e,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e.Model.extend({defaults:{url_base:"",async:!1,async_ops:[],categorical_filters:[],filters:{},sort_key:null,show_item_checkboxes:!1,advanced_search:!1,cur_page:1,num_pages:1,operation:void 0,item_ids:void 0},can_async_op:function(e){return-1!==i.indexOf(this.attributes.async_ops,e)},add_filter:function(e,t,i){if(i){var n,a=this.attributes.filters[e];if(null===a||void 0===a)n=t;else if("string"==typeof a)if("All"==a||a==t)n=t;else{var s=[];s[0]=a,s[1]=t,n=s}else n=a,-1===n.indexOf(t)&&n.push(t);this.attributes.filters[e]=n}else this.attributes.filters[e]=t},remove_filter:function(e,t){var n=this.attributes.filters[e];if(null===n||void 0===n)return!1;if("string"==typeof n)this.attributes.filters[e]="";else{var a=i.indexOf(n,t);-1!==a&&(n[a]="")}},get_url_data:function(){var e={async:this.attributes.async,sort:this.attributes.sort_key,page:this.attributes.cur_page,show_item_checkboxes:this.attributes.show_item_checkboxes,advanced_search:this.attributes.advanced_search};this.attributes.operation&&(e.operation=this.attributes.operation),this.attributes.item_ids&&(e.id=this.attributes.item_ids);var t=this;return i.each(i.pairs(t.attributes.filters),function(t){e["f-"+t[0]]=t[1]}),e},get_url:function(e){return this.get("url_base")+"?"+n.param(this.get_url_data())+"&"+n.param(e)}})}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=function(e){return e&&e.__esModule?e:{default:e}}(a);t.default={grid:function(e){var t="";return t=e.embedded?this.grid_header(e)+this.grid_table(e):'<div class="loading-elt-overlay"></div><table><tr><td width="75%">'+this.grid_header(e)+'</td><td></td><td></td></tr><tr><td width="100%" id="grid-message" valign="top"></td><td></td><td></td></tr></table>'+this.grid_table(e),e.info_text&&(t+='<br><div class="toolParamHelp" style="clear: both;">'+e.info_text+"</div>"),t},grid_table:function(e){return'<form method="post" onsubmit="return false;"><table id="grid-table" class="grid"><thead id="grid-table-header"></thead><tbody id="grid-table-body"></tbody><tfoot id="grid-table-footer"></tfoot></table></form>'},grid_header:function(e){var t='<div class="grid-header">';if(e.embedded||(t+="<h2>"+e.title+"</h2>"),e.global_actions){t+='<ul class="manage-table-actions">';var i=e.global_actions.length>=3;i&&(t+='<li><a class="action-button" id="popup-global-actions" class="menubutton">Actions</a></li><div popupmenu="popup-global-actions">');for(var n in e.global_actions){var a=e.global_actions[n];t+='<li><a class="action-button use-target" target="'+a.target+'" href="'+a.url_args+'" onclick="return false;" >'+a.label+"</a></li>"}i&&(t+="</div>"),t+="</ul>"}return e.insert&&(t+=e.insert),t+=this.grid_filters(e),t+="</div>"},header:function(e){var t="<tr>";e.show_item_checkboxes&&(t+="<th>",e.items.length>0&&(t+='<input type="checkbox" id="check_all" name=select_all_checkbox value="true"><input type="hidden" name=select_all_checkbox value="true">'),t+="</th>");for(var i in e.columns){var n=e.columns[i];n.visible&&(t+='<th id="'+n.key+'-header">',n.href?t+='<a href="'+n.href+'" class="sort-link" sort_key="'+n.key+'">'+n.label+"</a>":t+=n.label,t+='<span class="sort-arrow">'+n.extra+"</span></th>")}return t+="</tr>"},body:function(t){var i="",n=0;0==t.items.length&&(i+='<tr><td colspan="100"><em>No Items</em></td></tr>',n=1);for(var a in t.items){var s=t.items[a],o=s.encode_id;i+="<tr ",t.current_item_id==s.id&&(i+='class="current"'),i+=">",t.show_item_checkboxes&&(i+='<td style="width: 1.5em;"><input type="checkbox" name="id" value="'+o+'" id="'+o+'" class="grid-row-select-checkbox" /></td>');for(var r in t.columns){var l=t.columns[r];if(l.visible){var d="";l.nowrap&&(d='style="white-space:nowrap;"');var c=s.column_config[l.label],u=c.link,h=c.value,f=c.target;"string"===e.type(h)&&(h=h.replace(/\/\//g,"/"));var p="",m="";l.attach_popup&&(p="grid-"+a+"-popup",m="menubutton",""!=u&&(m+=" split"),m+=" popup"),i+="<td "+d+">",u?(0!=t.operations.length&&(i+='<div id="'+p+'" class="'+m+'" style="float: left;">'),i+='<a class="menubutton-label use-target" target="'+f+'" href="'+u+'" onclick="return false;">'+h+"</a>",0!=t.operations.length&&(i+="</div>")):i+='<div id="'+p+'" class="'+m+'"><label id="'+l.label_id_prefix+o+'" for="'+o+'">'+(h||"")+"</label></div>",i+="</td>"}}i+="</tr>",n++}return i},footer:function(e){var t="";if(e.use_paging&&e.num_pages>1){var i=e.num_page_links,n=e.cur_page_num,a=e.num_pages,s=i/2,o=n-s,r=0;o<=0&&(o=1,r=s-(n-o));var l,d=s+r,c=n+d;c<=a?l=0:(c=a,l=d-(c+1-n)),0!=l&&(o-=l)<1&&(o=1),t+='<tr id="page-links-row">',e.show_item_checkboxes&&(t+="<td></td>"),t+='<td colspan="100"><span id="page-link-container">Page:',o>1&&(t+='<span class="page-link" id="page-link-1"><a href="javascript:void(0);" page_num="1" onclick="return false;">1</a></span> ...');for(var u=o;u<c+1;u++)u==e.cur_page_num?t+='<span class="page-link inactive-link" id="page-link-'+u+'">'+u+"</span>":t+='<span class="page-link" id="page-link-'+u+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+u+'">'+u+"</a></span>";c<a&&(t+='...<span class="page-link" id="page-link-'+a+'"><a href="javascript:void(0);" onclick="return false;" page_num="'+a+'">'+a+"</a></span>"),t+="</span>",t+='<span class="page-link" id="show-all-link-span"> | <a href="javascript:void(0);" onclick="return false;" page_num="all">Show All</a></span></td></tr>'}if(e.show_item_checkboxes){t+='<tr><input type="hidden" id="operation" name="operation" value=""><td></td><td colspan="100">For <span class="grid-selected-count"></span> selected items: ';for(var h in e.operations){var f=e.operations[h];f.allow_multiple&&(t+='<input type="button" value="'+f.label+'" class="operation-button action-button">&nbsp;')}t+="</td></tr>"}var p=!1;for(h in e.operations)if(e.operations[h].global_operation){p=!0;break}if(p){t+='<tr><td colspan="100">';for(h in e.operations){var f=e.operations[h];f.global_operation&&(t+='<a class="action-button" href="'+f.global_operation+'">'+f.label+"</a>")}t+="</td></tr>"}return e.legend&&(t+='<tr><td colspan="100">'+e.legend+"</td></tr>"),t},message:function(e){var t=e.status;return-1!=["success","ok"].indexOf(t)&&(t="done"),'<p><div class="'+t+'message transient-message">'+n.escape(e.message)+'</div><div style="clear: both"></div></p>'},grid_filters:function(e){var t=e.default_filter_dict,i=e.filters,n="none";e.advanced_search&&(n="block");var a=!1;for(var s in e.columns){var o=e.columns[s];if("advanced"==o.filterable){var r=o.key,l=i[r],d=t[r];l&&d&&l!=d&&(n="block"),a=!0}}var c="block";"block"==n&&(c="none");var u='<div id="standard-search" style="display: '+c+';"><table><tr><td style="padding: 0;"><table>';for(var s in e.columns){var o=e.columns[s];"standard"==o.filterable&&(u+=this.grid_column_filter(e,o))}u+="</table></td></tr><tr><td>",a&&(u+='<a href="" class="advanced-search-toggle">Advanced Search</a>'),u+="</td></tr></table></div>",u+='<div id="advanced-search" style="display: '+n+'; margin-top: 5px; border: 1px solid #ccc;"><table><tr><td style="text-align: left" colspan="100"><a href="" class="advanced-search-toggle">Close Advanced Search</a></td></tr>';for(var s in e.columns){var o=e.columns[s];"advanced"==o.filterable&&(u+=this.grid_column_filter(e,o))}return u+="</table></div>"},grid_column_filter:function(t,i){var n=(t.default_filter_dict,t.filters),a=i.label,s=i.key;"advanced"==i.filterable&&(a=a.toLowerCase());var o="<tr>";if("advanced"==i.filterable&&(o+='<td align="left" style="padding-left: 10px">'+a+":</td>"),o+='<td style="padding-bottom: 1px;">',i.is_text){o+='<form class="text-filter-form" column_key="'+s+'" action="'+t.url+'" method="get" >';for(u in t.columns){var r=t.columns[u],l=n[r.key];l&&"All"!=l&&(r.is_text&&(l=JSON.stringify(l)),o+='<input type="hidden" id="'+r.key+'" name="f-'+r.key+'" value="'+l+'"/>')}o+='<span id="'+s+'-filtering-criteria">';var d=n[s];if(d){var c=e.type(d);if("string"==c&&"All"!=d&&(o+=this.filter_element(s,d)),"array"==c)for(var u in d){var h=d[u],f=d;f=f.slice(u),o+=this.filter_element(s,h)}}o+="</span>";var p="";if("standard"==i.filterable){p=i.label.toLowerCase();var m=p.length;m<20&&(m=20),m+=4}o+='<span class="search-box"><input class="search-box-input" id="input-'+s+'-filter" name="f-'+s+'" type="text" placeholder="'+p+'" size="'+m+'"/><button type="submit" style="background: transparent; border: none; padding: 4px; margin: 0px;"><i class="fa fa-search"></i></button></span></form>'}else{o+='<span id="'+s+'-filtering-criteria">';var _=!1;for(var g in t.categorical_filters[s]){var v=t.categorical_filters[s][g],w="",b="";for(var y in v)w=y,b=v[y];_&&(o+=" | "),_=!0;var h=n[s];h&&v[s]&&h==b?o+='<span class="categorical-filter '+s+'-filter current-filter">'+g+"</span>":o+='<span class="categorical-filter '+s+'-filter"><a href="javascript:void(0);" filter_key="'+w+'" filter_val="'+b+'">'+g+"</a></span>"}o+="</span>"}return o+="</td></tr>"},filter_element:function(e,t){return'<span class="text-filter-val">'+(t=s.default.sanitize(t))+'<a href="javascript:void(0);" filter_key="'+e+'" filter_val="'+t+'"><i class="fa fa-times" style="padding-left: 5px; padding-bottom: 6px;"/></a></span>'}}}).call(t,i(0),i(2))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(s),r=i(146),l=a(r),d=i(13),c=a(d),u=i(41),h=a(u),f=i(58),p=a(f),m=i(26),_=a(m),g=i(3),v=a(g);i(170),i(169),i(171),i(157),i(174),i(159),i(172),i(173),i(25);var w=null,b=null,y=function(){this.initialize&&this.initialize.apply(this,arguments)};y.extend=e.Model.extend;var x=y.extend({initialize:function(e){v.default.cssLoadFile("static/style/jquery.rating.css"),v.default.cssLoadFile("static/style/autocomplete_tagging.css"),v.default.cssLoadFile("static/style/jquery-ui/smoothness/jquery-ui.css"),v.default.cssLoadFile("static/style/library.css"),v.default.cssLoadFile("static/style/trackster.css"),this.baseURL=e},save_viz:function(){Galaxy.modal.show({title:"Saving...",body:"progress"});var e=[];n(".bookmark").each(function(){e.push({position:n(this).children(".position").text(),annotation:n(this).children(".annotation").text()})});var t=b.overview_drawable?b.overview_drawable.config.get_value("name"):null,i={view:b.to_dict(),viewport:{chrom:b.chrom,start:b.low,end:b.high,overview:t},bookmarks:e};return n.ajax({url:Galaxy.root+"visualization/save",type:"POST",dataType:"json",data:{id:b.vis_id,title:b.config.get_value("name"),dbkey:b.dbkey,type:"trackster",vis_json:JSON.stringify(i)}}).success(function(e){Galaxy.modal.hide(),b.vis_id=e.vis_id,b.has_changes=!1,window.history.pushState({},"",e.url+window.location.hash)}).error(function(){Galaxy.modal.show({title:"Could Not Save",body:"Could not save visualization. Please try again later.",buttons:{Cancel:function(){Galaxy.modal.hide()}}})})},createButtonMenu:function(){var e=this,t=h.default.create_icon_buttons_menu([{icon_class:"plus-button",title:"Add tracks",on_click:function(){c.default.select_datasets({dbkey:b.dbkey},function(e){o.each(e,function(e){b.add_drawable(l.default.object_from_template(e,b,b))})})}},{icon_class:"block--plus",title:"Add group",on_click:function(){b.add_drawable(new l.default.DrawableGroup(b,b,{name:"New Group"}))}},{icon_class:"bookmarks",title:"Bookmarks",on_click:function(){force_right_panel("0px"==n("div#right").css("right")?"hide":"show")}},{icon_class:"globe",title:"Circster",on_click:function(){window.location=e.baseURL+"visualization/circster?id="+b.vis_id}},{icon_class:"disk--arrow",title:"Save",on_click:function(){e.save_viz()}},{icon_class:"cross-circle",title:"Close",on_click:function(){e.handle_unsaved_changes(b)}}],{tooltip_config:{placement:"bottom"}});return this.buttonMenu=t,t},add_bookmark:function(e,t,i){var a=n("#right .unified-panel-body"),s=n("<div/>").addClass("bookmark").appendTo(a),o=n("<div/>").addClass("position").appendTo(s),r=(n("<a href=''/>").text(e).appendTo(o).click(function(){return b.go_to(e),!1}),n("<div/>").text(t).appendTo(s));if(i){var l=n("<div/>").addClass("delete-icon-container").prependTo(s).click(function(){return s.slideUp("fast"),s.remove(),b.has_changes=!0,!1});n("<a href=''/>").addClass("icon-button delete").appendTo(l);r.make_text_editable({num_rows:3,use_textarea:!0,help_text:"Edit bookmark note"}).addClass("annotation")}return b.has_changes=!0,s},create_visualization:function(e,t,i,a,s){var r=this,d=new l.default.TracksterView(o.extend(e,{header:!1}));return d.editor=!0,n.when(d.load_chroms_deferred).then(function(e){if(t){var n=t.chrom,o=t.start,c=t.end,u=t.overview;n&&void 0!==o&&c?d.change_chrom(n,o,c):d.change_chrom(e[0].chrom)}else d.change_chrom(e[0].chrom);if(i)for(var h=0;h<i.length;h++)d.add_drawable(l.default.object_from_template(i[h],d,d));for(var h=0;h<d.drawables.length;h++)if(d.drawables[h].config.get_value("name")===u){d.set_overview(d.drawables[h]);break}if(a)for(var f,h=0;h<a.length;h++)f=a[h],r.add_bookmark(f.position,f.annotation,s);d.has_changes=!1}),this.set_up_router({view:d}),d},set_up_router:function(t){new c.default.TrackBrowserRouter(t),e.history.start()},init_keyboard_nav:function(e){n(document).keyup(function(t){if(!n(t.srcElement).is(":input"))switch(t.which){case 37:e.move_fraction(.25);break;case 38:Math.round(e.viewport_container.height()/15);e.viewport_container.scrollTop(e.viewport_container.scrollTop()-20);break;case 39:e.move_fraction(-.25);break;case 40:Math.round(e.viewport_container.height()/15);e.viewport_container.scrollTop(e.viewport_container.scrollTop()+20)}})},handle_unsaved_changes:function(e){if(e.has_changes){var t=this;Galaxy.modal.show({title:"Close visualization",body:"There are unsaved changes to your visualization which will be lost if you do not save them.",buttons:{Cancel:function(){Galaxy.modal.hide()},"Leave without Saving":function(){n(window).off("beforeunload"),window.location=Galaxy.root+"visualization"},Save:function(){n.when(t.save_viz()).then(function(){window.location=Galaxy.root+"visualization"})}}})}else window.location=Galaxy.root+"visualization"}}),k=e.View.extend({initialize:function(){w=new x(Galaxy.root),w.createButtonMenu(),w.buttonMenu.$el.attr("style","float: right"),n("#center .unified-panel-header-inner").append(w.buttonMenu.$el),n("#right .unified-panel-title").append("Bookmarks"),n("#right .unified-panel-icons").append("<a id='add-bookmark-button' class='icon-button menu-button plus-button' href='javascript:void(0);' title='Add bookmark'></a>"),n("#right-border").click(function(){b.resize_window()}),force_right_panel("hide"),galaxy_config.app.id?this.view_existing():p.default.get("dataset_id")?this.choose_existing_or_new():this.view_new()},choose_existing_or_new:function(){var e=this,t=p.default.get("dbkey"),i={},n={dbkey:t,dataset_id:p.default.get("dataset_id"),hda_ldda:p.default.get("hda_ldda"),gene_region:p.default.get("gene_region")};t&&(i["f-dbkey"]=t),Galaxy.modal.show({title:"View Data in a New or Saved Visualization?",body:"<p><ul style='list-style: disc inside none'>You can add this dataset as:<li>a new track to one of your existing, saved Trackster sessions if they share the genome build: <b>"+(t||"Not available.")+"</b></li><li>or create a new session with this dataset as the only track</li></ul></p>",buttons:{Cancel:function(){window.location=Galaxy.root+"visualizations/list"},"View in saved visualization":function(){e.view_in_saved(n)},"View in new visualization":function(){e.view_new()}}})},view_in_saved:function(e){var t=new _.default({url_base:Galaxy.root+"visualization/list_tracks",dict_format:!0,embedded:!0});Galaxy.modal.show({title:"Add Data to Saved Visualization",body:t.$el,buttons:{Cancel:function(){window.location=Galaxy.root+"visualizations/list"},"Add to visualization":function(){n(parent.document).find("input[name=id]:checked").each(function(){e.id=n(this).val(),window.location=Galaxy.root+"visualization/trackster?"+n.param(e)})}}})},view_existing:function(){var e=galaxy_config.app.viz_config;b=w.create_visualization({container:n("#center .unified-panel-body"),name:e.title,vis_id:e.vis_id,dbkey:e.dbkey},e.viewport,e.tracks,e.bookmarks,!0),this.init_editor()},view_new:function(){var e=this;n.ajax({url:Galaxy.root+"api/genomes?chrom_info=True",data:{},error:function(){alert("Couldn't create new browser.")},success:function(t){Galaxy.modal.show({title:"New Visualization",body:e.template_view_new(t),buttons:{Cancel:function(){window.location=Galaxy.root+"visualizations/list"},Create:function(){e.create_browser(n("#new-title").val(),n("#new-dbkey").val()),Galaxy.modal.hide()}}});var i=t.map(function(e){return e[1]});galaxy_config.app.default_dbkey&&o.contains(i,galaxy_config.app.default_dbkey)&&n("#new-dbkey").val(galaxy_config.app.default_dbkey),n("#new-title").focus(),n("select[name='dbkey']").select2(),n("#overlay").css("overflow","auto")}})},template_view_new:function(e){for(var t='<form id="new-browser-form" action="javascript:void(0);" method="post" onsubmit="return false;"><div class="form-row"><label for="new-title">Browser name:</label><div class="form-row-input"><input type="text" name="title" id="new-title" value="Unnamed"></input></div><div style="clear: both;"></div></div><div class="form-row"><label for="new-dbkey">Reference genome build (dbkey): </label><div class="form-row-input"><select name="dbkey" id="new-dbkey">',i=0;i<e.length;i++)t+='<option value="'+e[i][1]+'">'+e[i][0]+"</option>";return t+='</select></div><div style="clear: both;"></div></div><div class="form-row">Is the build not listed here? <a href="'+Galaxy.root+'user/dbkeys?use_panels=True">Add a Custom Build</a></div></form>'},create_browser:function(e,t){n(document).trigger("convert_to_values"),b=w.create_visualization({container:n("#center .unified-panel-body"),name:e,dbkey:t},galaxy_config.app.gene_region),this.init_editor(),b.editor=!0},init_editor:function(){n("#center .unified-panel-title").text(b.config.get_value("name")+" ("+b.dbkey+")"),galaxy_config.app.add_dataset&&n.ajax({url:Galaxy.root+"api/datasets/"+galaxy_config.app.add_dataset,data:{hda_ldda:"hda",data_type:"track_config"},dataType:"json",success:function(e){b.add_drawable(l.default.object_from_template(e,b,b))}}),n("#add-bookmark-button").click(function(){var e=b.chrom+":"+b.low+"-"+b.high;return w.add_bookmark(e,"Bookmark description",!0)}),w.init_keyboard_nav(b),n(window).on("beforeunload",function(){if(b.has_changes)return"There are unsaved changes to your visualization that will be lost if you leave this page."})}});t.default={TracksterUI:x,GalaxyApp:k}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t){t||(t=0);var i=Math.pow(10,t);return Math.round(e*i)/i}function o(t){var i=e.Deferred();return e.ajax({type:"HEAD",url:t,beforeSend:function(e){e.setRequestHeader("Range","bytes=0-10")},success:function(e,t,n){i.resolve(206===n.status)}}),i}Object.defineProperty(t,"__esModule",{value:!0});var r=i(2),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(r),d=i(13),c=a(d),u=i(147),h=a(u),f=i(14),p=a(f),m=i(148),_=a(m),g=i(149),v=a(g),w=i(150),b=a(w),y=i(15),x=a(y),k=i(140),C=a(k),$=i(21),S=a($),T=i(151),M=a(T);i(25);var E=l.extend,P={},O=function(e,t){P[e.attr("id")]=t},A=function(t,i,n,a){n=".group",P[t.attr("id")]=a,t.bind("drag",{handle:"."+i,relative:!0},function(t,i){var a,s,o,r,l,d=(e(this),e(this).parent()),c=d.children(".track,.group"),u=P[e(this).attr("id")];if(s=e(this).parents(n),0!==s.length){o=s.position().top,r=o+s.outerHeight();var h=P[s.attr("id")];if(i.offsetY<o)return e(this).insertBefore(s),h.remove_drawable(u),void h.container.add_drawable_before(u,h);if(i.offsetY>r)return e(this).insertAfter(s),h.remove_drawable(u),void h.container.add_drawable(u)}for(s=null,l=0;l<c.length;l++)if(a=e(c.get(l)),o=a.position().top,r=o+a.outerHeight(),a.is(n)&&this!==a.get(0)&&i.offsetY>=o&&i.offsetY<=r)return i.offsetY-o<r-i.offsetY?a.find(".content-div").prepend(this):a.find(".content-div").append(this),u.container&&u.container.remove_drawable(u),void P[a.attr("id")].add_drawable(u);for(l=0;l<c.length&&(a=e(c.get(l)),!(i.offsetY<a.position().top)||a.hasClass("reference-track")||a.hasClass("intro"));l++);l===c.length?this!==c.get(l-1)&&(d.append(this),P[d.attr("id")].move_drawable(u,l)):this!==c.get(l)&&(e(this).insertBefore(c.get(l)),P[d.attr("id")].move_drawable(u,i.deltaY>0?l-1:l))}).bind("dragstart",function(){e(this).addClass("dragging")}).bind("dragend",function(){e(this).removeClass("dragging")})},D="A converter for this dataset is not installed. Please check your datatypes_conf.xml file.",I=["Histogram","Line","Filled","Intensity"],z=function e(t,i,n){if(e.id_counter||(e.id_counter=0),this.id=e.id_counter++,this.view=t,this.container=i,this.drag_handle_class=n.drag_handle_class,this.is_overview=!1,this.action_icons={},this.config=S.default.ConfigSettingCollection.from_models_and_saved_values(this.config_params,n.prefs),this.config.get_value("name")||this.config.set_value("name",n.name),this.config_onchange&&this.config.on("change",this.config_onchange,this),this.container_div=this.build_container_div(),this.header_div=null,!1!==n.header){var a=new h.default.TrackHeaderView({model:this,id:this.id});this.header_div=a.$el,this.container_div.append(this.header_div);var s=a.icons_div;this.action_icons=a.action_icons,this.container_div.hover(function(){s.show()},function(){s.hide()})}};z.prototype.action_icons_def=[{name:"toggle_icon",title:"Hide/show content",css_class:"toggle",on_click_fn:function(e){e.config.get_value("content_visible")?(e.action_icons.toggle_icon.addClass("toggle-expand").removeClass("toggle"),e.hide_contents(),e.config.set_value("content_visible",!1)):(e.action_icons.toggle_icon.addClass("toggle").removeClass("toggle-expand"),e.config.set_value("content_visible",!0),e.show_contents())}},{name:"settings_icon",title:"Edit settings",css_class:"gear",on_click_fn:function(e){new S.default.ConfigSettingCollectionView({collection:e.config}).render_in_modal("Configure Track")}},{name:"remove_icon",title:"Remove",css_class:"remove-icon",on_click_fn:function(t){e(".tooltip").remove(),t.remove()}}],E(z.prototype,{config_params:[{key:"name",label:"Name",type:"text",default_value:""},{key:"content_visible",type:"bool",default_value:!0,hidden:!0}],config_onchange:function(){},init:function(){},changed:function(){this.view.changed()},can_draw:function(){return!(!this.enabled||!this.config.get_value("content_visible"))},request_draw:function(){},_draw:function(e){},to_dict:function(){},set_name:function(e){this.old_name=this.config.get_value("name"),this.config.set_value("name",e)},revert_name:function(){this.old_name&&this.config.set_value("name",this.old_name)},remove:function(){this.changed(),this.container.remove_drawable(this);var t=this.view;this.container_div.hide(0,function(){e(this).remove(),t.update_intro_div()})},build_container_div:function(){},update_icons:function(){},hide_contents:function(){},show_contents:function(){},get_drawables:function(){}});var j=function(e,t,i){z.call(this,e,t,i),this.obj_type=i.obj_type,this.drawables=[]};E(j.prototype,z.prototype,{unpack_drawables:function(e){this.drawables=[];for(var t,i=0;i<e.length;i++)t=ne(e[i],this.view,this),this.add_drawable(t)},init:function(){for(var e=0;e<this.drawables.length;e++)this.drawables[e].init()},_draw:function(e){for(var t=0;t<this.drawables.length;t++)this.drawables[t]._draw(e)},to_dict:function(){for(var e=[],t=0;t<this.drawables.length;t++)e.push(this.drawables[t].to_dict());return{prefs:this.config.to_key_value_dict(),obj_type:this.obj_type,drawables:e}},add_drawable:function(e){this.drawables.push(e),e.container=this,this.changed()},add_drawable_before:function(e,t){this.changed();var i=this.drawables.indexOf(t);return-1!==i&&(this.drawables.splice(i,0,e),!0)},replace_drawable:function(e,t,i){var n=this.drawables.indexOf(e);return-1!==n&&(this.drawables[n]=t,i&&e.container_div.replaceWith(t.container_div),this.changed()),n},remove_drawable:function(e){var t=this.drawables.indexOf(e);return-1!==t&&(this.drawables.splice(t,1),e.container=null,this.changed(),!0)},move_drawable:function(e,t){var i=this.drawables.indexOf(e);return-1!==i&&(this.drawables.splice(i,1),this.drawables.splice(t,0,e),this.changed(),!0)},get_drawables:function(){return this.drawables},get_tracks:function(e){for(var t,i=this.drawables.slice(0),n=[];0!==i.length;)t=i.shift(),t instanceof e?n.push(t):t.drawables&&(i=i.concat(t.drawables));return n}});var L=function(t,i,n){if(E(n,{obj_type:"DrawableGroup",drag_handle_class:"group-handle"}),j.call(this,t,i,n),this.content_div=e("<div/>").addClass("content-div").attr("id","group_"+this.id+"_content_div").appendTo(this.container_div),O(this.container_div,this),O(this.content_div,this),A(this.container_div,this.drag_handle_class,".group",this),this.filters_manager=new b.default.FiltersManager(this),this.header_div.after(this.filters_manager.parent_div),this.filters_manager.parent_div.after(e("<div style='clear: both'/>")),this.saved_filters_managers=[],"drawables"in n&&this.unpack_drawables(n.drawables),"filters"in n){var a=this.filters_manager;this.filters_manager=new b.default.FiltersManager(this,n.filters),a.parent_div.replaceWith(this.filters_manager.parent_div),n.filters.visible&&this.setup_multitrack_filtering()}};E(L.prototype,z.prototype,j.prototype,{action_icons_def:[z.prototype.action_icons_def[0],z.prototype.action_icons_def[1],{name:"composite_icon",title:"Show composite track",css_class:"layers-stack",on_click_fn:function(t){e(".tooltip").remove(),t.show_composite_track()}},{name:"filters_icon",title:"Filters",css_class:"ui-slider-050",on_click_fn:function(e){e.filters_manager.visible()?(e.filters_manager.clear_filters(),e._restore_filter_managers()):(e.setup_multitrack_filtering(),e.request_draw({clear_tile_cache:!0})),e.filters_manager.toggle()}},z.prototype.action_icons_def[2]],build_container_div:function(){var t=e("<div/>").addClass("group").attr("id","group_"+this.id);return this.container&&this.container.content_div.append(t),t},hide_contents:function(){this.tiles_div.hide()},show_contents:function(){this.tiles_div.show(),this.request_draw()},update_icons:function(){var t=this.drawables.length;if(0===t)this.action_icons.composite_icon.hide(),this.action_icons.filters_icon.hide();else if(1===t)this.action_icons.composite_icon.toggle(this.drawables[0]instanceof J),this.action_icons.filters_icon.hide();else{var i,n,a,s=this.drawables[0].get_type(),o=0;for(i=0;i<t;i++){if(a=this.drawables[i],a.get_type()!==s){can_composite=!1;break}a instanceof Z&&o++}if(this.drawables[0]instanceof K?this.action_icons.composite_icon.show():(this.action_icons.composite_icon.hide(),e(".tooltip").remove()),o>1&&o===this.drawables.length){var r,l={};for(a=this.drawables[0],n=0;n<a.filters_manager.filters.length;n++)r=a.filters_manager.filters[n],l[r.name]=[r];for(i=1;i<this.drawables.length;i++)for(a=this.drawables[i],n=0;n<a.filters_manager.filters.length;n++)r=a.filters_manager.filters[n],r.name in l&&l[r.name].push(r);this.filters_manager.remove_all();var d,c;for(var u in l)d=l[u],d.length===o&&(c=new b.default.NumberFilter({name:d[0].name,index:d[0].index}),this.filters_manager.add_filter(c));this.action_icons.filters_icon.toggle(this.filters_manager.filters.length>0)}else this.action_icons.filters_icon.hide()}},_restore_filter_managers:function(){for(var e=0;e<this.drawables.length;e++)this.drawables[e].filters_manager=this.saved_filters_managers[e];this.saved_filters_managers=[]},setup_multitrack_filtering:function(){if(this.filters_manager.filters.length>0){this.saved_filters_managers=[];for(var e=0;e<this.drawables.length;e++){var t=this.drawables[e];this.saved_filters_managers.push(t.filters_manager),t.filters_manager=this.filters_manager}}this.filters_manager.init_filters()},show_composite_track:function(){var e=new J(this.view,this.view,{name:this.config.get_value("name"),drawables:this.drawables});this.container.replace_drawable(this,e,!0);e.request_draw()},add_drawable:function(e){j.prototype.add_drawable.call(this,e),this.update_icons()},remove_drawable:function(e){j.prototype.remove_drawable.call(this,e),this.update_icons()},to_dict:function(){this.filters_manager.visible()&&this._restore_filter_managers();var e=E(j.prototype.to_dict.call(this),{filters:this.filters_manager.to_dict()});return this.filters_manager.visible()&&this.setup_multitrack_filtering(),e},request_draw:function(e){l.each(this.drawables,function(t){t.request_draw(e)})}});var R=n.View.extend({initialize:function(e){E(e,{obj_type:"View"}),j.call(this,"View",e.container,e),this.chrom=null,this.vis_id=e.vis_id,this.dbkey=e.dbkey,this.stand_alone=void 0===e.stand_alone||e.stand_alone,this.label_tracks=[],this.tracks_to_be_redrawn=[],this.max_low=0,this.max_high=0,this.zoom_factor=3,this.min_separation=30,this.has_changes=!1,this.load_chroms_deferred=null,this.render(),this.canvas_manager=new c.default.CanvasManager(this.container.get(0).ownerDocument),this.reset(),this.config=S.default.ConfigSettingCollection.from_models_and_saved_values([{key:"name",label:"Name",type:"text",default_value:""},{key:"a_color",label:"A Color",type:"color",default_value:"#FF0000"},{key:"c_color",label:"C Color",type:"color",default_value:"#00FF00"},{key:"g_color",label:"G Color",type:"color",default_value:"#0000FF"},{key:"t_color",label:"T Color",type:"color",default_value:"#FF00FF"},{key:"n_color",label:"N Color",type:"color",default_value:"#AAAAAA"}],{name:e.name})},render:function(){this.requested_redraw=!1;var t=this.container,i=this;this.top_container=e("<div/>").addClass("top-container").appendTo(t),this.browser_content_div=e("<div/>").addClass("content").appendTo(t),this.bottom_container=e("<div/>").addClass("bottom-container").appendTo(t),this.top_labeltrack=e("<div/>").addClass("top-labeltrack").appendTo(this.top_container),this.viewport_container=e("<div/>").addClass("viewport-container").attr("id","viewport-container").appendTo(this.browser_content_div),this.content_div=this.viewport_container,O(this.viewport_container,i),this.intro_div=e("<div/>").addClass("intro").appendTo(this.viewport_container);e("<div/>").text("Add Datasets to Visualization").addClass("action-button").appendTo(this.intro_div).click(function(){c.default.select_datasets({dbkey:i.dbkey},function(e){l.each(e,function(e){i.add_drawable(ne(e,i,i))})})});this.nav_container=e("<div/>").addClass("trackster-nav-container").prependTo(this.top_container),this.nav=e("<div/>").addClass("trackster-nav").appendTo(this.nav_container),this.stand_alone&&(this.nav_container.addClass("stand-alone"),this.nav.addClass("stand-alone")),this.overview=e("<div/>").addClass("overview").appendTo(this.bottom_container),this.overview_viewport=e("<div/>").addClass("overview-viewport").appendTo(this.overview),this.overview_close=e("<a/>").attr("title","Close overview").addClass("icon-button overview-close tooltip").hide().appendTo(this.overview_viewport),this.overview_highlight=e("<div/>").addClass("overview-highlight").hide().appendTo(this.overview_viewport),this.overview_box_background=e("<div/>").addClass("overview-boxback").appendTo(this.overview_viewport),this.overview_box=e("<div/>").addClass("overview-box").appendTo(this.overview_viewport),this.default_overview_height=this.overview_box.height(),this.nav_controls=e("<div/>").addClass("nav-controls").appendTo(this.nav),this.chrom_select=e("<select/>").attr({name:"chrom"}).addClass("chrom-nav").append("<option value=''>Loading</option>").appendTo(this.nav_controls);var n=function(t){"focusout"!==t.type&&13!==(t.keyCode||t.which)&&27!==(t.keyCode||t.which)||(27!==(t.keyCode||t.which)&&i.go_to(e(this).val()),e(this).hide(),e(this).val(""),i.location_span.show(),i.chrom_select.show()),t.stopPropagation()};this.nav_input=e("<input/>").addClass("nav-input").hide().bind("keyup focusout",n).appendTo(this.nav_controls),this.location_span=e("<span/>").addClass("location").attr("title","Click to change location").tooltip({placement:"bottom"}).appendTo(this.nav_controls),this.location_span.click(function(){i.location_span.hide(),i.chrom_select.hide(),i.nav_input.val(i.chrom+":"+i.low+"-"+i.high),i.nav_input.css("display","inline-block"),i.nav_input.select(),i.nav_input.focus(),i.nav_input.autocomplete({source:function(t,n){var a=[],s=e.map(i.get_tracks(Z),function(e){return e.data_manager.search_features(t.term).success(function(e){a=a.concat(e)})});e.when.apply(e,s).done(function(){n(e.map(a,function(e){return{label:e[0],value:e[1]}}))})},minLength:2})}),void 0!==this.vis_id&&(this.hidden_input=e("<input/>").attr("type","hidden").val(this.vis_id).appendTo(this.nav_controls)),this.zo_link=e("<a/>").attr("id","zoom-out").attr("title","Zoom out").tooltip({placement:"bottom"}).click(function(){i.zoom_out()}).appendTo(this.nav_controls),this.zi_link=e("<a/>").attr("id","zoom-in").attr("title","Zoom in").tooltip({placement:"bottom"}).click(function(){i.zoom_in()}).appendTo(this.nav_controls),this.load_chroms_deferred=this.load_chroms({low:0}),this.chrom_select.bind("change",function(){i.change_chrom(i.chrom_select.val())}),this.browser_content_div.click(function(t){e(this).find("input").trigger("blur")}),this.browser_content_div.bind("dblclick",function(e){i.zoom_in(e.pageX,this.viewport_container)}),this.overview_box.bind("dragstart",function(e,t){this.current_x=t.offsetX}).bind("drag",function(e,t){var n=t.offsetX-this.current_x;this.current_x=t.offsetX;var a=Math.round(n/i.viewport_container.width()*(i.max_high-i.max_low));i.move_delta(-a)}),this.overview_close.click(function(){i.reset_overview()}),this.viewport_container.bind("draginit",function(e,t){if(e.clientX>i.viewport_container.width()-16)return!1}).bind("dragstart",function(e,t){t.original_low=i.low,t.current_height=e.clientY,t.current_x=t.offsetX}).bind("drag",function(t,n){var a=e(this),s=n.offsetX-n.current_x,o=a.scrollTop()-(t.clientY-n.current_height);a.scrollTop(o),n.current_height=t.clientY,n.current_x=n.offsetX;var r=Math.round(s/i.viewport_container.width()*(i.high-i.low));i.move_delta(r)}),this.top_labeltrack.bind("dragstart",function(t,n){return e("<div/>").addClass("zoom-area").css("height",i.browser_content_div.height()+i.top_labeltrack.height()+1).appendTo(e(this))}).bind("drag",function(t,n){e(n.proxy).css({left:Math.min(t.pageX,n.startX)-i.container.offset().left,width:Math.abs(t.pageX-n.startX)});var a=Math.min(t.pageX,n.startX)-i.container.offset().left,s=Math.max(t.pageX,n.startX)-i.container.offset().left,o=i.high-i.low,r=i.viewport_container.width();i.update_location(Math.round(a/r*o)+i.low,Math.round(s/r*o)+i.low)}).bind("dragend",function(t,n){var a=Math.min(t.pageX,n.startX),s=Math.max(t.pageX,n.startX),o=i.high-i.low,r=i.viewport_container.width(),l=i.low;i.low=Math.round(a/r*o)+l,i.high=Math.round(s/r*o)+l,e(n.proxy).remove(),i.request_redraw()}),this.add_label_track(new W(this,{content_div:this.top_labeltrack})),e(window).bind("resize",function(){this.resize_timer&&clearTimeout(this.resize_timer),this.resize_timer=setTimeout(function(){i.resize_window()},500)}),e(document).bind("redraw",function(){i.redraw()}),this.reset(),e(window).trigger("resize")},get_base_color:function(e){return this.config.get_value(e.toLowerCase()+"_color")||this.config.get_value("n_color")}});E(R.prototype,j.prototype,{changed:function(){this.has_changes=!0},update_intro_div:function(){this.intro_div.toggle(0===this.drawables.length)},trigger_navigate:function(e,t,i,n){if(this.timer&&clearTimeout(this.timer),n){var a=this;this.timer=setTimeout(function(){a.trigger("navigate",e+":"+t+"-"+i)},500)}else view.trigger("navigate",e+":"+t+"-"+i)},update_location:function(e,t){this.location_span.text(p.default.commatize(e)+" - "+p.default.commatize(t)),this.nav_input.val(this.chrom+":"+p.default.commatize(e)+"-"+p.default.commatize(t));var i=this.chrom_select.val();""!==i&&this.trigger_navigate(i,this.low,this.high,!0)},load_chroms:function(t){t.num=100;var i=this,n=e.Deferred();return e.ajax({url:Galaxy.root+"api/genomes/"+this.dbkey,data:t,dataType:"json",success:function(t){if(0!==t.chrom_info.length){if(t.reference){var a=new X(i);i.add_label_track(a),i.reference_track=a}i.chrom_data=t.chrom_info,i.chrom_select.html(""),i.chrom_select.append(e('<option value="">Select Chrom/Contig</option>'));for(var s=0,o=i.chrom_data.length;s<o;s++){var r=i.chrom_data[s].chrom,l=e("<option>");l.text(r),l.val(r),i.chrom_select.append(l)}t.prev_chroms&&i.chrom_select.append(e('<option value="previous">Previous 100</option>')),t.next_chroms&&i.chrom_select.append(e('<option value="next">Next 100</option>')),i.chrom_start_index=t.start_index,n.resolve(t.chrom_info)}},error:function(){alert("Could not load chroms for this dbkey: "+i.dbkey)}}),n},change_chrom:function(t,i,n){var a=this;if(!a.chrom_data)return void a.load_chroms_deferred.then(function(){a.change_chrom(t,i,n)});if(t&&"None"!==t){if("previous"===t)return void a.load_chroms({low:this.chrom_start_index-100});if("next"===t)return void a.load_chroms({low:this.chrom_start_index+100});var s=e.grep(a.chrom_data,function(e,i){return e.chrom===t})[0];if(void 0===s)return void a.load_chroms({chrom:t},function(){a.change_chrom(t,i,n)});if(t!==a.chrom){a.chrom=t,a.chrom_select.val(a.chrom),a.max_high=s.len-1,a.reset();for(var o=0,r=a.drawables.length;o<r;o++){var l=a.drawables[o];l.init&&l.init()}a.reference_track&&a.reference_track.init()}void 0===i&&void 0===n?(a.low=0,a.high=a.max_high):(a.low=void 0!==i?Math.max(i,0):0,void 0===n?(a.low=Math.max(a.low-15,0),a.high=a.low+30):a.high=Math.min(n,a.max_high)),a.request_redraw()}},go_to:function(e){e=e.replace(/,/g,""),e=e.replace(/:|\-/g," ");var t=e.split(/\s+/),i=t[0],n=t[1]?parseInt(t[1],10):void 0,a=t[2]?parseInt(t[2],10):void 0;this.change_chrom(i,n,a)},move_fraction:function(e){var t=this,i=t.high-t.low;this.move_delta(e*i)},move_delta:function(e){var t=this,i=t.high-t.low;t.low-e<t.max_low?(t.low=t.max_low,t.high=t.max_low+i):t.high-e>t.max_high?(t.high=t.max_high,t.low=t.max_high-i):(t.high-=e,t.low-=e),t.request_redraw({data_fetch:!1}),this.redraw_on_move_fn&&clearTimeout(this.redraw_on_move_fn),this.redraw_on_move_fn=setTimeout(function(){t.request_redraw()},200);var n=t.chrom_select.val();this.trigger_navigate(n,t.low,t.high,!0)},add_drawable:function(e){j.prototype.add_drawable.call(this,e),e.init(),this.changed(),this.update_intro_div();var t=this;e.config.on("change",function(){t.changed()})},add_label_track:function(e){e.view=this,e.init(),this.label_tracks.push(e)},remove_drawable:function(t,i){if(j.prototype.remove_drawable.call(this,t),i){var n=this;t.container_div.hide(0,function(){e(this).remove(),n.update_intro_div()})}},reset:function(){this.low=this.max_low,this.high=this.max_high,this.viewport_container.find(".yaxislabel").remove()},request_redraw:function(e,t){var i=this,n=t?[t]:i.drawables;l.each(n,function(t){var n=l.find(i.tracks_to_be_redrawn,function(e){return e[0]===t});n?n[1]=e:i.tracks_to_be_redrawn.push([t,e])}),this.requested_redraw||(requestAnimationFrame(function(){i._redraw()}),this.requested_redraw=!0)},_redraw:function(){this.requested_redraw=!1;var e=this.low,t=this.high;e<this.max_low&&(e=this.max_low),t>this.max_high&&(t=this.max_high);var i=this.high-this.low;0!==this.high&&i<this.min_separation&&(t=e+this.min_separation),this.low=Math.floor(e),this.high=Math.ceil(t),this.update_location(this.low,this.high),this.resolution_px_b=this.viewport_container.width()/(this.high-this.low);var n=this.low/(this.max_high-this.max_low)*this.overview_viewport.width()||0,a=(this.high-this.low)/(this.max_high-this.max_low)*this.overview_viewport.width()||0;this.overview_box.css({left:n,width:Math.max(13,a)}).show(),a<13&&this.overview_box.css("left",n-(13-a)/2),this.overview_highlight&&this.overview_highlight.css({left:n,width:a}),l.each(this.tracks_to_be_redrawn,function(e){var t=e[0],i=e[1];t&&t._draw(i)}),this.tracks_to_be_redrawn=[],l.each(this.label_tracks,function(e){e._draw()})},zoom_in:function(e,t){if(!(0===this.max_high||this.high-this.low<=this.min_separation)){var i=this.high-this.low,n=i/2+this.low,a=i/this.zoom_factor/2;e&&(n=e/this.viewport_container.width()*(this.high-this.low)+this.low),this.low=Math.round(n-a),this.high=Math.round(n+a),this.changed(),this.request_redraw()}},zoom_out:function(){if(0!==this.max_high){var e=this.high-this.low,t=e/2+this.low,i=e*this.zoom_factor/2;this.low=Math.round(t-i),this.high=Math.round(t+i),this.changed(),this.request_redraw()}},resize_viewport:function(){this.viewport_container.height(this.container.height()-this.top_container.height()-this.bottom_container.height())},resize_window:function(){this.resize_viewport(),this.request_redraw()},set_overview:function(e){if(this.overview_drawable){if(this.overview_drawable.dataset.id===e.dataset.id)return;this.overview_viewport.find(".track").remove()}var t=e.copy({content_div:this.overview_viewport}),i=this;t.header_div.hide(),t.is_overview=!0,i.overview_drawable=t,this.overview_drawable.postdraw_actions=function(){i.overview_highlight.show().height(i.overview_drawable.content_div.height()),i.overview_viewport.height(i.overview_drawable.content_div.height()+i.overview_box.outerHeight()),i.overview_close.show(),i.resize_window()},i.overview_drawable.request_draw(),this.changed()},reset_overview:function(){e(".tooltip").remove(),this.overview_viewport.find(".track-tile").remove(),this.overview_viewport.height(this.default_overview_height),this.overview_box.height(this.default_overview_height),this.overview_close.hide(),this.overview_highlight.hide(),view.resize_window(),view.overview_drawable=null}});var V=C.default.Tool.extend({defaults:{track:null},initialize:function(e){C.default.Tool.prototype.initialize.call(this,e);var t=!0;void 0!==e.tool_state&&void 0!==e.tool_state.hidden&&(t=e.tool_state.hidden),this.set("hidden",t),this.remove_inputs(["data","hidden_data","conditional"])},state_dict:function(e){return l.extend(this.get_inputs_dict(),{hidden:!this.is_visible()})}}),N=n.View.extend({events:{"change :input":"update_value"},render:function(){var t=this.$el.addClass("param-row"),i=this.model;e("<div>").addClass("param-label").text(i.get("label")).appendTo(t);e("<div/>").addClass("param-input").html(i.get("html")).appendTo(t).find(":input").val(i.get("value")),e("<div style='clear: both;'/>").appendTo(t)},update_value:function(t){this.model.set_value(e(t.target).val())}}),G=n.View.extend({initialize:function(e){this.model.on("change:hidden",this.set_visible,this)},render:function(){var t=this,i=this.model,n=this.$el.addClass("dynamic-tool").hide();n.bind("drag",function(e){e.stopPropagation()}).click(function(e){e.stopPropagation()}).bind("dblclick",function(e){e.stopPropagation()}).keydown(function(e){e.stopPropagation()});e("<div class='tool-name'>").appendTo(n).text(i.get("name"));i.get("inputs").each(function(e){var t=new N({model:e});t.render(),n.append(t.$el)}),n.find("input").click(function(){e(this).select()});var a=e("<div>").addClass("param-row").appendTo(n),s=e("<input type='submit'>").attr("value","Run on complete dataset").appendTo(a);e("<input type='submit'>").attr("value","Run on visible region").appendTo(a).click(function(){t.run_on_region()}),s.click(function(){t.run_on_dataset()}),i.is_visible()&&this.$el.show()},set_visible:function(){this.$el.toggle(this.model.is_visible())},update_params:function(){for(var e=0;e<this.params.length;e++)this.params[e].update_value()},run_on_dataset:function(){var e=this.model;this.run({target_dataset_id:this.model.get("track").dataset.id,action:"rerun",tool_id:e.id},null,function(t){Galaxy.modal.show({title:e.get("name")+" is Running",body:e.get("name")+" is running on the complete dataset. Tool outputs are in dataset's history.",buttons:{Close:function(){Galaxy.modal.hide()}}})})},run_on_region:function(){var e,t=this.model.get("track"),i=this.model,n=new c.default.GenomeRegion({chrom:t.view.chrom,start:t.view.low,end:t.view.high}),a={target_dataset_id:t.dataset.id,action:"rerun",tool_id:i.id,regions:[n.toJSON()]},s=t,o=i.get("name")+s.tool_region_and_parameters_str(n);if(s.container===view){var r=new L(view,view,{name:t.config.get_value("name")}),l=s.container.replace_drawable(s,r,!1);r.container_div.insertBefore(s.view.content_div.children()[l]),r.add_drawable(s),s.container_div.appendTo(r.content_div),e=r}else e=s.container;var d=new s.constructor(view,e,{name:o,hda_ldda:"hda"});d.init_for_tool_data(),d.change_mode(s.mode),d.set_filters_manager(s.filters_manager.copy(d)),d.update_icons(),e.add_drawable(d),d.tiles_div.text("Starting job."),this.run(a,d,function(e){d.set_dataset(new x.default.Dataset(e)),d.tiles_div.text("Running job."),d.init()})},run:function(t,i,n){t.inputs=this.model.get_inputs_dict();var a=new p.default.ServerStateDeferred({ajax_settings:{url:Galaxy.root+"api/tools",data:JSON.stringify(t),dataType:"json",contentType:"application/json",type:"POST"},interval:2e3,success_fn:function(e){return"pending"!==e}});e.when(a.go()).then(function(e){"no converter"===e?(i.container_div.addClass("error"),i.content_div.text(D)):e.error?(i.container_div.addClass("error"),i.content_div.text("Tool cannot be rerun: "+e.message)):n(e)})}}),U=function(e,t){v.default.Scaler.call(this,t),this.filter=e};U.prototype.gen_val=function(e){return this.filter.high===Number.MAX_VALUE||this.filter.low===-Number.MAX_VALUE||this.filter.low===this.filter.high?this.default_val:(parseFloat(e[this.filter.index])-this.filter.low)/(this.filter.high-this.filter.low)};var H=function(t,i,n,a,s){this.track=t,this.region=i,this.low=i.get("start"),this.high=i.get("end"),this.w_scale=n,this.canvas=a,this.html_elt=e("<div class='track-tile'/>").append(a),this.data=s,this.stale=!1};H.prototype.predisplay_actions=function(){};var F=function(e,t,i,n,a){H.call(this,e,t,i,n,a)};F.prototype.predisplay_actions=function(){};var B=function(e,t,i,n,a,s,o,r,l,d,c){H.call(this,e,t,i,n,a),this.mode=s,this.all_slotted=r,this.feature_mapper=l,this.has_icons=!1,this.incomplete_features=d,this.other_tiles_features_drawn={},this.seq_data=c};E(B.prototype,H.prototype),B.prototype.predisplay_actions=function(){};var q=function(t,i,a){E(a,{drag_handle_class:"draghandle"}),z.call(this,t,i,a),this.dataset=null,a.dataset&&(this.dataset=a.dataset instanceof n.Model?a.dataset:new x.default.Dataset(a.dataset)),this.dataset_check_type="converted_datasets_state",this.data_url_extra_params={},this.data_query_wait="data_query_wait"in a?a.data_query_wait:5e3,this.data_manager="data_manager"in a?a.data_manager:new c.default.GenomeDataManager({dataset:this.dataset,genome:new c.default.Genome({key:t.dbkey,chroms_info:{chrom_info:t.chrom_data}}),data_mode_compatible:this.data_and_mode_compatible,can_subset:this.can_subset}),this.min_height_px=16,this.max_height_px=800,this.visible_height_px=this.config.get_value("height"),this.content_div=e("<div class='track-content'>").appendTo(this.container_div),this.container&&(this.container.content_div.append(this.container_div),"resize"in a&&!a.resize||this.add_resize_handle())};E(q.prototype,z.prototype,{action_icons_def:[{name:"mode_icon",title:"Set display mode",css_class:"chevron-expand",on_click_fn:function(){}},z.prototype.action_icons_def[0],{name:"overview_icon",title:"Set as overview",css_class:"application-dock-270",on_click_fn:function(e){e.view.set_overview(e)}},z.prototype.action_icons_def[1],{name:"filters_icon",title:"Filters",css_class:"ui-slider-050",on_click_fn:function(e){e.filters_manager.visible()?e.filters_manager.clear_filters():e.filters_manager.init_filters(),e.filters_manager.toggle()}},{name:"tools_icon",title:"Tool",css_class:"hammer",on_click_fn:function(t){t.tool.toggle(),t.tool.is_visible()?t.set_name(t.config.get_value("name")+t.tool_region_and_parameters_str()):t.revert_name(),e(".tooltip").remove()}},{name:"param_space_viz_icon",title:"Tool parameter space visualization",css_class:"arrow-split",on_click_fn:function(t){var i="<strong>Tool</strong>:"+t.tool.get("name")+"<br/><strong>Dataset</strong>:"+t.config.get_value("name")+'<br/><strong>Region(s)</strong>: <select name="regions"><option value="cur">current viewing area</option><option value="bookmarks">bookmarks</option><option value="both">current viewing area and bookmarks</option></select>',a=function(){Galaxy.modal.hide(),e(window).unbind("keypress.check_enter_esc")},s=function(){var i,a=e('select[name="regions"] option:selected').val(),s=new c.default.GenomeRegion({chrom:view.chrom,start:view.low,end:view.high}),o=l.map(e(".bookmark"),function(t){return new c.default.GenomeRegion({from_str:e(t).children(".position").text()})});i="cur"===a?[s]:"bookmarks"===a?o:[s].concat(o),Galaxy.modal.hide(),window.location.href=Galaxy.root+"visualization/sweepster?"+e.param({dataset_id:t.dataset.id,hda_ldda:t.dataset.get("hda_ldda"),regions:JSON.stringify(new n.Collection(i).toJSON())})};Galaxy.modal.show({title:"Visualize tool parameter space and output from different parameter settings?",body:i,buttons:{No:a,Yes:s}})}},z.prototype.action_icons_def[2]],can_draw:function(){return this.dataset&&z.prototype.can_draw.call(this)},build_container_div:function(){return e("<div/>").addClass("track").attr("id","track_"+this.id)},set_dataset:function(e){this.dataset=e,this.data_manager.set("dataset",e)},on_resize:function(){this.request_draw({clear_tile_cache:!0})},add_resize_handle:function(){var t=this,i=!1,n=!1,a=e("<div class='track-resize'>");e(t.container_div).hover(function(){t.config.get_value("content_visible")&&(i=!0,a.show())},function(){i=!1,n||a.hide()}),a.hide().bind("dragstart",function(i,a){n=!0,a.original_height=e(t.content_div).height()}).bind("drag",function(i,n){var a=Math.min(Math.max(n.original_height+n.deltaY,t.min_height_px),t.max_height_px);e(t.tiles_div).css("height",a),t.visible_height_px=t.max_height_px===a?0:a,t.on_resize()}).bind("dragend",function(e,s){t.tile_cache.clear(),n=!1,i||a.hide(),t.config.set_value("height",t.visible_height_px),t.changed()}).appendTo(t.container_div)},hide_contents:function(){this.tiles_div.hide(),this.container_div.find(".yaxislabel, .track-resize").hide()},show_contents:function(){this.tiles_div.show(),this.container_div.find(".yaxislabel, .track-resize").show(),this.request_draw()},get_type:function(){return this instanceof W?"LabelTrack":this instanceof X?"ReferenceTrack":this instanceof K?"LineTrack":this instanceof te?"ReadTrack":this instanceof ee?"VariantTrack":this instanceof J?"CompositeTrack":this instanceof Z?"FeatureTrack":""},show_message:function(t){return this.tiles_div.remove(),e("<span/>").addClass("message").html(t).appendTo(this.content_div)},init:function(t){var i=this;if(i.enabled=!1,i.tile_cache.clear(),i.data_manager.clear(),i.content_div.children().remove(),i.container_div.removeClass("nodata error pending"),i.tiles_div=e("<div/>").addClass("tiles").appendTo(i.content_div),i.dataset.id){var n=e.Deferred(),a={hda_ldda:i.dataset.get("hda_ldda"),data_type:this.dataset_check_type,chrom:i.view.chrom,retry:t};return e.getJSON(this.dataset.url(),a,function(t){if(t&&"error"!==t&&"error"!==t.kind)"no converter"===t?(i.container_div.addClass("error"),i.show_message(D)):"no data"===t||void 0!==t.data&&(null===t.data||0===t.data.length)?(i.container_div.addClass("nodata"),i.show_message("No data for this chrom/contig.")):"pending"===t?(i.container_div.addClass("pending"),i.show_message("Preparing data. This can take a while for a large dataset. If the visualization is saved and closed, preparation will continue in the background."),setTimeout(function(){i.init()},i.data_query_wait)):"data"!==t&&"data"!==t.status||(t.valid_chroms&&(i.valid_chroms=t.valid_chroms,i.update_icons()),i.tiles_div.text("Ready for display"),i.view.chrom?(i.tiles_div.text(""),i.tiles_div.css("height",i.visible_height_px+"px"),i.enabled=!0,e.when.apply(e,i.predraw_init()).done(function(){n.resolve(),i.container_div.removeClass("nodata error pending"),i.request_draw()})):n.resolve());else{i.container_div.addClass("error");var a=i.show_message("Cannot display dataset due to an error. ");t.message&&(a.append(e("<a href='javascript:void(0);'></a>").text("View error").click(function(){Galaxy.modal.show({title:"Trackster Error",body:"<pre>"+t.message+"</pre>",buttons:{Close:function(){Galaxy.modal.hide()}}})})),a.append(e("<span/>").text(" ")),a.append(e("<a href='javascript:void(0);'></a>").text("Try again").click(function(){i.init(!0)})))}}),this.update_icons(),n}},predraw_init:function(){var t=this;return e.getJSON(t.dataset.url(),{data_type:"data",stats:!0,chrom:t.view.chrom,low:0,high:t.view.max_high,hda_ldda:t.dataset.get("hda_ldda")},function(e){var i=e.data;if(i&&void 0!==i.min&&void 0!==i.max){var n=i.min,a=i.max;n=Math.floor(Math.min(0,Math.max(n,i.mean-2*i.sd))),a=Math.ceil(Math.max(0,Math.min(a,i.mean+2*i.sd))),t.config.set_default_value("min_value",n),t.config.set_default_value("max_value",a),t.config.set_value("min_value",n),t.config.set_value("max_value",a)}})},get_drawables:function(){return this}});var Y=function(t,i,n){q.call(this,t,i,n);var a=this;if(A(a.container_div,a.drag_handle_class,".group",a),this.filters_manager=new b.default.FiltersManager(this,"filters"in n?n.filters:null),this.data_manager.set("filters_manager",this.filters_manager),this.filters_available=!1,this.tool=n.tool?new V(l.extend(n.tool,{track:this,tool_state:n.tool_state})):null,this.tile_cache=new c.default.Cache(10),this.left_offset=0,this.header_div&&(this.set_filters_manager(this.filters_manager),this.tool)){var s=new G({model:this.tool});s.render(),this.dynamic_tool_div=s.$el,this.header_div.after(this.dynamic_tool_div)}this.tiles_div=e("<div/>").addClass("tiles").appendTo(this.content_div),this.config.get_value("content_visible")||this.tiles_div.hide(),this.overlay_div=e("<div/>").addClass("overlay").appendTo(this.content_div),n.mode&&this.change_mode(n.mode)};E(Y.prototype,z.prototype,q.prototype,{action_icons_def:q.prototype.action_icons_def.concat([{name:"show_more_rows_icon",title:"To minimize track height, not all feature rows are displayed. Click to display more rows.",css_class:"exclamation",on_click_fn:function(t){e(".tooltip").remove(),t.slotters[t.view.resolution_px_b].max_rows*=2,t.request_draw({clear_tile_cache:!0})},hide:!0}]),copy:function(e){var t=this.to_dict();E(t,{data_manager:this.data_manager});var i=new this.constructor(this.view,e,t);return i.change_mode(this.mode),i.enabled=this.enabled,i},set_filters_manager:function(e){this.filters_manager=e,this.header_div.after(this.filters_manager.parent_div)},to_dict:function(){return{track_type:this.get_type(),dataset:{id:this.dataset.id,hda_ldda:this.dataset.get("hda_ldda")},prefs:this.config.to_key_value_dict(),mode:this.mode,filters:this.filters_manager.to_dict(),tool_state:this.tool?this.tool.state_dict():{}}},set_min_max:function(){var t=this;return e.getJSON(t.dataset.url(),{data_type:"data",stats:!0,chrom:t.view.chrom,low:0,high:t.view.max_high,hda_ldda:t.dataset.get("hda_ldda")},function(e){var i=e.data;if(isNaN(parseFloat(t.config.get_value("min_value")))||isNaN(parseFloat(t.config.get_value("max_value")))){var n=i.min,a=i.max;n=Math.floor(Math.min(0,Math.max(n,i.mean-2*i.sd))),a=Math.ceil(Math.max(0,Math.min(a,i.mean+2*i.sd))),t.config.set_value("min_value",n),t.config.set_value("max_value",a)}})},change_mode:function(e){var t=this;return t.mode=e,t.config.set_value("mode",e),"Auto"===e&&this.data_manager.clear(),t.request_draw({clear_tile_cache:!0}),this.action_icons.mode_icon.attr("title","Set display mode (now: "+t.mode+")"),t},update_icons:function(){var e=this;e.action_icons.filters_icon.toggle(e.filters_available),e.action_icons.tools_icon.toggle(null!==e.tool),e.action_icons.param_space_viz_icon.toggle(null!==e.tool)},_gen_tile_cache_key:function(e,t){return e+"_"+t},request_draw:function(e){e&&e.clear_tile_cache&&this.tile_cache.clear(),this.view.request_redraw(e,this)},before_draw:function(){this.max_height_px=0},_draw:function(t){if(this.can_draw()){var i=t&&t.clear_after,n=this.view.low,a=this.view.high,s=this.view.container.width(),o=this.view.resolution_px_b,r=1/o;this.is_overview&&(n=this.view.max_low,a=this.view.max_high,o=s/(view.max_high-view.max_low),r=1/o),this.before_draw(),this.tiles_div.children().addClass("remove");for(var d,u,h=Math.floor(400*r),f=Math.floor(n/h),p=[],m=[];f*h<a;)d=new c.default.GenomeRegion({chrom:this.view.chrom,start:f*h,end:Math.min((f+1)*h,this.view.max_high)}),u=this.draw_helper(d,o,t),p.push(u),e.when(u).then(function(e){m.push(e)}),f+=1;i||this.tiles_div.children(".remove").removeClass("remove").remove();var _=this;e.when.apply(e,p).then(function(){_.tiles_div.children(".remove").remove(),m=l.filter(m,function(e){return null!==e}),0!==m.length&&_.postdraw_actions(m,s,o,i)})}},_add_yaxis_label:function(t,i){var n=this,a="max"===t?"top":"bottom",o="max"===t?"max":"min",r="max"===t?"max_value":"min_value",l=this.container_div.find(".yaxislabel."+a),d=s(n.config.get_value(r),1);i=i||function(){n.request_draw({clear_tile_cache:!0})},0!==l.length?l.text(d):(l=e("<div/>").text(d).make_text_editable({num_cols:12,on_finish:function(t){e(".tooltip").remove(),n.config.set_value(r,s(t,1)),i()},help_text:"Set "+o+" value"}).addClass("yaxislabel "+a).css("color",this.config.get_value("label_color")),this.container_div.prepend(l))},postdraw_actions:function(e,t,i,n){if(l.filter(e,function(e){return e instanceof F}).length>0){this.max_height_px=0;var a=this;l.each(e,function(e){e instanceof F||(e.html_elt.remove(),a.draw_helper(e.region,i,{force:!0,mode:"Coverage"}))}),a._add_yaxis_label("max")}else this.container_div.find(".yaxislabel").remove(),l.find(e,function(e){return e.has_icons})&&l.each(e,function(e){e.has_icons||e.html_elt.css("padding-top",20)})},get_mode:function(e){return this.mode},update_auto_mode:function(e){},_get_drawables:function(){return[this]},draw_helper:function(t,i,n){n||(n={});var a=n.force,s=n.mode||this.mode,o=1/i,r=this,d=this._get_drawables(),c=this._gen_tile_cache_key(i,t),u=a?void 0:r.tile_cache.get_elt(c);if(u)return function(e){return e&&"track"in e}(u)&&r.show_tile(u,i),u;if(!1===n.data_fetch)return null;var h=function(){var e=l.find(I,function(e){return e===s})?"Coverage":s,i=l.map(d,function(i){return i.data_manager.get_data(t,e,o,r.data_url_extra_params)});return view.reference_track&&i.push(view.reference_track.data_manager.get_data(t,s,o,view.reference_track.data_url_extra_params)),i},f=e.Deferred();return r.tile_cache.set_elt(c,f),e.when.apply(e,h()).then(function(){var a,s=h(),o=s;if(l.find(s,function(e){return p.default.is_deferred(e)}))return r.tile_cache.set_elt(c,void 0),void e.when(r.draw_helper(t,i,n)).then(function(e){f.resolve(e)});view.reference_track&&(a=view.reference_track.data_manager.subset_entry(s.pop(),t));var u=[],m=[];l.each(d,function(e,t){var n=e.mode,a=o[t];"Auto"===n&&(n=e.get_mode(a),e.update_auto_mode(n)),u.push(n),m.push(e.get_canvas_height(a,n,i,b))});var _,g=r.view.canvas_manager.new_canvas(),v=t.get("start"),w=t.get("end"),b=Math.ceil((w-v)*i)+r.left_offset,y=l.max(m);g.width=b,g.height=n.height||y;var x=g.getContext("2d");x.translate(r.left_offset,0),d.length>1&&(x.globalAlpha=.5,x.globalCompositeOperation="source-over"),l.each(d,function(e,n){_=e.draw_tile(o[n],x,u[n],t,i,a)}),void 0!==_&&(r.tile_cache.set_elt(c,_),r.show_tile(_,i)),f.resolve(_)}),f},get_canvas_height:function(e,t,i,n){return this.visible_height_px},_draw_line_track_tile:function(e,t,i,n,a){-1!==[void 0,null].indexOf(this.config.get_value("min_value"))&&this.config.set_value("min_value",0),-1!==[void 0,null,0].indexOf(this.config.get_value("max_value"))&&this.config.set_value("max_value",l.max(l.map(e.data,function(e){return e[1]}))||0);var s=t.canvas;return new v.default.LinePainter(e.data,n.get("start"),n.get("end"),this.config.to_key_value_dict(),i).draw(t,s.width,s.height,a),new F(this,n,a,s,e.data)},draw_tile:function(e,t,i,n,a,s){},show_tile:function(e,t){var i=e.html_elt;e.predisplay_actions();var n=Math.round((e.low-(this.is_overview?this.view.max_low:this.view.low))*t);this.left_offset&&(n-=this.left_offset),i.css("left",n),i.hasClass("remove")?i.removeClass("remove"):this.tiles_div.append(i),i.css("height","auto"),this.max_height_px=Math.max(this.max_height_px,i.height()-2),i.parent().children().css("height",this.max_height_px+"px");var a=this.max_height_px;0!==this.visible_height_px&&(a=Math.min(this.max_height_px,this.visible_height_px)),this.tiles_div.css("height",a+"px")},tool_region_and_parameters_str:function(e){var t=this;return" - region=["+(void 0!==e?e.toString():"all")+"], parameters=["+l.values(t.tool.get_inputs_dict()).join(", ")+"]"},data_and_mode_compatible:function(e,t){return"Auto"===t||("Coverage"===t?"bigwig"===e.dataset_type:"bigwig"!==e.dataset_type&&"no_detail"!==e.extra_info)},can_subset:function(e){return!e.message&&"no_detail"!==e.extra_info&&("bigwig"!==e.dataset_type||e.data[1][0]-e.data[0][0]==1)},init_for_tool_data:function(){this.data_manager.set("data_type","raw_data"),this.data_query_wait=1e3,this.dataset_check_type="state"}});var W=function(e,t){q.call(this,e,t,{resize:!1,header:!1}),this.container_div.addClass("label-track")};E(W.prototype,q.prototype,{init:function(){this.enabled=!0},predraw_init:function(){},_draw:function(t){for(var i=this.view,n=i.high-i.low,a=Math.floor(Math.pow(10,Math.floor(Math.log(n)/Math.log(10)))),s=Math.floor(i.low/a)*a,o=this.view.container.width(),r=e("<div/>").addClass("label-container");s<i.high;){var l=Math.floor((s-i.low)/n*o);r.append(e("<div/>").addClass("pos-label").text(p.default.commatize(s)).css({left:l})),s+=a}this.content_div.children(":first").remove(),this.content_div.append(r)}});var J=function(e,t,i){if(Y.call(this,e,t,i),this.drawables=[],"drawables"in i){for(var n,a=0;a<i.drawables.length;a++)n=i.drawables[a],this.drawables[a]=ne(n,e,null),n.left_offset>this.left_offset&&(this.left_offset=n.left_offset);this.enabled=!0}l.each(this.drawables,function(e){(e instanceof Z||e instanceof te)&&e.change_mode("Coverage")}),this.update_icons(),this.obj_type="CompositeTrack"};E(J.prototype,Y.prototype,{display_modes:I,build_config_params:function(){return l.union(z.prototype.config_params,[{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},action_icons_def:[{name:"composite_icon",title:"Show individual tracks",css_class:"layers-stack",on_click_fn:function(t){e(".tooltip").remove(),t.show_group()}}].concat(Y.prototype.action_icons_def),to_dict:j.prototype.to_dict,add_drawable:j.prototype.add_drawable,unpack_drawables:j.prototype.unpack_drawables,config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},on_resize:function(){var e=this.visible_height_px;l.each(this.drawables,function(t){t.visible_height_px=e}),q.prototype.on_resize.call(this)},change_mode:function(e){Y.prototype.change_mode.call(this,e);for(var t=0;t<this.drawables.length;t++)this.drawables[t].change_mode(e)},init:function(){for(var t=[],i=0;i<this.drawables.length;i++)t.push(this.drawables[i].init());var n=this;e.when.apply(e,t).then(function(){n.enabled=!0,n.request_draw()})},update_icons:function(){this.action_icons.filters_icon.hide(),this.action_icons.tools_icon.hide(),this.action_icons.param_space_viz_icon.hide()},can_draw:z.prototype.can_draw,_get_drawables:function(){return this.drawables},show_group:function(){for(var e,t=new L(this.view,this.container,{name:this.config.get_value("name")}),i=0;i<this.drawables.length;i++)e=this.drawables[i],e.update_icons(),t.add_drawable(e),e.container=t,t.content_div.append(e.container_div);this.container.replace_drawable(this,t,!0);t.request_draw({clear_tile_cache:!0})},before_draw:function(){var e=l.min(l.map(this.drawables,function(e){return e.config.get_value("min_value")})),t=l.max(l.map(this.drawables,function(e){return e.config.get_value("max_value")}));this.config.set_value("min_value",e),this.config.set_value("max_value",t),l.each(this.drawables,function(i){i.config.set_value("min_value",e),i.config.set_value("max_value",t)})},update_all_min_max:function(){var e=this.config.get_value("min_value"),t=this.config.get_value("max_value");l.each(this.drawables,function(i){i.config.set_value("min_value",e),i.config.set_value("max_value",t)}),this.request_draw({clear_tile_cache:!0})},postdraw_actions:function(e,t,i,n){var a,s=-1;for(a=0;a<e.length;a++){var o=e[a].html_elt.find("canvas").height();o>s&&(s=o)}for(a=0;a<e.length;a++){var r=e[a];r.html_elt.find("canvas").height()!==s&&(this.draw_helper(r.region,i,{force:!0,height:s}),r.html_elt.remove())}var l=this,d=function(){l.update_all_min_max()};this._add_yaxis_label("min",d),this._add_yaxis_label("max",d)}});var X=function(e){Y.call(this,e,{content_div:e.top_labeltrack},{resize:!1,header:!1}),this.left_offset=e.canvas_manager.char_width_px,this.container_div.addClass("reference-track"),this.data_url=Galaxy.root+"api/genomes/"+this.view.dbkey,this.data_url_extra_params={reference:!0},this.data_manager=new c.default.GenomeReferenceDataManager({data_url:this.data_url,can_subset:this.can_subset}),this.hide_contents()};E(X.prototype,z.prototype,Y.prototype,{build_config_params:function(){return l.union(z.prototype.config_params,[{key:"height",type:"int",default_value:13,hidden:!0}])},init:function(){this.data_manager.clear(),this.enabled=!0},predraw_init:function(){},can_draw:z.prototype.can_draw,draw_helper:function(e,t,i){var n,a=this.tiles_div.is(":visible"),s=null;return t>this.view.canvas_manager.char_width_px?(this.tiles_div.show(),n=!0,s=Y.prototype.draw_helper.call(this,e,t,i)):(n=!1,this.tiles_div.hide()),a!==n&&this.view.resize_viewport(),s},can_subset:function(e){return!0},draw_tile:function(e,t,i,n,a){var s=this.data_manager.subset_entry(e,n),o=s.data,r=t.canvas;t.font=t.canvas.manager.default_font,t.textAlign="center";for(var l=0,d=o.length;l<d;l++)t.fillStyle=this.view.get_base_color(o[l]),t.fillText(o[l],Math.floor(l*a),10);return new H(this,n,a,r,s)}});var K=function(t,i,n){this.mode="Histogram",Y.call(this,t,i,n),this.left_offset=30;var a=this;e.when(o(Galaxy.root+"datasets/"+this.dataset.id+"/display")).then(function(e){e&&(a.data_manager=new M.default.BBIDataManager({dataset:a.dataset}))})};E(K.prototype,z.prototype,Y.prototype,{display_modes:I,build_config_params:function(){return l.union(z.prototype.config_params,[{key:"color",label:"Color",type:"color"},{key:"min_value",label:"Min Value",type:"float",default_value:void 0},{key:"max_value",label:"Max Value",type:"float",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:30,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},before_draw:function(){},draw_tile:function(e,t,i,n,a){return this._draw_line_track_tile(e,t,i,n,a)},can_subset:function(e){return e.data[1][0]-e.data[0][0]==1},postdraw_actions:function(e,t,i,n){this._add_yaxis_label("max"),this._add_yaxis_label("min")}});var Q=function(e,t,i){this.mode="Heatmap",Y.call(this,e,t,i)};E(Q.prototype,z.prototype,Y.prototype,{display_modes:["Heatmap"],build_config_params:function(){return l.union(z.prototype.config_params,[{key:"pos_color",label:"Positive Color",type:"color",default_value:"#FF8C00"},{key:"neg_color",label:"Negative Color",type:"color",default_value:"#4169E1"},{key:"min_value",label:"Min Value",type:"int",default_value:void 0},{key:"max_value",label:"Max Value",type:"int",default_value:void 0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:500,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},predraw_init:function(){var t=this;return e.getJSON(t.dataset.url(),{data_type:"data",stats:!0,chrom:t.view.chrom,low:0,high:t.view.max_high,hda_ldda:t.dataset.get("hda_ldda")},function(e){e.data})},draw_tile:function(e,t,i,n,a){var s=t.canvas;return new v.default.DiagonalHeatmapPainter(e.data,n.get("start"),n.get("end"),this.config.to_key_value_dict(),i).draw(t,s.width,s.height,a),new H(this,n,a,s,e.data)}});var Z=function(e,t,i){Y.call(this,e,t,i),this.container_div.addClass("feature-track"),this.summary_draw_height=30,this.slotters={},this.start_end_dct={},this.left_offset=200,this.set_painter_from_config()};E(Z.prototype,z.prototype,Y.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return l.union(z.prototype.config_params,[{key:"block_color",label:"Block color",type:"color"},{key:"reverse_strand_color",label:"Antisense strand color",type:"color"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0,help:"Show the number of items in each bin when drawing summary histogram"},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"connector_style",label:"Connector style",type:"select",default_value:"fishbones",options:[{label:"Line with arrows",value:"fishbone"},{label:"Arcs",value:"arcs"}]},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.set_painter_from_config(),this.request_draw({clear_tile_cache:!0})},set_painter_from_config:function(){"arcs"===this.config.get_value("connector_style")?this.painter=v.default.ArcLinkedFeaturePainter:this.painter=v.default.LinkedFeaturePainter},postdraw_actions:function(t,i,n,a){Y.prototype.postdraw_actions.call(this,t,i,n,a);var s,o=this;if(0===l.filter(t,function(e){return e instanceof F}).length){var r={};l.each(l.pluck(t,"incomplete_features"),function(e){l.each(e,function(e){r[e[0]]=e})});var d=this;l.each(t,function(t){var i=l.omit(r,l.map(t.incomplete_features,function(e){return e[0]}));if(i=l.omit(i,l.keys(t.other_tiles_features_drawn)),0!==l.size(i)){var n={data:l.values(i)},a=d.view.canvas_manager.new_canvas(),s=a.getContext("2d");a.height=Math.max(t.canvas.height,d.get_canvas_height(n,t.mode,t.w_scale,100)),a.width=t.canvas.width,s.drawImage(t.canvas,0,0),s.translate(o.left_offset,0);var c=d.draw_tile(n,s,t.mode,t.region,t.w_scale,t.seq_data);e(t.canvas).replaceWith(e(c.canvas)),t.canvas=a,l.extend(t.other_tiles_features_drawn,r)}})}if(o.filters_manager){var c,u=o.filters_manager.filters;for(c=0;c<u.length;c++)u[c].update_ui_elt();var h,f,p=!1;for(s=0;s<t.length;s++)if(t[s].data.length)for(h=t[s].data[0],c=0;c<u.length;c++)if(f=u[c],f.applies_to(h)&&f.min!==f.max){p=!0;break}o.filters_available!==p&&(o.filters_available=p,o.filters_available||o.filters_manager.hide(),o.update_icons())}if(t[0]instanceof B){var m=!0;for(s=0;s<t.length;s++)if(!t[s].all_slotted){m=!1;break}this.action_icons.show_more_rows_icon.toggle(!m)}else this.action_icons.show_more_rows_icon.hide()},update_auto_mode:function(e){"Auto"===this.mode&&("no_detail"===e&&(e="feature spans"),this.action_icons.mode_icon.attr("title","Set display mode (now: Auto/"+e+")"))},incremental_slots:function(e,t,i){var n=this.view.canvas_manager.dummy_context,a=this.slotters[e];return a&&a.mode===i||(a=new _.default.FeatureSlotter(e,i,100,function(e){return n.measureText(e)}),this.slotters[e]=a),a.slot_features(t)},get_mode:function(e){return"no_detail"===e.extra_info||this.is_overview?"no_detail":this.view.high-this.view.low>12e3?"Squish":"Pack"},get_canvas_height:function(e,t,i,n){if("Coverage"===t||"bigwig"===e.dataset_type)return this.summary_draw_height;var a=this.incremental_slots(i,e.data,t),s=new this.painter(null,null,null,this.config.to_key_value_dict(),t);return Math.max(this.min_height_px,s.get_required_height(a,n))},draw_tile:function(e,t,i,n,a,s,o){var r=this,l=t.canvas,d=n.get("start"),c=n.get("end"),u=this.left_offset;if("bigwig"===e.dataset_type)return this._draw_line_track_tile(e,t,i,n,a);var h=[],f=this.slotters[a].slots,p=!0;if(e.data)for(var m=this.filters_manager.filters,_=0,g=e.data.length;_<g;_++){for(var v,w=e.data[_],b=!1,y=0,x=m.length;y<x;y++)if(v=m[y],v.update_attrs(w),!v.keep(w)){b=!0;break}b||(h.push(w),w[0]in f||(p=!1))}var k=this.filters_manager.alpha_filter?new U(this.filters_manager.alpha_filter):null,C=this.filters_manager.height_filter?new U(this.filters_manager.height_filter):null,$=new this.painter(h,d,c,this.config.to_key_value_dict(),i,k,C,s,function(e){return r.view.get_base_color(e)}),S=null;if(t.fillStyle=this.config.get_value("block_color"),t.font=t.canvas.manager.default_font,t.textAlign="right",e.data){var T=$.draw(t,l.width,l.height,a,f);S=T.feature_mapper,incomplete_features=T.incomplete_features,S.translation=-u}return o?void 0:new B(r,n,a,l,e.data,i,e.message,p,S,incomplete_features,s)}});var ee=function(e,t,i){Y.call(this,e,t,i),this.painter=v.default.VariantPainter,this.summary_draw_height=30,this.left_offset=30};E(ee.prototype,z.prototype,Y.prototype,{display_modes:["Auto","Coverage","Dense","Squish","Pack"],build_config_params:function(){return l.union(z.prototype.config_params,[{key:"color",label:"Histogram color",type:"color"},{key:"show_sample_data",label:"Show sample data",type:"bool",default_value:!0},{key:"show_labels",label:"Show summary and sample labels",type:"bool",default_value:!0},{key:"summary_height",label:"Locus summary height",type:"float",default_value:20},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})},draw_tile:function(e,t,i,n,a){if("bigwig"===e.dataset_type)return this._draw_line_track_tile(e,t,"Histogram",n,a);var s=this.view;return new this.painter(e.data,n.get("start"),n.get("end"),this.config.to_key_value_dict(),i,function(e){return s.get_base_color(e)}).draw(t,t.canvas.width,t.canvas.height,a),new H(this,n,a,t.canvas,e.data)},get_canvas_height:function(e,t,i,n){if("bigwig"===e.dataset_type)return this.summary_draw_height;var a=this.dataset.get_metadata("sample_names")?this.dataset.get_metadata("sample_names").length:0;return 0===a&&0!==e.data.length&&(a=e.data[0][7].match(/,/g),a=null===a?1:a.length+1),new this.painter(null,null,null,this.config.to_key_value_dict(),t).get_required_height(a)},predraw_init:function(){var e=[q.prototype.predraw_init.call(this)];return this.dataset.get_metadata("sample_names")||e.push(this.dataset.fetch()),e},postdraw_actions:function(t,i,n,a){Y.prototype.postdraw_actions.call(this,t,i,n,a);var s=l.filter(t,function(e){return e instanceof F}),o=this.dataset.get_metadata("sample_names");if(0===s.length&&this.config.get_value("show_labels")&&o&&o.length>1){var r;if(0===this.container_div.find(".yaxislabel.variant").length&&(r=this.config.get_value("summary_height")/2,this.tiles_div.prepend(e("<div/>").text("Summary").addClass("yaxislabel variant top").css({"font-size":r+"px",top:(this.config.get_value("summary_height")-r)/2+"px"})),this.config.get_value("show_sample_data"))){var d=o.join("<br/>");this.tiles_div.prepend(e("<div/>").html(d).addClass("yaxislabel variant top sample").css({top:this.config.get_value("summary_height")}))}r=("Squish"===this.mode?5:10)+"px",e(this.tiles_div).find(".sample").css({"font-size":r,"line-height":r}),e(this.tiles_div).find(".yaxislabel").css("color",this.config.get_value("label_color"))}else this.container_div.find(".yaxislabel.variant").remove()}});var te=function(e,t,i){Z.call(this,e,t,i),this.painter=v.default.ReadPainter,this.update_icons()};E(te.prototype,z.prototype,Y.prototype,Z.prototype,{build_config_params:function(){return l.union(z.prototype.config_params,[{key:"block_color",label:"Histogram color",type:"color"},{key:"detail_block_color",label:"Sense strand block color",type:"color",default_value:"#AAAAAA"},{key:"reverse_strand_color",label:"Antisense strand block color",type:"color",default_value:"#DDDDDD"},{key:"label_color",label:"Label color",type:"color",default_value:"black"},{key:"show_insertions",label:"Show insertions",type:"bool",default_value:!1},{key:"show_differences",label:"Show differences only",type:"bool",default_value:!0},{key:"show_counts",label:"Show summary counts",type:"bool",default_value:!0},{key:"mode",type:"string",default_value:this.mode,hidden:!0},{key:"min_value",label:"Histogram minimum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"max_value",label:"Histogram maximum",type:"float",default_value:void 0,help:"clear value to set automatically"},{key:"height",type:"int",default_value:0,hidden:!0}])},config_onchange:function(){this.set_name(this.config.get_value("name")),this.request_draw({clear_tile_cache:!0})}});var ie={CompositeTrack:J,DrawableGroup:L,DiagonalHeatmapTrack:Q,FeatureTrack:Z,LineTrack:K,ReadTrack:te,VariantTrack:ee,VcfTrack:ee},ne=function(e,t,i){if("copy"in e)return e.copy(i);var n=e.obj_type;return n||(n=e.track_type),new ie[n](t,i,e)};t.default={TracksterView:R,DrawableGroup:L,LineTrack:K,FeatureTrack:Z,DiagonalHeatmapTrack:Q,ReadTrack:te,VariantTrack:ee,CompositeTrack:J,object_from_template:ne}}).call(t,i(0),i(1))},function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(2),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(a),o=e.View.extend({className:"track-header",initialize:function(){this.model.config.get("name").on("change:value",this.update_name,this),this.render()},render:function(){this.$el.append(n("<div/>").addClass(this.model.drag_handle_class)),this.$el.append(n("<div/>").addClass("track-name").text(this.model.config.get_value("name"))),this.action_icons={},this.render_action_icons(),this.$el.dblclick(function(e){e.stopPropagation()}),this.$el.append(n("<div style='clear: both'/>"))},update_name:function(){this.$el.find(".track-name").text(this.model.config.get_value("name"))},render_action_icons:function(){var e=this;this.icons_div=n("<div/>").addClass("track-icons").hide().appendTo(this.$el),s.each(this.model.action_icons_def,function(t){e.add_action_icon(t.name,t.title,t.css_class,t.on_click_fn,t.prepend,t.hide)}),this.set_display_modes(this.model.display_modes)},add_action_icon:function(e,t,i,a,s,o){var r=this;this.action_icons[e]=n("<a/>").attr("title",t).addClass("icon-button").addClass(i).tooltip().click(function(){a(r.model)}).appendTo(this.icons_div),o&&this.action_icons[e].hide()},set_display_modes:function(e,t){if(e){this.model.display_modes=e,this.model.mode=t||this.model.config.get_value("mode")||this.model.display_modes[0],this.action_icons.mode_icon.attr("title","Set display mode (now: "+this.mode+")");for(var i=this.model,n={},a=0,s=i.display_modes.length;a<s;a++){var o=i.display_modes[a];n[o]=function(e){return function(){i.change_mode(e)}}(o)}make_popupmenu(this.action_icons.mode_icon,n)}}});t.default={TrackHeaderView:o}}).call(t,i(1),i(0))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(n),s=a.extend,o=function(e,t){this.slot=e,this.feature=t},r=function(e,t,i,n){this.slots={},this.start_end_dct={},this.w_scale=e,this.mode=t,this.include_label="Pack"===t,this.max_rows=i,this.measureText=n};s(r.prototype,{_get_draw_coords:function(e){var t=Math.floor(e[1]*this.w_scale),i=Math.ceil(e[2]*this.w_scale),n=e[3];if(void 0!==n&&this.include_label){var a=this.measureText(n).width+7;t-a>=0?(t-=a,"left"):(i+=a,"right")}return[t,i]},_find_slot:function(e){for(var t=e[0],i=e[1],n=0;n<=this.max_rows;n++){var a=!1,s=this.start_end_dct[n];if(void 0!==s)for(var o=0,r=s.length;o<r;o++){var l=s[o];if(i>l[0]&&t<l[1]){a=!0;break}}if(!a)return n}return-1},slot_features:function(e){for(var t,i,n=this.start_end_dct,a=[],s=0,r=0,l=e.length;r<l;r++){t=e[r],i=t[0];var d=this.slots[i];if(d){if(t[1]<d.feature[1]||d.feature[2]<t[2])for(var c=this._get_draw_coords(d.feature),u=this._get_draw_coords(t),h=this.start_end_dct[d.slot],f=0;f<h.length;f++){var p=h[f];p[0]===c[0]&&p[1]===c[1]&&(h[f]=u)}s=Math.max(s,this.slots[i].slot)}else a.push(r)}for(var r=0,l=a.length;r<l;r++){t=e[a[r]],i=t[0];var m=this._get_draw_coords(t),_=this._find_slot(m);_>=0&&(void 0===n[_]&&(n[_]=[]),n[_].push(m),this.slots[i]=new o(_,t),s=Math.max(s,_))}return s+1}}),t.default={FeatureSlotter:r}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(n),s=function(e,t){var i=e[0],n=e[1],a=t[0],s=t[1];return i<a?n<=a?1001:n<=s?1003:1002:i>s?1006:n<=s?1005:1004},o=function(e,t){var i=s(e,t);return 1001!==i&&1006!==i},r=function(e,t,i,n,a,s){void 0===s&&(s=4);var o,r=n-t,l=a-i,d=Math.floor(Math.sqrt(r*r+l*l)/s),c=r/d,u=l/d;for(o=0;o<d;o++,t+=c,i+=u)o%2==0&&e.fillRect(t,i,s,1)},l=function(e,t,i,n){var a=t-n/2,s=t+n/2,o=i-Math.sqrt(3*n/2);e.beginPath(),e.moveTo(a,o),e.lineTo(s,o),e.lineTo(t,i),e.lineTo(a,o),e.strokeStyle=this.fillStyle,e.fill(),e.stroke(),e.closePath()},d=function(e){this.default_val=e||1};d.prototype.gen_val=function(e){return this.default_val};var c=function(e){this.incomplete_features=e.incomplete_features,this.feature_mapper=e.feature_mapper},u=function(e,t,i,n,s){this.data=e,this.view_start=t,this.view_end=i,this.prefs=a.extend({},this.default_prefs,n),this.mode=s};u.prototype.default_prefs={},u.prototype.draw=function(e,t,i,n){},u.prototype.get_start_draw_pos=function(e,t){return this._chrom_pos_to_draw_pos(e,t,-.5)},u.prototype.get_end_draw_pos=function(e,t){return this._chrom_pos_to_draw_pos(e,t,.5)},u.prototype.get_draw_pos=function(e,t){return this._chrom_pos_to_draw_pos(e,t,0)},u.prototype._chrom_pos_to_draw_pos=function(e,t,i){return Math.floor(t*(Math.max(0,e-this.view_start)+i))};var h=function(e,t,i,n,a){u.call(this,e,t,i,n,a)};h.prototype.default_prefs={min_value:void 0,max_value:void 0,mode:"Histogram",color:"#000",overflow_color:"#F66"},h.prototype.draw=function(e,t,i,n){var s=!1,o=this.prefs.min_value,r=this.prefs.max_value,l=r-o,d=i,c=this.view_start,u=this.mode,h=this.data;e.save();var f=Math.round(i+o/l*i);"Intensity"!==u&&(e.fillStyle="#aaa",e.fillRect(0,f,t,1)),e.beginPath();var p,m,_;_=h.length>1?a.map(h.slice(0,-1),function(e,t){return Math.ceil((h[t+1][0]-h[t][0])*n)}):[10];for(var g,v=this.prefs.block_color||this.prefs.color,w=parseInt(v.slice(1),16),b=(16711680&w)>>16,y=(65280&w)>>8,x=255&w,k=!1,C=!1,$=0,S=h.length;$<S;$++)if(e.fillStyle=e.strokeStyle=v,k=C=!1,g=_[$],p=Math.floor((h[$][0]-c-.5)*n),null!==(m=h[$][1])){if(m<o?(C=!0,m=o):m>r&&(k=!0,m=r),"Histogram"===u)m=Math.round(m/l*d),e.fillRect(p,f,g,-m);else if("Intensity"===u){var T=(m-o)/l,M=Math.round(b+(255-b)*(1-T)),E=Math.round(y+(255-y)*(1-T)),P=Math.round(x+(255-x)*(1-T));e.fillStyle="rgb("+M+","+E+","+P+")",e.fillRect(p,0,g,d)}else m=Math.round(d-(m-o)/l*d),s?e.lineTo(p,m):(s=!0,"Filled"===u?(e.moveTo(p,d),e.lineTo(p,m)):e.moveTo(p,m));if(e.fillStyle=this.prefs.overflow_color,k||C){var O;"Histogram"===u||"Intensity"===u?O=g:(p-=2,O=4),k&&e.fillRect(p,0,O,3),C&&e.fillRect(p,d-3,O,3)}e.fillStyle=v}else s&&"Filled"===u&&e.lineTo(p,d),s=!1;"Filled"===u?(s&&(e.lineTo(p,f),e.lineTo(0,f)),e.fill()):e.stroke(),e.restore()};var f=function(e){this.feature_positions={},this.slot_height=e,this.translation=0,this.y_translation=0};f.prototype.map_feature_data=function(e,t,i,n){this.feature_positions[t]||(this.feature_positions[t]=[]),this.feature_positions[t].push({data:e,x_start:i,x_end:n})},f.prototype.get_feature_data=function(e,t){var i,n=Math.floor((t-this.y_translation)/this.slot_height);if(!this.feature_positions[n])return null;e+=this.translation;for(var a=0;a<this.feature_positions[n].length;a++)if(i=this.feature_positions[n][a],e>=i.x_start&&e<=i.x_end)return i.data};var p=function(e,t,i,n,a,s,o){u.call(this,e,t,i,n,a),this.alpha_scaler=s||new d,this.height_scaler=o||new d,this.max_label_length=200};p.prototype.default_prefs={block_color:"#FFF",connector_color:"#FFF"},a.extend(p.prototype,{get_required_height:function(e,t){var i=this.get_row_height(),n=i,a=this.mode;return"no_detail"!==a&&"Squish"!==a&&"Pack"!==a||(i=e*n),i+this.get_top_padding(t)},get_top_padding:function(e){return 0},draw:function(e,t,i,n,a){var s=this.data,o=this.view_start,r=this.view_end;e.save(),e.fillStyle=this.prefs.block_color,e.textAlign="right";for(var l,d=this.get_row_height(),u=new f(d),h=[],p=0,m=s.length;p<m;p++){var _=s[p],g=_[0],v=_[1],w=_[2],b=a&&void 0!==a[g]?a[g].slot:null;("Dense"===this.mode||null!==b)&&v<r&&w>o&&(l=this.draw_element(e,this.mode,_,b,o,r,n,d,t),u.map_feature_data(_,b,l[0],l[1]),(v<o||w>r)&&h.push(_))}return e.restore(),u.y_translation=this.get_top_padding(t),new c({incomplete_features:h,feature_mapper:u})},draw_element:function(e,t,i,n,a,s,o,r,l){return[0,0]}});var m=function(e,t,i,n,a,s,o){p.call(this,e,t,i,n,a,s,o),this.draw_background_connector=!0,this.draw_individual_connectors=!1};a.extend(m.prototype,p.prototype,{get_row_height:function(){var e=this.mode;return"Dense"===e?10:"no_detail"===e?3:"Squish"===e?5:10},draw_element:function(e,t,i,n,a,s,o,r,l){var d,c=(i[0],i[1]),u=i[2],h=i[3],f=i[4],p=Math.floor(Math.max(0,(c-a-.5)*o)),m=Math.ceil(Math.min(l,Math.max(0,(u-a-.5)*o))),_=p,g=m,d=("Dense"===t?0:0+n)*r+this.get_top_padding(l),v=null,w=null,b=f&&"+"!==f&&"."!==f?this.prefs.reverse_strand_color:this.prefs.block_color,y=this.prefs.label_color;if(e.globalAlpha=this.alpha_scaler.gen_val(i),"Dense"===t&&(n=1),"no_detail"===t)e.fillStyle=b,e.fillRect(p,d+5,m-p,1);else{var x=i[5],k=i[6],C=i[7],$=!0;x&&k&&(v=Math.floor(Math.max(0,(x-a)*o)),w=Math.ceil(Math.min(l,Math.max(0,(k-a)*o))));var S,T;if("Squish"===t?(S=1,T=3,$=!1):(S=5,T=9),C){var M,E;"Squish"===t||"Dense"===t?(M=d+Math.floor(1.5)+1,E=1):f?(M=d,E=T):(M+=2.5,E=1),this.draw_background_connector&&("Squish"===t||"Dense"===t?e.fillStyle="#ccc":f?"+"===f?e.fillStyle=e.canvas.manager.get_pattern("right_strand"):"-"===f&&(e.fillStyle=e.canvas.manager.get_pattern("left_strand")):e.fillStyle="#ccc",e.fillRect(p,M,m-p,E));for(var P=0,O=C.length;P<O;P++){var A,D,I=C[P],z=Math.floor(Math.max(0,(I[0]-a-.5)*o)),j=Math.ceil(Math.min(l,Math.max((I[1]-a-.5)*o)));if(!(z>j)){if(e.fillStyle=b,e.fillRect(z,d+(T-S)/2+1,j-z,S),void 0!==v&&k>x&&!(z>w||j<v)){var L=Math.max(z,v),R=Math.min(j,w);e.fillRect(L,d+1,R-L,T),1===C.length&&"Pack"===t&&("+"===f?e.fillStyle=e.canvas.manager.get_pattern("right_strand_inv"):"-"===f&&(e.fillStyle=e.canvas.manager.get_pattern("left_strand_inv")),L+14<R&&(L+=2,R-=2),e.fillRect(L,d+1,R-L,T))}this.draw_individual_connectors&&A&&this.draw_connector(e,A,D,z,j,d),A=z,D=j}}if("Pack"===t){e.globalAlpha=1,e.fillStyle="white";var V=this.height_scaler.gen_val(i),N=Math.ceil(T*V),G=Math.round((T-N)/2);1!==V&&(e.fillRect(p,M+1,m-p,G),e.fillRect(p,M+T-G+1,m-p,G))}}else e.fillStyle=b,e.fillRect(p,d+1,m-p,T),f&&$&&("+"===f?e.fillStyle=e.canvas.manager.get_pattern("right_strand_inv"):"-"===f&&(e.fillStyle=e.canvas.manager.get_pattern("left_strand_inv")),e.fillRect(p,d+1,m-p,T));e.globalAlpha=1,h&&"Pack"===t&&c>a&&(e.fillStyle=y,0===a&&p-e.measureText(h).width<0?(e.textAlign="left",e.fillText(h,m+2,d+8,this.max_label_length),g+=e.measureText(h).width+2):(e.textAlign="right",e.fillText(h,p-2,d+8,this.max_label_length),_-=e.measureText(h).width+2))}return e.globalAlpha=1,[_,g]}});var _=function(e,t,i,n,a,s,o,r,l){p.call(this,e,t,i,n,a,s,o),this.ref_seq=r?r.data:null,this.base_color_fn=l};a.extend(_.prototype,p.prototype,{get_row_height:function(){var e,t=this.mode;return"Dense"===t?e=10:"Squish"===t?e=5:(e=10,this.prefs.show_insertions&&(e*=2)),e},_parse_cigar:function(e){var t="MIDNSHP=X",i=[[0,0]],n=i[0],s=0,o=a.map(e.match(/[0-9]+[MIDNSHP=X]/g),function(e){var a=parseInt(e.slice(0,-1),10),o=e.slice(-1);return"N"===o?0!==n[1]&&(n=[s+a,s+a],i.push(n)):-1==="ISHP".indexOf(o)&&(n[1]+=a,s+=a),[t.indexOf(o),a]});return{blocks:i,cigar:o}},draw_read:function(e,t,i,n,a,r,d,c,u,h){var f=function(e){return Math.floor(Math.max(0,(e-a-.5)*i))};e.textAlign="center";var p,m,_=[a,r],g=0,v=0,w=Math.round(i/2),b=e.canvas.manager.char_width_px,y="+"===u?this.prefs.detail_block_color:this.prefs.reverse_strand_color,k="Pack"===t,C=k?9:3,$=n+1,S=new x(e,C,i,t),T=[],M=[],E=this._parse_cigar(c);c=E.cigar,T=E.blocks;for(var P=0;P<T.length;P++){var O=T[P];o([d+O[0],d+O[1]],_)&&(p=f(d+O[0]),m=f(d+O[1]),p===m&&(m+=1),e.fillStyle=y,e.fillRect(p,$,m-p,C))}for(var A=0,D=c.length;A<D;A++){var I=c[A],z="MIDNSHP=X"[I[0]],j=I[1],L=d+g;if(p=f(L),m=f(L+j),o([L,L+j],_))switch(p===m&&(m+=1),z){case"H":case"S":case"P":break;case"M":g+=j;break;case"=":case"X":var R="";"X"===z?R=h.slice(v,v+j):this.ref_seq&&(R=this.ref_seq.slice(Math.max(0,L-a),Math.min(L-a+j,r-a)));for(var V=Math.max(L,a),N=0;N<R.length;N++)if(R&&!this.prefs.show_differences||"X"===z){var G=Math.floor(Math.max(0,(V+N-a)*i));e.fillStyle=this.base_color_fn(R[N]),k&&i>b?e.fillText(R[N],G,n+9):i>.05&&e.fillRect(G-w,$,Math.max(1,Math.round(i)),C)}"X"===z&&(v+=j),g+=j;break;case"N":e.fillStyle="#ccc",e.fillRect(p,$+(C-1)/2,m-p,1),g+=j;break;case"D":S.draw_deletion(p,$,j),g+=j;break;case"I":var U=p-w;if(o([L,L+j],_)){var H=h.slice(v,v+j);if(this.prefs.show_insertions){var F=p-(m-p)/2;if(("Pack"===t||"Auto"===this.mode)&&void 0!==h&&i>b){switch(e.fillStyle="yellow",e.fillRect(F-w,n-9,m-p,9),M[M.length]={type:"triangle",data:[U,n+4,5]},e.fillStyle="#ccc",s([L,L+j],_)){case 1003:H=H.slice(a-L);break;case 1004:H=H.slice(0,L-r);break;case 1005:break;case 1002:H=H.slice(a-L,L-r)}for(var N=0,B=H.length;N<B;N++){var G=Math.floor(Math.max(0,(L+N-a)*i));e.fillText(H[N],G-(m-p)/2,n)}}else e.fillStyle="yellow",e.fillRect(F,n+("Dense"!==this.mode?2:5),m-p,"Dense"!==t?3:9)}else("Pack"===t||"Auto"===this.mode)&&void 0!==h&&i>b&&M.push({type:"text",data:[H.length,U,n+9]})}v+=j}else g=function(e,t,i){return-1!=="M=NXD".indexOf(t)&&(e+=i),e}(g,z,j),v=function(e,t,i){return-1!=="IX".indexOf(t)&&(e+=i),e}(v,z,j)}e.fillStyle="yellow";for(var q,Y,W,P=0;P<M.length;P++)q=M[P],Y=q.type,W=q.data,"text"===Y?(e.save(),e.font="bold "+e.font,e.fillText(W[0],W[1],W[2]),e.restore()):"triangle"===Y&&l(e,W[0],W[1],W[2])},draw_element:function(e,t,i,n,a,s,o,l,d){var c=(i[0],i[1]),u=i[2],h=i[3],f=Math.floor(Math.max(-.5*o,(c-a-.5)*o)),p=Math.ceil(Math.min(d,Math.max(0,(u-a-.5)*o))),m=("Dense"===t?0:0+n)*l,_="Pack"===t?9:3;this.prefs.label_color;if(i[5]instanceof Array){var g=!0;i[4][1]>=a&&i[4][0]<=s&&i[4][2]?this.draw_read(e,t,o,m,a,s,i[4][0],i[4][2],i[4][3],i[4][4]):g=!1,i[5][1]>=a&&i[5][0]<=s&&i[5][2]?this.draw_read(e,t,o,m,a,s,i[5][0],i[5][2],i[5][3],i[5][4]):g=!1;var v=Math.ceil(Math.min(d,Math.max(-.5*o,(i[4][1]-a-.5)*o))),w=Math.floor(Math.max(-.5*o,(i[5][0]-a-.5)*o));if(g&&w>v){e.fillStyle="#ccc";var b=m+1+(_-1)/2;r(e,v,b,w,b)}}else this.draw_read(e,t,o,m,a,s,c,i[4],i[5],i[6]);return"Pack"===t&&c>=a&&"."!==h&&(e.fillStyle=this.prefs.label_color,0===a&&f-e.measureText(h).width<0?(e.textAlign="left",e.fillText(h,p+2,m+9,this.max_label_length)):(e.textAlign="right",e.fillText(h,f-2,m+9,this.max_label_length))),[0,0]}});var g=function(e,t,i,n,a,s,o){m.call(this,e,t,i,n,a,s,o),this.longest_feature_length=this.calculate_longest_feature_length(),this.draw_background_connector=!1,this.draw_individual_connectors=!0};a.extend(g.prototype,p.prototype,m.prototype,{calculate_longest_feature_length:function(){for(var e=0,t=0,i=this.data.length;t<i;t++){var n=this.data[t],a=n[1],s=n[2];e=Math.max(e,s-a)}return e},get_top_padding:function(e){var t=this.view_end-this.view_start,i=e/t;return Math.min(128,Math.ceil(this.longest_feature_length/2*i))},draw_connector:function(e,t,i,n,a,s){var o=(i+n)/2,r=n-o;Math.PI;r>0&&(e.beginPath(),e.arc(o,s,n-o,Math.PI,0),e.stroke())}});var v=function(e,t){Array.isArray(e)?this.rgb=e:6==e.length?this.rgb=e.match(/.{2}/g).map(function(e){return parseInt(e,16)}):7==e.length?this.rgb=e.substring(1,7).match(/.{2}/g).map(function(e){return parseInt(e,16)}):this.rgb=e.split("").map(function(e){return parseInt(e+e,16)}),this.alpha="number"==typeof t?t:1};v.prototype={eval:function(){return this},toCSS:function(){return this.alpha<1?"rgba("+this.rgb.map(function(e){return Math.round(e)}).concat(this.alpha).join(", ")+")":"#"+this.rgb.map(function(e){return e=Math.round(e),e=(e>255?255:e<0?0:e).toString(16),1===e.length?"0"+e:e}).join("")},toHSL:function(){var e,t,i=this.rgb[0]/255,n=this.rgb[1]/255,a=this.rgb[2]/255,s=this.alpha,o=Math.max(i,n,a),r=Math.min(i,n,a),l=(o+r)/2,d=o-r;if(o===r)e=t=0;else{switch(t=l>.5?d/(2-o-r):d/(o+r),o){case i:e=(n-a)/d+(n<a?6:0);break;case n:e=(a-i)/d+2;break;case a:e=(i-n)/d+4}e/=6}return{h:360*e,s:t,l:l,a:s}},toARGB:function(){return"#"+[Math.round(255*this.alpha)].concat(this.rgb).map(function(e){return e=Math.round(e),e=(e>255?255:e<0?0:e).toString(16),1===e.length?"0"+e:e}).join("")},mix:function(e,t){var i=this,n=t,a=2*n-1,s=i.toHSL().a-e.toHSL().a,o=((a*s==-1?a:(a+s)/(1+a*s))+1)/2,r=1-o,l=[i.rgb[0]*o+e.rgb[0]*r,i.rgb[1]*o+e.rgb[1]*r,i.rgb[2]*o+e.rgb[2]*r],d=i.alpha*n+e.alpha*(1-n);return new v(l,d)}};var w=function(e,t,i,n){this.start_color=new v(e),this.end_color=new v(t),this.start_value=i,this.end_value=n,this.value_range=n-i};w.prototype.map_value=function(e){return e=Math.max(e,this.start_value),e=Math.min(e,this.end_value),e=(e-this.start_value)/this.value_range,this.start_color.mix(this.end_color,1-e).toCSS()};var b=function(e,t,i,n,a){this.positive_ramp=new w(t,i,0,a),this.negative_ramp=new w(t,e,0,-n),this.start_value=n,this.end_value=a};b.prototype.map_value=function(e){return e=Math.max(e,this.start_value),e=Math.min(e,this.end_value),e>=0?this.positive_ramp.map_value(e):this.negative_ramp.map_value(-e)};var y=function(e,t,i,n,a){u.call(this,e,t,i,n,a);var s,o;if(void 0===this.prefs.min_value){var r=1/0;for(s=0,o=this.data.length;s<o;s++)r=Math.min(r,this.data[s][6]);this.prefs.min_value=r}if(void 0===this.prefs.max_value){var l=-1/0;for(s=0,o=this.data.length;s<o;s++)l=Math.max(l,this.data[s][6]);this.prefs.max_value=l}};y.prototype.default_prefs={min_value:void 0,max_value:void 0,mode:"Heatmap",pos_color:"#FF8C00",neg_color:"#4169E1"},y.prototype.draw=function(e,t,i,n){var a,s,o,r,l,d,c=this.prefs.min_value,u=this.prefs.max_value,h=this.view_start,f=(this.mode,this.data),p=1/Math.sqrt(2),m=new b(this.prefs.neg_color,"#FFFFFF",this.prefs.pos_color,c,u),_=function(e){return(e-h)*n};e.save(),e.rotate(-45*Math.PI/180),e.scale(p,p);for(var g=0,v=f.length;g<v;g++)a=f[g],s=_(a[1]),o=_(a[2]),r=_(a[4]),l=_(a[5]),d=a[6],e.fillStyle=m.map_value(d),e.fillRect(s,r,o-s,l-r);e.restore()};var x=function(e,t,i,n){this.ctx=e,this.row_height=t,this.px_per_base=i,this.draw_details=("Pack"===n||"Auto"===n)&&i>=e.canvas.manager.char_width_px,this.delete_details_thickness=.2};a.extend(x.prototype,{draw_deletion:function(e,t,i){this.ctx.fillStyle="black";var n=(this.draw_details?this.delete_details_thickness:1)*this.row_height;t+=.5*(this.row_height-n),this.ctx.fillRect(e,t,i*this.px_per_base,n)}});var k=function(e,t,i,n,a,s){u.call(this,e,t,i,n,a),this.base_color_fn=s,this.divider_height=1};a.extend(k.prototype,u.prototype,{get_row_height:function(){var e=this.mode;return"Dense"===e?10:"Squish"===e?5:10},get_required_height:function(e){var t=this.prefs.summary_height;return e>1&&this.prefs.show_sample_data&&(t+=this.divider_height+e*this.get_row_height()),t},draw:function(e,t,i,n){e.save();var s,o,r,l,d,c,u,h,f,p,m,_=function(e,t){var i=e.length,n=t.length,a=0,s=1,o=null;return"-"===t?(o="deletion",s=e.length):0===e.indexOf(t)&&i>n?(o="deletion",s=i-n,a=n):0===t.indexOf(e)&&i<n&&(o="insertion",s=n-i,a=n),null!==o?{type:o,start:a,len:s}:{}},g=Math.max(1,Math.floor(n)),v=this.data.length?this.data[0][7].split(",").length:0,w="Squish"===this.mode?5:10,b=n<.1?w:"Squish"===this.mode?3:9,y=!0,k=new x(e,w,n,this.mode);1===v&&(w=b=n<e.canvas.manager.char_width_px?this.prefs.summary_height:w,k.row_height=w,y=!1),this.prefs.show_sample_data&&y&&(e.fillStyle="#F3F3F3",e.globalAlpha=1,e.fillRect(0,this.prefs.summary_height-this.divider_height,t,this.divider_height)),e.textAlign="center";for(var C=0;C<this.data.length;C++)if(s=this.data[C],o=s[1],r=s[3],l=[s[4].split(",")],d=s[7].split(","),c=s.slice(8),l=a.map(a.flatten(l),function(e){var t={type:"snp",value:e,start:0},i=_(r,e);return a.extend(t,i)}),!(o<this.view_start||o>this.view_end)){if(y)for(e.fillStyle="#999999",e.globalAlpha=1,m=0;m<l.length;m++)for(h=this.get_start_draw_pos(o+l[m].start,n),e.fillRect(h,0,g,this.prefs.summary_height),f=this.prefs.summary_height,m=0;m<l.length;m++){e.fillStyle="deletion"===l[m].type?"black":this.base_color_fn(l[m].value);var $=c/d.length,S=Math.ceil(this.prefs.summary_height*$);e.fillRect(h,f-S,g,S),f-=S}if(this.prefs.show_sample_data)for(f=y?this.prefs.summary_height+this.divider_height:0,m=0;m<d.length;m++,f+=w)if(p=d[m]?d[m].split(/\/|\|/):["0","0"],u=null,p[0]===p[1]?"."===p[0]||"0"!==p[0]&&(u=l[parseInt(p[0],10)-1],e.globalAlpha=1):(u="0"!==p[0]?p[0]:p[1],u=l[parseInt(u,10)-1],e.globalAlpha=.5),u)if(h=this.get_start_draw_pos(o+u.start,n),"snp"===u.type){var T=u.value;e.fillStyle=this.base_color_fn(T),k.draw_details?e.fillText(T,this.get_draw_pos(o,n),f+w):e.fillRect(h,f+1,g,b)}else"deletion"===u.type&&k.draw_deletion(h,f+1,u.len)}e.restore()}}),t.default={Scaler:d,LinePainter:h,LinkedFeaturePainter:m,ReadPainter:_,ArcLinkedFeaturePainter:g,DiagonalHeatmapPainter:y,VariantPainter:k}},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(n),s=a.extend,o=function(e){this.manager=null,this.name=e.name,this.index=e.index,this.tool_id=e.tool_id,this.tool_exp_name=e.tool_exp_name};s(o.prototype,{to_dict:function(){return{name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name}}});var r=function(t,i,n){return e("<a/>").attr("href","javascript:void(0);").attr("title",t).addClass("icon-button").addClass(i).tooltip().click(n)},l=function(t){o.call(this,t),this.low="low"in t?t.low:-Number.MAX_VALUE,this.high="high"in t?t.high:Number.MAX_VALUE,this.min="min"in t?t.min:Number.MAX_VALUE,this.max="max"in t?t.max:-Number.MAX_VALUE,this.container=null,this.slider=null,this.slider_label=null;var i=this;i.parent_div=e("<div/>").addClass("filter-row slider-row");var n=e("<div/>").addClass("elt-label").appendTo(i.parent_div),a=(e("<span/>").addClass("slider-name").text(i.name+"  ").appendTo(n),e("<span/>").text(this.low+"-"+this.high)),s=e("<span/>").addClass("slider-value").appendTo(n).append("[").append(a).append("]");i.values_span=a;var l=e("<div/>").addClass("slider").appendTo(i.parent_div);i.control_element=e("<div/>").attr("id",i.name+"-filter-control").appendTo(l),i.control_element.slider({range:!0,min:this.min,max:this.max,step:this.get_slider_step(this.min,this.max),values:[this.low,this.high],slide:function(e,t){i.slide(e,t)},change:function(e,t){i.control_element.slider("option","slide").call(i.control_element,e,t)}}),i.slider=i.control_element,i.slider_label=a,function(t,i,n){t.click(function(){var t=i.text(),a=parseFloat(n.slider("option","max")),s=a<=1?4:a<=1e6?a.toString().length:6,o=!1,r=e(this).parents(".slider-row");r.addClass("input"),n.slider("option","values")&&(s=2*s+1,o=!0),i.text(""),e("<input type='text'/>").attr("size",s).attr("maxlength",s).attr("value",t).appendTo(i).focus().select().click(function(e){e.stopPropagation()}).blur(function(){e(this).remove(),i.text(t),r.removeClass("input")}).keyup(function(t){if(27===t.keyCode)e(this).trigger("blur");else if(13===t.keyCode){var i=n.slider("option","min"),a=n.slider("option","max"),s=function(e){return isNaN(e)||e>a||e<i},l=e(this).val();if(o){if(l=l.split("-"),l=[parseFloat(l[0]),parseFloat(l[1])],s(l[0])||s(l[1]))return alert("Parameter value must be in the range ["+i+"-"+a+"]"),e(this)}else if(l=parseFloat(l),s(l))return alert("Parameter value must be in the range ["+i+"-"+a+"]"),e(this);n.slider(o?"values":"value",l),r.removeClass("input")}})})}(s,a,i.control_element);var d=e("<div/>").addClass("display-controls").appendTo(i.parent_div);this.transparency_icon=r("Use filter for data transparency","layer-transparent",function(){i.manager.alpha_filter!==i?(i.manager.alpha_filter=i,i.manager.parent_div.find(".layer-transparent").removeClass("active").hide(),i.transparency_icon.addClass("active").show()):(i.manager.alpha_filter=null,i.transparency_icon.removeClass("active")),i.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(d).hide(),this.height_icon=r("Use filter for data height","arrow-resize-090",function(){i.manager.height_filter!==i?(i.manager.height_filter=i,i.manager.parent_div.find(".arrow-resize-090").removeClass("active").hide(),i.height_icon.addClass("active").show()):(i.manager.height_filter=null,i.height_icon.removeClass("active")),i.manager.track.request_draw({force:!0,clear_after:!0})}).appendTo(d).hide(),i.parent_div.hover(function(){i.transparency_icon.show(),i.height_icon.show()},function(){i.manager.alpha_filter!==i&&i.transparency_icon.hide(),i.manager.height_filter!==i&&i.height_icon.hide()}),e("<div style='clear: both;'/>").appendTo(i.parent_div)};s(l.prototype,{to_dict:function(){var e=o.prototype.to_dict.call(this);return s(e,{type:"number",min:this.min,max:this.max,low:this.low,high:this.high})},copy:function(){return new l({name:this.name,index:this.index,tool_id:this.tool_id,tool_exp_name:this.tool_exp_name})},get_slider_step:function(e,t){return t-e<=2?.01:1},slide:function(e,t){var i=t.values;this.values_span.text(i[0]+"-"+i[1]),this.low=i[0],this.high=i[1];var n=this;setTimeout(function(){i[0]===n.low&&i[1]===n.high&&n.manager.track.request_draw({force:!0,clear_after:!0})},25)},applies_to:function(e){return e.length>this.index},_keep_val:function(e){return isNaN(e)||e>=this.low&&e<=this.high},keep:function(e){if(!this.applies_to(e))return!0;var t=e[this.index];if(t instanceof Array){for(var i=!0,n=0;n<t.length;n++)if(!this._keep_val(t[n])){i=!1;break}return i}return this._keep_val(e[this.index])},update_attrs:function(e){var t=!1;if(!this.applies_to(e))return t;var i=e[this.index];i instanceof Array||(i=[i]);for(var n=0;n<i.length;n++){var a=i[n];a<this.min&&(this.min=Math.floor(a),t=!0),a>this.max&&(this.max=Math.ceil(a),t=!0)}return t},update_ui_elt:function(){this.min<this.max?this.parent_div.show():this.parent_div.hide();var e=this.slider.slider("option","min"),t=this.slider.slider("option","max");(this.min<e||this.max>t)&&(this.slider.slider("option","min",this.min),this.slider.slider("option","max",this.max),this.slider.slider("option","step",this.get_slider_step(this.min,this.max)),this.slider.slider("option","values",[this.min,this.max]))}});var d=function(t,i){if(this.track=t,this.alpha_filter=null,this.height_filter=null,this.filters=[],this.parent_div=e("<div/>").addClass("filters").hide(),this.parent_div.bind("drag",function(e){e.stopPropagation()}).click(function(e){e.stopPropagation()}).bind("dblclick",function(e){e.stopPropagation()}).bind("keydown",function(e){e.stopPropagation()}),i&&"filters"in i){for(var n,a=("alpha_filter"in i?i.alpha_filter:null),s=("height_filter"in i?i.height_filter:null),o=i.filters,r=0;r<o.length;r++)"number"===o[r].type?(n=new l(o[r]),this.add_filter(n),n.name===a&&(this.alpha_filter=n,n.transparency_icon.addClass("active").show()),n.name===s&&(this.height_filter=n,n.height_icon.addClass("active").show())):console.log("ERROR: unsupported filter: ",name,type);"visible"in i&&i.visible&&this.parent_div.show()}if(0!==this.filters.length){var d=e("<div/>").addClass("param-row").appendTo(this.parent_div),c=this;e("<input type='submit'/>").attr("value","Run on complete dataset").appendTo(d).click(function(){c.run_on_dataset()})}};s(d.prototype,{show:function(){this.parent_div.show()},hide:function(){this.parent_div.hide()},toggle:function(){this.parent_div.toggle()},visible:function(){return this.parent_div.is(":visible")},to_dict:function(){for(var e,t={},i=[],n=0;n<this.filters.length;n++)e=this.filters[n],i.push(e.to_dict());return t.filters=i,t.alpha_filter=this.alpha_filter?this.alpha_filter.name:null,t.height_filter=this.height_filter?this.height_filter.name:null,t.visible=this.parent_div.is(":visible"),t},copy:function(e){for(var t=new d(e),i=0;i<this.filters.length;i++)t.add_filter(this.filters[i].copy());return t},add_filter:function(e){e.manager=this,this.parent_div.append(e.parent_div),this.filters.push(e)},remove_all:function(){this.filters=[],this.parent_div.children().remove()},init_filters:function(){for(var e=0;e<this.filters.length;e++){this.filters[e].update_ui_elt()}},clear_filters:function(){for(var e=0;e<this.filters.length;e++){var t=this.filters[e];t.slider.slider("option","values",[t.min,t.max])}this.alpha_filter=null,this.height_filter=null,this.parent_div.find(".icon-button").hide()},run_on_dataset:function(){for(var t,i,n=(function(e,t,i){return t in e||(e[t]=i),e[t]}),a={},s=0;s<this.filters.length;s++)t=this.filters[s],t.tool_id&&(t.min!==t.low&&(i=n(a,t.tool_id,[]),i[i.length]=t.tool_exp_name+" >= "+t.low),t.max!==t.high&&(i=n(a,t.tool_id,[]),i[i.length]=t.tool_exp_name+" <= "+t.high));var o=[];for(var r in a)o[o.length]=[r,a[r]];!function t(i,n){var a=n[0],s=a[0],o=a[1],r="("+o.join(") and (")+")",l={cond:r,input:i,target_dataset_id:i,tool_id:s};n=n.slice(1),e.getJSON(run_tool_url,l,function(e){e.error?Galaxy.modal.show({title:"Filter Dataset",body:"Error running tool "+s,buttons:{Close:Galaxy.modal.hide()}}):0===n.length?Galaxy.modal.show({title:"Filtering Dataset",body:"Filter(s) are running on the complete dataset. Outputs are in dataset's history.",buttons:{Close:Galaxy.modal.hide()}}):t(e.dataset_id,n)})}(this.track.dataset_id,o)}}),t.default={FiltersManager:d,NumberFilter:l}}).call(t,i(0))},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i(13),a=function(e){return e&&e.__esModule?e:{default:e}}(n),s=i(152),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(s),r=a.default.GenomeDataManager.extend({load_data:function(t,i,n,a){var s=e.Deferred();this.set_data(t,s);var r=Galaxy.root+"datasets/"+this.get("dataset").id+"/display",l=this;new e.Deferred;return e.when(o.makeBwg(r)).then(function(i,n){e.when(i.readWigData(t.get("chrom"),t.get("start"),t.get("end"))).then(function(e){var i=[],n={max:Number.MIN_VALUE};e.forEach(function(e){n.max!==e.min-1&&(i.push([n.max+1,0]),i.push([e.min-2,0])),i.push([e.min-1,e.score]),i.push([e.max,e.score]),n=e});var a={data:i,region:t,dataset_type:"bigwig"};l.set_data(t,a),s.resolve(a)})}),s}});t.default={BBIDataManager:r}}).call(t,i(0))},function(e,t,i){(function(n){var a,s;a=[i(153),i(154),i(155)],void 0!==(s=function(e,t){"use strict";function i(){}function a(e){e&&(this.id=e)}function s(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function o(e,t,i){Math.pow(10,6);return n.ajax({type:"GET",dataType:"native",url:e,timeout:5e3,beforeSend:function(e){e.setRequestHeader("Range","bytes="+t+"-"+(t+(i-1)))},xhrFields:{responseType:"arraybuffer"}})}function r(e,t){return e[t]+e[t+1]*y+e[t+2]*x+e[t+3]*k+e[t+4]*C}function l(){}function d(e,t,i,n){this.bwg=e,this.cirTreeOffset=t,this.cirTreeLength=i,this.isSummary=n}function c(e){var t=n.Deferred(),i=new l;return i.url=e,n.when(o(i.url,0,512)).then(function(e){if(!e)return t.resolve(null,"Couldn't fetch file");var a=e,s=new Uint8Array(a),o=new Int16Array(a),l=new Int32Array(a),d=s[0]+y*s[1]+x*s[2]+k*s[3];if(d==g)i.type="bigwig";else{if(d!=w)return d==v||d==b?t.resolve(null,"Currently don't support big-endian BBI files"):t.resolve(null,"Not a supported format, magic=0x"+d.toString(16));i.type="bigbed"}i.version=o[2],i.numZoomLevels=o[3],i.chromTreeOffset=r(s,8),i.unzoomedDataOffset=r(s,16),i.unzoomedIndexOffset=r(s,24),i.fieldCount=o[16],i.definedFieldCount=o[17],i.asOffset=r(s,36),i.totalSummaryOffset=r(s,44),i.uncompressBufSize=l[13],i.extHeaderOffset=r(s,56),i.zoomLevels=[];for(var c=0;c<i.numZoomLevels;++c){var u=l[6*c+16],h=r(s,24*c+72),f=r(s,24*c+80);i.zoomLevels.push({reduction:u,dataOffset:h,indexOffset:f})}n.when(i.readChromTree()).then(function(){i.getAutoSQL(function(e){return i.schema=e,t.resolve(i)})})}),t}function u(e,t,i,n,a){this.bbi=e,this.type=t,this.fieldCount=i,this.offset=n,this.field=a}var h=e.Range,f=e.union,p=e.intersection,m=t.inflateBuffer,_=t.arrayCopy,g=2291137574,v=654086024,w=2273964779,b=3958540679,y=256,x=65536,k=16777216,C=4294967296,$=new RegExp("^[0-9]+,[0-9]+,[0-9]+");return l.prototype.readChromTree=function(){var e=this;this.chromsToIDs={},this.idsToChroms={},this.maxID=0;var t=this.unzoomedDataOffset;return t=t+4-(t-this.chromTreeOffset&3),n.when(o(this.url,this.chromTreeOffset,t-this.chromTreeOffset)).then(function(t){var i=new Uint8Array(t),n=new Int16Array(t),a=new Int32Array(t),s=(a[0],a[1],a[2]),o=(a[3],r(i,16),function(t){var a=i[t],l=n[t/2+1];t+=4;for(var d=0;d<l;++d)if(0===a){t+=s;var c=r(i,t);t+=8,c-=e.chromTreeOffset,o(c)}else{for(var u="",h=0;h<s;++h){var f=i[t++];0!==f&&(u+=String.fromCharCode(f))}var p=i[t+3]<<24|i[t+2]<<16|i[t+1]<<8|i[t+0];i[t+7],i[t+6],i[t+5],i[t+4],t+=8,e.chromsToIDs[u]=p,0===u.indexOf("chr")&&(e.chromsToIDs[u.substr(3)]=p),e.idsToChroms[p]=u,e.maxID=Math.max(e.maxID,p)}});o(32)})},d.prototype.readWigData=function(e,t,i){var n=this.bwg.chromsToIDs[e];return void 0===n?[]:this.readWigDataById(n,t,i)},d.prototype.readWigDataById=function(e,t,i){var a=this,s=n.Deferred();if(!this.cirHeader)return n.when(o(a.bwg.url,this.cirTreeOffset,48)).then(function(o){a.cirHeader=o;var r=new Int32Array(a.cirHeader);a.cirBlockSize=r[1],n.when(a.readWigDataById(e,t,i)).then(function(e){s.resolve(e)})}),s;var l=[],d=0,c=(Date.now(),function(n,a,s,o){return(e<0||n==e)&&a<=i&&s>=t}),u=function(e,t){if(a.bwg.instrument&&console.log("level="+t+"; offset="+e+"; time="+(0|Date.now())),d+=e.length,1==e.length&&e[0]-a.cirTreeOffset==48&&a.cachedCirRoot)return m(a.cachedCirRoot,0,t),void(0===--d&&n.when(a.fetchFeatures(c,l)).then(function(e){s.resolve(e)}));for(var i,o=4+32*a.cirBlockSize,r=0;r<e.length;++r){var u=new h(e[r],e[r]+o);i=i?f(i,u):u}for(var _=i.ranges(),g=0;g<_.length;++g){var v=_[g];p(e,v,t)}},p=function(e,t,i,r){t.max(),t.min();n.when(o(a.bwg.url,t.min(),t.max()-t.min())).then(function(o){for(var r=0;r<e.length;++r)t.contains(e[r])&&(m(o,e[r]-t.min(),i),e[r]-a.cirTreeOffset==48&&e[r]-t.min()==0&&(a.cachedCirRoot=o),0===--d&&n.when(a.fetchFeatures(c,l)).then(function(e){s.resolve(e)}))})},m=function(n,a,s){var o=new Uint8Array(n),d=new Int16Array(n),c=new Int32Array(n),h=o[a],f=d[a/2+1];if(a+=4,0!==h)for(var p=0;p<f;++p){var m=a/4,_=c[m],g=c[m+1],v=c[m+2],w=c[m+3],b=r(o,a+16),y=r(o,a+24);(e<0||_<e||_==e&&g<=i)&&(e<0||v>e||v==e&&w>=t)&&l.push({offset:b,size:y}),a+=32}else{for(var x=[],p=0;p<f;++p){var m=a/4,_=c[m],g=c[m+1],v=c[m+2],w=c[m+3],b=r(o,a+16);(e<0||_<e||_==e&&g<=i)&&(e<0||v>e||v==e&&w>=t)&&x.push(b),a+=24}x.length>0&&u(x,s+1)}};return u([a.cirTreeOffset+48],1),s},d.prototype.fetchFeatures=function(e,t){var a=this,s=n.Deferred();if(t.sort(function(e,t){return(0|e.offset)-(0|t.offset)}),0===t.length)return[];var r=[],l=function(e,t,n,s){s||(s={});var o=new i;o._chromId=e,o.segment=a.bwg.idsToChroms[e],o.min=t,o.max=n,o.type=a.bwg.type;for(var l in s)o[l]=s[l];r.push(o)},d=function(){if(0===t.length){Date.now();return s.resolve(r)}var i=t[0];if(i.data)a.parseFeatures(i.data,l,e),t.splice(0,1),d();else{for(var c=i.offset,u=i.size,h=1;h<t.length&&t[h].offset==c+u;)u+=t[h].size,++h;n.when(o(a.bwg.url,c,u)).then(function(e){for(var i=0,n=0;i<u;){var s,o=t[n];if(a.bwg.uncompressBufSize>0)s=m(e,i+2,o.size-2);else{var r=new Uint8Array(o.size);_(new Uint8Array(e,i,o.size),0,r,0,o.size),s=r.buffer}o.data=s,i+=o.size,++n}d()})}};return d(),s},d.prototype.parseFeatures=function(e,t,i){var s=new Uint8Array(e);if(this.isSummary)for(var o=new Int16Array(e),r=new Int32Array(e),l=new Float32Array(e),d=e.byteLength/32,c=0;c<d;++c){var u=r[8*c],m=r[8*c+1],_=r[8*c+2],g=r[8*c+3],v=(l[8*c+4],l[8*c+5]),w=l[8*c+6];l[8*c+7];if(i(u,m+1,_)){var b={type:"bigwig",score:w/g,maxScore:v};"bigbed"==this.bwg.type&&(b.type="density"),t(u,m+1,_,b)}}else if("bigwig"==this.bwg.type){var o=new Int16Array(e),r=new Int32Array(e),l=new Float32Array(e),u=r[0],y=r[1],x=(r[2],r[3]),k=r[4],C=s[20],d=o[11];if(3==C)for(var c=0;c<d;++c){var S=l[c+6],T=y+c*x+1,M=y+c*x+k;i(u,T,M)&&t(u,T,M,{score:S})}else if(2==C)for(var c=0;c<d;++c){var m=r[2*c+6]+1,_=m+k-1,S=l[2*c+7];i(u,m,_)&&t(u,m,_,{score:S})}else if(1==C)for(var c=0;c<d;++c){var m=r[3*c+6]+1,_=r[3*c+7],S=l[3*c+8];m>_&&(m=_),i(u,m,_)&&t(u,m,_,{score:S})}else console.log("Currently not handling bwgType="+C)}else{if("bigbed"!=this.bwg.type)throw Error("Don't know what to do with "+this.bwg.type);for(var E=0,P=this.bwg.definedFieldCount,O=this.bwg.schema;E<s.length;){var u=s[E+3]<<24|s[E+2]<<16|s[E+1]<<8|s[E+0],m=s[E+7]<<24|s[E+6]<<16|s[E+5]<<8|s[E+4],_=s[E+11]<<24|s[E+10]<<16|s[E+9]<<8|s[E+8];E+=12;for(var A="";;){var D=s[E++];if(0==D)break;A+=String.fromCharCode(D)}var I,z={};if(I=A.length>0?A.split("\t"):[],I.length>0&&P>3&&(z.label=I[0]),I.length>1&&P>4){var S=parseInt(I[1]);isNaN(S)||(z.score=S)}if(I.length>2&&P>5&&(z.orientation=I[2]),I.length>5&&P>8){var j=I[5];$.test(j)&&(z.itemRgb="rgb("+j+")")}if(I.length>P-3&&O)for(var L=P-3;L<I.length;++L)z[O.fields[L+3].name]=I[L];if(i(u,m+1,_,I))if(P<12)t(u,m+1,_,z);else{var R=0|I[3],V=0|I[4],N=0|I[6],G=I[7].split(","),U=I[8].split(",");if(z.exonFrames){var H=z.exonFrames.split(",");z.exonFrames=void 0}z.type="transcript";var F=new a;for(var B in z)F[B]=z[B];if(F.id=I[0],F.segment=this.bwg.idsToChroms[u],F.min=m+1,F.max=_,F.notes=[],z.groups=[F],I.length>9){var q=z.geneName||I[9],Y=q;I.length>10&&(Y=I[10]),z.geneName2&&(Y=z.geneName2);var W=n.extend({},F);W.id=q,W.label=Y,W.type="gene",z.groups.push(W)}for(var J=[],X=0;X<N;++X){var K=(0|U[X])+m,Q=K+(0|G[X]),Z=new h(K,Q);J.push(Z)}for(var ee=f(J),te=ee.ranges(),ie=0;ie<te.length;++ie){var ne=te[ie];t(u,ne.min()+1,ne.max(),z)}if(V>R){var ae="+"==z.orientation?new h(R,V+3):new h(R-3,V),se=p(ee,ae);if(se){z.type="translation";for(var oe=se.ranges(),re=0,le=0;oe[0].min()>te[le].max();)le++;for(var ie=0;ie<oe.length;++ie){var de=ie;"-"==z.orientation&&(de=oe.length-ie-1);var ne=oe[de];if(z.readframe=re,H){var ce=parseInt(H[de+le]);"number"==typeof ce&&ce>=0&&ce<=2&&(z.readframe=ce,z.readframeExplicit=!0)}var ue=ne.max()-ne.min();re=(re+ue)%3,t(u,ne.min()+1,ne.max(),z)}}}}}}},d.prototype.getFirstAdjacent=function(e,t,i,n){var a=this.bwg.chromsToIDs[e];if(void 0===a)return n([]);this.getFirstAdjacentById(a,t,i,n)},d.prototype.getFirstAdjacentById=function(e,t,i,n){var a=this;if(!this.cirHeader)return void this.bwg.data.slice(this.cirTreeOffset,48).fetch(function(s){a.cirHeader=s;var o=new Int32Array(a.cirHeader);a.cirBlockSize=o[1],a.getFirstAdjacentById(e,t,i,n)});var s=null,o=-1,l=-1,d=0,c=(Date.now(),function(e,t){d+=e.length;for(var i,n=4+32*a.cirBlockSize,s=0;s<e.length;++s){var o=new h(e[s],e[s]+n);i=i?f(i,o):o}for(var r=i.ranges(),l=0;l<r.length;++l){var c=r[l];u(e,c,t)}}),u=function(o,r,l,c){r.max(),r.min();a.bwg.data.slice(r.min(),r.max()-r.min()).fetch(function(c){for(var u=0;u<o.length;++u)if(r.contains(o[u])&&(p(c,o[u]-r.min(),l),0==--d)){if(!s)return i>0&&(0!=e||t>0)?a.getFirstAdjacentById(0,0,i,n):i<0&&(e!=a.bwg.maxID||t<1e9)?a.getFirstAdjacentById(a.bwg.maxID,1e9,i,n):n([]);a.fetchFeatures(function(n,a,s,o){return i<0&&(n<e||s<t)||i>0&&(n>e||a>t)},[s],function(e){for(var t=null,a=-1,s=-1,o=0;o<e.length;++o){var r=e[o],l=r._chromId,d=r.min,c=r.max;(null==t||i<0&&(l>a||c>s)||i>0&&(l<a||d<s))&&(t=r,s=i<0?c:d,a=l)}return n(null!=t?[t]:[])})}})},p=function(n,d,u){var h=new Uint8Array(n),f=new Int16Array(n),p=new Int32Array(n),m=h[d],_=f[d/2+1];if(d+=4,0!=m)for(var g=0;g<_;++g){var v=d/4,w=p[v],b=p[v+1],y=p[v+2],x=p[v+3],k=r(h,d+16),C=r(h,d+24);(i<0&&(w<e||w==e&&b<=t)||i>0&&(y>e||y==e&&x>=t))&&(/_random/.exec(a.bwg.idsToChroms[w])||(null==s||i<0&&(y>o||y==o&&x>l)||i>0&&(w<o||w==o&&b<l))&&(s={offset:k,size:C},l=i<0?x:b,o=i<0?y:w)),d+=32}else{for(var $=-1,S=-1,g=0;g<_;++g){var v=d/4,w=p[v],b=p[v+1],y=p[v+2],x=p[v+3],k=p[v+4]<<32|p[v+5];(i<0&&(w<e||w==e&&b<=t)&&y>=e||i>0&&(y>e||y==e&&x>=t)&&w<=e)&&($<0||x>S)&&($=k,S=i<0?x:b,i<0?y:w),d+=24}$>=0&&c([$],u+1)}};c([a.cirTreeOffset+48],1)},l.prototype.readWigData=function(e,t,i){var n,a=i-t;if(a<=25e3||0===this.zoomLevels.length)n=this.getUnzoomedView();else for(var s=0;s<this.zoomLevels.length;s++)if(a/this.zoomLevels[s].reduction<25e3){n=this.getZoomedView(s);break}return n.readWigData(e,t,i)},l.prototype.getUnzoomedView=function(){if(!this.unzoomedView){var e=4e3;this.zoomLevels[0]&&(e=this.zoomLevels[0].dataOffset-this.unzoomedIndexOffset),this.unzoomedView=new d(this,this.unzoomedIndexOffset,e,!1)}return this.unzoomedView},l.prototype.getZoomedView=function(e){var t=this.zoomLevels[e];return t.view||(t.view=new d(this,t.indexOffset,4e3,!0)),t.view},l.prototype._tsFetch=function(e,t,i,n,a){var s=this;if(!(e>=this.zoomLevels.length-1)){var o;return o=e<0?this.getUnzoomedView():this.getZoomedView(e),o.readWigDataById(t,i,n,a)}if(this.topLevelReductionCache){for(var r=[],l=this.topLevelReductionCache,d=0;d<l.length;++d)l[d]._chromId==t&&r.push(l[d]);return a(r)}this.getZoomedView(this.zoomLevels.length-1).readWigDataById(-1,0,3e8,function(o){return s.topLevelReductionCache=o,s._tsFetch(e,t,i,n,a)})},l.prototype.thresholdSearch=function(e,t,i,n,a){function s(){if(0==l.length)return a(null);l.sort(function(e,t){var n=e.zoom-t.zoom;return 0!=n?n:(n=e.chrOrd-t.chrOrd,0!=n?n:e.min-t.min*i)});var e=l.splice(0,1)[0];o._tsFetch(e.zoom,e.chr,e.min,e.max,function(o){var r=i>0?0:3e8;e.fromRef&&(r=t);for(var d=0;d<o.length;++d){var c,u=o[d];if(c=void 0!=u.maxScore?u.maxScore:u.score,i>0){if(c>n)if(e.zoom<0){if(u.min>r)return a(u)}else u.max>r&&l.push({chr:e.chr,chrOrd:e.chrOrd,zoom:e.zoom-2,min:u.min,max:u.max,fromRef:e.fromRef})}else if(c>n)if(e.zoom<0){if(u.max<r)return a(u)}else u.min<r&&l.push({chr:e.chr,chrOrd:e.chrOrd,zoom:e.zoom-2,min:u.min,max:u.max,fromRef:e.fromRef})}s()})}i=i<0?-1:1;for(var o=this,r=this.chromsToIDs[e],l=[{chrOrd:0,chr:r,zoom:o.zoomLevels.length-4,min:0,max:3e8,fromRef:!0}],d=1;d<=this.maxID+1;++d){var c=(r+i*d)%(this.maxID+1);c<0&&(c+=this.maxID+1),l.push({chrOrd:d,chr:c,zoom:o.zoomLevels.length-1,min:0,max:3e8})}s()},l.prototype.getAutoSQL=function(e){if(!this.asOffset)return e(null);n.when(o(this.url,this.asOffset,2048)).then(function(t){for(var i=new Uint8Array(t),n="",a=0;a<i.length&&0!=i[a];++a)n+=String.fromCharCode(i[a]);var s=/(\w+)\s+(\w+)\s+("([^"]+)")?\s+\(\s*/,o=/([\w\[\]]+)\s+(\w+)\s*;\s*("([^"]+)")?\s*/g,r=s.exec(n);if(r){var l={declType:r[1],name:r[2],comment:r[4],fields:[]};n=n.substring(r[0]);for(var d=o.exec(n);null!=d;d=o.exec(n))l.fields.push({type:d[1],name:d[2],comment:d[4]});return e(l)}})},l.prototype.getExtraIndices=function(e){var t=this;if(this.version<4||0==this.extHeaderOffset||"bigbed"!=this.type)return e(null);this.data.slice(this.extHeaderOffset,64).fetch(function(i){if(!i)return e(null,"Couldn't fetch extension header");var n=new Uint8Array(i),a=new Int16Array(i),s=(new Int32Array(i),a[0],a[1]),o=r(n,4);if(0==s)return e(null);t.data.slice(o,20*s).fetch(function(i){if(!i)return e(null,"Couldn't fetch index info");for(var n=new Uint8Array(i),a=new Int16Array(i),o=(new Int32Array(i),[]),l=0;l<s;++l){var d=a[10*l],c=a[10*l+1],h=r(n,20*l+4),f=a[10*l+8],p=new u(t,d,c,h,f);o.push(p)}e(o)})})},u.prototype.lookup=function(e,t){var i=this;this.bbi.data.slice(this.offset,32).fetch(function(n){function a(n){i.bbi.data.slice(n,4+d*(c+u)).fetch(function(n){var o=new Uint8Array(n),l=new Uint16Array(n),d=(new Uint32Array(n),o[0]),h=l[1],f=4;if(0!=d){for(var p=0;p<h;++p){for(var m="",_=0;_<c;++_){var g=o[f++];0!=g&&(m+=String.fromCharCode(g))}if(m==e){var v=r(o,f),w=s(o,f+8);return i.bbi.getUnzoomedView().fetchFeatures(function(t,n,a,s){if(s&&s.length>i.field-3)return s[i.field-3]==e},[{offset:v,size:w}],t)}f+=u}return t([])}for(var b=null,p=0;p<h;++p){for(var m="",_=0;_<c;++_){var g=o[f++];0!=g&&(m+=String.fromCharCode(g))}var y=r(o,f);if(f+=8,e.localeCompare(m)<0&&b)return void a(b);b=y}a(b)})}var o=new Uint8Array(n),l=(new Int16Array(n),new Int32Array(n)),d=(l[0],l[1]),c=l[2],u=l[3];r(o,16);a(i.offset+32)})},{makeBwg:c}}.apply(t,a))&&(e.exports=s)}).call(t,i(0))},function(e,t,i){var n,a;n=[],void 0!==(a=function(){"use strict";function e(e,t){if("number"!=typeof e||"number"!=typeof t)throw"Bad range "+e+","+t;this._min=e,this._max=t}function t(e){var t=e.sort(o),i=[],n=t.shift();t.forEach(function(e){e._min<=n._max?e._max>n._max&&(n._max=e._max):(i.push(n),n=e)}),i.push(n),this._ranges=i}function i(e,i){return e instanceof t||(e instanceof Array||(e=[e]),e=new t(e)),i&&e.insertRange(i),e}function n(i,n){for(var a=i.ranges(),s=n.ranges(),o=a.length,r=s.length,l=0,d=0,c=[];l<o&&d<r;){var i=a[l],n=s[d],u=Math.max(i.min(),n.min()),h=Math.min(i.max(),n.max());h>=u&&c.push(new e(u,h)),i.max()>n.max()?++d:++l}return 0==c.length?null:1==c.length?c[0]:new t(c)}function a(e){for(var t=0,i=e.ranges(),n=0;n<i.length;++n){var a=i[n];t+=a.max()-a.min()+1}return t}function s(e,t){return e.min()<t.min()?-1:e.min()>t.min()?1:e.max()<t.max()?-1:t.max()>e.max()?1:0}function o(e,t){return e._min<t._min?-1:e._min>t._min?1:e._max<t._max?-1:t._max>e._max?1:0}return e.prototype.min=function(){return this._min},e.prototype.max=function(){return this._max},e.prototype.contains=function(e){return e>=this._min&&e<=this._max},e.prototype.isContiguous=function(){return!0},e.prototype.ranges=function(){return[this]},e.prototype._pushRanges=function(e){e.push(this)},e.prototype.toString=function(){return"["+this._min+"-"+this._max+"]"},t.prototype.min=function(){return this._ranges[0].min()},t.prototype.max=function(){return this._ranges[this._ranges.length-1].max()},t.prototype.lower_bound=function(e){var t=this.ranges();if(e>this.max())return t.length;if(e<this.min())return 0;for(var i=0,n=t.length-1;i<=n;){var a=Math.floor((i+n)/2);if(e>t[a]._max)i=a+1;else{if(!(e<t[a]._min))return a;n=a-1}}return i},t.prototype.contains=function(e){var t=this.lower_bound(e);return!!(t<this._ranges.length&&this._ranges[t].contains(e))},t.prototype.insertRange=function(e){var t=this.lower_bound(e._min);if(t===this._ranges.length)return void this._ranges.push(e);var i=this.ranges();if(e._max<i[t]._min)return void this._ranges.splice(t,0,e);i[t]._min<e._min&&(e._min=i[t]._min);for(var n=t+1;n<i.length&&i[n]._min<=e._max;)n++;n--,i[n]._max>e._max&&(e._max=i[n]._max),this._ranges.splice(t,n-t+1,e)},t.prototype.isContiguous=function(){return this._ranges.length>1},t.prototype.ranges=function(){return this._ranges},t.prototype._pushRanges=function(e){for(var t=0;t<this._ranges.length;++t)e.push(this._ranges[t])},t.prototype.toString=function(){for(var e="",t=0;t<this._ranges.length;++t)t>0&&(e+=","),e+=this._ranges[t].toString();return e},{Range:e,union:i,intersection:n,coverage:a,rangeOver:s,_rangeOrder:o}}.apply(t,n))&&(e.exports=a)},function(e,t,i){var n,a;n=[],void 0!==(a=function(){function e(){}function t(){this.was=[0]}function i(e,t,i){this.hufts=new Int32Array(3*u),this.window=new Uint8Array(i),this.end=i,this.checkfn=t,this.mode=g,this.reset(e,null),this.left=0,this.table=0,this.index=0,this.blens=null,this.bb=new Int32Array(1),this.tb=new Int32Array(1),this.codes=new n,this.last=0,this.bitk=0,this.bitb=0,this.read=0,this.write=0,this.check=0,this.inftree=new a}function n(){}function a(){}function s(e,t,i,n,a){return e[0]=v,t[0]=w,i[0]=b,n[0]=y,f}function o(e,t,i,n,a){if(0!=a){if(!e)throw"Undef src";if(!i)throw"Undef dest";0==t&&a==e.length?l(e,i,n):E?l(e.subarray(t,t+a),i,n):1==e.BYTES_PER_ELEMENT&&a>100?l(new Uint8Array(e.buffer,e.byteOffset+t,a),i,n):r(e,t,i,n,a)}}function r(e,t,i,n,a){for(var s=0;s<a;++s)i[n+s]=e[t+s]}function l(e,t,i){t.set(e,i)}function d(t,i,n,a){t=i?n?new Uint8Array(t,i,n):new Uint8Array(t,i,t.byteLength-i):new Uint8Array(t);var s=new e;s.inflateInit(c,!0),s.next_in=t,s.next_in_index=0,s.avail_in=t.length;for(var r=[],l=0;;){var d=new Uint8Array(32e3);s.next_out=d,s.next_out_index=0,s.avail_out=d.length;var u=s.inflate(h);if(u!=f&&u!=p&&u!=m)throw s.msg;if(0!=s.avail_out){var _=new Uint8Array(d.length-s.avail_out);o(d,0,_,0,d.length-s.avail_out),d=_}if(r.push(d),l+=d.length,u==p||u==m)break}if(a&&(a[0]=(i||0)+s.next_in_index),1==r.length)return r[0].buffer;for(var g=new Uint8Array(l),v=0,w=0;w<r.length;++w){var b=r[w];o(b,0,g,v,b.length),v+=b.length}return g.buffer}var c=15,u=1440,h=0,f=0,p=1,m=-5,_=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],g=0,v=9,w=5,b=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],y=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],x=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],C=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];e.prototype.inflateInit=function(e,i){return e||(e=c),i&&(i=!1),this.istate=new t,this.istate.inflateInit(this,i?-e:e)},e.prototype.inflate=function(e){return null==this.istate?-2:this.istate.inflate(this,e)},e.prototype.inflateEnd=function(){if(null==this.istate)return-2;var e=istate.inflateEnd(this);return this.istate=null,e},e.prototype.inflateSync=function(){return istate.inflateSync(this)},e.prototype.inflateSetDictionary=function(e,t){return istate.inflateSetDictionary(this,e,t)},t.prototype.inflateReset=function(e){return null==e||null==e.istate?-2:(e.total_in=e.total_out=0,e.msg=null,e.istate.mode=0!=e.istate.nowrap?7:0,e.istate.blocks.reset(e,null),f)},t.prototype.inflateEnd=function(e){return null!=this.blocks&&this.blocks.free(e),this.blocks=null,f},t.prototype.inflateInit=function(e,t){return e.msg=null,this.blocks=null,nowrap=0,t<0&&(t=-t,nowrap=1),t<8||t>15?(this.inflateEnd(e),-2):(this.wbits=t,e.istate.blocks=new i(e,0!=e.istate.nowrap?null:this,1<<t),this.inflateReset(e),f)},t.prototype.inflate=function(e,t){var i,n;if(null==e||null==e.istate||null==e.next_in)return-2;for(t=4==t?m:f,i=m;;)switch(e.istate.mode){case 0:if(0==e.avail_in)return i;if(i=t,e.avail_in--,e.total_in++,8!=(15&(e.istate.method=e.next_in[e.next_in_index++]))){e.istate.mode=13,e.msg="unknown compression method",e.istate.marker=5;break}if(8+(e.istate.method>>4)>e.istate.wbits){e.istate.mode=13,e.msg="invalid window size",e.istate.marker=5;break}e.istate.mode=1;case 1:if(0==e.avail_in)return i;if(i=t,e.avail_in--,e.total_in++,n=255&e.next_in[e.next_in_index++],((e.istate.method<<8)+n)%31!=0){e.istate.mode=13,e.msg="incorrect header check",e.istate.marker=5;break}if(0==(32&n)){e.istate.mode=7;break}e.istate.mode=2;case 2:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need=(255&e.next_in[e.next_in_index++])<<24&4278190080,e.istate.mode=3;case 3:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.next_in[e.next_in_index++])<<16&16711680,e.istate.mode=4;case 4:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.next_in[e.next_in_index++])<<8&65280,e.istate.mode=5;case 5:return 0==e.avail_in?i:(i=t,e.avail_in--,e.total_in++,e.istate.need+=255&e.next_in[e.next_in_index++],e.adler=e.istate.need,e.istate.mode=6,2);case 6:return e.istate.mode=13,e.msg="need dictionary",e.istate.marker=0,-2;case 7:if(-3==(i=e.istate.blocks.proc(e,i))){e.istate.mode=13,e.istate.marker=0;break}if(i==f&&(i=t),i!=p)return i;if(i=t,e.istate.blocks.reset(e,e.istate.was),0!=e.istate.nowrap){e.istate.mode=12;break}e.istate.mode=8;case 8:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need=(255&e.next_in[e.next_in_index++])<<24&4278190080,e.istate.mode=9;case 9:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.next_in[e.next_in_index++])<<16&16711680,e.istate.mode=10;case 10:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.next_in[e.next_in_index++])<<8&65280,e.istate.mode=11;case 11:if(0==e.avail_in)return i;if(i=t,e.avail_in--,e.total_in++,e.istate.need+=255&e.next_in[e.next_in_index++],e.istate.was[0]!=e.istate.need){e.istate.mode=13,e.msg="incorrect data check",e.istate.marker=5;break}e.istate.mode=12;case 12:return p;case 13:return-3;default:return-2}},t.prototype.inflateSetDictionary=function(e,t,i){var n=0,a=i;return null==e||null==e.istate||6!=e.istate.mode?-2:e._adler.adler32(1,t,0,i)!=e.adler?-3:(e.adler=e._adler.adler32(0,null,0,0),a>=1<<e.istate.wbits&&(a=(1<<e.istate.wbits)-1,n=i-a),e.istate.blocks.set_dictionary(t,n,a),e.istate.mode=7,f)};var S=[0,0,255,255];t.prototype.inflateSync=function(e){var t,i,n,a,s;if(null==e||null==e.istate)return-2;if(13!=e.istate.mode&&(e.istate.mode=13,e.istate.marker=0),0==(t=e.avail_in))return m;for(i=e.next_in_index,n=e.istate.marker;0!=t&&n<4;)e.next_in[i]==S[n]?n++:n=0!=e.next_in[i]?0:4-n,i++,t--;return e.total_in+=i-e.next_in_index,e.next_in_index=i,e.avail_in=t,e.istate.marker=n,4!=n?-3:(a=e.total_in,s=e.total_out,this.inflateReset(e),e.total_in=a,e.total_out=s,e.istate.mode=7,f)},t.prototype.inflateSyncPoint=function(e){return null==e||null==e.istate||null==e.istate.blocks?-2:e.istate.blocks.sync_point()};var T=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];i.prototype.reset=function(e,t){t&&(t[0]=this.check),6==this.mode&&this.codes.free(e),this.mode=g,this.bitk=0,this.bitb=0,this.read=this.write=0,this.checkfn&&(e.adler=this.check=e._adler.adler32(0,null,0,0))},i.prototype.proc=function(e,t){var i,n,a,r,l,d,c;for(r=e.next_in_index,l=e.avail_in,n=this.bitb,a=this.bitk,d=this.write,c=d<this.read?this.read-d-1:this.end-d;;)switch(this.mode){case g:for(;a<3;){if(0==l)return this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);t=f,l--,n|=(255&e.next_in[r++])<<a,a+=8}switch(i=7&n,this.last=1&i,i>>>1){case 0:n>>>=3,a-=3,i=7&a,n>>>=i,a-=i,this.mode=1;break;case 1:var u=new Int32Array(1),h=new Int32Array(1),m=[],v=[];s(u,h,m,v,e),this.codes.init(u[0],h[0],m[0],0,v[0],0,e),n>>>=3,a-=3,this.mode=6;break;case 2:n>>>=3,a-=3,this.mode=3;break;case 3:return n>>>=3,a-=3,this.mode=13,e.msg="invalid block type",t=-3,this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t)}break;case 1:for(;a<32;){if(0==l)return this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);t=f,l--,n|=(255&e.next_in[r++])<<a,a+=8}if((~n>>>16&65535)!=(65535&n))return this.mode=13,e.msg="invalid stored block lengths",t=-3,this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);this.left=65535&n,n=a=0,this.mode=0!=this.left?2:0!=this.last?7:g;break;case 2:if(0==l)return this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,write=d,this.inflate_flush(e,t);if(0==c&&(d==end&&0!=read&&(d=0,c=d<this.read?this.read-d-1:this.end-d),0==c&&(this.write=d,t=this.inflate_flush(e,t),d=this.write,c=d<this.read?this.read-d-1:this.end-d,d==this.end&&0!=this.read&&(d=0,c=d<this.read?this.read-d-1:this.end-d),0==c)))return this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);if(t=f,i=this.left,i>l&&(i=l),i>c&&(i=c),o(e.next_in,r,this.window,d,i),r+=i,l-=i,d+=i,c-=i,0!=(this.left-=i))break;this.mode=0!=this.last?7:g;break;case 3:for(;a<14;){if(0==l)return this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);t=f,l--,n|=(255&e.next_in[r++])<<a,a+=8}if(this.table=i=16383&n,(31&i)>29||(i>>5&31)>29)return this.mode=9,e.msg="too many length or distance symbols",t=-3,this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);if(i=258+(31&i)+(i>>5&31),null==this.blens||this.blens.length<i)this.blens=new Int32Array(i);else for(var w=0;w<i;w++)this.blens[w]=0;n>>>=14,a-=14,this.index=0,mode=4;case 4:for(;this.index<4+(this.table>>>10);){for(;a<3;){if(0==l)return this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);t=f,l--,n|=(255&e.next_in[r++])<<a,a+=8}this.blens[T[this.index++]]=7&n,n>>>=3,a-=3}for(;this.index<19;)this.blens[T[this.index++]]=0;if(this.bb[0]=7,(i=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,e))!=f)return t=i,-3==t&&(this.blens=null,this.mode=9),this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,write=d,this.inflate_flush(e,t);this.index=0,this.mode=5;case 5:for(;;){if(i=this.table,!(this.index<258+(31&i)+(i>>5&31)))break;var w,b,y;for(i=this.bb[0];a<i;){if(0==l)return this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);t=f,l--,n|=(255&e.next_in[r++])<<a,a+=8}if(i=this.hufts[3*(this.tb[0]+(n&_[i]))+1],(y=this.hufts[3*(this.tb[0]+(n&_[i]))+2])<16)n>>>=i,a-=i,this.blens[this.index++]=y;else{for(w=18==y?7:y-14,b=18==y?11:3;a<i+w;){if(0==l)return this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);t=f,l--,n|=(255&e.next_in[r++])<<a,a+=8}if(n>>>=i,a-=i,b+=n&_[w],n>>>=w,a-=w,w=this.index,i=this.table,w+b>258+(31&i)+(i>>5&31)||16==y&&w<1)return this.blens=null,this.mode=9,e.msg="invalid bit length repeat",t=-3,this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);y=16==y?this.blens[w-1]:0;do{this.blens[w++]=y}while(0!=--b);this.index=w}}this.tb[0]=-1;var u=new Int32Array(1),h=new Int32Array(1),m=new Int32Array(1),v=new Int32Array(1);if(u[0]=9,h[0]=6,i=this.table,(i=this.inftree.inflate_trees_dynamic(257+(31&i),1+(i>>5&31),this.blens,u,h,m,v,this.hufts,e))!=f)return-3==i&&(this.blens=null,this.mode=13),t=i,this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);this.codes.init(u[0],h[0],this.hufts,m[0],this.hufts,v[0],e),this.mode=6;case 6:if(this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,(t=this.codes.proc(this,e,t))!=p)return this.inflate_flush(e,t);if(t=f,this.codes.free(e),r=e.next_in_index,l=e.avail_in,n=this.bitb,a=this.bitk,d=this.write,c=d<this.read?this.read-d-1:this.end-d,0==this.last){this.mode=g;break}this.mode=7;case 7:if(this.write=d,t=this.inflate_flush(e,t),d=this.write,c=d<this.read?this.read-d-1:this.end-d,this.read!=this.write)return this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);mode=12;case 8:return t=p,this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);case 9:return t=-3,this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t);default:return t=-2,this.bitb=n,this.bitk=a,e.avail_in=l,e.total_in+=r-e.next_in_index,e.next_in_index=r,this.write=d,this.inflate_flush(e,t)}},i.prototype.free=function(e){this.reset(e,null),this.window=null,this.hufts=null},i.prototype.set_dictionary=function(e,t,i){o(e,t,window,0,i),this.read=this.write=i},i.prototype.sync_point=function(){return 1==this.mode},i.prototype.inflate_flush=function(e,t){var i,n,a;return n=e.next_out_index,a=this.read,i=(a<=this.write?this.write:this.end)-a,i>e.avail_out&&(i=e.avail_out),0!=i&&t==m&&(t=f),e.avail_out-=i,e.total_out+=i,null!=this.checkfn&&(e.adler=this.check=e._adler.adler32(this.check,this.window,a,i)),o(this.window,a,e.next_out,n,i),n+=i,a+=i,a==this.end&&(a=0,this.write==this.end&&(this.write=0),i=this.write-a,i>e.avail_out&&(i=e.avail_out),0!=i&&t==m&&(t=f),e.avail_out-=i,e.total_out+=i,null!=this.checkfn&&(e.adler=this.check=e._adler.adler32(this.check,this.window,a,i)),o(this.window,a,e.next_out,n,i),n+=i,a+=i),e.next_out_index=n,this.read=a,t};n.prototype.init=function(e,t,i,n,a,s,o){this.mode=0,this.lbits=e,this.dbits=t,this.ltree=i,this.ltree_index=n,this.dtree=a,this.dtree_index=s,this.tree=null},n.prototype.proc=function(e,t,i){var n,a,s,o,r,l,d,c=0,u=0,h=0;for(h=t.next_in_index,o=t.avail_in,c=e.bitb,u=e.bitk,r=e.write,l=r<e.read?e.read-r-1:e.end-r;;)switch(this.mode){case 0:if(l>=258&&o>=10&&(e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,i=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,e,t),h=t.next_in_index,o=t.avail_in,c=e.bitb,u=e.bitk,r=e.write,l=r<e.read?e.read-r-1:e.end-r,i!=f)){this.mode=i==p?7:9;break}this.need=this.lbits,this.tree=this.ltree,this.tree_index=this.ltree_index,this.mode=1;case 1:for(n=this.need;u<n;){if(0==o)return e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);i=f,o--,c|=(255&t.next_in[h++])<<u,u+=8}if(a=3*(this.tree_index+(c&_[n])),c>>>=this.tree[a+1],u-=this.tree[a+1],0==(s=this.tree[a])){this.lit=this.tree[a+2],this.mode=6;break}if(0!=(16&s)){this.get=15&s,this.len=this.tree[a+2],this.mode=2;break}if(0==(64&s)){this.need=s,this.tree_index=a/3+this.tree[a+2];break}if(0!=(32&s)){this.mode=7;break}return this.mode=9,t.msg="invalid literal/length code",i=-3,e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);case 2:for(n=this.get;u<n;){if(0==o)return e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);i=f,o--,c|=(255&t.next_in[h++])<<u,u+=8}this.len+=c&_[n],c>>=n,u-=n,this.need=this.dbits,this.tree=this.dtree,this.tree_index=this.dtree_index,this.mode=3;case 3:for(n=this.need;u<n;){if(0==o)return e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);i=f,o--,c|=(255&t.next_in[h++])<<u,u+=8}if(a=3*(this.tree_index+(c&_[n])),c>>=this.tree[a+1],u-=this.tree[a+1],0!=(16&(s=this.tree[a]))){this.get=15&s,this.dist=this.tree[a+2],this.mode=4;break}if(0==(64&s)){this.need=s,this.tree_index=a/3+this.tree[a+2];break}return this.mode=9,t.msg="invalid distance code",i=-3,e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);case 4:for(n=this.get;u<n;){if(0==o)return e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);i=f,o--,c|=(255&t.next_in[h++])<<u,u+=8}this.dist+=c&_[n],c>>=n,u-=n,this.mode=5;case 5:for(d=r-this.dist;d<0;)d+=e.end;for(;0!=this.len;){if(0==l&&(r==e.end&&0!=e.read&&(r=0,l=r<e.read?e.read-r-1:e.end-r),0==l&&(e.write=r,i=e.inflate_flush(t,i),r=e.write,l=r<e.read?e.read-r-1:e.end-r,r==e.end&&0!=e.read&&(r=0,l=r<e.read?e.read-r-1:e.end-r),0==l)))return e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);e.window[r++]=e.window[d++],l--,d==e.end&&(d=0),this.len--}this.mode=0;break;case 6:if(0==l&&(r==e.end&&0!=e.read&&(r=0,l=r<e.read?e.read-r-1:e.end-r),0==l&&(e.write=r,i=e.inflate_flush(t,i),r=e.write,l=r<e.read?e.read-r-1:e.end-r,r==e.end&&0!=e.read&&(r=0,l=r<e.read?e.read-r-1:e.end-r),0==l)))return e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);i=f,e.window[r++]=this.lit,l--,this.mode=0;break;case 7:if(u>7&&(u-=8,o++,h--),e.write=r,i=e.inflate_flush(t,i),r=e.write,l=r<e.read?e.read-r-1:e.end-r,e.read!=e.write)return e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);this.mode=8;case 8:return i=p,e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);case 9:return i=-3,e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i);default:return i=-2,e.bitb=c,e.bitk=u,t.avail_in=o,t.total_in+=h-t.next_in_index,t.next_in_index=h,e.write=r,e.inflate_flush(t,i)}},n.prototype.free=function(e){},n.prototype.inflate_fast=function(e,t,i,n,a,s,r,l){var d,c,u,h,m,g,v,w,b,y,x,k,C,$,S,T;v=l.next_in_index,w=l.avail_in,m=r.bitb,g=r.bitk,b=r.write,y=b<r.read?r.read-b-1:r.end-b,x=_[e],k=_[t];do{for(;g<20;)w--,m|=(255&l.next_in[v++])<<g,g+=8;if(d=m&x,c=i,u=n,T=3*(u+d),0!=(h=c[T]))for(;;){if(m>>=c[T+1],g-=c[T+1],0!=(16&h)){for(h&=15,C=c[T+2]+(m&_[h]),m>>=h,g-=h;g<15;)w--,m|=(255&l.next_in[v++])<<g,g+=8;for(d=m&k,c=a,u=s,T=3*(u+d),h=c[T];;){if(m>>=c[T+1],g-=c[T+1],0!=(16&h)){for(h&=15;g<h;)w--,m|=(255&l.next_in[v++])<<g,g+=8;if($=c[T+2]+(m&_[h]),m>>=h,g-=h,y-=C,b>=$)S=b-$,r.window[b++]=r.window[S++],r.window[b++]=r.window[S++],C-=2;else{S=b-$;do{S+=r.end}while(S<0);if(h=r.end-S,C>h){if(C-=h,b-S>0&&h>b-S)do{r.window[b++]=r.window[S++]}while(0!=--h);else o(r.window,S,r.window,b,h),b+=h,S+=h,h=0;S=0}}do{r.window[b++]=r.window[S++]}while(0!=--C);break}if(0!=(64&h))return l.msg="invalid distance code",C=l.avail_in-w,C=g>>3<C?g>>3:C,w+=C,v-=C,g-=C<<3,r.bitb=m,r.bitk=g,l.avail_in=w,l.total_in+=v-l.next_in_index,l.next_in_index=v,r.write=b,-3;d+=c[T+2],d+=m&_[h],T=3*(u+d),h=c[T]}break}if(0!=(64&h))return 0!=(32&h)?(C=l.avail_in-w,C=g>>3<C?g>>3:C,w+=C,v-=C,g-=C<<3,r.bitb=m,r.bitk=g,l.avail_in=w,l.total_in+=v-l.next_in_index,l.next_in_index=v,r.write=b,p):(l.msg="invalid literal/length code",C=l.avail_in-w,C=g>>3<C?g>>3:C,w+=C,v-=C,g-=C<<3,r.bitb=m,r.bitk=g,l.avail_in=w,l.total_in+=v-l.next_in_index,l.next_in_index=v,r.write=b,-3);if(d+=c[T+2],d+=m&_[h],T=3*(u+d),0==(h=c[T])){m>>=c[T+1],g-=c[T+1],r.window[b++]=c[T+2],y--;break}}else m>>=c[T+1],g-=c[T+1],r.window[b++]=c[T+2],y--}while(y>=258&&w>=10);return C=l.avail_in-w,C=g>>3<C?g>>3:C,w+=C,v-=C,g-=C<<3,r.bitb=m,r.bitk=g,l.avail_in=w,l.total_in+=v-l.next_in_index,l.next_in_index=v,r.write=b,f},a.prototype.huft_build=function(e,t,i,n,a,s,r,l,d,c,h){var p,_,g,v,w,b,y,x,k,C,$,S,T,M,E;C=0,w=i;do{this.c[e[t+C]]++,C++,w--}while(0!=w);if(this.c[0]==i)return r[0]=-1,l[0]=0,f;for(x=l[0],b=1;b<=15&&0==this.c[b];b++);for(y=b,x<b&&(x=b),w=15;0!=w&&0==this.c[w];w--);for(g=w,x>w&&(x=w),l[0]=x,M=1<<b;b<w;b++,M<<=1)if((M-=this.c[b])<0)return-3;if((M-=this.c[w])<0)return-3;for(this.c[w]+=M,this.x[1]=b=0,C=1,T=2;0!=--w;)this.x[T]=b+=this.c[C],T++,C++;w=0,C=0;do{0!=(b=e[t+C])&&(this.v[this.x[b]++]=w),C++}while(++w<i);for(i=this.x[g],this.x[0]=w=0,C=0,v=-1,S=-x,this.u[0]=0,$=0,E=0;y<=g;y++)for(p=this.c[y];0!=p--;){for(;y>S+x;){if(v++,S+=x,E=g-S,E=E>x?x:E,(_=1<<(b=y-S))>p+1&&(_-=p+1,T=y,b<E))for(;++b<E&&!((_<<=1)<=this.c[++T]);)_-=this.c[T];if(E=1<<b,this.hn[0]+E>u)return-3;this.u[v]=$=this.hn[0],this.hn[0]+=E,0!=v?(this.x[v]=w,this.r[0]=b,this.r[1]=x,b=w>>>S-x,this.r[2]=$-this.u[v-1]-b,o(this.r,0,d,3*(this.u[v-1]+b),3)):r[0]=$}for(this.r[1]=y-S,C>=i?this.r[0]=192:h[C]<n?(this.r[0]=this.v[C]<256?0:96,this.r[2]=this.v[C++]):(this.r[0]=s[this.v[C]-n]+16+64,this.r[2]=a[this.v[C++]-n]),_=1<<y-S,b=w>>>S;b<E;b+=_)o(this.r,0,d,3*($+b),3);for(b=1<<y-1;0!=(w&b);b>>>=1)w^=b;for(w^=b,k=(1<<S)-1;(w&k)!=this.x[v];)v--,S-=x,k=(1<<S)-1}return 0!=M&&1!=g?m:f},a.prototype.inflate_trees_bits=function(e,t,i,n,a){var s;return this.initWorkArea(19),this.hn[0]=0,s=this.huft_build(e,0,19,19,null,null,i,t,n,this.hn,this.v),-3==s?a.msg="oversubscribed dynamic bit lengths tree":s!=m&&0!=t[0]||(a.msg="incomplete dynamic bit lengths tree",s=-3),s},a.prototype.inflate_trees_dynamic=function(e,t,i,n,a,s,o,r,l){var d;return this.initWorkArea(288),this.hn[0]=0,(d=this.huft_build(i,0,e,257,x,k,s,n,r,this.hn,this.v))!=f||0==n[0]?(-3==d?l.msg="oversubscribed literal/length tree":-4!=d&&(l.msg="incomplete literal/length tree",d=-3),d):(this.initWorkArea(288),d=this.huft_build(i,e,t,0,C,$,o,a,r,this.hn,this.v),d!=f||0==a[0]&&e>257?(-3==d?l.msg="oversubscribed distance tree":d==m?(l.msg="incomplete distance tree",d=-3):-4!=d&&(l.msg="empty distance tree with lengths",d=-3),d):f)},a.prototype.initWorkArea=function(e){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(e),this.c=new Int32Array(16),this.r=new Int32Array(3),this.u=new Int32Array(15),this.x=new Int32Array(16)),this.v.length<e&&(this.v=new Int32Array(e));for(var t=0;t<e;t++)this.v[t]=0;for(var t=0;t<16;t++)this.c[t]=0;for(var t=0;t<3;t++)this.r[t]=0;o(this.c,0,this.u,0,15),o(this.c,0,this.x,0,16)};var M=new Uint8Array(1),E="function"==typeof M.subarray;return{inflateBuffer:d,arrayCopy:o}}.apply(t,n))&&(e.exports=a)},function(e,t,i){(function(n){var a,s,o;!function(n,r){s=[i(0)],a=r,void 0!==(o="function"==typeof a?a.apply(t,s):a)&&(e.exports=o)}(0,function(e){var t=e.ajaxSettings;t.responseFields.native="responseNative",t.converters["* native"]=!0;var i={},a=0,s={0:200,1223:204},o={},r=n.ajaxSettings.xhr();window.ActiveXObject&&e(window).on("unload",function(){for(var e in o)o[e]()}),i.cors=!!r&&"withCredentials"in r,i.ajax=r=!!r,e.ajaxTransport("native",function(e){var t;if(i.cors||r&&!e.crossDomain)return{send:function(i,n){var r,l=e.xhr(),d=++a,c={};if(l.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(r in e.xhrFields)l[r]=e.xhrFields[r];e.mimeType&&l.overrideMimeType&&l.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(r in i)l.setRequestHeader(r,i[r]);t=function(e){return function(){t&&(delete o[d],t=l.onload=l.onerror=null,"abort"===e?l.abort():"error"===e?n(l.status,l.statusText):(l.response&&(c.native=l.response),n(s[l.status]||l.status,l.statusText,c,l.getAllResponseHeaders())))}},l.onload=t(),l.onerror=t("error"),t=o[d]=t("abort");try{l.send(e.hasContent&&e.data||null)}catch(e){if(t)throw e}},abort:function(){t&&t()}}}),e.getNative=function(t,i){return e.ajax({dataType:"native",url:t,xhrFields:{responseType:"arraybuffer"},success:i})}})}).call(t,i(0))},,,function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),o=(a(s),i(1)),r=a(o),l=i(8),d=n(l),c=i(7),u=n(c),h=r.Model.extend(d.default.LoggableMixin).extend({_logNamespace:"user",urlRoot:function(){return Galaxy.root+"api/users"},defaults:{id:null,username:"("+(0,u.default)("anonymous user")+")",email:"",total_disk_usage:0,nice_total_disk_usage:"",quota_percent:null,is_admin:!1},initialize:function(e){this.log("User.initialize:",e),this.on("loaded",function(e,t){this.log(this+" has loaded:",e,t)}),this.on("change",function(e,t){this.log(this+" has changed:",e,t.changes)})},isAnonymous:function(){return!this.get("email")},isAdmin:function(){return this.get("is_admin")},loadFromApi:function(e,t){e=e||h.CURRENT_ID_STR,t=t||{};var i=this,n=t.success;return t.success=function(e,t){i.trigger("loaded",e,t),n&&n(e,t)},e===h.CURRENT_ID_STR&&(t.url=this.urlRoot+"/"+h.CURRENT_ID_STR),r.Model.prototype.fetch.call(this,t)},clearSessionStorage:function(){for(var e in sessionStorage)0===e.indexOf("history:")?sessionStorage.removeItem(e):"history-panel"===e&&sessionStorage.removeItem(e)},toString:function(){var e=[this.get("username")];return this.get("id")&&(e.unshift(this.get("id")),e.push(this.get("email"))),"User("+e.join(":")+")"}});h.CURRENT_ID_STR="current",h.getCurrentUserFromApi=function(e){var t=new h;return t.loadFromApi(h.CURRENT_ID_STR,e),t};r.Collection.extend(d.default.LoggableMixin).extend({model:h,urlRoot:function(){return Galaxy.root+"api/users"}});t.default={User:h}},,function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=(a(s),i(161)),r=a(o),l=i(163),d=a(l),c=i(164),u=a(c),h=e.View.extend({initialize:function(e){var t=this;this.options=e,this.setElement(this._template()),this.$navbarBrandLink=this.$(".navbar-brand-link"),this.$navbarBrandImage=this.$(".navbar-brand-image"),this.$navbarBrandTitle=this.$(".navbar-brand-title"),this.$navbarTabs=this.$(".navbar-tabs"),this.$quoteMeter=this.$(".quota-meter-container"),this.collection=new r.default.Collection,this.collection.on("add",function(e){t.$navbarTabs.append(new r.default.Tab({model:e}).render().$el)}).on("reset",function(){t.$navbarTabs.empty()}).on("dispatch",function(e){t.collection.each(function(t){e(t)})}).fetch(this.options),Galaxy.frame=this.frame=new d.default({collection:this.collection}),Galaxy.quotaMeter=this.quotaMeter=new u.default.UserQuotaMeter({model:Galaxy.user,el:this.$quoteMeter}),n(window).on("click",function(e){var t=n(e.target).closest("a[download]");1==t.length&&(0===n("iframe[id=download]").length&&n("body").append(n("<iframe/>").attr("id","download").hide()),n("iframe[id=download]").attr("src",t.attr("href")),e.preventDefault())}).on("beforeunload",function(){var e="";if(t.collection.each(function(t){var i=t.get("onbeforeunload")&&t.get("onbeforeunload")();i&&(e+=i+" ")}),""!==e)return e})},render:function(){return this.$navbarBrandTitle.html("Galaxy "+(this.options.brand&&"/ "+this.options.brand||"")),this.$navbarBrandLink.attr("href",this.options.logo_url),this.$navbarBrandImage.attr("src",this.options.logo_src),this.quotaMeter.render(),this},_template:function(){return'<div id="masthead" class="navbar navbar-fixed-top navbar-inverse"><div class="navbar-header"><div class="navbar-tabs"/></div><div class="navbar-brand"><a class="navbar-brand-link"><img class="navbar-brand-image"/><span class="navbar-brand-title"/></a></div><div class="quota-meter-container"/><div class="navbar-icons"/></div>'}});t.default={View:h}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a,s){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(162),l=o(r),d=i(40),c=o(d),u=i(7),h=o(u),f=i(3),p=o(f),m=e.Collection.extend({model:e.Model.extend({defaults:{visible:!0,target:"_parent"}}),fetch:function(e){e=e||{},this.reset();var t=new l.default.GenericNavView;this.add(t.render()),this.add({id:"analysis",title:(0,h.default)("Analyze Data"),url:"",tooltip:(0,h.default)("Analysis home view")}),this.add({id:"workflow",title:(0,h.default)("Workflow"),tooltip:(0,h.default)("Chain tools into workflows"),disabled:!Galaxy.user.id,url:"workflows/list"}),this.add({id:"shared",title:(0,h.default)("Shared Data"),url:"library/index",tooltip:(0,h.default)("Access published resources"),menu:[{title:(0,h.default)("Data Libraries"),url:"library/list"},{title:(0,h.default)("Histories"),url:"histories/list_published"},{title:(0,h.default)("Workflows"),url:"workflows/list_published"},{title:(0,h.default)("Visualizations"),url:"visualizations/list_published"},{title:(0,h.default)("Pages"),url:"pages/list_published"}]}),this.add({id:"visualization",title:(0,h.default)("Visualization"),url:"visualizations/list",tooltip:(0,h.default)("Visualize datasets"),disabled:!Galaxy.user.id,menu:[{title:(0,h.default)("New Track Browser"),url:"visualization/trackster",target:"_frame"},{title:(0,h.default)("Saved Visualizations"),url:"visualizations/list",target:"_frame"},{title:(0,h.default)("Interactive Environments"),url:"visualization/gie_list",target:"galaxy_main"}]}),c.default.add({url:"api/webhooks/masthead/all",callback:function(e){n(document).ready(function(){n.each(e.models,function(e,t){var i=t.toJSON();if(i.activate){var n={id:i.name,icon:i.config.icon,url:i.config.url,tooltip:i.config.tooltip,onclick:i.config.function&&new Function(i.config.function)};Galaxy.page?Galaxy.page.masthead.collection.add(n):Galaxy.masthead&&Galaxy.masthead.collection.add(n),p.default.appendScriptStyle(i)}})})}}),Galaxy.user.get("is_admin")&&this.add({id:"admin",title:(0,h.default)("Admin"),url:"admin",tooltip:(0,h.default)("Administer this Galaxy"),cls:"admin-only"});var i={id:"help",title:(0,h.default)("Help"),tooltip:(0,h.default)("Support, contact, and community"),menu:[{title:(0,h.default)("Support"),url:e.support_url,target:"_blank"},{title:(0,h.default)("Search"),url:e.search_url,target:"_blank"},{title:(0,h.default)("Mailing Lists"),url:e.mailing_lists,target:"_blank"},{title:(0,h.default)("Videos"),url:e.screencasts_url,target:"_blank"},{title:(0,h.default)("Wiki"),url:e.wiki_url,target:"_blank"},{title:(0,h.default)("How to Cite Galaxy"),url:e.citation_url,target:"_blank"},{title:(0,h.default)("Interactive Tours"),url:"tours"}]};e.terms_url&&i.menu.push({title:(0,h.default)("Terms and Conditions"),url:e.terms_url,target:"_blank"}),e.biostar_url&&i.menu.unshift({title:(0,h.default)("Ask a question"),url:"biostar/biostar_question_redirect",target:"_blank"}),e.biostar_url&&i.menu.unshift({title:(0,h.default)("Galaxy Biostar"),url:e.biostar_url_redirect,target:"_blank"}),this.add(i);var s={};s=Galaxy.user.id?{id:"user",title:(0,h.default)("User"),cls:"loggedin-only",tooltip:(0,h.default)("Account and saved data"),menu:[{title:(0,h.default)("Logged in as")+" "+Galaxy.user.get("email")},{title:(0,h.default)("Preferences"),url:"user"},{title:(0,h.default)("Custom Builds"),url:"custom_builds"},{title:(0,h.default)("Logout"),url:"user/logout?session_csrf_token="+Galaxy.session_csrf_token,target:"_top",divider:!0},{title:(0,h.default)("Saved Histories"),url:"histories/list",target:"_top"},{title:(0,h.default)("Saved Datasets"),url:"datasets/list",target:"_top"},{title:(0,h.default)("Saved Pages"),url:"pages/list",target:"_top"}]}:e.allow_user_creation?{id:"user",title:(0,h.default)("Login or Register"),cls:"loggedout-only",tooltip:(0,h.default)("Account registration or login"),menu:[{title:(0,h.default)("Login"),url:"user/login",target:"galaxy_main",noscratchbook:!0},{title:(0,h.default)("Register"),url:"user/create",target:"galaxy_main",noscratchbook:!0}]}:{id:"user",title:(0,h.default)("Login"),cls:"loggedout-only",tooltip:(0,h.default)("Login"),url:"user/login",target:"galaxy_main",noscratchbook:!0},this.add(s);var o=this.get(e.active_view);return o&&o.set("active",!0),(new a.Deferred).resolve().promise()}}),_=e.View.extend({initialize:function(e){this.model=e.model,this.setElement(this._template()),this.$dropdown=this.$(".dropdown"),this.$toggle=this.$(".dropdown-toggle"),this.$menu=this.$(".dropdown-menu"),this.$note=this.$(".dropdown-note"),this.listenTo(this.model,"change",this.render,this)},events:{"click .dropdown-toggle":"_toggleClick"},render:function(){var e=this;return n(".tooltip").remove(),this.$el.attr("id",this.model.id).css({visibility:this.model.get("visible")&&"visible"||"hidden"}),this.model.set("url",this._formatUrl(this.model.get("url"))),this.$note.html(this.model.get("note")||"").removeClass().addClass("dropdown-note").addClass(this.model.get("note_cls")).css({display:this.model.get("show_note")&&"block"||"none"}),this.$toggle.html(this.model.get("title")||"").removeClass().addClass("dropdown-toggle").addClass(this.model.get("cls")).addClass(this.model.get("icon")&&"dropdown-icon fa "+this.model.get("icon")).addClass(this.model.get("toggle")&&"toggle").attr("target",this.model.get("target")).attr("href",this.model.get("url")).attr("title",this.model.get("tooltip")).tooltip("destroy"),this.model.get("tooltip")&&this.$toggle.tooltip({placement:"bottom"}),this.$dropdown.removeClass().addClass("dropdown").addClass(this.model.get("disabled")&&"disabled").addClass(this.model.get("active")&&"active"),this.model.get("menu")&&this.model.get("show_menu")?(this.$menu.show(),n("#dd-helper").show().off().on("click",function(){n("#dd-helper").hide(),e.model.set("show_menu",!1)})):(e.$menu.hide(),n("#dd-helper").hide()),this.$menu.empty().removeClass("dropdown-menu"),this.model.get("menu")&&(s.each(this.model.get("menu"),function(t){e.$menu.append(e._buildMenuItem(t)),t.divider&&e.$menu.append(n("<li/>").addClass("divider"))}),e.$menu.addClass("dropdown-menu"),e.$toggle.append(n("<b/>").addClass("caret"))),this},_buildMenuItem:function(e){var t=this;return e=s.defaults(e||{},{title:"",url:"",target:"_parent",noscratchbook:!1}),e.url=t._formatUrl(e.url),n("<li/>").append(n("<a/>").attr("href",e.url).attr("target",e.target).html(e.title).on("click",function(i){i.preventDefault(),t.model.set("show_menu",!1),e.onclick?e.onclick():Galaxy.frame.add(e)}))},_toggleClick:function(e){var t=this,i=this.model;if(e.preventDefault(),n(".tooltip").hide(),i.trigger("dispatch",function(e){i.id!==e.id&&e.get("menu")&&e.set("show_menu",!1)}),i.get("disabled")){var a=function(e,t){return n("<div/>").append(n("<a/>").attr("href",Galaxy.root+t).html(e)).html()};this.$toggle.popover&&this.$toggle.popover("destroy"),this.$toggle.popover({html:!0,placement:"bottom",content:"Please "+a("login","user/login?use_panels=True")+" or "+a("register","user/create?use_panels=True")+" to use this feature."}).popover("show"),setTimeout(function(){t.$toggle.popover("destroy")},5e3)}else i.get("menu")?i.set("show_menu",!0):i.get("onclick")?i.get("onclick")():Galaxy.frame.add(i.attributes)},_formatUrl:function(e){return"string"==typeof e&&-1===e.indexOf("//")&&"/"!=e.charAt(0)?Galaxy.root+e:e},_template:function(){return'<ul class="nav navbar-nav"><li class="dropdown"><a class="dropdown-toggle"/><ul class="dropdown-menu"/><div class="dropdown-note"/></li></ul>'}});t.default={Collection:m,Tab:_}}).call(t,i(1),i(0),i(0),i(2))},function(e,t,i){"use strict";(function(e,n){Object.defineProperty(t,"__esModule",{value:!0});var a=i(9),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=e.View.extend({initialize:function(){this.modal=null},makeModalIframe:function(e){var t=window.Galaxy.config.communication_server_host,i=window.Galaxy.config.communication_server_port,a=escape(window.Galaxy.user.attributes.username),r=escape(window.Galaxy.config.persistent_communication_rooms),l="?username="+a+"&persistent_communication_rooms="+r,d=t+":"+i+l,c=null,u=null,h='<iframe class="f-iframe fade in communication-iframe" src="'+d+'"> </iframe>';return n(".chat-modal").length>0&&n(".chat-modal").remove(),o.modal=new s.default.View({body:h,height:350,width:600,closing_events:!0,title_separator:!1,cls:"ui-modal chat-modal"}),o.modal.show(),c=n(".chat-modal .modal-header"),u=n(".chat-modal .modal-body"),c.addClass("modal-header-body"),u.addClass("modal-header-body"),c.find("h4").remove(),c.removeAttr("min-height padding border"),c.append('<i class="fa fa-comment" aria-hidden="true" title="Communicate with other users"></i><i class="fa fa-expand expand-compress-modal" aria-hidden="true" title="Maximize"></i><i class="fa fa-times close-modal" aria-hidden="true" title="Close"></i>'),n(".close-modal").click(function(e){n(".chat-modal").css("display","none")}),n(".expand-compress-modal").click(function(e){n(".expand-compress-modal").hasClass("fa-expand")?(n(".chat-modal .modal-dialog").width("1000px"),n(".chat-modal .modal-body").height("575px"),n(".expand-compress-modal").removeClass("fa-expand").addClass("fa-compress"),n(".expand-compress-modal").attr("title","Minimize"),n(".expand-compress-modal").css("margin-left","96.2%")):(n(".chat-modal .modal-dialog").width("600px"),n(".chat-modal .modal-body").height("350px"),n(".expand-compress-modal").removeClass("fa-compress").addClass("fa-expand"),n(".expand-compress-modal").attr("title","Maximize"),n(".expand-compress-modal").css("margin-left","93.2%"))}),this},render:function(){var e=this;return{id:"show-chat-online",icon:"fa-comment-o",tooltip:"Chat online",visible:!1,onclick:e.makeModalIframe}}});t.default={GenericNavView:o}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(45),r=s(o),l=i(15),d=s(l),c=i(13),u=s(c),h=i(145),f=s(h),p=i(7),m=s(p);t.default=e.View.extend({initialize:function(e){var t=this;e=e||{},this.frames=new r.default.View({visible:!1}),this.setElement(this.frames.$el),this.buttonActive=e.collection.add({id:"enable-scratchbook",icon:"fa-th",tooltip:(0,m.default)("Enable/Disable Scratchbook"),onclick:function(){t.active=!t.active,t.buttonActive.set({toggle:t.active,show_note:t.active,note_cls:t.active&&"fa fa-check"}),!t.active&&t.frames.hide()},onbeforeunload:function(){if(t.frames.length()>0)return"You opened "+t.frames.length()+" frame(s) which will be lost."}}),this.buttonLoad=e.collection.add({id:"show-scratchbook",icon:"fa-eye",tooltip:(0,m.default)("Show/Hide Scratchbook"),show_note:!0,visible:!1,onclick:function(e){t.frames.visible?t.frames.hide():t.frames.show()}}),this.frames.on("add remove",function(){this.visible&&0==this.length()&&this.hide(),t.buttonLoad.set({note:this.length(),visible:this.length()>0})}).on("show hide ",function(){t.buttonLoad.set({toggle:this.visible,icon:this.visible&&"fa-eye"||"fa-eye-slash"})}),this.history_cache={}},addDataset:function(e){var t=this,i=null;if(Galaxy&&Galaxy.currHistoryPanel){var a=Galaxy.currHistoryPanel.collection.historyId;this.history_cache[a]={name:Galaxy.currHistoryPanel.model.get("name"),dataset_ids:[]},Galaxy.currHistoryPanel.collection.each(function(e){!e.get("deleted")&&e.get("visible")&&t.history_cache[a].dataset_ids.push(e.get("id"))})}var s=function(e,i){if(e){var n=t.history_cache[e.get("history_id")];if(n&&n.dataset_ids){var a=n.dataset_ids,s=a.indexOf(e.get("id"));if(-1!==s&&s+i>=0&&s+i<a.length)return a[s+i]}}},o=function(e,n,a){var o=s(e,n);o?t._loadDataset(o,function(e,t){i=e,a.model.set(t)}):a.model.trigger("change")};this._loadDataset(e,function(e,a){i=e,t.add(n.extend({menu:[{icon:"fa fa-chevron-circle-left",tooltip:"Previous in History",onclick:function(e){o(i,-1,e)},disabled:function(){return!s(i,-1)}},{icon:"fa fa-chevron-circle-right",tooltip:"Next in History",onclick:function(e){o(i,1,e)},disabled:function(){return!s(i,1)}}]},a))})},_loadDataset:function(e,t){var i=this,s=new d.default.Dataset({id:e});a.when(s.fetch()).then(function(){var a=n.find(["tabular","interval"],function(e){return-1!==s.get("data_type").indexOf(e)}),o=s.get("name"),r=i.history_cache[s.get("history_id")];r&&(o=r.name+": "+o),t(s,a?{title:o,url:null,content:d.default.createTabularDatasetChunkedView({model:new d.default.TabularDataset(s.toJSON()),embedded:!0,height:"100%"}).$el}:{title:o,url:Galaxy.root+"datasets/"+e+"/display/?preview=True",content:null})})},addTrackster:function(e){var t=this,i=new u.default.Visualization({id:e});a.when(i.fetch()).then(function(){var e=new f.default.TracksterUI(Galaxy.root),a={title:i.get("name"),type:"other",content:function(t){var a={container:t,name:i.get("title"),id:i.id,dbkey:i.get("dbkey"),stand_alone:!1},s=i.get("latest_revision"),o=s.config.view.drawables;n.each(o,function(e){e.dataset={hda_ldda:e.hda_ldda,id:e.dataset_id}}),view=e.create_visualization(a,s.config.viewport,s.config.view.drawables,s.config.bookmarks,!1)}};t.add(a)})},add:function(e){if("_blank"==e.target)window.open(e.url);else if("_top"==e.target||"_parent"==e.target||"_self"==e.target)window.location=e.url;else if(!this.active||e.noscratchbook){var t=a(window.parent.document).find("#galaxy_main");"galaxy_main"==e.target||"center"==e.target?0===t.length?window.location=e.url+(-1==e.url.indexOf("?")?"?":"&")+"use_panels=True":t.attr("src",e.url):window.location=e.url}else this.frames.add(e)}})}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(8),r=s(o),l=i(7),d=s(l),c=e.View.extend(r.default.LoggableMixin).extend({_logNamespace:"user",options:{warnAtPercent:85,errorAtPercent:100},initialize:function(e){this.log(this+".initialize:",e),n.extend(this.options,e),this.listenTo(this.model,"change:quota_percent change:total_disk_usage",this.render)},update:function(e){return this.log(this+" updating user data...",e),this.model.loadFromApi(this.model.get("id"),e),this},isOverQuota:function(){return null!==this.model.get("quota_percent")&&this.model.get("quota_percent")>=this.options.errorAtPercent},_render_quota:function(){var e=this.model.toJSON(),t=e.quota_percent,i=a(this._templateQuotaMeter(e)),n=i.find(".progress-bar");return this.isOverQuota()?(n.attr("class","progress-bar progress-bar-danger"),i.find(".quota-meter-text").css("color","white"),this.trigger("quota:over",e)):t>=this.options.warnAtPercent?(n.attr("class","progress-bar progress-bar-warning"),this.trigger("quota:under quota:under:approaching",e)):(n.attr("class","progress-bar progress-bar-success"),this.trigger("quota:under quota:under:ok",e)),i},_render_usage:function(){var e=a(this._templateUsage(this.model.toJSON()));return this.log(this+".rendering usage:",e),e},render:function(){var e=null;return this.log(this+".model.quota_percent:",this.model.get("quota_percent")),e=null===this.model.get("quota_percent")||void 0===this.model.get("quota_percent")?this._render_usage():this._render_quota(),this.$el.html(e),this.$el.find(".quota-meter-text").tooltip(),this},_templateQuotaMeter:function(e){return['<div id="quota-meter" class="quota-meter progress">','<div class="progress-bar" style="width: ',e.quota_percent,'%"></div>','<div class="quota-meter-text" data-placement="left" style="top: 6px"',e.nice_total_disk_usage?' title="Using '+e.nice_total_disk_usage+'.  This value is recalculated when you log out.">':">",(0,d.default)("Using")," ",e.quota_percent,"%","</div>","</div>"].join("")},_templateUsage:function(e){return['<div id="quota-meter" class="quota-meter" style="background-color: transparent">','<div class="quota-meter-text" data-placement="left" data-original-title="This value is recalculated when you log out." style="top: 6px; color: white">',e.nice_total_disk_usage?(0,d.default)("Using ")+e.nice_total_disk_usage:"","</div>","</div>"].join("")},toString:function(){return"UserQuotaMeter("+this.model+")"}});t.default={UserQuotaMeter:c}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a){Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=function(e){return e&&e.__esModule?e:{default:e}}(s),r=e.View.extend({optionsDefault:{with_close:!0,title:null,placement:"top",container:"body",body:null},initialize:function(e){this.setElement(this._template()),this.uid=o.default.uid(),this.options=n.defaults(e||{},this.optionsDefault),this.options.container.parent().append(this.el),this.$title=this.$(".popover-title-label"),this.$close=this.$(".popover-close"),this.$body=this.$(".popover-content"),this.options.body&&this.append(this.options.body);var t=this;a("body").on("mousedown."+this.uid,function(e){t.visible&&!a(t.options.container).is(e.target)&&!a(t.el).is(e.target)&&0===a(t.el).has(e.target).length&&t.hide()})},render:function(){this.$title.html(this.options.title),this.$el.removeClass().addClass("ui-popover popover fade in").addClass(this.options.placement),this.$el.css(this._get_placement(this.options.placement));var e=this;this.options.with_close?this.$close.on("click",function(){e.hide()}).show():this.$close.off().hide()},title:function(e){void 0!==e&&(this.options.title=e,this.$title.html(e))},show:function(){this.render(),this.$el.show(),this.visible=!0},hide:function(){this.$el.hide(),this.visible=!1},append:function(e){this.$body.append(e)},empty:function(){this.$body.empty()},remove:function(){a("body").off("mousedown."+this.uid),this.$el.remove()},_get_placement:function(e){var t,i,n=this._get_width(this.$el),a=this.$el.height(),s=this.options.container,o=this._get_width(s),r=this._get_height(s),l=s.position();if(t=i=0,-1!=["top","bottom"].indexOf(e))switch(i=l.left-n+(o+n)/2,e){case"top":t=l.top-a-5;break;case"bottom":t=l.top+r+5}else switch(t=l.top-a+(r+a)/2,e){case"right":i=l.left+o}return{top:t,left:i}},_get_width:function(e){return e.width()+parseInt(e.css("padding-left"))+parseInt(e.css("margin-left"))+parseInt(e.css("padding-right"))+parseInt(e.css("margin-right"))},_get_height:function(e){return e.height()+parseInt(e.css("padding-top"))+parseInt(e.css("padding-bottom"))},_template:function(e){return'<div class="ui-popover popover fade in"><div class="arrow"/><div class="popover-title"><div class="popover-title-label"/><div class="popover-close fa fa-times-circle"/></div><div class="popover-content"/></div>'}});t.default={View:r}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={UPLOAD:"upload",QUEUED:"queued",RUNNING:"running",SETTING_METADATA:"setting_metadata",NEW:"new",EMPTY:"empty",OK:"ok",PAUSED:"paused",FAILED_METADATA:"failed_metadata",NOT_VIEWABLE:"noPermission",DISCARDED:"discarded",ERROR:"error"};n.READY_STATES=[n.OK,n.EMPTY,n.PAUSED,n.FAILED_METADATA,n.NOT_VIEWABLE,n.DISCARDED,n.ERROR],n.NOT_READY_STATES=[n.UPLOAD,n.QUEUED,n.RUNNING,n.SETTING_METADATA,n.NEW],t.default=n},,,,,,,,,function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n),s=a.default,o=function(t){t=t||{},t.tooltipConfig=t.tooltipConfig||{placement:"bottom"},t.classes=["icon-btn"].concat(t.classes||[]),t.disabled&&t.classes.push("disabled");var i=['<a class="',t.classes.join(" "),'"',t.title?' title="'+t.title+'"':"",!t.disabled&&t.target?' target="'+t.target+'"':"",' href="',!t.disabled&&t.href?t.href:"javascript:void(0);",'">','<span class="fa ',t.faIcon,'"></span>',"</a>"].join(""),n=s(i).tooltip(t.tooltipConfig);return e.isFunction(t.onclick)&&n.click(t.onclick),n};t.default=o}).call(t,i(2))},,function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}function s(e,t){return this._init(e||{},t||{})}Object.defineProperty(t,"__esModule",{value:!0});var o=i(2),r=a(o),l=i(1),d=a(l),c=i(8),u=n(c),h=i(158),f=n(h),p=i(178),m=n(p),_=i(59),g=n(_),v=i(7),w=n(v);(0,g.default)(s,"GalaxyApp");var b="galaxy:debug:namespaces",y=!1;try{y="true"==localStorage.getItem("galaxy:debug")}catch(e){console.log((0,w.default)("localStorage not available for debug flag retrieval"))}s.prototype._init=function(e,t){var i=this;return r.extend(i,d.Events),y&&(i.logger=console,console.debug("debugging galaxy:","options:",e,"bootstrapped:",t)),i._processOptions(e),i.root=e.root||"/",i.params=e.params||{},i.session_csrf_token=e.session_csrf_token||null,i._initConfig(e.config||{}),i._patchGalaxy(window.Galaxy),i._initLogger(i.options.loggerOptions||{}),i.debug("GalaxyApp.options: ",i.options),i.debug("GalaxyApp.config: ",i.config),i.debug("GalaxyApp.logger: ",i.logger),i._initLocale(),i.debug("GalaxyApp.localize: ",i.localize),i.config=e.config||{},i.debug("GalaxyApp.config: ",i.config),i._initUser(e.user||{}),i.debug("GalaxyApp.user: ",i.user),i._setUpListeners(),i.trigger("ready",i),i},s.prototype.defaultOptions={patchExisting:!0,root:"/",session_csrf_token:null},s.prototype._processOptions=function(e){var t=this,i=t.defaultOptions;t.options={};for(var n in i)i.hasOwnProperty(n)&&(t.options[n]=e.hasOwnProperty(n)?e[n]:i[n]);return t},s.prototype._initConfig=function(e){var t=this;return t.config=e,t.config.debug=y||t.config.debug,t},s.prototype._patchGalaxy=function(e){var t=this;if(t.options.patchExisting&&e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},s.prototype._initLogger=function(e){var t=this;if(t.config.debug){e.consoleLogger=e.consoleLogger||console,e.consoleLevel=e.consoleLevel||m.default.MetricsLogger.ALL;try{e.consoleNamespaceWhitelist=localStorage.getItem(b).split(",")}catch(e){}try{e.consoleFlattenMessages="true"==localStorage.getItem("galaxy:debug:flatten")}catch(e){}console.log(e.consoleFlattenMessages)}return t.logger=new m.default.MetricsLogger(e),t.emit={},["log","debug","info","warn","error","metric"].map(function(e){t.emit[e]=function(i){t.logger.emit(e,arguments[0],Array.prototype.slice.call(arguments,1))}}),t.config.debug&&(u.default.LoggableMixin.logger=t.logger),t},s.prototype._initLocale=function(e){var t=this;return t.debug("_initLocale:",e),t.localize=w.default,window._l=t.localize,t},s.prototype._initUser=function(e){var t=this;return t.debug("_initUser:",e),t.user=new f.default.User(e),t.user.logger=t.logger,t},s.prototype._setUpListeners=function(){var t=this;return t.lastAjax={},e(document).bind("ajaxSend",function(e,i,n){var a=n.data;try{a=JSON.parse(a)}catch(e){}t.lastAjax={url:location.href.slice(0,-1)+n.url,data:a}}),t},s.prototype.debugging=function(e){var t=this;try{if(void 0===e)return"true"===localStorage.getItem("galaxy:debug");if(e)return localStorage.setItem("galaxy:debug",!0),!0;localStorage.removeItem("galaxy:debug"),t.debuggingNamespaces(null)}catch(e){console.log((0,w.default)("localStorage not available for debug flag retrieval"))}return!1},s.prototype.debuggingNamespaces=function(e){var t=this;try{if(void 0===e){var i=localStorage.getItem(b);return"string"==typeof i?i.split(","):[]}null===e?localStorage.removeItem(b):localStorage.setItem(b,e);var n=t.debuggingNamespaces();return t.logger&&(t.logger.options.consoleNamespaceWhitelist=n),n}catch(e){console.log((0,w.default)("localStorage not available for debug namespace retrieval"))}},s.prototype.toString=function(){return"GalaxyApp("+(this.user?this.user.get("email")||"(anonymous)":"uninitialized")+")"},t.default={GalaxyApp:s}}).call(t,i(0))},function(e,t,i){"use strict";(function(e){function i(e){e=e||{};var t=this;return t.userId=window.bootstrapped&&window.bootstrapped.user?window.bootstrapped.user.id:null,t.userId=t.userId||e.userId||null,t.consoleLogger=e.consoleLogger||null,t._init(e),t}function n(e){var t=String(e);return"[object Object]"==t&&(t=JSON.stringify(e)),t}function a(e){return this._init(e||{})}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};i.ALL=0,i.LOG=0,i.DEBUG=10,i.INFO=20,i.WARN=30,i.ERROR=40,i.METRIC=50,i.NONE=100,i.defaultOptions={logLevel:i.NONE,consoleLevel:i.NONE,defaultNamespace:"Galaxy",consoleNamespaceWhitelist:null,consoleFlattenMessages:!1,clientPrefix:"client.",maxCacheSize:3e3,postSize:1e3,addTime:!0,cacheKeyPrefix:"logs-",postUrl:"/api/metrics",delayPostInMs:6e5,getPingData:void 0,onServerResponse:void 0},i.prototype._init=function(e){var t=this;t.options={};for(var n in i.defaultOptions)i.defaultOptions.hasOwnProperty(n)&&(t.options[n]=e.hasOwnProperty(n)?e[n]:i.defaultOptions[n]);return t.options.logLevel=t._parseLevel(t.options.logLevel),t.options.consoleLevel=t._parseLevel(t.options.consoleLevel),t._sending=!1,t._waiting=null,t._postSize=t.options.postSize,t._initCache(),t},i.prototype._initCache=function(){try{this.cache=new a({maxSize:this.options.maxCacheSize,key:this.options.cacheKeyPrefix+this.userId})}catch(e){this._emitToConsole("warn","MetricsLogger",["Could not intitialize logging cache:",e]),this.options.logLevel=i.NONE}},i.prototype._parseLevel=function(e){var t=void 0===e?"undefined":s(e);if("number"===t)return e;if("string"===t){var n=e.toUpperCase();if(i.hasOwnProperty(n))return i[n]}throw new Error("Unknown log level: "+e)},i.prototype.emit=function(e,t,i){var n=this;return t=t||n.options.defaultNamespace,e&&i?(e=n._parseLevel(e),e>=n.options.logLevel&&n._addToCache(e,t,i),n.consoleLogger&&e>=n.options.consoleLevel&&n._emitToConsole(e,t,i),n):n},i.prototype._addToCache=function(e,t,i){this._emitToConsole("debug","MetricsLogger",["_addToCache:",arguments,this.options.addTime,this.cache.length()]);var n=this;try{n.cache.add(n._buildEntry(e,t,i))>=n._postSize&&n._postCache()}catch(e){n._emitToConsole("warn","MetricsLogger",["Metrics logger could not stringify logArguments:",t,i]),n._emitToConsole("error","MetricsLogger",[e])}return n},i.prototype._buildEntry=function(e,t,i){this._emitToConsole("debug","MetricsLogger",["_buildEntry:",arguments]);var n={level:e,namespace:this.options.clientPrefix+t,args:i};return this.options.addTime&&(n.time=(new Date).toISOString()),n},i.prototype._postCache=function(t){if(t=t||{},this._emitToConsole("info","MetricsLogger",["_postCache",t,this._postSize]),!this.options.postUrl||this._sending)return e.when({});var i=this,n=t.count||i._postSize,a=i.cache.get(n),s=a.length,o="function"==typeof i.options.getPingData?i.options.getPingData():{};return o.metrics=JSON.stringify(a),i._sending=!0,e.post(i.options.postUrl,o).always(function(){i._sending=!1}).fail(function(e,t,n){i._postSize=i.options.maxCacheSize,i.emit("error","MetricsLogger",["_postCache error:",e.readyState,e.status,e.responseJSON||e.responseText])}).done(function(e){"function"==typeof i.options.onServerResponse&&i.options.onServerResponse(e),i.cache.remove(s),i._postSize=i.options.postSize})},i.prototype._delayPost=function(){var e=this;e._waiting=setTimeout(function(){e._waiting=null},e.options.delayPostInMs)},i.prototype._emitToConsole=function(e,t,a){var s=this,o=s.options.consoleNamespaceWhitelist;if(!s.consoleLogger)return s;if(o&&-1===o.indexOf(t))return s;var r=Array.prototype.slice.call(a,0);return r.unshift(t),s.options.consoleFlattenMessages&&(r=[r.map(n).join(" ")]),e>=i.METRIC&&"function"==typeof s.consoleLogger.info?s.consoleLogger.info.apply(s.consoleLogger,r):e>=i.ERROR&&"function"==typeof s.consoleLogger.error?s.consoleLogger.error.apply(s.consoleLogger,r):(e>=i.WARN&&"function"==typeof s.consoleLogger.warn?s.consoleLogger.warn.apply(s.consoleLogger,r):e>=i.INFO&&"function"==typeof s.consoleLogger.info?s.consoleLogger.info.apply(s.consoleLogger,r):e>=i.DEBUG&&"function"==typeof s.consoleLogger.debug?s.consoleLogger.debug.apply(s.consoleLogger,r):"function"==typeof s.consoleLogger.log&&s.consoleLogger.log.apply(s.consoleLogger,r),s)},i.prototype.log=function(){this.emit(1,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.debug=function(){this.emit(i.DEBUG,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.info=function(){this.emit(i.INFO,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.warn=function(){this.emit(i.WARN,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.error=function(){this.emit(i.ERROR,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},i.prototype.metric=function(){this.emit(i.METRIC,this.options.defaultNamespace,Array.prototype.slice.call(arguments,0))},a.defaultOptions={maxSize:5e3},a.prototype._init=function(e){if(!this._hasStorage())throw new Error("LoggingCache needs localStorage");if(!e.key)throw new Error("LoggingCache needs key for localStorage");return this.key=e.key,this._initStorage(),this.maxSize=e.maxSize||a.defaultOptions.maxSize,this},a.prototype._hasStorage=function(){try{return localStorage.setItem("test","test"),localStorage.removeItem("test"),!0}catch(e){return!1}},a.prototype._initStorage=function(){return null===localStorage.getItem(this.key)?this.empty():this},a.prototype.add=function(e){var t=this,i=t._fetchAndParse(),n=i.length+1-t.maxSize;return n>0&&i.splice(0,n),i.push(e),t._unparseAndStore(i),i.length},a.prototype._fetchAndParse=function(){var e=this;return JSON.parse(localStorage.getItem(e.key))},a.prototype._unparseAndStore=function(e){var t=this;return localStorage.setItem(t.key,JSON.stringify(e))},a.prototype.length=function(){return this._fetchAndParse().length},a.prototype.get=function(e){return this._fetchAndParse().slice(0,e)},a.prototype.remove=function(e){var t=this._fetchAndParse(),i=t.splice(0,e);return this._unparseAndStore(t),i},a.prototype.empty=function(){return localStorage.setItem(this.key,"[]"),this},a.prototype.stringify=function(e){return JSON.stringify(this.get(e))},a.prototype.print=function(){console.log(JSON.stringify(this._fetchAndParse(),null,"  "))},t.default={MetricsLogger:i,LoggingCache:a}}).call(t,i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(160),r=s(o),l=i(176),d=s(l),c=i(9),u=s(c),h=i(3),f=s(h),p=e.View.extend({el:"body",className:"full-content",_panelids:["left","right"],initialize:function(t){var i=this;this.config=n.defaults(t.config||{},{message_box_visible:!1,message_box_content:"",message_box_class:"info",show_inactivity_warning:!1,inactivity_box_content:""}),Galaxy.modal=this.modal=new u.default.View,Galaxy.display=this.display=function(e){e.title?(f.default.setWindowTitle(e.title),e.allow_title_display=!1):(f.default.setWindowTitle(),e.allow_title_display=!0),i.center.display(e)},Galaxy.router=this.router=t.Router&&new t.Router(i,t),this.masthead=new r.default.View(this.config),this.center=new d.default.CenterPanel,this.$el.attr("scroll","no"),this.$el.html(this._template()),this.$("#masthead").replaceWith(this.masthead.$el),this.$("#center").append(this.center.$el),this.$el.append(this.masthead.frame.$el),this.$el.append(this.modal.$el),this.$messagebox=this.$("#messagebox"),this.$inactivebox=this.$("#inactivebox"),this.panels={},n.each(this._panelids,function(e){var n=e.charAt(0).toUpperCase()+e.slice(1),a=t[n];if(a){var s=new a(i,t);i[s.toString()]=s,i.panels[e]=new d.default.SidePanel({id:e,el:i.$("#"+e),view:s})}}),this.render(),this.router&&e.history.start({root:Galaxy.root,pushState:!0})},render:function(){return a(".select2-hidden-accessible").remove(),this.masthead.render(),this.renderMessageBox(),this.renderInactivityBox(),this.renderPanels(),this._checkCommunicationServerOnline(),this},renderMessageBox:function(){if(this.config.message_box_visible){var e=this.config.message_box_content||"",t=this.config.message_box_class||"info";this.$el.addClass("has-message-box"),this.$messagebox.attr("class","panel-"+t+"-message").html(e).toggle(!!e).show()}else this.$el.removeClass("has-message-box"),this.$messagebox.hide();return this},renderInactivityBox:function(){if(this.config.show_inactivity_warning){var e=this.config.inactivity_box_content||"",t=a("<a/>").attr("href",Galaxy.root+"user/resend_verification").text("Resend verification");this.$el.addClass("has-inactivity-box"),this.$inactivebox.html(e+" ").append(t).toggle(!!e).show()}else this.$el.removeClass("has-inactivity-box"),this.$inactivebox.hide();return this},renderPanels:function(){var e=this;return n.each(this._panelids,function(t){var i=e.panels[t];i?i.render():(e.$("#center").css(t,0),e.$("#"+t).hide())}),this},_template:function(){return['<div id="everything">','<div id="background"/>','<div id="masthead"/>','<div id="messagebox"/>','<div id="inactivebox" class="panel-warning-message" />','<div id="left" />','<div id="center" />','<div id="right" />',"</div>",'<div id="dd-helper" />'].join("")},toString:function(){return"PageLayoutView"},_checkCommunicationServerOnline:function(){var e=window.Galaxy.config.communication_server_host,t=window.Galaxy.config.communication_server_port,i=window.Galaxy.user.attributes.preferences,n=a("#show-chat-online");i&&-1!=["1","true"].indexOf(i.communication_server)?a.ajax({url:e+":"+t}).success(function(e){null!==window.Galaxy.user.id&&"hidden"===n.css("visibility")&&n.css("visibility","visible")}).error(function(e){n.css("visibility","hidden")}):n.css("visibility","hidden")}});t.default={View:p}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i=e.Model.extend({defaults:{extension:"auto",genome:"?",url_paste:"",status:"init",info:null,file_name:"",file_mode:"",file_size:0,file_type:null,file_path:"",file_data:null,percentage:0,space_to_tab:!1,to_posix_lines:!0,enabled:!0},reset:function(e){this.clear().set(this.defaults).set(e)}}),n=e.Collection.extend({model:i});t.default={Model:i,Collection:n}}).call(t,i(1))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(8),o=a(s),r=i(7),l=a(r),d=e.View.extend(o.default.LoggableMixin).extend(o.default.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"tags-display",select_width:"100%",events:{},initialize:function(e){this.show_editor=!1,!1===e.usePrompt?this.label="":this.label='<label class="prompt">'+(0,l.default)("Tags")+"</label>",this.workflow_mode=e.workflow_mode||!1,this.workflow_mode&&(this.events.click="showEditor",this.events.keydown="keydownHandler"),this.hiddenUntilActivated(e.$activator,e)},render:function(){var e=this;return this.workflow_mode?this.$el.html(this._workflowTemplate()):this.$el.html(this._defaultTemplate()),this.$input().select2({placeholder:"Add tags",width:this.workflow_mode?this.width:this.select_width,tags:function(){return e._getTagsUsed()}}),this._setUpBehaviors(),this},_hashToName:function(e){return e.startsWith("#")?"name:"+e.slice(1):e},_nameToHash:function(e){return e.startsWith("name:")&&(e="#"+e.slice(5)),e},_defaultTemplate:function(){return[this.label,this._renderEditor()].join("")},_workflowTemplate:function(){return[this.show_editor?this._renderEditor():this._renderTags()].join(" ")},keydownHandler:function(e){switch(e.which){case 27:this.hideEditor()}},showEditor:function(){this.show_editor=!0,this.render()},hideEditor:function(){this.show_editor=!1,this.render()},_renderEditor:function(){return'<input class="tags-input" value="'+this.tagsToCSV()+'"/>'},_renderTags:function(){var e=this.model.get("tags"),t=Galaxy.root+"static/images/fugue/tag--plus.png",i=[];return n.each(e,function(e){e=0==e.indexOf("name:")?e.slice(5):e;var t='<span class="label label-info">'+e+"</span>";i.push(t)}),0===i.length&&i.push("<img src="+t+' class="add-tag-button" title="Add tags"/>'),i.join(" ")},tagsToCSV:function(){var e=this,t=this.model.get("tags");return!n.isArray(t)||n.isEmpty(t)?"":t.map(function(t){return n.escape(e._nameToHash(t))}).sort().join(",")},$input:function(){return this.$el.find("input.tags-input")},_getTagsUsed:function(){var e=this;return n.map(Galaxy.user.get("tags_used"),e._nameToHash)},_setUpBehaviors:function(){var e=this;this.$input().on("change",function(t){t.val=n.map(t.val,e._hashToName),e.model.save({tags:t.val}),t.added&&e._addNewTagToTagsUsed(""+t.added.text)})},_addNewTagToTagsUsed:function(e){var t=Galaxy.user.get("tags_used");n.contains(t,e)||(t.push(e),t.sort(),Galaxy.user.set("tags_used",t))},remove:function(){this.$input.off(),this.stopListening(this.model),e.View.prototype.remove.call(this)},toString:function(){return["TagsEditor(",""+this.model,")"].join("")}});t.default={TagsEditor:d}}).call(t,i(1),i(2))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=n(a),o=i(58),r=n(o),l=i(4),d=n(l),c=s.default,u=e.Router.extend({initialize:function(e,t){this.page=e,this.options=t},push:function(e,t){t=t||{},t.__identifer=Math.random().toString(36).substr(2),c.isEmptyObject(t)||(e+=-1==e.indexOf("?")?"?":"&",e+=c.param(t,!0)),Galaxy.params=t,this.navigate(e,{trigger:!0})},execute:function(e,t,i){Galaxy.debug("router execute:",e,t,i);var n=r.default.parse(t.pop());t.push(n),e&&(this.authenticate(t,i)?e.apply(this,t):this.access_denied())},authenticate:function(e,t){return!0},access_denied:function(){this.page.display(new d.default.Message({status:"danger",message:"You must be logged in with proper credentials to make this request.",persistent:!0}))}});t.default=u}).call(t,i(1))},function(e,t,i){"use strict";(function(e,n,a){Object.defineProperty(t,"__esModule",{value:!0});var s=i(3);!function(e){e&&e.__esModule}(s);t.default=e.View.extend({options:{class_check:"fa-check-square-o",class_uncheck:"fa-square-o",parameters:[{id:"space_to_tab",title:"Convert spaces to tabs"},{id:"to_posix_lines",title:"Use POSIX standard"}]},initialize:function(e){this.model=e.model,this.setElement(n("<div/>").addClass("upload-settings")),this.$el.append(n("<div/>").addClass("upload-settings-cover")),this.$el.append(n("<table/>").addClass("upload-settings-table ui-table-striped").append("<tbody/>")),this.$cover=this.$(".upload-settings-cover"),this.$table=this.$(".upload-settings-table > tbody"),this.listenTo(this.model,"change",this.render,this),this.model.trigger("change")},render:function(){var e=this;this.$table.empty(),a.each(this.options.parameters,function(t){var i=n("<div/>").addClass("upload-"+t.id+" upload-icon-button fa").addClass(e.model.get(t.id)&&e.options.class_check||e.options.class_uncheck).on("click",function(){e.model.get("enabled")&&e.model.set(t.id,!e.model.get(t.id))});e.$table.append(n("<tr/>").append(n("<td/>").append(i)).append(n("<td/>").append(t.title)))}),this.$cover[this.model.get("enabled")&&"hide"||"show"]()}})}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a){Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=function(e){return e&&e.__esModule?e:{default:e}}(s);t.default=e.View.extend({initialize:function(t){this.model=new e.Model({cls:"upload-ftp",class_add:"upload-icon-button fa fa-square-o",class_remove:"upload-icon-button fa fa-check-square-o",class_partial:"upload-icon-button fa fa-minus-square-o",help_enabled:!0,help_text:"This Galaxy server allows you to upload files via FTP. To upload some files, log in to the FTP server at <strong>"+t.ftp_upload_site+"</strong> using your Galaxy credentials.",collection:null,onchange:function(){},onadd:function(){},onremove:function(){}}).set(t),this.collection=this.model.get("collection"),this.setElement(this._template()),this.$content=this.$(".upload-ftp-content"),this.$wait=this.$(".upload-ftp-wait"),this.$help=this.$(".upload-ftp-help"),this.$number=this.$(".upload-ftp-number"),this.$disk=this.$(".upload-ftp-disk"),this.$body=this.$(".upload-ftp-body"),this.$warning=this.$(".upload-ftp-warning"),this.$select=this.$(".upload-ftp-select-all"),this.render()},render:function(){var e=this;this.$wait.show(),this.$content.hide(),this.$warning.hide(),this.$help.hide(),n.ajax({url:Galaxy.root+"api/remote_files",method:"GET",success:function(t){e.model.set("ftp_files",t),e._index(),e._renderTable()},error:function(){e._renderTable()}})},_renderTable:function(){var e=this,t=this.model.get("ftp_files");if(this.rows=[],t&&t.length>0){this.$body.empty();var i=0;a.each(t,function(t){e.rows.push(e._renderRow(t)),i+=t.size}),this.$number.html(t.length+" files"),this.$disk.html(o.default.bytesToString(i,!0)),this.collection&&(this.$("._has_collection").show(),this.$select.addClass(this.model.get("class_add")).off().on("click",function(){e._all()}),this._refresh()),this.$content.show()}else this.$warning.show();this.model.get("help_enabled")&&this.$help.show(),this.$wait.hide()},_renderRow:function(e){var t=this,i=this.model.attributes,a=n(this._templateRow(e)),s=a.find(".icon");if(this.$body.append(a),this.collection){var o=this.ftp_index[e.path];s.addClass(void 0===o?i.class_add:i.class_remove),a.on("click",function(){t._switch(s,e),t._refresh()})}else a.on("click",function(){i.onchange(e)});return s},_index:function(){var e=this;this.ftp_index={},this.collection&&this.collection.each(function(t){"ftp"==t.get("file_mode")&&(e.ftp_index[t.get("file_path")]=t.id)})},_all:function(){var e=this.model.attributes,t=this.model.get("ftp_files"),i=this.$select.hasClass(e.class_add);for(var n in t){var a=t[n],s=this.ftp_index[a.path];(void 0===s&&i||void 0!==s&&!i)&&this._switch(this.rows[n],a)}this._refresh()},_switch:function(e,t){e.removeClass();var i=this.model.attributes,n=this.ftp_index[t.path];if(void 0===n){var a=i.onadd(t);e.addClass(i.class_remove),this.ftp_index[t.path]=a}else i.onremove(n),e.addClass(i.class_add),this.ftp_index[t.path]=void 0},_refresh:function(){var e=a.reduce(this.ftp_index,function(e,t){return void 0!==t&&e++,e},0);this.$select.removeClass(),0==e?this.$select.addClass(this.model.get("class_add")):this.$select.addClass(e==this.rows.length?this.model.get("class_remove"):this.model.get("class_partial"))},_templateRow:function(e){return'<tr class="upload-ftp-row"><td class="_has_collection" style="display: none;"><div class="icon"/></td><td class="ftp-name">'+a.escape(e.path)+'</td><td class="ftp-size">'+o.default.bytesToString(e.size)+'</td><td class="ftp-time">'+e.ctime+"</td></tr>"},_template:function(){return'<div class="'+this.model.get("cls")+'"><div class="upload-ftp-wait fa fa-spinner fa-spin"/><div class="upload-ftp-help">'+this.model.get("help_text")+'</div><div class="upload-ftp-content"><span style="whitespace: nowrap; float: left;">Available files: </span><span style="whitespace: nowrap; float: right;"><span class="upload-icon fa fa-file-text-o"/><span class="upload-ftp-number"/>&nbsp;&nbsp;<span class="upload-icon fa fa-hdd-o"/><span class="upload-ftp-disk"/></span><table class="grid" style="float: left;"><thead><tr><th class="_has_collection" style="display: none;"><div class="upload-ftp-select-all"></th><th>Name</th><th>Size</th><th>Created</th></tr></thead><tbody class="upload-ftp-body"/></table></div><div class="upload-ftp-warning warningmessage">Your FTP directory does not contain any files.</div>'}})}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=(a(s),i(165)),r=a(o);t.default=e.View.extend({initialize:function(t){this.model=new e.Model(t),this.setElement("<div/>"),this.render()},render:function(){var e=this.model.attributes,t=n.findWhere(e.list,{id:e.extension});this.extension_popup&&this.extension_popup.remove(),this.extension_popup=new r.default.View({placement:e.placement||"bottom",container:e.$el}),this.extension_popup.title(e.title),this.extension_popup.empty(),this.extension_popup.append(this._templateDescription(t)),this.extension_popup.show()},_templateDescription:function(e){if(e.description){var t=e.description;return e.description_url&&(t+='&nbsp;(<a href="'+e.description_url+'" target="_blank">read more</a>)'),t}return"There is no description available for this file extension."}})}).call(t,i(1),i(2))},function(e,t,i){"use strict";(function(e,t){!function(i){e.event.props.push("dataTransfer"),i.uploadpost=function(t){var n=i.extend({},{data:{},success:function(){},error:function(){},progress:function(){},url:null,maxfilesize:2048,error_filesize:"File exceeds 2GB. Please use a FTP client.",error_default:"Please make sure the file is available.",error_server:"Upload request failed.",error_login:"Uploads require you to log in."},t),a=n.data;if(a.error_message)return void n.error(a.error_message);var s=new FormData;for(var o in a.payload)s.append(o,a.payload[o]);var r=0;for(var o in a.files){var l=a.files[o];s.append(l.name,l.file,l.file.name),r+=l.file.size}if(r>1048576*n.maxfilesize)return void n.error(n.error_filesize);var d=new XMLHttpRequest;d.open("POST",n.url,!0),d.setRequestHeader("Accept","application/json"),d.setRequestHeader("Cache-Control","no-cache"),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.onreadystatechange=function(){if(d.readyState==d.DONE){var t=null,i="";if(d.responseText)try{t=e.parseJSON(d.responseText),i=t.err_msg}catch(e){t=d.responseText,i=t}if(d.status<200||d.status>299){var a=d.statusText;403==d.status?a=n.error_login:0==d.status?a=n.error_server:a||(a=n.error_default),n.error(a+" ("+d.status+"). "+i)}else n.success(t)}},d.upload.addEventListener("progress",function(e){e.lengthComputable&&n.progress(Math.round(100*e.loaded/e.total))},!1),Galaxy.emit.debug("uploadbox::uploadpost()","Posting following data.",n),d.send(s)},i.fn.uploadinput=function(e){var t=this,n=i.extend({},{ondragover:function(){},ondragleave:function(){},onchange:function(){},multiple:!1},e),a=i('<input type="file" style="display: none" '+(n.multiple&&"multiple"||"")+"/>");return t.append(a.change(function(e){n.onchange(e.target.files),i(this).val("")})),t.on("drop",function(e){n.ondragleave(e),e.dataTransfer&&(n.onchange(e.dataTransfer.files),e.preventDefault())}),t.on("dragover",function(e){e.preventDefault(),n.ondragover(e)}),t.on("dragleave",function(e){e.stopPropagation(),n.ondragleave(e)}),{dialog:function(){a.trigger("click")}}},i.fn.uploadbox=function(e){function n(e){if(e&&e.length&&!_){var i=void 0;return t.each(e,function(e,i){"new"!==e.mode&&t.filter(f,function(t){return t.name===e.name&&t.size===e.size}).length&&(e.duplicate=!0)}),t.each(e,function(e){e.duplicate||(i=String(p++),f[i]=e,h.announce(i,f[i]),m++)}),i}}function a(e){f[e]&&(delete f[e],m--)}function s(){if(0==m||g)return g=!1,_=!1,void h.complete();_=!0;var e=-1;for(var t in f){e=t;break}f[e];a(e),i.uploadpost({url:h.url,data:h.initialize(e),success:function(t){h.success(e,t),s()},error:function(t){h.error(e,t),s()},progress:function(t){h.progress(e,t)}})}function o(){v.dialog()}function r(e){for(e in f)a(e)}function l(){_||(_=!0,s())}function d(){g=!0}function c(e){return h=i.extend({},h,e)}function u(){return window.File&&window.FormData&&window.XMLHttpRequest&&window.FileList}var h=i.extend({},{dragover:function(){},dragleave:function(){},announce:function(e){},initialize:function(e){},progress:function(e,t){},success:function(e,t){},error:function(e,t){alert(t)},complete:function(){}},e),f={},p=0,m=0,_=!1,g=!1,v=i(this).uploadinput({multiple:!0,onchange:function(e){n(e)},ondragover:e.ondragover,ondragleave:e.ondragleave});return{select:o,add:n,remove:a,start:l,stop:d,reset:r,configure:c,compatible:u}}}(e)}).call(t,i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a,s){function o(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var i=e.toJSON();return C(i,{defaultHideSourceItems:t,creationFn:function(t,i,n){return t=t.map(function(e){return{id:e.id,name:e.name,src:"dataset"===e.history_content_type?"hda":"hdca"}}),e.createHDCA(t,"list",i,n)}})}Object.defineProperty(t,"__esModule",{value:!0});var l=i(188),d=o(l),c=i(166),u=o(c),h=i(8),f=o(h),p=i(207),m=o(p),_=i(9),g=o(_),v=i(208),w=(o(v),i(7)),b=o(w);i(209);var y=e.View.extend(f.default.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"collection-element",initialize:function(e){this.element=e.element||{},this.selected=e.selected||!1},render:function(){this.dragStartHandler=n.bind(this._dragstart,this),this.dragEndHandler=n.bind(this._dragend,this);var e=this.$el.attr("data-element-id",this.element.id).attr("draggable",!0).html(this.template({element:this.element})).get(0);return e.addEventListener("dragstart",this.dragStartHandler,!1),e.addEventListener("dragend",this.dragEndHandler,!1),this.selected&&this.$el.addClass("selected"),this},template:n.template(['<a class="name" title="',(0,b.default)("Click to rename"),'" href="javascript:void(0)">',"<%- element.name %>","</a>",'<button class="discard btn btn-sm" title="',(0,b.default)("Remove this dataset from the list"),'">',(0,b.default)("Discard"),"</button>"].join("")),select:function(e){this.$el.toggleClass("selected",e),this.trigger("select",{source:this,selected:this.$el.hasClass("selected")})},discard:function(){var e=this,t=this.$el.parent().width();this.$el.animate({"margin-right":t},"fast",function(){e.trigger("discard",{source:e}),e.destroy()})},destroy:function(){this.off(),this.$el.remove()},events:{click:"_click","click .name":"_clickName","click .discard":"_clickDiscard",dragover:"_sendToParent",drop:"_sendToParent"},_click:function(e){e.stopPropagation(),this.select(e)},_clickName:function(e){e.stopPropagation(),e.preventDefault();var t=([(0,b.default)("Enter a new name for the element"),":\n(",(0,b.default)("Note that changing the name here will not rename the dataset"),")"].join(""),prompt((0,b.default)("Enter a new name for the element")+":",this.element.name));t&&(this.element.name=t,this.render())},_clickDiscard:function(e){e.stopPropagation(),this.discard()},_dragstart:function(e){e.originalEvent&&(e=e.originalEvent),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify(this.element)),this.$el.addClass("dragging"),this.$el.parent().trigger("collection-element.dragstart",[this])},_dragend:function(e){this.$el.removeClass("dragging"),this.$el.parent().trigger("collection-element.dragend",[this])},_sendToParent:function(e){this.$el.parent().trigger(e)},toString:function(){return"DatasetCollectionElementView()"}}),x=e.View.extend(f.default.LoggableMixin).extend(m.default.CollectionCreatorMixin).extend({_logNamespace:"collections",elementViewClass:y,collectionClass:d.default.HistoryListDatasetCollection,className:"list-collection-creator collection-creator flex-row-container",minElements:1,defaultAttributes:{creationFn:function(){throw new TypeError("no creation fn for creator")},oncreate:function(){},oncancel:function(){},autoscrollDist:24,highlightClr:"rgba( 64, 255, 255, 1.0 )"},footerSettings:{".hide-originals":"hideOriginals"},initialize:function(e){this.metric("ListCollectionCreator.initialize",e);var t=this;n.each(this.defaultAttributes,function(i,n){i=e[n]||i,t[n]=i}),t.initialElements=e.elements||[],this._setUpCommonSettings(e),this._instanceSetUp(),this._elementsSetUp(),this._setUpBehaviors()},_instanceSetUp:function(){this.selectedIds={},this.$dragging=null,this.blocking=!1},_elementsSetUp:function(){this.invalidElements=[],this.workingElements=[],this.elementViews=[],this.workingElements=this.initialElements.slice(0),this._ensureElementIds(),this._validateElements(),this._mangleDuplicateNames(),this._sortElements()},_ensureElementIds:function(){return this.workingElements.forEach(function(e){e.hasOwnProperty("id")||(e.id=n.uniqueId())}),this.workingElements},_validateElements:function(){var e=this;return e.invalidElements=[],this.workingElements=this.workingElements.filter(function(t){var i=e._isElementInvalid(t);return i&&e.invalidElements.push({element:t,text:i}),!i}),this.workingElements},_isElementInvalid:function(e){return"dataset"!==e.history_content_type?(0,b.default)("is not a dataset"):e.state===u.default.OK||n.contains(u.default.NOT_READY_STATES,e.state)?e.deleted||e.purged?(0,b.default)("has been deleted or purged"):null:(0,b.default)("has errored, is paused, or is not accessible")},_mangleDuplicateNames:function(){var e=1,t={};this.workingElements.forEach(function(i){for(var n=i.name;t.hasOwnProperty(n);)if(n=i.name+" ("+e+")",(e+=1)>=900)throw new Error("Safety hit in while loop - thats impressive");i.name=n,t[i.name]=!0})},_sortElements:function(e){},render:function(e,t){return this.workingElements.length<this.minElements?this._renderInvalid(e,t):(this.$el.empty().html(this.templates.main()),this._renderHeader(e),this._renderMiddle(e),this._renderFooter(e),this._addPluginComponents(),this.$(".collection-name").focus(),this.trigger("rendered",this),this)},_renderInvalid:function(e,t){return this.$el.empty().html(this.templates.invalidInitial({problems:this.invalidElements,elements:this.workingElements})),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),this.trigger("rendered",this),this},_renderHeader:function(e,t){var i=this.$(".header").empty().html(this.templates.header()).find(".help-content").prepend(a(this.templates.helpContent()));return this.invalidElements.length&&this._invalidElementsAlert(),i},_renderMiddle:function(e,t){var i=this.$(".middle").empty().html(this.templates.middle());return this._renderList(e),i},_addPluginComponents:function(){this.$(".help-content i").hoverhighlight(".collection-creator",this.highlightClr)},_invalidElementsAlert:function(){this._showAlert(this.templates.invalidElements({problems:this.invalidElements}),"alert-warning")},_disableNameAndCreate:function(e){(e=!!n.isUndefined(e)||e)&&(this.$(".collection-name").prop("disabled",!0),this.$(".create-collection").toggleClass("disabled",!0))},$list:function(){return this.$(".collection-elements")},_renderClearSelected:function(){n.size(this.selectedIds)?this.$(".collection-elements-controls > .clear-selected").show():this.$(".collection-elements-controls > .clear-selected").hide()},_renderList:function(e,t){var i=this,a=s("<div/>"),o=i.$list();n.each(this.elementViews,function(e){e.destroy(),i.removeElementView(e)}),i.workingElements.forEach(function(e){var t=i._createElementView(e);a.append(t.$el)}),i._renderClearSelected(),o.empty().append(a.children()),n.invoke(i.elementViews,"render"),o.height()>o.css("max-height")?o.css("border-width","1px 0px 1px 0px"):o.css("border-width","0px")},_createElementView:function(e){var t=new this.elementViewClass({element:e,selected:n.has(this.selectedIds,e.id)});return this.elementViews.push(t),this._listenToElementView(t),t},_listenToElementView:function(e){var t=this;t.listenTo(e,{select:function(e){var i=e.source.element;e.selected?t.selectedIds[i.id]=!0:delete t.selectedIds[i.id],t.trigger("elements:select",e)},discard:function(e){t.trigger("elements:discard",e)}})},addElementView:function(e){},removeElementView:function(e){delete this.selectedIds[e.element.id],this._renderClearSelected(),this.elementViews=n.without(this.elementViews,e),this.stopListening(e)},_renderNoElementsLeft:function(){this._disableNameAndCreate(!0),this.$(".collection-elements").append(this.templates.noElementsLeft())},_elementToJSON:function(e){return e},createList:function(e){if(!this.workingElements.length){var t=(0,b.default)("No valid elements for final list")+". ";return t+='<a class="cancel-create" href="javascript:void(0);">'+(0,b.default)("Cancel")+"</a> ",t+=(0,b.default)("or"),t+=' <a class="reset" href="javascript:void(0);">'+(0,b.default)("start over")+"</a>.",void this._showAlert(t)}var i=this,n=this.workingElements.map(function(e){return i._elementToJSON(e)});return i.blocking=!0,i.creationFn(n,e,i.hideOriginals).always(function(){i.blocking=!1}).fail(function(e,t,n){i.trigger("error",{xhr:e,status:t,message:(0,b.default)("An error occurred while creating this collection")})}).done(function(e,t,n){i.trigger("collection:created",e,t,n),i.metric("collection:created",e),"function"==typeof i.oncreate&&i.oncreate.call(this,e,t,n)})},_setUpBehaviors:function(){return this.on("error",this._errorHandler),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("elements:select",function(e){this._renderClearSelected()}),this.on("elements:discard",function(e){var t=e.source.element;this.removeElementView(e.source),this.workingElements=n.without(this.workingElements,t),this.workingElements.length||this._renderNoElementsLeft()}),this},_errorHandler:function(e){this.error(e);var t=this,i=e.message||(0,b.default)("An error occurred");if(e.xhr){var n=e.xhr,a=e.message;0===n.readyState&&0===n.status?i+=": "+(0,b.default)("Galaxy could not be reached and may be updating.")+(0,b.default)(" Try again in a few minutes."):n.responseJSON?i+=":<br /><pre>"+JSON.stringify(n.responseJSON)+"</pre>":i+=": "+a}t._showAlert(i,"alert-danger")},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .main-help":"_toggleHelp","click .header .alert button":"_hideAlert","click .reset":"reset","click .clear-selected":"clearSelectedElements","click .collection-elements":"clearSelectedElements","dragover .collection-elements":"_dragoverElements","drop .collection-elements":"_dropElements","collection-element.dragstart .collection-elements":"_elementDragstart","collection-element.dragend   .collection-elements":"_elementDragend","change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","change .hide-originals":"_changeHideOriginals","click .cancel-create":"_cancelCreate","click .create-collection":"_clickCreate"},reset:function(){this._instanceSetUp(),this._elementsSetUp(),this.render()},clearSelectedElements:function(e){this.$(".collection-elements .collection-element").removeClass("selected"),this.$(".collection-elements-controls > .clear-selected").hide()},_dragoverElements:function(e){e.preventDefault();var t=this.$list();this._checkForAutoscroll(t,e.originalEvent.clientY);var i=this._getNearestElement(e.originalEvent.clientY);this.$(".element-drop-placeholder").remove();var n=a('<div class="element-drop-placeholder"></div>');i.length?i.before(n):t.append(n)},_checkForAutoscroll:function(e,t){var i=e.offset(),n=e.scrollTop(),a=t-i.top,s=i.top+e.outerHeight()-t;a>=0&&a<this.autoscrollDist?e.scrollTop(n-2):s>=0&&s<this.autoscrollDist&&e.scrollTop(n+2)},_getNearestElement:function(e){for(var t=this.$(".collection-elements li.collection-element").toArray(),i=0;i<t.length;i++){var n=a(t[i]),s=n.offset().top,o=Math.floor(n.outerHeight()/2)+4;if(s+o>e&&s-o<e)return n}return a()},_dropElements:function(e){e.originalEvent&&(e=e.originalEvent),e.preventDefault(),e.dataTransfer.dropEffect="move";var t=this._getNearestElement(e.clientY);return t.length?this.$dragging.insertBefore(t):this.$dragging.insertAfter(this.$(".collection-elements .collection-element").last()),this._syncOrderToDom(),!1},_syncOrderToDom:function(){var e=this,t=[];this.$(".collection-elements .collection-element").each(function(){var i=a(this).attr("data-element-id"),s=n.findWhere(e.workingElements,{id:i});s?t.push(s):console.error("missing element: ",i)}),this.workingElements=t,this._renderList()},_elementDragstart:function(e,t){t.select(!0),this.$dragging=this.$(".collection-elements .collection-element.selected")},_elementDragend:function(e,t){a(".element-drop-placeholder").remove(),this.$dragging=null},templates:n.extend({},m.default.CollectionCreatorMixin._creatorTemplates,{header:n.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',(0,b.default)("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',(0,b.default)("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" ','title="',(0,b.default)("Close and show more help"),'" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>"].join("")),middle:n.template(['<div class="collection-elements-controls">','<a class="reset" href="javascript:void(0);" ','title="',(0,b.default)("Undo all reordering and discards"),'">',(0,b.default)("Start over"),"</a>",'<a class="clear-selected" href="javascript:void(0);" ','title="',(0,b.default)("De-select all selected datasets"),'">',(0,b.default)("Clear selected"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),footer:n.template(['<div class="attributes clear">','<div class="clear">','<label class="setting-prompt pull-right">',(0,b.default)("Hide original elements"),"?",'<input class="hide-originals pull-right" type="checkbox" />',"</label>","</div>",'<div class="clear">','<input class="collection-name form-control pull-right" ','placeholder="',(0,b.default)("Enter a name for your new collection"),'" />','<div class="collection-name-prompt pull-right">',(0,b.default)("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',(0,b.default)("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">',(0,b.default)("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',(0,b.default)("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',(0,b.default)("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options pull-right">','<button class="create-collection btn btn-primary">',(0,b.default)("Create list"),"</button>","</div>","</div>"].join("")),helpContent:n.template(["<p>",(0,b.default)(["Collections of datasets are permanent, ordered lists of datasets that can be passed to tools and ","workflows in order to have analyses done on each member of the entire group. This interface allows ","you to create a collection and re-order the final collection."].join("")),"</p>","<ul>","<li>",(0,b.default)(["Rename elements in the list by clicking on ",'<i data-target=".collection-element .name">the existing name</i>.'].join("")),"</li>","<li>",(0,b.default)(["Discard elements from the final created list by clicking on the ",'<i data-target=".collection-element .discard">"Discard"</i> button.'].join("")),"</li>","<li>",(0,b.default)(["Reorder the list by clicking and dragging elements. Select multiple elements by clicking on ",'<i data-target=".collection-element">them</i> and you can then move those selected by dragging the ',"entire group. Deselect them by clicking them again or by clicking the ",'the <i data-target=".clear-selected">"Clear selected"</i> link.'].join("")),"</li>","<li>",(0,b.default)(['Click the <i data-target=".reset">"Start over"</i> link to begin again as if you had just opened ',"the interface."].join("")),"</li>","<li>",(0,b.default)(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",(0,b.default)(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidElements:n.template([(0,b.default)("The following selections could not be included due to problems:"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>"].join("")),noElementsLeft:n.template(['<li class="no-elements-left-message">',(0,b.default)("No elements left! "),(0,b.default)("Would you like to "),'<a class="reset" href="javascript:void(0)">',(0,b.default)("start over"),"</a>?","</li>"].join("")),invalidInitial:n.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",(0,b.default)("The following selections could not be included due to problems"),":","<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) < 1 ){ %>",(0,b.default)("No datasets were selected"),".","<% } %>","<br />",(0,b.default)("At least one element is needed for the collection"),". ",(0,b.default)("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',(0,b.default)("cancel"),"</a> ",(0,b.default)("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',(0,b.default)("Cancel"),"</button>","</div>","</div>","</div>"].join(""))}),toString:function(){return"ListCollectionCreator"}}),k=function(e,t,i){var a,o=s.Deferred(),r=Galaxy.modal||new g.default.View;return t=n.defaults(t||{},{elements:e,oncancel:function(){r.hide(),o.reject("cancelled")},oncreate:function(e,t){r.hide(),o.resolve(t)}}),a=new i(t),r.show({title:t.title||(0,b.default)("Create a collection"),body:a.$el,width:"80%",height:"100%",closing_events:!0}),a.render(),window._collectionCreator=a,o},C=function(e,t){return t=t||{},t.title=(0,b.default)("Create a collection from a list of datasets"),k(e,t,x)};t.default={DatasetCollectionElementView:y,ListCollectionCreator:x,collectionCreatorModal:k,listCollectionCreatorModal:C,createListCollection:r}}).call(t,i(1),i(2),i(0),i(0))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function a(e){return function(t,i){return this.isNew()&&(i=i||{},i.url=this.urlRoot+this.get("history_id")+"/contents",t=t||{},t.type="dataset_collection"),e.call(this,t,i)}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(189),o=n(s),r=i(206),l=n(r),d=i(7),c=(n(d),l.default.HistoryContentMixin),u=o.default.ListDatasetCollection,h=o.default.PairDatasetCollection,f=o.default.ListPairedDatasetCollection,p=o.default.ListOfListsDatasetCollection,m=u.extend(c).extend({defaults:e.extend(e.clone(u.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"list",model_class:"HistoryDatasetCollectionAssociation"}),save:a(u.prototype.save),toString:function(){return"History"+u.prototype.toString.call(this)}}),_=h.extend(c).extend({defaults:e.extend(e.clone(h.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"paired",model_class:"HistoryDatasetCollectionAssociation"}),save:a(h.prototype.save),toString:function(){return"History"+h.prototype.toString.call(this)}}),g=f.extend(c).extend({defaults:e.extend(e.clone(f.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"list:paired",model_class:"HistoryDatasetCollectionAssociation"}),save:a(f.prototype.save),toString:function(){return"History"+f.prototype.toString.call(this)}}),v=p.extend(c).extend({defaults:e.extend(e.clone(p.prototype.defaults),{history_content_type:"dataset_collection",collection_type:"list:list",model_class:"HistoryDatasetCollectionAssociation"}),save:a(p.prototype.save),toString:function(){return"HistoryListOfListsDatasetCollection("+this.get("name")+")"}});t.default={HistoryListDatasetCollection:m,HistoryPairDatasetCollection:_,HistoryListPairedDatasetCollection:g,HistoryListOfListsDatasetCollection:v}}).call(t,i(2))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(205),r=s(o),l=i(8),d=s(l),c=i(7),u=(s(c),{defaults:{model_class:"DatasetCollectionElement",element_identifier:null,element_index:null,element_type:null},_mergeObject:function(t){return e.extend(t,t.object,{element_id:t.id}),delete t.object,t},constructor:function(e,t){e=this._mergeObject(e),this.idAttribute="element_id",n.Model.apply(this,arguments)},parse:function(e,t){var i=e;return i=this._mergeObject(i)}}),h=n.Model.extend(d.default.LoggableMixin).extend(u).extend({_logNamespace:"collections"}),f=n.Collection.extend(d.default.LoggableMixin).extend({_logNamespace:"collections",model:h,toString:function(){return["DatasetCollectionElementCollection(",this.length,")"].join("")}}),p=r.default.DatasetAssociation.extend(d.default.mixin(u,{url:function(){return this.has("history_id")?Galaxy.root+"api/histories/"+this.get("history_id")+"/contents/"+this.get("id"):(console.warn("no endpoint for non-hdas within a collection yet"),Galaxy.root+"api/datasets")},defaults:e.extend({},r.default.DatasetAssociation.prototype.defaults,u.defaults),_downloadQueryParameters:function(){var e=this.get("file_ext"),t=this.get("element_identifier");return"?to_ext="+e+"&hdca_id="+this.get("parent_hdca_id")+"&element_identifier="+t},constructor:function(e,t){this.debug("\t DatasetDCE.constructor:",e,t),u.constructor.call(this,e,t)},hasDetails:function(){return this.elements&&this.elements.length},toString:function(){this.get("element_identifier");return"DatasetDCE({objStr})"}})),m=f.extend({model:p,toString:function(){return["DatasetDCECollection(",this.length,")"].join("")}}),_=n.Model.extend(d.default.LoggableMixin).extend(d.default.SearchableModelMixin).extend({_logNamespace:"collections",defaults:{collection_type:null,deleted:!1},collectionClass:f,initialize:function(e,t){this.debug(this+"(DatasetCollection).initialize:",e,t,this),this.elements=this._createElementsModel(),this.on("change:elements",function(){this.log("change:elements"),this.elements=this._createElementsModel()})},_createElementsModel:function(){this.debug(this+"._createElementsModel",this.collectionClass,this.get("elements"),this.elements);var t=this.get("elements")||[];this.unset("elements",{silent:!0});var i=this;return e.each(t,function(t,n){e.extend(t,{parent_hdca_id:i.get("id")})}),this.elements=new this.collectionClass(t),this.elements},toJSON:function(){var e=n.Model.prototype.toJSON.call(this);return this.elements&&(e.elements=this.elements.toJSON()),e},inReadyState:function(){var e=this.get("populated");return this.isDeletedOrPurged()||e},hasDetails:function(){return 0!==this.elements.length},getVisibleContents:function(e){return this.elements},parse:function(e,t){var i=n.Model.prototype.parse.call(this,e,t);return i.create_time&&(i.create_time=new Date(i.create_time)),i.update_time&&(i.update_time=new Date(i.update_time)),i},delete:function(e){return this.get("deleted")?a.when():this.save({deleted:!0},e)},undelete:function(e){return!this.get("deleted")||this.get("purged")?a.when():this.save({deleted:!1},e)},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},searchAttributes:["name","tags"],toString:function(){return"DatasetCollection("+[this.get("id"),this.get("name")||this.get("element_identifier")].join(",")+")"}}),g=_.extend({collectionClass:m,toString:function(){return"List"+_.prototype.toString.call(this)}}),v=g.extend({toString:function(){return"Pair"+_.prototype.toString.call(this)}}),w=_.extend(d.default.mixin(u,{constructor:function(e,t){this.debug("\t NestedDCDCE.constructor:",e,t),u.constructor.call(this,e,t)},toString:function(){return["NestedDCDCE(",this.object?""+this.object:this.get("element_identifier"),")"].join("")}})),b=f.extend({model:w,toString:function(){return["NestedDCDCECollection(",this.length,")"].join("")}}),y=v.extend(d.default.mixin(u,{constructor:function(e,t){this.debug("\t NestedPairDCDCE.constructor:",e,t),u.constructor.call(this,e,t)},toString:function(){return["NestedPairDCDCE(",this.object?""+this.object:this.get("element_identifier"),")"].join("")}})),x=b.extend({model:y,toString:function(){return["NestedPairDCDCECollection(",this.length,")"].join("")}}),k=_.extend({collectionClass:x,toString:function(){return["ListPairedDatasetCollection(",this.get("name"),")"].join("")}}),C=g.extend(d.default.mixin(u,{constructor:function(e,t){this.debug("\t NestedListDCDCE.constructor:",e,t),u.constructor.call(this,e,t)},toString:function(){return["NestedListDCDCE(",this.object?""+this.object:this.get("element_identifier"),")"].join("")}})),$=b.extend({model:C,toString:function(){return["NestedListDCDCECollection(",this.length,")"].join("")}}),S=_.extend({collectionClass:$,toString:function(){return["ListOfListsDatasetCollection(",this.get("name"),")"].join("")}});t.default={ListDatasetCollection:g,PairDatasetCollection:v,ListPairedDatasetCollection:k,ListOfListsDatasetCollection:S}}).call(t,i(2),i(1),i(0))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={tool:"fa-wrench",data_input:"fa-file-o",data_collection_input:"fa-folder-o",subworkflow:"fa-sitemap fa-rotate-270",pause:"fa-pause"}},function(e,t,i){"use strict";(function(e,n,a,s){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(192),l=o(r),d=i(193),c=(o(d),i(213)),u=o(c),h=i(3),f=o(h),p=i(8),m=o(p),_=i(7),g=o(_),v=e.Model.extend(m.default.LoggableMixin).extend(m.default.mixin(m.default.SearchableModelMixin,{_logNamespace:"history",UPDATE_DELAY:4e3,defaults:{model_class:"History",id:null,name:"Unnamed History",state:"new",deleted:!1,contents_active:{},contents_states:{}},urlRoot:Galaxy.root+"api/histories",contentsClass:l.default.HistoryContents,searchAttributes:["name","annotation","tags"],searchAliases:{title:"name",tag:"tags"},initialize:function(e,t){t=t||{},this.logger=t.logger||null,this.log(this+".initialize:",e,t),this.contents=new this.contentsClass([],{history:this,historyId:this.get("id"),order:t.order}),this._setUpListeners(),this._setUpCollectionListeners(),this.updateTimeoutId=null},_setUpListeners:function(){return this.on({error:function(e,t,i,n,a){this.clearUpdateTimeout()},"change:id":function(e,t){this.contents&&(this.contents.historyId=t)}})},_setUpCollectionListeners:function(){return this.contents?this.listenTo(this.contents,{error:function(){this.trigger.apply(this,n.makeArray(arguments))}}):this},contentsShown:function(){var e=this.get("contents_active"),t=e.active||0;return t+=this.contents.includeDeleted?e.deleted:0,t+=this.contents.includeHidden?e.hidden:0},nice_size:function(){var e=this.get("size");return e?f.default.bytesToString(e,!0,2):(0,g.default)("(empty)")},toJSON:function(){return a.extend(e.Model.prototype.toJSON.call(this),{nice_size:this.nice_size()})},get:function(t){return"nice_size"===t?this.nice_size():e.Model.prototype.get.apply(this,arguments)},ownedByCurrUser:function(){return!(!Galaxy||!Galaxy.user)&&(!Galaxy.user.isAnonymous()&&Galaxy.user.id===this.get("user_id"))},numOfUnfinishedJobs:function(){var e=this.get("non_ready_jobs");return e?e.length:0},numOfUnfinishedShownContents:function(){return this.contents.runningAndActive().length||0},_fetchContentRelatedAttributes:function(){var e=["size","non_ready_jobs","contents_active","hid_counter"];return this.fetch({data:s.param({keys:e.join(",")})})},refresh:function(e){var t=this;e=e||{};var i=this.lastUpdateTime;return this.contents.allFetched=!1,(0!==this.contents.currentPage?function(){return t.contents.fetchPage(t.contents.currentPage)}:function(){return t.contents.fetchUpdated(i)})().done(function(i,n,a){var s;try{s=new Date(a.getResponseHeader("Date"))}catch(e){}t.lastUpdateTime=s||new Date,t.checkForUpdates(e)})},checkForUpdates:function(e){var t=this;e=e||{};var i=this.UPDATE_DELAY;if(this.id){var n=function(){t.clearUpdateTimeout(),t.updateTimeoutId=setTimeout(function(){t.refresh(e)},i)};this.numOfUnfinishedShownContents()>0?n():this._fetchContentRelatedAttributes().done(function(e){t.numOfUnfinishedJobs()>0?n():t.trigger("ready")})}},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},stopPolling:function(){this.clearUpdateTimeout(),this.contents&&this.contents.stopPolling()},parse:function(t,i){var n=e.Model.prototype.parse.call(this,t,i);return n.create_time&&(n.create_time=new Date(n.create_time)),n.update_time&&(n.update_time=new Date(n.update_time)),n},fetchWithContents:function(e,t){e=e||{};var i=this;return e.view="dev-detailed",this.fetch(e).then(function(e){return i.contents.history=i,i.contents.setHistoryId(e.id),i.fetchContents(t)})},fetchContents:function(e){e=e||{};var t=this;return t.lastUpdateTime=new Date,t.contents.fetchCurrentPage(e)},_delete:function(e){return this.get("deleted")?n.when():this.save({deleted:!0},e)},purge:function(e){return this.get("purged")?n.when():this.save({deleted:!0,purged:!0},e)},undelete:function(e){return this.get("deleted")?this.save({deleted:!1},e):n.when()},copy:function(e,t,i){if(e=void 0===e||e,!this.id)throw new Error("You must set the history ID before copying it.");var a={history_id:this.id};e&&(a.current=!0),t&&(a.name=t),i||(a.all_datasets=!1),a.view="dev-detailed";var s=this,o=n.post(this.urlRoot,a);return e?o.then(function(e){return new v(e).setAsCurrent().done(function(){s.trigger("copied",s,e)})}):o.done(function(e){s.trigger("copied",s,e)})},setAsCurrent:function(){var e=this,t=n.getJSON(Galaxy.root+"history/set_as_current?id="+this.id);return t.done(function(){e.trigger("set-as-current",e)}),t},toString:function(){return"History("+this.get("id")+","+this.get("name")+")"}})),w=u.default.InfinitelyScrollingCollection,b=w.extend(m.default.LoggableMixin).extend({_logNamespace:"history",model:v,order:"update_time",limitOnFirstFetch:10,limitPerFetch:10,initialize:function(e,t){t=t||{},this.log("HistoryCollection.initialize",e,t),w.prototype.initialize.call(this,e,t),this.includeDeleted=t.includeDeleted||!1,this.currentHistoryId=t.currentHistoryId,this.setUpListeners()},urlRoot:Galaxy.root+"api/histories",url:function(){return this.urlRoot},setUpListeners:function(){return this.on({"change:deleted":function(e){this.debug("change:deleted",this.includeDeleted,e.get("deleted")),!this.includeDeleted&&e.get("deleted")&&this.remove(e)},copied:function(e,t){this.setCurrent(new v(t,[]))},"set-as-current":function(e){var t=this.currentHistoryId;this.trigger("no-longer-current",t),this.currentHistoryId=e.id}})},_buildFetchData:function(e){return a.extend(w.prototype._buildFetchData.call(this,e),{view:"dev-detailed"})},_buildFetchFilters:function(e){var t=w.prototype._buildFetchFilters.call(this,e)||{},i={};return this.includeDeleted?i.deleted=null:(i.deleted=!1,i.purged=!1),a.defaults(t,i)},fetchFirst:function(e){var t=this,i=s.when();return this.currentHistoryId&&(i=w.prototype.fetchFirst.call(t,{silent:!0,limit:1,filters:{purged:"",deleted:"","encoded_id-in":this.currentHistoryId}})),i.then(function(){return e=e||{},e.offset=0,t.fetchMore(e)})},comparators:a.extend(a.clone(w.prototype.comparators),{name:m.default.buildComparator("name",{ascending:!0}),"name-dsc":m.default.buildComparator("name",{ascending:!1}),size:m.default.buildComparator("size",{ascending:!1}),"size-asc":m.default.buildComparator("size",{ascending:!0})}),sort:function(e){e=e||{};var t=e.silent,i=this.remove(this.get(this.currentHistoryId));return w.prototype.sort.call(this,a.defaults({silent:!0},e)),this.unshift(i,{silent:!0}),t||this.trigger("sort",this,e),this},create:function(e,t,i,a){var s=this;return n.getJSON(Galaxy.root+"history/create_new_current").done(function(e){s.setCurrent(new v(e,[],i||{}))})},setCurrent:function(e,t){return t=t||{},this.unshift(e,t),this.currentHistoryId=e.get("id"),t.silent||this.trigger("new-current",e,this),this},toString:function(){return"HistoryCollection("+this.length+",current:"+this.currentHistoryId+")"}});t.default={History:v,HistoryCollection:b}}).call(t,i(1),i(0),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(213),r=s(o),l=i(214),d=s(l),c=i(188),u=s(c),h=i(193),f=s(h),p=i(253),m=s(p),_=i(8),g=s(_),v=i(215),w=s(v),b=r.default.PaginatedCollection,y=b.extend(g.default.LoggableMixin).extend({_logNamespace:"history",limitPerPage:500,limitPerProgressiveFetch:500,order:"hid",urlRoot:Galaxy.root+"api/histories",url:function(){return this.urlRoot+"/"+this.historyId+"/contents"},initialize:function(e,t){this.on({"sync add":this.trackJobStates}),t=t||{},b.prototype.initialize.call(this,e,t),this.history=t.history||null,this.setHistoryId(t.historyId||null),this.includeDeleted=t.includeDeleted||this.includeDeleted,this.includeHidden=t.includeHidden||this.includeHidden,this.model.prototype.idAttribute="type_id"},trackJobStates:function(){var e=this;this.each(function(t){if(!t.has("job_states_summary")&&"dataset_collection"===t.attributes.history_content_type){var i=t.attributes.job_source_type,n=t.attributes.job_source_id;if(i){e.jobStateSummariesCollection.add({id:n,model:i,history_id:e.history_id,collection_id:t.attributes.id});var a=e.jobStateSummariesCollection.get(n);t.jobStatesSummary=a}}})},model:function(e,t){if("dataset"===e.history_content_type)return new d.default.HistoryDatasetAssociation(e,t);if("dataset_collection"===e.history_content_type){switch(e.collection_type){case"list":return new u.default.HistoryListDatasetCollection(e,t);case"paired":return new u.default.HistoryPairDatasetCollection(e,t);case"list:paired":return new u.default.HistoryListPairedDatasetCollection(e,t);case"list:list":return new u.default.HistoryListOfListsDatasetCollection(e,t)}var i="Unknown collection_type: "+e.collection_type;return console.warn(i,e),{validationError:i}}return{validationError:"Unknown history_content_type: "+e.history_content_type}},stopPolling:function(){this.jobStateSummariesCollection&&(this.jobStateSummariesCollection.active=!1,this.jobStateSummariesCollection.clearUpdateTimeout())},setHistoryId:function(e){this.stopPolling(),this.historyId=e,e&&(this._setUpWebStorage(),this.jobStateSummariesCollection=new m.default.JobStatesSummaryCollection,this.jobStateSummariesCollection.historyId=e,this.jobStateSummariesCollection.monitor())},_setUpWebStorage:function(e){return this.storage=new f.default.HistoryPrefs({id:f.default.HistoryPrefs.historyStorageKey(this.historyId)}),this.trigger("new-storage",this.storage,this),this.on({"include-deleted":function(e){this.storage.includeDeleted(e)},"include-hidden":function(e){this.storage.includeHidden(e)}}),this.includeDeleted=this.storage.includeDeleted()||!1,this.includeHidden=this.storage.includeHidden()||!1,this},comparators:e.extend(e.clone(b.prototype.comparators),{name:g.default.buildComparator("name",{ascending:!0}),"name-dsc":g.default.buildComparator("name",{ascending:!1}),hid:g.default.buildComparator("hid",{ascending:!1}),"hid-asc":g.default.buildComparator("hid",{ascending:!0})}),running:function(){return this.filter(function(e){return!e.inReadyState()})},runningAndActive:function(){return this.filter(function(e){return!e.inReadyState()&&e.get("visible")&&!e.get("deleted")})},getByHid:function(e){return this.findWhere({hid:e})},haveDetails:function(){return this.all(function(e){return e.hasDetails()})},hidden:function(){return this.filter(function(e){return e.hidden()})},deleted:function(){return this.filter(function(e){return e.get("deleted")})},visibleAndUndeleted:function(){return this.filter(function(e){return e.get("visible")&&!e.get("deleted")})},setIncludeDeleted:function(t,i){if(e.isBoolean(t)&&t!==this.includeDeleted){if(this.includeDeleted=t,e.result(i,"silent"))return;this.trigger("include-deleted",t,this)}},setIncludeHidden:function(t,i){if(e.isBoolean(t)&&t!==this.includeHidden){if(this.includeHidden=t,i=i||{},e.result(i,"silent"))return;this.trigger("include-hidden",t,this)}},fetch:function(t){if(t=t||{},this.historyId&&!t.details){var i=f.default.HistoryPrefs.get(this.historyId).toJSON();e.isEmpty(i.expandedIds)||(t.details=e.values(i.expandedIds).join(","))}return b.prototype.fetch.call(this,t)},_buildFetchData:function(t){return e.extend(b.prototype._buildFetchData.call(this,t),{v:"dev"})},_fetchParams:b.prototype._fetchParams.concat(["v","details"]),_buildFetchFilters:function(t){var i=b.prototype._buildFetchFilters.call(this,t)||{},n={};return this.includeDeleted||(n.deleted=!1,n.purged=!1),this.includeHidden||(n.visible=!0),e.defaults(i,n)},getTotalItemCount:function(){return this.history.contentsShown()},fetchUpdated:function(e,t){return e&&(t=t||{filters:{}},t.remove=!1,t.filters={"update_time-ge":e.toISOString(),visible:""}),this.fetch(t)},fetchDeleted:function(t){var i=this;return t=t||{},t.filters=e.extend(t.filters,{deleted:!0,purged:void 0}),t.remove=!1,this.trigger("fetching-deleted",this),this.fetch(t).always(function(){i.trigger("fetching-deleted-done",i)})},fetchHidden:function(t){t=t||{};var i=this;return t.filters=e.extend(t.filters,{visible:!1}),t.remove=!1,i.trigger("fetching-hidden",i),i.fetch(t).always(function(){i.trigger("fetching-hidden-done",i)})},fetchAllDetails:function(t){t=t||{};var i={details:"all"};return t.data=e.extend(t.data||{},i),this.fetch(t)},_filterAndUpdate:function(e,t){var i=this,n=i.model.prototype.idAttribute,a=[t];return i.fetch({filters:e,remove:!1}).then(function(e){return e=e.reduce(function(e,t,a){var s=i.get(t[n]);return s?e.concat(s):e},[]),i.ajaxQueue("save",a,e)})},ajaxQueue:function(t,i,n){return n=n||this.models,new w.default.AjaxQueue(n.slice().reverse().map(function(n,a){var s=e.isString(t)?n[t]:t;return function(){return s.apply(n,i)}})).deferred},progressivelyFetchDetails:function(t){function i(n){n=n||0;var r=e.extend(e.clone(t),{view:"summary",keys:l,limit:o,offset:n,reset:0===n,remove:!1});e.defer(function(){s.fetch.call(s,r).fail(a.reject).done(function(e){a.notify(e,o,n),e.length!==o?(s.allFetched=!0,a.resolve(e,o,n)):i(n+o)})})}t=t||{};var a=n.Deferred(),s=this,o=t.limitPerCall||s.limitPerProgressiveFetch,r=d.default.HistoryDatasetAssociation.prototype.searchAttributes,l=r.join(",");return i(),a},isCopyable:function(t){var i=["HistoryDatasetAssociation","HistoryDatasetCollectionAssociation"];return e.isObject(t)&&t.id&&e.contains(i,t.model_class)},copy:function(t){var i,a,s;e.isString(t)?(i=t,s="hda",a="dataset"):(i=t.id,s={HistoryDatasetAssociation:"hda",LibraryDatasetDatasetAssociation:"ldda",HistoryDatasetCollectionAssociation:"hdca"}[t.model_class]||"hda",a="hdca"===s?"dataset_collection":"dataset");var o=this,r=n.ajax(this.url(),{method:"POST",contentType:"application/json",data:JSON.stringify({content:i,source:s,type:a})}).done(function(e){o.add([e],{parse:!0})}).fail(function(e,t,n){o.trigger("error",o,r,{},"Error copying contents",{type:a,id:i,source:s})});return r},createHDCA:function(e,t,i,n,a){return this.model({history_content_type:"dataset_collection",collection_type:t,history_id:this.historyId,name:i,hide_source_items:n||!1,element_identifiers:e}).save(a)},haveSearchDetails:function(){return this.allFetched&&this.all(function(t){return e.has(t.attributes,"annotation")})},matches:function(e){return this.filter(function(t){return t.matches(e)})},clone:function(){var e=a.Collection.prototype.clone.call(this);return e.historyId=this.historyId,e},toString:function(){return["HistoryContents(",[this.historyId,this.length].join(),")"].join("")}});t.default={HistoryContents:y}}).call(t,i(2),i(0),i(1))},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i(8),a=function(e){return e&&e.__esModule?e:{default:e}}(n),s=a.default.SessionStorageModel.extend({defaults:{expandedIds:{},show_deleted:!1,show_hidden:!1},addExpanded:function(e){var t=this.get("expandedIds");t[e.id]=e.get("id"),this.save("expandedIds",t)},removeExpanded:function(e){var t=this.get("expandedIds");delete t[e.id],this.save("expandedIds",t)},isExpanded:function(t){return e.result(this.get("expandedIds"),t,!1)},allExpanded:function(){return e.values(this.get("expandedIds"))},clearExpanded:function(){this.set("expandedIds",{})},includeDeleted:function(t){return e.isUndefined(t)||this.set("show_deleted",t),this.get("show_deleted")},includeHidden:function(t){return e.isUndefined(t)||this.set("show_hidden",t),this.get("show_hidden")},toString:function(){return"HistoryPrefs("+this.id+")"}},{storageKeyPrefix:"history:",historyStorageKey:function(e){if(!e)throw new Error("HistoryPrefs.historyStorageKey needs valid id: "+e);return s.storageKeyPrefix+e},get:function(e){return new s({id:s.historyStorageKey(e)})},clearAll:function(e){for(var t in sessionStorage)0===t.indexOf(s.storageKeyPrefix)&&sessionStorage.removeItem(t)}});t.default={HistoryPrefs:s}}).call(t,i(2))},function(e,t,i){"use strict";(function(e,n,a,s){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(8),l=o(r),d=i(7),c=(o(d),e.View.extend(l.default.LoggableMixin).extend({_logNamespace:"list",initialize:function(e){this.expanded=e.expanded||!1,this.log("\t expanded:",this.expanded),this.fxSpeed=void 0!==e.fxSpeed?e.fxSpeed:this.fxSpeed},fxSpeed:"fast",render:function(e){var t=this._buildNewRender();return this._setUpBehaviors(t),this._queueNewRender(t,e),this},_buildNewRender:function(){var e=n(this.templates.el(this.model.toJSON(),this));return this.expanded&&this.$details(e).replaceWith(this._renderDetails().show()),e},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var i=this;0===t?(i._swapNewRender(e),i.trigger("rendered",i)):n(i).queue("fx",[function(e){i.$el.fadeOut(t,e)},function(t){i._swapNewRender(e),t()},function(e){i.$el.fadeIn(t,e)},function(e){i.trigger("rendered",i),e()}])},_swapNewRender:function(e){return this.$el.empty().attr("class",a.isFunction(this.className)?this.className():this.className).append(e.children())},_setUpBehaviors:function(e){e=e||this.$el,e.find("[title]").tooltip({placement:"bottom"})},$details:function(e){return e=e||this.$el,e.find("> .details")},_renderDetails:function(){var e=n(this.templates.details(this.model.toJSON(),this));return this._setUpBehaviors(e),e},toggleExpanded:function(e){return e=void 0===e?!this.expanded:e,e?this.expand():this.collapse(),this},expand:function(){var e=this;return e._fetchModelDetails().always(function(){e._expand()})},_fetchModelDetails:function(){return this.model.hasDetails()?s.when():this.model.fetch()},_expand:function(){var e=this,t=e._renderDetails();e.$details().replaceWith(t),e.expanded=!0,e.$details().slideDown(e.fxSpeed,function(){e.trigger("expanded",e)})},collapse:function(){this.debug(this+"(ExpandableView).collapse");var e=this;e.expanded=!1,this.$details().slideUp(e.fxSpeed,function(){e.trigger("collapsed",e)})}})),u=c.extend(l.default.mixin(l.default.SelectableViewMixin,l.default.DraggableViewMixin,{tagName:"div",className:"list-item",initialize:function(e){c.prototype.initialize.call(this,e),l.default.SelectableViewMixin.initialize.call(this,e),l.default.DraggableViewMixin.initialize.call(this,e),this._setUpListeners()},_setUpListeners:function(){return this.on("selectable",function(e){e?this.$(".primary-actions").hide():this.$(".primary-actions").show()},this),this},_buildNewRender:function(){var e=c.prototype._buildNewRender.call(this);return e.children(".warnings").replaceWith(this._renderWarnings()),e.children(".title-bar").replaceWith(this._renderTitleBar()),e.children(".primary-actions").append(this._renderPrimaryActions()),e.find("> .title-bar .subtitle").replaceWith(this._renderSubtitle()),e},_swapNewRender:function(e){return c.prototype._swapNewRender.call(this,e),this.selectable&&this.showSelector(0),this.draggable&&this.draggableOn(),this.$el},_renderWarnings:function(){var e=this,t=n('<div class="warnings"></div>'),i=e.model.toJSON();return a.each(e.templates.warnings,function(a){t.append(n(a(i,e)))}),t},_renderTitleBar:function(){return n(this.templates.titleBar(this.model.toJSON(),this))},_renderPrimaryActions:function(){return[]},_renderSubtitle:function(){return n(this.templates.subtitle(this.model.toJSON(),this))},events:{"click .title-bar":"_clickTitleBar","keydown .title-bar":"_keyDownTitleBar","click .selector":"toggleSelect"},_clickTitleBar:function(e){e.stopPropagation(),e.altKey?(this.toggleSelect(e),this.selectable||this.showSelector()):this.toggleExpanded()},_keyDownTitleBar:function(e){return!e||"keydown"!==e.type||32!==e.keyCode&&13!==e.keyCode||(this.toggleExpanded(),e.stopPropagation(),!1)},toString:function(){return"ListItemView("+(this.model?""+this.model:"(no model)")+")"}}));u.prototype.templates=function(){return{el:l.default.wrapTemplate(['<div class="list-element">','<div class="warnings"></div>','<div class="selector">','<span class="fa fa-2x fa-square-o"></span>',"</div>",'<div class="primary-actions"></div>','<div class="title-bar"></div>','<div class="details"></div>',"</div>"]),warnings:{},titleBar:l.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element"),subtitle:l.default.wrapTemplate(['<div class="subtitle"></div>']),details:l.default.wrapTemplate(['<div class="details"></div>'])}}();var h=u.extend({foldoutStyle:"foldout",foldoutPanelClass:null,initialize:function(e){"drilldown"===this.foldoutStyle&&(this.expanded=!1),this.foldoutStyle=e.foldoutStyle||this.foldoutStyle,this.foldoutPanelClass=e.foldoutPanelClass||this.foldoutPanelClass,u.prototype.initialize.call(this,e),this.foldout=this._createFoldoutPanel()},_renderDetails:function(){if("drilldown"===this.foldoutStyle)return n();var e=u.prototype._renderDetails.call(this);return this._attachFoldout(this.foldout,e)},_createFoldoutPanel:function(){var e=this.model,t=this._getFoldoutPanelClass(e),i=this._getFoldoutPanelOptions(e);return new t(a.extend(i,{model:e}))},_getFoldoutPanelClass:function(){return this.foldoutPanelClass},_getFoldoutPanelOptions:function(){return{foldoutStyle:this.foldoutStyle,fxSpeed:this.fxSpeed}},_attachFoldout:function(e,t){return t=t||this.$("> .details"),this.foldout=e.render(0),e.$("> .controls").hide(),t.append(e.$el)},expand:function(){var e=this;return e._fetchModelDetails().always(function(){"foldout"===e.foldoutStyle?e._expand():"drilldown"===e.foldoutStyle&&e._expandByDrilldown()})},_expandByDrilldown:function(){var e=this;e.listenTo(e.foldout,"close",function(){e.trigger("collapsed:drilldown",e,e.foldout)}),e.trigger("expanded:drilldown",e,e.foldout)}});h.prototype.templates=function(){var e=l.default.wrapTemplate(['<div class="details">',"</div>"],"collection");return a.extend({},u.prototype.templates,{details:e})}(),t.default={ExpandableView:c,ListItemView:u,FoldoutListItemView:h}}).call(t,i(1),i(0),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a,s){function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(194),l=o(r),d=i(166),c=o(d),u=i(175),h=o(u),f=i(8),p=o(f),m=i(7),_=o(m),g=l.default.ListItemView,v=g.extend({_logNamespace:"dataset",className:g.prototype.className+" dataset",id:function(){return["dataset",this.model.get("id")].join("-")},initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log(this+".initialize:",e),g.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank"},_setUpListeners:function(){g.prototype._setUpListeners.call(this);var t=this;return t.listenTo(t.model,{change:function(i){t.model.changedAttributes().state&&t.model.inReadyState()&&t.expanded&&!t.model.hasDetails()?t.model.fetch({silent:!0}).done(function(){t.render()}):e.has(i.changed,"tags")&&1===e.keys(i.changed).length?t.$(".nametags").html(t._renderNametags()):t.render()}})},_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):n.when()},remove:function(e,t){var i=this;e=e||this.fxSpeed,this.$el.fadeOut(e,function(){a.View.prototype.remove.call(i),t&&t.call(i)})},_swapNewRender:function(e){return g.prototype._swapNewRender.call(this,e),this.model.has("state")&&this.$el.addClass("state-"+this.model.get("state")),this.$el},_renderPrimaryActions:function(){return[this._renderDisplayButton()]},_renderDisplayButton:function(){var e=this.model.get("state");if(e===c.default.NOT_VIEWABLE||e===c.default.DISCARDED||!this.model.get("accessible"))return null;var t={target:this.linkTarget,classes:"display-btn"};if(this.model.get("purged"))t.disabled=!0,t.title=(0,_.default)("Cannot display datasets removed from disk");else if(e===c.default.UPLOAD)t.disabled=!0,t.title=(0,_.default)("This dataset must finish uploading before it can be viewed");else if(e===c.default.NEW)t.disabled=!0,t.title=(0,_.default)("This dataset is not yet viewable");else{t.title=(0,_.default)("View data"),t.href=this.model.urls.display;var i=this;t.onclick=function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.addDataset(i.model.get("id")),e.preventDefault())}}return t.faIcon="fa-eye",(0,h.default)(t)},_renderDetails:function(){if(this.model.get("state")===c.default.NOT_VIEWABLE)return s(this.templates.noAccess(this.model.toJSON(),this));var e=g.prototype._renderDetails.call(this);return e.find(".actions .left").empty().append(this._renderSecondaryActions()),e.find(".summary").html(this._renderSummary()).prepend(this._renderDetailMessages()),e.find(".display-applications").html(this._renderDisplayApplications()),this._setUpBehaviors(e),e},_renderSummary:function(){var e=this.model.toJSON(),t=this.templates.summaries[e.state];return(t=t||this.templates.summaries.unknown)(e,this)},_renderDetailMessages:function(){var t=this,i=s('<div class="detail-messages"></div>'),n=t.model.toJSON();return e.each(t.templates.detailMessages,function(e){i.append(s(e(n,t)))}),i},_renderDisplayApplications:function(){return this.model.isDeletedOrPurged()?"":[this.templates.displayApplications(this.model.get("display_apps"),this),this.templates.displayApplications(this.model.get("display_types"),this)].join("")},_renderSecondaryActions:function(){switch(this.debug("_renderSecondaryActions"),this.model.get("state")){case c.default.NOT_VIEWABLE:return[];case c.default.OK:case c.default.FAILED_METADATA:case c.default.ERROR:return[this._renderDownloadButton(),this._renderShowParamsButton()]}return[this._renderShowParamsButton()]},_renderShowParamsButton:function(){return(0,h.default)({title:(0,_.default)("View details"),classes:"params-btn",href:this.model.urls.show_params,target:this.linkTarget,faIcon:"fa-info-circle",onclick:function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.add({title:"Dataset details",url:this.href}),e.preventDefault(),e.stopPropagation())}})},_renderDownloadButton:function(){return this.model.get("purged")||!this.model.hasData()?null:e.isEmpty(this.model.get("meta_files"))?s(['<a class="download-btn icon-btn" ','href="',this.model.urls.download,'" title="'+(0,_.default)("Download")+'" download>','<span class="fa fa-floppy-o"></span>',"</a>"].join("")):this._renderMetaFileDownloadButton()},_renderMetaFileDownloadButton:function(){var t=this.model.urls;return s(['<div class="metafile-dropdown dropdown">','<a class="download-btn icon-btn" href="javascript:void(0)" data-toggle="dropdown"',' title="'+(0,_.default)("Download")+'">','<span class="fa fa-floppy-o"></span>',"</a>",'<ul class="dropdown-menu" role="menu" aria-labelledby="dLabel">','<li><a href="'+t.download+'" download>',(0,_.default)("Download dataset"),"</a></li>",e.map(this.model.get("meta_files"),function(e){return['<li><a href="',t.meta_download+e.file_type,'">',(0,_.default)("Download")," ",e.file_type,"</a></li>"].join("")}).join("\n"),"</ul>","</div>"].join("\n"))},_renderNametags:function(){return e.template(["<% _.each(_.sortBy(_.uniq(tags), function(x) { return x }), function(tag){ %>",'<% if (tag.indexOf("name:") == 0){ %>','<span class="label label-info"><%- tag.slice(5) %></span>',"<% } %>","<% }); %>"].join(""))({tags:this.model.get("tags")})},events:e.extend(e.clone(g.prototype.events),{"click .display-btn":function(e){this.trigger("display",this,e)},"click .params-btn":function(e){this.trigger("params",this,e)},"click .download-btn":function(e){this.trigger("download",this,e)}}),toString:function(){return"DatasetListItemView("+(this.model?""+this.model:"(no model)")+")"}});v.prototype.templates=function(){var t=e.extend({},g.prototype.templates.warnings,{failed_metadata:p.default.wrapTemplate(['<% if( model.state === "failed_metadata" ){ %>','<div class="warningmessagesmall">',(0,_.default)("An error occurred setting the metadata for this dataset"),"</div>","<% } %>"]),error:p.default.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',(0,_.default)("There was an error getting the data for this dataset"),": <%- model.error %>","</div>","<% } %>"]),purged:p.default.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',(0,_.default)("This dataset has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:p.default.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,_.default)("This dataset has been deleted"),"</div>","<% } %>"])}),i=p.default.wrapTemplate(['<div class="details">','<div class="summary"></div>','<div class="actions clear">','<div class="left"></div>','<div class="right"></div>',"</div>","<% if( !dataset.deleted && !dataset.purged ){ %>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="display-applications"></div>',"<% if( dataset.peek ){ %>",'<pre class="dataset-peek"><%= dataset.peek %></pre>',"<% } %>","<% } %>","</div>"],"dataset"),n=p.default.wrapTemplate(['<div class="details">','<div class="summary">',(0,_.default)("You do not have permission to view this dataset"),"</div>","</div>"],"dataset"),a={};a[c.default.OK]=a[c.default.FAILED_METADATA]=p.default.wrapTemplate(["<% if( dataset.misc_blurb ){ %>",'<div class="blurb">','<span class="value"><%- dataset.misc_blurb %></span>',"</div>","<% } %>","<% if( dataset.file_ext ){ %>",'<div class="datatype">','<label class="prompt">',(0,_.default)("format"),"</label>",'<span class="value"><%- dataset.file_ext %></span>',"</div>","<% } %>","<% if( dataset.metadata_dbkey ){ %>",'<div class="dbkey">','<label class="prompt">',(0,_.default)("database"),"</label>",'<span class="value">',"<%- dataset.metadata_dbkey %>","</span>","</div>","<% } %>","<% if( dataset.misc_info ){ %>",'<div class="info">','<span class="value"><%- dataset.misc_info %></span>',"</div>","<% } %>"],"dataset"),a[c.default.NEW]=p.default.wrapTemplate(["<div>",(0,_.default)("This is a new dataset and not all of its data are available yet"),"</div>"],"dataset"),a[c.default.NOT_VIEWABLE]=p.default.wrapTemplate(["<div>",(0,_.default)("You do not have permission to view this dataset"),"</div>"],"dataset"),a[c.default.DISCARDED]=p.default.wrapTemplate(["<div>",(0,_.default)("The job creating this dataset was cancelled before completion"),"</div>"],"dataset"),a[c.default.QUEUED]=p.default.wrapTemplate(["<div>",(0,_.default)("This job is waiting to run"),"</div>"],"dataset"),a[c.default.RUNNING]=p.default.wrapTemplate(["<div>",(0,_.default)("This job is currently running"),"</div>"],"dataset"),a[c.default.UPLOAD]=p.default.wrapTemplate(["<div>",(0,_.default)("This dataset is currently uploading"),"</div>"],"dataset"),a[c.default.SETTING_METADATA]=p.default.wrapTemplate(["<div>",(0,_.default)("Metadata is being auto-detected"),"</div>"],"dataset"),a[c.default.PAUSED]=p.default.wrapTemplate(["<div>",(0,_.default)('This job is paused. Use the "Resume Paused Jobs" in the history menu to resume'),"</div>"],"dataset"),a[c.default.ERROR]=p.default.wrapTemplate(["<% if( !dataset.purged ){ %>","<div><%- dataset.misc_blurb %></div>","<% } %>",'<span class="help-text">',(0,_.default)("An error occurred with this dataset"),":</span>",'<div class="job-error-text"><%- dataset.misc_info %></div>'],"dataset"),a[c.default.EMPTY]=p.default.wrapTemplate(["<div>",(0,_.default)("No data"),": <i><%- dataset.misc_blurb %></i></div>"],"dataset"),a.unknown=p.default.wrapTemplate(['<div>Error: unknown dataset state: "<%- dataset.state %>"</div>'],"dataset");var s={resubmitted:p.default.wrapTemplate(["<% if( model.resubmitted ){ %>",'<div class="resubmitted-msg infomessagesmall">',(0,_.default)("The job creating this dataset has been resubmitted"),"</div>","<% } %>"])},o=p.default.wrapTemplate(["<% _.each( apps, function( app ){ %>",'<div class="display-application">','<span class="display-application-location"><%- app.label %></span> ','<span class="display-application-links">',"<% _.each( app.links, function( link ){ %>",'<a target="<%- link.target %>" href="<%- link.href %>">',"<% print( _l( link.text ) ); %>","</a> ","<% }); %>","</span>","</div>","<% }); %>"],"apps");return e.extend({},g.prototype.templates,{warnings:t,details:i,noAccess:n,summaries:a,detailMessages:s,displayApplications:o})}(),t.default={DatasetListItemView:v}}).call(t,i(2),i(0),i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(194),r=s(o),l=i(195),d=s(l),c=i(8),u=s(c),h=i(7),f=s(h),p=r.default.FoldoutListItemView,m=r.default.ListItemView,_=p.extend({className:p.prototype.className+" dataset-collection",id:function(){return["dataset_collection",this.model.get("id")].join("-")},initialize:function(e){this.linkTarget=e.linkTarget||"_blank",this.hasUser=e.hasUser,p.prototype.initialize.call(this,e)},_setUpListeners:function(){p.prototype._setUpListeners.call(this),this.listenTo(this.model,"change",function(t,i){e.has(t.changed,"deleted")?this.render():e.has(t.changed,"element_count")&&this.$("> .title-bar .subtitle").replaceWith(this._renderSubtitle())})},_renderSubtitle:function(){return n(this.templates.subtitle(this.model.toJSON(),this))},_getFoldoutPanelOptions:function(){var t=p.prototype._getFoldoutPanelOptions.call(this);return e.extend(t,{linkTarget:this.linkTarget,hasUser:this.hasUser})},$selector:function(){return this.$("> .selector")},toString:function(){return"DCListItemView("+(this.model?""+this.model:"(no model)")+")"}});_.prototype.templates=function(){var t=e.extend({},p.prototype.templates.warnings,{error:u.default.wrapTemplate(["<% if( model.error ){ %>",'<div class="errormessagesmall">',(0,f.default)("There was an error getting the data for this collection"),": <%- model.error %>","</div>","<% } %>"]),purged:u.default.wrapTemplate(["<% if( model.purged ){ %>",'<div class="purged-msg warningmessagesmall">',(0,f.default)("This collection has been deleted and removed from disk"),"</div>","<% } %>"]),deleted:u.default.wrapTemplate(["<% if( model.deleted && !model.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,f.default)("This collection has been deleted"),"</div>","<% } %>"])}),i=u.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- collection.element_identifier || collection.name %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"collection"),n=u.default.wrapTemplate(['<div class="subtitle">','<% var countText = collection.element_count? ( collection.element_count + " " ) : ""; %>','<%        if( collection.collection_type === "list" ){ %>',(0,f.default)("a list of <%- countText %>datasets"),'<% } else if( collection.collection_type === "paired" ){ %>',(0,f.default)("a pair of datasets"),'<% } else if( collection.collection_type === "list:paired" ){ %>',(0,f.default)("a list of <%- countText %>dataset pairs"),'<% } else if( collection.collection_type === "list:list" ){ %>',(0,f.default)("a list of <%- countText %>dataset lists"),"<% } %>","</div>"],"collection");return e.extend({},p.prototype.templates,{warnings:t,titleBar:i,subtitle:n})}();var g=m.extend({className:m.prototype.className+" dataset-collection-element",initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log("DCEListItemView.initialize:",e),m.prototype.initialize.call(this,e)},toString:function(){return"DCEListItemView("+(this.model?""+this.model:"(no model)")+")"}});g.prototype.templates=function(){var t=u.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>",'<div class="subtitle"></div>',"</div>"],"element");return e.extend({},m.prototype.templates,{titleBar:t})}();var v=d.default.DatasetListItemView.extend({className:d.default.DatasetListItemView.prototype.className+" dataset-collection-element",initialize:function(e){e.logger&&(this.logger=this.model.logger=e.logger),this.log("DatasetDCEListItemView.initialize:",e),d.default.DatasetListItemView.prototype.initialize.call(this,e)},_fetchModelDetails:function(){var e=this;return e.model.inReadyState()&&!e.model.hasDetails()?e.model.fetch({silent:!0}):a.when()},toString:function(){return"DatasetDCEListItemView("+(this.model?""+this.model:"(no model)")+")"}});v.prototype.templates=function(){var t=u.default.wrapTemplate(['<div class="title-bar clear" tabindex="0">','<span class="state-icon"></span>','<div class="title">','<span class="name"><%- element.element_identifier %></span>',"</div>","</div>"],"element");return e.extend({},d.default.DatasetListItemView.prototype.templates,{titleBar:t})}();var w=_.extend({className:_.prototype.className+" dataset-collection-element",_swapNewRender:function(e){_.prototype._swapNewRender.call(this,e);var t=this.model.get("state")||"ok";return this.$el.addClass("state-"+t),this.$el},toString:function(){return"NestedDCDCEListItemView("+(this.model?""+this.model:"(no model)")+")"}});t.default={DCListItemView:_,DCEListItemView:g,DatasetDCEListItemView:v,NestedDCDCEListItemView:w}}).call(t,i(2),i(0),i(0))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(20),o=a(s),r=i(4),l=a(r),d=e.View.extend({initialize:function(t){this.model=new e.Model(t),this.url=this.model.get("url"),this.redirect=this.model.get("redirect"),this.setElement("<div/>"),this.render()},render:function(){var e=this;n.ajax({url:Galaxy.root+this.url,type:"GET"}).done(function(t){var i=n.extend({},e.model.attributes,t),a=new o.default({title:i.title,message:i.message,status:i.status||"warning",icon:i.icon,inputs:i.inputs,buttons:{submit:new l.default.Button({tooltip:i.submit_tooltip,title:i.submit_title||"Save",icon:i.submit_icon||"fa-save",cls:"btn btn-primary ui-clear-float",onclick:function(){e._submit(a)}})}});e.$el.empty().append(a.$el)}).fail(function(t){e.$el.empty().append(new l.default.Message({message:"Failed to load resource "+e.url+".",status:"danger",persistent:!0}).$el)})},_submit:function(e){var t=this;n.ajax({url:Galaxy.root+t.url,data:JSON.stringify(e.data.create()),type:"PUT",contentType:"application/json"}).done(function(i){var a={};i.id?a.id=i.id:a={message:i.message,status:"success",persistent:!1},t.redirect?window.location=Galaxy.root+t.redirect+"?"+n.param(a):(e.data.matchModel(i,function(t,i){e.field_list[i].value(t.value)}),t._showMessage(e,success_message))}).fail(function(i){t._showMessage(e,{message:i.responseJSON.err_msg,status:"danger",persistent:!1})})},_showMessage:function(e,t){e.$el.parents().filter(function(){return-1!=["auto","scroll"].indexOf(n(this).css("overflow"))}).first().animate({scrollTop:0},500),e.message.update(t)}});t.default={View:d}}).call(t,i(1),i(0))},,,,,,,,function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(166),r=s(o),l=i(8),d=s(l),c=i(7),u=s(c),h=d.default.SearchableModelMixin,f=e.Model.extend(d.default.LoggableMixin).extend(d.default.mixin(h,{_logNamespace:"dataset",defaults:{state:r.default.NEW,deleted:!1,purged:!1,name:"(unnamed dataset)",accessible:!0,data_type:"",file_ext:"",file_size:0,meta_files:[],misc_blurb:"",misc_info:"",tags:[]},initialize:function(e,t){this.debug(this+"(Dataset).initialize",e,t),
//!! this state is not in trans.app.model.Dataset.states - set it here -
this.get("accessible")||this.set("state",r.default.NOT_VIEWABLE),this.urls=this._generateUrls(),this._setUpListeners()},_generateUrls:function(){var e=this.get("id");if(!e)return{};var t={purge:"datasets/"+e+"/purge_async",display:"datasets/"+e+"/display/?preview=True",edit:"datasets/edit?dataset_id="+e,download:"datasets/"+e+"/display"+this._downloadQueryParameters(),report_error:"dataset/errors?id="+e,rerun:"tool_runner/rerun?id="+e,show_params:"datasets/"+e+"/show_params",visualization:"visualization",meta_download:"dataset/get_metadata_file?hda_id="+e+"&metadata_name="};return n.each(t,function(e,i){t[i]=Galaxy.root+e}),this.urls=t,t},_downloadQueryParameters:function(){return"?to_ext="+this.get("file_ext")},_setUpListeners:function(){this.on("change:state",function(e,t){this.log(this+" has changed state:",e,t),this.inReadyState()&&this.trigger("state:ready",e,t,this.previous("state"))}),this.on("change:id change:file_ext",function(e){this._generateUrls()})},toJSON:function(){var t=e.Model.prototype.toJSON.call(this);return n.extend(t,{urls:this.urls})},isDeletedOrPurged:function(){return this.get("deleted")||this.get("purged")},inReadyState:function(){var e=n.contains(r.default.READY_STATES,this.get("state"));return this.isDeletedOrPurged()||e},hasDetails:function(){return!this.get("accessible")||this.has("annotation")},hasData:function(){return this.get("file_size")>0},fetch:function(t){var i=this;return e.Model.prototype.fetch.call(this,t).always(function(){i._generateUrls()})},parse:function(t,i){var n=e.Model.prototype.parse.call(this,t,i);return n.create_time&&(n.create_time=new Date(n.create_time)),n.update_time&&(n.update_time=new Date(n.update_time)),n},save:function(t,i){return i=i||{},i.wait=!!n.isUndefined(i.wait)||i.wait,e.Model.prototype.save.call(this,t,i)},delete:function(e){return this.get("deleted")?a.when():this.save({deleted:!0},e)},undelete:function(e){return!this.get("deleted")||this.get("purged")?a.when():this.save({deleted:!1},e)},purge:function(e){if(this.get("purged"))return a.when();e=e||{},e.url=this.urls.purge;var t=this,i=a.ajax(e);return i.done(function(e,i,n){t.set({deleted:!0,purged:!0})}),i.fail(function(i,n,a){var s=(0,u.default)("Unable to purge dataset");i.responseJSON&&i.responseJSON.error?s=i.responseJSON.error:-1!==i.responseText.indexOf("Removal of datasets by users is not allowed in this Galaxy instance")&&(s="Removal of datasets by users is not allowed in this Galaxy instance"),i.responseText=s,t.trigger("error",t,i,e,(0,u.default)(s),{error:s})}),i},searchAttributes:["name","file_ext","genome_build","misc_blurb","misc_info","annotation","tags"],searchAliases:{title:"name",format:"file_ext",database:"genome_build",blurb:"misc_blurb",description:"misc_blurb",info:"misc_info",tag:"tags"},toString:function(){var e=this.get("id")||"";return this.get("name")&&(e='"'+this.get("name")+'",'+e),"Dataset("+e+")"}})),p=e.Collection.extend(d.default.LoggableMixin).extend({_logNamespace:"dataset",model:f,urlRoot:Galaxy.root+"api/datasets",url:function(){return this.urlRoot},ids:function(){return this.map(function(e){return e.get("id")})},notReady:function(){return this.filter(function(e){return!e.inReadyState()})},haveDetails:function(){return this.all(function(e){return e.hasDetails()})},ajaxQueue:function(e,t){var i=a.Deferred(),n=this.length,s=[];if(!n)return i.resolve([]),i;var o=this.chain().reverse().map(function(a,r){return function(){var l=e.call(a,t);l.done(function(e){i.notify({curr:r,total:n,response:e,model:a})}),l.always(function(e){s.push(e),o.length?o.shift()():i.resolve(s)})}}).value();return o.shift()(),i},matches:function(e){return this.filter(function(t){return t.matches(e)})},toString:function(){return["DatasetAssociationCollection(",this.length,")"].join("")}});t.default={DatasetAssociation:f,DatasetAssociationCollection:p}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(166),s=(n(a),i(8)),o=(n(s),i(7)),r=(n(o),{defaults:{history_id:null,history_content_type:null,hid:null,visible:!0},idAttribute:"type_id",hidden:function(){return!this.get("visible")},isVisible:function(e,t){var i=!0;return e||!this.get("deleted")&&!this.get("purged")||(i=!1),t||this.get("visible")||(i=!1),i},urlRoot:Galaxy.root+"api/histories/",url:function(){var e=this.get("history_content_type"),t=this.get("history_id"),i=this.get("id");return""+this.urlRoot+t+"/contents/"+e+"s/"+i},hide:function(t){return this.get("visible")?this.save({visible:!1},t):e.when()},unhide:function(t){return this.get("visible")?e.when():this.save({visible:!0},t)},toString:function(){return[this.get("type_id"),this.get("hid"),this.get("name")].join(":")}});t.default={HistoryContentMixin:r}}).call(t,i(0))},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var i={_validationWarning:function(e,t){"name"===e&&(e=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),t?(e=e||this.$(".validation-warning"),e.removeClass("validation-warning")):e.addClass("validation-warning")},_changeHideOriginals:function(e){this.hideOriginals=this.$(".hide-originals").prop("checked")},_changeName:function(e){this._validationWarning("name",!!this._getName())},_nameCheckForEnter:function(e){13!==e.keyCode||this.blocking||this._clickCreate()},_getName:function(){return e.escape(this.$(".collection-name").val())},_clickMoreHelp:function(e){e.stopPropagation(),this.$(".main-help").addClass("expanded"),this.$(".more-help").hide()},_clickLessHelp:function(e){e.stopPropagation(),this.$(".main-help").removeClass("expanded"),this.$(".more-help").show()},_toggleHelp:function(e){e.stopPropagation(),this.$(".main-help").toggleClass("expanded"),this.$(".more-help").toggle()},_showAlert:function(e,t){t=t||"alert-danger",this.$(".main-help").hide(),this.$(".header .alert").attr("class","alert alert-dismissable").addClass(t).show().find(".alert-message").html(e)},_hideAlert:function(e){this.$(".main-help").show(),this.$(".header .alert").hide()},_cancelCreate:function(e){"function"==typeof this.oncancel&&this.oncancel.call(this)},_clickCreate:function(e){var t=this._getName();t?this.blocking||this.createList(t):this._validationWarning("name")},_setUpCommonSettings:function(e){this.hideOriginals=e.defaultHideSourceItems||!1},_renderFooter:function(t,i){var n=this,a=this.$(".footer").empty().html(this.templates.footer());return e.each(this.footerSettings,function(e,t){n.$(t).prop("checked",n[e])}),"function"==typeof this.oncancel&&this.$(".cancel-create.btn").show(),a},_creatorTemplates:{main:e.template(['<div class="header flex-row no-flex"></div>','<div class="middle flex-row flex-row-container"></div>','<div class="footer flex-row no-flex"></div>'].join(""))}};t.default={CollectionCreatorMixin:i}}).call(t,i(2))},function(e,t,i){"use strict";function n(e,t){var i=/(-?[0-9\.]+)/g,n=e.toString().toLowerCase()||"",a=t.toString().toLowerCase()||"",s=String.fromCharCode(0),o=n.replace(i,s+"$1"+s).split(s),r=a.replace(i,s+"$1"+s).split(s),l=new Date(n).getTime(),d=l?new Date(a).getTime():null;if(d){if(l<d)return-1;if(l>d)return 1}for(var c,u,h=0,f=Math.max(o.length,r.length);h<f;h++){if(c=parseFloat(o[h])||o[h],u=parseFloat(r[h])||r[h],c<u)return-1;if(c>u)return 1}return 0}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,i){"use strict";var n=i(0),a=function(e){return e&&e.__esModule?e:{default:e}}(n),s=a.default;a.default.fn.extend({hoverhighlight:function(e,t){return e=e||"body",this.length?(s(this).each(function(){var i=s(this),n=i.data("target");n&&i.mouseover(function(i){s(n,e).css({background:t})}).mouseout(function(e){s(n).css({background:""})})}),this):this}})},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(61),d=s(l),c=i(4),u=s(c),h=i(20),f=s(h),p=i(44),m=s(p),_=i(60),g=s(_),v=i(9),w=s(v),b=i(40),y=s(b),x=i(190),k=s(x),C=e.View.extend({initialize:function(t){var i=this;this.modal=parent.Galaxy.modal||new w.default.View,this.model=t&&t.model||new e.Model(t),this.deferred=new d.default,this.setElement(n("<div/>").addClass("ui-form-composite").append(this.$message=n("<div/>")).append(this.$header=n("<div/>")).append(this.$steps=n("<div/>"))),n("body").append(this.$el),this._configure(),this.render(),n(window).resize(function(){i._refresh()})},_refresh:function(e){var t=a.reduce(this.$el.children(),function(e,t){return e+n(t).outerHeight()},0)-this.$steps.height()+90;this.$steps.css("height",n(window).height()-t)},_configure:function(){function e(e,n){for(var a,s=/\$\{(.+?)\}/g;a=s.exec(String(e));){var o=a[1];n(t.wp_inputs[o]=t.wp_inputs[o]||{label:o,name:o,type:"text",color:"hsl( "+100*++i+", 70%, 30% )",style:"ui-form-wp-source",links:[]})}}var t=this;this.forms=[],this.steps=[],this.links=[],this.parms=[],a.each(this.model.get("steps"),function(e,i){Galaxy.emit.debug("tool-form-composite::initialize()",i+" : Preparing workflow step.");var n=k.default[e.step_type],s=parseInt(i+1)+": "+(e.step_label||e.step_name);e.annotation&&(s+=" - "+e.annotation),e.step_version&&(s+=" (Galaxy Version "+e.step_version+")"),e=r.default.merge({index:i,fixed_title:a.escape(s),icon:n||"",help:null,citations:null,collapsible:!0,collapsed:i>0&&!t._isDataStep(e),sustain_version:!0,sustain_repeats:!0,sustain_conditionals:!0,narrow:!0,text_enable:"Edit",text_disable:"Undo",cls_enable:"fa fa-edit",cls_disable:"fa fa-undo",errors:e.messages,initial_errors:!0,cls:"ui-portlet-narrow",hide_operations:!0,needs_refresh:!1,always_refresh:"tool"!=e.step_type},e),t.steps[i]=e,t.links[i]=[],t.parms[i]={}}),a.each(this.steps,function(e,i){m.default.visitInputs(e.inputs,function(e,n){t.parms[i][n]=e})}),a.each(this.steps,function(e,i){a.each(e.output_connections,function(e){a.each(t.steps,function(n,a){n.step_index===e.input_step_index&&t.links[i].push(n)})})}),a.each(this.steps,function(e,i){a.each(t.steps,function(n,s){var o={};a.each(e.output_connections,function(e){n.step_index===e.input_step_index&&(o[e.input_name]=e)}),a.each(t.parms[s],function(t,n){var a=o[n];a&&(t.type="hidden",t.help=t.step_linked?t.help+", ":"",t.help+="Output dataset '"+a.output_name+"' from step "+(parseInt(i)+1),t.step_linked=t.step_linked||[],t.step_linked.push(e))})})});var i=0;this.wp_inputs={},a.each(this.steps,function(i,n){a.each(t.parms[n],function(t,n){e(t.value,function(e){e.links.push(i),t.wp_linked=!0,t.type="text",t.backdrop=!0,t.style="ui-form-wp-target"})}),a.each(i.post_job_actions,function(t){a.each(t.action_arguments,function(t){e(t,function(){})})})}),a.each(this.steps,function(e,i){if("tool"==e.step_type){var n=!0;m.default.visitInputs(e.inputs,function(i,a,s){var o=i.value&&"RuntimeValue"==i.value.__class__,l=-1!=["data","data_collection"].indexOf(i.type),d=s[i.data_ref];i.step_linked&&!t._isDataStep(i.step_linked)&&(n=!1),i.options&&(0==i.options.length&&!n||i.wp_linked)&&(i.is_workflow=!0),d&&(i.is_workflow=d.step_linked&&!t._isDataStep(d.step_linked)||i.wp_linked),(l||i.value&&"RuntimeValue"==i.value.__class__&&!i.step_linked)&&(e.collapsed=!1),o&&(i.value=i.default_value),i.flavor="workflow",o||l||"hidden"===i.type||i.wp_linked||(i.optional||!r.default.isEmpty(i.value)&&""!==i.value)&&(i.collapsible_value=i.value,i.collapsible_preview=!0)})}})},render:function(){var e=this;this.deferred.reset(),this._renderHeader(),this._renderMessage(),this._renderParameters(),this._renderHistory(),a.each(this.steps,function(t){e._renderStep(t)})},_renderHeader:function(){var e=this;this.execute_btn=new u.default.Button({icon:"fa-check",title:"Run workflow",cls:"btn btn-primary",onclick:function(){e._execute()}}),this.$header.addClass("ui-form-header").empty().append(new u.default.Label({title:"Workflow: "+this.model.get("name")}).$el).append(this.execute_btn.$el)},_renderMessage:function(){this.$message.empty(),this.model.get("has_upgrade_messages")&&this.$message.append(new u.default.Message({message:"Some tools in this workflow may have changed since it was last saved or some errors were found. The workflow may still run, but any new options will have default values. Please review the messages below to make a decision about whether the changes will affect your analysis.",status:"warning",persistent:!0,fade:!1}).$el);var e=this.model.get("step_version_changes");e&&e.length>0&&this.$message.append(new u.default.Message({message:"Some tools are being executed with different versions compared to those available when this workflow was last saved because the other versions are not or no longer available on this Galaxy instance. To upgrade your workflow and dismiss this message simply edit the workflow and re-save it.",status:"warning",persistent:!0,fade:!1}).$el)},_renderParameters:function(){var e=this;this.wp_form=null,a.isEmpty(this.wp_inputs)||(this.wp_form=new f.default({title:"<b>Workflow Parameters</b>",inputs:this.wp_inputs,cls:"ui-portlet-narrow",onchange:function(){a.each(e.wp_form.input_list,function(t,i){a.each(t.links,function(t){e._refreshStep(t)})})}}),this._append(this.$steps.empty(),this.wp_form.$el))},_renderHistory:function(){this.history_form=new f.default({cls:"ui-portlet-narrow",title:"<b>History Options</b>",inputs:[{type:"conditional",name:"new_history",test_param:{name:"check",label:"Send results to a new history",type:"boolean",value:"false",help:""},cases:[{value:"true",inputs:[{name:"name",label:"History name",type:"text",value:this.model.get("name")}]}]}]}),this._append(this.$steps,this.history_form.$el)},_renderStep:function(e){var t=this,i=null;this.deferred.execute(function(s){if(t.$steps.addClass("ui-steps"),"tool"==e.step_type)e.postchange=function(t,i){var a={tool_id:e.id,tool_version:e.version,inputs:n.extend(!0,{},i.data.create())};i.wait(!0),Galaxy.emit.debug("tool-form-composite::postchange()","Sending current state.",a),r.default.request({type:"POST",url:Galaxy.root+"api/tools/"+e.id+"/build",data:a,success:function(e){i.update(e),i.wait(!1),Galaxy.emit.debug("tool-form-composite::postchange()","Received new model.",e),t.resolve()},error:function(e){Galaxy.emit.debug("tool-form-composite::postchange()","Refresh request failed.",e),t.reject()}})},i=new g.default(e),e.post_job_actions&&e.post_job_actions.length&&i.portlet.append(n("<div/>").addClass("ui-form-element-disabled").append(n("<div/>").addClass("ui-form-title").html("<b>Job Post Actions</b>")).append(n("<div/>").addClass("ui-form-preview").html(a.reduce(e.post_job_actions,function(e,t){return e+" "+t.short_str},""))));else{var o=-1!=["data_input","data_collection_input"].indexOf(e.step_type);a.each(e.inputs,function(e){e.flavor="module",e.hide_label=o}),i=new f.default(r.default.merge({title:e.fixed_title,onchange:function(){a.each(t.links[e.index],function(e){t._refreshStep(e)})},inputs:e.inputs&&e.inputs.length>0?e.inputs:[{type:"hidden",name:"No options available.",ignore:null}]},e))}t.forms[e.index]=i,t._append(t.$steps,i.$el),t._refresh(),e.needs_refresh&&t._refreshStep(e),i.portlet[t.show_progress?"disable":"enable"](),t.show_progress&&t.execute_btn.model.set({wait:!0,wait_text:"Preparing...",percentage:100*(e.index+1)/t.steps.length}),Galaxy.emit.debug("tool-form-composite::initialize()",e.index+" : Workflow step state ready.",e),setTimeout(function(){s.resolve()},0)})},_refreshStep:function(e){var t=this,i=this.forms[e.index];i?(a.each(t.parms[e.index],function(e,n){if(e.step_linked||e.wp_linked){var s=i.field_list[i.data.match(n)];if(s){var o=void 0;if(e.step_linked)o={values:[]},a.each(e.step_linked,function(e){if(t._isDataStep(e)){var i=t.forms[e.index].data.create().input;i&&a.each(i.values,function(e){o.values.push(e)})}}),!e.multiple&&o.values.length>0&&(o={values:[o.values[0]]});else if(e.wp_linked){o=e.value;for(var r,l=/\$\{(.+?)\}/g;r=l.exec(e.value);){var d=t.wp_form.field_list[t.wp_form.data.match(r[1])],c=d&&d.value();c&&(o=o.split(r[0]).join(c))}}void 0!==o&&s.value(o)}}}),i.trigger("change")):e.needs_refresh=!0},_refreshHistory:function(){var e=this,t=parent.Galaxy&&parent.Galaxy.currHistoryPanel&&parent.Galaxy.currHistoryPanel.model;this._refresh_history&&clearTimeout(this._refresh_history),t&&t.refresh().success(function(){0===t.numOfUnfinishedShownContents()&&(e._refresh_history=setTimeout(function(){e._refreshHistory()},t.UPDATE_DELAY))})},_execute:function(){var e=this;this.show_progress=!0,this._enabled(!1),this.deferred.execute(function(t){setTimeout(function(){t.resolve(),e._submit()},0)})},_submit:function(){var e=this,t=this.history_form.data.create(),i={new_history_name:t["new_history|name"]?t["new_history|name"]:null,history_id:t["new_history|name"]?null:this.model.get("history_id"),replacement_params:this.wp_form?this.wp_form.data.create():{},parameters:{},parameters_normalized:!0,batch:!0},a=!0;for(var s in this.forms){var o=this.forms[s],l=o.data.create(),d=e.steps[s],c=d.step_index;o.trigger("reset");for(var u in l){var h=l[u],f=o.data.match(u),p=(o.field_list[f],o.input_list[f]);if(!p.step_linked){if(!(a=this._isDataStep(d)?h&&h.values&&h.values.length>0:p.optional||p.is_workflow&&""!==h||!p.is_workflow&&null!==h)){o.highlight(f);break}i.parameters[c]=i.parameters[c]||{},i.parameters[c][u]=l[u]}}if(!a)break}a?(Galaxy.emit.debug("tool-form-composite::submit()","Validation complete.",i),r.default.request({type:"POST",url:Galaxy.root+"api/workflows/"+this.model.id+"/invocations",data:i,success:function(t){if(Galaxy.emit.debug("tool-form-composite::submit","Submission successful.",t),e.$el.children().hide(),e.$el.append(e._templateSuccess(t)),n.isArray(t)&&t.length>0){e.$el.append(n("<div/>",{id:"webhook-view"}));new y.default.WebhookView({urlRoot:Galaxy.root+"api/webhooks/workflow",toolId:i.tool_id,toolVersion:i.tool_version})}e._refreshHistory()},error:function(t){Galaxy.emit.debug("tool-form-composite::submit","Submission failed.",t);var n=!1;if(t&&t.err_data)for(var a in e.forms){var s=e.forms[a],o=t.err_data[s.model.get("step_index")];if(o){var r=s.data.matchResponse(o);for(var l in r){s.highlight(l,r[l]),n=!0;break}}}n||e.modal.show({title:"Workflow submission failed",body:e._templateError(i,t&&t.err_msg),buttons:{Close:function(){e.modal.hide()}}})},complete:function(){e._enabled(!0)}})):(e._enabled(!0),Galaxy.emit.debug("tool-form-composite::submit()","Validation failed.",i))},_append:function(e,t){e.append("<p/>").append(t)},_enabled:function(e){this.execute_btn.model.set({wait:!e,wait_text:"Sending...",percentage:-1}),this.wp_form&&this.wp_form.portlet[e?"enable":"disable"](),this.history_form&&this.history_form.portlet[e?"enable":"disable"](),a.each(this.forms,function(t){t&&t.portlet[e?"enable":"disable"]()})},_isDataStep:function(e){for(var t=n.isArray(e)?e:[e],i=0;i<t.length;i++){var a=t[i];if(!a||!a.step_type||!a.step_type.startsWith("data"))return!1}return!0},_templateSuccess:function(e){return n.isArray(e)&&e.length>0?n("<div/>").addClass("donemessagelarge").append(n("<p/>").html("Successfully invoked workflow <b>"+r.default.sanitize(this.model.get("name"))+"</b>"+(e.length>1?" <b>"+e.length+" times</b>":"")+".")).append(n("<p/>").append("<b/>").text("You can check the status of queued jobs and view the resulting data by refreshing the History pane. When the job has been run the status will change from 'running' to 'finished' if completed successfully or 'error' if problems were encountered.")):this._templateError(e,"Invalid success response. No invocations found.")},_templateError:function(e,t){return n("<div/>").addClass("errormessagelarge").append(n("<p/>").text("The server could not complete the request. Please contact the Galaxy Team if this error persists. "+(JSON.stringify(t)||""))).append(n("<pre/>").text(JSON.stringify(e,null,4)))}});t.default={View:C}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(9),r=s(o),l=i(212),d=s(l),c=i(7),u=s(c),h={defaultName:e.template("Copy of '<%- name %>'"),title:e.template((0,u.default)("Copying history")+' "<%- name %>"'),submitLabel:(0,u.default)("Copy"),errorMessage:(0,u.default)("History could not be copied."),progressive:(0,u.default)("Copying history"),activeLabel:(0,u.default)("Copy only the active, non-deleted datasets"),allLabel:(0,u.default)("Copy all datasets including deleted ones"),anonWarning:(0,u.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,u.default)("after copying this history. "),_template:e.template(["<% if( isAnon ){ %>",'<div class="warningmessage">',"<%- anonWarning %>",(0,u.default)("You can"),' <a href="/user/login">',(0,u.default)("login here"),"</a> ",(0,u.default)("or")," ",' <a href="/user/create">',(0,u.default)("register here"),"</a>.","</div>","<% } %>","<form>",'<label for="copy-modal-title">',(0,u.default)("Enter a title for the new history"),":","</label><br />",'<input id="copy-modal-title" class="form-control" style="width: 100%" value="<%= name %>" />','<p class="invalid-title bg-danger" style="color: red; margin: 8px 0px 8px 0px; display: none">',(0,u.default)("Please enter a valid history title"),"</p>","<% if( allowAll ){ %>","<br />","<p>",(0,u.default)("Choose which datasets from the original history to include:"),"</p>",'<input name="copy-what" type="radio" id="copy-non-deleted" value="copy-non-deleted" ','<% if( copyWhat === "copy-non-deleted" ){ print( "checked" ); } %>/>','<label for="copy-non-deleted"> <%- activeLabel %></label>',"<br />",'<input name="copy-what" type="radio" id="copy-all" value="copy-all" ','<% if( copyWhat === "copy-all" ){ print( "checked" ); } %>/>','<label for="copy-all"> <%- allLabel %></label>',"<% } %>","</form>"].join("")),_showAjaxIndicator:function(){var e='<p><span class="fa fa-spinner fa-spin"></span> '+this.progressive+"...</p>";this.modal.$(".modal-body").empty().append(e).css({"margin-top":"8px"})},dialog:function(t,i,s){function o(){var e=t.$("#copy-modal-title").val();if(!e)return void t.$(".invalid-title").show();var n="copy-all"===t.$('input[name="copy-what"]:checked').val();t.$("button").prop("disabled",!0),r._showAjaxIndicator(),i.copy(!0,e,n).done(function(e){l.resolve(e)}).fail(function(t,a,s){var o={name:e,copyAllDatasets:n};d.default.ajaxErrorModal(i,t,o,r.errorMessage),l.rejectWith(l,arguments)}).done(function(){m&&t.hide()})}s=s||{};var r=this,l=n.Deferred(),c=s.nameFn||this.defaultName,h=c({name:i.get("name")}),f=s.allDatasets?"copy-all":"copy-non-deleted",p=!!e.isUndefined(s.allowAll)||s.allowAll,m=!!e.isUndefined(s.autoClose)||s.autoClose;this.modal=t;var _=s.closing_callback;return t.show(e.extend(s,{title:this.title({name:i.get("name")}),body:a(r._template({name:h,isAnon:Galaxy.user.isAnonymous(),allowAll:p,copyWhat:f,activeLabel:this.activeLabel,allLabel:this.allLabel,anonWarning:this.anonWarning})),buttons:e.object([[(0,u.default)("Cancel"),function(){t.hide()}],[this.submitLabel,o]]),height:"auto",closing_events:!0,closing_callback:function(e){e&&l.reject({cancelled:!0}),_&&_(e)}})),t.$("#copy-modal-title").focus().select(),t.$("#copy-modal-title").on("keydown",function(e){13===e.keyCode&&(e.preventDefault(),o())}),l}},f=e.extend({},h,{defaultName:e.template("imported: <%- name %>"),title:e.template((0,u.default)("Importing history")+' "<%- name %>"'),submitLabel:(0,u.default)("Import"),errorMessage:(0,u.default)("History could not be imported."),progressive:(0,u.default)("Importing history"),activeLabel:(0,u.default)("Import only the active, non-deleted datasets"),allLabel:(0,u.default)("Import all datasets including deleted ones"),anonWarning:(0,u.default)("As an anonymous user, unless you login or register, you will lose your current history ")+(0,u.default)("after importing this history. ")}),p=function(e,t){t=t||{};var i=window.parent.Galaxy.modal||new r.default.View({});return t.useImport?f.dialog(i,e,t):h.dialog(i,e,t)};t.default=p}).call(t,i(2),i(0),i(0))},function(e,t,i){"use strict";(function(e,n){function a(t,i,n){return Galaxy.modal.show({title:i,body:t,closing_events:!0,buttons:{Ok:function(){Galaxy.modal.hide()}}}),Galaxy.modal.$el.addClass("error-modal"),n&&(Galaxy.modal.$(".error-details").add(Galaxy.modal.$('button:contains("Details")')).remove(),e("<div/>").addClass("error-details").hide().appendTo(Galaxy.modal.$(".modal-content")).append([e("<p/>").text(p),e("<pre/>").text(JSON.stringify(n,null,"  "))]),e('<button id="button-1" class="pull-left">'+(0,u.default)("Details")+"</button>").appendTo(Galaxy.modal.$(".buttons")).click(function(){Galaxy.modal.$(".error-details").toggle()})),Galaxy.modal}function s(e,t,i){if(e){if(e=(0,u.default)(e),t=(0,u.default)(t)||(0,u.default)("Error:"),window.Galaxy&&Galaxy.modal)return a(e,t,i);alert(t+"\n\n"+e),console.log("error details:",JSON.stringify(i))}}function o(){return s((0,u.default)("You appear to be offline. Please check your connection and try again."),(0,u.default)("Offline?"))}function r(){return s((0,u.default)("Galaxy is currently unreachable. Please try again in a few minutes.")+" "+h,(0,u.default)("Cannot connect to Galaxy"))}function l(e,t,i,n,a){return n=n||f,n+=" "+h,a=a||(0,u.default)("An error occurred"),s(n,a,d(e,t,i))}function d(e,t,i){return{raven:n.result(window.Raven,"lastEventId"),userAgent:navigator.userAgent,onLine:navigator.onLine,version:n.result(Galaxy.config,"version_major"),xhr:n.omit(t,n.functions(t)),options:n.omit(i,"xhr"),url:n.result(Galaxy.lastAjax,"url"),data:n.result(Galaxy.lastAjax,"data"),model:n.result(e,"toJSON",""+e),user:n.omit(n.result(Galaxy.user,"toJSON"),"email")}}Object.defineProperty(t,"__esModule",{value:!0});var c=i(7),u=function(e){return e&&e.__esModule?e:{default:e}}(c),h=(0,u.default)("Please contact a Galaxy administrator if the problem persists."),f=(0,u.default)("An error occurred while updating information with the server."),p=(0,u.default)("The following information can assist the developers in finding the source of the error:");t.default={errorModal:s,offlineErrorModal:o,badGatewayErrorModal:r,ajaxErrorModal:l}}).call(t,i(0),i(2))},function(e,t,i){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}Object.defineProperty(t,"__esModule",{value:!0});var a=i(2),s=n(a),o=i(1),r=n(o),l=i(8),d=function(e){return e&&e.__esModule?e:{default:e}}(l),c=r.Collection.extend({initialize:function(e,t){r.Collection.prototype.initialize.call(this,e,t),this.setOrder(t.order||this.order,{silent:!0})},_setUpListeners:function(){return this.on({"changed-order":this.sort})},fetch:function(e){return e=this._buildFetchOptions(e),Galaxy.debug("fetch options:",e),r.Collection.prototype.fetch.call(this,e)},_buildFetchOptions:function(e){e=s.clone(e)||{};var t=this;e.traditional=!0,e.data=e.data||t._buildFetchData(e),Galaxy.debug("data:",e.data);var i=this._buildFetchFilters(e);return Galaxy.debug("filters:",i),s.isEmpty(i)||s.extend(e.data,this._fetchFiltersToAjaxData(i)),Galaxy.debug("data:",e.data),e},_buildFetchData:function(e){var t={};return this.order&&(t.order=this.order),s.defaults(s.pick(e,this._fetchParams),t)},_fetchParams:["order","limit","offset","view","keys"],_buildFetchFilters:function(e){return s.clone(e.filters||{})},_fetchFiltersToAjaxData:function(e){var t={q:[],qv:[]};return s.each(e,function(e,i){void 0!==e&&""!==e&&(!0===e&&(e="True"),!1===e&&(e="False"),null===e&&(e="None"),t.q.push(i),t.qv.push(e))}),t},reset:function(e,t){return this.allFetched=!1,r.Collection.prototype.reset.call(this,e,t)},order:null,comparators:{update_time:d.default.buildComparator("update_time",{ascending:!1}),"update_time-asc":d.default.buildComparator("update_time",{ascending:!0}),create_time:d.default.buildComparator("create_time",{ascending:!1}),"create_time-asc":d.default.buildComparator("create_time",{ascending:!0})},setOrder:function(e,t){t=t||{};var i=this,n=i.comparators[e];if(s.isUndefined(n))throw new Error("unknown order: "+e);if(n!==i.comparator)return i.order=e,i.comparator=n,t.silent||i.trigger("changed-order",t),i}}),u=c.extend({limitPerPage:500,initialize:function(e,t){c.prototype.initialize.call(this,e,t),this.currentPage=t.currentPage||0},getTotalItemCount:function(){return this.length},shouldPaginate:function(){return this.getTotalItemCount()>=this.limitPerPage},getLastPage:function(){return Math.floor(this.getTotalItemCount()/this.limitPerPage)},getPageCount:function(){return this.getLastPage()+1},getPageLimitOffset:function(e){return e=this.constrainPageNum(e),{limit:this.limitPerPage,offset:e*this.limitPerPage}},constrainPageNum:function(e){return Math.max(0,Math.min(e,this.getLastPage()))},fetchPage:function(e,t){var i=this;return e=i.constrainPageNum(e),i.currentPage=e,t=s.defaults(t||{},i.getPageLimitOffset(e)),i.trigger("fetching-more"),i.fetch(t).always(function(){i.trigger("fetching-more-done")})},fetchCurrentPage:function(e){return this.fetchPage(this.currentPage,e)},fetchPrevPage:function(e){return this.fetchPage(this.currentPage-1,e)},fetchNextPage:function(e){return this.fetchPage(this.currentPage+1,e)}}),h=c.extend({limitOnFirstFetch:null,limitPerFetch:100,initialize:function(e,t){c.prototype.initialize.call(this,e,t),this.limitOnFirstFetch=t.limitOnFirstFetch||this.limitOnFirstFetch,this.limitPerFetch=t.limitPerFetch||this.limitPerFetch,this.allFetched=!1,this.lastFetched=t.lastFetched||0},_buildFetchOptions:function(e){return e.remove=e.remove||!1,c.prototype._buildFetchOptions.call(this,e)},fetchFirst:function(e){return Galaxy.debug("ControlledFetchCollection.fetchFirst:",e),e=e?s.clone(e):{},this.allFetched=!1,this.lastFetched=0,this.fetchMore(s.defaults(e,{reset:!0,limit:this.limitOnFirstFetch}))},fetchMore:function(t){Galaxy.debug("ControlledFetchCollection.fetchMore:",t),t=s.clone(t||{});var i=this;if(Galaxy.debug("fetchMore, options.reset:",t.reset),!t.reset&&i.allFetched)return e.when();t.reset?t.offset=0:void 0===t.offset&&(t.offset=i.lastFetched);var n=t.limit=t.limit||i.limitPerFetch||null;return Galaxy.debug("fetchMore, limit:",n,"offset:",t.offset),i.trigger("fetching-more"),i.fetch(t).always(function(){i.trigger("fetching-more-done")}).done(function(e){var t=s.isArray(e)?e.length:0;i.lastFetched+=t,Galaxy.debug("fetchMore, lastFetched:",i.lastFetched),(!n||t<n)&&(i.allFetched=!0,i.trigger("all-fetched",this))})},fetchAll:function(e){e=e||{};var t=this;return e=s.pick(e,"silent"),e.filters={},t.fetch(e).done(function(){t.allFetched=!0,t.trigger("all-fetched",t)})}});t.default={ControlledFetchCollection:c,PaginatedCollection:u,InfinitelyScrollingCollection:h}}).call(t,i(0))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(205),s=n(a),o=i(206),r=n(o),l=i(8),d=n(l),c=i(7),u=(n(c),s.default.DatasetAssociation),h=r.default.HistoryContentMixin,f=u.extend(d.default.mixin(h,{defaults:e.extend({},u.prototype.defaults,h.defaults,{history_content_type:"dataset",model_class:"HistoryDatasetAssociation"})}));t.default={HistoryDatasetAssociation:f}}).call(t,i(2))},function(e,t,i){"use strict";(function(e){function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function e(t,i,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,n)}if("value"in a)return a.value;var o=a.get;if(void 0!==o)return o.call(n)},o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),r=function(){function t(i){a(this,t),this.deferred=e.Deferred(),this.queue=[],this.responses=[],this.numToProcess=0,this.running=!1,this.init(i||[]),this.start()}return o(t,[{key:"init",value:function(e){var t=this;e.forEach(function(e){t.add(e)})}},{key:"add",value:function(e){var t=this,i=this.queue.length;return this.numToProcess+=1,this.queue.push(function(){var n=i,a=e();a.done(function(e){t.deferred.notify({curr:n,total:t.numToProcess,response:e})}),a.always(function(e){t.responses.push(e),t.queue.length?t.queue.shift()():t.stop()})}),this}},{key:"start",value:function(){return this.queue.length&&(this.running=!0,this.queue.shift()()),this}},{key:"stop",value:function(t,i){return this.running=!1,this.queue=[],t?this.deferred.reject(i):this.deferred.resolve(this.responses),this.numToProcess=0,this.deferred=e.Deferred(),this}},{key:"done",value:function(e){return this.deferred.done(e)}},{key:"fail",value:function(e){return this.deferred.fail(e)}},{key:"always",value:function(e){return this.deferred.always(e)}},{key:"progress",value:function(e){return this.deferred.progress(e)}}],[{key:"create",value:function(e){return new t(e).deferred}}]),t}(),l=function(e){function t(e){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.names={},n}return n(t,e),o(t,[{key:"add",value:function(e){if(!e.hasOwnProperty("name")||!e.hasOwnProperty("fn"))throw new Error('NamedAjaxQueue.add requires an object with both "name" and "fn": '+JSON.stringify(e));if(!this.names.hasOwnProperty(e.name))return this.names[e.name]=!0,s(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"add",this).call(this,e.fn)}},{key:"clear",value:function(){return this.names={},this}}],[{key:"create",value:function(e){return new t(e).deferred}}]),t}(r);t.default={AjaxQueue:r,NamedAjaxQueue:l}}).call(t,i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(194),r=s(o),l=i(256),d=s(l),c=i(8),u=s(c),h=i(7),f=s(h);i(217);var p=e.View.extend(u.default.LoggableMixin).extend({_logNamespace:"list",viewClass:r.default.ListItemView,collectionClass:e.Collection,tagName:"div",className:"list-panel",fxSpeed:"fast",emptyMsg:(0,f.default)("This list is empty"),noneFoundMsg:(0,f.default)("No matching items found"),searchPlaceholder:(0,f.default)("search"),initialize:function(e,t){e=e||{},e.logger&&(this.logger=e.logger),this.log(this+".initialize:",e),this.fxSpeed=n.has(e,"fxSpeed")?e.fxSpeed:this.fxSpeed,this.filters=[],this.searchFor=e.searchFor||"",this.selecting=void 0===e.selecting||e.selecting,this.selected=e.selected||[],this.lastSelected=null,this.dragItems=e.dragItems||!1,this.viewClass=e.viewClass||this.viewClass,this.views=[],this.collection=e.collection||this._createDefaultCollection(),this.filters=e.filters||[],this.$scrollContainer=e.$scrollContainer||this.$scrollContainer,this.title=e.title||"",this.subtitle=e.subtitle||"",this._setUpListeners()},_setUpListeners:function(){return this.off(),this.on({error:function(e,t,i,n,a){console.error(e,t,i,n,a)},loading:function(){this._showLoadingIndicator("loading...",40)},"loading-done":function(){this._hideLoadingIndicator(40)}}),this.once("rendered",function(){this.trigger("rendered:initial",this)}),this._setUpCollectionListeners(),this._setUpViewListeners(),this},_createDefaultCollection:function(){return new this.collectionClass([])},_setUpCollectionListeners:function(){return this.log(this+"._setUpCollectionListeners",this.collection),this.stopListening(this.collection),this.listenTo(this.collection,{error:function(e,t,i,n,a){this.trigger("error",e,t,i,n,a)},update:function(e,t){var i=t.changes;return t.renderAll||i.added.length+i.removed.length>1?this.renderItems():1===i.added.length?this.addItemView(n.first(i.added),e,t):1===i.removed.length?this.removeItemView(n.first(i.removed),e,t):void 0}}),this},_setUpViewListeners:function(){this.log(this+"._setUpViewListeners"),this.on({"view:selected":function(e,t){if(t&&t.shiftKey&&this.lastSelected){var i=this.viewFromModelId(this.lastSelected);i&&this.selectRange(e,i)}else t&&t.altKey&&!this.selecting&&this.showSelectors();this.selected.push(e.model.id),this.lastSelected=e.model.id},"view:de-selected":function(e,t){this.selected=n.without(this.selected,e.model.id)}})},render:function(e){this.log(this+".render",e);var t=this._buildNewRender();return this._setUpBehaviors(t),this._queueNewRender(t,e),this},_buildNewRender:function(){this.debug(this+"(ListPanel)._buildNewRender");var e=a(this.templates.el({},this));return this._renderControls(e),this._renderTitle(e),this._renderSubtitle(e),this._renderSearch(e),this.renderItems(e),e},_renderControls:function(e){this.debug(this+"(ListPanel)._renderControls");var t=a(this.templates.controls({},this));return e.find(".controls").replaceWith(t),t},_renderTitle:function(e){},_renderSubtitle:function(e){},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var i=this;i.log("_queueNewRender:",e,t),a(i).queue("fx",[function(e){i.$el.fadeOut(t,e)},function(t){i._swapNewRender(e),t()},function(e){i.$el.fadeIn(t,e)},function(e){i.trigger("rendered",i),e()}])},_swapNewRender:function(e){return this.$el.empty().attr("class",this.className).append(e.children()),this.selecting&&this.showSelectors(0),this},_setUpBehaviors:function(e){return e=e||this.$el,this.$controls(e).find("[title]").tooltip(),this._renderMultiselectActionMenu(e),this},_renderMultiselectActionMenu:function(e){e=e||this.$el;var t=e.find(".list-action-menu"),i=this.multiselectActions();if(!i.length)return t.empty();var n=a(['<div class="list-action-menu btn-group">','<button class="list-action-menu-btn btn btn-default dropdown-toggle" data-toggle="dropdown">',(0,f.default)("For all selected"),"...","</button>",'<ul class="dropdown-menu pull-right" role="menu">',"</ul>","</div>"].join("")),s=i.map(function(e){var t=['<li><a href="javascript:void(0);">',e.html,"</a></li>"].join("");return a(t).click(function(t){return t.preventDefault(),e.func(t)})});return n.find("ul").append(s),t.replaceWith(n),n},multiselectActions:function(){return[]},$scrollContainer:function(e){return(e||this.$el).parent().parent()},$controls:function(e){return(e||this.$el).find("> .controls")},$list:function(e){return(e||this.$el).find("> .list-items")},$messages:function(e){return(e||this.$el).find("> .controls .messages")},$emptyMessage:function(e){return(e||this.$el).find("> .empty-message")},renderItems:function(e){e=e||this.$el;var t=this;t.log(this+".renderItems",e);var i=t.$list(e);t.freeViews();var n=t._filterCollection();return t.views=n.map(function(e){return t._createItemView(e)}),i.empty(),t.views.length&&t._attachItems(e),t._renderEmptyMessage(e).toggle(!t.views.length),t.trigger("views:ready",t.views),t.views},_filterCollection:function(){var e=this;return e.collection.filter(n.bind(e._filterItem,e))},_filterItem:function(e){var t=this;return n.every(t.filters.map(function(t){return t.call(e)}))&&(!t.searchFor||e.matchesAll(t.searchFor))},_createItemView:function(e){var t=this._getItemViewClass(e),i=n.extend(this._getItemViewOptions(e),{model:e}),a=new t(i);return this._setUpItemViewListeners(a),a},_destroyItemView:function(e){this.stopListening(e),this.views=n.without(this.views,e)},_destroyItemViews:function(e){var t=this;return t.views.forEach(function(e){t.stopListening(e)}),t.views=[],t},freeViews:function(){return this._destroyItemViews()},_getItemViewClass:function(e){return this.viewClass},_getItemViewOptions:function(e){return{fxSpeed:this.fxSpeed,expanded:!1,selectable:this.selecting,selected:n.contains(this.selected,e.id),draggable:this.dragItems}},_setUpItemViewListeners:function(e){var t=this;return this.listenTo(e,"all",function(){var e=Array.prototype.slice.call(arguments,0);e[0]="view:"+e[0],t.trigger.apply(t,e)}),this.listenTo(e,"draggable:dragstart",function(e,t){var i={},n=this.getSelectedModels();i=n.length?n.toJSON():[t.model.toJSON()],e.dataTransfer.setData("text",JSON.stringify(i))},this),t},_attachItems:function(e){var t=this;return this.$list(e).append(this.views.map(function(e){return t._renderItemView$el(e)})),this},_renderItemView$el:function(e){return e.render(0).$el},_renderEmptyMessage:function(e){this.debug("_renderEmptyMessage",e,this.searchFor);var t=this.searchFor?this.noneFoundMsg:this.emptyMsg;return this.$emptyMessage(e).text(t)},expandAll:function(){n.each(this.views,function(e){e.expand()})},collapseAll:function(){n.each(this.views,function(e){e.collapse()})},addItemView:function(e,t,i){var n=this,s=n._filterCollection().indexOf(e);if(-1!==s){var o=n._createItemView(e);return a(o).queue("fx",[function(e){n.$emptyMessage().is(":visible")?n.$emptyMessage().fadeOut(n.fxSpeed,e):e()},function(e){n._attachView(o,s),e()}]),o}},_attachView:function(e,t,i){i=!!n.isUndefined(i)||i,t=t||0;var a=this;return a.views.splice(t,0,e),a._insertIntoListAt(t,a._renderItemView$el(e).hide()),a.trigger("view:attached",e),i?e.$el.slideDown(a.fxSpeed,function(){a.trigger("view:attached:rendered")}):(e.$el.show(),a.trigger("view:attached:rendered")),e},_insertIntoListAt:function(e,t){var i=this.$list();return 0===e?i.prepend(t):i.children().eq(e-1).after(t),t},removeItemView:function(e,t,i){var s=this,o=n.find(s.views,function(t){return t.model===e});if(o)return s.views=n.without(s.views,o),s.trigger("view:removed",o),a({}).queue("fx",[function(e){o.$el.fadeOut(s.fxSpeed,e)},function(e){o.remove(),s.trigger("view:removed:rendered"),s.views.length?e():s._renderEmptyMessage().fadeIn(s.fxSpeed,e)}]),o},viewFromModelId:function(e){return n.find(this.views,function(t){return t.model.id===e})},viewFromModel:function(e){return e?this.viewFromModelId(e.id):void 0},viewsWhereModel:function(e){return this.views.filter(function(t){return n.isMatch(t.model.attributes,e)})},viewRange:function(e,t){if(e===t)return e?[e]:[];var i=this.views.indexOf(e),n=this.views.indexOf(t);return-1===i||-1===n?i===n?[]:-1===i?[t]:[e]:i<n?this.views.slice(i,n+1):this.views.slice(n,i+1)},_renderSearch:function(e){return e.find(".controls .search-input").searchInput({placeholder:this.searchPlaceholder,initialVal:this.searchFor,onfirstsearch:n.bind(this._firstSearch,this),onsearch:n.bind(this.searchItems,this),onclear:n.bind(this.clearSearch,this)}),e},_firstSearch:function(e){return this.log("onFirstSearch",e),this.searchItems(e)},searchItems:function(e,t){if(this.log("searchItems",e,this.searchFor,t),!t&&this.searchFor===e)return this;this.searchFor=e,this.renderItems(),this.trigger("search:searching",e,this);var i=this.$("> .controls .search-query");return i.val()!==e&&i.val(e),this},clearSearch:function(e){return this.searchFor="",this.trigger("search:clear",this),this.$("> .controls .search-query").val(""),this.renderItems(),this},THROTTLE_SELECTOR_FX_AT:20,showSelectors:function(e){e=void 0!==e?e:this.fxSpeed,this.selecting=!0,this.$(".list-actions").slideDown(e),e=this.views.length>=this.THROTTLE_SELECTOR_FX_AT?0:e,n.each(this.views,function(t){t.showSelector(e)})},hideSelectors:function(e){e=void 0!==e?e:this.fxSpeed,this.selecting=!1,this.$(".list-actions").slideUp(e),e=this.views.length>=this.THROTTLE_SELECTOR_FX_AT?0:e,n.each(this.views,function(t){t.hideSelector(e)}),this.selected=[],this.lastSelected=null},toggleSelectors:function(){this.selecting?this.hideSelectors():this.showSelectors()},selectAll:function(e){n.each(this.views,function(t){t.select(e)})},deselectAll:function(e){this.lastSelected=null,n.each(this.views,function(t){t.deselect(e)})},selectRange:function(e,t){var i=this.viewRange(e,t);return n.each(i,function(e){e.select()}),i},getSelectedViews:function(){return n.filter(this.views,function(e){return e.selected})},getSelectedModels:function(){return new this.collection.constructor(n.map(this.getSelectedViews(),function(e){return e.model}))},_showLoadingIndicator:function(e,t,i){this.debug("_showLoadingIndicator",this.indicator,e,t,i),t=void 0!==t?t:this.fxSpeed,this.indicator||(this.indicator=new d.default(this.$el),this.debug("\t created",this.indicator)),this.$el.is(":visible")?(this.$el.fadeOut(t),this.indicator.show(e,t,i)):this.indicator.show(0,i)},_hideLoadingIndicator:function(e,t){this.debug("_hideLoadingIndicator",this.indicator,e,t),e=void 0!==e?e:this.fxSpeed,this.indicator&&this.indicator.hide(e,t)},scrollPosition:function(){return this.$scrollContainer().scrollTop()},scrollTo:function(e,t){return t=t||0,this.$scrollContainer().animate({scrollTop:e},t),this},scrollToTop:function(e){return this.scrollTo(0,e)},scrollToItem:function(e,t){return this},scrollToId:function(e,t){return this.scrollToItem(this.viewFromModelId(e),t)},events:{"click .select-all":"selectAll","click .deselect-all":"deselectAll"},toString:function(){return"ListPanel("+this.collection+")"}});p.prototype.templates=function(){return{el:u.default.wrapTemplate(["<div>",'<div class="controls"></div>','<div class="list-items"></div>','<div class="empty-message infomessagesmall"></div>',"</div>"]),controls:u.default.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- view.title %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',(0,f.default)("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',(0,f.default)("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"])}}();var m=p.extend({modelCollectionKey:"contents",initialize:function(e){p.prototype.initialize.call(this,e),this.selecting=void 0!==e.selecting&&e.selecting,this.setModel(this.model,e)},setModel:function(e,t){if(t=t||{},this.debug(this+".setModel:",e,t),this.freeModel(),this.freeViews(),e){var i=this.model?this.model.get("id"):null;this.model=e,this.logger&&(this.model.logger=this.logger),this._setUpModelListeners(),this.stopListening(this.collection),this.collection=this.model[this.modelCollectionKey]||t.collection||this._createDefaultCollection(),this._setUpCollectionListeners(),i&&e.get("id")!==i&&this.trigger("new-model",this)}return this},freeModel:function(){return this.model&&this.stopListening(this.model),this},_setUpModelListeners:function(){return this.log(this+"._setUpModelListeners",this.model),this.listenTo(this.model,"error",function(){var e=Array.prototype.slice.call(arguments,0);e.unshift("error"),this.trigger.apply(this,e)},this),this.logger&&this.listenTo(this.model,"all",function(e){this.info(this+"(model)",e,arguments)}),this},_renderControls:function(e){this.debug(this+"(ModelListPanel)._renderControls");var t=this.model?this.model.toJSON():{},i=a(this.templates.controls(t,this));return e.find(".controls").replaceWith(i),i},toString:function(){return"ModelListPanel("+this.model+")"}});m.prototype.templates=function(){var e=u.default.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- model.name %></div>',"</div>",'<div class="subtitle"><%- view.subtitle %></div>','<div class="actions"></div>','<div class="messages"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',(0,f.default)("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',(0,f.default)("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>","</div>"]);return n.extend(n.clone(p.prototype.templates),{controls:e})}(),t.default={ListPanel:p,ModelListPanel:m}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";function n(e,t){function i(e){o(this).parent().children("input").val("").trigger("searchInput.clear").blur(),t.onclear()}function n(e,n){if(!n)return i();o(this).trigger("search.search",n),"function"==typeof t.onfirstsearch&&u?(u=!1,t.onfirstsearch(n)):t.onsearch(n)}function a(){return['<input type="text" name="',t.name,'" placeholder="',t.placeholder,'" ','class="search-query ',t.classes,'" ',"/>"].join("")}var l=27,d=13,c=o(e),u=!0,h={initialVal:"",name:"search",placeholder:"search",classes:"",onclear:function(){},onfirstsearch:null,onsearch:function(e){},minSearchLen:0,escWillClear:!0,oninit:function(){}};return"string"===s.default.type(t)?("toggle-loading"===t&&function(){c.find(".search-loading").toggle(),c.find(".search-clear").toggle()}(),c):("object"===s.default.type(t)&&(t=s.default.extend(!0,{},h,t)),c.addClass("search-input").prepend([function(){return o(a()).focus(function(e){o(this).select()}).keyup(function(e){if(e.preventDefault(),e.stopPropagation(),e.which===l&&t.escWillClear)i.call(this,e);else{var a=o(this).val();(e.which===d||t.minSearchLen&&a.length>=t.minSearchLen)&&n.call(this,e,a)}}).val(t.initialVal)}(),function(){return o(['<span class="search-clear fa fa-times-circle" ','title="',r("clear search (esc)"),'"></span>'].join("")).tooltip({placement:"bottom"}).click(function(e){i.call(this,e)})}(),function(){return o(['<span class="search-loading fa fa-spinner fa-spin" ','title="',r("loading..."),'"></span>'].join("")).hide().tooltip({placement:"bottom"})}()]))}var a=i(0),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=s.default,r=window._l||function(e){return e};s.default.fn.extend({searchInput:function(e){return this.each(function(){return n(this,e)})}})},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(195),s=n(a),o=i(8),r=n(o),l=i(219),d=n(l),c=i(7),u=n(c),h=s.default.DatasetListItemView,f=h.extend({className:h.prototype.className+" history-content",initialize:function(e,t){h.prototype.initialize.call(this,e,t)},toString:function(){return"HDAListItemView("+(this.model?""+this.model:"(no model)")+")"}});f.prototype.templates=function(){var t=function(t){return'\n        <div class="title-bar clear" tabindex="0">\n            <span class="state-icon"></span>\n            <div class="title">\n                <span class="hid">'+t.hid+'</span>\n                <span class="name">'+e.escape(t.name)+"</span>\n            </div>\n            </br>\n            "+d.default.nametagTemplate(t)+"\n        </div>\n    "},i=e.extend({},h.prototype.templates.warnings,{hidden:r.default.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',(0,u.default)("This dataset has been hidden"),"</div>","<% } %>"],"dataset")});return e.extend({},h.prototype.templates,{titleBar:t,warnings:i})}(),t.default={HDAListItemView:f}}).call(t,i(2))},function(e,t,i){"use strict";(function(e){function i(t){return 0==t.indexOf("name:")?'<span class="label label-info">'+e.escape(t.slice(5))+"</span>":""}function n(t){return'<span class="nametags">'+e.sortBy(e.uniq(t.tags)).map(i).join("")+"</span>"}Object.defineProperty(t,"__esModule",{value:!0}),t.default={nametagTemplate:n}}).call(t,i(2))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(166),s=n(a),o=i(196),r=n(o),l=i(221),d=n(l),c=i(8),u=(n(c),i(219)),h=n(u),f=i(7),p=n(f),m=r.default.DCListItemView,_=m.extend({className:m.prototype.className+" history-content",_setUpListeners:function(){var e=this;m.prototype._setUpListeners.call(this);var t=function(t,i){e.render()};this.model.jobStatesSummary&&this.listenTo(this.model.jobStatesSummary,"change",t),this.listenTo(this.model,{"change:tags change:visible change:state":t})},_getFoldoutPanelClass:function(){var e=this.model.get("collection_type");switch(e){case"list":return d.default.ListCollectionView;case"paired":return d.default.PairCollectionView;case"list:paired":return d.default.ListOfPairsCollectionView;case"list:list":return d.default.ListOfListsCollectionView}throw new TypeError("Unknown collection_type: "+e)},_swapNewRender:function(e){m.prototype._swapNewRender.call(this,e);var t,i=this.model.jobStatesSummary;t=i?i.new()?"new":i.errored()?"error":i.terminal()?"ok":i.running()?"running":"queued":this.model.get("job_source_id")?s.default.NEW:this.model.get("populated_state")?s.default.OK:s.default.RUNNING,this.$el.addClass("state-"+t);var n=this.stateDescription();return console.log(n),this.$(".state-description").html(n),this.$el},stateDescription:function(){var e=this.model,t=e.get("element_count");console.log(t);var i,n=e.get("job_source_type"),a=this.model.get("collection_type");i="list"==a?"list":"paired"==a?"dataset pair":"list:paired"==a?"list of pairs":"nested list";var s="";1==t?s=" with 1 item":t&&(s=" with "+t+" items");var o=e.jobStatesSummary,r=""+i+s;if(n&&"Job"!=n){if(o&&o.hasDetails()){var l=o.new(),d=l?null:o.jobCount();if(l)return'\n                        <div class="progress state-progress">\n                            <span class="note">Creating jobs...</span>\n                            <div class="progress-bar info" style="width:100%">\n                        </div>';if(o.errored()){return"a "+i+" with "+o.numInError()+" / "+d+" jobs in error"}if(o.terminal())return"a "+r;var c=o.states().running||0,u=o.states().ok||0,h=u/(1*d),f=c/(1*d),p=1-h-f;return'\n                        <div class="progress state-progress">\n                            <span class="note">'+(d&&d>1?d+" jobs":"a job")+" generating a "+i+'</span>\n                            <div class="progress-bar ok" style="width:'+100*h+'%"></div>\n                            <div class="progress-bar running" style="width:'+100*f+'%"></div>\n                            <div class="progress-bar new" style="width:'+100*p+'%">\n                        </div>'}return'\n                    <div class="progress state-progress">\n                        <span class="note">Loading job data for '+i+'...</span>\n                        <div class="progress-bar info" style="width:100%">\n                    </div>'}return"a "+r},toString:function(){return"HDCAListItemView("+(this.model?""+this.model:"(no model)")+")"}});_.prototype.templates=function(){var t=e.extend({},m.prototype.templates.warnings,{hidden:function(e){e.visible||(0,p.default)("This collection has been hidden")}}),i=function(t){return'\n        <div class="title-bar clear" tabindex="0">\n            <span class="state-icon"></span>\n            <div class="title">\n                <span class="hid">'+t.hid+'</span>\n                <span class="name">'+e.escape(t.name)+'</span>\n            </div>\n            <div class="state-description">\n            </div>\n            '+h.default.nametagTemplate(t)+"\n        </div>\n    "};return e.extend({},m.prototype.templates,{warnings:t,titleBar:i})}(),t.default={HDCAListItemView:_}}).call(t,i(2))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(216),s=n(a),o=i(189),r=(n(o),i(196)),l=n(r),d=i(8),c=n(d),u=i(7),h=n(u),f=s.default.ModelListPanel,p=f.extend({_logNamespace:"collections",className:f.prototype.className+" dataset-collection-panel",DatasetDCEViewClass:l.default.DatasetDCEListItemView,NestedDCDCEViewClass:l.default.NestedDCDCEListItemView,modelCollectionKey:"elements",initialize:function(e){f.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank",this.hasUser=e.hasUser,this.panelStack=[],this.parentName=e.parentName,this.foldoutStyle=e.foldoutStyle||"foldout",this.downloadUrl=Galaxy.root+"api/dataset_collections/"+this.model.attributes.id+"/download"},_queueNewRender:function(e,t){t=void 0===t?this.fxSpeed:t;var i=this;i.log("_queueNewRender:",e,t),i._swapNewRender(e),i.trigger("rendered",i)},_filterCollection:function(){return this.model.getVisibleContents()},_getItemViewClass:function(e){switch(e.get("element_type")){case"hda":return this.DatasetDCEViewClass;case"dataset_collection":return this.NestedDCDCEViewClass}throw new TypeError("Unknown element type:",e.get("element_type"))},_getItemViewOptions:function(t){var i=f.prototype._getItemViewOptions.call(this,t);return e.extend(i,{linkTarget:this.linkTarget,hasUser:this.hasUser,foldoutStyle:this.foldoutStyle})},_setUpItemViewListeners:function(e){var t=this;return f.prototype._setUpItemViewListeners.call(t,e),t.listenTo(e,{"expanded:drilldown":function(e,t){this._expandDrilldownPanel(t)},"collapsed:drilldown":function(e,t){this._collapseDrilldownPanel(t)}}),this},_expandDrilldownPanel:function(e){this.panelStack.push(e),this.$("> .controls").add(this.$list()).hide(),e.parentName=this.model.get("name"),this.$el.append(e.render().$el)},_collapseDrilldownPanel:function(e){this.panelStack.pop(),this.render()},events:{"click .navigation .back":"close"},close:function(e){this.remove(),this.trigger("close")},toString:function(){return"CollectionView("+(this.model?this.model.get("name"):"")+")"}});p.prototype.templates=function(){var t=c.default.wrapTemplate(['<div class="controls">','<div class="navigation">','<a class="back" href="javascript:void(0)">','<span class="fa fa-icon fa-angle-left"></span>',(0,h.default)("Back to "),"<%- view.parentName %>","</a>","</div>",'<div class="title">','<div class="name"><%- collection.name || collection.element_identifier %></div>','<div class="subtitle">','<% if( collection.collection_type === "list" ){ %>',(0,h.default)("a list of datasets"),'<% } else if( collection.collection_type === "paired" ){ %>',(0,h.default)("a pair of datasets"),'<% } else if( collection.collection_type === "list:paired" ){ %>',(0,h.default)("a list of paired datasets"),'<% } else if( collection.collection_type === "list:list" ){ %>',(0,h.default)("a list of dataset lists"),"<% } %>","</div>","</div>",'<div class="tags-display"></div>','<div class="actions">','<a class="download-btn icon-btn" ','href="<%- view.downloadUrl %>','" title="" download="" data-original-title="Download Collection">','<span class="fa fa-floppy-o"></span>',"</a>","</div>","</div>"],"collection");return e.extend(e.clone(f.prototype.templates),{controls:t})}();var m=p.extend({DatasetDCEViewClass:l.default.DatasetDCEListItemView,toString:function(){return"ListCollectionView("+(this.model?this.model.get("name"):"")+")"}}),_=m.extend({toString:function(){return"PairCollectionView("+(this.model?this.model.get("name"):"")+")"}}),g=p.extend({NestedDCDCEViewClass:l.default.NestedDCDCEListItemView.extend({foldoutPanelClass:_}),toString:function(){return"ListOfPairsCollectionView("+(this.model?this.model.get("name"):"")+")"}}),v=p.extend({NestedDCDCEViewClass:l.default.NestedDCDCEListItemView.extend({foldoutPanelClass:_}),toString:function(){return"ListOfListsCollectionView("+(this.model?this.model.get("name"):"")+")"}});t.default={CollectionView:p,ListCollectionView:m,PairCollectionView:_,ListOfPairsCollectionView:g,ListOfListsCollectionView:v}}).call(t,i(2))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(166),o=a(s),r=i(195),l=a(r),d=i(181),c=a(d),u=i(223),h=a(u),f=i(175),p=a(f),m=i(8),_=a(m),g=i(7),v=a(g),w=l.default.DatasetListItemView,b=w.extend({initialize:function(e){w.prototype.initialize.call(this,e),this.hasUser=e.hasUser,this.purgeAllowed=e.purgeAllowed||!1,this.tagsEditorShown=e.tagsEditorShown||!1,this.annotationEditorShown=e.annotationEditorShown||!1},_renderPrimaryActions:function(){var e=w.prototype._renderPrimaryActions.call(this);return this.model.get("state")===o.default.NOT_VIEWABLE?e:w.prototype._renderPrimaryActions.call(this).concat([this._renderEditButton(),this._renderDeleteButton()])},_renderEditButton:function(){var t=this;if(this.model.get("state")===o.default.DISCARDED||!this.model.get("accessible"))return null;var i=this.model.get("purged"),n=this.model.get("deleted"),a={title:(0,v.default)("Edit attributes"),href:Galaxy.root+"datasets/edit?dataset_id="+this.model.attributes.id,faIcon:"fa-pencil",classes:"edit-btn",onclick:function(e){Galaxy.router&&(e.preventDefault(),Galaxy.router.push("datasets/edit",{dataset_id:t.model.attributes.id}))}};return n||i?(a.disabled=!0,i?a.title=(0,v.default)("Cannot edit attributes of datasets removed from disk"):n&&(a.title=(0,v.default)("Undelete dataset to edit attributes"))):e.contains([o.default.UPLOAD,o.default.NEW],this.model.get("state"))&&(a.disabled=!0,a.title=(0,v.default)("This dataset is not yet editable")),(0,p.default)(a)},_renderDeleteButton:function(){if(!this.model.get("accessible"))return null;var e=this,t=this.model.isDeletedOrPurged();return(0,p.default)({title:t?(0,v.default)("Dataset is already deleted"):(0,v.default)("Delete"),disabled:t,faIcon:"fa-times",classes:"delete-btn",onclick:function(){e.$el.find(".icon-btn.delete-btn").trigger("mouseout"),e.model.delete()}})},_renderDetails:function(){var t=w.prototype._renderDetails.call(this),i=this.model.get("state");return!this.model.isDeletedOrPurged()&&e.contains([o.default.OK,o.default.FAILED_METADATA],i)&&(this._renderTags(t),this._renderAnnotation(t),this._makeDbkeyEditLink(t)),this._setUpBehaviors(t),t},_renderToolHelpButton:function(){var e=this.model.attributes.dataset_id,t=this.model.attributes.creating_job,i=this,a=function(t){var a='<div id="thdiv-'+e+'" class="toolhelp">';t.name&&t.help?(a+="<strong>Tool help for "+t.name+"</strong><hr/>",a+=t.help):a+="<strong>Tool help is unavailable for this dataset.</strong><hr/>",a+="</div>",i.$el.find(".details").append(n.parseHTML(a))},s=function(e){n.ajax({url:Galaxy.root+"api/tools/"+e.tool_id+"/build"}).done(function(e){a(e)}).fail(function(){a({})})};return null===Galaxy.user.id?null:(0,p.default)({title:(0,v.default)("Tool Help"),classes:"icon-btn",href:"#",faIcon:"fa-question",onclick:function(){i.$el.find(".toolhelp").length>0?i.$el.find(".toolhelp").toggle():n.ajax({url:Galaxy.root+"api/jobs/"+t}).done(function(e){s(e)}).fail(function(){console.log('Failed at recovering job information from the  Galaxy API for job id "'+t+'".')})}})},_renderSecondaryActions:function(){var e=w.prototype._renderSecondaryActions.call(this);switch(this.model.get("state")){case o.default.UPLOAD:case o.default.NOT_VIEWABLE:return e;case o.default.ERROR:return e.unshift(this._renderErrButton()),e.concat([this._renderRerunButton(),this._renderToolHelpButton()]);case o.default.OK:case o.default.FAILED_METADATA:return e.concat([this._renderRerunButton(),this._renderVisualizationsButton(),this._renderToolHelpButton()])}return e.concat([this._renderRerunButton(),this._renderToolHelpButton()])},_renderErrButton:function(){var e=this;return(0,p.default)({title:(0,v.default)("View or report this error"),href:Galaxy.root+"datasets/error?dataset_id="+this.model.attributes.id,classes:"report-error-btn",faIcon:"fa-bug",onclick:function(t){Galaxy.router&&(t.preventDefault(),Galaxy.router.push("datasets/error",{dataset_id:e.model.attributes.id}))}})},_renderRerunButton:function(){var e=this.model.get("creating_job");if(this.model.get("rerunnable"))return(0,p.default)({title:(0,v.default)("Run this job again"),href:this.model.urls.rerun,classes:"rerun-btn",target:this.linkTarget,faIcon:"fa-refresh",onclick:function(t){Galaxy.router&&(t.preventDefault(),Galaxy.router.push("/",{job_id:e}))}})},_renderVisualizationsButton:function(){var t=this.model.get("visualizations");if(this.model.isDeletedOrPurged()||!this.hasUser||!this.model.hasData()||e.isEmpty(t))return null;if(!e.isObject(t[0]))return this.warn("Visualizations have been switched off"),null;var i=n(this.templates.visualizations(t,this));return i.find('[target="galaxy_main"]').attr("target",this.linkTarget),this._addScratchBookFn(i.find(".visualization-link").addBack(".visualization-link")),i},_addScratchBookFn:function(e){e.click(function(e){Galaxy.frame&&Galaxy.frame.active&&(Galaxy.frame.add({title:"Visualization",url:n(this).attr("href")}),e.preventDefault(),e.stopPropagation())})},_renderTags:function(e){if(this.hasUser){var t=this;this.tagsEditor=new c.default.TagsEditor({model:this.model,el:e.find(".tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.tagsEditorShown=!0},onhide:function(){t.tagsEditorShown=!1},$activator:(0,p.default)({title:(0,v.default)("Edit dataset tags"),classes:"tag-btn",faIcon:"fa-tags"}).appendTo(e.find(".actions .right"))}),this.tagsEditorShown&&this.tagsEditor.toggle(!0)}},_renderAnnotation:function(e){if(this.hasUser){var t=this;this.annotationEditor=new h.default.AnnotationEditor({model:this.model,el:e.find(".annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.annotationEditorShown=!0},onhide:function(){t.annotationEditorShown=!1},$activator:(0,p.default)({title:(0,v.default)("Edit dataset annotation"),classes:"annotate-btn",faIcon:"fa-comment"}).appendTo(e.find(".actions .right"))}),this.annotationEditorShown&&this.annotationEditor.toggle(!0)}},_makeDbkeyEditLink:function(e){if("?"===this.model.get("metadata_dbkey")&&!this.model.isDeletedOrPurged()){var t=n('<a class="value">?</a>').attr("href",this.model.urls.edit).attr("target","_top");e.find(".dbkey .value").replaceWith(t)}},events:e.extend(e.clone(w.prototype.events),{"click .undelete-link":"_clickUndeleteLink","click .purge-link":"_clickPurgeLink","click .edit-btn":function(e){this.trigger("edit",this,e)},"click .delete-btn":function(e){this.trigger("delete",this,e)},"click .rerun-btn":function(e){this.trigger("rerun",this,e)},"click .report-err-btn":function(e){this.trigger("report-err",this,e)},"click .visualization-btn":function(e){this.trigger("visualize",this,e)},"click .dbkey a":function(e){this.trigger("edit",this,e)}}),_clickUndeleteLink:function(e){return this.model.undelete(),!1},_clickPurgeLink:function(e){return confirm((0,v.default)("This will permanently remove the data in your dataset. Are you sure?"))&&this.model.purge(),!1},toString:function(){return"HDAEditView("+(this.model?""+this.model:"(no model)")+")"}});b.prototype.templates=function(){var t=e.extend({},w.prototype.templates.warnings,{failed_metadata:_.default.wrapTemplate(['<% if( dataset.state === "failed_metadata" ){ %>','<div class="failed_metadata-warning warningmessagesmall">',(0,v.default)("An error occurred setting the metadata for this dataset"),'<br /><a href="<%- dataset.urls.edit %>" target="_top">',(0,v.default)("Set it manually or retry auto-detection"),"</a>","</div>","<% } %>"],"dataset"),deleted:_.default.wrapTemplate(["<% if( dataset.deleted && !dataset.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,v.default)("This dataset has been deleted"),'<br /><a class="undelete-link" href="javascript:void(0);">',(0,v.default)("Undelete it"),"</a>","<% if( view.purgeAllowed ){ %>",'<br /><a class="purge-link" href="javascript:void(0);">',(0,v.default)("Permanently remove it from disk"),"</a>","<% } %>","</div>","<% } %>"],"dataset")}),i=_.default.wrapTemplate(["<% if( visualizations.length === 1 ){ %>",'<a class="visualization-link icon-btn" href="<%- visualizations[0].href %>"',' target="<%- visualizations[0].target %>" title="',(0,v.default)("Visualize in"),' <%- visualizations[0].html %>">','<span class="fa fa-bar-chart-o"></span>',"</a>","<% } else { %>",'<div class="visualizations-dropdown dropdown icon-btn">','<a data-toggle="dropdown" title="',(0,v.default)("Visualize"),'">','<span class="fa fa-bar-chart-o"></span>',"</a>",'<ul class="dropdown-menu" role="menu">',"<% _.each( visualizations, function( visualization ){ %>",'<li><a class="visualization-link" href="<%- visualization.href %>"',' target="<%- visualization.target %>">',"<%- visualization.html %>","</a></li>","<% }); %>","</ul>","</div>","<% } %>"],"visualizations");return e.extend({},w.prototype.templates,{warnings:t,visualizations:i})}(),t.default={DatasetListItemEdit:b}}).call(t,i(2),i(0))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(8),o=a(s),r=i(7),l=a(r);i(25);var d=e.View.extend(o.default.LoggableMixin).extend(o.default.HiddenUntilActivatedViewMixin).extend({tagName:"div",className:"annotation-display",initialize:function(e){e=e||{},this.tooltipConfig=e.tooltipConfig||{placement:"bottom"},this.listenTo(this.model,"change:annotation",function(){this.render()}),this.hiddenUntilActivated(e.$activator,e)},render:function(){var e=this;return this.$el.html(this._template()),this.$annotation().make_text_editable({use_textarea:!0,on_finish:function(t){e.$annotation().text(t),e.model.save({annotation:t},{silent:!0}).fail(function(){e.$annotation().text(e.model.previous("annotation"))})}}),this},_template:function(){var e=this.model.get("annotation");return['<label class="prompt">',(0,l.default)("Annotation"),"</label>",'<div class="annotation">',n.escape(e),"</div>"].join("")},$annotation:function(){return this.$el.find(".annotation")},remove:function(){this.$annotation.off(),this.stopListening(this.model),e.View.prototype.remove.call(this)},toString:function(){return["AnnotationEditor(",""+this.model,")"].join("")}});t.default={AnnotationEditor:d}}).call(t,i(1),i(2))},,,,,,,,,,,,,,,,function(e,t,i){"use strict";(function(e){function t(e){return e&&e.__esModule?e:{default:e}}var n=i(0),a=t(n),s=i(177),o=t(s),r=i(182),l=t(r),d=i(240),c=t(d),u=i(250),h=t(u),f=i(179),p=t(f),m=i(141),_=t(m),g=i(197),v=t(g),w=i(264),b=t(w),y=i(265),x=t(y),k=i(204),C=t(k),$=i(26),S=t($),T=i(266),M=t(T),E=i(267),P=t(E),O=i(269),A=t(O),D=i(210),I=t(D),z=i(58),j=t(z),L=i(3),R=t(L),V=i(4),N=t(V),G=i(270),U=t(G),H=i(271),F=t(H),B=i(62),q=t(B),Y=i(142),W=t(Y),J=a.default;window.app=function(t,i){window.Galaxy=new o.default.GalaxyApp(t,i),Galaxy.debug("analysis app");var n=l.default.extend({routes:{"(/)":"home","(/)root*":"home","(/)tours(/)(:tour_id)":"show_tours","(/)user(/)":"show_user","(/)user(/)(:form_id)":"show_user_form","(/)pages(/)create(/)":"show_pages_create","(/)pages(/)edit(/)":"show_pages_edit","(/)pages(/)(:action_id)":"show_pages","(/)visualizations(/)edit(/)":"show_visualizations_edit","(/)visualizations/(:action_id)":"show_visualizations","(/)workflows/import_workflow":"show_import_workflow","(/)workflows/run(/)":"show_run","(/)workflows(/)list":"show_workflows","(/)workflows/list_published(/)":"show_workflows_published","(/)workflows/create(/)":"show_workflows_create","(/)histories(/)citations(/)":"show_history_citations","(/)histories(/)rename(/)":"show_histories_rename","(/)histories(/)permissions(/)":"show_histories_permissions","(/)histories(/)(:action_id)":"show_histories","(/)datasets(/)list(/)":"show_datasets","(/)custom_builds":"show_custom_builds","(/)datasets/edit":"show_dataset_edit_attributes","(/)datasets/error":"show_dataset_error"},require_login:["show_user","show_user_form","show_workflows"],authenticate:function(e,t){return Galaxy.user&&Galaxy.user.id||-1==this.require_login.indexOf(t)},show_tours:function(e){e?C.default.giveTour(e):this.page.display(new C.default.ToursView)},show_user:function(){this.page.display(new b.default.View)},show_user_form:function(e){var t=new b.default.Model({user_id:Galaxy.params.id});this.page.display(new v.default.View(t.get(e)))},show_visualizations:function(e){this.page.display(new M.default.View({action_id:e,plural:"Visualizations",item:"visualization"}))},show_visualizations_edit:function(){this.page.display(new v.default.View({url:"visualization/edit?id="+j.default.get("id"),redirect:"visualizations/list"}))},show_workflows_published:function(){this.page.display(new S.default({url_base:Galaxy.root+"workflow/list_published",dict_format:!0}))},show_histories:function(e){this.page.display(new A.default.View({action_id:e}))},show_history_citations:function(){var e=W.default.extend(q.default),t=document.createElement("div");this.page.display(t),new e({propsData:{id:j.default.get("id"),source:"histories"}}).$mount(t)},show_histories_rename:function(){this.page.display(new v.default.View({url:"history/rename?id="+j.default.get("id"),redirect:"histories/list"}))},show_histories_permissions:function(){this.page.display(new v.default.View({url:"history/permissions?id="+j.default.get("id"),redirect:"histories/list"}))},show_datasets:function(){this.page.display(new S.default({url_base:Galaxy.root+"dataset/list",dict_format:!0}))},show_pages:function(e){this.page.display(new M.default.View({action_id:e,plural:"Pages",item:"page"}))},show_pages_create:function(){this.page.display(new v.default.View({url:"page/create",redirect:"pages/list"}))},show_pages_edit:function(){this.page.display(new v.default.View({url:"page/edit?id="+j.default.get("id"),redirect:"pages/list"}))},show_workflows:function(){this.page.display(new P.default.View)},show_workflows_create:function(){this.page.display(new v.default.View({url:"workflow/create",redirect:"workflow/editor"}))},show_run:function(){this._loadWorkflow()},show_import_workflow:function(){this.page.display(new P.default.ImportWorkflowView)},show_custom_builds:function(){var e=this,t=this.page.historyPanel.historyView;if(!t||!t.model||!t.model.id)return void window.setTimeout(function(){e.show_custom_builds()},500);this.page.display(new x.default.View)},show_dataset_edit_attributes:function(){this.page.display(new F.default.View)},show_dataset_error:function(){this.page.display(new U.default.View)},home:function(e){e.tool_id||e.job_id?"upload1"===e.tool_id?(this.page.toolPanel.upload.show(),this._loadCenterIframe("welcome")):this._loadToolForm(e):e.workflow_id?this._loadWorkflow():e.m_c?this._loadCenterIframe(e.m_c+"/"+e.m_a):this._loadCenterIframe("welcome")},_loadToolForm:function(e){e.id=decodeURIComponent(e.tool_id),this.page.display(new _.default.View(e))},_loadCenterIframe:function(e,t){t=t||Galaxy.root,e=t+e,this.page.$("#galaxy_main").prop("src",e)},_loadWorkflow:function(){var e=this;R.default.get({url:Galaxy.root+"api/workflows/"+R.default.getQueryString("id")+"/download?style=run",success:function(t){e.page.display(new I.default.View(t))},error:function(t){var i=t.err_msg||"Error occurred while loading the resource.",n={message:i,status:"danger",persistent:!0};e.page.display(new N.default.Message(n))}})}});J(function(){Galaxy.page=new p.default.View(e.extend(t,{Left:c.default,Right:h.default,Router:n}))})}}).call(t,i(2))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(140),o=a(s),r=i(241),l=a(r),d=i(7),c=a(d),u=i(210),h=(a(u),e.View.extend({initialize:function(t,i){var n=i.config;this.root=i.root,this.stored_workflow_menu_entries=n.stored_workflow_menu_entries||[];var a=new o.default.ToolSearch({hidden:!1}),s=new o.default.ToolCollection(n.toolbox);this.tool_panel=new o.default.ToolPanel({tool_search:a,tools:s,layout:n.toolbox_in_panel}),this.tool_panel_view=new o.default.ToolPanelView({model:this.tool_panel}),this.upload_button=new l.default({nginx_upload_path:n.nginx_upload_path,ftp_upload_site:n.ftp_upload_site,default_genome:n.default_genome,default_extension:n.default_extension}),Galaxy.upload=this.upload_button,this.model=new e.Model({title:(0,c.default)("Tools"),buttons:[this.upload_button]}),this.setElement(this._template())},render:function(){var e=this;this.tool_panel.get("layout").size()>0&&(this.$el.prepend(this.tool_panel_view.$el),this.tool_panel_view.render()),e.$("#internal-workflows").append(e._templateAllWorkflow({title:(0,c.default)("All workflows"),href:"workflow"})),n.each(this.stored_workflow_menu_entries,function(t){e.$("#internal-workflows").append(e._templateWorkflowLink({title:t.stored_workflow.name,href:"workflows/run?id="+t.encoded_stored_workflow_id}))})},_templateTool:function(e){return['<div class="toolTitle">','<a href="',this.root,e.href,'" target="galaxy_main">',e.title,"</a>","</div>"].join("")},_templateAllWorkflow:function(e){return['<div class="toolTitle">','<a href="',Galaxy.root,e.href,'">',e.title,"</a>","</div>"].join("")},_templateWorkflowLink:function(e){return['<div class="toolTitle">','<a class="'+e.cls+' " href="',Galaxy.root,e.href,'">',e.title,"</a>","</div>"].join("")},_template:function(){return['<div class="toolMenuContainer">','<div class="toolMenu" style="display: none">','<div id="search-no-results" style="display: none; padding-top: 5px">',"<em><strong>",(0,c.default)("Search did not match any tools."),"</strong></em>","</div>","</div>",'<div class="toolSectionPad"/>','<div class="toolSectionPad"/>','<div class="toolSectionTitle" id="title_XXinternalXXworkflow">',"<span>",(0,c.default)("Workflows"),"</span>","</div>",'<div id="internal-workflows" class="toolSectionBody">','<div class="toolSectionBg"/>',"</div>","</div>"].join("")},toString:function(){return"toolPanel"}}));t.default=h}).call(t,i(1),i(2))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=n(a),o=i(9),r=n(o),l=i(68),d=n(l),c=i(242),u=n(c),h=i(243),f=n(h),p=i(246),m=n(p),_=i(248),g=n(_);t.default=e.View.extend({options:{nginx_upload_path:"",ftp_upload_site:"n/a",default_genome:"?",default_extension:"auto",height:500,width:900,auto:{id:"auto",text:"Auto-detect",description:"This system will try to detect the file type automatically. If your file is not detected properly as one of the known formats, it most likely means that it has some format problems (e.g., different number of columns on different rows). You can still coerce the system to set your data to the format you think it should be.  You can also upload compressed files, which will automatically be decompressed."}},list_extensions:[],list_genomes:[],initialize:function(e){var t=this;this.options=s.default.merge(e,this.options),this.ui_button=new u.default.View({onclick:function(e){e.preventDefault(),t.show()},onunload:function(){var e=t.ui_button.model.get("percentage",0);if(e>0&&e<100)return"Several uploads are queued."}}),this.setElement(this.ui_button.$el);var t=this;s.default.get({url:Galaxy.root+"api/datatypes?extension_only=False",success:function(e){for(var i in e)t.list_extensions.push({id:e[i].extension,text:e[i].extension,description:e[i].description,description_url:e[i].description_url,composite_files:e[i].composite_files});t.list_extensions.sort(function(e,t){var i=e.text&&e.text.toLowerCase(),n=t.text&&t.text.toLowerCase();return i>n?1:i<n?-1:0}),t.options.datatypes_disable_auto||t.list_extensions.unshift(t.options.auto)}}),s.default.get({url:Galaxy.root+"api/genomes",success:function(e){for(var i in e)t.list_genomes.push({id:e[i][1],text:e[i][0]});t.list_genomes.sort(function(e,i){return e.id==t.options.default_genome?-1:i.id==t.options.default_genome?1:e.text>i.text?1:e.text<i.text?-1:0})}})},show:function(){var e=this;if(!Galaxy.currHistoryPanel||!Galaxy.currHistoryPanel.model)return void window.setTimeout(function(){e.show()},500);this.current_user=Galaxy.user.id,this.modal||(this.tabs=new d.default.View,this.default_view=new f.default(this),this.tabs.add({id:"regular",title:"Regular",$el:this.default_view.$el}),this.composite_view=new m.default(this),this.tabs.add({id:"composite",title:"Composite",$el:this.composite_view.$el}),this.collection_view=new g.default(this),this.tabs.add({id:"collection",title:"Collection",$el:this.collection_view.$el}),this.modal=new r.default.View({title:"Download from web or upload from disk",body:this.tabs.$el,height:this.options.height,width:this.options.width,closing_events:!0,title_separator:!1})),this.modal.show()},currentHistory:function(){return this.current_user&&Galaxy.currHistoryPanel.model.get("id")},currentFtp:function(){return this.current_user&&this.options.ftp_upload_site},toData:function(e,t){var i={payload:{tool_id:"upload1",history_id:t||this.currentHistory(),inputs:{}},files:[],error_message:null};if(e&&e.length>0){var n={file_count:e.length,dbkey:e[0].get("genome","?"),file_type:e[0].get("extension","auto")};for(var a in e){var s=e[a];if(s.set("status","running"),!(s.get("file_size")>0)){i.error_message="Upload content incomplete.",s.set("status","error"),s.set("info",i.error_message);break}var o="files_"+a+"|";switch(n[o+"type"]="upload_dataset",n[o+"space_to_tab"]=s.get("space_to_tab")&&"Yes"||null,n[o+"to_posix_lines"]=s.get("to_posix_lines")&&"Yes"||null,n[o+"dbkey"]=s.get("genome",null),n[o+"file_type"]=s.get("extension",null),s.get("file_mode")){case"new":n[o+"url_paste"]=s.get("url_paste");break;case"ftp":n[o+"ftp_files"]=s.get("file_path");break;case"local":i.files.push({name:o+"file_data",file:s.get("file_data")})}}i.payload.inputs=JSON.stringify(n)}return i}})}).call(t,i(1))},function(e,t,i){"use strict";(function(e,i){Object.defineProperty(t,"__esModule",{value:!0});var n=e.View.extend({initialize:function(t){var n=this;this.model=t&&t.model||new e.Model({icon:"fa-upload",tooltip:"Download from URL or upload files from disk",label:"Load Data",percentage:0,status:"",onunload:function(){},onclick:function(){}}).set(t),this.setElement(this._template()),this.$progress=this.$(".progress-bar"),this.listenTo(this.model,"change",this.render,this),this.render(),i(window).on("beforeunload",function(){return n.model.get("onunload")()})},render:function(){var e=this.model.attributes;this.$el.off("click").on("click",function(t){e.onclick(t)}).tooltip({title:this.model.get("tooltip"),placement:"bottom"}),this.$progress.removeClass().addClass("progress-bar").addClass("progress-bar-notransition").addClass(""!=e.status&&"progress-bar-"+e.status).css({width:e.percentage+"%"})},_template:function(){return'<div class="upload-button"><div class="progress"><div class="progress-bar"/><a class="panel-header-button" href="javascript:void(0)" id="tool-panel-upload-button"><span class="fa fa-upload"/></a></div></div>'}});t.default={View:n}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=(s(o),i(180)),l=s(r),d=i(244),c=s(d),u=i(184),h=s(u),f=i(185),p=s(f),m=i(165),_=s(m),g=i(139),v=s(g),w=i(4),b=s(w),y=i(245),x=s(y);i(186),t.default=e.View.extend({upload_size:0,collection:new l.default.Collection,counter:{announce:0,success:0,error:0,running:0,reset:function(){this.announce=this.success=this.error=this.running=0}},initialize:function(e){var t=this;this.app=e,this.options=e.options,this.list_extensions=e.list_extensions,this.list_genomes=e.list_genomes,this.ui_button=e.ui_button,this.ftp_upload_site=e.currentFtp(),this.setElement(this._template()),this.$uploadbox=this.$(".upload-box"),this.$uploadtable=this.$(".upload-table"),this.btnLocal=new b.default.Button({id:"btn-local",title:"Choose local file",onclick:function(){t.uploadbox.select()},icon:"fa fa-laptop"}),this.btnFtp=new b.default.Button({id:"btn-ftp",title:"Choose FTP file",onclick:function(){t._eventFtp()},icon:"fa fa-folder-open-o"}),this.btnCreate=new b.default.Button({id:"btn-new",title:"Paste/Fetch data",onclick:function(){t._eventCreate()},icon:"fa fa-edit"}),this.btnStart=new b.default.Button({id:"btn-start",title:"Start",onclick:function(){t._eventStart()}}),this.btnStop=new b.default.Button({id:"btn-stop",title:"Pause",onclick:function(){t._eventStop()}}),this.btnReset=new b.default.Button({id:"btn-reset",title:"Reset",onclick:function(){t._eventReset()}}),this.btnClose=new b.default.Button({id:"btn-close",title:"Close",onclick:function(){t.app.modal.hide()}}),n.each([this.btnLocal,this.btnFtp,this.btnCreate,this.btnStop,this.btnReset,this.btnStart,this.btnClose],function(e){t.$(".upload-buttons").prepend(e.$el)}),this.uploadbox=this.$uploadbox.uploadbox({url:this.app.options.nginx_upload_path,announce:function(e,i){t._eventAnnounce(e,i)},initialize:function(e){return t.app.toData([t.collection.get(e)],t.history_id)},progress:function(e,i){t._eventProgress(e,i)},success:function(e,i){t._eventSuccess(e,i)},error:function(e,i){t._eventError(e,i)},complete:function(){t._eventComplete()},ondragover:function(){t.$uploadbox.addClass("highlight")},ondragleave:function(){t.$uploadbox.removeClass("highlight")}}),this.ftp=new _.default.View({title:"FTP files",container:this.btnFtp.$el}),this.select_extension=new v.default.View({css:"upload-footer-selection",container:this.$(".upload-footer-extension"),data:n.filter(this.list_extensions,function(e){return!e.composite_files}),value:this.options.default_extension,onchange:function(e){t._changeExtension(e)}}),this.$(".upload-footer-extension-info").on("click",function(e){new p.default({$el:a(e.target),title:t.select_extension.text(),extension:t.select_extension.value(),list:t.list_extensions,placement:"top"})}).on("mousedown",function(e){e.preventDefault()}),this.select_genome=new v.default.View({css:"upload-footer-selection",container:this.$(".upload-footer-genome"),data:this.list_genomes,value:this.options.default_genome,onchange:function(e){t._changeGenome(e)}}),this.loader=new x.default({$container:this.$uploadbox,collection:this.collection,new_content:function(e){var i=new c.default(t,{model:e});return t.$uploadtable.find("> tbody:first").append(i.$el),i.render(),i}}),this.collection.on("remove",function(e){t._eventRemove(e)}),this.render()},render:function(){var e="";e=0==this.counter.announce?this.uploadbox.compatible()?"&nbsp;":"Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.":0==this.counter.running?"You added "+this.counter.announce+" file(s) to the queue. Add more files or click 'Start' to proceed.":"Please wait..."+this.counter.announce+" out of "+this.counter.running+" remaining.",this.$(".upload-top-info").html(e);var t=0==this.counter.running&&this.counter.announce+this.counter.success+this.counter.error>0,i=0==this.counter.running&&this.counter.announce>0,n=0==this.counter.running,a=this.counter.announce+this.counter.success+this.counter.error>0;this.btnReset[t?"enable":"disable"](),this.btnStart[i?"enable":"disable"](),this.btnStart.$el[i?"addClass":"removeClass"]("btn-primary"),this.btnStop[this.counter.running>0?"enable":"disable"](),this.btnLocal[n?"enable":"disable"](),this.btnFtp[n?"enable":"disable"](),this.btnCreate[n?"enable":"disable"](),this.btnFtp.$el[this.ftp_upload_site?"show":"hide"](),this.$(".upload-table")[a?"show":"hide"](),this.$(".upload-helper")[a?"hide":"show"]()},_eventAnnounce:function(e,t){this.counter.announce++;var i=new l.default.Model({id:e,file_name:t.name,file_size:t.size,file_mode:t.mode||"local",file_path:t.path,file_data:t});this.render(),this.collection.add(i)},_eventProgress:function(e,t){var i=this.collection.get(e);i.set("percentage",t),this.ui_button.model.set("percentage",this._uploadPercentage(t,i.get("file_size")))},_eventSuccess:function(e,t){var i=this.collection.get(e);i.set({percentage:100,status:"success"}),this.ui_button.model.set("percentage",this._uploadPercentage(100,i.get("file_size"))),this.upload_completed+=100*i.get("file_size"),this.counter.announce--,this.counter.success++,this.render(),Galaxy.currHistoryPanel.refreshContents()},_eventError:function(e,t){var i=this.collection.get(e);i.set({percentage:100,status:"error",info:t}),this.ui_button.model.set({percentage:this._uploadPercentage(100,i.get("file_size")),status:"danger"}),this.upload_completed+=100*i.get("file_size"),this.counter.announce--,this.counter.error++,this.render()},_eventComplete:function(){this.collection.each(function(e){"queued"==e.get("status")&&e.set("status","init")}),this.counter.running=0,this.render()},_eventRemove:function(e){var t=e.get("status");"success"==t?this.counter.success--:"error"==t?this.counter.error--:this.counter.announce--,this.uploadbox.remove(e.id),this.render()},_eventFtp:function(){if(this.ftp.visible)this.ftp.hide();else{this.ftp.empty();var e=this;this.ftp.append(new h.default({collection:this.collection,ftp_upload_site:this.ftp_upload_site,onadd:function(t){return e.uploadbox.add([{mode:"ftp",name:t.path,size:t.size,path:t.path}])},onremove:function(t){e.collection.remove(t)}}).$el),this.ftp.show()}},_eventCreate:function(){this.uploadbox.add([{name:"New File",size:0,mode:"new"}])},_eventStart:function(){if(0!=this.counter.announce&&0==this.counter.running){var e=this;this.upload_size=0,this.upload_completed=0,this.collection.each(function(t){"init"==t.get("status")&&(t.set("status","queued"),e.upload_size+=t.get("file_size"))}),this.ui_button.model.set({percentage:0,status:"success"}),this.counter.running=this.counter.announce,this.history_id=this.app.currentHistory(),this._uploadFtp(),this.uploadbox.start(),this.render()}},_eventStop:function(){this.counter.running>0&&(this.ui_button.model.set("status","info"),a(".upload-top-info").html("Queue will pause after completing the current file..."),this.uploadbox.stop())},_eventReset:function(){if(0==this.counter.running){this.collection.reset(),this.counter.reset(),this.uploadbox.reset(),this.select_extension.value(this.options.default_extension),this.select_genome.value(this.options.default_genome),this.ui_button.model.set("percentage",0),this.render()}},_changeExtension:function(e,t){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("extension")!=i.options.default_extension&&t||n.set("extension",e)})},_changeGenome:function(e,t){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("genome")!=i.options.default_genome&&t||n.set("genome",e)})},_uploadFtp:function(){var e=this,t=[];this.collection.each(function(i){"queued"==i.get("status")&&"ftp"==i.get("file_mode")&&(e.uploadbox.remove(i.id),t.push(i))}),t.length>0&&a.uploadpost({data:this.app.toData(t),url:this.app.options.nginx_upload_path,success:function(i){n.each(t,function(t){e._eventSuccess(t.id)})},error:function(i){n.each(t,function(t){e._eventError(t.id,i)})}})},_uploadPercentage:function(e,t){return(this.upload_completed+e*t)/this.upload_size},_template:function(){return'<div class="upload-view-default"><div class="upload-top"><h6 class="upload-top-info"/></div><div class="upload-box"><div class="upload-helper"><i class="fa fa-files-o"/>Drop files here</div><table class="upload-table ui-table-striped" style="display: none;"><thead><tr><th>Name</th><th>Size</th><th>Type</th><th>Genome</th><th>Settings</th><th>Status</th><th/></tr></thead><tbody/></table></div><div class="upload-footer"><span class="upload-footer-title">Type (set all):</span><span class="upload-footer-extension"/><span class="upload-footer-extension-info upload-icon-button fa fa-search"/> <span class="upload-footer-title">Genome (set all):</span><span class="upload-footer-genome"/></div><div class="upload-buttons"/></div>'}})}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(180),d=(s(l),i(183)),c=s(d),u=i(165),h=s(u),f=i(139),p=s(f);t.default=e.View.extend({status_classes:{init:"upload-icon-button fa fa-trash-o",queued:"upload-icon fa fa-spinner fa-spin",running:"upload-icon fa fa-spinner fa-spin",success:"upload-icon-button fa fa-check",error:"upload-icon-button fa fa-exclamation-triangle"},initialize:function(e,t){var i=this;this.app=e,this.model=t.model,this.setElement(this._template(t.model)),this.$mode=this.$(".upload-mode"),this.$title=this.$(".upload-title"),this.$text=this.$(".upload-text"),this.$size=this.$(".upload-size"),this.$info_text=this.$(".upload-info-text"),this.$info_progress=this.$(".upload-info-progress"),this.$text_content=this.$(".upload-text-content"),this.$settings=this.$(".upload-settings"),this.$symbol=this.$(".upload-symbol"),this.$progress_bar=this.$(".upload-progress-bar"),this.$percentage=this.$(".upload-percentage"),this.settings=new h.default.View({title:"Upload configuration",container:this.$(".upload-settings"),placement:"bottom"});var a=this.app.select_genome.value(),s=this.app.select_extension.value();this.select_genome=new p.default.View({css:"upload-genome",data:i.app.list_genomes,container:this.$(".upload-genome"),value:a,onchange:function(e){i.model.set("genome",e)}}),this.select_extension=new p.default.View({css:"upload-extension",data:i.app.list_extensions,container:this.$(".upload-extension"),value:s,onchange:function(e){i.model.set("extension",e)}}),this.model.set({genome:a,extension:s}),this.$symbol.on("click",function(){i._removeRow()}),this.$(".upload-extension-info").on("click",function(e){i.app.showExtensionInfo({$el:n(e.target),title:i.select_extension.text(),extension:i.select_extension.value()})}).on("mousedown",function(e){e.preventDefault()}),this.$settings.on("click",function(e){i._showSettings()}).on("mousedown",function(e){e.preventDefault()}),this.$text_content.on("change input",function(e){i.model.set({url_paste:n(e.target).val(),file_size:n(e.target).val().length})}),this.listenTo(this.model,"change:percentage",function(){i._refreshPercentage()}),this.listenTo(this.model,"change:status",function(){i._refreshStatus()}),this.listenTo(this.model,"change:info",function(){i._refreshInfo()}),this.listenTo(this.model,"change:genome",function(){i._refreshGenome()}),this.listenTo(this.model,"change:extension",function(){i._refreshExtension()}),this.listenTo(this.model,"change:file_size",function(){i._refreshFileSize()})},render:function(){this._refreshType(),this._refreshPercentage(),this._refreshStatus(),this._refreshInfo(),this._refreshGenome(),this._refreshExtension(),this._refreshFileSize()},remove:function(){this.select_genome.remove(),this.select_extension.remove(),e.View.prototype.remove.apply(this)},_refreshType:function(){var e=this.model.attributes;this.$title.html(a.escape(e.file_name)),this.$size.html(r.default.bytesToString(e.file_size)),this.$mode.removeClass().addClass("upload-mode").addClass("text-primary"),"new"==e.file_mode?(this.$text.css({width:this.$el.width()-16+"px",top:this.$el.height()-8+"px"}).show(),this.$el.height(this.$el.height()-8+this.$text.height()+16),this.$mode.addClass("fa fa-edit")):"local"==e.file_mode?this.$mode.addClass("fa fa-laptop"):"ftp"==e.file_mode&&this.$mode.addClass("fa fa-folder-open-o")},_refreshExtension:function(){this.select_extension.value(this.model.get("extension"))},_refreshGenome:function(){this.select_genome.value(this.model.get("genome"))},_refreshInfo:function(){var e=this.model.get("info");e?this.$info_text.html("<strong>Failed: </strong>"+e).show():this.$info_text.hide()},_refreshPercentage:function(){var e=parseInt(this.model.get("percentage"));this.$progress_bar.css({width:e+"%"}),this.$percentage.html(100!=e?e+"%":"Adding to history...")},_refreshStatus:function(){var e=this.model.get("status");this.$symbol.removeClass().addClass("upload-symbol").addClass(this.status_classes[e]),this.model.set("enabled","init"==e);var t=this.model.get("enabled");this.$text_content.attr("disabled",!t),t?(this.select_genome.enable(),this.select_extension.enable()):(this.select_genome.disable(),this.select_extension.disable()),"success"==e&&(this.$el.addClass("success"),this.$percentage.html("100%")),"error"==e&&(this.$el.addClass("danger"),this.$info_progress.hide())},_refreshFileSize:function(){this.$size.html(r.default.bytesToString(this.model.get("file_size")))},_removeRow:function(){-1!==["init","success","error"].indexOf(this.model.get("status"))&&this.app.collection.remove(this.model)},_showSettings:function(){this.settings.visible?this.settings.hide():(this.settings.empty(),this.settings.append(new c.default(this).$el),this.settings.show())},_template:function(e){return'<tr id="upload-row-'+e.id+'" class="upload-row"><td><div class="upload-text-column"><div class="upload-mode"/><div class="upload-title"/><div class="upload-text"><div class="upload-text-info">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class="upload-text-content form-control"/></div></div></td><td><div class="upload-size"/></td><td><div class="upload-extension" style="float: left;"/>&nbsp;&nbsp<div class="upload-extension-info upload-icon-button fa fa-search"/></td><td><div class="upload-genome"/></td><td><div class="upload-settings upload-icon-button fa fa-gear"/></td><td><div class="upload-info"><div class="upload-info-text"/><div class="upload-info-progress progress"><div class="upload-progress-bar progress-bar progress-bar-success"/><div class="upload-percentage">0%</div></div></div></td><td><div class="upload-symbol '+this.status_classes.init+'"/></td></tr>'}})}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,i,n){Object.defineProperty(t,"__esModule",{value:!0}),t.default=e.View.extend({initialize:function(e){this.$container=e.$container,this.collection=e.collection,this.new_content=e.new_content,this.max=e.max||50,this.content_list={},this.$message=i("<div/>").addClass("ui-limitloader").append("...only the first "+this.max+" entries are visible."),this.$container.append(this.$message),this.listenTo(this.collection,"reset",this._reset,this),this.listenTo(this.collection,"add",this._refresh,this),this.listenTo(this.collection,"remove",this._remove,this)},_done:function(){var e=n.size(this.content_list)>this.max;return this.$message[e?"show":"hide"](),e},_reset:function(){n.each(this.content_list,function(e){e.remove()}),this.content_list={},this.$message.hide()},_remove:function(e){var t=e.id,i=this.content_list[t];i&&(i.remove(),delete this.content_list[t]),this._refresh()},_refresh:function(){if(!this._done())for(var e in this.collection.models){var t=this.collection.models[e];this.content_list[t.id];if(!this.content_list[t.id]){var i=this.new_content(t);if(this.content_list[t.id]=i,this._done())break}}}})}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=(s(o),i(180)),l=s(r),d=i(247),c=s(d),u=i(185),h=s(u),f=i(165),p=(s(f),i(139)),m=s(p),_=i(4),g=s(_);t.default=e.View.extend({collection:new l.default.Collection,initialize:function(e){var t=this;this.app=e,this.options=e.options,this.list_extensions=e.list_extensions,this.list_genomes=e.list_genomes,this.ftp_upload_site=e.currentFtp(),this.setElement(this._template()),this.btnStart=new g.default.Button({title:"Start",onclick:function(){t._eventStart()}}),this.btnClose=new g.default.Button({title:"Close",onclick:function(){t.app.modal.hide()}}),n.each([this.btnStart,this.btnClose],function(e){t.$(".upload-buttons").prepend(e.$el)}),this.select_extension=new m.default.View({css:"upload-footer-selection",container:this.$(".upload-footer-extension"),data:n.filter(this.list_extensions,function(e){return e.composite_files}),onchange:function(e){t.collection.reset();var i=n.findWhere(t.list_extensions,{id:e});i&&i.composite_files&&n.each(i.composite_files,function(e){t.collection.add({id:t.collection.size(),file_desc:e.description||e.name})})}}),this.$(".upload-footer-extension-info").on("click",function(e){new h.default({$el:a(e.target),title:t.select_extension.text(),extension:t.select_extension.value(),list:t.list_extensions,placement:"top"})}).on("mousedown",function(e){e.preventDefault()}),this.select_genome=new m.default.View({css:"upload-footer-selection",container:this.$(".upload-footer-genome"),data:this.list_genomes,value:this.options.default_genome}),this.listenTo(this.collection,"add",function(e){t._eventAnnounce(e)}),this.listenTo(this.collection,"change add",function(){t.render()}),this.select_extension.options.onchange(this.select_extension.value()),this.render()},render:function(){var e=this.collection.first();e&&"running"==e.get("status")?(this.select_genome.disable(),this.select_extension.disable()):(this.select_genome.enable(),this.select_extension.enable()),this.collection.where({status:"ready"}).length==this.collection.length&&this.collection.length>0?(this.btnStart.enable(),this.btnStart.$el.addClass("btn-primary")):(this.btnStart.disable(),this.btnStart.$el.removeClass("btn-primary")),this.$(".upload-table")[this.collection.length>0?"show":"hide"]()},_eventAnnounce:function(e){var t=new c.default(this,{model:e});this.$(".upload-table > tbody:first").append(t.$el),this.$(".upload-table")[this.collection.length>0?"show":"hide"](),t.render()},_eventStart:function(){var e=this;this.collection.each(function(t){t.set({genome:e.select_genome.value(),extension:e.select_extension.value()})}),a.uploadpost({url:this.app.options.nginx_upload_path,data:this.app.toData(this.collection.filter()),success:function(t){e._eventSuccess(t)},error:function(t){e._eventError(t)},progress:function(t){e._eventProgress(t)}})},_eventProgress:function(e){this.collection.each(function(t){t.set("percentage",e)})},_eventSuccess:function(e){this.collection.each(function(e){e.set("status","success")}),Galaxy.currHistoryPanel.refreshContents()},_eventError:function(e){this.collection.each(function(t){t.set({status:"error",info:e})})},_template:function(){return'<div class="upload-view-composite"><div class="upload-top"><h6 class="upload-top-info"/></div><div class="upload-box"><table class="upload-table ui-table-striped" style="display: none;"><thead><tr><th/><th/><th>Description</th><th>Name</th><th>Size</th><th>Settings</th><th>Status</th></tr></thead><tbody/></table></div><div class="upload-footer"><span class="upload-footer-title">Composite Type:</span><span class="upload-footer-extension"/><span class="upload-footer-extension-info upload-icon-button fa fa-search"/> <span class="upload-footer-title">Genome/Build:</span><span class="upload-footer-genome"/></div><div class="upload-buttons"/></div>'}})}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(183),d=s(l),c=i(184),u=s(c),h=i(165),f=s(h),p=i(4),m=s(p),_=i(139);s(_);i(186),t.default=e.View.extend({status_classes:{init:"upload-mode fa fa-exclamation text-primary",ready:"upload-mode fa fa-check text-success",running:"upload-mode fa fa-spinner fa-spin",success:"upload-mode fa fa-check",error:"upload-mode fa fa-exclamation-triangle"},initialize:function(e,t){var i=this;this.app=e,this.model=t.model,this.setElement(this._template()),this.$source=this.$(".upload-source"),this.$settings=this.$(".upload-settings"),this.$status=this.$(".upload-status"),this.$text=this.$(".upload-text"),this.$text_content=this.$(".upload-text-content"),this.$info_text=this.$(".upload-info-text"),this.$info_progress=this.$(".upload-info-progress"),this.$file_name=this.$(".upload-file-name"),this.$file_desc=this.$(".upload-file-desc"),this.$file_size=this.$(".upload-file-size"),this.$progress_bar=this.$(".upload-progress-bar"),this.$percentage=this.$(".upload-percentage"),this.uploadinput=this.$el.uploadinput({ondragover:function(){i.model.get("enabled")&&i.$el.addClass("warning")},ondragleave:function(){i.$el.removeClass("warning")},onchange:function(e){"running"!=i.model.get("status")&&e&&e.length>0&&(i.model.reset({file_data:e[0],file_name:e[0].name,file_size:e[0].size,file_mode:e[0].mode||"local"}),i._refreshReady())}}),this.button_menu=new m.default.ButtonMenu({icon:"fa-caret-down",title:"Select",pull:"left"}),this.$source.append(this.button_menu.$el),this.button_menu.addMenu({icon:"fa-laptop",title:"Choose local file",onclick:function(){i.uploadinput.dialog()}}),this.app.ftp_upload_site&&this.button_menu.addMenu({icon:"fa-folder-open-o",title:"Choose FTP file",onclick:function(){i._showFtp()}}),this.button_menu.addMenu({icon:"fa-edit",title:"Paste/Fetch data",onclick:function(){i.model.reset({file_mode:"new",file_name:"New File"})}}),this.ftp=new f.default.View({title:"Choose FTP file:",container:this.$source.find(".ui-button-menu"),placement:"right"}),this.settings=new f.default.View({title:"Upload configuration",container:this.$settings,placement:"bottom"}),this.$text_content.on("change input",function(e){i.model.set({url_paste:n(e.target).val(),file_size:n(e.target).val().length}),i._refreshReady()}),this.$settings.on("click",function(e){i._showSettings()}).on("mousedown",function(e){e.preventDefault()}),this.listenTo(this.model,"change:percentage",function(){i._refreshPercentage()}),this.listenTo(this.model,"change:status",function(){i._refreshStatus()}),this.listenTo(this.model,"change:info",function(){i._refreshInfo()}),this.listenTo(this.model,"change:file_name",function(){i._refreshFileName()}),this.listenTo(this.model,"change:file_mode",function(){i._refreshMode()}),this.listenTo(this.model,"change:file_size",function(){i._refreshFileSize()}),this.listenTo(this.model,"remove",function(){i.remove()}),this.app.collection.on("reset",function(){i.remove()})},render:function(){this.$el.attr("id","upload-row-"+this.model.id),this.$file_name.html(a.escape(this.model.get("file_name")||"-")),this.$file_desc.html(this.model.get("file_desc")||"Unavailable"),this.$file_size.html(r.default.bytesToString(this.model.get("file_size"))),this.$status.removeClass().addClass(this.status_classes.init)},remove:function(){e.View.prototype.remove.apply(this)},_refreshReady:function(){this.app.collection.each(function(e){e.set("status",e.get("file_size")>0&&"ready"||"init")})},_refreshMode:function(){"new"==this.model.get("file_mode")?(this.height=this.$el.height(),this.$text.css({width:this.$el.width()-16+"px",top:this.$el.height()-8+"px"}).show(),this.$el.height(this.$el.height()-8+this.$text.height()+16),this.$text_content.val("").trigger("keyup")):(this.$el.height(this.height),this.$text.hide())},_refreshInfo:function(){var e=this.model.get("info");e?this.$info_text.html("<strong>Failed: </strong>"+e).show():this.$info_text.hide()},_refreshPercentage:function(){var e=parseInt(this.model.get("percentage"));0!=e?this.$progress_bar.css({width:e+"%"}):(this.$progress_bar.addClass("no-transition"),this.$progress_bar.css({width:"0%"}),this.$progress_bar[0].offsetHeight,this.$progress_bar.removeClass("no-transition")),this.$percentage.html(100!=e?e+"%":"Adding to history...")},_refreshStatus:function(){var e=this.model.get("status");this.$status.removeClass().addClass(this.status_classes[e]),this.model.set("enabled","running"!=e),this.$text_content.attr("disabled",!this.model.get("enabled")),this.$el.removeClass("success danger warning"),"running"!=e&&"ready"!=e||this.model.set("percentage",0),this.$source.find(".button")["running"==e?"addClass":"removeClass"]("disabled"),"success"==e&&(this.$el.addClass("success"),this.model.set("percentage",100),this.$percentage.html("100%")),"error"==e?(this.$el.addClass("danger"),this.model.set("percentage",0),this.$info_progress.hide(),this.$info_text.show()):(this.$info_progress.show(),this.$info_text.hide())},_refreshFileName:function(){this.$file_name.html(this.model.get("file_name")||"-")},_refreshFileSize:function(){this.$file_size.html(r.default.bytesToString(this.model.get("file_size")))},_showFtp:function(){if(this.ftp.visible)this.ftp.hide();else{var e=this;this.ftp.empty(),this.ftp.append(new u.default({ftp_upload_site:this.app.ftp_upload_site,onchange:function(t){e.ftp.hide(),"running"!=e.model.get("status")&&t&&(e.model.reset({file_mode:"ftp",file_name:t.path,file_size:t.size,file_path:t.path}),e._refreshReady())}}).$el),this.ftp.show()}},_showSettings:function(){this.settings.visible?this.settings.hide():(this.settings.empty(),this.settings.append(new d.default(this).$el),this.settings.show())},_template:function(){return'<tr class="upload-row"><td><div class="upload-source"/><div class="upload-text-column"><div class="upload-text"><div class="upload-text-info">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class="upload-text-content form-control"/></div></div></td><td><div class="upload-status"/></td><td><div class="upload-file-desc upload-title"/></td><td><div class="upload-file-name upload-title"/></td><td><div class="upload-file-size upload-size"/></td><td><div class="upload-settings upload-icon-button fa fa-gear"/></td><td><div class="upload-info"><div class="upload-info-text"/><div class="upload-info-progress progress"><div class="upload-progress-bar progress-bar progress-bar-success"/><div class="upload-percentage">0%</div></div></div></td></tr>'}})}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=(s(o),i(180)),l=s(r),d=i(249),c=s(d),u=i(184),h=s(u),f=i(185),p=s(f),m=i(165),_=s(m),g=i(139),v=s(g),w=i(4),b=s(w),y=i(187);s(y);i(186),t.default=e.View.extend({upload_size:0,collection:new l.default.Collection,counter:{announce:0,success:0,error:0,running:0,reset:function(){this.announce=this.success=this.error=this.running=0}},initialize:function(e){var t=this;this.app=e,this.options=e.options,this.list_extensions=e.list_extensions,this.list_genomes=e.list_genomes,this.ui_button=e.ui_button,this.ftp_upload_site=e.currentFtp(),this.setElement(this._template()),this.btnLocal=new b.default.Button({id:"btn-local",title:"Choose local files",onclick:function(){t.uploadbox.select()},icon:"fa fa-laptop"}),this.btnFtp=new b.default.Button({id:"btn-ftp",title:"Choose FTP files",onclick:function(){t._eventFtp()},icon:"fa fa-folder-open-o"}),this.btnCreate=new b.default.Button({id:"btn-new",title:"Paste/Fetch data",onclick:function(){t._eventCreate()},icon:"fa fa-edit"}),this.btnStart=new b.default.Button({id:"btn-start",title:"Start",onclick:function(){t._eventStart()}}),this.btnBuild=new b.default.Button({id:"btn-build",title:"Build",onclick:function(){t._eventBuild()}}),this.btnStop=new b.default.Button({id:"btn-stop",title:"Pause",onclick:function(){t._eventStop()}}),this.btnReset=new b.default.Button({id:"btn-reset",title:"Reset",onclick:function(){t._eventReset()}}),this.btnClose=new b.default.Button({id:"btn-close",title:"Close",onclick:function(){t.app.modal.hide()}}),n.each([this.btnLocal,this.btnFtp,this.btnCreate,this.btnStop,this.btnReset,this.btnStart,this.btnBuild,this.btnClose],function(e){t.$(".upload-buttons").prepend(e.$el)}),this.uploadbox=this.$(".upload-box").uploadbox({url:this.app.options.nginx_upload_path,announce:function(e,i){t._eventAnnounce(e,i)},initialize:function(e){return t.app.toData([t.collection.get(e)],t.history_id)},progress:function(e,i){t._eventProgress(e,i)},success:function(e,i){t._eventSuccess(e,i)},error:function(e,i){t._eventError(e,i)},complete:function(){t._eventComplete()},ondragover:function(){t.$(".upload-box").addClass("highlight")},ondragleave:function(){t.$(".upload-box").removeClass("highlight")}}),this.ftp=new _.default.View({title:"FTP files",container:this.btnFtp.$el}),this.select_extension=new v.default.View({css:"upload-footer-selection-compressed",container:this.$(".upload-footer-extension"),data:n.filter(this.list_extensions,function(e){return!e.composite_files}),value:this.options.default_extension,onchange:function(e){t.updateExtension(e)}}),this.collectionType="list",this.select_collection=new v.default.View({css:"upload-footer-selection-compressed",container:this.$(".upload-footer-collection-type"),data:[{id:"list",text:"List"},{id:"paired",text:"Paired"},{id:"list:paired",text:"List of Pairs"}],value:"list",onchange:function(e){t.updateCollectionType(e)}}),this.$(".upload-footer-extension-info").on("click",function(e){new p.default({$el:a(e.target),title:t.select_extension.text(),extension:t.select_extension.value(),list:t.list_extensions,placement:"top"})}).on("mousedown",function(e){e.preventDefault()}),this.select_genome=new v.default.View({css:"upload-footer-selection",container:this.$(".upload-footer-genome"),data:this.list_genomes,value:this.options.default_genome,onchange:function(e){t.updateGenome(e)}}),this.collection.on("remove",function(e){t._eventRemove(e)}),this._updateScreen()},_eventAnnounce:function(e,t){this.counter.announce++;var i=new l.default.Model({id:e,file_name:t.name,file_size:t.size,file_mode:t.mode||"local",file_path:t.path,file_data:t,extension:this.select_extension.value(),genome:this.select_genome.value()});this.collection.add(i);var n=new c.default(this,{model:i});this.$(".upload-table > tbody:first").append(n.$el),this._updateScreen(),n.render()},_eventProgress:function(e,t){var i=this.collection.get(e);i.set("percentage",t),this.ui_button.model.set("percentage",this._uploadPercentage(t,i.get("file_size")))},_eventSuccess:function(e,t){var i=n.pluck(t.outputs,"hid"),a=this.collection.get(e);a.set({percentage:100,status:"success",hids:i}),this.ui_button.model.set("percentage",this._uploadPercentage(100,a.get("file_size"))),this.upload_completed+=100*a.get("file_size"),this.counter.announce--,this.counter.success++,this._updateScreen(),Galaxy.currHistoryPanel.refreshContents()},_eventError:function(e,t){var i=this.collection.get(e);i.set({percentage:100,status:"error",info:t}),this.ui_button.model.set({percentage:this._uploadPercentage(100,i.get("file_size")),status:"danger"}),this.upload_completed+=100*i.get("file_size"),this.counter.announce--,this.counter.error++,this._updateScreen()},_eventComplete:function(){this.collection.each(function(e){"queued"==e.get("status")&&e.set("status","init")}),this.counter.running=0,this._updateScreen()},_eventBuild:function(){var e=[];n.forEach(this.collection.models,function(t){e.push.apply(e,t.get("hids"))});var t=n.map(e,function(e){return Galaxy.currHistoryPanel.collection.getByHid(e)}),i=new Galaxy.currHistoryPanel.collection.constructor(t);i.historyId=Galaxy.currHistoryPanel.collection.historyId,Galaxy.currHistoryPanel.buildCollection(this.collectionType,i,!0),this.counter.running=0,this._updateScreen(),this._eventReset(),this.app.modal.hide()},_eventRemove:function(e){var t=e.get("status");"success"==t?this.counter.success--:"error"==t?this.counter.error--:this.counter.announce--,this.uploadbox.remove(e.id),this._updateScreen()},_eventFtp:function(){if(this.ftp.visible)this.ftp.hide();else{this.ftp.empty();var e=this;this.ftp.append(new h.default({collection:this.collection,ftp_upload_site:this.ftp_upload_site,onadd:function(t){return e.uploadbox.add([{mode:"ftp",name:t.path,size:t.size,path:t.path}])},onremove:function(t){e.collection.remove(t)}}).$el),this.ftp.show()}},_eventCreate:function(){this.uploadbox.add([{name:"New File",size:0,mode:"new"}])},_eventStart:function(){if(!(0==this.counter.announce||this.counter.running>0)){var e=this;this.upload_size=0,this.upload_completed=0,this.collection.each(function(t){"init"==t.get("status")&&(t.set("status","queued"),e.upload_size+=t.get("file_size"))}),this.ui_button.model.set({percentage:0,status:"success"}),this.counter.running=this.counter.announce,this.history_id=this.app.currentHistory(),this.uploadbox.start(),this._updateScreen()}},_eventStop:function(){this.counter.running>0&&(this.ui_button.model.set("status","info"),a(".upload-top-info").html("Queue will pause after completing the current file..."),this.uploadbox.stop())},_eventReset:function(){0==this.counter.running&&(this.collection.reset(),this.counter.reset(),this.uploadbox.reset(),this.select_extension.value(this.options.default_extension),this.select_genome.value(this.options.default_genome),this.ui_button.model.set("percentage",0),this._updateScreen())},updateExtension:function(e,t){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("extension")!=i.options.default_extension&&t||n.set("extension",e)})},updateCollectionType:function(e){this.collectionType=e},updateGenome:function(e,t){var i=this;this.collection.each(function(n){"init"!=n.get("status")||n.get("genome")!=i.options.default_genome&&t||n.set("genome",e)})},_updateScreen:function(){var e="";e=0==this.counter.announce?this.uploadbox.compatible()?"&nbsp;":"Browser does not support Drag & Drop. Try Firefox 4+, Chrome 7+, IE 10+, Opera 12+ or Safari 6+.":0==this.counter.running?"You added "+this.counter.announce+" file(s) to the queue. Add more files or click 'Start' to proceed.":"Please wait..."+this.counter.announce+" out of "+this.counter.running+" remaining.",this.$(".upload-top-info").html(e);var t=0==this.counter.running&&this.counter.announce+this.counter.success+this.counter.error>0,i=0==this.counter.running&&this.counter.announce>0,n=0==this.counter.running&&0==this.counter.announce&&this.counter.success>0&&0==this.counter.error,a=0==this.counter.running,s=this.counter.announce+this.counter.success+this.counter.error>0;this.btnReset[t?"enable":"disable"](),this.btnStart[i?"enable":"disable"](),this.btnStart.$el[i?"addClass":"removeClass"]("btn-primary"),this.btnBuild[n?"enable":"disable"](),this.btnBuild.$el[n?"addClass":"removeClass"]("btn-primary"),this.btnStop[this.counter.running>0?"enable":"disable"](),this.btnLocal[a?"enable":"disable"](),this.btnFtp[a?"enable":"disable"](),this.btnCreate[a?"enable":"disable"](),this.btnFtp.$el[this.ftp_upload_site?"show":"hide"](),this.$(".upload-table")[s?"show":"hide"](),this.$(".upload-helper")[s?"hide":"show"]()},_uploadPercentage:function(e,t){return(this.upload_completed+e*t)/this.upload_size},_template:function(){return'<div class="upload-view-default"><div class="upload-top"><h6 class="upload-top-info"/></div><div class="upload-box"><div class="upload-helper"><i class="fa fa-files-o"/>Drop files here</div><table class="upload-table ui-table-striped" style="display: none;"><thead><tr><th>Name</th><th>Size</th><th>Status</th><th/></tr></thead><tbody/></table></div><div class="upload-footer"><span class="upload-footer-title-compressed">Collection Type:</span><span class="upload-footer-collection-type"/><span class="upload-footer-title-compressed">File Type:</span><span class="upload-footer-extension"/><span class="upload-footer-extension-info upload-icon-button fa fa-search"/> <span class="upload-footer-title-compressed">Genome (set all):</span><span class="upload-footer-genome"/></div><div class="upload-buttons"/></div>'}})}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(180),d=(s(l),i(183)),c=s(d),u=i(165),h=s(u),f=i(139);s(f);t.default=e.View.extend({status_classes:{init:"upload-icon-button fa fa-trash-o",queued:"upload-icon fa fa-spinner fa-spin",running:"upload-icon fa fa-spinner fa-spin",success:"upload-icon-button fa fa-check",error:"upload-icon-button fa fa-exclamation-triangle"},initialize:function(e,t){var i=this;this.app=e,this.model=t.model,this.setElement(this._template(t.model)),this.$mode=this.$(".upload-mode"),this.$title=this.$(".upload-title-extended"),this.$text=this.$(".upload-text"),this.$size=this.$(".upload-size"),this.$info_text=this.$(".upload-info-text"),this.$info_progress=this.$(".upload-info-progress"),this.$text_content=this.$(".upload-text-content"),this.$symbol=this.$(".upload-symbol"),this.$progress_bar=this.$(".upload-progress-bar"),this.$percentage=this.$(".upload-percentage"),this.settings=new h.default.View({title:"Upload configuration",container:this.$(".upload-settings"),placement:"bottom"});this.app.select_genome.value(),this.app.select_extension.value();this.$symbol.on("click",function(){i._removeRow()}),this.$text_content.on("change input",function(e){i.model.set({url_paste:n(e.target).val(),file_size:n(e.target).val().length})}),this.listenTo(this.model,"change:percentage",function(){i._refreshPercentage()}),this.listenTo(this.model,"change:status",function(){i._refreshStatus()}),this.listenTo(this.model,"change:info",function(){i._refreshInfo()}),this.listenTo(this.model,"change:file_size",function(){i._refreshFileSize()}),this.listenTo(this.model,"remove",function(){i.remove()}),this.app.collection.on("reset",function(){i.remove()})},render:function(){var e=this.model.attributes;this.$title.html(a.escape(e.file_name)),this.$size.html(r.default.bytesToString(e.file_size)),this.$mode.removeClass().addClass("upload-mode").addClass("text-primary"),"new"==e.file_mode?(this.$text.css({width:this.$el.width()-16+"px",top:this.$el.height()-8+"px"}).show(),this.$el.height(this.$el.height()-8+this.$text.height()+16),this.$mode.addClass("fa fa-edit")):"local"==e.file_mode?this.$mode.addClass("fa fa-laptop"):"ftp"==e.file_mode&&this.$mode.addClass("fa fa-folder-open-o")},_refreshInfo:function(){var e=this.model.get("info");e?this.$info_text.html("<strong>Failed: </strong>"+e).show():this.$info_text.hide()},_refreshPercentage:function(){var e=parseInt(this.model.get("percentage"));this.$progress_bar.css({width:e+"%"}),this.$percentage.html(100!=e?e+"%":"Adding to history...")},_refreshStatus:function(){var e=this.model.get("status");this.$symbol.removeClass().addClass("upload-symbol").addClass(this.status_classes[e]),this.model.set("enabled","init"==e);var t=this.model.get("enabled");this.$text_content.attr("disabled",!t),"success"==e&&(this.$el.addClass("success"),this.$percentage.html("100%")),"error"==e&&(this.$el.addClass("danger"),this.$info_progress.hide())},_refreshFileSize:function(){this.$size.html(r.default.bytesToString(this.model.get("file_size")))},_removeRow:function(){-1!==["init","success","error"].indexOf(this.model.get("status"))&&this.app.collection.remove(this.model)},_showSettings:function(){this.settings.visible?this.settings.hide():(this.settings.empty(),this.settings.append(new c.default(this).$el),this.settings.show())},_template:function(e){return'<tr id="upload-row-'+e.id+'" class="upload-row"><td><div class="upload-text-column"><div class="upload-mode"/><div class="upload-title-extended"/><div class="upload-text"><div class="upload-text-info">You can tell Galaxy to download data from web by entering URL in this box (one per line). You can also directly paste the contents of a file.</div><textarea class="upload-text-content form-control"/></div></div></td><td><div class="upload-size"/></td><td><div class="upload-info"><div class="upload-info-text"/><div class="upload-info-progress progress"><div class="upload-progress-bar progress-bar progress-bar-success"/><div class="upload-percentage">0%</div></div></div></td><td><div class="upload-symbol '+this.status_classes.init+'"/></td></tr>'}})}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(4),s=n(a),o=i(251),r=n(o),l=i(252),d=n(l),c=i(7),u=n(c),h=e.View.extend({initialize:function(t,i){var n=this;this.userIsAnonymous=Galaxy.user.isAnonymous(),this.allow_user_dataset_purge=i.config.allow_user_dataset_purge,this.root=i.root,this.historyView=new d.default.CurrentHistoryView({className:d.default.CurrentHistoryView.prototype.className+" middle",purgeAllowed:this.allow_user_dataset_purge,linkTarget:"galaxy_main"}),Galaxy.currHistoryPanel=this.historyView,Galaxy.currHistoryPanel.listenToGalaxy(Galaxy),this.buttonRefresh=new s.default.ButtonLink({id:"history-refresh-button",title:"Refresh history",cls:"panel-header-button",icon:"fa fa-refresh",onclick:function(){n.historyView.loadCurrentHistory()}}),this.buttonOptions=new s.default.ButtonLink({id:"history-options-button",title:"History options",cls:"panel-header-button",target:"galaxy_main",icon:"fa fa-cog",href:this.root+"root/history_options"}),this.buttonViewMulti=new s.default.ButtonLink({id:"history-view-multi-button",title:"View all histories",cls:"panel-header-button",icon:"fa fa-columns",href:this.root+"history/view_multiple"}),this.model=new e.Model({cls:"history-right-panel",title:(0,u.default)("History"),buttons:[this.buttonRefresh,this.buttonOptions,this.buttonViewMulti]}),this.setElement(this._template()),this.historyView.setElement(this.$el),this.historyView.connectToQuotaMeter(Galaxy.quotaMeter),this.historyView.loadCurrentHistory(),Galaxy.listenTo(this.historyView,"history-size-change",function(){Galaxy.user.fetch({url:Galaxy.user.urlRoot()+"/"+(Galaxy.user.id||"current")})})},render:function(){this.optionsMenu=(0,r.default)(this.buttonOptions.$el,{anonymous:this.userIsAnonymous,purgeAllowed:this.allow_user_dataset_purge,root:this.root}),this.buttonViewMulti.$el[this.userIsAnonymous?"hide":"show"]()},_template:function(e){return['<div id="current-history-panel" class="history-panel middle"/>'].join("")},toString:function(){return"historyPanel"}});t.default=h}).call(t,i(1))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}function s(e,t,i){return n.clone(m).filter(function(n){return!(e&&!n.anon)&&(!(!t&&n.purge)&&(n.href&&(n.href=i+n.href,n.target=n.target||"galaxy_main"),n.confirm&&(n.func=function(){confirm(n.confirm)&&(galaxy_main.location=n.href)}),!0))})}Object.defineProperty(t,"__esModule",{value:!0});var o=i(67),r=a(o),l=i(211),d=a(l),c=i(8),u=(a(c),i(7)),h=a(u),f=i(40),p=a(f),m=[{html:(0,h.default)("History Lists"),header:!0},{html:(0,h.default)("Saved Histories"),href:"histories/list",target:"_top"},{html:(0,h.default)("Histories Shared with Me"),href:"histories/list_shared",target:"_top"},{html:(0,h.default)("Current History"),header:!0,anon:!0},{html:(0,h.default)("Create New"),func:function(){Galaxy&&Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.createNewHistory()}},{html:(0,h.default)("Copy History"),func:function(){(0,d.default)(Galaxy.currHistoryPanel.model).done(function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,h.default)("Share or Publish"),href:"history/sharing"},{html:(0,h.default)("Show Structure"),href:"history/display_structured",anon:!0},{html:(0,h.default)("Extract Workflow"),href:"workflow/build_from_current_history"},{html:(0,h.default)("Delete"),anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&confirm((0,h.default)("Really delete the current history?"))&&Galaxy.currHistoryPanel.model._delete().done(function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,h.default)("Delete Permanently"),purge:!0,anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&confirm((0,h.default)("Really delete the current history permanently? This cannot be undone."))&&Galaxy.currHistoryPanel.model.purge().done(function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,h.default)("Dataset Actions"),header:!0,anon:!0},{html:(0,h.default)("Copy Datasets"),href:"dataset/copy_datasets"},{html:(0,h.default)("Dataset Security"),func:function(){Galaxy&&Galaxy.currHistoryPanel&&Galaxy.router&&Galaxy.router.push("/histories/permissions?id="+Galaxy.currHistoryPanel.model.id)}},{html:(0,h.default)("Resume Paused Jobs"),href:"history/resume_paused_jobs?current=True",anon:!0},{html:(0,h.default)("Collapse Expanded Datasets"),func:function(){Galaxy&&Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.collapseAll()}},{html:(0,h.default)("Unhide Hidden Datasets"),anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&confirm((0,h.default)("Really unhide all hidden datasets?"))&&e.post(Galaxy.root+"history/adjust_hidden",{user_action:"unhide"},function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,h.default)("Delete Hidden Datasets"),anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&confirm((0,h.default)("Really delete all hidden datasets?"))&&e.post(Galaxy.root+"history/adjust_hidden",{user_action:"delete"},function(){Galaxy.currHistoryPanel.loadCurrentHistory()})}},{html:(0,h.default)("Purge Deleted Datasets"),confirm:(0,h.default)("Really delete all deleted datasets permanently? This cannot be undone."),href:"history/purge_deleted_datasets",purge:!0,anon:!0},{html:(0,h.default)("Downloads"),header:!0},{html:(0,h.default)("Export Tool Citations"),anon:!0,func:function(){Galaxy&&Galaxy.currHistoryPanel&&Galaxy.router&&Galaxy.router.push("/histories/citations?id="+Galaxy.currHistoryPanel.model.id)}},{html:(0,h.default)("Export History to File"),href:"history/export_archive?preview=True",anon:!0},{html:(0,h.default)("Other Actions"),header:!0},{html:(0,h.default)("Import from File"),href:"history/import_archive"}];p.default.add({url:"api/webhooks/history-menu/all",async:!1,callback:function(t){var i=[];e.each(t.models,function(e,t){var n=t.toJSON();n.activate&&i.push({html:(0,h.default)(n.config.title),anon:!0})}),i.length>0&&(i.unshift({html:(0,h.default)("Webhooks"),header:!0}),e.merge(m,i))}});var _=function(e,t){t=t||{};var i=void 0===t.anonymous||t.anonymous,n=t.purgeAllowed||!1,a=s(i,n,Galaxy.root);return new r.default(e,a)};t.default=_}).call(t,i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(191),r=(s(o),i(254)),l=s(r),d=i(8),c=s(d),u=i(7),h=s(u),f=c.default.SessionStorageModel.extend({defaults:{tagsEditorShown:!1,annotationEditorShown:!1,scrollPosition:0},toString:function(){return"HistoryViewPrefs("+JSON.stringify(this.toJSON())+")"}});f.storageKey=function(){return"history-panel"};var p=l.default.HistoryViewEdit,m=p.extend({className:p.prototype.className+" current-history-panel",HDCAViewClass:p.prototype.HDCAViewClass.extend({foldoutStyle:"drilldown"}),emptyMsg:[(0,h.default)("This history is empty"),". ",(0,h.default)("You can "),'<a class="uploader-link" href="javascript:void(0)">',(0,h.default)("load your own data"),"</a>",(0,h.default)(" or "),'<a class="get-data-link" href="javascript:void(0)">',(0,h.default)("get data from an external source"),"</a>"].join(""),initialize:function(t){t=t||{},this.preferences=new f(e.extend({id:f.storageKey()},e.pick(t,e.keys(f.prototype.defaults)))),p.prototype.initialize.call(this,t),this.panelStack=[],this.currentContentId=t.currentContentId||null},_setUpListeners:function(){p.prototype._setUpListeners.call(this);var e=this;this.on("new-model",function(){e.preferences.set("scrollPosition",0)})},loadCurrentHistory:function(){return this.loadHistory(null,{url:Galaxy.root+"history/current_history_json"})},switchToHistory:function(e,t){return Galaxy.user.isAnonymous()?(this.trigger("error",(0,h.default)("You must be logged in to switch histories"),(0,h.default)("Anonymous user")),n.when()):this.loadHistory(e,{url:Galaxy.root+"history/set_as_current?id="+e})},createNewHistory:function(e){return Galaxy.user.isAnonymous()?(this.trigger("error",(0,h.default)("You must be logged in to create histories"),(0,h.default)("Anonymous user")),n.when()):this.loadHistory(null,{url:Galaxy.root+"history/create_new_current"})},setModel:function(e,t,i){return p.prototype.setModel.call(this,e,t,i),this.model&&this.model.id&&(this.log("checking for updates"),this.model.checkForUpdates()),this},_setUpModelListeners:function(){return p.prototype._setUpModelListeners.call(this),this.listenTo(this.model,{"change:nice_size change:size":function(){this.trigger("history-size-change",this,this.model,arguments)},"change:id":function(){this.once("loading-done",function(){this.model.checkForUpdates()})}})},_setUpCollectionListeners:function(){p.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,"state:ready",function(e,t,i){e.get("visible")||this.collection.storage.includeHidden()||this.removeItemView(e)})},_setUpBehaviors:function(t){t=t||this.$el;var i=this;return p.prototype._setUpBehaviors.call(i,t),this._debouncedScrollCaptureHandler||(this._debouncedScrollCaptureHandler=e.debounce(function(){i.$el.is(":visible")&&i.preferences.set("scrollPosition",n(this).scrollTop())},40)),i.$scrollContainer(t).off("scroll",this._debouncedScrollCaptureHandler).on("scroll",this._debouncedScrollCaptureHandler),i},_buildNewRender:function(){if(!this.model)return n();var e=p.prototype._buildNewRender.call(this);return e.find(".search").prependTo(e.find("> .controls")),this._renderQuotaMessage(e),e},_renderQuotaMessage:function(e){return e=e||this.$el,n(this.templates.quotaMsg({},this)).prependTo(e.find(".messages"))},_renderTags:function(e){var t=this;p.prototype._renderTags.call(t,e),t.preferences.get("tagsEditorShown")&&t.tagsEditor.toggle(!0),t.listenTo(t.tagsEditor,"hiddenUntilActivated:shown hiddenUntilActivated:hidden",function(e){t.preferences.set("tagsEditorShown",e.hidden)})},_renderAnnotation:function(e){var t=this;p.prototype._renderAnnotation.call(t,e),t.preferences.get("annotationEditorShown")&&t.annotationEditor.toggle(!0),t.listenTo(t.annotationEditor,"hiddenUntilActivated:shown hiddenUntilActivated:hidden",function(e){t.preferences.set("annotationEditorShown",e.hidden)})},_swapNewRender:function(t){p.prototype._swapNewRender.call(this,t);var i=this;return e.delay(function(){var e=i.preferences.get("scrollPosition");e&&i.scrollTo(e,0)},10),this},_attachItems:function(e){p.prototype._attachItems.call(this,e);var t=this;return t.currentContentId&&t._setCurrentContentById(t.currentContentId),this},addItemView:function(e,t,i){var n=p.prototype.addItemView.call(this,e,t,i);return n&&this.panelStack.length?this._collapseDrilldownPanel():n},_setUpItemViewListeners:function(e){var t=this;return p.prototype._setUpItemViewListeners.call(t,e),t.listenTo(e,{"expanded:drilldown":function(e,t){this._expandDrilldownPanel(t)},"collapsed:drilldown":function(e,t){this._collapseDrilldownPanel(t)}})},setCurrentContent:function(e){this.$(".history-content.current-content").removeClass("current-content"),e?(e.$el.addClass("current-content"),this.currentContentId=e.model.id):this.currentContentId=null},_setCurrentContentById:function(e){var t=this.viewFromModelId(e)||null;this.setCurrentContent(t)},_expandDrilldownPanel:function(e){this.panelStack.push(e),this.$controls().add(this.$list()).hide(),e.parentName=this.model.get("name"),e.delegateEvents().render().$el.appendTo(this.$el)},_collapseDrilldownPanel:function(e){this.panelStack.pop(),this.$controls().add(this.$list()).show()},events:e.extend(e.clone(p.prototype.events),{"click .uploader-link":function(e){Galaxy.upload.show(e)},"click .get-data-link":function(e){var t=n(".toolMenuContainer");t.parent().scrollTop(0),t.find('span:contains("Get Data")').click()}}),listenToGalaxy:function(t){this.listenTo(t,{"center-frame:load":function(t){var i=t.fullpath,n=null,a={display:/datasets\/([a-f0-9]+)\/display/,edit:/datasets\/([a-f0-9]+)\/edit/,report_error:/dataset\/errors\?id=([a-f0-9]+)/,rerun:/tool_runner\/rerun\?id=([a-f0-9]+)/,show_params:/datasets\/([a-f0-9]+)\/show_params/};e.find(a,function(t,a){return n=e.result(i.match(t),1)}),this._setCurrentContentById(n?"dataset-"+n:null)},"center-panel:load":function(e){this._setCurrentContentById()}})},connectToQuotaMeter:function(e){return e?(this.listenTo(e,"quota:over",this.showQuotaMessage),this.listenTo(e,"quota:under",this.hideQuotaMessage),this.on("rendered rendered:initial",function(){e&&e.isOverQuota()&&this.showQuotaMessage()}),this):this},clearMessages:function(t){var i=e.isUndefined(t)?this.$messages().children('[class$="message"]'):n(t.currentTarget);return i=i.not(".quota-message"),i.fadeOut(this.fxSpeed,function(){n(this).remove()}),this},showQuotaMessage:function(){var e=this.$(".quota-message");e.is(":hidden")&&e.slideDown(this.fxSpeed)},hideQuotaMessage:function(){var e=this.$(".quota-message");e.is(":hidden")||e.slideUp(this.fxSpeed)},unhideHidden:function(){var e=this;return confirm((0,h.default)("Really unhide all hidden datasets?"))?e.model.contents._filterAndUpdate({visible:!1,deleted:"",purged:""},{visible:!0}).done(function(){e.model.contents.includeHidden||e.renderItems()}):a.when()},deleteHidden:function(){var e=this;return confirm((0,h.default)("Really delete all hidden datasets?"))?e.model.contents._filterAndUpdate({visible:!1,deleted:"",purged:""},{deleted:!0,visible:!0}):a.when()},toString:function(){return"CurrentHistoryView("+(this.model?this.model.get("name"):"")+")"}});m.prototype.templates=function(){var t=c.default.wrapTemplate(['<div class="quota-message errormessage">',(0,h.default)("You are over your disk quota"),". ",(0,h.default)("Tool execution is on hold until your disk usage drops below your allocated quota"),".","</div>"],"history");return e.extend(e.clone(p.prototype.templates),{quotaMsg:t})}(),t.default={CurrentHistoryView:m}}).call(t,i(2),i(0),i(0))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1),a=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(n),s=i(215),o=function(e){return e&&e.__esModule?e:{default:e}}(s),r=["new","queued","running"],l=["error","deleted"],d=a.Model.extend({url:function(){return Galaxy.root+"api/histories/"+this.attributes.history_id+"/contents/dataset_collections/"+this.attributes.collection_id+"/jobs_summary"},hasDetails:function(){return this.has("populated_state")},new:function(){return!this.hasDetails()||"new"==this.get("populated_state")},errored:function(){return"error"===this.get("populated_state")||this.anyWithStates(l)},states:function(){return this.get("states")||{}},anyWithState:function(e){return(this.states()[e]||0)>0},anyWithStates:function(e){var t=this.states();for(var i in e)if((t[e[i]]||0)>0)return!0;return!1},numWithStates:function(e){var t=this.states(),i=0;for(var n in e)i+=t[e[n]]||0;return i},numInError:function(){return this.numWithStates(l)},running:function(){return this.anyWithState("running")},terminal:function(){return!this.new()&&!this.anyWithStates(r)},jobCount:function(){var e=this.states(),t=0;for(var i in e)t+=e[i];return t},toString:function(){return"JobStatesSummary(id="+this.get("id")+")"}}),c=a.Collection.extend({model:d,initialize:function(){this.updateTimeoutId=null,this.active=!0},url:function(){var e=this.models.filter(function(e){return!e.terminal()}),t=e.map(function(e){return e.get("id")}).join(","),i=e.map(function(e){return e.get("model")}).join(",");return Galaxy.root+"api/histories/"+this.historyId+"/jobs_summary?ids="+t+"&types="+i},monitor:function(){var e=this;if(this.clearUpdateTimeout(),this.active){var t=function(){e.updateTimeoutId=setTimeout(function(){e.monitor()},2e3)},i=this.models.filter(function(e){return!e.terminal()});if(i.length,!1){var n=i.map(function(e){return function(){return e.fetch()}});return new o.default.AjaxQueue(n).done(t)}i.length>0?this.fetch({remove:!1}).done(t):t()}},clearUpdateTimeout:function(){this.updateTimeoutId&&(clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null)},toString:function(){return"JobStatesSummaryCollection()"}});t.default={JobStatesSummary:d,JobStatesSummaryCollection:c,FETCH_STATE_ON_ADD:!1}},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(255),r=s(o),l=i(192),d=(s(l),i(166)),c=(s(d),i(214)),u=s(c),h=i(257),f=s(h),p=i(258),m=s(p),_=i(181),g=s(_),v=i(223),w=s(v),b=i(187),y=s(b),x=i(261),k=s(x),C=i(262),$=s(C),S=i(175),T=s(S),M=i(67),E=(s(M),i(8)),P=s(E),O=i(7),A=s(O);i(25);var D=r.default.HistoryView,I=D.extend({HDAViewClass:f.default.HDAListItemEdit,HDCAViewClass:m.default.HDCAListItemEdit,initialize:function(e){e=e||{},D.prototype.initialize.call(this,e),this.tagsEditor=null,this.dragItems=!0,this.annotationEditor=null,this.purgeAllowed=e.purgeAllowed||!1,this.annotationEditorShown=e.annotationEditorShown||!1,this.tagsEditorShown=e.tagsEditorShown||!1},_setUpListeners:function(){return D.prototype._setUpListeners.call(this),this.on({"droptarget:drop":function(e,t){this.dataDropped(t),this.dropTargetOff()},"view:attached view:removed":function(){this._renderCounts()},"search:loading-progress":this._renderSearchProgress,"search:searching":this._renderSearchFindings})},_setUpModelListeners:function(){return D.prototype._setUpModelListeners.call(this),this.listenTo(this.model,"change:size",this.updateHistoryDiskSize),this},_setUpCollectionListeners:function(){return D.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,{"change:deleted":this._handleItemDeletedChange,"change:visible":this._handleItemVisibleChange,"change:purged":function(e){this.model.fetch()},"fetching-deleted":function(e){this.$("> .controls .deleted-count").html("<i>"+(0,A.default)("loading...")+"</i>")},"fetching-hidden":function(e){this.$("> .controls .hidden-count").html("<i>"+(0,A.default)("loading...")+"</i>")},"fetching-deleted-done fetching-hidden-done":this._renderCounts}),this},_buildNewRender:function(){var e=D.prototype._buildNewRender.call(this);return this.model?(Galaxy&&Galaxy.user&&Galaxy.user.id&&Galaxy.user.id===this.model.get("user_id")&&(this._renderTags(e),this._renderAnnotation(e)),e):e},updateHistoryDiskSize:function(){this.$(".history-size").text(this.model.get("nice_size"))},renderItems:function(e){var t=D.prototype.renderItems.call(this,e);return this.searchFor?this._renderSearchFindings(e):this._renderCounts(e),t},_renderCounts:function(t){t=t instanceof e?t:this.$el;var i=this.templates.counts(this.model.toJSON(),this);return t.find("> .controls .subtitle").html(i)},_renderTags:function(e){var t=this;this.tagsEditor=new g.default.TagsEditor({model:this.model,el:e.find(".controls .tags-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.toggleHDATagEditors(!0,t.fxSpeed)},onhide:function(){t.toggleHDATagEditors(!1,t.fxSpeed)},$activator:(0,T.default)({title:(0,A.default)("Edit history tags"),classes:"history-tag-btn",faIcon:"fa-tags"}).appendTo(e.find(".controls .actions"))})},_renderAnnotation:function(e){var t=this;this.annotationEditor=new w.default.AnnotationEditor({model:this.model,el:e.find(".controls .annotation-display"),onshowFirstTime:function(){this.render()},onshow:function(){t.toggleHDAAnnotationEditors(!0,t.fxSpeed)},onhide:function(){t.toggleHDAAnnotationEditors(!1,t.fxSpeed)},$activator:(0,T.default)({title:(0,A.default)("Edit history annotation"),classes:"history-annotate-btn",faIcon:"fa-comment"}).appendTo(e.find(".controls .actions"))})},_setUpBehaviors:function(e){if(e=e||this.$el,D.prototype._setUpBehaviors.call(this,e),this.model&&Galaxy.user&&!Galaxy.user.isAnonymous()&&Galaxy.user.id===this.model.get("user_id")){var t=this;e.find("> .controls .name").attr("title",(0,A.default)("Click to rename history")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(e){var i=t.model.get("name");e&&e!==i?(t.$el.find("> .controls .name").text(e),t.model.save({name:e}).fail(function(){t.$el.find("> .controls .name").text(t.model.previous("name"))})):t.$el.find("> .controls .name").text(i)}})}},multiselectActions:function(){var e=this,t=[{html:(0,A.default)("Hide datasets"),func:function(){var t=u.default.HistoryDatasetAssociation.prototype.hide;e.getSelectedModels().ajaxQueue(t)}},{html:(0,A.default)("Unhide datasets"),func:function(){var t=u.default.HistoryDatasetAssociation.prototype.unhide;e.getSelectedModels().ajaxQueue(t)}},{html:(0,A.default)("Delete datasets"),func:function(){var t=u.default.HistoryDatasetAssociation.prototype.delete;e.getSelectedModels().ajaxQueue(t)}},{html:(0,A.default)("Undelete datasets"),func:function(){var t=u.default.HistoryDatasetAssociation.prototype.undelete;e.getSelectedModels().ajaxQueue(t)}}];return e.purgeAllowed&&t.push({html:(0,A.default)("Permanently delete datasets"),func:function(){if(confirm((0,A.default)("This will permanently remove the data in your datasets. Are you sure?"))){var t=u.default.HistoryDatasetAssociation.prototype.purge;e.getSelectedModels().ajaxQueue(t)}}}),t=t.concat(e._collectionActions())},_collectionActions:function(){var e=this;return[{html:(0,A.default)("Build Dataset List"),func:function(){e.buildCollection("list")}},{html:(0,A.default)("Build Dataset Pair"),func:function(){e.buildCollection("paired")}},{html:(0,A.default)("Build List of Dataset Pairs"),func:function(){e.buildCollection("list:paired")}}]},buildCollection:function(e,t,i){var n,a=this,t=t||a.getSelectedModels(),i=i||!1;"list"==e?n=y.default.createListCollection:"paired"==e?n=k.default.createPairCollection:"list:paired"==e?n=$.default.createListOfPairsCollection:console.warn("Unknown collectionType encountered "+e),n(t,i).done(function(){a.model.refresh()})},_getItemViewOptions:function(e){var t=D.prototype._getItemViewOptions.call(this,e);return n.extend(t,{purgeAllowed:this.purgeAllowed,tagsEditorShown:this.tagsEditor&&!this.tagsEditor.hidden,annotationEditorShown:this.annotationEditor&&!this.annotationEditor.hidden}),t},_handleItemDeletedChange:function(e){e.get("deleted")?this._handleItemDeletion(e):this._handleItemUndeletion(e),this._renderCounts()},_handleItemDeletion:function(e){var t=this.model.get("contents_active");t.deleted+=1,t.active-=1,this.model.contents.includeDeleted||this.removeItemView(e),this.model.set("contents_active",t)},_handleItemUndeletion:function(e){var t=this.model.get("contents_active");t.deleted-=1,this.model.contents.includeDeleted||(t.active-=1),this.model.set("contents_active",t)},_handleItemVisibleChange:function(e){e.hidden()?this._handleItemHidden(e):this._handleItemUnhidden(e),this._renderCounts()},_handleItemHidden:function(e){var t=this.model.get("contents_active");t.hidden+=1,t.active-=1,this.model.contents.includeHidden||this.removeItemView(e),this.model.set("contents_active",t)},_handleItemUnhidden:function(e){var t=this.model.get("contents_active");t.hidden-=1,this.model.contents.includeHidden||(t.active-=1),this.model.set("contents_active",t)},toggleHDATagEditors:function(e,t){n.each(this.views,function(i){i.tagsEditor&&i.tagsEditor.toggle(e,t)})},toggleHDAAnnotationEditors:function(e,t){n.each(this.views,function(i){i.annotationEditor&&i.annotationEditor.toggle(e,t)})},events:n.extend(n.clone(D.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click .toggle-deleted-link":function(e){this.toggleShowDeleted()},"click .toggle-hidden-link":function(e){this.toggleShowHidden()}}),_renderSearchProgress:function(e,t){var i=e+t;return this.$("> .controls .subtitle").html(["<i>",(0,A.default)("Searching "),i,"/",this.model.contentsShown(),"</i>"].join(""))},_renderSearchFindings:function(t){t=t instanceof e?t:this.$el;var i=this.templates.found(this.model.toJSON(),this);return t.find("> .controls .subtitle").html(i),this},dropTargetOn:function(){if(this.dropTarget)return this;this.dropTarget=!0;var e={dragenter:n.bind(this.dragenter,this),dragover:n.bind(this.dragover,this),dragleave:n.bind(this.dragleave,this),drop:n.bind(this.drop,this)},t=this._renderDropTarget();this.$list().before([this._renderDropTargetHelp(),t]);for(var i in e)e.hasOwnProperty(i)&&t.on(i,e[i]);return this},_renderDropTarget:function(){return this.$(".history-drop-target").remove(),a("<div/>").addClass("history-drop-target")},_renderDropTargetHelp:function(){return this.$(".history-drop-target-help").remove(),a("<div/>").addClass("history-drop-target-help").text((0,A.default)("Drag datasets here to copy them to the current history"))},dropTargetOff:function(){if(!this.dropTarget)return this;this.dropTarget=!1;var e=this.$(".history-drop-target").get(0);for(var t in this._dropHandlers)this._dropHandlers.hasOwnProperty(t)&&e.off(t,this._dropHandlers[t]);return this.$(".history-drop-target").remove(),this.$(".history-drop-target-help").remove(),this},dropTargetToggle:function(){return this.dropTarget?this.dropTargetOff():this.dropTargetOn(),this},dragenter:function(e){e.preventDefault(),e.stopPropagation(),this.$(".history-drop-target").css("border","2px solid black")},dragover:function(e){e.preventDefault(),e.stopPropagation()},dragleave:function(e){e.preventDefault(),e.stopPropagation(),this.$(".history-drop-target").css("border","1px dashed black")},drop:function(e){e.preventDefault();var t=this,i=e.originalEvent.dataTransfer,n=i.getData("text");i.dropEffect="move";try{n=JSON.parse(n)}catch(e){t.warn("error parsing JSON from drop:",n)}return t.trigger("droptarget:drop",e,n,t),!1},dataDropped:function(t){var i=this;return n.isObject(t)&&"HistoryDatasetAssociation"===t.model_class&&t.id?0!==i.contents.currentPage?i.contents.fetchPage(0).then(function(){return i.model.contents.copy(t.id)}):i.model.contents.copy(t.id):e.when()},toString:function(){return"HistoryViewEdit("+(this.model?this.model.get("name"):"")+")"}});I.prototype.templates=function(){var e=P.default.wrapTemplate(["<% var shown = Math.max( view.views.length, history.contents_active.active ) %>","<% if( shown ){ %>",'<span class="shown-count">',"<%- shown %> ",(0,A.default)("shown"),"</span>","<% } %>","<% if( history.contents_active.deleted ){ %>",'<span class="deleted-count">',"<% if( view.model.contents.includeDeleted ){ %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,A.default)("hide deleted"),"</a>","<% } else { %>","<%- history.contents_active.deleted %> ",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,A.default)("deleted"),"</a>","<% } %>","</span>","<% } %>","<% if( history.contents_active.hidden ){ %>",'<span class="hidden-count">',"<% if( view.model.contents.includeHidden ){ %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,A.default)("hide hidden"),"</a>","<% } else { %>","<%- history.contents_active.hidden %> ",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,A.default)("hidden"),"</a>","<% } %>","</span>","<% } %>"],"history"),t=P.default.wrapTemplate([(0,A.default)("Found")," <%- view.views.length %>, ","<% if( history.contents_active.deleted ){ %>","<% if( view.model.contents.includeDeleted ){ %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,A.default)("hide deleted"),"</a>, ","<% } else { %>",'<a class="toggle-deleted-link" href="javascript:void(0);">',(0,A.default)("show deleted"),"</a>, ","<% } %>","<% } %>","<% if( history.contents_active.hidden ){ %>","<% if( view.model.contents.includeHidden ){ %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,A.default)("hide hidden"),"</a>","<% } else { %>",'<a class="toggle-hidden-link" href="javascript:void(0);">',(0,A.default)("show hidden"),"</a>","<% } %>","<% } %>"],"history");return n.extend(n.clone(D.prototype.templates),{counts:e,found:t})}(),t.default={HistoryViewEdit:I}}).call(t,i(0),i(2),i(0))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(216),o=a(s),r=i(191),l=a(r),d=i(192),c=a(d),u=i(193),h=(a(u),i(218)),f=a(h),p=i(220),m=a(p),_=i(158),g=(a(_),i(212)),v=a(g),w=i(175),b=a(w),y=i(8),x=a(y),k=i(7),C=a(k);i(217);var $=o.default.ModelListPanel,S=$.extend({_logNamespace:"history",HDAViewClass:f.default.HDAListItemView,HDCAViewClass:m.default.HDCAListItemView,collectionClass:c.default.HistoryContents,modelCollectionKey:"contents",tagName:"div",className:$.prototype.className+" history-panel",emptyMsg:(0,C.default)("This history is empty"),noneFoundMsg:(0,C.default)("No matching datasets found"),searchPlaceholder:(0,C.default)("search datasets"),initialize:function(e){$.prototype.initialize.call(this,e),this.linkTarget=e.linkTarget||"_blank"},_createDefaultCollection:function(){return new this.collectionClass([],{history:this.model})},freeModel:function(){return $.prototype.freeModel.call(this),this.model&&this.model.stopPolling(),this},_setUpListeners:function(){$.prototype._setUpListeners.call(this),this.on({error:function(e,t,i,n,a){this.errorHandler(e,t,i,n,a)},"views:ready view:attached view:removed":function(e){this._renderSelectButton()},"view:attached":function(e){this.scrollTo(0)}})},loadHistory:function(t,i,n){var a=this;return n=e.extend(n||{silent:!0}),this.info("loadHistory:",t,i,n),this.setModel(new l.default.History({id:t})),n.silent=!0,this.trigger("loading"),this.model.fetchWithContents(i,n).always(function(){a.render(),a.trigger("loading-done")})},refreshContents:function(e){return this.model?this.model.refresh(e):n.when()},_setUpCollectionListeners:function(){return $.prototype._setUpCollectionListeners.call(this),this.listenTo(this.collection,{"fetching-more":function(){this._toggleContentsLoadingIndicator(!0),this.$emptyMessage().hide()},"fetching-more-done":function(){this._toggleContentsLoadingIndicator(!1)}})},_showLoadingIndicator:function(t,i,a){var s=n('<div class="loading-indicator"/>');this.$el.html(s.text(t).slideDown(e.isUndefined(i)?this.fxSpeed:i))},_hideLoadingIndicator:function(t){this.$(".loading-indicator").slideUp(e.isUndefined(t)?this.fxSpeed+200:t,function(){n(this).remove()})},_buildNewRender:function(){var e=$.prototype._buildNewRender.call(this);return this._renderSelectButton(e),e},_renderSelectButton:function(e){if(e=e||this.$el,!this.multiselectActions().length)return null;if(!this.views.length)return this.hideSelectors(),e.find(".controls .actions .show-selectors-btn").remove(),null;var t=e.find(".controls .actions .show-selectors-btn");return t.length?t:(0,b.default)({title:(0,C.default)("Operations on multiple datasets"),classes:"show-selectors-btn",faIcon:"fa-check-square-o"}).prependTo(e.find(".controls .actions"))},_renderEmptyMessage:function(e){var t=this.$emptyMessage(e);return this.model.get("contents_active").active<=0?t.empty().append(this.emptyMsg).show():this.searchFor&&this.model.contents.haveSearchDetails()&&!this.views.length?t.empty().append(this.noneFoundMsg).show():(t.hide(),n())},$scrollContainer:function(e){return this.$list(e)},_toggleContentsLoadingIndicator:function(e){e?this.$list().html('<div class="contents-loading-indicator"><span class="fa fa-2x fa-spinner fa-spin"/></div>'):this.$list().find(".contents-loading-indicator").remove()},renderItems:function(e){e=e||this.$el;var t=this.$list(e);n(".tooltip").remove(),t.empty(),this.views=[];var i=this._filterCollection();return i.length?(this._renderPagination(e),this.views=this._renderSomeItems(i,t)):e.find("> .controls .list-pagination").empty(),this._renderEmptyMessage(e).toggle(!i.length),this.trigger("views:ready",this.views),this.views},_renderPagination:function(e){var t=e.find("> .controls .list-pagination");return this.searchFor||!this.model.contents.shouldPaginate()?t.empty():(t.html(this.templates.pagination({current:this.model.contents.currentPage+1,last:this.model.contents.getLastPage()+1},this)),t.find("select.pages").tooltip(),t)},_renderSomeItems:function(e,t){var i=this,n=[];return t.append(e.map(function(e){var t=i._createItemView(e);return n.push(t),i._renderItemView$el(t)})),n},_filterItem:function(e){var t=this.model.contents;return(t.includeHidden||!e.hidden())&&(t.includeDeleted||!e.isDeletedOrPurged())&&$.prototype._filterItem.call(this,e)},_getItemViewClass:function(e){var t=e.get("history_content_type");switch(t){case"dataset":return this.HDAViewClass;case"dataset_collection":return this.HDCAViewClass}throw new TypeError("Unknown history_content_type: "+t)},_getItemViewOptions:function(t){var i=$.prototype._getItemViewOptions.call(this,t);return e.extend(i,{linkTarget:this.linkTarget,expanded:this.model.contents.storage.isExpanded(t.id),hasUser:this.model.ownedByCurrUser()})},_setUpItemViewListeners:function(e){var t=this;return $.prototype._setUpItemViewListeners.call(t,e),t.listenTo(e,{expanded:function(e){t.model.contents.storage.addExpanded(e.model)},collapsed:function(e){t.model.contents.storage.removeExpanded(e.model)}})},collapseAll:function(){this.model.contents.storage.clearExpanded(),$.prototype.collapseAll.call(this)},getSelectedModels:function(){var e=$.prototype.getSelectedModels.call(this);return e.historyId=this.collection.historyId,e},events:e.extend(e.clone($.prototype.events),{"click .show-selectors-btn":"toggleSelectors","click > .controls .prev":"_clickPrevPage","click > .controls .next":"_clickNextPage","change > .controls .pages":"_changePageSelect","click .messages [class$=message]":"clearMessages"}),_clickPrevPage:function(e){this.model.stopPolling(),this.model.contents.fetchPrevPage()},_clickNextPage:function(e){this.model.stopPolling(),this.model.contents.fetchNextPage()},_changePageSelect:function(e){this.model.stopPolling();var t=n(e.currentTarget).val();this.model.contents.fetchPage(t)},toggleShowDeleted:function(e,t){e=void 0!==e?e:!this.model.contents.includeDeleted;var i=this.model.contents;return i.setIncludeDeleted(e,t),this.trigger("show-deleted",e),i.fetchCurrentPage({renderAll:!0}),e},toggleShowHidden:function(e,t,i){e=void 0!==e?e:!this.model.contents.includeHidden;var n=this.model.contents;return n.setIncludeHidden(e,i),this.trigger("show-hidden",e),n.fetchCurrentPage({renderAll:!0}),e},_firstSearch:function(e){var t=this;if(this.log("onFirstSearch",e),this.model.contents.haveSearchDetails())return void this.searchItems(e);this.$("> .controls .search-input").searchInput("toggle-loading"),this.searchFor=e;this.model.contents.progressivelyFetchDetails({silent:!0}).progress(function(e,i,n){t.renderItems(),t.trigger("search:loading-progress",i,n)}).always(function(){t.$el.find("> .controls .search-input").searchInput("toggle-loading")}).done(function(){t.searchItems(e,"force")})},clearSearch:function(e){var t=this;return this.searchFor?(this.searchFor="",this.trigger("search:clear",this),this.$("> .controls .search-query").val(""),this.model.contents.fetchCurrentPage({silent:!0}).done(function(){t.renderItems()}),this):this},errorHandler:function(t,i,n){if(!i||0!==i.status||0!==i.readyState){if(this.error(t,i,n),e.isString(t)&&e.isString(i)){var a=t,s=i;return v.default.errorModal(a,s,n)}return i&&502===i.status?v.default.badGatewayErrorModal():v.default.ajaxErrorModal(t,i,n)}},clearMessages:function(t){return(e.isUndefined(t)?this.$messages().children('[class$="message"]'):n(t.currentTarget)).fadeOut(this.fxSpeed,function(){n(this).remove()}),this},scrollToHid:function(t){return this.scrollToItem(e.first(this.viewsWhereModel({hid:t})))},ordinalIndicator:function(e){var t=""+e;switch(t.charAt(t.length-1)){case"1":return t+"st";case"2":return t+"nd";case"3":return t+"rd";default:return t+"th"}},toString:function(){return"HistoryView("+(this.model?this.model.get("name"):"")+")"}});S.prototype.templates=function(){var t=function(){return'<div>\n            <div class="controls"></div>\n            <ul class="list-items"></ul>\n            <div class="empty-message infomessagesmall"></div>\',\n        </div>'},i=x.default.wrapTemplate(['<div class="controls">','<div class="title">','<div class="name"><%- history.name %></div>',"</div>",'<div class="subtitle"></div>','<div class="history-size"><%- history.nice_size %></div>','<div class="actions"></div>','<div class="messages">',"<% if( history.deleted && history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,C.default)("This history has been purged and deleted"),"</div>","<% } else if( history.deleted ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,C.default)("This history has been deleted"),"</div>","<% } else if( history.purged ){ %>",'<div class="deleted-msg warningmessagesmall">',(0,C.default)("This history has been purged"),"</div>","<% } %>","<% if( history.message ){ %>",'<div class="<%= history.message.level || "info" %>messagesmall">',"<%= history.message.text %>","</div>","<% } %>","</div>",'<div class="tags-display"></div>','<div class="annotation-display"></div>','<div class="search">','<div class="search-input"></div>',"</div>",'<div class="list-actions">','<div class="btn-group">','<button class="select-all btn btn-default"','data-mode="select">',(0,C.default)("All"),"</button>",'<button class="deselect-all btn btn-default"','data-mode="select">',(0,C.default)("None"),"</button>","</div>",'<div class="list-action-menu btn-group">',"</div>","</div>",'<div class="list-pagination form-inline"></div>',"</div>"],"history"),n=x.default.wrapTemplate(['<button class="prev" <%- pages.current === 1 ? "disabled" : "" %>>previous</button>','<select class="pages form-control" ','title="',(0,C.default)("Click to open and select a page. Begin typing a page number to select it"),'">',"<% _.range( 1, pages.last + 1 ).forEach( function( i ){ %>",'<option value="<%- i - 1 %>" <%- i === pages.current ? "selected" : "" %>>',"<%- view.ordinalIndicator( i ) %> of <%- pages.last %> pages","</option>","<% }); %>","</select>",'<button class="next" <%- pages.current === pages.last ? "disabled" : "" %>>next</button>'],"pages");return e.extend(e.clone($.prototype.templates),{el:t,controls:i,pagination:n})}(),t.default={HistoryView:S}}).call(t,i(2),i(0))},function(e,t,i){"use strict";function n(e,t){function i(){var i=['<div class="loading-indicator">','<div class="loading-indicator-text">','<span class="fa fa-spinner fa-spin fa-lg"></span>','<span class="loading-indicator-message">loading...</span>',"</div>","</div>"].join("\n"),n=o(i).hide().css(t.css||{position:"fixed"}),a=n.children(".loading-indicator-text");return t.cover?(n.css({"z-index":2,top:e.css("top"),bottom:e.css("bottom"),left:e.css("left"),right:e.css("right"),opacity:.5,"background-color":"white","text-align":"center"}),a=n.children(".loading-indicator-text").css({"margin-top":"20px"})):(a=n.children(".loading-indicator-text").css({margin:"12px 0px 0px 10px",opacity:"0.85",color:"grey"}),a.children(".loading-indicator-message").css({margin:"0px 8px 0px 0px","font-style":"italic"})),n}var n=this;return t=s.default.extend({cover:!1},t||{}),n.show=function(t,a,s){return t=t||"loading...",a=a||"fast",e.parent().find(".loading-indicator").remove(),n.$indicator=i().insertBefore(e),n.message(t),n.$indicator.fadeIn(a,s),n},n.message=function(e){n.$indicator.find("i").text(e)},n.hide=function(e,t){return e=e||"fast",n.$indicator&&n.$indicator.length?n.$indicator.fadeOut(e,function(){n.$indicator.remove(),t&&t()}):t&&t(),n},n}Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),s=function(e){return e&&e.__esModule?e:{default:e}}(a),o=s.default;t.default=n},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(222),o=a(s),r=i(218),l=a(r),d=i(8),c=a(d),u=i(7),h=a(u),f=o.default.DatasetListItemEdit,p=f.extend({className:f.prototype.className+" history-content",_fetchModelDetails:function(){var t=this;return t.model.inReadyState()&&!t.model.hasDetails()?t.model.fetch({silent:!0}):t.model.has("rerunnable")?e.when():t.model.fetch({silent:!0,data:{keys:["rerunnable","creating_job"].join(",")}})},events:n.extend(n.clone(f.prototype.events),{"click .unhide-link":function(e){return this.model.unhide(),!1}}),toString:function(){return"HDAListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});p.prototype.templates=function(){var e=n.extend({},f.prototype.templates.warnings,{hidden:c.default.wrapTemplate(["<% if( !dataset.visible ){ %>",'<div class="hidden-msg warningmessagesmall">',(0,h.default)("This dataset has been hidden"),'<br /><a class="unhide-link" a href="javascript:void(0);">',(0,h.default)("Unhide it"),"</a>","</div>","<% } %>"],"dataset")});return n.extend({},f.prototype.templates,{titleBar:l.default.HDAListItemView.prototype.templates.titleBar,warnings:e})}(),t.default={HDAListItemEdit:p}}).call(t,i(0),i(2))},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(220),s=n(a),o=i(259),r=n(o),l=i(175),d=n(l),c=i(7),u=n(c),h=s.default.HDCAListItemView,f=h.extend({_getFoldoutPanelClass:function(){var e=this.model.get("collection_type");switch(e){case"list":return r.default.ListCollectionViewEdit;case"paired":return r.default.PairCollectionViewEdit;case"list:paired":return r.default.ListOfPairsCollectionViewEdit;case"list:list":return r.default.ListOfListsCollectionViewEdit}throw new TypeError("Unknown collection_type: "+e)},_renderPrimaryActions:function(){return this.log(this+"._renderPrimaryActions"),h.prototype._renderPrimaryActions.call(this).concat([this._renderDeleteButton()])},_renderDeleteButton:function(){var e=this,t=this.model.get("deleted");return(0,d.default)({title:t?(0,u.default)("Dataset collection is already deleted"):(0,u.default)("Delete"),classes:"delete-btn",faIcon:"fa-times",disabled:t,onclick:function(){e.$el.find(".icon-btn.delete-btn").trigger("mouseout"),e.model.delete()}})},toString:function(){return"HDCAListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});t.default={HDCAListItemEdit:f}},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(221),s=n(a),o=i(189),r=(n(o),i(260)),l=n(r),d=i(8),c=(n(d),i(181)),u=n(c),h=i(175),f=(n(h),i(7)),p=n(f);i(25);var m=s.default.CollectionView,_=m.extend({DatasetDCEViewClass:l.default.DatasetDCEListItemEdit,NestedDCDCEViewClass:l.default.NestedDCDCEListItemEdit,initialize:function(e){m.prototype.initialize.call(this,e)},_setUpBehaviors:function(e){if(e=e||this.$el,m.prototype._setUpBehaviors.call(this,e),this.model&&Galaxy.user&&!Galaxy.user.isAnonymous()){this.tagsEditorShown=!0;var t=this;e.find("> .controls .name").attr("title",(0,p.default)("Click to rename collection")).tooltip({placement:"bottom"}).make_text_editable({on_finish:function(e){var i=t.model.get("name");e&&e!==i?(t.$el.find("> .controls .name").text(e),t.model.save({name:e}).fail(function(){t.$el.find("> .controls .name").text(t.model.previous("name"))})):t.$el.find("> .controls .name").text(i)}}),this.tagsEditor=new u.default.TagsEditor({model:this.model,el:e.find(".tags-display"),onshowFirstTime:function(){this.render()},usePrompt:!1}),this.tagsEditor.toggle(!0)}},toString:function(){return"CollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}}),g=_.extend({DatasetDCEViewClass:l.default.DatasetDCEListItemEdit,toString:function(){return"ListCollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}}),v=g.extend({toString:function(){return"PairCollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}}),w=v.extend({_setUpBehaviors:function(e){m.prototype._setUpBehaviors.call(this,e)},toString:function(){return"NestedPairCollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}}),b=_.extend({NestedDCDCEViewClass:l.default.NestedDCDCEListItemEdit.extend({foldoutPanelClass:w}),toString:function(){return"ListOfPairsCollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}}),y=_.extend({NestedDCDCEViewClass:l.default.NestedDCDCEListItemEdit.extend({foldoutPanelClass:w}),toString:function(){return"ListOfListsCollectionViewEdit("+(this.model?this.model.get("name"):"")+")"}});t.default={CollectionViewEdit:_,ListCollectionViewEdit:g,PairCollectionViewEdit:v,ListOfPairsCollectionViewEdit:b,ListOfListsCollectionViewEdit:y}},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(196),o=a(s),r=i(222),l=a(r),d=i(8),c=(a(d),i(7)),u=(a(c),o.default.DCListItemView),h=u.extend({initialize:function(e){u.prototype.initialize.call(this,e)},toString:function(){return"DCListItemEdit("+(this.model?""+this.model:"(no model)")+")"}}),f=o.default.DCEListItemView,p=f.extend({initialize:function(e){f.prototype.initialize.call(this,e)},toString:function(){return"DCEListItemEdit("+(this.model?""+this.model:"(no model)")+")"}}),m=l.default.DatasetListItemEdit.extend({initialize:function(e){l.default.DatasetListItemEdit.prototype.initialize.call(this,e)},_fetchModelDetails:function(){var t=this;return t.model.inReadyState()&&!t.model.hasDetails()?t.model.fetch({silent:!0}):e.when()},_renderDeleteButton:function(){return null},toString:function(){return"DatasetDCEListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});m.prototype.templates=function(){return n.extend({},l.default.DatasetListItemEdit.prototype.templates,{titleBar:o.default.DatasetDCEListItemView.prototype.templates.titleBar})}();var _=o.default.NestedDCDCEListItemView.extend({toString:function(){return"NestedDCDCEListItemEdit("+(this.model?""+this.model:"(no model)")+")"}});t.default={DCListItemEdit:h,DCEListItemEdit:p,DatasetDCEListItemEdit:m,NestedDCDCEListItemEdit:_}}).call(t,i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var i=e.toJSON();return v(i,{defaultHideSourceItems:t,creationFn:function(t,i,n){return t=[{name:"forward",src:"hda",id:t[0].id},{name:"reverse",src:"hda",id:t[1].id}],e.createHDCA(t,"paired",i,n)}})}Object.defineProperty(t,"__esModule",{value:!0});var r=i(187),l=s(r),d=i(188),c=s(d),u=i(8),h=s(u),f=i(7),p=s(f),m=e.View.extend(h.default.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"collection-element",initialize:function(e){this.element=e.element||{},this.identifier=e.identifier},render:function(){return this.$el.attr("data-element-id",this.element.id).html(this.template({identifier:this.identifier,element:this.element})),this},template:n.template(['<span class="identifier"><%- identifier %></span>','<span class="name"><%- element.name %></span>'].join("")),destroy:function(){this.off(),this.$el.remove()},toString:function(){return"DatasetCollectionElementView()"}}),_=l.default.ListCollectionCreator,g=_.extend({elementViewClass:m,collectionClass:c.default.HistoryPairDatasetCollection,className:"pair-collection-creator collection-creator flex-row-container",_mangleDuplicateNames:function(){},render:function(e,t){return 2===this.workingElements.length?_.prototype.render.call(this,e,t):this._renderInvalid(e,t)},_renderList:function(e,t){var i=this,s=a("<div/>"),o=i.$list();n.each(this.elementViews,function(e){e.destroy(),i.removeElementView(e)}),s.append(i._createForwardElementView().$el),s.append(i._createReverseElementView().$el),o.empty().append(s.children()),n.invoke(i.elementViews,"render")},_createForwardElementView:function(){return this._createElementView(this.workingElements[0],{identifier:"forward"})},_createReverseElementView:function(){return this._createElementView(this.workingElements[1],{identifier:"reverse"})},_createElementView:function(e,t){var i=new this.elementViewClass(n.extend(t,{element:e}));return this.elementViews.push(i),i},swap:function(){this.workingElements=[this.workingElements[1],this.workingElements[0]],this._renderList()},events:n.extend(n.clone(_.prototype.events),{"click .swap":"swap"}),templates:n.extend(n.clone(_.prototype.templates),{middle:n.template(['<div class="collection-elements-controls">','<a class="swap" href="javascript:void(0);" title="',(0,p.default)("Swap forward and reverse datasets"),'">',(0,p.default)("Swap"),"</a>","</div>",'<div class="collection-elements scroll-container flex-row">',"</div>"].join("")),helpContent:n.template(["<p>",(0,p.default)(["Pair collections are permanent collections containing two datasets: one forward and one reverse. ","Often these are forward and reverse reads. The pair collections can be passed to tools and ","workflows in order to have analyses done on both datasets. This interface allows ","you to create a pair, name it, and swap which is forward and which reverse."].join("")),"</p>","<ul>","<li>",(0,p.default)(['Click the <i data-target=".swap">"Swap"</i> link to make your forward dataset the reverse ',"and the reverse dataset forward."].join("")),"</li>","<li>",(0,p.default)(['Click the <i data-target=".cancel-create">"Cancel"</i> button to exit the interface.'].join("")),"</li>","</ul><br />","<p>",(0,p.default)(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>.'].join("")),"</p>"].join("")),invalidInitial:n.template(['<div class="header flex-row no-flex">','<div class="alert alert-warning" style="display: block">','<span class="alert-message">',"<% if( _.size( problems ) ){ %>",(0,p.default)("The following selections could not be included due to problems"),"<ul><% _.each( problems, function( problem ){ %>","<li><b><%- problem.element.name %></b>: <%- problem.text %></li>","<% }); %></ul>","<% } else if( _.size( elements ) === 0 ){ %>",(0,p.default)("No datasets were selected"),".","<% } else if( _.size( elements ) === 1 ){ %>",(0,p.default)("Only one dataset was selected"),": <%- elements[0].name %>","<% } else if( _.size( elements ) > 2 ){ %>",(0,p.default)("Too many datasets were selected"),': <%- _.pluck( elements, "name" ).join( ", ") %>',"<% } %>","<br />",(0,p.default)("Two (and only two) elements are needed for the pair"),". ",(0,p.default)("You may need to "),'<a class="cancel-create" href="javascript:void(0)">',(0,p.default)("cancel"),"</a> ",(0,p.default)("and reselect new elements"),".","</span>","</div>","</div>",'<div class="footer flex-row no-flex">','<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',(0,p.default)("Cancel"),"</button>","</div>","</div>","</div>"].join(""))}),toString:function(){return"PairCollectionCreator"}}),v=function(e,t){return t=t||{},t.title=(0,p.default)("Create a collection from a pair of datasets"),l.default.collectionCreatorModal(e,t,g)};t.default={PairCollectionCreator:g,pairCollectionCreatorModal:v,createPairCollection:o}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e,n,a,s){function o(e){return e&&e.__esModule?e:{default:e}}function r(e){function t(){return i.length||(i=[new RegExp(this.filters[0]),new RegExp(this.filters[1])]),i}e=e||{},e.createPair=e.createPair||function(e){e=e||{};var t=e.listA.splice(e.indexA,1)[0],i=e.listB.splice(e.indexB,1)[0],n=e.listB.indexOf(t),a=e.listA.indexOf(i);return-1!==n&&e.listB.splice(n,1),-1!==a&&e.listA.splice(a,1),this._pair(t,i,{silent:!0})};var i=[];return e.preprocessMatch=e.preprocessMatch||function(e){var i=t.call(this);return n.extend(e,{matchTo:e.matchTo.name.replace(i[0],""),possible:e.possible.name.replace(i[1],"")})},function(t){this.debug("autopair _strategy ---------------------------"),t=t||{};var i,n=t.listA,a=t.listB,s=0,o={score:0,index:null},r=[];for(this.debug("starting list lens:",n.length,a.length),this.debug("bestMatch (starting):",JSON.stringify(o,null,"  "));s<n.length;){var l=n[s];for(o.score=0,i=0;i<a.length;i++){var d=a[i];if(this.debug(s+":"+l.name),this.debug(i+":"+d.name),n[s]!==a[i]&&(o=e.match.call(this,e.preprocessMatch.call(this,{matchTo:l,possible:d,index:i,bestMatch:o})),this.debug("bestMatch:",JSON.stringify(o,null,"  ")),1===o.score)){this.debug("breaking early due to perfect match");break}}var c=e.scoreThreshold.call(this);if(this.debug("scoreThreshold:",c),this.debug("bestMatch.score:",o.score),o.score>=c?r.push(e.createPair.call(this,{listA:n,indexA:s,listB:a,indexB:o.index})):s+=1,!n.length||!a.length)return r}return this.debug("paired:",JSON.stringify(r,null,"  ")),this.debug("autopair _strategy ---------------------------"),r}}function l(e,t){var i=e.toJSON();return y(i,{historyId:e.historyId,defaultHideSourceItems:t})}Object.defineProperty(t,"__esModule",{value:!0});var d=i(263),c=o(d),u=i(208),h=o(u),f=i(207),p=o(f),m=i(8),_=o(m),g=i(7),v=o(g);i(209);var w=e.View.extend(_.default.LoggableMixin).extend({_logNamespace:"collections",tagName:"li",className:"dataset paired",initialize:function(e){this.pair=e.pair||{}},template:n.template(['<span class="forward-dataset-name flex-column"><%- pair.forward.name %></span>','<span class="pair-name-column flex-column">','<span class="pair-name"><%- pair.name %></span>',"</span>",'<span class="reverse-dataset-name flex-column"><%- pair.reverse.name %></span>'].join("")),render:function(){this.dragStartHandler=n.bind(this._dragstart,this),this.dragEndHandler=n.bind(this._dragend,this);var e=this.$el.attr("draggable",!0).data("pair",this.pair).html(this.template({pair:this.pair})).addClass("flex-column-container").get(0);return e.addEventListener("dragstart",this.dragStartHandler,!1),e.addEventListener("dragend",this.dragEndHandler,!1),this},events:{dragover:"_sendToParent",drop:"_sendToParent"},_dragstart:function(e){e.currentTarget.style.opacity="0.4",e.originalEvent&&(e=e.originalEvent),e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",JSON.stringify(this.pair)),this.$el.parent().trigger("pair.dragstart",[this])},_dragend:function(e){e.currentTarget.style.opacity="1.0",this.$el.parent().trigger("pair.dragend",[this])},_sendToParent:function(e){this.$el.parent().trigger(e)},toString:function(){return"PairView("+this.pair.name+")"}}),b=e.View.extend(_.default.LoggableMixin).extend(p.default.CollectionCreatorMixin).extend({_logNamespace:"collections",className:"list-of-pairs-collection-creator collection-creator flex-row-container",initialize:function(e){this.metric("PairedCollectionCreator.initialize",e),e=n.defaults(e,{datasets:[],filters:this.DEFAULT_FILTERS,automaticallyPair:!0,strategy:"lcs",matchPercentage:.9,twoPassAutopairing:!0}),this.initialList=e.datasets,this.historyId=e.historyId,this.filters=this.commonFilters[e.filters]||this.commonFilters[this.DEFAULT_FILTERS],n.isArray(e.filters)&&(this.filters=e.filters),this.automaticallyPair=e.automaticallyPair,this.strategy=this.strategies[e.strategy]||this.strategies[this.DEFAULT_STRATEGY],n.isFunction(e.strategy)&&(this.strategy=e.strategy),this.matchPercentage=e.matchPercentage,this.twoPassAutopairing=e.twoPassAutopairing,this.removeExtensions=!0,this.oncancel=e.oncancel,this.oncreate=e.oncreate,this.autoscrollDist=e.autoscrollDist||24,this.unpairedPanelHidden=!1,this.pairedPanelHidden=!1,this.$dragging=null,this.blocking=!1,this._setUpCommonSettings(e),this._setUpBehaviors(),this._dataSetUp()},commonFilters:{illumina:["_1","_2"],Rs:["_R1","_R2"]},DEFAULT_FILTERS:"illumina",strategies:{simple:"autopairSimple",lcs:"autopairLCS",levenshtein:"autopairLevenshtein"},DEFAULT_STRATEGY:"lcs",_dataSetUp:function(){this.paired=[],this.unpaired=[],this.selectedIds=[],this._sortInitialList(),this._ensureIds(),this.unpaired=this.initialList.slice(0),this.automaticallyPair&&(this.autoPair(),this.once("rendered:initial",function(){this.trigger("autopair")}))},_sortInitialList:function(){this._sortDatasetList(this.initialList)},_sortDatasetList:function(e){return e.sort(function(e,t){return(0,h.default)(e.name,t.name)}),e},_ensureIds:function(){return this.initialList.forEach(function(e){e.hasOwnProperty("id")||(e.id=n.uniqueId())}),this.initialList},_splitByFilters:function(){function e(e,t){return t.test(e.name)}var t=this.filters.map(function(e){return new RegExp(e)}),i=[[],[]];return this.unpaired.forEach(function(n){t.forEach(function(t,a){e(n,t)&&i[a].push(n)})}),i},_addToUnpaired:function(e){var t=this;this.unpaired.splice(function i(n,a){if(n===a)return n;var s=Math.floor((a-n)/2)+n,o=(0,h.default)(e.name,t.unpaired[s].name);if(o<0)return i(n,s);if(o>0)return i(s+1,a);for(;t.unpaired[s]&&t.unpaired[s].name===e.name;)s++;return s}(0,this.unpaired.length),0,e)},autoPair:function(e){var t=this._splitByFilters(),i=[];return this.twoPassAutopairing&&(i=this.autopairSimple({listA:t[0],listB:t[1]}),t=this._splitByFilters()),e=e||this.strategy,t=this._splitByFilters(),i=i.concat(this[e].call(this,{listA:t[0],listB:t[1]}))},autopairSimple:r({scoreThreshold:function(){return.6},match:function(e){return e=e||{},e.matchTo===e.possible?{index:e.index,score:1}:e.bestMatch}}),autopairLevenshtein:r({scoreThreshold:function(){return this.matchPercentage},match:function(e){e=e||{};var t=(0,c.default)(e.matchTo,e.possible),i=1-t/Math.max(e.matchTo.length,e.possible.length);return i>e.bestMatch.score?{index:e.index,score:i}:e.bestMatch}}),autopairLCS:r({scoreThreshold:function(){return this.matchPercentage},match:function(e){e=e||{};var t=this._naiveStartingAndEndingLCS(e.matchTo,e.possible).length,i=t/Math.max(e.matchTo.length,e.possible.length);return i>e.bestMatch.score?{index:e.index,score:i}:e.bestMatch}}),_naiveStartingAndEndingLCS:function(e,t){for(var i="",n="",a=0,s=0;a<e.length&&a<t.length&&e[a]===t[a];)i+=e[a],a+=1;if(a===e.length)return e;if(a===t.length)return t;for(a=e.length-1,s=t.length-1;a>=0&&s>=0&&e[a]===t[s];)n=[e[a],n].join(""),a-=1,s-=1;return i+n},_pair:function(e,t,i){i=i||{},this.debug("_pair:",e,t);var a=this._createPair(e,t,i.name);return this.paired.push(a),this.unpaired=n.without(this.unpaired,e,t),i.silent||this.trigger("pair:new",a),a},_createPair:function(e,t,i){if(!e||!t||e===t)throw new Error("Bad pairing: "+[JSON.stringify(e),JSON.stringify(t)]);return i=i||this._guessNameForPair(e,t),{forward:e,name:i,reverse:t}},_guessNameForPair:function(e,t,i){i=void 0!==i?i:this.removeExtensions;var n=e.name,a=t.name,s=this._naiveStartingAndEndingLCS(n.replace(new RegExp(this.filters[0]),""),a.replace(new RegExp(this.filters[1]),""));if(i){var o=s.lastIndexOf(".");if(o>0){var r=s.slice(o,s.length);s=s.replace(r,""),n=n.replace(r,""),a=a.replace(r,"")}}return s||n+" & "+a},_unpair:function(e,t){if(t=t||{},!e)throw new Error("Bad pair: "+JSON.stringify(e));return this.paired=n.without(this.paired,e),this._addToUnpaired(e.forward),this._addToUnpaired(e.reverse),t.silent||this.trigger("pair:unpair",[e]),e},unpairAll:function(){for(var e=[];this.paired.length;)e.push(this._unpair(this.paired[0],{silent:!0}));this.trigger("pair:unpair",e)},_pairToJSON:function(e,t){return t=t||"hda",{collection_type:"paired",src:"new_collection",name:e.name,element_identifiers:[{name:"forward",id:e.forward.id,src:t},{name:"reverse",id:e.reverse.id,src:t}]}},createList:function(e){var t=this,i=Galaxy.root+"api/histories/"+this.historyId+"/contents/dataset_collections",s={type:"dataset_collection",collection_type:"list:paired",hide_source_items:t.hideOriginals||!1,name:n.escape(e||t.$(".collection-name").val()),element_identifiers:t.paired.map(function(e){return t._pairToJSON(e)})};return t.blocking=!0,a.ajax(i,{type:"POST",contentType:"application/json",dataType:"json",data:JSON.stringify(s)}).always(function(){t.blocking=!1}).fail(function(e,i,n){t._ajaxErrHandler(e,i,n)}).done(function(e,i,n){t.trigger("collection:created",e,i,n),t.metric("collection:created",e),"function"==typeof t.oncreate&&t.oncreate.call(this,e,i,n)})},_ajaxErrHandler:function(e,t,i){this.error(e,t,i);var n=this,a=(0,v.default)("An error occurred while creating this collection");e&&(0===e.readyState&&0===e.status?a+=": "+(0,v.default)("Galaxy could not be reached and may be updating.")+(0,v.default)(" Try again in a few minutes."):e.responseJSON?a+="<br /><pre>"+JSON.stringify(e.responseJSON)+"</pre>":a+=": "+i),n._showAlert(a,"alert-danger")},render:function(e,t){return this.$el.empty().html(this.templates.main()),this._renderHeader(e),this._renderMiddle(e),this._renderFooter(e),this._addPluginComponents(),this.trigger("rendered",this),this},_renderHeader:function(e,t){var i=this.$(".header").empty().html(this.templates.header()).find(".help-content").prepend(s(this.templates.helpContent()));return this._renderFilters(),i},_renderFilters:function(){return this.$(".forward-column .column-header input").val(this.filters[0]).add(this.$(".reverse-column .column-header input").val(this.filters[1]))},_renderMiddle:function(e,t){var i=this.$(".middle").empty().html(this.templates.middle());return this.unpairedPanelHidden?this.$(".unpaired-columns").hide():this.pairedPanelHidden&&this.$(".paired-columns").hide(),this._renderUnpaired(),this._renderPaired(),i},_renderUnpaired:function(e,t){var i,n,a=this,s=[],o=this._splitByFilters();return this.$(".forward-column .title").text([o[0].length,(0,v.default)("unpaired forward")].join(" ")),this.$(".forward-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-o[0].length)),this.$(".reverse-column .title").text([o[1].length,(0,v.default)("unpaired reverse")].join(" ")),this.$(".reverse-column .unpaired-info").text(this._renderUnpairedDisplayStr(this.unpaired.length-o[1].length)),this.$(".unpaired-columns .column-datasets").empty(),this.$(".autopair-link").toggle(0!==this.unpaired.length),0===this.unpaired.length?void this._renderUnpairedEmpty():(n=o[1].map(function(e,t){return void 0!==o[0][t]&&o[0][t]!==e&&s.push(a._renderPairButton()),a._renderUnpairedDataset(e)}),i=o[0].map(function(e){return a._renderUnpairedDataset(e)}),i.length||n.length?(this.$(".unpaired-columns .forward-column .column-datasets").append(i).add(this.$(".unpaired-columns .paired-column .column-datasets").append(s)).add(this.$(".unpaired-columns .reverse-column .column-datasets").append(n)),void this._adjUnpairedOnScrollbar()):void this._renderUnpairedNotShown())},_renderUnpairedDisplayStr:function(e){return["(",e," ",(0,v.default)("filtered out"),")"].join("")},_renderUnpairedDataset:function(e){return s("<li/>").attr("id","dataset-"+e.id).addClass("dataset unpaired").attr("draggable",!0).addClass(e.selected?"selected":"").append(s("<span/>").addClass("dataset-name").text(e.name)).data("dataset",e)},_renderPairButton:function(){return s("<li/>").addClass("dataset unpaired").append(s("<span/>").addClass("dataset-name").text((0,v.default)("Pair these datasets")))},_renderUnpairedEmpty:function(){var e=s('<div class="empty-message"></div>').text("("+(0,v.default)("no remaining unpaired datasets")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(e),e},_renderUnpairedNotShown:function(){var e=s('<div class="empty-message"></div>').text("("+(0,v.default)("no datasets were found matching the current filters")+")");return this.$(".unpaired-columns .paired-column .column-datasets").empty().prepend(e),e},_adjUnpairedOnScrollbar:function(){var e=this.$(".unpaired-columns").last(),t=this.$(".unpaired-columns .reverse-column .dataset").first();if(t.length){var i=e.offset().left+e.outerWidth(),n=t.offset().left+t.outerWidth(),a=Math.floor(i)-Math.floor(n);this.$(".unpaired-columns .forward-column").css("margin-left",a>0?a:0)}},_renderPaired:function(e,t){if(this.$(".paired-column-title .title").text([this.paired.length,(0,v.default)("paired")].join(" ")),this.$(".unpair-all-link").toggle(0!==this.paired.length),0===this.paired.length)return void this._renderPairedEmpty();this.$(".remove-extensions-link").show(),this.$(".paired-columns .column-datasets").empty();var i=this;this.paired.forEach(function(e,t){var n=new w({pair:e});i.$(".paired-columns .column-datasets").append(n.render().$el).append(['<button class="unpair-btn">','<span class="fa fa-unlink" title="',(0,v.default)("Unpair"),'"></span>',"</button>"].join(""))})},_renderPairedEmpty:function(){var e=s('<div class="empty-message"></div>').text("("+(0,v.default)("no paired datasets yet")+")");return this.$(".paired-columns .column-datasets").empty().prepend(e),e},footerSettings:{".hide-originals":"hideOriginals",".remove-extensions":"removeExtensions"},_addPluginComponents:function(){this._chooseFiltersPopover(".choose-filters-link"),this.$(".help-content i").hoverhighlight(".collection-creator","rgba( 64, 255, 255, 1.0 )")},_chooseFiltersPopover:function(e){function t(e,t){return['<button class="filter-choice btn" ','data-forward="',e,'" data-reverse="',t,'">',(0,v.default)("Forward"),": ",e,", ",(0,v.default)("Reverse"),": ",t,"</button>"].join("")}var i=s(n.template(['<div class="choose-filters">','<div class="help">',(0,v.default)("Choose from the following filters to change which unpaired reads are shown in the display"),":</div>",n.values(this.commonFilters).map(function(e){return t(e[0],e[1])}).join(""),"</div>"].join(""))({}));return this.$(e).popover({container:".collection-creator",placement:"bottom",html:!0,content:i})},_validationWarning:function(e,t){"name"===e&&(e=this.$(".collection-name").add(this.$(".collection-name-prompt")),this.$(".collection-name").focus().select()),t?(e=e||this.$(".validation-warning"),e.removeClass("validation-warning")):e.addClass("validation-warning")},_setUpBehaviors:function(){return this.once("rendered",function(){this.trigger("rendered:initial",this)}),this.on("pair:new",function(){this._renderUnpaired(),this._renderPaired(),this.$(".paired-columns").scrollTop(8e6)}),this.on("pair:unpair",function(e){this._renderUnpaired(),this._renderPaired(),this.splitView()}),this.on("filter-change",function(){this.filters=[this.$(".forward-unpaired-filter input").val(),this.$(".reverse-unpaired-filter input").val()],this.metric("filter-change",this.filters),this._renderFilters(),this._renderUnpaired()}),this.on("autopair",function(){this._renderUnpaired(),this._renderPaired();var e,t=null;this.paired.length?(t="alert-success",e=this.paired.length+" "+(0,v.default)("pairs created"),this.unpaired.length||(e+=": "+(0,v.default)("all datasets have been successfully paired"),this.hideUnpaired(),this.$(".collection-name").focus())):e=(0,v.default)(["Could not automatically create any pairs from the given dataset names.","You may want to choose or enter different filters and try auto-pairing again.","Close this message using the X on the right to view more help."].join(" ")),this._showAlert(e,t)}),this},events:{"click .more-help":"_clickMoreHelp","click .less-help":"_clickLessHelp","click .main-help":"_toggleHelp","click .header .alert button":"_hideAlert","click .forward-column .column-title":"_clickShowOnlyUnpaired","click .reverse-column .column-title":"_clickShowOnlyUnpaired","click .unpair-all-link":"_clickUnpairAll","change .forward-unpaired-filter input":function(e){this.trigger("filter-change")},"focus .forward-unpaired-filter input":function(e){s(e.currentTarget).select()},"click .autopair-link":"_clickAutopair","click .choose-filters .filter-choice":"_clickFilterChoice","click .clear-filters-link":"_clearFilters","change .reverse-unpaired-filter input":function(e){this.trigger("filter-change")},"focus .reverse-unpaired-filter input":function(e){s(e.currentTarget).select()},"click .forward-column .dataset.unpaired":"_clickUnpairedDataset","click .reverse-column .dataset.unpaired":"_clickUnpairedDataset","click .paired-column .dataset.unpaired":"_clickPairRow","click .unpaired-columns":"clearSelectedUnpaired","mousedown .unpaired-columns .dataset":"_mousedownUnpaired","click .paired-column-title":"_clickShowOnlyPaired","mousedown .flexible-partition-drag":"_startPartitionDrag","click .paired-columns .dataset.paired":"selectPair","click .paired-columns":"clearSelectedPaired","click .paired-columns .pair-name":"_clickPairName","click .unpair-btn":"_clickUnpair","dragover .paired-columns .column-datasets":"_dragoverPairedColumns","drop .paired-columns .column-datasets":"_dropPairedColumns","pair.dragstart .paired-columns .column-datasets":"_pairDragstart","pair.dragend   .paired-columns .column-datasets":"_pairDragend","change .remove-extensions":function(e){this.toggleExtensions()},"change .collection-name":"_changeName","keydown .collection-name":"_nameCheckForEnter","change .hide-originals":"_changeHideOriginals","click .cancel-create":"_cancelCreate","click .create-collection":"_clickCreate"},_clickShowOnlyUnpaired:function(e){this.$(".paired-columns").is(":visible")?this.hidePaired():this.splitView()},_clickShowOnlyPaired:function(e){this.$(".unpaired-columns").is(":visible")?this.hideUnpaired():this.splitView()},hideUnpaired:function(e,t){this.unpairedPanelHidden=!0,this.pairedPanelHidden=!1,this._renderMiddle(e,t)},hidePaired:function(e,t){this.unpairedPanelHidden=!1,this.pairedPanelHidden=!0,this._renderMiddle(e,t)},splitView:function(e,t){return this.unpairedPanelHidden=this.pairedPanelHidden=!1,this._renderMiddle(e,t),this},_clickUnpairAll:function(e){this.metric("unpairAll"),this.unpairAll()},_clickAutopair:function(e){var t=this.autoPair();this.metric("autopair",t.length,this.unpaired.length),this.trigger("autopair")},_clickFilterChoice:function(e){var t=s(e.currentTarget);this.$(".forward-unpaired-filter input").val(t.data("forward")),this.$(".reverse-unpaired-filter input").val(t.data("reverse")),this._hideChooseFilters(),this.trigger("filter-change")},_hideChooseFilters:function(){this.$(".choose-filters-link").popover("hide"),this.$(".popover").css("display","none")},_clearFilters:function(e){this.$(".forward-unpaired-filter input").val(""),this.$(".reverse-unpaired-filter input").val(""),this.trigger("filter-change")},_clickUnpairedDataset:function(e){return e.stopPropagation(),this.toggleSelectUnpaired(s(e.currentTarget))},toggleSelectUnpaired:function(e,t){t=t||{};var i=e.data("dataset"),n=void 0!==t.force?t.force:!e.hasClass("selected");return e.length&&void 0!==i?(n?(e.addClass("selected"),t.waitToPair||this.pairAllSelected()):e.removeClass("selected"),e):e},pairAllSelected:function(e){e=e||{};var t=this,i=[],n=[],a=[];return t.$(".unpaired-columns .forward-column .dataset.selected").each(function(){i.push(s(this).data("dataset"))}),t.$(".unpaired-columns .reverse-column .dataset.selected").each(function(){n.push(s(this).data("dataset"))}),i.length=n.length=Math.min(i.length,n.length),i.forEach(function(e,i){try{a.push(t._pair(e,n[i],{silent:!0}))}catch(e){t.error(e)}}),a.length&&!e.silent&&this.trigger("pair:new",a),a},clearSelectedUnpaired:function(){this.$(".unpaired-columns .dataset.selected").removeClass("selected")},_mousedownUnpaired:function(e){if(e.shiftKey){var t=this,i=s(e.target).addClass("selected"),n=function(e){t.$(e.target).filter(".dataset").addClass("selected")};i.parent().on("mousemove",n),s(document).one("mouseup",function(e){i.parent().off("mousemove",n),t.pairAllSelected()})}},_clickPairRow:function(e){var t=s(e.currentTarget).index(),i=s(".unpaired-columns .forward-column .dataset").eq(t).data("dataset"),n=s(".unpaired-columns .reverse-column .dataset").eq(t).data("dataset");this._pair(i,n)},_startPartitionDrag:function(e){function t(e){n.$(".flexible-partition-drag").css("color",""),s("body").css("cursor","").unbind("mousemove",i)}function i(e){var t=e.pageY-a;n.adjPartition(t)||s("body").trigger("mouseup"),n._adjUnpairedOnScrollbar(),a+=t}var n=this,a=e.pageY;s("body").css("cursor","ns-resize"),n.$(".flexible-partition-drag").css("color","black"),s("body").mousemove(i),s("body").one("mouseup",t)},adjPartition:function(e){var t=this.$(".unpaired-columns"),i=this.$(".paired-columns"),n=parseInt(t.css("height"),10),a=parseInt(i.css("height"),10);n=Math.max(10,n+e),a-=e;var s=e<0;if(s){if(this.unpairedPanelHidden)return!1;if(n<=10)return this.hideUnpaired(),!1}else this.unpairedPanelHidden&&(t.show(),this.unpairedPanelHidden=!1);if(s)this.pairedPanelHidden&&(i.show(),this.pairedPanelHidden=!1);else{if(this.pairedPanelHidden)return!1;if(a<=15)return this.hidePaired(),!1}return t.css({height:n+"px",flex:"0 0 auto"}),!0},selectPair:function(e){e.stopPropagation(),s(e.currentTarget).toggleClass("selected")},clearSelectedPaired:function(e){this.$(".paired-columns .dataset.selected").removeClass("selected")},_clickPairName:function(e){e.stopPropagation();var t=s(e.currentTarget),i=t.parent().parent(),n=i.index(".dataset.paired"),a=this.paired[n],o=prompt("Enter a new name for the pair:",a.name);o&&(a.name=o,a.customizedName=!0,t.text(a.name))},_clickUnpair:function(e){var t=Math.floor(s(e.currentTarget).index(".unpair-btn"));this._unpair(this.paired[t])},_dragoverPairedColumns:function(e){e.preventDefault();var t=this.$(".paired-columns .column-datasets");this._checkForAutoscroll(t,e.originalEvent.clientY);var i=this._getNearestPairedDatasetLi(e.originalEvent.clientY);s(".element-drop-placeholder").remove();var n=s('<div class="element-drop-placeholder"></div>');i.length?i.before(n):t.append(n)},_checkForAutoscroll:function(e,t){var i=e.offset(),n=e.scrollTop(),a=t-i.top,s=i.top+e.outerHeight()-t;a>=0&&a<this.autoscrollDist?e.scrollTop(n-2):s>=0&&s<this.autoscrollDist&&e.scrollTop(n+2)},_getNearestPairedDatasetLi:function(e){for(var t=this.$(".paired-columns .column-datasets li").toArray(),i=0;i<t.length;i++){var n=s(t[i]),a=n.offset().top,o=Math.floor(n.outerHeight()/2)+4;if(a+o>e&&a-o<e)return n}return s()},_dropPairedColumns:function(e){e.preventDefault(),e.dataTransfer.dropEffect="move";var t=this._getNearestPairedDatasetLi(e.originalEvent.clientY);return t.length?this.$dragging.insertBefore(t):this.$dragging.insertAfter(this.$(".paired-columns .unpair-btn").last()),this._syncPairsToDom(),!1},_syncPairsToDom:function(){var e=[];this.$(".paired-columns .dataset.paired").each(function(){e.push(s(this).data("pair"))}),this.paired=e,this._renderPaired()},_pairDragstart:function(e,t){t.$el.addClass("selected");var i=this.$(".paired-columns .dataset.selected");this.$dragging=i},_pairDragend:function(e,t){s(".element-drop-placeholder").remove(),this.$dragging=null},toggleExtensions:function(e){var t=this;t.removeExtensions=void 0!==e?e:!t.removeExtensions,n.each(t.paired,function(e){e.customizedName||(e.name=t._guessNameForPair(e.forward,e.reverse))}),t._renderPaired(),t._renderFooter()},_printList:function(e){var t=this;n.each(e,function(i){e===t.paired?t._printPair(i):t.debug(i)})},_printPair:function(e){this.debug(e.forward.name,e.reverse.name,": ->",e.name)},toString:function(){return"PairedCollectionCreator"},templates:n.extend({},p.default.CollectionCreatorMixin._creatorTemplates,{header:n.template(['<div class="main-help well clear">','<a class="more-help" href="javascript:void(0);">',(0,v.default)("More help"),"</a>",'<div class="help-content">','<a class="less-help" href="javascript:void(0);">',(0,v.default)("Less"),"</a>","</div>","</div>",'<div class="alert alert-dismissable">','<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>','<span class="alert-message"></span>',"</div>",'<div class="column-headers vertically-spaced flex-column-container">','<div class="forward-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',(0,v.default)("Unpaired forward"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter forward-unpaired-filter pull-left">','<input class="search-query" placeholder="',(0,v.default)("Filter this list"),'" />',"</div>","</div>","</div>",'<div class="paired-column flex-column no-flex column">','<div class="column-header">','<a class="choose-filters-link" href="javascript:void(0)">',(0,v.default)("Choose filters"),"</a>",'<a class="clear-filters-link" href="javascript:void(0);">',(0,v.default)("Clear filters"),"</a><br />",'<a class="autopair-link" href="javascript:void(0);">',(0,v.default)("Auto-pair"),"</a>","</div>","</div>",'<div class="reverse-column flex-column column">','<div class="column-header">','<div class="column-title">','<span class="title">',(0,v.default)("Unpaired reverse"),"</span>",'<span class="title-info unpaired-info"></span>',"</div>",'<div class="unpaired-filter reverse-unpaired-filter pull-left">','<input class="search-query" placeholder="',(0,v.default)("Filter this list"),'" />',"</div>","</div>","</div>","</div>"].join("")),middle:n.template(['<div class="unpaired-columns flex-column-container scroll-container flex-row">','<div class="forward-column flex-column column">','<ol class="column-datasets"></ol>',"</div>",'<div class="paired-column flex-column no-flex column">','<ol class="column-datasets"></ol>',"</div>",'<div class="reverse-column flex-column column">','<ol class="column-datasets"></ol>',"</div>","</div>",'<div class="flexible-partition">','<div class="flexible-partition-drag" title="',(0,v.default)("Drag to change"),'"></div>','<div class="column-header">','<div class="column-title paired-column-title">','<span class="title"></span>',"</div>",'<a class="unpair-all-link" href="javascript:void(0);">',(0,v.default)("Unpair all"),"</a>","</div>","</div>",'<div class="paired-columns flex-column-container scroll-container flex-row">','<ol class="column-datasets"></ol>',"</div>"].join("")),footer:n.template(['<div class="attributes clear">','<div class="clear">','<label class="setting-prompt pull-right">',(0,v.default)("Hide original elements"),"?",'<input class="hide-originals pull-right" type="checkbox" />',"</label>",'<label class="setting-prompt pull-right">',(0,v.default)("Remove file extensions from pair names"),"?",'<input class="remove-extensions pull-right" type="checkbox" />',"</label>","</div>",'<div class="clear">','<input class="collection-name form-control pull-right" ','placeholder="',(0,v.default)("Enter a name for your new list"),'" />','<div class="collection-name-prompt pull-right">',(0,v.default)("Name"),":</div>","</div>","</div>",'<div class="actions clear vertically-spaced">','<div class="other-options pull-left">','<button class="cancel-create btn" tabindex="-1">',(0,v.default)("Cancel"),"</button>",'<div class="create-other btn-group dropup">','<button class="btn btn-default dropdown-toggle" data-toggle="dropdown">',(0,v.default)("Create a different kind of collection"),' <span class="caret"></span>',"</button>",'<ul class="dropdown-menu" role="menu">','<li><a href="#">',(0,v.default)("Create a <i>single</i> pair"),"</a></li>",'<li><a href="#">',(0,v.default)("Create a list of <i>unpaired</i> datasets"),"</a></li>","</ul>","</div>","</div>",'<div class="main-options pull-right">','<button class="create-collection btn btn-primary">',(0,v.default)("Create list"),"</button>","</div>","</div>"].join("")),helpContent:n.template(["<p>",(0,v.default)(["Collections of paired datasets are ordered lists of dataset pairs (often forward and reverse reads). ","These collections can be passed to tools and workflows in order to have analyses done on each member of ","the entire group. This interface allows you to create a collection, choose which datasets are paired, ","and re-order the final collection."].join("")),"</p>","<p>",(0,v.default)(['Unpaired datasets are shown in the <i data-target=".unpaired-columns">unpaired section</i> ',"(hover over the underlined words to highlight below). ",'Paired datasets are shown in the <i data-target=".paired-columns">paired section</i>.',"<ul>To pair datasets, you can:","<li>Click a dataset in the ",'<i data-target=".unpaired-columns .forward-column .column-datasets,','.unpaired-columns .forward-column">forward column</i> ',"to select it then click a dataset in the ",'<i data-target=".unpaired-columns .reverse-column .column-datasets,','.unpaired-columns .reverse-column">reverse column</i>.',"</li>",'<li>Click one of the "Pair these datasets" buttons in the ','<i data-target=".unpaired-columns .paired-column .column-datasets,','.unpaired-columns .paired-column">middle column</i> ',"to pair the datasets in a particular row.","</li>",'<li>Click <i data-target=".autopair-link">"Auto-pair"</i> ',"to have your datasets automatically paired based on name.","</li>","</ul>"].join("")),"</p>","<p>",(0,v.default)(["<ul>You can filter what is shown in the unpaired sections by:","<li>Entering partial dataset names in either the ",'<i data-target=".forward-unpaired-filter input">forward filter</i> or ','<i data-target=".reverse-unpaired-filter input">reverse filter</i>.',"</li>","<li>Choosing from a list of preset filters by clicking the ",'<i data-target=".choose-filters-link">"Choose filters" link</i>.',"</li>","<li>Entering regular expressions to match dataset names. See: ",'<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Regular_Expressions"',' target="_blank">MDN\'s JavaScript Regular Expression Tutorial</a>. ',"Note: forward slashes (\\) are not needed.","</li>","<li>Clearing the filters by clicking the ",'<i data-target=".clear-filters-link">"Clear filters" link</i>.',"</li>","</ul>"].join("")),"</p>","<p>",(0,v.default)(["To unpair individual dataset pairs, click the ",'<i data-target=".unpair-btn">unpair buttons ( <span class="fa fa-unlink"></span> )</i>. ','Click the <i data-target=".unpair-all-link">"Unpair all" link</i> to unpair all pairs.'].join("")),"</p>","<p>",(0,v.default)(['You can include or remove the file extensions (e.g. ".fastq") from your pair names by toggling the ','<i data-target=".remove-extensions-prompt">"Remove file extensions from pair names?"</i> control.'].join("")),"</p>","<p>",(0,v.default)(['Once your collection is complete, enter a <i data-target=".collection-name">name</i> and ','click <i data-target=".create-collection">"Create list"</i>. ',"(Note: you do not have to pair all unpaired datasets to finish.)"].join("")),"</p>"].join(""))})}),y=function(e,t){var i,s=a.Deferred();if(t=n.defaults(t||{},{datasets:e,oncancel:function(){Galaxy.modal.hide(),s.reject("cancelled")},oncreate:function(e,t){Galaxy.modal.hide(),s.resolve(t)}}),!window.Galaxy||!Galaxy.modal)throw new Error("Galaxy or Galaxy.modal not found");return i=new b(t),Galaxy.modal.show({title:"Create a collection of paired datasets",body:i.$el,width:"80%",height:"800px",closing_events:!0}),i.render(),window.creator=i,s};t.default={PairedCollectionCreator:b,pairedCollectionCreatorModal:y,createListOfPairsCollection:l}}).call(t,i(1),i(2),i(0),i(0))},function(e,t,i){"use strict";function n(e,t){if(0===e.length)return t.length;if(0===t.length)return e.length;var i,n=[];for(i=0;i<=t.length;i++)n[i]=[i];var a;for(a=0;a<=e.length;a++)n[0][a]=a;for(i=1;i<=t.length;i++)for(a=1;a<=e.length;a++)t.charAt(i-1)===e.charAt(a-1)?n[i][a]=n[i-1][a-1]:n[i][a]=Math.min(n[i-1][a-1]+1,Math.min(n[i][a-1]+1,n[i-1][a]+1));return n[t.length][e.length]}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(20),r=(s(o),i(4)),l=s(r),d=i(58),c=s(d),u=e.Model.extend({initialize:function(e){e=e||{},e.user_id=e.user_id||Galaxy.user.id,this.set({user_id:e.user_id,information:{title:"Manage information",description:"Edit your email, addresses and custom parameters or change your username.",url:"api/users/"+e.user_id+"/information/inputs",icon:"fa-user",redirect:"user"},password:{title:"Change password",description:"Allows you to change your login credentials.",icon:"fa-unlock-alt",url:"api/users/"+e.user_id+"/password/inputs",submit_title:"Save password",redirect:"user"},communication:{title:"Change communication settings",description:"Enable or disable the communication feature to chat with other users.",url:"api/users/"+e.user_id+"/communication/inputs",icon:"fa-comments-o",redirect:"user"},permissions:{title:"Set dataset permissions for new histories",description:"Grant others default access to newly created histories. Changes made here will only affect histories created after these settings have been stored.",url:"api/users/"+e.user_id+"/permissions/inputs",icon:"fa-users",submit_title:"Save permissions",redirect:"user"},api_key:{title:"Manage API key",description:"Access your current API key or create a new one.",url:"api/users/"+e.user_id+"/api_key/inputs",icon:"fa-key",submit_title:"Create a new key",submit_icon:"fa-check"},toolbox_filters:{title:"Manage Toolbox filters",description:"Customize your Toolbox by displaying or omitting sets of Tools.",url:"api/users/"+e.user_id+"/toolbox_filters/inputs",icon:"fa-filter",submit_title:"Save filters",redirect:"user"},openids:{title:"Manage OpenIDs",description:"Associate OpenIDs with your account.",icon:"fa-openid",onclick:function(){window.location.href=Galaxy.root+"user/openid_manage?cntrller=user&use_panels=True"}},custom_builds:{title:"Manage custom builds",description:"Add or remove custom builds using history datasets.",icon:"fa-cubes",onclick:function(){window.location.href=Galaxy.root+"custom_builds"}},logout:{title:"Sign out",description:"Click here to sign out of all sessions.",icon:"fa-sign-out",onclick:function(){Galaxy.modal.show({title:"Sign out",body:"Do you want to continue and sign out of all active sessions?",buttons:{Cancel:function(){Galaxy.modal.hide()},"Sign out":function(){window.location.href=Galaxy.root+"user/logout?session_csrf_token="+Galaxy.session_csrf_token}}})}}})}}),h=e.View.extend({title:"User Preferences",initialize:function(){this.model=new u,this.setElement("<div/>"),this.render()},render:function(){var e=this,t=Galaxy.config;n.getJSON(Galaxy.root+"api/users/"+Galaxy.user.id,function(i){e.$preferences=n("<div/>").addClass("ui-panel").append(n("<h2/>").append("User preferences")).append(n("<p/>").append("You are logged in as <strong>"+a.escape(i.email)+"</strong>.")).append(e.$table=n("<table/>").addClass("ui-panel-table"));var s=c.default.get("message"),o=c.default.get("status");s&&o&&e.$preferences.prepend(new l.default.Message({message:s,status:o}).$el),t.use_remote_user||(e._addLink("information"),e._addLink("password")),t.enable_communication_server&&e._addLink("communication"),e._addLink("custom_builds"),e._addLink("permissions"),e._addLink("api_key"),t.has_user_tool_filters&&e._addLink("toolbox_filters"),t.enable_openid&&!t.use_remote_user&&e._addLink("openids"),Galaxy.session_csrf_token&&e._addLink("logout"),e.$preferences.append(e._templateFooter(i)),e.$el.empty().append(e.$preferences)})},_addLink:function(e){var t=this.model.get(e),i=n(this._templateLink(t)),a=i.find("a");t.onclick?a.on("click",function(){t.onclick()}):a.attr("href",Galaxy.root+"user/"+e),this.$table.append(i)},_templateLink:function(e){return'<tr><td><div class="ui-panel-icon fa '+e.icon+'"></td><td><a class="ui-panel-anchor" href="javascript:void(0)">'+e.title+'</a><div class="ui-form-info">'+e.description+"</div></td></tr>"},_templateFooter:function(e){return'<p class="ui-panel-footer">You are using <strong>'+e.nice_total_disk_usage+"</strong> of disk space in this Galaxy instance. "+(Galaxy.config.enable_quotas?"Your disk quota is: <strong>"+e.quota+"</strong>. ":"")+'Is your usage more than expected? See the <a href="https://galaxyproject.org/learn/managing-datasets/" target="_blank">documentation</a> for tips on how to find all of the data in your account.</p>'}});t.default={View:h,Model:u}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=(a(s),i(4)),r=a(o),l=i(20),d=a(l),c=i(43),u=a(c),h=e.Collection.extend({comparator:function(e,t){return e=e.get("name"),t=t.get("name"),e>t?1:e<t?-1:0}}),f=e.View.extend({initialize:function(t){var i=this,a=Galaxy.currHistoryPanel&&Galaxy.currHistoryPanel.model.id;this.model=new e.Model,this.model.url=Galaxy.root+"api/histories/"+a+"/custom_builds_metadata",this.collection=new h,this.collection.url=Galaxy.root+"api/users/"+Galaxy.user.id+"/custom_builds",this.message=new r.default.Message({}),this.installed_builds=new r.default.Select.View({optional:!0,onchange:function(){i.installed_builds.value(null)},empty_text:"List of available builds:",error_text:"No system installed builds available."}),this.table=new u.default.View({cls:"grid",selectable:!1}),this.table.addHeader("Name"),this.table.addHeader("Key"),this.table.addHeader("Number of chroms/contigs"),this.table.addHeader(""),this.table.appendHeader(),this.setElement(n("<div/>").append(n("<h4/>").text("Current Custom Builds")).append(this.table.$el).append(this.$installed=n("<div/>").append(n("<h4/>").text("System Installed Builds").addClass("ui-margin-top")).append(this.installed_builds.$el)).append(n("<h4/>").text("Add a Custom Build").addClass("ui-margin-top")).append(n("<span/>").addClass("ui-column").append(n("<div/>").addClass("ui-column-left").append(this.message.$el).append(this.$form=n("<div/>").addClass("ui-margin-top"))).append(this.$help=n("<div/>").addClass("ui-column-right")))),this.listenTo(this.collection,"add remove reset",function(){i._renderTable()}),this.listenTo(this.model,"change",function(){i._renderForm()}),this.collection.fetch(),this.model.fetch()},render:function(){this._renderTable(),this._renderForm()},_renderTable:function(){var e=this;this.table.delAll(),this.collection.sort(),this.collection.each(function(t){e.table.add(t.get("name")),e.table.add(t.id),e.table.add(void 0!==t.get("count")?t.get("count"):"Processing..."),e.table.add(new r.default.ButtonIcon({icon:"fa-trash-o",cls:"ui-button-icon-plain",tooltip:"Delete custom build.",onclick:function(){t.destroy()}}).$el),e.table.append(t.id)})},_renderForm:function(){var e=this,t=new d.default({inputs:[{type:"text",name:"name",label:"Name",help:"Specify a build name e.g. Hamster."},{type:"text",name:"id",label:"Key",help:"Specify a build key e.g. hamster_v1."},{name:"len",type:"conditional",test_param:{name:"type",label:"Definition",help:"Provide the data source.",type:"select",value:"fasta",data:[{value:"fasta",label:"FASTA-file from history"},{value:"file",label:"Len-file from disk"},{value:"text",label:"Len-file by copy/paste"}]},cases:[{value:"fasta",inputs:[{type:"select",name:"value",label:"FASTA-file",data:this.model.get("fasta_hdas")}]},{value:"file",inputs:[{type:"upload",name:"value",label:"Len-file",data:this.model.get("len_hdas")}]},{value:"text",inputs:[{type:"text",area:!0,name:"value",label:"Edit/Paste"}]}]}],buttons:{save:new r.default.Button({icon:"fa-save",tooltip:"Create new Build",title:"Save",cls:"btn btn-primary ui-clear-float",onclick:function(){var i=t.data.create();i.id&&i.name?e.collection.create(i,{wait:!0,success:function(t){t.get("message")?e.message.update({message:t.get("message"),status:"warning"}):e.message.update({message:"Successfully added a new custom build.",status:"success"})},error:function(t,i){var n=i&&i.responseJSON&&i.responseJSON.err_msg;e.message.update({message:n||"Failed to create custom build.",status:"danger"})}}):e.message.update({message:"All inputs are required.",status:"danger"})}})},onchange:function(){var i=t.data.match("len|type");if(i){var n=t.field_list[i];e._renderHelp(n.value())}}});this.$form.empty().append(t.$el);var i=this.model.get("installed_builds");i&&i.length?(this.$installed.show(),this.installed_builds.update(this.model.get("installed_builds"))):this.$installed.hide(),this._renderHelp("fasta")},_renderHelp:function(e){this.$help.empty().addClass("alert alert-info").html("fasta"==e?this._templateFasta():this._templateLen())},_templateLen:function(){return"<h4>Length Format</h4><p>The length format is two-column, separated by whitespace, of the form:<pre>chrom/contig   length of chrom/contig</pre></p><p>For example, the first few entries of <em>mm9.len</em> are as follows:<pre>chr1    197195432\nchr2    181748087\nchr3    159599783\nchr4    155630120\nchr5    152537259</pre></p><p>Trackster uses this information to populate the select box for chrom/contig, andto set the maximum basepair of the track browser. You may either upload a .len fileof this format (Len File option), or directly enter the information into the box (Len Entry option).</p>"},_templateFasta:function(){return"<h4>FASTA format</h4><p>This is a multi-fasta file from your current history that provides the genomesequences for each chromosome/contig in your build.</p><p>Here is a snippet from an example multi-fasta file:<pre>>chr1\nATTATATATAAGACCACAGAGAGAATATTTTGCCCGG...\n\n>chr2\nGGCGGCCGCGGCGATATAGAACTACTCATTATATATA...\n\n...</pre></p>"}});t.default={View:f}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a){Object.defineProperty(t,"__esModule",{value:!0});var s=i(26),o=function(e){return e&&e.__esModule?e:{default:e}}(s),r=e.View.extend({initialize:function(t){var i=this;this.setElement(n("<div/>")),this.model=new e.Model(t),this.item=this.model.get("item"),this.title=this.model.get("plural"),n.ajax({url:Galaxy.root+this.item+"/"+this.model.get("action_id")+"?"+n.param(Galaxy.params),success:function(e){e.dict_format=!0,i.model.set(e),i.render()}})},render:function(){var e=new o.default(this.model.attributes);this.$el.empty().append(e.$el),this.$el.append(this._templateShared())},_templateShared:function(){var e=this,t=n("<div><h2>"+this.model.get("plural")+" shared with you by others</h2></div>"),i=this.model.attributes;if(i.shared_by_others&&i.shared_by_others.length>0){var s=n('<table class="colored" border="0" cellspacing="0" cellpadding="0" width="100%"><tr class="header"><th>Title</th><th>Owner</th></tr></table>');a.each(i.shared_by_others,function(t,i){var n=Galaxy.root+e.item+"/display_by_username_and_slug?username="+t.username+"&slug="+t.slug;s.append('<tr><td><a href="'+n+'">'+a.escape(t.title)+"</a></td><td>"+a.escape(t.username)+"</td></tr>")}),t.append(s)}else t.append("No "+this.model.get("plural").toLowerCase()+" have been shared with you.");return t}});t.default={View:r}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(42),r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t.default=e,t}(o),l=i(181),d=s(l),c=i(268),u=s(c),h=i(58),f=s(h),p=e.View.extend({tagName:"tr",initialize:function(){n.bindAll(this,"render","_rowTemplate","renderTagEditor","_templateActions","removeWorkflow","copyWorkflow"),r.options.timeOut=1500},events:{"click #show-in-tool-panel":"showInToolPanel","click #delete-workflow":"removeWorkflow","click #rename-workflow":"renameWorkflow","click #copy-workflow":"copyWorkflow"},render:function(){return a(this.el).html(this._rowTemplate()),this},showInToolPanel:function(){this.model.set("show_in_tool_panel",!this.model.get("show_in_tool_panel")),this.model.save(),window.location=Galaxy.root+"workflows/list"},removeWorkflow:function(){var e=this.model.get("name");window.confirm("Are you sure you want to delete workflow '"+e+"'?")&&(this.model.destroy({success:function(){r.success("Successfully deleted workflow '"+e+"'")}}),this.remove())},renameWorkflow:function(){var e=this.model.get("name"),t=window.prompt("Enter a new Name for workflow '"+e+"'",e);t&&(this.model.save({name:t},{success:function(){r.success("Successfully renamed workflow '"+e+"' to '"+t+"'")}}),this.render())},copyWorkflow:function(){var e=this,t=this.model.get("name");a.getJSON(this.model.urlRoot+"/"+this.model.id+"/download",function(i){var n="Copy of "+t,a=e.model.get("owner");a!=Galaxy.user.attributes.username&&(n+=" shared by user "+a),i.name=n,e.collection.create(i,{at:0,wait:!0,success:function(){r.success("Successfully copied workflow '"+t+"' to '"+n+"'")},error:function(e,t,i){r.error(i.errorThrown)}})}).error(function(e,t,i){r.error(e.responseJSON.err_msg)})},_rowTemplate:function(){var e=this.model.get("show_in_tool_panel"),t=this.model.id,i='<input id="show-in-tool-panel" type="checkbox" class="show-in-tool-panel" '+(e?'checked="'+e+'"':"")+' value="'+t+'">';return'<td><div class="dropdown"><button class="menubutton" type="button" data-toggle="dropdown">'+n.escape(this.model.get("name"))+'<span class="caret"></span></button>'+this._templateActions()+'</div></td><td><span><div class="'+t+' tags-display"></div></td><td>'+(this.model.get("owner")===Galaxy.user.attributes.username?"You":this.model.get("owner"))+"</span></td><td>"+this.model.get("number_of_steps")+"</td><td>"+(this.model.get("published")?"Yes":"No")+"</td><td>"+i+"</td>"},renderTagEditor:function(){var e=new d.default.TagsEditor({model:this.model,el:a.find("."+this.model.id+".tags-display"),workflow_mode:!0});e.toggle(!0),e.render()},_templateActions:function(){return this.model.get("owner")===Galaxy.user.attributes.username?'<ul class="dropdown-menu action-dpd"><li><a href="'+Galaxy.root+"workflow/editor?id="+this.model.id+'">Edit</a></li><li><a href="'+Galaxy.root+"workflows/run?id="+this.model.id+'">Run</a></li><li><a href="'+Galaxy.root+"workflow/sharing?id="+this.model.id+'">Share</a></li><li><a href="'+Galaxy.root+"api/workflows/"+this.model.id+'/download?format=json-download">Download</a></li><li><a id="copy-workflow" style="cursor: pointer;">Copy</a></li><li><a id="rename-workflow" style="cursor: pointer;">Rename</a></li><li><a href="'+Galaxy.root+"workflow/display_by_id?id="+this.model.id+'">View</a></li><li><a id="delete-workflow" style="cursor: pointer;">Delete</a></li></ul>':'<ul class="dropdown-menu action-dpd"><li><a href="'+Galaxy.root+"workflow/display_by_username_and_slug?username="+this.model.get("owner")+"&slug="+this.model.get("slug")+'">View</a></li><li><a href="'+Galaxy.root+"workflows/run?id="+this.model.id+'">Run</a></li><li><a id="copy-workflow" style="cursor: pointer;">Copy</a></li><li><a class="link-confirm-shared-'+this.model.id+'" href="'+Galaxy.root+"workflow/sharing?unshare_me=True&id="+this.model.id+'">Remove</a></li></ul>'}}),m=e.View.extend({title:"Workflows",initialize:function(){this.setElement("<div/>"),n.bindAll(this,"adjustActiondropdown"),this.collection=new u.default.WorkflowCollection,this.collection.fetch().done(this.render()),this.collection.bind("add",this.appendItem),this.collection.on("sync",this.render,this)},events:{dragleave:"unhighlightDropZone",drop:"drop",dragover:function(e){a(".hidden_description_layer").addClass("dragover"),a(".menubutton").addClass("background-none"),e.preventDefault()}},unhighlightDropZone:function(){a(".hidden_description_layer").removeClass("dragover"),a(".menubutton").removeClass("background-none")},drop:function(e){this.unhighlightDropZone(),e.preventDefault();for(var t,i=e.dataTransfer.files,n=this,a=0;t=i[a];a++)n.readWorkflowFiles(t)},readWorkflowFiles:function(e){var t=this,i=new FileReader;i.onload=function(n){var a;try{a=JSON.parse(i.result)}catch(t){r.error("Could not read file '"+e.name+"'. Verify it is a valid Galaxy workflow"),a=null}a&&t.collection.create(a,{at:0,wait:!0,success:function(){r.success("Successfully imported workflow '"+a.name+"'")},error:function(e,t,i){r.error(i.errorThrown)}})},i.readAsText(e,"utf-8")},_showArgErrors:n.once(function(){var e=f.default.get("message");"error"===f.default.get("status")?r.error(n.escape(e||"Unknown Error, please report this to an administrator.")):e&&r.info(n.escape(e))}),render:function(){var e=this._templateHeader(),t=this._templateActionButtons(),i=this._templateWorkflowTable();this.$el.html(e+t+i);var a=this;n(this.collection.models).each(function(e){a.appendItem(e),a.confirmDelete(e)},this);return this.searchWorkflow(this.$(".search-wf"),this.$(".workflow-search tr"),3),this.adjustActiondropdown(),this._showArgErrors(),this},appendItem:function(e){var t=new p({model:e,collection:this.collection});a(".workflow-search").append(t.render().el),t.renderTagEditor()},confirmDelete:function(e){this.$(".link-confirm-shared-"+e.id).click(function(){return window.confirm("Are you sure you want to remove the shared workflow '"+e.attributes.name+"'?")})},searchWorkflow:function(e,t,i){e.on("keyup",function(){var e=a(this).val();if(e.length>=i){var n=new RegExp(e,"i");t.hide(),t.filter(function(){return n.test(a(this).text())}).show()}else t.show()})},adjustActiondropdown:function(){a(this.el).on("show.bs.dropdown",function(){a(this.el).css("overflow","inherit")}),a(this.el).on("hide.bs.dropdown",function(){a(this.el).css("overflow","auto")})},_templateNoWorkflow:function(){return'<div class="wf-nodata"> You have no workflows. </div>'},_templateActionButtons:function(){return'<ul class="manage-table-actions"><li><input class="search-wf form-control" type="text" autocomplete="off" placeholder="search for workflow..."></li><li><a class="action-button fa fa-plus wf-action" id="new-workflow" title="Create new workflow" href="'+Galaxy.root+'workflows/create"></a></li><li><a class="action-button fa fa-upload wf-action" id="import-workflow" title="Upload or import workflow" href="'+Galaxy.root+'workflows/import_workflow"></a></li></ul>'},_templateWorkflowTable:function(){return'<table class="table colored"><thead><tr class="header"><th>Name</th><th>Tags</th><th>Owner</th><th># of Steps</th><th>Published</th><th>Show in tools panel</th></tr></thead><tbody class="workflow-search "><div class="hidden_description_layer"><p>Drop workflow files here to import</p></tbody></table></div>'},_templateHeader:function(){return'<div class="page-container"><div class="user-workflows wf"><div class="response-message"></div><h2>Your workflows</h2></div></div>'}}),_=e.View.extend({initialize:function(){this.setElement("<div/>"),this.render()},render:function(){var e=this;a.getJSON(Galaxy.root+"workflow/upload_import_workflow",function(t){e.$el.empty().append(e._mainTemplate(t))})},_mainTemplate:function(e){return"<div class='toolForm'><div class='toolFormTitle'>Import Galaxy workflow</div><div class='toolFormBody'><form name='import_workflow' id='import_workflow' action='"+Galaxy.root+"workflow/upload_import_workflow' enctype='multipart/form-data' method='POST'><div class='form-row'><label>Galaxy workflow URL:</label><input type='text' name='url' class='input-url' value='"+e.url+"' size='40'><div class='toolParamHelp' style='clear: both;'>If the workflow is accessible via a URL, enter the URL above and click <b>Import</b>.</div><div style='clear: both'></div></div><div class='form-row'><label>Galaxy workflow file:</label><div class='form-row-input'><input type='file' name='file_data' class='input-file'/></div><div class='toolParamHelp' style='clear: both;'>If the workflow is in a file on your computer, choose it and then click <b>Import</b>.</div><div style='clear: both'></div></div><div class='form-row'><input type='submit' class='primary-button wf-import' name='import_button' value='Import'></div></form><hr/><div class='form-row'><label>Import a Galaxy workflow from myExperiment:</label><div class='form-row-input'><a href='"+e.myexperiment_target_url+"'> Visit myExperiment</a></div><div class='toolParamHelp' style='clear: both;'>Click the link above to visit myExperiment and browse for Galaxy workflows.</div><div style='clear: both'></div></div></div></div>"}});t.default={View:m,ImportWorkflowView:_}}).call(t,i(1),i(2),i(0))},function(e,t,i){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0});var n=i(8),a=function(e){return e&&e.__esModule?e:{default:e}}(n),s=e.Model.extend(a.default.LoggableMixin).extend({_logNamespace:"workflow",urlRoot:Galaxy.root+"api/workflows",toJSON:function(){return{workflow:this.attributes}}}),o=e.Collection.extend({model:s,url:Galaxy.root+"api/workflows"});t.default={WorkflowItem:s,WorkflowCollection:o}}).call(t,i(1))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=s(o),l=i(26),d=s(l),c=i(191),u=s(c),h=i(211),f=s(h),p=e.View.extend({title:"Histories",initialize:function(t){var i=this;this.setElement(n("<div/>")),this.model=new e.Model,r.default.get({url:Galaxy.root+"history/"+t.action_id+"?"+n.param(Galaxy.params),success:function(e){e.dict_format=!0,a.each(e.operations,function(e){"Copy"==e.label&&(e.onclick=function(e){i._showCopyDialog(e)})}),i.model.set(e),i.render()}})},render:function(){var e=new d.default(this.model.attributes);this.$el.empty().append(e.$el)},_showCopyDialog:function(e){var t=new u.default.History({id:e});t.fetch().fail(function(){alert("History could not be fetched. Please contact an administrator")}).done(function(){(0,f.default)(t,{}).done(function(){window.parent&&window.parent.Galaxy&&window.parent.Galaxy.currHistoryPanel&&window.parent.Galaxy.currHistoryPanel.loadCurrentHistory(),window.location.reload(!0)})})}});t.default={View:p}}).call(t,i(1),i(0),i(2))},function(e,t,i){"use strict";(function(e,n){function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),o=a(s),r=i(4),l=a(r),d=i(20),c=a(d),u=e.View.extend({initialize:function(){this.setElement("<div/>"),this.model=new e.Model({dataset_id:Galaxy.params.dataset_id}),this.render()},render:function(){var e=Galaxy.root+"api/datasets/"+this.model.get("dataset_id"),t=this;o.default.get({url:e,success:function(e){var i=Galaxy.root+"api/jobs/"+e.creating_job+"?full=True";o.default.get({url:i,success:function(i){Galaxy.root,e.creating_job;t.render_error_page(t,e,i)},error:function(e){var i={status:"error",message:"Error occured while loading the job.",persistent:!0,cls:"errormessage"};t.display_message(i,t.$(".response-message"))}})},error:function(e){var i={status:"error",message:"Error occured while loading the dataset.",persistent:!0,cls:"errormessage"};t.display_message(i,t.$(".response-message"))}})},render_error_page:function(e,t,i){e.$el.empty().append(e._templateHeader()),e.$el.append("<h2>Dataset Error</h2>"),e.$el.append("<p>An error occured while running the tool <b>"+i.tool_id+"</b>.</p>"),e.$el.append("<p>Tool execution generated the following messages:</p>"),e.$el.append('<pre class="code">'+i.stderr+"</pre>"),e.$el.append("<h2>Report This Error</pre>"),e.$el.append("<p>Usually the local Galaxy administrators regularly review errors that occur on the server. However, if you would like to provide additional information (such as what you were trying to do when the error occurred) and a contact e-mail address, we will be better able to investigate your problem and get back to you.</p>"),e.$el.append(e._getBugFormTemplate(t,i))},display_message:function(e,t,i,n){n?i?t.append(new l.default.UnescapedMessage(e).$el):t.empty().html(new l.default.UnescapedMessage(e).$el):i?t.append(new l.default.Message(e).$el):t.empty().html(new l.default.Message(e).$el)},_templateHeader:function(){return'<div class="page-container edit-attr"><div class="response-message"></div></div>'},_getBugFormTemplate:function(e,t){var i=this,n=[{help:"Your email address",options:[],type:"text",name:"email",label:"Your email",value:Galaxy.user.get("email")},{help:"Any additional comments you can provide regarding what you were doing at the time of the bug.",options:[],type:"text",area:!0,name:"message",label:"Message"}],a=new c.default({title:"Error Report",inputs:n,buttons:{save:new l.default.Button({icon:"fa-bug",title:"Report",cls:"ui-button btn btn-primary",floating:"clear",onclick:function(){var n=a.data.create(),s=Galaxy.root+"api/jobs/"+t.id+"/error";n.dataset_id=e.id,i.submit(n,s)}})}});return a.$el},submit:function(e,t){var i=this;n.ajax({type:"POST",url:t,data:e,success:function(e){i.$el.empty().append(i._templateHeader()),e.messages.forEach(function(e){i.display_message({status:e[1],message:e[0],persistent:!0},i.$(".response-message"),!0,!0)})},error:function(e){var t={status:"error",message:"Error occured while saving. Please fill all the required fields and try again.",persistent:!0,cls:"errormessage"};i.display_message(t,i.$(".response-message"))}})}});t.default={View:u}}).call(t,i(1),i(0))},function(e,t,i){"use strict";(function(e,n,a){function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=i(3),r=(s(o),i(68)),l=s(r),d=i(4),c=s(d),u=i(20),h=s(u),f=e.View.extend({initialize:function(){this.setElement("<div/>"),this.model=new e.Model({dataset_id:Galaxy.params.dataset_id}),this.message=new c.default.Message({persistent:!0}),this.tabs=this._createTabs(),this.$el.append(n("<h4/>").append("Edit dataset attributes")).append(this.message.$el).append("<p/>").append(this.tabs.$el).hide(),this.render()},render:function(){var e=this;n.ajax({url:Galaxy.root+"dataset/get_edit?dataset_id="+e.model.get("dataset_id"),success:function(t){!e.initial_message&&e.message.update(t),e.initial_message=!0,a.each(e.forms,function(e,i){e.model.set("inputs",t[i+"_inputs"]),e.model.set("hide_operations",t[i+"_disable"]),e.render()}),e.$el.show()},error:function(t){var i=t.responseJSON&&t.responseJSON.err_msg;e.message.update({status:"danger",message:i||"Error occured while loading the dataset."})}})},_submit:function(e,t){var i=this,a=t.data.create();a.dataset_id=this.model.get("dataset_id"),a.operation=e,n.ajax({type:"PUT",url:Galaxy.root+"dataset/set_edit",data:a,success:function(e){i.message.update(e),i.render(),i._reloadHistory()},error:function(e){var t=e.responseJSON&&e.responseJSON.err_msg;i.message.update({status:"danger",message:t||"Error occured while editing the dataset attributes."})}})},_createTabs:function(){this.forms={attribute:this._getAttribute(),conversion:this._getConversion(),datatype:this._getDatatype(),permission:this._getPermission()};var e=new l.default.View;return e.add({id:"attribute",title:"Attributes",icon:"fa fa-bars",tooltip:"Edit dataset attributes",$el:this.forms.attribute.$el}),e.add({id:"convert",title:"Convert",icon:"fa-gear",tooltip:"Convert to new format",$el:this.forms.conversion.$el}),e.add({id:"datatype",title:"Datatypes",icon:"fa-database",tooltip:"Change data type",$el:this.forms.datatype.$el}),e.add({id:"permissions",title:"Permissions",icon:"fa-user",tooltip:"Permissions",$el:this.forms.permission.$el}),e},_getAttribute:function(){var e=this,t=new h.default({title:"Edit attributes",operations:{submit_attributes:new c.default.ButtonIcon({tooltip:"Save attributes of the dataset.",icon:"fa-floppy-o",title:"Save",onclick:function(){e._submit("attributes",t)}}),submit_autodetect:new c.default.ButtonIcon({tooltip:"This will inspect the dataset and attempt to correct the values of fields if they are not accurate.",icon:"fa-undo",title:"Auto-detect",onclick:function(){e._submit("autodetect",t)}})}});return t},_getConversion:function(){var e=this,t=new h.default({title:"Convert to new format",operations:{submit_conversion:new c.default.ButtonIcon({tooltip:"Convert the datatype to a new format.",title:"Convert datatype",icon:"fa-exchange",onclick:function(){e._submit("conversion",t)}})}});return t},_getDatatype:function(){var e=this,t=new h.default({title:"Change datatype",operations:{submit_datatype:new c.default.ButtonIcon({tooltip:"Change the datatype to a new type.",title:"Change datatype",icon:"fa-exchange",onclick:function(){e._submit("datatype",t)}})}});return t},_getPermission:function(){var e=this,t=new h.default({title:"Manage dataset permissions",operations:{submit_permission:new c.default.ButtonIcon({tooltip:"Save permissions.",title:"Save permissions",icon:"fa-floppy-o ",onclick:function(){e._submit("permission",t)}})}});return t},_reloadHistory:function(){window.Galaxy&&window.Galaxy.currHistoryPanel.loadCurrentHistory()}});t.default={View:f}}).call(t,i(1),i(0),i(2))}],[239]);